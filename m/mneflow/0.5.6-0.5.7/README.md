# Comparing `tmp/mneflow-0.5.6.tar.gz` & `tmp/mneflow-0.5.7.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "C:\Users\ipzub\projs\mneflow\dist\.tmp-a7x5zl9o\mneflow-0.5.6.tar", last modified: Sun Mar  3 11:11:39 2024, max compression
+gzip compressed data, was "C:\Users\ipzub\projs\mneflow\dist\.tmp-mqjs50ro\mneflow-0.5.7.tar", last modified: Tue Apr 23 16:41:18 2024, max compression
```

## Comparing `mneflow-0.5.6.tar` & `mneflow-0.5.7.tar`

### file list

```diff
@@ -1,18 +1,18 @@
-drwxrwxrwx   0        0        0        0 2024-03-03 11:11:39.169020 mneflow-0.5.6/
--rw-rw-rw-   0        0        0     1549 2023-10-03 11:35:20.000000 mneflow-0.5.6/LICENSE.md
--rw-rw-rw-   0        0        0      930 2024-03-03 11:11:39.168000 mneflow-0.5.6/PKG-INFO
--rw-rw-rw-   0        0        0     2893 2024-02-26 13:04:59.000000 mneflow-0.5.6/README.md
-drwxrwxrwx   0        0        0        0 2024-03-03 11:11:39.151936 mneflow-0.5.6/mneflow/
--rw-rw-rw-   0        0        0      212 2024-03-03 09:24:14.000000 mneflow-0.5.6/mneflow/__init__.py
--rw-rw-rw-   0        0        0    15548 2024-03-02 16:33:52.000000 mneflow-0.5.6/mneflow/data.py
--rw-rw-rw-   0        0        0    20231 2024-03-03 10:13:10.000000 mneflow-0.5.6/mneflow/layers.py
--rw-rw-rw-   0        0        0   127517 2024-03-03 10:05:37.000000 mneflow-0.5.6/mneflow/models.py
--rw-rw-rw-   0        0        0    42648 2024-03-03 11:08:02.000000 mneflow-0.5.6/mneflow/utils.py
-drwxrwxrwx   0        0        0        0 2024-03-03 11:11:39.166037 mneflow-0.5.6/mneflow.egg-info/
--rw-rw-rw-   0        0        0      930 2024-03-03 11:11:39.000000 mneflow-0.5.6/mneflow.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0      272 2024-03-03 11:11:39.000000 mneflow-0.5.6/mneflow.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2024-03-03 11:11:39.000000 mneflow-0.5.6/mneflow.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0       38 2024-03-03 11:11:39.000000 mneflow-0.5.6/mneflow.egg-info/requires.txt
--rw-rw-rw-   0        0        0        8 2024-03-03 11:11:39.000000 mneflow-0.5.6/mneflow.egg-info/top_level.txt
--rw-rw-rw-   0        0        0       42 2024-03-03 11:11:39.169997 mneflow-0.5.6/setup.cfg
--rw-rw-rw-   0        0        0     1365 2024-03-03 09:24:34.000000 mneflow-0.5.6/setup.py
+drwxrwxrwx   0        0        0        0 2024-04-23 16:41:18.577499 mneflow-0.5.7/
+-rw-rw-rw-   0        0        0     1549 2023-10-03 11:35:20.000000 mneflow-0.5.7/LICENSE.md
+-rw-rw-rw-   0        0        0      963 2024-04-23 16:41:18.575320 mneflow-0.5.7/PKG-INFO
+-rw-rw-rw-   0        0        0     2893 2024-02-26 13:04:59.000000 mneflow-0.5.7/README.md
+drwxrwxrwx   0        0        0        0 2024-04-23 16:41:18.563603 mneflow-0.5.7/mneflow/
+-rw-rw-rw-   0        0        0      212 2024-04-23 16:25:42.000000 mneflow-0.5.7/mneflow/__init__.py
+-rw-rw-rw-   0        0        0    15542 2024-04-23 16:35:15.000000 mneflow-0.5.7/mneflow/data.py
+-rw-rw-rw-   0        0        0    20231 2024-03-03 10:13:10.000000 mneflow-0.5.7/mneflow/layers.py
+-rw-rw-rw-   0        0        0   126798 2024-04-23 16:10:01.000000 mneflow-0.5.7/mneflow/models.py
+-rw-rw-rw-   0        0        0    53760 2024-04-17 07:12:46.000000 mneflow-0.5.7/mneflow/utils.py
+drwxrwxrwx   0        0        0        0 2024-04-23 16:41:18.574330 mneflow-0.5.7/mneflow.egg-info/
+-rw-rw-rw-   0        0        0      963 2024-04-23 16:41:18.000000 mneflow-0.5.7/mneflow.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0      272 2024-04-23 16:41:18.000000 mneflow-0.5.7/mneflow.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2024-04-23 16:41:18.000000 mneflow-0.5.7/mneflow.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0       71 2024-04-23 16:41:18.000000 mneflow-0.5.7/mneflow.egg-info/requires.txt
+-rw-rw-rw-   0        0        0        8 2024-04-23 16:41:18.000000 mneflow-0.5.7/mneflow.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0       42 2024-04-23 16:41:18.577499 mneflow-0.5.7/setup.cfg
+-rw-rw-rw-   0        0        0     1516 2024-04-23 16:39:46.000000 mneflow-0.5.7/setup.py
```

### Comparing `mneflow-0.5.6/LICENSE.md` & `mneflow-0.5.7/LICENSE.md`

 * *Files identical despite different names*

### Comparing `mneflow-0.5.6/PKG-INFO` & `mneflow-0.5.7/PKG-INFO`

 * *Files 7% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mneflow
-Version: 0.5.6
+Version: 0.5.7
 Summary: Neural networks for MEG and EEG data
 Home-page: https://github.com/zubara/mneflow
 Download-URL: https://github.com/zubara/mneflow/archive/master.zip
 Maintainer: Ivan Zubarev
 Maintainer-email: ivan.zubarev@aalto.fi
 License: BSD-3
 Platform: any
@@ -18,10 +18,10 @@
 Classifier: Operating System :: POSIX
 Classifier: Operating System :: Unix
 Classifier: Operating System :: MacOS
 Description-Content-Type: text/x-rst
 License-File: LICENSE.md
 Requires-Dist: numpy
 Requires-Dist: scipy
-Requires-Dist: mne
-Requires-Dist: tensorflow
+Requires-Dist: mne<=1.1.1,>=0.24.0
+Requires-Dist: tensorflow<=2.16rc,>=2.12.0
 Requires-Dist: matplotlib
```

### Comparing `mneflow-0.5.6/README.md` & `mneflow-0.5.7/README.md`

 * *Files identical despite different names*

### Comparing `mneflow-0.5.6/mneflow/data.py` & `mneflow-0.5.7/mneflow/data.py`

 * *Files 0% similar despite different names*

```diff
@@ -256,15 +256,15 @@
                                         tf.constant(self.times),
                                         axis=2)
         return example_proto
 
     def class_weights(self):
         """Weights take class proportions into account."""
         weights = np.array(
-                [v for k, v in self.h_params['class_proportions'].items()])
+                [v for k, v in self.h_params['class_ratio'].items()])
         return (1./np.mean(weights))/weights
 
     def _decimate(self, example_proto):
         """Downsample data."""
         example_proto['X'] = tf.gather(example_proto['X'],
                                         self.timepoints,
                                         axis=2)
```

### Comparing `mneflow-0.5.6/mneflow/layers.py` & `mneflow-0.5.7/mneflow/layers.py`

 * *Files identical despite different names*

### Comparing `mneflow-0.5.6/mneflow/models.py` & `mneflow-0.5.7/mneflow/models.py`

 * *Files 4% similar despite different names*

```diff
@@ -14,7957 +14,7912 @@
 000000d0: 2069 7661 6e2e 7a75 6261 7265 7640 6161   ivan.zubarev@aa
 000000e0: 6c74 6f2e 6669 0d0a 2222 220d 0a0d 0a23  lto.fi.."""....#
 000000f0: 544f 444f 3a20 7570 6461 7465 2076 697a  TODO: update viz
 00000100: 7561 6c69 7a61 7469 6f6e 730d 0a0d 0a69  ualizations....i
 00000110: 6d70 6f72 7420 7465 6e73 6f72 666c 6f77  mport tensorflow
 00000120: 2061 7320 7466 0d0a 0d0a 696d 706f 7274   as tf....import
 00000130: 206e 756d 7079 2061 7320 6e70 0d0a 696d   numpy as np..im
-00000140: 706f 7274 2070 6963 6b6c 650d 0a0d 0a0d  port pickle.....
-00000150: 0a66 726f 6d20 6d6e 6520 696d 706f 7274  .from mne import
-00000160: 2063 6861 6e6e 656c 732c 2065 766f 6b65   channels, evoke
-00000170: 642c 2063 7265 6174 655f 696e 666f 2c20  d, create_info, 
-00000180: 496e 666f 0d0a 6672 6f6d 206d 6e65 2e66  Info..from mne.f
-00000190: 696c 7465 7220 696d 706f 7274 2066 696c  ilter import fil
-000001a0: 7465 725f 6461 7461 0d0a 0d0a 6672 6f6d  ter_data....from
-000001b0: 2073 6369 7079 2e73 6967 6e61 6c20 696d   scipy.signal im
-000001c0: 706f 7274 2066 7265 717a 2c20 7765 6c63  port freqz, welc
-000001d0: 680d 0a66 726f 6d20 7363 6970 792e 7374  h..from scipy.st
-000001e0: 6174 7320 696d 706f 7274 2073 7065 6172  ats import spear
-000001f0: 6d61 6e72 0d0a 0d0a 6672 6f6d 206d 6174  manr....from mat
-00000200: 706c 6f74 6c69 6220 696d 706f 7274 2070  plotlib import p
-00000210: 7970 6c6f 7420 6173 2070 6c74 0d0a 6672  yplot as plt..fr
-00000220: 6f6d 206d 6174 706c 6f74 6c69 6220 696d  om matplotlib im
-00000230: 706f 7274 2070 6174 6368 6573 2061 7320  port patches as 
-00000240: 7074 6368 0d0a 6672 6f6d 206d 6174 706c  ptch..from matpl
-00000250: 6f74 6c69 6220 696d 706f 7274 2063 6f6c  otlib import col
-00000260: 6c65 6374 696f 6e73 0d0a 6672 6f6d 206d  lections..from m
-00000270: 706c 5f74 6f6f 6c6b 6974 732e 6178 6573  pl_toolkits.axes
-00000280: 5f67 7269 6431 2069 6d70 6f72 7420 6d61  _grid1 import ma
-00000290: 6b65 5f61 7865 735f 6c6f 6361 7461 626c  ke_axes_locatabl
-000002a0: 650d 0a0d 0a66 726f 6d20 2e6c 6179 6572  e....from .layer
-000002b0: 7320 696d 706f 7274 204c 4654 436f 6e76  s import LFTConv
-000002c0: 2c20 5641 5243 6f6e 762c 2044 654d 6978  , VARConv, DeMix
-000002d0: 696e 672c 2046 756c 6c79 436f 6e6e 6563  ing, FullyConnec
-000002e0: 7465 642c 2054 656d 7050 6f6f 6c69 6e67  ted, TempPooling
-000002f0: 0d0a 6672 6f6d 2074 656e 736f 7266 6c6f  ..from tensorflo
-00000300: 772e 6b65 7261 732e 6c61 7965 7273 2069  w.keras.layers i
-00000310: 6d70 6f72 7420 5365 7061 7261 626c 6543  mport SeparableC
-00000320: 6f6e 7632 442c 2043 6f6e 7632 442c 2044  onv2D, Conv2D, D
-00000330: 6570 7468 7769 7365 436f 6e76 3244 0d0a  epthwiseConv2D..
-00000340: 6672 6f6d 2074 656e 736f 7266 6c6f 772e  from tensorflow.
-00000350: 6b65 7261 732e 6c61 7965 7273 2069 6d70  keras.layers imp
-00000360: 6f72 7420 466c 6174 7465 6e2c 2044 726f  ort Flatten, Dro
-00000370: 706f 7574 2c20 4261 7463 684e 6f72 6d61  pout, BatchNorma
-00000380: 6c69 7a61 7469 6f6e 0d0a 6672 6f6d 2074  lization..from t
-00000390: 656e 736f 7266 6c6f 772e 6b65 7261 732e  ensorflow.keras.
-000003a0: 696e 6974 6961 6c69 7a65 7273 2069 6d70  initializers imp
-000003b0: 6f72 7420 436f 6e73 7461 6e74 0d0a 6672  ort Constant..fr
-000003c0: 6f6d 2074 656e 736f 7266 6c6f 772e 6b65  om tensorflow.ke
-000003d0: 7261 7320 696d 706f 7274 2072 6567 756c  ras import regul
-000003e0: 6172 697a 6572 7320 6173 206b 5f72 6567  arizers as k_reg
-000003f0: 2c20 636f 6e73 7472 6169 6e74 732c 206c  , constraints, l
-00000400: 6179 6572 730d 0a0d 0a66 726f 6d20 2e6c  ayers....from .l
-00000410: 6179 6572 7320 696d 706f 7274 204c 5354  ayers import LST
-00000420: 4d0d 0a69 6d70 6f72 7420 6373 760d 0a69  M..import csv..i
-00000430: 6d70 6f72 7420 6f73 0d0a 6672 6f6d 202e  mport os..from .
-00000440: 6461 7461 2069 6d70 6f72 7420 4461 7461  data import Data
-00000450: 7365 740d 0a66 726f 6d20 2e75 7469 6c73  set..from .utils
-00000460: 2069 6d70 6f72 7420 7265 6772 6573 7369   import regressi
-00000470: 6f6e 5f6d 6574 7269 6373 2c20 5f6f 6e65  on_metrics, _one
-00000480: 686f 740d 0a66 726f 6d20 636f 6c6c 6563  hot..from collec
-00000490: 7469 6f6e 7320 696d 706f 7274 2064 6566  tions import def
-000004a0: 6175 6c74 6469 6374 0d0a 0d0a 0d0a 6465  aultdict......de
-000004b0: 6620 756e 6971 7569 6679 2873 6571 293a  f uniquify(seq):
-000004c0: 0d0a 2020 2020 756e 203d 205b 5d0d 0a20  ..    un = [].. 
-000004d0: 2020 205b 756e 2e61 7070 656e 6428 6929     [un.append(i)
-000004e0: 2066 6f72 2069 2069 6e20 7365 7120 6966   for i in seq if
-000004f0: 206e 6f74 2075 6e2e 636f 756e 7428 6929   not un.count(i)
-00000500: 5d0d 0a20 2020 2072 6574 7572 6e20 756e  ]..    return un
-00000510: 0d0a 0d0a 0d0a 2320 2d2d 2d2d 2d20 4261  ......# ----- Ba
-00000520: 7365 206d 6f64 656c 202d 2d2d 2d2d 0d0a  se model -----..
-00000530: 2340 7466 2e6b 6572 6173 2e75 7469 6c73  #@tf.keras.utils
-00000540: 2e72 6567 6973 7465 725f 6b65 7261 735f  .register_keras_
-00000550: 7365 7269 616c 697a 6162 6c65 2870 6163  serializable(pac
-00000560: 6b61 6765 3d22 6d6d 6e65 666c 6f77 2229  kage="mmneflow")
-00000570: 0d0a 636c 6173 7320 4261 7365 4d6f 6465  ..class BaseMode
-00000580: 6c28 293a 0d0a 2020 2020 2222 2250 6172  l():..    """Par
-00000590: 656e 7420 636c 6173 7320 666f 7220 616c  ent class for al
-000005a0: 6c20 4d4e 4566 6c6f 7720 6d6f 6465 6c73  l MNEflow models
-000005b0: 2e0d 0a0d 0a20 2020 2050 726f 7669 6465  .....    Provide
-000005c0: 7320 6661 7374 2061 6e64 206d 656d 6f72  s fast and memor
-000005d0: 792d 6566 6669 6369 656e 7420 6461 7461  y-efficient data
-000005e0: 2068 616e 646c 696e 6720 616e 6420 7369   handling and si
-000005f0: 6d70 6c69 6669 6564 2041 5049 2e0d 0a20  mplified API... 
-00000600: 2020 2043 7573 746f 6d20 6d6f 6465 6c73     Custom models
-00000610: 2063 616e 2062 6520 6275 696c 7420 6279   can be built by
-00000620: 206f 7665 7272 6964 696e 6720 5f62 7569   overriding _bui
-00000630: 6c64 5f67 7261 7068 2061 6e64 0d0a 2020  ld_graph and..  
-00000640: 2020 5f73 6574 5f6f 7074 696d 697a 6572    _set_optimizer
-00000650: 206d 6574 686f 6473 2e0d 0a20 2020 2022   methods...    "
-00000660: 2222 0d0a 0d0a 2020 2020 6465 6620 5f5f  ""....    def __
-00000670: 696e 6974 5f5f 2873 656c 662c 206d 6574  init__(self, met
-00000680: 613d 4e6f 6e65 2c20 6461 7461 7365 743d  a=None, dataset=
-00000690: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
-000006a0: 2222 220d 0a20 2020 2020 2020 2050 6172  """..        Par
-000006b0: 616d 6574 6572 730d 0a20 2020 2020 2020  ameters..       
-000006c0: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
-000006d0: 2020 2020 2044 6174 6173 6574 203a 206d       Dataset : m
-000006e0: 6e65 666c 6f77 2e44 6174 6173 6574 0d0a  neflow.Dataset..
-000006f0: 2020 2020 2020 2020 2020 2020 6044 6174              `Dat
-00000700: 6173 6574 6020 6f62 6a65 6374 2e0d 0a0d  aset` object....
-00000710: 0a20 2020 2020 2020 2073 7065 6373 203a  .        specs :
-00000720: 2064 6963 740d 0a20 2020 2020 2020 2020   dict..         
-00000730: 2020 2044 6963 7469 6f6e 6172 7920 6f66     Dictionary of
-00000740: 206d 6f64 656c 2d73 7065 6369 6669 6320   model-specific 
-00000750: 6879 7065 7270 6172 616d 6574 6572 732e  hyperparameters.
-00000760: 204d 7573 7420 696e 636c 7564 650d 0a20   Must include.. 
-00000770: 2020 2020 2020 2020 2020 2061 7420 6c65             at le
-00000780: 6173 7420 606d 6f64 656c 5f70 6174 6860  ast `model_path`
-00000790: 202d 2070 6174 6820 666f 7220 7361 7669   - path for savi
-000007a0: 6e67 2061 2074 7261 696e 6564 206d 6f64  ng a trained mod
-000007b0: 656c 0d0a 2020 2020 2020 2020 2020 2020  el..            
-000007c0: 5365 6520 604d 6f64 656c 6020 7375 6263  See `Model` subc
-000007d0: 6c61 7373 2064 6566 696e 6974 696f 6e73  lass definitions
-000007e0: 2066 6f72 2064 6574 6169 6c73 2e20 556e   for details. Un
-000007f0: 6c65 7373 206f 7468 6572 7769 7365 0d0a  less otherwise..
-00000800: 2020 2020 2020 2020 2020 2020 7370 6563              spec
-00000810: 6966 6965 6420 7573 6573 2064 6566 6175  ified uses defau
-00000820: 6c74 2068 7970 6572 7061 7261 6d65 7465  lt hyperparamete
-00000830: 7273 2066 6f72 2065 6163 6820 696d 706c  rs for each impl
-00000840: 656d 656e 7465 6420 6d6f 6465 6c2e 0d0a  emented model...
-00000850: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00000860: 2020 2020 2073 656c 662e 7370 6563 7320       self.specs 
-00000870: 3d20 6d65 7461 2e6d 6f64 656c 5f73 7065  = meta.model_spe
-00000880: 6373 0d0a 2020 2020 2020 2020 6d65 7461  cs..        meta
-00000890: 2e6d 6f64 656c 5f73 7065 6373 5b27 6d6f  .model_specs['mo
-000008a0: 6465 6c5f 7061 7468 275d 203d 206f 732e  del_path'] = os.
-000008b0: 7061 7468 2e6a 6f69 6e28 6d65 7461 2e64  path.join(meta.d
-000008c0: 6174 615b 2770 6174 6827 5d2c 200d 0a20  ata['path'], .. 
-000008d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000008e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000008f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000900: 2020 2020 2027 6d6f 6465 6c73 2729 2020       'models')  
-00000910: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00000920: 2020 2020 7365 6c66 2e6d 6574 6120 3d20      self.meta = 
-00000930: 6d65 7461 0d0a 2020 2020 2020 2020 7365  meta..        se
-00000940: 6c66 2e6d 6f64 656c 5f70 6174 6820 3d20  lf.model_path = 
-00000950: 6f73 2e70 6174 682e 6a6f 696e 286d 6574  os.path.join(met
-00000960: 612e 6461 7461 5b27 7061 7468 275d 2c20  a.data['path'], 
-00000970: 276d 6f64 656c 735c 5c27 290d 0a20 2020  'models\\')..   
-00000980: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
-00000990: 6174 682e 6578 6973 7473 2873 656c 662e  ath.exists(self.
-000009a0: 6d6f 6465 6c5f 7061 7468 293a 0d0a 2020  model_path):..  
-000009b0: 2020 2020 2020 2020 2020 6f73 2e6d 6b64            os.mkd
-000009c0: 6972 2873 656c 662e 6d6f 6465 6c5f 7061  ir(self.model_pa
-000009d0: 7468 2920 2020 2020 2020 2020 2020 200d  th)            .
-000009e0: 0a20 2020 2020 2020 200d 0a0d 0a20 2020  .        ....   
-000009f0: 2020 2020 2069 6620 6e6f 7420 6461 7461       if not data
-00000a00: 7365 7420 616e 6420 6d65 7461 3a0d 0a20  set and meta:.. 
-00000a10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00000a20: 6461 7461 7365 7420 3d20 4461 7461 7365  dataset = Datase
-00000a30: 7428 6d65 7461 2c0d 0a20 2020 2020 2020  t(meta,..       
-00000a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000a50: 2020 2020 2020 2020 2020 2a2a 6d65 7461            **meta
-00000a60: 2e64 6174 610d 0a20 2020 2020 2020 2020  .data..         
-00000a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000a80: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00000a90: 2020 2065 6c69 6620 6461 7461 7365 743a     elif dataset:
-00000aa0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00000ab0: 6c66 2e64 6174 6173 6574 203d 2064 6174  lf.dataset = dat
-00000ac0: 6173 6574 0d0a 2020 2020 2020 2020 656c  aset..        el
-00000ad0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00000ae0: 2070 7269 6e74 2822 5072 6f76 6964 6520   print("Provide 
-00000af0: 4461 7461 7365 7420 6f74 204d 6574 6164  Dataset ot Metad
-00000b00: 6174 6120 6669 6c65 2229 0d0a 0d0a 2020  ata file")....  
-00000b10: 2020 2020 2020 7365 6c66 2e69 6e70 7574        self.input
-00000b20: 5f73 6861 7065 203d 2028 7365 6c66 2e64  _shape = (self.d
-00000b30: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
-00000b40: 276e 5f73 6571 275d 2c0d 0a20 2020 2020  'n_seq'],..     
-00000b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000b60: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
-00000b70: 7365 742e 685f 7061 7261 6d73 5b27 6e5f  set.h_params['n_
-00000b80: 7427 5d2c 0d0a 2020 2020 2020 2020 2020  t'],..          
-00000b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000ba0: 2020 7365 6c66 2e64 6174 6173 6574 2e68    self.dataset.h
-00000bb0: 5f70 6172 616d 735b 276e 5f63 6827 5d29  _params['n_ch'])
-00000bc0: 0d0a 2020 2020 2020 2020 7365 6c66 2e79  ..        self.y
-00000bd0: 5f73 6861 7065 203d 2073 656c 662e 6461  _shape = self.da
-00000be0: 7461 7365 742e 795f 7368 6170 650d 0a20  taset.y_shape.. 
-00000bf0: 2020 2020 2020 2073 656c 662e 6f75 745f         self.out_
-00000c00: 6469 6d20 3d20 6e70 2e70 726f 6428 7365  dim = np.prod(se
-00000c10: 6c66 2e79 5f73 6861 7065 290d 0a0d 0a0d  lf.y_shape).....
-00000c20: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-00000c30: 7075 7473 203d 206c 6179 6572 732e 496e  puts = layers.In
-00000c40: 7075 7428 7368 6170 653d 2873 656c 662e  put(shape=(self.
-00000c50: 696e 7075 745f 7368 6170 6529 290d 0a20  input_shape)).. 
-00000c60: 2020 2020 2020 2073 656c 662e 7472 6169         self.trai
-00000c70: 6e65 6420 3d20 4661 6c73 650d 0a20 2020  ned = False..   
-00000c80: 2020 2020 2073 656c 662e 795f 7072 6564       self.y_pred
-00000c90: 203d 2073 656c 662e 6275 696c 645f 6772   = self.build_gr
-00000ca0: 6170 6828 290d 0a20 2020 2020 2020 2073  aph()..        s
-00000cb0: 656c 662e 6c6f 6720 3d20 6469 6374 2829  elf.log = dict()
-00000cc0: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00000cd0: 6d20 3d20 6e70 2e7a 6572 6f73 285b 7365  m = np.zeros([se
-00000ce0: 6c66 2e79 5f73 6861 7065 5b2d 315d 2c20  lf.y_shape[-1], 
-00000cf0: 7365 6c66 2e79 5f73 6861 7065 5b2d 315d  self.y_shape[-1]
-00000d00: 5d29 0d0a 2020 2020 2020 2020 7365 6c66  ])..        self
-00000d10: 2e63 765f 7061 7474 6572 6e73 203d 2064  .cv_patterns = d
-00000d20: 6566 6175 6c74 6469 6374 2864 6963 7429  efaultdict(dict)
-00000d30: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00000d40: 2068 6173 6174 7472 2873 656c 662c 2027   hasattr(self, '
-00000d50: 7363 6f70 6527 293a 0d0a 2020 2020 2020  scope'):..      
-00000d60: 2020 2020 2020 7365 6c66 2e73 636f 7065        self.scope
-00000d70: 203d 2027 6261 7365 6d6f 6465 6c27 0d0a   = 'basemodel'..
-00000d80: 0d0a 0d0a 0d0a 2020 2020 2320 4063 6c61  ......    # @cla
-00000d90: 7373 6d65 7468 6f64 0d0a 2020 2020 2320  ssmethod..    # 
-00000da0: 6465 6620 6672 6f6d 5f63 6f6e 6669 6728  def from_config(
-00000db0: 636c 732c 2063 6f6e 6669 6729 3a0d 0a20  cls, config):.. 
-00000dc0: 2020 2023 2020 2020 2072 6574 7572 6e20     #     return 
-00000dd0: 636c 7328 2a2a 636f 6e66 6967 290d 0a0d  cls(**config)...
-00000de0: 0a20 2020 2023 2064 6566 2067 6574 5f63  .    # def get_c
-00000df0: 6f6e 6669 6728 7365 6c66 293a 0d0a 2020  onfig(self):..  
-00000e00: 2020 2320 2020 2020 636f 6e66 6967 203d    #     config =
-00000e10: 207b 0d0a 2020 2020 2320 2020 2020 2020   {..    #       
-00000e20: 2020 2266 6322 3a20 7365 6c66 2e66 630d    "fc": self.fc.
-00000e30: 0a20 2020 2023 2020 2020 207d 0d0a 2020  .    #     }..  
-00000e40: 2020 2320 2020 2020 7265 7475 726e 2063    #     return c
-00000e50: 6f6e 6669 670d 0a0d 0a0d 0a0d 0a20 2020  onfig........   
-00000e60: 2064 6566 2062 7569 6c64 2873 656c 662c   def build(self,
-00000e70: 206f 7074 696d 697a 6572 3d22 6164 616d   optimizer="adam
-00000e80: 222c 206c 6f73 733d 4e6f 6e65 2c20 6d65  ", loss=None, me
-00000e90: 7472 6963 733d 4e6f 6e65 2c20 6d61 7070  trics=None, mapp
-00000ea0: 696e 673d 4e6f 6e65 2c0d 0a20 2020 2020  ing=None,..     
-00000eb0: 2020 2020 2020 2020 206c 6561 726e 5f72           learn_r
-00000ec0: 6174 653d 3365 2d34 293a 0d0a 2020 2020  ate=3e-4):..    
-00000ed0: 2020 2020 2222 2243 6f6d 7069 6c65 2061      """Compile a
-00000ee0: 206d 6f64 656c 2e0d 0a0d 0a20 2020 2020   model.....     
-00000ef0: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
-00000f00: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00000f10: 2d0d 0a20 2020 2020 2020 206f 7074 696d  -..        optim
-00000f20: 697a 6572 203a 2073 7472 2c20 7466 2e6f  izer : str, tf.o
-00000f30: 7074 696d 697a 6572 732e 4f70 7469 6d69  ptimizers.Optimi
-00000f40: 7a65 720d 0a20 2020 2020 2020 2020 2020  zer..           
-00000f50: 2044 6561 6675 6c74 7320 746f 2022 6164   Deafults to "ad
-00000f60: 616d 220d 0a0d 0a20 2020 2020 2020 206c  am"....        l
-00000f70: 6f73 7320 3a20 7374 722c 2074 662e 6b65  oss : str, tf.ke
-00000f80: 7261 732e 6c6f 7373 6573 2e4c 6f73 730d  ras.losses.Loss.
-00000f90: 0a20 2020 2020 2020 2020 2020 2044 6566  .            Def
-00000fa0: 6175 6c74 7320 746f 204d 5345 2069 6e20  aults to MSE in 
-00000fb0: 7461 7267 6574 5f74 7970 6520 6973 2022  target_type is "
-00000fc0: 666c 6f61 7422 2061 6e64 0d0a 2020 2020  float" and..    
-00000fd0: 2020 2020 2020 2020 2273 6f66 746d 6178          "softmax
-00000fe0: 5f63 726f 7373 656e 7472 6f70 7922 2069  _crossentropy" i
-00000ff0: 6620 2274 6172 6765 745f 7479 7065 2220  f "target_type" 
-00001000: 6973 2069 6e74 0d0a 0d0a 2020 2020 2020  is int....      
-00001010: 2020 6d65 7472 6963 7320 3a20 7374 722c    metrics : str,
-00001020: 2074 662e 6b65 7261 732e 6d65 7472 6963   tf.keras.metric
-00001030: 732e 4d65 7472 6963 0d0a 2020 2020 2020  s.Metric..      
-00001040: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
-00001050: 6f20 524d 5345 2069 6e20 7461 7267 6574  o RMSE in target
-00001060: 5f74 7970 6520 6973 2022 666c 6f61 7422  _type is "float"
-00001070: 2061 6e64 0d0a 2020 2020 2020 2020 2020   and..          
-00001080: 2020 2020 2020 2263 6174 6567 6f72 6963        "categoric
-00001090: 616c 5f61 6363 7572 6163 7922 2069 6620  al_accuracy" if 
-000010a0: 2274 6172 6765 745f 7479 7065 2220 6973  "target_type" is
-000010b0: 2069 6e74 0d0a 0d0a 2020 2020 2020 2020   int....        
-000010c0: 6c65 6172 6e5f 7261 7465 203a 2066 6c6f  learn_rate : flo
-000010d0: 6174 0d0a 2020 2020 2020 2020 2020 2020  at..            
-000010e0: 4c65 6172 6e69 6e67 2072 6174 652c 2064  Learning rate, d
-000010f0: 6566 6175 6c74 7320 746f 2033 652d 340d  efaults to 3e-4.
-00001100: 0a0d 0a20 2020 2020 2020 206d 6170 7069  ...        mappi
-00001110: 6e67 203a 2073 7472 0d0a 0d0a 2020 2020  ng : str....    
-00001120: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00001130: 2023 2049 6e69 7469 616c 697a 6520 636f   # Initialize co
-00001140: 6d70 7574 6174 696f 6e61 6c20 6772 6170  mputational grap
-00001150: 680d 0a20 2020 2020 2020 2069 6620 6d61  h..        if ma
-00001160: 7070 696e 673a 0d0a 2020 2020 2020 2020  pping:..        
-00001170: 2020 2020 6d61 705f 6675 6e20 3d20 7466      map_fun = tf
-00001180: 2e6b 6572 6173 2e61 6374 6976 6174 696f  .keras.activatio
-00001190: 6e73 2e67 6574 286d 6170 7069 6e67 290d  ns.get(mapping).
-000011a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000011b0: 662e 795f 7072 6564 3d20 6d61 705f 6675  f.y_pred= map_fu
-000011c0: 6e28 7365 6c66 2e79 5f70 7265 6429 0d0a  n(self.y_pred)..
-000011d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e6b  ..        self.k
-000011e0: 6d20 3d20 7466 2e6b 6572 6173 2e4d 6f64  m = tf.keras.Mod
-000011f0: 656c 2869 6e70 7574 733d 7365 6c66 2e69  el(inputs=self.i
-00001200: 6e70 7574 732c 206f 7574 7075 7473 3d73  nputs, outputs=s
-00001210: 656c 662e 795f 7072 6564 290d 0a0d 0a20  elf.y_pred).... 
-00001220: 2020 2020 2020 2073 656c 662e 7061 7261         self.para
-00001230: 6d73 203d 207b 226f 7074 696d 697a 6572  ms = {"optimizer
-00001240: 223a 2074 662e 6f70 7469 6d69 7a65 7273  ": tf.optimizers
-00001250: 2e67 6574 286f 7074 696d 697a 6572 292e  .get(optimizer).
-00001260: 6672 6f6d 5f63 6f6e 6669 6728 0d0a 2020  from_config(..  
-00001270: 2020 2020 2020 2020 2020 7b22 6c65 6172            {"lear
-00001280: 6e69 6e67 5f72 6174 6522 3a6c 6561 726e  ning_rate":learn
-00001290: 5f72 6174 657d 297d 0d0a 0d0a 2020 2020  _rate})}....    
-000012a0: 2020 2020 6966 206c 6f73 733a 0d0a 2020      if loss:..  
-000012b0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-000012c0: 6172 616d 735b 226c 6f73 7322 5d20 3d20  arams["loss"] = 
-000012d0: 7466 2e6b 6572 6173 2e6c 6f73 7365 732e  tf.keras.losses.
-000012e0: 6765 7428 6c6f 7373 290d 0a0d 0a20 2020  get(loss)....   
-000012f0: 2020 2020 2069 6620 6d65 7472 6963 733a       if metrics:
-00001300: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00001310: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00001320: 6d65 7472 6963 732c 206c 6973 7429 3a0d  metrics, list):.
-00001330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001340: 206d 6574 7269 6373 203d 205b 6d65 7472   metrics = [metr
-00001350: 6963 735d 0d0a 2020 2020 2020 2020 2020  ics]..          
-00001360: 2020 7365 6c66 2e70 6172 616d 735b 226d    self.params["m
-00001370: 6574 7269 6373 225d 203d 205b 7466 2e6b  etrics"] = [tf.k
-00001380: 6572 6173 2e6d 6574 7269 6373 2e67 6574  eras.metrics.get
-00001390: 286d 6574 7269 6329 2066 6f72 206d 6574  (metric) for met
-000013a0: 7269 6320 696e 206d 6574 7269 6373 5d0d  ric in metrics].
-000013b0: 0a0d 0a20 2020 2020 2020 2023 0d0a 2020  ...        #..  
-000013c0: 2020 2020 2020 2373 656c 662e 7370 6563        #self.spec
-000013d0: 732e 7365 7464 6566 6175 6c74 2827 756e  s.setdefault('un
-000013e0: 6974 6e6f 726d 5f73 636f 7065 272c 205b  itnorm_scope', [
-000013f0: 5d29 0d0a 2020 2020 2020 2023 2049 6e69  ])..       # Ini
-00001400: 7469 616c 697a 6520 6f70 7469 6d69 7a65  tialize optimize
-00001410: 720d 0a20 2020 2020 2020 2069 6620 7365  r..        if se
-00001420: 6c66 2e64 6174 6173 6574 2e68 5f70 6172  lf.dataset.h_par
-00001430: 616d 735b 2274 6172 6765 745f 7479 7065  ams["target_type
-00001440: 225d 2069 6e20 5b27 666c 6f61 7427 2c20  "] in ['float', 
-00001450: 2773 6967 6e61 6c27 5d3a 0d0a 2020 2020  'signal']:..    
-00001460: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
-00001470: 616d 732e 7365 7464 6566 6175 6c74 2822  ams.setdefault("
-00001480: 6c6f 7373 222c 2074 662e 6b65 7261 732e  loss", tf.keras.
-00001490: 6c6f 7373 6573 2e4d 6561 6e53 7175 6172  losses.MeanSquar
-000014a0: 6564 4572 726f 7228 6e61 6d65 3d27 4d53  edError(name='MS
-000014b0: 4527 2929 0d0a 2020 2020 2020 2020 2020  E'))..          
-000014c0: 2020 7365 6c66 2e70 6172 616d 732e 7365    self.params.se
-000014d0: 7464 6566 6175 6c74 2822 6d65 7472 6963  tdefault("metric
-000014e0: 7322 2c20 7466 2e6b 6572 6173 2e6d 6574  s", tf.keras.met
-000014f0: 7269 6373 2e52 6f6f 744d 6561 6e53 7175  rics.RootMeanSqu
-00001500: 6172 6564 4572 726f 7228 6e61 6d65 3d22  aredError(name="
-00001510: 524d 5345 2229 290d 0a0d 0a20 2020 2020  RMSE"))....     
-00001520: 2020 2065 6c69 6620 7365 6c66 2e64 6174     elif self.dat
-00001530: 6173 6574 2e68 5f70 6172 616d 735b 2274  aset.h_params["t
-00001540: 6172 6765 745f 7479 7065 225d 2069 6e20  arget_type"] in 
-00001550: 5b27 696e 7427 5d3a 0d0a 2020 2020 2020  ['int']:..      
-00001560: 2020 2020 2020 7365 6c66 2e70 6172 616d        self.param
-00001570: 732e 7365 7464 6566 6175 6c74 2822 6c6f  s.setdefault("lo
-00001580: 7373 222c 205b 7466 2e6b 6572 6173 2e6c  ss", [tf.keras.l
-00001590: 6f73 7365 732e 4361 7465 676f 7269 6361  osses.Categorica
-000015a0: 6c43 726f 7373 656e 7472 6f70 7928 6672  lCrossentropy(fr
-000015b0: 6f6d 5f6c 6f67 6974 733d 5472 7565 2c0d  om_logits=True,.
-000015c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000015d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000015e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000015f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001610: 2020 2020 6e61 6d65 3d27 6363 6527 295d      name='cce')]
-00001620: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00001630: 656c 662e 7061 7261 6d73 2e73 6574 6465  elf.params.setde
-00001640: 6661 756c 7428 226d 6574 7269 6373 222c  fault("metrics",
-00001650: 205b 7466 2e6b 6572 6173 2e6d 6574 7269   [tf.keras.metri
-00001660: 6373 2e43 6174 6567 6f72 6963 616c 4163  cs.CategoricalAc
-00001670: 6375 7261 6379 286e 616d 653d 2263 6174  curacy(name="cat
-00001680: 5f41 4343 2229 5d29 0d0a 0d0a 2020 2020  _ACC")])....    
-00001690: 2020 2020 7365 6c66 2e6b 6d2e 636f 6d70      self.km.comp
-000016a0: 696c 6528 6f70 7469 6d69 7a65 723d 7365  ile(optimizer=se
-000016b0: 6c66 2e70 6172 616d 735b 226f 7074 696d  lf.params["optim
-000016c0: 697a 6572 225d 2c0d 0a20 2020 2020 2020  izer"],..       
-000016d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000016e0: 206c 6f73 733d 7365 6c66 2e70 6172 616d   loss=self.param
-000016f0: 735b 226c 6f73 7322 5d2c 0d0a 2020 2020  s["loss"],..    
-00001700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001710: 2020 2020 6d65 7472 6963 733d 7365 6c66      metrics=self
-00001720: 2e70 6172 616d 735b 226d 6574 7269 6373  .params["metrics
-00001730: 225d 290d 0a0d 0a0d 0a20 2020 2020 2020  "])......       
-00001740: 2070 7269 6e74 2827 496e 7075 7420 7368   print('Input sh
-00001750: 6170 653a 272c 2073 656c 662e 696e 7075  ape:', self.inpu
-00001760: 745f 7368 6170 6529 0d0a 2020 2020 2020  t_shape)..      
-00001770: 2020 7072 696e 7428 2779 5f70 7265 643a    print('y_pred:
-00001780: 272c 2073 656c 662e 795f 7072 6564 2e73  ', self.y_pred.s
-00001790: 6861 7065 290d 0a20 2020 2020 2020 2070  hape)..        p
-000017a0: 7269 6e74 2827 496e 6974 6961 6c69 7a61  rint('Initializa
-000017b0: 7469 6f6e 2063 6f6d 706c 6574 6521 2729  tion complete!')
-000017c0: 0d0a 0d0a 2020 2020 6465 6620 6275 696c  ....    def buil
-000017d0: 645f 6772 6170 6828 7365 6c66 293a 0d0a  d_graph(self):..
-000017e0: 2020 2020 2020 2020 2222 2242 7569 6c64          """Build
-000017f0: 2063 6f6d 7075 7461 7469 6f6e 616c 2067   computational g
-00001800: 7261 7068 2075 7369 6e67 2064 6566 696e  raph using defin
-00001810: 6564 2070 6c61 6365 686f 6c64 6572 2073  ed placeholder s
-00001820: 656c 662e 580d 0a20 2020 2020 2020 2061  elf.X..        a
-00001830: 7320 696e 7075 742e 0d0a 0d0a 2020 2020  s input.....    
-00001840: 2020 2020 4361 6e20 6265 206f 7665 7272      Can be overr
-00001850: 6964 656e 2069 6e20 6120 7375 622d 636c  iden in a sub-cl
-00001860: 6173 7320 666f 7220 6375 7374 6f6d 697a  ass for customiz
-00001870: 6564 2061 7263 6869 7465 6374 7572 652e  ed architecture.
-00001880: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
-00001890: 726e 730d 0a20 2020 2020 2020 202d 2d2d  rns..        ---
-000018a0: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2079  -----..        y
-000018b0: 5f70 7265 6420 3a20 7466 2e54 656e 736f  _pred : tf.Tenso
-000018c0: 720d 0a20 2020 2020 2020 2020 2020 204f  r..            O
-000018d0: 7574 7075 7420 6f66 2074 6865 2066 6f72  utput of the for
-000018e0: 7761 7264 2070 6173 7320 6f66 2074 6865  ward pass of the
-000018f0: 2063 6f6d 7075 7461 7469 6f6e 616c 2067   computational g
-00001900: 7261 7068 2e0d 0a20 2020 2020 2020 2020  raph...         
-00001910: 2020 2050 7265 6469 6374 696f 6e20 6f66     Prediction of
-00001920: 2074 6865 2074 6172 6765 7420 7661 7269   the target vari
-00001930: 6162 6c65 2e0d 0a20 2020 2020 2020 2022  able...        "
-00001940: 2222 0d0a 0d0a 2020 2020 2020 2020 666c  ""....        fl
-00001950: 6174 203d 2046 6c61 7474 656e 2829 2873  at = Flatten()(s
-00001960: 656c 662e 696e 7075 7473 290d 0a20 2020  elf.inputs)..   
-00001970: 2020 2020 2073 656c 662e 6663 203d 2046       self.fc = F
-00001980: 756c 6c79 436f 6e6e 6563 7465 6428 7369  ullyConnected(si
-00001990: 7a65 3d73 656c 662e 6f75 745f 6469 6d2c  ze=self.out_dim,
-000019a0: 206e 6f6e 6c69 6e3d 7466 2e69 6465 6e74   nonlin=tf.ident
-000019b0: 6974 792c 0d0a 2020 2020 2020 2020 2020  ity,..          
-000019c0: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-000019d0: 6563 733d 7365 6c66 2e73 7065 6373 290d  ecs=self.specs).
-000019e0: 0a20 2020 2020 2020 2079 5f70 7265 6420  .        y_pred 
-000019f0: 3d20 7365 6c66 2e66 6328 666c 6174 290d  = self.fc(flat).
-00001a00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00001a10: 795f 7072 6564 0d0a 0d0a 0d0a 2020 2020  y_pred......    
-00001a20: 6465 6620 7472 6169 6e28 7365 6c66 2c20  def train(self, 
-00001a30: 6e5f 6570 6f63 6873 3d31 302c 2065 7661  n_epochs=10, eva
-00001a40: 6c5f 7374 6570 3d4e 6f6e 652c 206d 696e  l_step=None, min
-00001a50: 5f64 656c 7461 3d31 652d 362c 0d0a 2020  _delta=1e-6,..  
-00001a60: 2020 2020 2020 2020 2020 2020 6561 726c              earl
-00001a70: 795f 7374 6f70 7069 6e67 3d33 2c20 6d6f  y_stopping=3, mo
-00001a80: 6465 3d27 7369 6e67 6c65 5f66 6f6c 6427  de='single_fold'
-00001a90: 2c20 7072 756e 655f 7765 6967 6874 733d  , prune_weights=
-00001aa0: 4661 6c73 652c 0d0a 2020 2020 2020 2020  False,..        
-00001ab0: 2020 2020 2020 636f 6c6c 6563 745f 7061        collect_pa
-00001ac0: 7474 6572 6e73 203d 2046 616c 7365 2c20  tterns = False, 
-00001ad0: 636c 6173 735f 7765 6967 6874 7320 3d20  class_weights = 
-00001ae0: 4e6f 6e65 2920 3a0d 0a0d 0a20 2020 2020  None) :....     
-00001af0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00001b00: 5472 6169 6e20 6120 6d6f 6465 6c0d 0a0d  Train a model...
-00001b10: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00001b20: 6572 730d 0a20 2020 2020 2020 202d 2d2d  ers..        ---
-00001b30: 2d2d 2d2d 2d2d 2d2d 0d0a 0d0a 2020 2020  --------....    
-00001b40: 2020 2020 6e5f 6570 6f63 6873 203a 2069      n_epochs : i
-00001b50: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
-00001b60: 4d61 7869 6d75 6d20 6e75 6d62 6572 206f  Maximum number o
-00001b70: 6620 7472 6169 6e69 6e67 2065 6f70 6368  f training eopch
-00001b80: 732e 0d0a 0d0a 2020 2020 2020 2020 6576  s.....        ev
-00001b90: 616c 5f73 7465 7020 3a20 696e 742c 204e  al_step : int, N
-00001ba0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-00001bb0: 2069 7465 7261 7469 6f6e 7320 7065 7220   iterations per 
-00001bc0: 6570 6f63 682e 2049 6620 4e6f 6e65 2065  epoch. If None e
-00001bd0: 6163 6820 6570 6f63 6820 7061 7373 6573  ach epoch passes
-00001be0: 2074 6865 2074 7261 696e 696e 6720 7365   the training se
-00001bf0: 740d 0a20 2020 2020 2020 2020 2020 2065  t..            e
-00001c00: 7861 6374 6c79 206f 6e63 650d 0a0d 0a20  xactly once.... 
-00001c10: 2020 2020 2020 2065 6172 6c79 5f73 746f         early_sto
-00001c20: 7070 696e 6720 3a20 696e 740d 0a20 2020  pping : int..   
-00001c30: 2020 2020 2020 2020 2050 6174 6965 6e63           Patienc
-00001c40: 6520 7061 7261 6d65 7465 7220 666f 7220  e parameter for 
-00001c50: 6561 726c 7920 7374 6f70 7069 6e67 2e20  early stopping. 
-00001c60: 5370 6563 6966 6965 7320 7468 6520 6e75  Specifies the nu
-00001c70: 6d62 6572 0d0a 2020 2020 2020 2020 2020  mber..          
-00001c80: 2020 6f66 2065 706f 6368 7327 7320 6475    of epochs's du
-00001c90: 7269 6e67 2077 6869 6368 2076 616c 6964  ring which valid
-00001ca0: 6174 696f 6e20 636f 7374 2069 7320 616c  ation cost is al
-00001cb0: 6c6f 7765 6420 746f 0d0a 2020 2020 2020  lowed to..      
-00001cc0: 2020 2020 2020 7269 7365 2062 6566 6f72        rise befor
-00001cd0: 6520 7472 6169 6e69 6e67 2073 746f 7073  e training stops
-00001ce0: 2e0d 0a0d 0a20 2020 2020 2020 206d 696e  .....        min
-00001cf0: 5f64 656c 7461 203a 2066 6c6f 6174 2c20  _delta : float, 
-00001d00: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
-00001d10: 2020 2020 2020 436f 6e76 6572 6765 6e63        Convergenc
-00001d20: 6520 7468 7265 7368 6f6c 6420 666f 7220  e threshold for 
-00001d30: 7661 6c69 6461 7469 6f6e 2063 6f73 7420  validation cost 
-00001d40: 6475 7269 6e67 2074 7261 696e 696e 672e  during training.
-00001d50: 0d0a 2020 2020 2020 2020 2020 2020 4465  ..            De
-00001d60: 6661 756c 7473 2074 6f20 3165 2d36 2e0d  faults to 1e-6..
-00001d70: 0a0d 0a20 2020 2020 2020 206d 6f64 6520  ...        mode 
-00001d80: 3a20 7374 722c 206f 7074 696f 6e61 6c0d  : str, optional.
-00001d90: 0a20 2020 2020 2020 2020 2020 2063 616e  .            can
-00001da0: 2062 6520 2773 696e 676c 655f 666f 6c64   be 'single_fold
-00001db0: 272c 2027 6376 272c 2027 6c6f 736f 272e  ', 'cv', 'loso'.
-00001dc0: 2044 6566 6175 6c74 7320 746f 2027 7369   Defaults to 'si
-00001dd0: 6e67 6c65 5f66 6f6c 6427 0d0a 0d0a 2020  ngle_fold'....  
-00001de0: 2020 2020 2020 636f 6c6c 6563 745f 7061        collect_pa
-00001df0: 7474 6572 6e73 203a 2062 6f6f 6c0d 0a20  tterns : bool.. 
-00001e00: 2020 2020 2020 2020 2020 2057 6865 7468             Wheth
-00001e10: 6572 2074 6f20 636f 6d70 7574 6520 616e  er to compute an
-00001e20: 6420 7374 6f72 6520 7061 7474 6572 6e73  d store patterns
-00001e30: 2061 6674 6572 2074 7261 696e 696e 6720   after training 
-00001e40: 6561 6368 2066 6f6c 642e 0d0a 0d0a 2020  each fold.....  
-00001e50: 2020 2020 2020 636c 6173 735f 7765 6967        class_weig
-00001e60: 6874 7320 3a20 4e6f 6e65 2c20 6469 6374  hts : None, dict
-00001e70: 0d0a 2020 2020 2020 2020 2020 2020 5768  ..            Wh
-00001e80: 6574 6865 7220 746f 2061 7070 6c79 2063  ether to apply c
-00001e90: 7574 6f6d 2077 6567 6968 7473 2066 726f  utom wegihts fro
-00001ea0: 2065 6163 6820 636c 6173 730d 0a20 2020   each class..   
-00001eb0: 2020 2020 2022 2222 0d0a 0d0a 2020 2020       """....    
-00001ec0: 2020 2020 0d0a 2020 2020 2020 2020 6966      ..        if
-00001ed0: 206e 6f74 2065 7661 6c5f 7374 6570 3a0d   not eval_step:.
-00001ee0: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
-00001ef0: 696e 5f73 697a 6520 3d20 7365 6c66 2e64  in_size = self.d
-00001f00: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
-00001f10: 2774 7261 696e 5f73 697a 6527 5d0d 0a20  'train_size'].. 
-00001f20: 2020 2020 2020 2020 2020 2065 7661 6c5f             eval_
-00001f30: 7374 6570 203d 2074 7261 696e 5f73 697a  step = train_siz
-00001f40: 6520 2f2f 2073 656c 662e 6461 7461 7365  e // self.datase
-00001f50: 742e 685f 7061 7261 6d73 5b27 7472 6169  t.h_params['trai
-00001f60: 6e5f 6261 7463 6827 5d20 2b20 310d 0a20  n_batch'] + 1.. 
-00001f70: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00001f80: 2073 656c 662e 7472 6169 6e5f 7061 7261   self.train_para
-00001f90: 6d73 203d 2064 6963 7428 6e5f 6570 6f63  ms = dict(n_epoc
-00001fa0: 6873 3d6e 5f65 706f 6368 732c 200d 0a20  hs=n_epochs, .. 
-00001fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001fd0: 6576 616c 5f73 7465 703d 6576 616c 5f73  eval_step=eval_s
-00001fe0: 7465 702c 200d 0a20 2020 2020 2020 2020  tep, ..         
-00001ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002000: 2020 2020 2020 2020 6561 726c 795f 7374          early_st
-00002010: 6f70 7069 6e67 3d65 6172 6c79 5f73 746f  opping=early_sto
-00002020: 7070 696e 672c 200d 0a20 2020 2020 2020  pping, ..       
-00002030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002040: 2020 2020 2020 2020 2020 6d6f 6465 3d6d            mode=m
-00002050: 6f64 6529 0d0a 2020 2020 2020 2020 7365  ode)..        se
-00002060: 6c66 2e6d 6574 612e 7570 6461 7465 2874  lf.meta.update(t
-00002070: 7261 696e 5f70 6172 616d 733d 7365 6c66  rain_params=self
-00002080: 2e74 7261 696e 5f70 6172 616d 7329 0d0a  .train_params)..
-00002090: 2020 2020 2020 2020 7374 6f70 5f65 6172          stop_ear
-000020a0: 6c79 203d 2074 662e 6b65 7261 732e 6361  ly = tf.keras.ca
-000020b0: 6c6c 6261 636b 732e 4561 726c 7953 746f  llbacks.EarlySto
-000020c0: 7070 696e 6728 6d6f 6e69 746f 723d 2776  pping(monitor='v
-000020d0: 616c 5f6c 6f73 7327 2c0d 0a20 2020 2020  al_loss',..     
-000020e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000020f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002110: 206d 696e 5f64 656c 7461 3d6d 696e 5f64   min_delta=min_d
-00002120: 656c 7461 2c0d 0a20 2020 2020 2020 2020  elta,..         
-00002130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002150: 2020 2020 2020 2020 2020 2020 2070 6174               pat
-00002160: 6965 6e63 653d 7365 6c66 2e6d 6574 612e  ience=self.meta.
-00002170: 7472 6169 6e5f 7061 7261 6d73 5b27 6561  train_params['ea
-00002180: 726c 795f 7374 6f70 7069 6e67 275d 2c0d  rly_stopping'],.
-00002190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000021a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000021b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000021c0: 2020 2020 2020 2072 6573 746f 7265 5f62         restore_b
-000021d0: 6573 745f 7765 6967 6874 733d 5472 7565  est_weights=True
-000021e0: 290d 0a20 2020 2020 2020 2072 6d73 7320  )..        rmss 
-000021f0: 3d20 6465 6661 756c 7464 6963 7428 6c69  = defaultdict(li
-00002200: 7374 290d 0a20 2020 2020 2020 2073 656c  st)..        sel
-00002210: 662e 6376 5f6c 6f73 7365 7320 3d20 5b5d  f.cv_losses = []
-00002220: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00002230: 765f 6d65 7472 6963 7320 3d20 5b5d 0d0a  v_metrics = []..
-00002240: 2020 2020 2020 2020 7365 6c66 2e63 765f          self.cv_
-00002250: 7465 7374 5f6c 6f73 7365 7320 3d20 5b5d  test_losses = []
-00002260: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00002270: 765f 7465 7374 5f6d 6574 7269 6373 203d  v_test_metrics =
-00002280: 205b 5d0d 0a0d 0a20 2020 2020 2020 2069   []....        i
-00002290: 6620 636c 6173 735f 7765 6967 6874 733a  f class_weights:
-000022a0: 0d0a 2020 2020 2020 2020 2020 2020 6d75  ..            mu
-000022b0: 6c74 6970 6c69 6572 203d 2031 2e20 2f20  ltiplier = 1. / 
-000022c0: 6d69 6e28 636c 6173 735f 7765 6967 6874  min(class_weight
-000022d0: 732e 7661 6c75 6573 2829 290d 0a20 2020  s.values())..   
-000022e0: 2020 2020 2020 2020 2063 6c61 7373 5f77           class_w
-000022f0: 6569 6768 7473 203d 207b 6b3a 762a 6d75  eights = {k:v*mu
-00002300: 6c74 6970 6c69 6572 2066 6f72 206b 2c76  ltiplier for k,v
-00002310: 2069 6e20 636c 6173 735f 7765 6967 6874   in class_weight
-00002320: 732e 6974 656d 7328 297d 0d0a 0d0a 2020  s.items()}....  
-00002330: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00002340: 2020 2020 2020 2020 2063 6c61 7373 5f77           class_w
-00002350: 6569 6768 7473 203d 204e 6f6e 650d 0a20  eights = None.. 
-00002360: 2020 2020 2020 2070 7269 6e74 2822 436c         print("Cl
-00002370: 6173 7320 7765 6967 6874 733a 2022 2c20  ass weights: ", 
-00002380: 636c 6173 735f 7765 6967 6874 7329 0d0a  class_weights)..
-00002390: 2020 2020 2020 2020 6966 206d 6f64 6520          if mode 
-000023a0: 3d3d 2027 7369 6e67 6c65 5f66 6f6c 6427  == 'single_fold'
-000023b0: 3a0d 0a20 2020 2020 2020 2020 2020 206e  :..            n
-000023c0: 5f66 6f6c 6473 203d 2031 0d0a 2020 2020  _folds = 1..    
-000023d0: 2020 2020 2020 2020 7472 6169 6e2c 2076          train, v
-000023e0: 616c 203d 2073 656c 662e 6461 7461 7365  al = self.datase
-000023f0: 742e 5f62 7569 6c64 5f64 6174 6173 6574  t._build_dataset
-00002400: 2873 656c 662e 6461 7461 7365 742e 685f  (self.dataset.h_
-00002410: 7061 7261 6d73 5b27 7472 6169 6e5f 7061  params['train_pa
-00002420: 7468 7327 5d2c 0d0a 2020 2020 2020 2020  ths'],..        
-00002430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002450: 2020 2020 2020 2074 7261 696e 5f62 6174         train_bat
-00002460: 6368 3d73 656c 662e 6461 7461 7365 742e  ch=self.dataset.
-00002470: 7472 6169 6e69 6e67 5f62 6174 6368 2c0d  training_batch,.
-00002480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000140: 706f 7274 2070 6963 6b6c 650d 0a0d 0a66  port pickle....f
+00000150: 726f 6d20 7479 7069 6e67 2069 6d70 6f72  rom typing impor
+00000160: 7420 4361 6c6c 6162 6c65 0d0a 6672 6f6d  t Callable..from
+00000170: 206d 6e65 2069 6d70 6f72 7420 6368 616e   mne import chan
+00000180: 6e65 6c73 2c20 6576 6f6b 6564 2c20 6372  nels, evoked, cr
+00000190: 6561 7465 5f69 6e66 6f2c 2049 6e66 6f0d  eate_info, Info.
+000001a0: 0a66 726f 6d20 6d6e 652e 6669 6c74 6572  .from mne.filter
+000001b0: 2069 6d70 6f72 7420 6669 6c74 6572 5f64   import filter_d
+000001c0: 6174 610d 0a0d 0a66 726f 6d20 7363 6970  ata....from scip
+000001d0: 792e 7369 676e 616c 2069 6d70 6f72 7420  y.signal import 
+000001e0: 6672 6571 7a2c 2077 656c 6368 0d0a 6672  freqz, welch..fr
+000001f0: 6f6d 2073 6369 7079 2e73 7461 7473 2069  om scipy.stats i
+00000200: 6d70 6f72 7420 7370 6561 726d 616e 722c  mport spearmanr,
+00000210: 2070 6561 7273 6f6e 720d 0a0d 0a66 726f   pearsonr....fro
+00000220: 6d20 6d61 7470 6c6f 746c 6962 2069 6d70  m matplotlib imp
+00000230: 6f72 7420 7079 706c 6f74 2061 7320 706c  ort pyplot as pl
+00000240: 740d 0a66 726f 6d20 6d61 7470 6c6f 746c  t..from matplotl
+00000250: 6962 2069 6d70 6f72 7420 7061 7463 6865  ib import patche
+00000260: 7320 6173 2070 7463 680d 0a66 726f 6d20  s as ptch..from 
+00000270: 6d61 7470 6c6f 746c 6962 2069 6d70 6f72  matplotlib impor
+00000280: 7420 636f 6c6c 6563 7469 6f6e 730d 0a66  t collections..f
+00000290: 726f 6d20 6d70 6c5f 746f 6f6c 6b69 7473  rom mpl_toolkits
+000002a0: 2e61 7865 735f 6772 6964 3120 696d 706f  .axes_grid1 impo
+000002b0: 7274 206d 616b 655f 6178 6573 5f6c 6f63  rt make_axes_loc
+000002c0: 6174 6162 6c65 0d0a 0d0a 6672 6f6d 202e  atable....from .
+000002d0: 6c61 7965 7273 2069 6d70 6f72 7420 4c46  layers import LF
+000002e0: 5443 6f6e 762c 2056 4152 436f 6e76 2c20  TConv, VARConv, 
+000002f0: 4465 4d69 7869 6e67 2c20 4675 6c6c 7943  DeMixing, FullyC
+00000300: 6f6e 6e65 6374 6564 2c20 5465 6d70 506f  onnected, TempPo
+00000310: 6f6c 696e 670d 0a66 726f 6d20 7465 6e73  oling..from tens
+00000320: 6f72 666c 6f77 2e6b 6572 6173 2e6c 6179  orflow.keras.lay
+00000330: 6572 7320 696d 706f 7274 2053 6570 6172  ers import Separ
+00000340: 6162 6c65 436f 6e76 3244 2c20 436f 6e76  ableConv2D, Conv
+00000350: 3244 2c20 4465 7074 6877 6973 6543 6f6e  2D, DepthwiseCon
+00000360: 7632 440d 0a66 726f 6d20 7465 6e73 6f72  v2D..from tensor
+00000370: 666c 6f77 2e6b 6572 6173 2e6c 6179 6572  flow.keras.layer
+00000380: 7320 696d 706f 7274 2046 6c61 7474 656e  s import Flatten
+00000390: 2c20 4472 6f70 6f75 742c 2042 6174 6368  , Dropout, Batch
+000003a0: 4e6f 726d 616c 697a 6174 696f 6e0d 0a66  Normalization..f
+000003b0: 726f 6d20 7465 6e73 6f72 666c 6f77 2e6b  rom tensorflow.k
+000003c0: 6572 6173 2e69 6e69 7469 616c 697a 6572  eras.initializer
+000003d0: 7320 696d 706f 7274 2043 6f6e 7374 616e  s import Constan
+000003e0: 740d 0a66 726f 6d20 7465 6e73 6f72 666c  t..from tensorfl
+000003f0: 6f77 2e6b 6572 6173 2069 6d70 6f72 7420  ow.keras import 
+00000400: 7265 6775 6c61 7269 7a65 7273 2061 7320  regularizers as 
+00000410: 6b5f 7265 672c 2063 6f6e 7374 7261 696e  k_reg, constrain
+00000420: 7473 2c20 6c61 7965 7273 0d0a 0d0a 6672  ts, layers....fr
+00000430: 6f6d 202e 6c61 7965 7273 2069 6d70 6f72  om .layers impor
+00000440: 7420 4c53 544d 0d0a 696d 706f 7274 2063  t LSTM..import c
+00000450: 7376 0d0a 696d 706f 7274 206f 730d 0a66  sv..import os..f
+00000460: 726f 6d20 2e64 6174 6120 696d 706f 7274  rom .data import
+00000470: 2044 6174 6173 6574 0d0a 6672 6f6d 202e   Dataset..from .
+00000480: 7574 696c 7320 696d 706f 7274 2072 6567  utils import reg
+00000490: 7265 7373 696f 6e5f 6d65 7472 6963 732c  ression_metrics,
+000004a0: 205f 6f6e 6568 6f74 0d0a 6672 6f6d 2063   _onehot..from c
+000004b0: 6f6c 6c65 6374 696f 6e73 2069 6d70 6f72  ollections impor
+000004c0: 7420 6465 6661 756c 7464 6963 740d 0a0d  t defaultdict...
+000004d0: 0a0d 0a64 6566 2075 6e69 7175 6966 7928  ...def uniquify(
+000004e0: 7365 7129 3a0d 0a20 2020 2075 6e20 3d20  seq):..    un = 
+000004f0: 5b5d 0d0a 2020 2020 5b75 6e2e 6170 7065  []..    [un.appe
+00000500: 6e64 2869 2920 666f 7220 6920 696e 2073  nd(i) for i in s
+00000510: 6571 2069 6620 6e6f 7420 756e 2e63 6f75  eq if not un.cou
+00000520: 6e74 2869 295d 0d0a 2020 2020 7265 7475  nt(i)]..    retu
+00000530: 726e 2075 6e0d 0a0d 0a0d 0a23 202d 2d2d  rn un......# ---
+00000540: 2d2d 2042 6173 6520 6d6f 6465 6c20 2d2d  -- Base model --
+00000550: 2d2d 2d0d 0a23 4074 662e 6b65 7261 732e  ---..#@tf.keras.
+00000560: 7574 696c 732e 7265 6769 7374 6572 5f6b  utils.register_k
+00000570: 6572 6173 5f73 6572 6961 6c69 7a61 626c  eras_serializabl
+00000580: 6528 7061 636b 6167 653d 226d 6e65 666c  e(package="mnefl
+00000590: 6f77 2229 0d0a 636c 6173 7320 4261 7365  ow")..class Base
+000005a0: 4d6f 6465 6c28 293a 0d0a 2020 2020 2222  Model():..    ""
+000005b0: 2250 6172 656e 7420 636c 6173 7320 666f  "Parent class fo
+000005c0: 7220 616c 6c20 4d4e 4566 6c6f 7720 6d6f  r all MNEflow mo
+000005d0: 6465 6c73 2e0d 0a0d 0a20 2020 2050 726f  dels.....    Pro
+000005e0: 7669 6465 7320 6661 7374 2061 6e64 206d  vides fast and m
+000005f0: 656d 6f72 792d 6566 6669 6369 656e 7420  emory-efficient 
+00000600: 6461 7461 2068 616e 646c 696e 6720 616e  data handling an
+00000610: 6420 7369 6d70 6c69 6669 6564 2041 5049  d simplified API
+00000620: 2e0d 0a20 2020 2043 7573 746f 6d20 6d6f  ...    Custom mo
+00000630: 6465 6c73 2063 616e 2062 6520 6275 696c  dels can be buil
+00000640: 7420 6279 206f 7665 7272 6964 696e 6720  t by overriding 
+00000650: 5f62 7569 6c64 5f67 7261 7068 2061 6e64  _build_graph and
+00000660: 0d0a 2020 2020 5f73 6574 5f6f 7074 696d  ..    _set_optim
+00000670: 697a 6572 206d 6574 686f 6473 2e0d 0a20  izer methods... 
+00000680: 2020 2022 2222 0d0a 0d0a 2020 2020 6465     """....    de
+00000690: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+000006a0: 206d 6574 613d 4e6f 6e65 2c20 6461 7461   meta=None, data
+000006b0: 7365 743d 4e6f 6e65 293a 0d0a 2020 2020  set=None):..    
+000006c0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+000006d0: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
+000006e0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d       ----------.
+000006f0: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
+00000700: 203a 206d 6e65 666c 6f77 2e44 6174 6173   : mneflow.Datas
+00000710: 6574 0d0a 2020 2020 2020 2020 2020 2020  et..            
+00000720: 6044 6174 6173 6574 6020 6f62 6a65 6374  `Dataset` object
+00000730: 2e0d 0a0d 0a20 2020 2020 2020 2073 7065  .....        spe
+00000740: 6373 203a 2064 6963 740d 0a20 2020 2020  cs : dict..     
+00000750: 2020 2020 2020 2044 6963 7469 6f6e 6172         Dictionar
+00000760: 7920 6f66 206d 6f64 656c 2d73 7065 6369  y of model-speci
+00000770: 6669 6320 6879 7065 7270 6172 616d 6574  fic hyperparamet
+00000780: 6572 732e 204d 7573 7420 696e 636c 7564  ers. Must includ
+00000790: 650d 0a20 2020 2020 2020 2020 2020 2061  e..            a
+000007a0: 7420 6c65 6173 7420 606d 6f64 656c 5f70  t least `model_p
+000007b0: 6174 6860 202d 2070 6174 6820 666f 7220  ath` - path for 
+000007c0: 7361 7669 6e67 2061 2074 7261 696e 6564  saving a trained
+000007d0: 206d 6f64 656c 0d0a 2020 2020 2020 2020   model..        
+000007e0: 2020 2020 5365 6520 604d 6f64 656c 6020      See `Model` 
+000007f0: 7375 6263 6c61 7373 2064 6566 696e 6974  subclass definit
+00000800: 696f 6e73 2066 6f72 2064 6574 6169 6c73  ions for details
+00000810: 2e20 556e 6c65 7373 206f 7468 6572 7769  . Unless otherwi
+00000820: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+00000830: 7370 6563 6966 6965 6420 7573 6573 2064  specified uses d
+00000840: 6566 6175 6c74 2068 7970 6572 7061 7261  efault hyperpara
+00000850: 6d65 7465 7273 2066 6f72 2065 6163 6820  meters for each 
+00000860: 696d 706c 656d 656e 7465 6420 6d6f 6465  implemented mode
+00000870: 6c2e 0d0a 2020 2020 2020 2020 2222 220d  l...        """.
+00000880: 0a20 2020 2020 2020 2073 656c 662e 7370  .        self.sp
+00000890: 6563 7320 3d20 6d65 7461 2e6d 6f64 656c  ecs = meta.model
+000008a0: 5f73 7065 6373 0d0a 2020 2020 2020 2020  _specs..        
+000008b0: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
+000008c0: 5b27 6d6f 6465 6c5f 7061 7468 275d 203d  ['model_path'] =
+000008d0: 206f 732e 7061 7468 2e6a 6f69 6e28 6d65   os.path.join(me
+000008e0: 7461 2e64 6174 615b 2770 6174 6827 5d2c  ta.data['path'],
+000008f0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+00000900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000920: 2020 2020 2020 2020 2027 6d6f 6465 6c73           'models
+00000930: 2729 2020 0d0a 2020 2020 2020 2020 0d0a  ')  ..        ..
+00000940: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00000950: 6120 3d20 6d65 7461 0d0a 2020 2020 2020  a = meta..      
+00000960: 2020 7365 6c66 2e6d 6f64 656c 5f70 6174    self.model_pat
+00000970: 6820 3d20 6f73 2e70 6174 682e 6a6f 696e  h = os.path.join
+00000980: 286d 6574 612e 6461 7461 5b27 7061 7468  (meta.data['path
+00000990: 275d 2c20 276d 6f64 656c 735c 5c27 290d  '], 'models\\').
+000009a0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000009b0: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
+000009c0: 656c 662e 6d6f 6465 6c5f 7061 7468 293a  elf.model_path):
+000009d0: 0d0a 2020 2020 2020 2020 2020 2020 6f73  ..            os
+000009e0: 2e6d 6b64 6972 2873 656c 662e 6d6f 6465  .mkdir(self.mode
+000009f0: 6c5f 7061 7468 2920 2020 2020 2020 2020  l_path)         
+00000a00: 2020 200d 0a0d 0a20 2020 2020 2020 200d     ....        .
+00000a10: 0a20 2020 2020 2020 2069 6620 6461 7461  .        if data
+00000a20: 7365 743a 0d0a 2020 2020 2020 2020 2020  set:..          
+00000a30: 2020 7365 6c66 2e64 6174 6173 6574 203d    self.dataset =
+00000a40: 2064 6174 6173 6574 0d0a 2020 2020 2020   dataset..      
+00000a50: 2020 656c 6966 206e 6f74 2064 6174 6173    elif not datas
+00000a60: 6574 2061 6e64 206d 6574 613a 0d0a 2020  et and meta:..  
+00000a70: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00000a80: 6174 6173 6574 203d 2044 6174 6173 6574  ataset = Dataset
+00000a90: 286d 6574 612c 202a 2a6d 6574 612e 6461  (meta, **meta.da
+00000aa0: 7461 290d 0a20 2020 2020 2020 2065 6c73  ta)..        els
+00000ab0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00000ac0: 7072 696e 7428 2250 726f 7669 6465 2044  print("Provide D
+00000ad0: 6174 6173 6574 206f 7220 4d65 7461 6461  ataset or Metada
+00000ae0: 7461 2066 696c 6522 290d 0a20 2020 2020  ta file")..     
+00000af0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00000b00: 2073 656c 662e 696e 7075 745f 7368 6170   self.input_shap
+00000b10: 6520 3d20 2873 656c 662e 6461 7461 7365  e = (self.datase
+00000b20: 742e 685f 7061 7261 6d73 5b27 6e5f 7365  t.h_params['n_se
+00000b30: 7127 5d2c 0d0a 2020 2020 2020 2020 2020  q'],..          
+00000b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000b50: 2020 7365 6c66 2e64 6174 6173 6574 2e68    self.dataset.h
+00000b60: 5f70 6172 616d 735b 276e 5f74 275d 2c0d  _params['n_t'],.
+00000b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000b80: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00000b90: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
+00000ba0: 6d73 5b27 6e5f 6368 275d 290d 0a20 2020  ms['n_ch'])..   
+00000bb0: 2020 2020 2073 656c 662e 795f 7368 6170       self.y_shap
+00000bc0: 6520 3d20 7365 6c66 2e64 6174 6173 6574  e = self.dataset
+00000bd0: 2e79 5f73 6861 7065 0d0a 2020 2020 2020  .y_shape..      
+00000be0: 2020 7365 6c66 2e6f 7574 5f64 696d 203d    self.out_dim =
+00000bf0: 206e 702e 7072 6f64 2873 656c 662e 795f   np.prod(self.y_
+00000c00: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
+00000c10: 7365 6c66 2e69 6e70 7574 7320 3d20 6c61  self.inputs = la
+00000c20: 7965 7273 2e49 6e70 7574 2873 6861 7065  yers.Input(shape
+00000c30: 3d28 7365 6c66 2e69 6e70 7574 5f73 6861  =(self.input_sha
+00000c40: 7065 2929 0d0a 2020 2020 2020 2020 2373  pe))..        #s
+00000c50: 656c 662e 7472 6169 6e65 6420 3d20 4661  elf.trained = Fa
+00000c60: 6c73 650d 0a20 2020 2020 2020 2073 656c  lse..        sel
+00000c70: 662e 795f 7072 6564 203d 2073 656c 662e  f.y_pred = self.
+00000c80: 6275 696c 645f 6772 6170 6828 290d 0a20  build_graph().. 
+00000c90: 2020 2020 2020 2073 656c 662e 6c6f 6720         self.log 
+00000ca0: 3d20 6469 6374 2829 0d0a 2020 2020 2020  = dict()..      
+00000cb0: 2020 7365 6c66 2e63 6d20 3d20 6e70 2e7a    self.cm = np.z
+00000cc0: 6572 6f73 285b 7365 6c66 2e79 5f73 6861  eros([self.y_sha
+00000cd0: 7065 5b2d 315d 2c20 7365 6c66 2e79 5f73  pe[-1], self.y_s
+00000ce0: 6861 7065 5b2d 315d 5d29 0d0a 2020 2020  hape[-1]])..    
+00000cf0: 2020 2020 7365 6c66 2e63 765f 7061 7474      self.cv_patt
+00000d00: 6572 6e73 203d 2064 6566 6175 6c74 6469  erns = defaultdi
+00000d10: 6374 2864 6963 7429 0d0a 2020 2020 2020  ct(dict)..      
+00000d20: 2020 7365 6c66 2e63 765f 7765 6967 6874    self.cv_weight
+00000d30: 7320 3d20 6465 6661 756c 7464 6963 7428  s = defaultdict(
+00000d40: 6c69 7374 290d 0a20 2020 2020 2020 2069  list)..        i
+00000d50: 6620 6e6f 7420 6861 7361 7474 7228 7365  f not hasattr(se
+00000d60: 6c66 2c20 2773 636f 7065 2729 3a0d 0a20  lf, 'scope'):.. 
+00000d70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00000d80: 7363 6f70 6520 3d20 2762 6173 656d 6f64  scope = 'basemod
+00000d90: 656c 270d 0a20 2020 2020 2020 2073 656c  el'..        sel
+00000da0: 662e 6d6f 6465 6c5f 6e61 6d65 203d 2022  f.model_name = "
+00000db0: 5f22 2e6a 6f69 6e28 5b73 656c 662e 7363  _".join([self.sc
+00000dc0: 6f70 652c 0d0a 2020 2020 2020 2020 2020  ope,..          
+00000dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000de0: 2020 2020 2020 2020 2020 6d65 7461 2e64            meta.d
+00000df0: 6174 615b 2764 6174 615f 6964 275d 5d29  ata['data_id']])
+00000e00: 0d0a 0d0a 0d0a 0d0a 2020 2020 2320 4063  ........    # @c
+00000e10: 6c61 7373 6d65 7468 6f64 0d0a 2020 2020  lassmethod..    
+00000e20: 2320 6465 6620 6672 6f6d 5f63 6f6e 6669  # def from_confi
+00000e30: 6728 636c 732c 2063 6f6e 6669 6729 3a0d  g(cls, config):.
+00000e40: 0a20 2020 2023 2020 2020 2072 6574 7572  .    #     retur
+00000e50: 6e20 636c 7328 2a2a 636f 6e66 6967 290d  n cls(**config).
+00000e60: 0a0d 0a20 2020 2023 2064 6566 2067 6574  ...    # def get
+00000e70: 5f63 6f6e 6669 6728 7365 6c66 293a 0d0a  _config(self):..
+00000e80: 2020 2020 2320 2020 2020 636f 6e66 6967      #     config
+00000e90: 203d 207b 0d0a 2020 2020 2320 2020 2020   = {..    #     
+00000ea0: 2020 2020 2266 6322 3a20 7365 6c66 2e66      "fc": self.f
+00000eb0: 630d 0a20 2020 2023 2020 2020 207d 0d0a  c..    #     }..
+00000ec0: 2020 2020 2320 2020 2020 7265 7475 726e      #     return
+00000ed0: 2063 6f6e 6669 670d 0a0d 0a0d 0a0d 0a20   config........ 
+00000ee0: 2020 2064 6566 2062 7569 6c64 2873 656c     def build(sel
+00000ef0: 662c 206f 7074 696d 697a 6572 3d22 6164  f, optimizer="ad
+00000f00: 616d 222c 206c 6f73 733d 4e6f 6e65 2c20  am", loss=None, 
+00000f10: 6d65 7472 6963 733d 4e6f 6e65 2c20 6d61  metrics=None, ma
+00000f20: 7070 696e 673d 4e6f 6e65 2c0d 0a20 2020  pping=None,..   
+00000f30: 2020 2020 2020 2020 2020 206c 6561 726e             learn
+00000f40: 5f72 6174 653d 3365 2d34 293a 0d0a 2020  _rate=3e-4):..  
+00000f50: 2020 2020 2020 2222 2243 6f6d 7069 6c65        """Compile
+00000f60: 2061 206d 6f64 656c 2e0d 0a0d 0a20 2020   a model.....   
+00000f70: 2020 2020 2050 6172 616d 6574 6572 730d       Parameters.
+00000f80: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00000f90: 2d2d 2d0d 0a20 2020 2020 2020 206f 7074  ---..        opt
+00000fa0: 696d 697a 6572 203a 2073 7472 2c20 7466  imizer : str, tf
+00000fb0: 2e6f 7074 696d 697a 6572 732e 4f70 7469  .optimizers.Opti
+00000fc0: 6d69 7a65 720d 0a20 2020 2020 2020 2020  mizer..         
+00000fd0: 2020 2044 6561 6675 6c74 7320 746f 2022     Deafults to "
+00000fe0: 6164 616d 220d 0a0d 0a20 2020 2020 2020  adam"....       
+00000ff0: 206c 6f73 7320 3a20 7374 722c 2074 662e   loss : str, tf.
+00001000: 6b65 7261 732e 6c6f 7373 6573 2e4c 6f73  keras.losses.Los
+00001010: 730d 0a20 2020 2020 2020 2020 2020 2044  s..            D
+00001020: 6566 6175 6c74 7320 746f 204d 5345 2069  efaults to MSE i
+00001030: 6e20 7461 7267 6574 5f74 7970 6520 6973  n target_type is
+00001040: 2022 666c 6f61 7422 2061 6e64 0d0a 2020   "float" and..  
+00001050: 2020 2020 2020 2020 2020 2273 6f66 746d            "softm
+00001060: 6178 5f63 726f 7373 656e 7472 6f70 7922  ax_crossentropy"
+00001070: 2069 6620 2274 6172 6765 745f 7479 7065   if "target_type
+00001080: 2220 6973 2069 6e74 0d0a 0d0a 2020 2020  " is int....    
+00001090: 2020 2020 6d65 7472 6963 7320 3a20 7374      metrics : st
+000010a0: 722c 2074 662e 6b65 7261 732e 6d65 7472  r, tf.keras.metr
+000010b0: 6963 732e 4d65 7472 6963 0d0a 2020 2020  ics.Metric..    
+000010c0: 2020 2020 2020 2020 4465 6661 756c 7473          Defaults
+000010d0: 2074 6f20 524d 5345 2069 6e20 7461 7267   to RMSE in targ
+000010e0: 6574 5f74 7970 6520 6973 2022 666c 6f61  et_type is "floa
+000010f0: 7422 2061 6e64 0d0a 2020 2020 2020 2020  t" and..        
+00001100: 2020 2020 2020 2020 2263 6174 6567 6f72          "categor
+00001110: 6963 616c 5f61 6363 7572 6163 7922 2069  ical_accuracy" i
+00001120: 6620 2274 6172 6765 745f 7479 7065 2220  f "target_type" 
+00001130: 6973 2069 6e74 0d0a 0d0a 2020 2020 2020  is int....      
+00001140: 2020 6c65 6172 6e5f 7261 7465 203a 2066    learn_rate : f
+00001150: 6c6f 6174 0d0a 2020 2020 2020 2020 2020  loat..          
+00001160: 2020 4c65 6172 6e69 6e67 2072 6174 652c    Learning rate,
+00001170: 2064 6566 6175 6c74 7320 746f 2033 652d   defaults to 3e-
+00001180: 340d 0a0d 0a20 2020 2020 2020 206d 6170  4....        map
+00001190: 7069 6e67 203a 2073 7472 0d0a 0d0a 2020  ping : str....  
+000011a0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+000011b0: 2020 2023 2049 6e69 7469 616c 697a 6520     # Initialize 
+000011c0: 636f 6d70 7574 6174 696f 6e61 6c20 6772  computational gr
+000011d0: 6170 680d 0a20 2020 2020 2020 2069 6620  aph..        if 
+000011e0: 6d61 7070 696e 673a 0d0a 2020 2020 2020  mapping:..      
+000011f0: 2020 2020 2020 6d61 705f 6675 6e20 3d20        map_fun = 
+00001200: 7466 2e6b 6572 6173 2e61 6374 6976 6174  tf.keras.activat
+00001210: 696f 6e73 2e67 6574 286d 6170 7069 6e67  ions.get(mapping
+00001220: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00001230: 656c 662e 795f 7072 6564 3d20 6d61 705f  elf.y_pred= map_
+00001240: 6675 6e28 7365 6c66 2e79 5f70 7265 6429  fun(self.y_pred)
+00001250: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00001260: 2e6b 6d20 3d20 7466 2e6b 6572 6173 2e4d  .km = tf.keras.M
+00001270: 6f64 656c 2869 6e70 7574 733d 7365 6c66  odel(inputs=self
+00001280: 2e69 6e70 7574 732c 206f 7574 7075 7473  .inputs, outputs
+00001290: 3d73 656c 662e 795f 7072 6564 290d 0a0d  =self.y_pred)...
+000012a0: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
+000012b0: 3d20 7b22 6f70 7469 6d69 7a65 7222 3a20  = {"optimizer": 
+000012c0: 7466 2e6f 7074 696d 697a 6572 732e 6765  tf.optimizers.ge
+000012d0: 7428 6f70 7469 6d69 7a65 7229 2e66 726f  t(optimizer).fro
+000012e0: 6d5f 636f 6e66 6967 280d 0a20 2020 2020  m_config(..     
+000012f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001310: 2020 2020 2020 207b 226c 6561 726e 696e         {"learnin
+00001320: 675f 7261 7465 223a 6c65 6172 6e5f 7261  g_rate":learn_ra
+00001330: 7465 7d29 7d0d 0a0d 0a20 2020 2020 2020  te})}....       
+00001340: 2069 6620 6c6f 7373 3a20 2020 200d 0a20   if loss:    .. 
+00001350: 2020 2020 2020 2020 2020 2070 6172 616d             param
+00001360: 735b 226c 6f73 7322 5d20 3d20 7466 2e6b  s["loss"] = tf.k
+00001370: 6572 6173 2e6c 6f73 7365 732e 6765 7428  eras.losses.get(
+00001380: 6c6f 7373 290d 0a20 2020 2020 2020 2020  loss)..         
+00001390: 2020 206c 6f73 735f 6e61 6d65 203d 206c     loss_name = l
+000013a0: 6f73 730d 0a0d 0a20 2020 2020 2020 2069  oss....        i
+000013b0: 6620 6d65 7472 6963 733a 0d0a 2020 2020  f metrics:..    
+000013c0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+000013d0: 7369 6e73 7461 6e63 6528 6d65 7472 6963  sinstance(metric
+000013e0: 732c 206c 6973 7429 3a0d 0a20 2020 2020  s, list):..     
+000013f0: 2020 2020 2020 2020 2020 206d 6574 7269             metri
+00001400: 6373 203d 205b 6d65 7472 6963 735d 0d0a  cs = [metrics]..
+00001410: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00001420: 6d73 5b22 6d65 7472 6963 7322 5d20 3d20  ms["metrics"] = 
+00001430: 5b74 662e 6b65 7261 732e 6d65 7472 6963  [tf.keras.metric
+00001440: 732e 6765 7428 6d65 7472 6963 2920 666f  s.get(metric) fo
+00001450: 7220 6d65 7472 6963 2069 6e20 6d65 7472  r metric in metr
+00001460: 6963 735d 0d0a 0d0a 2020 2020 2020 2020  ics]....        
+00001470: 230d 0a20 2020 2020 2020 2023 7365 6c66  #..        #self
+00001480: 2e73 7065 6373 2e73 6574 6465 6661 756c  .specs.setdefaul
+00001490: 7428 2775 6e69 746e 6f72 6d5f 7363 6f70  t('unitnorm_scop
+000014a0: 6527 2c20 5b5d 290d 0a20 2020 2020 2020  e', [])..       
+000014b0: 2320 496e 6974 6961 6c69 7a65 206f 7074  # Initialize opt
+000014c0: 696d 697a 6572 0d0a 2020 2020 2020 2020  imizer..        
+000014d0: 6966 2073 656c 662e 6461 7461 7365 742e  if self.dataset.
+000014e0: 685f 7061 7261 6d73 5b22 7461 7267 6574  h_params["target
+000014f0: 5f74 7970 6522 5d20 696e 205b 2766 6c6f  _type"] in ['flo
+00001500: 6174 272c 2027 7369 676e 616c 275d 3a0d  at', 'signal']:.
+00001510: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+00001520: 616d 732e 7365 7464 6566 6175 6c74 2822  ams.setdefault("
+00001530: 6c6f 7373 222c 2074 662e 6b65 7261 732e  loss", tf.keras.
+00001540: 6c6f 7373 6573 2e4d 6561 6e53 7175 6172  losses.MeanSquar
+00001550: 6564 4572 726f 7228 6e61 6d65 3d27 4d53  edError(name='MS
+00001560: 4527 2929 0d0a 2020 2020 2020 2020 2020  E'))..          
+00001570: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00001580: 2020 2020 7061 7261 6d73 2e73 6574 6465      params.setde
+00001590: 6661 756c 7428 226d 6574 7269 6373 222c  fault("metrics",
+000015a0: 205b 7466 2e6b 6572 6173 2e6d 6574 7269   [tf.keras.metri
+000015b0: 6373 2e52 6f6f 744d 6561 6e53 7175 6172  cs.RootMeanSquar
+000015c0: 6564 4572 726f 7228 6e61 6d65 3d22 524d  edError(name="RM
+000015d0: 5345 2229 5d29 0d0a 0d0a 2020 2020 2020  SE")])....      
+000015e0: 2020 656c 6966 2073 656c 662e 6461 7461    elif self.data
+000015f0: 7365 742e 685f 7061 7261 6d73 5b22 7461  set.h_params["ta
+00001600: 7267 6574 5f74 7970 6522 5d20 696e 205b  rget_type"] in [
+00001610: 2769 6e74 275d 3a0d 0a20 2020 2020 2020  'int']:..       
+00001620: 2020 2020 2070 6172 616d 732e 7365 7464       params.setd
+00001630: 6566 6175 6c74 2822 6c6f 7373 222c 2074  efault("loss", t
+00001640: 662e 6b65 7261 732e 6c6f 7373 6573 2e43  f.keras.losses.C
+00001650: 6174 6567 6f72 6963 616c 4372 6f73 7365  ategoricalCrosse
+00001660: 6e74 726f 7079 2866 726f 6d5f 6c6f 6769  ntropy(from_logi
+00001670: 7473 3d54 7275 652c 0d0a 2020 2020 2020  ts=True,..      
+00001680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000016a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000016b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000016c0: 2020 2020 2020 2020 2020 2020 206e 616d               nam
+000016d0: 653d 2743 6174 2e43 4527 2929 0d0a 2020  e='Cat.CE'))..  
+000016e0: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+000016f0: 2e73 6574 6465 6661 756c 7428 226d 6574  .setdefault("met
+00001700: 7269 6373 222c 205b 7466 2e6b 6572 6173  rics", [tf.keras
+00001710: 2e6d 6574 7269 6373 2e43 6174 6567 6f72  .metrics.Categor
+00001720: 6963 616c 4163 6375 7261 6379 286e 616d  icalAccuracy(nam
+00001730: 653d 2243 6174 2e20 4163 6322 295d 290d  e="Cat. Acc")]).
+00001740: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00001750: 6b6d 2e63 6f6d 7069 6c65 286f 7074 696d  km.compile(optim
+00001760: 697a 6572 3d70 6172 616d 735b 226f 7074  izer=params["opt
+00001770: 696d 697a 6572 225d 2c0d 0a20 2020 2020  imizer"],..     
+00001780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001790: 2020 206c 6f73 733d 7061 7261 6d73 5b22     loss=params["
+000017a0: 6c6f 7373 225d 2c0d 0a20 2020 2020 2020  loss"],..       
+000017b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000017c0: 206d 6574 7269 6373 3d70 6172 616d 735b   metrics=params[
+000017d0: 226d 6574 7269 6373 225d 290d 0a20 2020  "metrics"])..   
+000017e0: 2020 2020 200d 0a20 2020 2020 2020 2069       ..        i
+000017f0: 6620 6e6f 7420 6c6f 7373 3a0d 0a20 2020  f not loss:..   
+00001800: 2020 2020 2020 2020 206c 6f73 735f 6e61           loss_na
+00001810: 6d65 203d 2027 4d53 4527 0d0a 2020 2020  me = 'MSE'..    
+00001820: 2020 2020 5f20 3d20 7061 7261 6d73 2e70      _ = params.p
+00001830: 6f70 2827 6c6f 7373 2729 0d0a 2020 2020  op('loss')..    
+00001840: 2020 2020 6d65 7472 6963 7320 3d20 7061      metrics = pa
+00001850: 7261 6d73 2e70 6f70 2827 6d65 7472 6963  rams.pop('metric
+00001860: 7327 290d 0a20 2020 2020 2020 206d 6574  s')..        met
+00001870: 7269 635f 6e61 6d65 7320 3d20 273a 272e  ric_names = ':'.
+00001880: 6a6f 696e 285b 6d2e 6e61 6d65 2066 6f72  join([m.name for
+00001890: 206d 2069 6e20 6d65 7472 6963 735d 290d   m in metrics]).
+000018a0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+000018b0: 2020 2070 6172 616d 5f6e 616d 6573 203d     param_names =
+000018c0: 207b 6b3a 2076 2e6e 616d 6520 666f 7220   {k: v.name for 
+000018d0: 6b2c 7620 696e 2070 6172 616d 732e 6974  k,v in params.it
+000018e0: 656d 7328 297d 0d0a 2020 2020 2020 2020  ems()}..        
+000018f0: 7061 7261 6d5f 6e61 6d65 735b 276d 6574  param_names['met
+00001900: 7269 6373 275d 203d 206d 6574 7269 635f  rics'] = metric_
+00001910: 6e61 6d65 730d 0a20 2020 2020 2020 2070  names..        p
+00001920: 6172 616d 5f6e 616d 6573 5b27 6c6f 7373  aram_names['loss
+00001930: 275d 203d 206c 6f73 735f 6e61 6d65 0d0a  '] = loss_name..
+00001940: 2020 2020 2020 2020 7061 7261 6d5f 6e61          param_na
+00001950: 6d65 735b 276c 6561 726e 5f72 6174 6527  mes['learn_rate'
+00001960: 5d20 3d20 6c65 6172 6e5f 7261 7465 0d0a  ] = learn_rate..
+00001970: 2020 2020 2020 2020 7061 7261 6d5f 6e61          param_na
+00001980: 6d65 735b 2774 7261 696e 6564 275d 203d  mes['trained'] =
+00001990: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+000019a0: 7365 6c66 2e6d 6574 612e 7570 6461 7465  self.meta.update
+000019b0: 2874 7261 696e 5f70 6172 616d 733d 7061  (train_params=pa
+000019c0: 7261 6d5f 6e61 6d65 7329 0d0a 2020 2020  ram_names)..    
+000019d0: 2020 2020 2373 656c 662e 7370 6563 735b      #self.specs[
+000019e0: 276d 6f64 656c 5f6e 616d 6527 5d20 3d20  'model_name'] = 
+000019f0: 6d6f 6465 6c5f 6e61 6d65 0d0a 0d0a 2020  model_name....  
+00001a00: 2020 2020 2020 2373 6176 6520 696e 7469        #save inti
+00001a10: 616c 206d 6f64 656c 2077 6569 6768 7473  al model weights
+00001a20: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00001a30: 2020 2020 7365 6c66 2e6b 6d2e 7361 7665      self.km.save
+00001a40: 5f77 6569 6768 7473 286f 732e 7061 7468  _weights(os.path
+00001a50: 2e6a 6f69 6e28 7365 6c66 2e6d 6f64 656c  .join(self.model
+00001a60: 5f70 6174 682c 200d 0a20 2020 2020 2020  _path, ..       
+00001a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001a90: 2020 2073 656c 662e 6d6f 6465 6c5f 6e61     self.model_na
+00001aa0: 6d65 202b 2027 5f69 6e69 742e 7765 6967  me + '_init.weig
+00001ab0: 6874 732e 6835 2729 290d 0a0d 0a0d 0a20  hts.h5'))...... 
+00001ac0: 2020 2020 2020 2070 7269 6e74 2827 496e         print('In
+00001ad0: 7075 7420 7368 6170 653a 272c 2073 656c  put shape:', sel
+00001ae0: 662e 696e 7075 745f 7368 6170 6529 0d0a  f.input_shape)..
+00001af0: 2020 2020 2020 2020 7072 696e 7428 2779          print('y
+00001b00: 5f70 7265 643a 272c 2073 656c 662e 795f  _pred:', self.y_
+00001b10: 7072 6564 2e73 6861 7065 290d 0a20 2020  pred.shape)..   
+00001b20: 2020 2020 2070 7269 6e74 2827 496e 6974       print('Init
+00001b30: 6961 6c69 7a61 7469 6f6e 2063 6f6d 706c  ialization compl
+00001b40: 6574 6521 2729 0d0a 0d0a 2020 2020 6465  ete!')....    de
+00001b50: 6620 6275 696c 645f 6772 6170 6828 7365  f build_graph(se
+00001b60: 6c66 293a 0d0a 2020 2020 2020 2020 2222  lf):..        ""
+00001b70: 2242 7569 6c64 2063 6f6d 7075 7461 7469  "Build computati
+00001b80: 6f6e 616c 2067 7261 7068 2075 7369 6e67  onal graph using
+00001b90: 2064 6566 696e 6564 2070 6c61 6365 686f   defined placeho
+00001ba0: 6c64 6572 2073 656c 662e 580d 0a20 2020  lder self.X..   
+00001bb0: 2020 2020 2061 7320 696e 7075 742e 0d0a       as input...
+00001bc0: 0d0a 2020 2020 2020 2020 4361 6e20 6265  ..        Can be
+00001bd0: 206f 7665 7272 6964 656e 2069 6e20 6120   overriden in a 
+00001be0: 7375 622d 636c 6173 7320 666f 7220 6375  sub-class for cu
+00001bf0: 7374 6f6d 697a 6564 2061 7263 6869 7465  stomized archite
+00001c00: 6374 7572 652e 0d0a 0d0a 2020 2020 2020  cture.....      
+00001c10: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
+00001c20: 2020 202d 2d2d 2d2d 2d2d 2d0d 0a20 2020     --------..   
+00001c30: 2020 2020 2079 5f70 7265 6420 3a20 7466       y_pred : tf
+00001c40: 2e54 656e 736f 720d 0a20 2020 2020 2020  .Tensor..       
+00001c50: 2020 2020 204f 7574 7075 7420 6f66 2074       Output of t
+00001c60: 6865 2066 6f72 7761 7264 2070 6173 7320  he forward pass 
+00001c70: 6f66 2074 6865 2063 6f6d 7075 7461 7469  of the computati
+00001c80: 6f6e 616c 2067 7261 7068 2e0d 0a20 2020  onal graph...   
+00001c90: 2020 2020 2020 2020 2050 7265 6469 6374           Predict
+00001ca0: 696f 6e20 6f66 2074 6865 2074 6172 6765  ion of the targe
+00001cb0: 7420 7661 7269 6162 6c65 2e0d 0a20 2020  t variable...   
+00001cc0: 2020 2020 2022 2222 0d0a 0d0a 2020 2020       """....    
+00001cd0: 2020 2020 666c 6174 203d 2046 6c61 7474      flat = Flatt
+00001ce0: 656e 2829 2873 656c 662e 696e 7075 7473  en()(self.inputs
+00001cf0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00001d00: 6663 203d 2046 756c 6c79 436f 6e6e 6563  fc = FullyConnec
+00001d10: 7465 6428 7369 7a65 3d73 656c 662e 6f75  ted(size=self.ou
+00001d20: 745f 6469 6d2c 206e 6f6e 6c69 6e3d 7466  t_dim, nonlin=tf
+00001d30: 2e69 6465 6e74 6974 792c 0d0a 2020 2020  .identity,..    
+00001d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001d50: 2020 2020 7370 6563 733d 7365 6c66 2e73      specs=self.s
+00001d60: 7065 6373 290d 0a20 2020 2020 2020 2079  pecs)..        y
+00001d70: 5f70 7265 6420 3d20 7365 6c66 2e66 6328  _pred = self.fc(
+00001d80: 666c 6174 290d 0a20 2020 2020 2020 2072  flat)..        r
+00001d90: 6574 7572 6e20 795f 7072 6564 0d0a 0d0a  eturn y_pred....
+00001da0: 0d0a 2020 2020 6465 6620 7472 6169 6e28  ..    def train(
+00001db0: 7365 6c66 2c20 6e5f 6570 6f63 6873 3d31  self, n_epochs=1
+00001dc0: 302c 2065 7661 6c5f 7374 6570 3d4e 6f6e  0, eval_step=Non
+00001dd0: 652c 206d 696e 5f64 656c 7461 3d31 652d  e, min_delta=1e-
+00001de0: 362c 0d0a 2020 2020 2020 2020 2020 2020  6,..            
+00001df0: 2020 6561 726c 795f 7374 6f70 7069 6e67    early_stopping
+00001e00: 3d33 2c20 6d6f 6465 3d27 7369 6e67 6c65  =3, mode='single
+00001e10: 5f66 6f6c 6427 2c20 7072 756e 655f 7765  _fold', prune_we
+00001e20: 6967 6874 733d 4661 6c73 652c 0d0a 2020  ights=False,..  
+00001e30: 2020 2020 2020 2020 2020 2020 636f 6c6c              coll
+00001e40: 6563 745f 7061 7474 6572 6e73 203d 2046  ect_patterns = F
+00001e50: 616c 7365 2c20 636c 6173 735f 7765 6967  alse, class_weig
+00001e60: 6874 7320 3d20 4e6f 6e65 2920 3a0d 0a0d  hts = None) :...
+00001e70: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00001e80: 2020 2020 2020 5472 6169 6e20 6120 6d6f        Train a mo
+00001e90: 6465 6c0d 0a0d 0a20 2020 2020 2020 2050  del....        P
+00001ea0: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
+00001eb0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a     -----------..
+00001ec0: 0d0a 2020 2020 2020 2020 6e5f 6570 6f63  ..        n_epoc
+00001ed0: 6873 203a 2069 6e74 0d0a 2020 2020 2020  hs : int..      
+00001ee0: 2020 2020 2020 4d61 7869 6d75 6d20 6e75        Maximum nu
+00001ef0: 6d62 6572 206f 6620 7472 6169 6e69 6e67  mber of training
+00001f00: 2065 6f70 6368 732e 0d0a 0d0a 2020 2020   eopchs.....    
+00001f10: 2020 2020 6576 616c 5f73 7465 7020 3a20      eval_step : 
+00001f20: 696e 742c 204e 6f6e 650d 0a20 2020 2020  int, None..     
+00001f30: 2020 2020 2020 2069 7465 7261 7469 6f6e         iteration
+00001f40: 7320 7065 7220 6570 6f63 682e 2049 6620  s per epoch. If 
+00001f50: 4e6f 6e65 2065 6163 6820 6570 6f63 6820  None each epoch 
+00001f60: 7061 7373 6573 2074 6865 2074 7261 696e  passes the train
+00001f70: 696e 6720 7365 740d 0a20 2020 2020 2020  ing set..       
+00001f80: 2020 2020 2065 7861 6374 6c79 206f 6e63       exactly onc
+00001f90: 650d 0a0d 0a20 2020 2020 2020 2065 6172  e....        ear
+00001fa0: 6c79 5f73 746f 7070 696e 6720 3a20 696e  ly_stopping : in
+00001fb0: 740d 0a20 2020 2020 2020 2020 2020 2050  t..            P
+00001fc0: 6174 6965 6e63 6520 7061 7261 6d65 7465  atience paramete
+00001fd0: 7220 666f 7220 6561 726c 7920 7374 6f70  r for early stop
+00001fe0: 7069 6e67 2e20 5370 6563 6966 6965 7320  ping. Specifies 
+00001ff0: 7468 6520 6e75 6d62 6572 0d0a 2020 2020  the number..    
+00002000: 2020 2020 2020 2020 6f66 2065 706f 6368          of epoch
+00002010: 7327 7320 6475 7269 6e67 2077 6869 6368  s's during which
+00002020: 2076 616c 6964 6174 696f 6e20 636f 7374   validation cost
+00002030: 2069 7320 616c 6c6f 7765 6420 746f 0d0a   is allowed to..
+00002040: 2020 2020 2020 2020 2020 2020 7269 7365              rise
+00002050: 2062 6566 6f72 6520 7472 6169 6e69 6e67   before training
+00002060: 2073 746f 7073 2e0d 0a0d 0a20 2020 2020   stops.....     
+00002070: 2020 206d 696e 5f64 656c 7461 203a 2066     min_delta : f
+00002080: 6c6f 6174 2c20 6f70 7469 6f6e 616c 0d0a  loat, optional..
+00002090: 2020 2020 2020 2020 2020 2020 436f 6e76              Conv
+000020a0: 6572 6765 6e63 6520 7468 7265 7368 6f6c  ergence threshol
+000020b0: 6420 666f 7220 7661 6c69 6461 7469 6f6e  d for validation
+000020c0: 2063 6f73 7420 6475 7269 6e67 2074 7261   cost during tra
+000020d0: 696e 696e 672e 0d0a 2020 2020 2020 2020  ining...        
+000020e0: 2020 2020 4465 6661 756c 7473 2074 6f20      Defaults to 
+000020f0: 3165 2d36 2e0d 0a0d 0a20 2020 2020 2020  1e-6.....       
+00002100: 206d 6f64 6520 3a20 7374 722c 206f 7074   mode : str, opt
+00002110: 696f 6e61 6c0d 0a20 2020 2020 2020 2020  ional..         
+00002120: 2020 2063 616e 2062 6520 2773 696e 676c     can be 'singl
+00002130: 655f 666f 6c64 272c 2027 6376 272c 2027  e_fold', 'cv', '
+00002140: 6c6f 736f 272e 2044 6566 6175 6c74 7320  loso'. Defaults 
+00002150: 746f 2027 7369 6e67 6c65 5f66 6f6c 6427  to 'single_fold'
+00002160: 0d0a 0d0a 2020 2020 2020 2020 636f 6c6c  ....        coll
+00002170: 6563 745f 7061 7474 6572 6e73 203a 2062  ect_patterns : b
+00002180: 6f6f 6c0d 0a20 2020 2020 2020 2020 2020  ool..           
+00002190: 2057 6865 7468 6572 2074 6f20 636f 6d70   Whether to comp
+000021a0: 7574 6520 616e 6420 7374 6f72 6520 7061  ute and store pa
+000021b0: 7474 6572 6e73 2061 6674 6572 2074 7261  tterns after tra
+000021c0: 696e 696e 6720 6561 6368 2066 6f6c 642e  ining each fold.
+000021d0: 0d0a 0d0a 2020 2020 2020 2020 636c 6173  ....        clas
+000021e0: 735f 7765 6967 6874 7320 3a20 4e6f 6e65  s_weights : None
+000021f0: 2c20 6469 6374 0d0a 2020 2020 2020 2020  , dict..        
+00002200: 2020 2020 5768 6574 6865 7220 746f 2061      Whether to a
+00002210: 7070 6c79 2063 7574 6f6d 2077 6567 6968  pply cutom wegih
+00002220: 7473 2066 726f 2065 6163 6820 636c 6173  ts fro each clas
+00002230: 730d 0a20 2020 2020 2020 2022 2222 0d0a  s..        """..
+00002240: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00002250: 2020 2020 6966 206e 6f74 2065 7661 6c5f      if not eval_
+00002260: 7374 6570 3a0d 0a20 2020 2020 2020 2020  step:..         
+00002270: 2020 2074 7261 696e 5f73 697a 6520 3d20     train_size = 
+00002280: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
+00002290: 6172 616d 735b 2774 7261 696e 5f73 697a  arams['train_siz
+000022a0: 6527 5d0d 0a20 2020 2020 2020 2020 2020  e']..           
+000022b0: 2065 7661 6c5f 7374 6570 203d 2074 7261   eval_step = tra
+000022c0: 696e 5f73 697a 6520 2f2f 2073 656c 662e  in_size // self.
+000022d0: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
+000022e0: 5b27 7472 6169 6e5f 6261 7463 6827 5d20  ['train_batch'] 
+000022f0: 2b20 310d 0a20 2020 2020 2020 200d 0a20  + 1..        .. 
+00002300: 2020 2020 2020 2074 7261 696e 5f70 6172         train_par
+00002310: 616d 7320 3d20 6469 6374 286e 5f65 706f  ams = dict(n_epo
+00002320: 6368 733d 6e5f 6570 6f63 6873 2c20 0d0a  chs=n_epochs, ..
+00002330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002340: 2020 2020 2020 2020 2020 2020 6576 616c              eval
+00002350: 5f73 7465 703d 6576 616c 5f73 7465 702c  _step=eval_step,
+00002360: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+00002370: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00002380: 6172 6c79 5f73 746f 7070 696e 673d 6561  arly_stopping=ea
+00002390: 726c 795f 7374 6f70 7069 6e67 2c20 0d0a  rly_stopping, ..
+000023a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000023b0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+000023c0: 3d6d 6f64 6529 0d0a 2020 2020 2020 2020  =mode)..        
+000023d0: 7365 6c66 2e6d 6574 612e 7570 6461 7465  self.meta.update
+000023e0: 2874 7261 696e 5f70 6172 616d 733d 7472  (train_params=tr
+000023f0: 6169 6e5f 7061 7261 6d73 290d 0a20 2020  ain_params)..   
+00002400: 2020 2020 2073 746f 705f 6561 726c 7920       stop_early 
+00002410: 3d20 7466 2e6b 6572 6173 2e63 616c 6c62  = tf.keras.callb
+00002420: 6163 6b73 2e45 6172 6c79 5374 6f70 7069  acks.EarlyStoppi
+00002430: 6e67 286d 6f6e 6974 6f72 3d27 7661 6c5f  ng(monitor='val_
+00002440: 6c6f 7373 272c 0d0a 2020 2020 2020 2020  loss',..        
+00002450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002470: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+00002480: 6e5f 6465 6c74 613d 6d69 6e5f 6465 6c74  n_delta=min_delt
+00002490: 612c 0d0a 2020 2020 2020 2020 2020 2020  a,..            
 000024a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000024b0: 7465 7374 5f62 6174 6368 3d73 656c 662e  test_batch=self.
-000024c0: 6461 7461 7365 742e 7661 6c69 6461 7469  dataset.validati
-000024d0: 6f6e 5f62 6174 6368 2c0d 0a20 2020 2020  on_batch,..     
-000024e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000024f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002500: 2020 2020 2020 2020 2020 7370 6c69 743d            split=
-00002510: 5472 7565 2c20 7661 6c5f 666f 6c64 5f69  True, val_fold_i
-00002520: 6e64 3d30 290d 0a0d 0a20 2020 2020 2020  nd=0)....       
-00002530: 2020 2020 2073 656c 662e 745f 6869 7374       self.t_hist
-00002540: 203d 2073 656c 662e 6b6d 2e66 6974 2874   = self.km.fit(t
-00002550: 7261 696e 2c0d 0a20 2020 2020 2020 2020  rain,..         
-00002560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002570: 2020 2020 2020 2020 2020 7661 6c69 6461            valida
-00002580: 7469 6f6e 5f64 6174 613d 7661 6c2c 0d0a  tion_data=val,..
-00002590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000025a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000025b0: 2020 2065 706f 6368 733d 7365 6c66 2e6d     epochs=self.m
-000025c0: 6574 612e 7472 6169 6e5f 7061 7261 6d73  eta.train_params
-000025d0: 5b27 6e5f 6570 6f63 6873 275d 2c20 0d0a  ['n_epochs'], ..
-000025e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000025f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002600: 2020 2073 7465 7073 5f70 6572 5f65 706f     steps_per_epo
-00002610: 6368 3d73 656c 662e 6d65 7461 2e74 7261  ch=self.meta.tra
-00002620: 696e 5f70 6172 616d 735b 2765 7661 6c5f  in_params['eval_
-00002630: 7374 6570 275d 2c0d 0a20 2020 2020 2020  step'],..       
-00002640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002650: 2020 2020 2020 2020 2020 2020 7368 7566              shuf
-00002660: 666c 653d 5472 7565 2c0d 0a20 2020 2020  fle=True,..     
-00002670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002680: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00002690: 6c69 6461 7469 6f6e 5f73 7465 7073 3d73  lidation_steps=s
-000026a0: 656c 662e 6461 7461 7365 742e 7661 6c69  elf.dataset.vali
-000026b0: 6461 7469 6f6e 5f73 7465 7073 2c0d 0a0d  dation_steps,...
-000026c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000026d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000026e0: 2020 2020 6361 6c6c 6261 636b 733d 5b73      callbacks=[s
-000026f0: 746f 705f 6561 726c 795d 2c20 7665 7262  top_early], verb
-00002700: 6f73 653d 322c 0d0a 2020 2020 2020 2020  ose=2,..        
-00002710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002720: 2020 2020 2020 2020 2020 2063 6c61 7373             class
-00002730: 5f77 6569 6768 743d 636c 6173 735f 7765  _weight=class_we
-00002740: 6967 6874 7329 0d0a 0d0a 2020 2020 2020  ights)....      
-00002750: 2020 2020 2020 2363 6f6d 7075 7465 2076        #compute v
-00002760: 616c 6964 6174 696f 6e20 6c6f 7373 2061  alidation loss a
-00002770: 6e64 206d 6574 7269 630d 0a20 2020 2020  nd metric..     
-00002780: 2020 2020 2020 2076 5f6c 6f73 732c 2076         v_loss, v
-00002790: 5f6d 6574 7269 6320 3d20 7365 6c66 2e65  _metric = self.e
-000027a0: 7661 6c75 6174 6528 7365 6c66 2e64 6174  valuate(self.dat
-000027b0: 6173 6574 2e76 616c 290d 0a0d 0a20 2020  aset.val)....   
-000027c0: 2020 2020 2020 2020 2073 656c 662e 6376           self.cv
-000027d0: 5f6c 6f73 7365 732e 6170 7065 6e64 2876  _losses.append(v
-000027e0: 5f6c 6f73 7329 0d0a 2020 2020 2020 2020  _loss)..        
-000027f0: 2020 2020 7365 6c66 2e63 765f 6d65 7472      self.cv_metr
-00002800: 6963 732e 6170 7065 6e64 2876 5f6d 6574  ics.append(v_met
-00002810: 7269 6329 0d0a 0d0a 2020 2020 2020 2020  ric)....        
-00002820: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
-00002830: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
-00002840: 5b27 7465 7374 5f70 6174 6873 275d 293a  ['test_paths']):
-00002850: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00002860: 2020 2020 2020 745f 6c6f 7373 2c20 745f        t_loss, t_
-00002870: 6d65 7472 6963 203d 2073 656c 662e 6576  metric = self.ev
-00002880: 616c 7561 7465 2873 656c 662e 6461 7461  aluate(self.data
-00002890: 7365 742e 685f 7061 7261 6d73 5b27 7465  set.h_params['te
-000028a0: 7374 5f70 6174 6873 275d 290d 0a20 2020  st_paths'])..   
-000028b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000028c0: 2023 2070 7269 6e74 2822 2222 5465 7374   # print("""Test
-000028d0: 2070 6572 666f 726d 616e 6365 3a0d 0a20   performance:.. 
-000028e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000028f0: 2020 2023 2020 2020 2020 204c 6f73 733a     #       Loss:
-00002900: 207b 3a2e 3466 7d20 0d0a 2020 2020 2020   {:.4f} ..      
-00002910: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00002920: 2020 2020 2020 4d65 7472 6963 3a20 7b3a        Metric: {:
-00002930: 2e34 667d 2222 222e 666f 726d 6174 2874  .4f}""".format(t
-00002940: 5f6c 6f73 732c 2074 5f6d 6574 7269 6329  _loss, t_metric)
-00002950: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00002960: 2020 2020 2020 2073 656c 662e 6376 5f74         self.cv_t
-00002970: 6573 745f 6c6f 7373 6573 2e61 7070 656e  est_losses.appen
-00002980: 6428 745f 6c6f 7373 290d 0a20 2020 2020  d(t_loss)..     
-00002990: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000029a0: 656c 662e 6376 5f74 6573 745f 6d65 7472  elf.cv_test_metr
-000029b0: 6963 732e 6170 7065 6e64 2874 5f6d 6574  ics.append(t_met
-000029c0: 7269 6329 0d0a 0d0a 2020 2020 2020 2020  ric)....        
-000029d0: 2020 2020 2363 6f6d 7075 7465 2073 7065      #compute spe
-000029e0: 6369 6669 6320 6d65 7472 6963 7320 666f  cific metrics fo
-000029f0: 7220 636c 6173 7369 6669 6361 7469 6f6e  r classification
-00002a00: 2061 6e64 2072 6567 7265 7373 7369 6f6e   and regresssion
-00002a10: 0d0a 2020 2020 2020 2020 2020 2020 795f  ..            y_
-00002a20: 7472 7565 2c20 795f 7072 6564 203d 2073  true, y_pred = s
-00002a30: 656c 662e 7072 6564 6963 7428 7365 6c66  elf.predict(self
-00002a40: 2e64 6174 6173 6574 2e76 616c 290d 0a20  .dataset.val).. 
-00002a50: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00002a60: 6c66 2e64 6174 6173 6574 2e68 5f70 6172  lf.dataset.h_par
-00002a70: 616d 735b 2774 6172 6765 745f 7479 7065  ams['target_type
-00002a80: 275d 203d 3d20 2766 6c6f 6174 273a 0d0a  '] == 'float':..
+000024b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000024c0: 2020 2020 2020 2020 2020 7061 7469 656e            patien
+000024d0: 6365 3d73 656c 662e 6d65 7461 2e74 7261  ce=self.meta.tra
+000024e0: 696e 5f70 6172 616d 735b 2765 6172 6c79  in_params['early
+000024f0: 5f73 746f 7070 696e 6727 5d2c 0d0a 2020  _stopping'],..  
+00002500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002530: 2020 2020 7265 7374 6f72 655f 6265 7374      restore_best
+00002540: 5f77 6569 6768 7473 3d54 7275 6529 0d0a  _weights=True)..
+00002550: 2020 2020 2020 2020 726d 7373 203d 2064          rmss = d
+00002560: 6566 6175 6c74 6469 6374 286c 6973 7429  efaultdict(list)
+00002570: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+00002580: 765f 6c6f 7373 6573 203d 205b 5d0d 0a20  v_losses = [].. 
+00002590: 2020 2020 2020 2073 656c 662e 6376 5f6d         self.cv_m
+000025a0: 6574 7269 6373 203d 205b 5d0d 0a20 2020  etrics = []..   
+000025b0: 2020 2020 2073 656c 662e 6376 5f74 6573       self.cv_tes
+000025c0: 745f 6c6f 7373 6573 203d 205b 5d0d 0a20  t_losses = [].. 
+000025d0: 2020 2020 2020 2073 656c 662e 6376 5f74         self.cv_t
+000025e0: 6573 745f 6d65 7472 6963 7320 3d20 5b5d  est_metrics = []
+000025f0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00002600: 2020 2020 6966 2063 6c61 7373 5f77 6569      if class_wei
+00002610: 6768 7473 3a0d 0a20 2020 2020 2020 2020  ghts:..         
+00002620: 2020 206d 756c 7469 706c 6965 7220 3d20     multiplier = 
+00002630: 312e 202f 206d 696e 2863 6c61 7373 5f77  1. / min(class_w
+00002640: 6569 6768 7473 2e76 616c 7565 7328 2929  eights.values())
+00002650: 0d0a 2020 2020 2020 2020 2020 2020 636c  ..            cl
+00002660: 6173 735f 7765 6967 6874 7320 3d20 7b6b  ass_weights = {k
+00002670: 3a76 2a6d 756c 7469 706c 6965 7220 666f  :v*multiplier fo
+00002680: 7220 6b2c 7620 696e 2063 6c61 7373 5f77  r k,v in class_w
+00002690: 6569 6768 7473 2e69 7465 6d73 2829 7d0d  eights.items()}.
+000026a0: 0a0d 0a20 2020 2020 2020 2065 6c73 653a  ...        else:
+000026b0: 0d0a 2020 2020 2020 2020 2020 2020 636c  ..            cl
+000026c0: 6173 735f 7765 6967 6874 7320 3d20 4e6f  ass_weights = No
+000026d0: 6e65 0d0a 2020 2020 2020 2020 7072 696e  ne..        prin
+000026e0: 7428 2243 6c61 7373 2077 6569 6768 7473  t("Class weights
+000026f0: 3a20 222c 2063 6c61 7373 5f77 6569 6768  : ", class_weigh
+00002700: 7473 290d 0a20 2020 2020 2020 2069 6620  ts)..        if 
+00002710: 6d6f 6465 203d 3d20 2773 696e 676c 655f  mode == 'single_
+00002720: 666f 6c64 273a 0d0a 2020 2020 2020 2020  fold':..        
+00002730: 2020 2020 6e5f 666f 6c64 7320 3d20 310d      n_folds = 1.
+00002740: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+00002750: 696e 2c20 7661 6c20 3d20 7365 6c66 2e64  in, val = self.d
+00002760: 6174 6173 6574 2e5f 6275 696c 645f 6461  ataset._build_da
+00002770: 7461 7365 7428 7365 6c66 2e64 6174 6173  taset(self.datas
+00002780: 6574 2e68 5f70 6172 616d 735b 2774 7261  et.h_params['tra
+00002790: 696e 5f70 6174 6873 275d 2c0d 0a20 2020  in_paths'],..   
+000027a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000027b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000027c0: 2020 2020 2020 2020 2020 2020 7472 6169              trai
+000027d0: 6e5f 6261 7463 683d 7365 6c66 2e64 6174  n_batch=self.dat
+000027e0: 6173 6574 2e74 7261 696e 696e 675f 6261  aset.training_ba
+000027f0: 7463 682c 0d0a 2020 2020 2020 2020 2020  tch,..          
+00002800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002820: 2020 2020 2074 6573 745f 6261 7463 683d       test_batch=
+00002830: 7365 6c66 2e64 6174 6173 6574 2e76 616c  self.dataset.val
+00002840: 6964 6174 696f 6e5f 6261 7463 682c 0d0a  idation_batch,..
+00002850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002870: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00002880: 706c 6974 3d54 7275 652c 2076 616c 5f66  plit=True, val_f
+00002890: 6f6c 645f 696e 643d 3029 0d0a 0d0a 2020  old_ind=0)....  
+000028a0: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
+000028b0: 5f68 6973 7420 3d20 7365 6c66 2e6b 6d2e  _hist = self.km.
+000028c0: 6669 7428 7472 6169 6e2c 0d0a 2020 2020  fit(train,..    
+000028d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000028e0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+000028f0: 616c 6964 6174 696f 6e5f 6461 7461 3d76  alidation_data=v
+00002900: 616c 2c0d 0a20 2020 2020 2020 2020 2020  al,..           
+00002910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002920: 2020 2020 2020 2020 6570 6f63 6873 3d73          epochs=s
+00002930: 656c 662e 6d65 7461 2e74 7261 696e 5f70  elf.meta.train_p
+00002940: 6172 616d 735b 276e 5f65 706f 6368 7327  arams['n_epochs'
+00002950: 5d2c 200d 0a20 2020 2020 2020 2020 2020  ], ..           
+00002960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002970: 2020 2020 2020 2020 7374 6570 735f 7065          steps_pe
+00002980: 725f 6570 6f63 683d 7365 6c66 2e6d 6574  r_epoch=self.met
+00002990: 612e 7472 6169 6e5f 7061 7261 6d73 5b27  a.train_params['
+000029a0: 6576 616c 5f73 7465 7027 5d2c 0d0a 2020  eval_step'],..  
+000029b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000029c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000029d0: 2073 6875 6666 6c65 3d54 7275 652c 0d0a   shuffle=True,..
+000029e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000029f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002a00: 2020 2076 616c 6964 6174 696f 6e5f 7374     validation_st
+00002a10: 6570 733d 7365 6c66 2e64 6174 6173 6574  eps=self.dataset
+00002a20: 2e76 616c 6964 6174 696f 6e5f 7374 6570  .validation_step
+00002a30: 732c 0d0a 0d0a 2020 2020 2020 2020 2020  s,....          
+00002a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002a50: 2020 2020 2020 2020 2063 616c 6c62 6163           callbac
+00002a60: 6b73 3d5b 7374 6f70 5f65 6172 6c79 5d2c  ks=[stop_early],
+00002a70: 2076 6572 626f 7365 3d32 2c0d 0a20 2020   verbose=2,..   
+00002a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00002a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002aa0: 726d 7320 3d20 7265 6772 6573 7369 6f6e  rms = regression
-00002ab0: 5f6d 6574 7269 6373 2879 5f74 7275 652c  _metrics(y_true,
-00002ac0: 2079 5f70 7265 6429 0d0a 2020 2020 2020   y_pred)..      
-00002ad0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00002ae0: 2256 616c 6964 6174 696f 6e20 7365 743a  "Validation set:
-00002af0: 2043 6f72 7220 3d22 2c20 726d 735b 2763   Corr =", rms['c
-00002b00: 6327 5d2c 2022 2052 3220 3d22 2c20 726d  c'], " R2 =", rm
-00002b10: 735b 2772 3227 5d29 0d0a 2020 2020 2020  s['r2'])..      
-00002b20: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00002b30: 2020 2020 2020 2020 2020 2020 2072 6d73               rms
-00002b40: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-00002b50: 2020 2020 2020 2020 2073 656c 662e 636d           self.cm
-00002b60: 202b 3d20 7365 6c66 2e5f 636f 6e66 7573   += self._confus
-00002b70: 696f 6e5f 6d61 7472 6978 2879 5f74 7275  ion_matrix(y_tru
-00002b80: 652c 2079 5f70 7265 6429 0d0a 0d0a 2020  e, y_pred)....  
-00002b90: 2020 2020 2020 2020 2020 6966 2063 6f6c            if col
-00002ba0: 6c65 6374 5f70 6174 7465 726e 7320 616e  lect_patterns an
-00002bb0: 6420 7365 6c66 2e73 636f 7065 203d 3d20  d self.scope == 
-00002bc0: 276c 6663 6e6e 273a 0d0a 2020 2020 2020  'lfcnn':..      
-00002bd0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00002be0: 6f6c 6c65 6374 5f70 6174 7465 726e 7328  ollect_patterns(
-00002bf0: 666f 6c64 3d30 2c20 6e5f 666f 6c64 733d  fold=0, n_folds=
-00002c00: 6e5f 666f 6c64 732c 206e 5f63 6f6d 703d  n_folds, n_comp=
-00002c10: 696e 7428 636f 6c6c 6563 745f 7061 7474  int(collect_patt
-00002c20: 6572 6e73 2929 0d0a 0d0a 2020 2020 2020  erns))....      
-00002c30: 2020 656c 6966 206d 6f64 6520 3d3d 2027    elif mode == '
-00002c40: 6376 273a 0d0a 0d0a 2020 2020 2020 2020  cv':....        
-00002c50: 2020 2020 6e5f 666f 6c64 7320 3d20 6c65      n_folds = le
-00002c60: 6e28 7365 6c66 2e64 6174 6173 6574 2e68  n(self.dataset.h
-00002c70: 5f70 6172 616d 735b 2766 6f6c 6473 275d  _params['folds']
-00002c80: 5b30 5d29 0d0a 2020 2020 2020 2020 2020  [0])..          
-00002c90: 2020 7072 696e 7428 2252 756e 6e69 6e67    print("Running
-00002ca0: 2063 726f 7373 2d76 616c 6964 6174 696f   cross-validatio
-00002cb0: 6e20 7769 7468 207b 7d20 666f 6c64 7322  n with {} folds"
-00002cc0: 2e66 6f72 6d61 7428 6e5f 666f 6c64 7329  .format(n_folds)
-00002cd0: 290d 0a0d 0a0d 0a20 2020 2020 2020 2020  )......         
-00002ce0: 2020 2066 6f72 206a 6a20 696e 2072 616e     for jj in ran
-00002cf0: 6765 286e 5f66 6f6c 6473 293a 0d0a 2020  ge(n_folds):..  
-00002d00: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00002d10: 696e 7428 2266 6f6c 643a 222c 206a 6a29  int("fold:", jj)
-00002d20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00002d30: 2020 7472 6169 6e2c 2076 616c 203d 2073    train, val = s
-00002d40: 656c 662e 6461 7461 7365 742e 5f62 7569  elf.dataset._bui
-00002d50: 6c64 5f64 6174 6173 6574 2873 656c 662e  ld_dataset(self.
-00002d60: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
-00002d70: 5b27 7472 6169 6e5f 7061 7468 7327 5d2c  ['train_paths'],
-00002d80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00002d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002db0: 2020 2020 2074 7261 696e 5f62 6174 6368       train_batch
-00002dc0: 3d73 656c 662e 6461 7461 7365 742e 7472  =self.dataset.tr
-00002dd0: 6169 6e69 6e67 5f62 6174 6368 2c0d 0a20  aining_batch,.. 
-00002de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e10: 2020 7465 7374 5f62 6174 6368 3d73 656c    test_batch=sel
-00002e20: 662e 6461 7461 7365 742e 7661 6c69 6461  f.dataset.valida
-00002e30: 7469 6f6e 5f62 6174 6368 2c0d 0a20 2020  tion_batch,..   
-00002e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e70: 7370 6c69 743d 5472 7565 2c20 7661 6c5f  split=True, val_
-00002e80: 666f 6c64 5f69 6e64 3d6a 6a29 0d0a 2020  fold_ind=jj)..  
-00002e90: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00002ea0: 6c66 2e74 5f68 6973 7420 3d20 7365 6c66  lf.t_hist = self
-00002eb0: 2e6b 6d2e 6669 7428 7472 6169 6e2c 0d0a  .km.fit(train,..
-00002ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ee0: 2020 2076 616c 6964 6174 696f 6e5f 6461     validation_da
-00002ef0: 7461 3d76 616c 2c0d 0a20 2020 2020 2020  ta=val,..       
-00002f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f10: 2020 2020 2020 2020 2020 2020 6570 6f63              epoc
-00002f20: 6873 3d73 656c 662e 6d65 7461 2e74 7261  hs=self.meta.tra
-00002f30: 696e 5f70 6172 616d 735b 276e 5f65 706f  in_params['n_epo
-00002f40: 6368 7327 5d2c 200d 0a20 2020 2020 2020  chs'], ..       
-00002f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f60: 2020 2020 2020 2020 2020 2020 7374 6570              step
-00002f70: 735f 7065 725f 6570 6f63 683d 7365 6c66  s_per_epoch=self
-00002f80: 2e6d 6574 612e 7472 6169 6e5f 7061 7261  .meta.train_para
-00002f90: 6d73 5b27 6576 616c 5f73 7465 7027 5d2c  ms['eval_step'],
-00002fa0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00002fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fc0: 2020 2020 2073 6875 6666 6c65 3d54 7275       shuffle=Tru
-00002fd0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00002fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ff0: 2020 2020 2020 2076 616c 6964 6174 696f         validatio
-00003000: 6e5f 7374 6570 733d 7365 6c66 2e64 6174  n_steps=self.dat
-00003010: 6173 6574 2e76 616c 6964 6174 696f 6e5f  aset.validation_
-00003020: 7374 6570 732c 0d0a 2020 2020 2020 2020  steps,..        
-00003030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003040: 2020 2020 2020 2020 2020 2063 616c 6c62             callb
-00003050: 6163 6b73 3d5b 7374 6f70 5f65 6172 6c79  acks=[stop_early
-00003060: 5d2c 2076 6572 626f 7365 3d32 2c0d 0a20  ], verbose=2,.. 
-00003070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003090: 2020 636c 6173 735f 7765 6967 6874 3d63    class_weight=c
-000030a0: 6c61 7373 5f77 6569 6768 7473 290d 0a0d  lass_weights)...
-000030b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000030c0: 2076 5f6c 6f73 732c 2076 5f6d 6574 7269   v_loss, v_metri
-000030d0: 6320 3d20 7365 6c66 2e65 7661 6c75 6174  c = self.evaluat
-000030e0: 6528 7661 6c29 0d0a 2020 2020 2020 2020  e(val)..        
-000030f0: 2020 2020 2020 2020 7365 6c66 2e63 765f          self.cv_
-00003100: 6c6f 7373 6573 2e61 7070 656e 6428 765f  losses.append(v_
-00003110: 6c6f 7373 290d 0a20 2020 2020 2020 2020  loss)..         
-00003120: 2020 2020 2020 2073 656c 662e 6376 5f6d         self.cv_m
-00003130: 6574 7269 6373 2e61 7070 656e 6428 765f  etrics.append(v_
-00003140: 6d65 7472 6963 290d 0a20 2020 2020 2020  metric)..       
-00003150: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00003160: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
-00003170: 6172 616d 735b 2774 6573 745f 7061 7468  arams['test_path
-00003180: 7327 5d29 3a0d 0a20 2020 2020 2020 2020  s']):..         
-00003190: 2020 2020 2020 2020 2020 2074 5f6c 6f73             t_los
-000031a0: 732c 2074 5f6d 6574 7269 6320 3d20 7365  s, t_metric = se
-000031b0: 6c66 2e65 7661 6c75 6174 6528 7365 6c66  lf.evaluate(self
-000031c0: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
-000031d0: 735b 2774 6573 745f 7061 7468 7327 5d29  s['test_paths'])
-000031e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000031f0: 2020 2020 2020 7072 696e 7428 2222 2254        print("""T
-00003200: 6573 7420 7065 7266 6f72 6d61 6e63 653a  est performance:
-00003210: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003220: 2020 2020 2020 2020 2020 2020 4c6f 7373              Loss
-00003230: 3a20 7b3a 2e34 667d 200d 0a20 2020 2020  : {:.4f} ..     
-00003240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003250: 2020 2020 204d 6574 7269 633a 207b 3a2e       Metric: {:.
-00003260: 3466 7d22 2222 2e66 6f72 6d61 7428 745f  4f}""".format(t_
-00003270: 6c6f 7373 2c20 745f 6d65 7472 6963 2929  loss, t_metric))
-00003280: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003290: 2020 2020 2020 7365 6c66 2e63 765f 7465        self.cv_te
-000032a0: 7374 5f6c 6f73 7365 732e 6170 7065 6e64  st_losses.append
-000032b0: 2874 5f6c 6f73 7329 0d0a 2020 2020 2020  (t_loss)..      
-000032c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000032d0: 6c66 2e63 765f 7465 7374 5f6d 6574 7269  lf.cv_test_metri
-000032e0: 6373 2e61 7070 656e 6428 745f 6d65 7472  cs.append(t_metr
-000032f0: 6963 290d 0a0d 0a20 2020 2020 2020 2020  ic)....         
-00003300: 2020 2020 2020 2079 5f74 7275 652c 2079         y_true, y
-00003310: 5f70 7265 6420 3d20 7365 6c66 2e70 7265  _pred = self.pre
-00003320: 6469 6374 2876 616c 290d 0a0d 0a20 2020  dict(val)....   
-00003330: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00003340: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
-00003350: 6172 616d 735b 2774 6172 6765 745f 7479  arams['target_ty
-00003360: 7065 275d 203d 3d20 2766 6c6f 6174 273a  pe'] == 'float':
-00003370: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003380: 2020 2020 2020 726d 7320 3d20 7265 6772        rms = regr
-00003390: 6573 7369 6f6e 5f6d 6574 7269 6373 2879  ession_metrics(y
-000033a0: 5f74 7275 652c 2079 5f70 7265 6429 0d0a  _true, y_pred)..
+00002aa0: 636c 6173 735f 7765 6967 6874 3d63 6c61  class_weight=cla
+00002ab0: 7373 5f77 6569 6768 7473 290d 0a20 2020  ss_weights)..   
+00002ac0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+00002ad0: 7461 2e74 7261 696e 5f70 6172 616d 732e  ta.train_params.
+00002ae0: 7570 6461 7465 287b 2274 7261 696e 6564  update({"trained
+00002af0: 223a 5472 7565 7d29 0d0a 0d0a 2020 2020  ":True})....    
+00002b00: 2020 2020 2020 2020 2363 6f6d 7075 7465          #compute
+00002b10: 2076 616c 6964 6174 696f 6e20 6c6f 7373   validation loss
+00002b20: 2061 6e64 206d 6574 7269 630d 0a20 2020   and metric..   
+00002b30: 2020 2020 2020 2020 2076 5f6c 6f73 732c           v_loss,
+00002b40: 2076 5f6d 6574 7269 6320 3d20 7365 6c66   v_metric = self
+00002b50: 2e65 7661 6c75 6174 6528 7365 6c66 2e64  .evaluate(self.d
+00002b60: 6174 6173 6574 2e76 616c 290d 0a0d 0a20  ataset.val).... 
+00002b70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00002b80: 6376 5f6c 6f73 7365 732e 6170 7065 6e64  cv_losses.append
+00002b90: 2876 5f6c 6f73 7329 0d0a 2020 2020 2020  (v_loss)..      
+00002ba0: 2020 2020 2020 7365 6c66 2e63 765f 6d65        self.cv_me
+00002bb0: 7472 6963 732e 6170 7065 6e64 2876 5f6d  trics.append(v_m
+00002bc0: 6574 7269 6329 0d0a 0d0a 2020 2020 2020  etric)....      
+00002bd0: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
+00002be0: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
+00002bf0: 6d73 5b27 7465 7374 5f70 6174 6873 275d  ms['test_paths']
+00002c00: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00002c10: 2020 2020 2020 2020 745f 6c6f 7373 2c20          t_loss, 
+00002c20: 745f 6d65 7472 6963 203d 2073 656c 662e  t_metric = self.
+00002c30: 6576 616c 7561 7465 2873 656c 662e 6461  evaluate(self.da
+00002c40: 7461 7365 742e 685f 7061 7261 6d73 5b27  taset.h_params['
+00002c50: 7465 7374 5f70 6174 6873 275d 290d 0a20  test_paths']).. 
+00002c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002c70: 2020 2023 2070 7269 6e74 2822 2222 5465     # print("""Te
+00002c80: 7374 2070 6572 666f 726d 616e 6365 3a0d  st performance:.
+00002c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002ca0: 2020 2020 2023 2020 2020 2020 204c 6f73       #       Los
+00002cb0: 733a 207b 3a2e 3466 7d20 0d0a 2020 2020  s: {:.4f} ..    
+00002cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002cd0: 2320 2020 2020 2020 4d65 7472 6963 3a20  #       Metric: 
+00002ce0: 7b3a 2e34 667d 2222 222e 666f 726d 6174  {:.4f}""".format
+00002cf0: 2874 5f6c 6f73 732c 2074 5f6d 6574 7269  (t_loss, t_metri
+00002d00: 6329 290d 0a20 2020 2020 2020 2020 2020  c))..           
+00002d10: 2020 2020 2020 2020 2073 656c 662e 6376           self.cv
+00002d20: 5f74 6573 745f 6c6f 7373 6573 2e61 7070  _test_losses.app
+00002d30: 656e 6428 745f 6c6f 7373 290d 0a20 2020  end(t_loss)..   
+00002d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d50: 2073 656c 662e 6376 5f74 6573 745f 6d65   self.cv_test_me
+00002d60: 7472 6963 732e 6170 7065 6e64 2874 5f6d  trics.append(t_m
+00002d70: 6574 7269 6329 0d0a 0d0a 2020 2020 2020  etric)....      
+00002d80: 2020 2020 2020 2363 6f6d 7075 7465 2073        #compute s
+00002d90: 7065 6369 6669 6320 6d65 7472 6963 7320  pecific metrics 
+00002da0: 666f 7220 636c 6173 7369 6669 6361 7469  for classificati
+00002db0: 6f6e 2061 6e64 2072 6567 7265 7373 7369  on and regresssi
+00002dc0: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
+00002dd0: 795f 7472 7565 2c20 795f 7072 6564 203d  y_true, y_pred =
+00002de0: 2073 656c 662e 7072 6564 6963 7428 7365   self.predict(se
+00002df0: 6c66 2e64 6174 6173 6574 2e76 616c 290d  lf.dataset.val).
+00002e00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00002e10: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
+00002e20: 6172 616d 735b 2774 6172 6765 745f 7479  arams['target_ty
+00002e30: 7065 275d 203d 3d20 2766 6c6f 6174 273a  pe'] == 'float':
+00002e40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00002e50: 2020 726d 7320 3d20 7265 6772 6573 7369    rms = regressi
+00002e60: 6f6e 5f6d 6574 7269 6373 2879 5f74 7275  on_metrics(y_tru
+00002e70: 652c 2079 5f70 7265 6429 0d0a 2020 2020  e, y_pred)..    
+00002e80: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00002e90: 7428 2256 616c 6964 6174 696f 6e20 7365  t("Validation se
+00002ea0: 743a 2043 6f72 7220 3d22 2c20 726d 735b  t: Corr =", rms[
+00002eb0: 2763 6327 5d2c 2022 2052 3220 3d22 2c20  'cc'], " R2 =", 
+00002ec0: 726d 735b 2772 3227 5d29 0d0a 2020 2020  rms['r2'])..    
+00002ed0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00002ee0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00002ef0: 6d73 203d 204e 6f6e 650d 0a20 2020 2020  ms = None..     
+00002f00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00002f10: 636d 202b 3d20 7365 6c66 2e5f 636f 6e66  cm += self._conf
+00002f20: 7573 696f 6e5f 6d61 7472 6978 2879 5f74  usion_matrix(y_t
+00002f30: 7275 652c 2079 5f70 7265 6429 0d0a 0d0a  rue, y_pred)....
+00002f40: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00002f50: 6f6c 6c65 6374 5f70 6174 7465 726e 7320  ollect_patterns 
+00002f60: 616e 6420 7365 6c66 2e73 636f 7065 203d  and self.scope =
+00002f70: 3d20 276c 6663 6e6e 273a 0d0a 2020 2020  = 'lfcnn':..    
+00002f80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00002f90: 2e63 6f6c 6c65 6374 5f70 6174 7465 726e  .collect_pattern
+00002fa0: 7328 666f 6c64 3d30 2c20 6e5f 666f 6c64  s(fold=0, n_fold
+00002fb0: 733d 6e5f 666f 6c64 732c 206e 5f63 6f6d  s=n_folds, n_com
+00002fc0: 703d 696e 7428 636f 6c6c 6563 745f 7061  p=int(collect_pa
+00002fd0: 7474 6572 6e73 2929 0d0a 0d0a 2020 2020  tterns))....    
+00002fe0: 2020 2020 656c 6966 206d 6f64 6520 3d3d      elif mode ==
+00002ff0: 2027 6376 273a 0d0a 2020 2020 2020 2020   'cv':..        
+00003000: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
+00003010: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+00003020: 6e5f 666f 6c64 7320 3d20 6c65 6e28 7365  n_folds = len(se
+00003030: 6c66 2e64 6174 6173 6574 2e68 5f70 6172  lf.dataset.h_par
+00003040: 616d 735b 2766 6f6c 6473 275d 5b30 5d29  ams['folds'][0])
+00003050: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+00003060: 696e 7428 2252 756e 6e69 6e67 2063 726f  int("Running cro
+00003070: 7373 2d76 616c 6964 6174 696f 6e20 7769  ss-validation wi
+00003080: 7468 207b 7d20 666f 6c64 7322 2e66 6f72  th {} folds".for
+00003090: 6d61 7428 6e5f 666f 6c64 7329 290d 0a0d  mat(n_folds))...
+000030a0: 0a0d 0a20 2020 2020 2020 2020 2020 2066  ...            f
+000030b0: 6f72 206a 6a20 696e 2072 616e 6765 286e  or jj in range(n
+000030c0: 5f66 6f6c 6473 293a 0d0a 2020 2020 2020  _folds):..      
+000030d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000030e0: 2266 6f6c 643a 222c 206a 6a29 0d0a 2020  "fold:", jj)..  
+000030f0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00003100: 6169 6e2c 2076 616c 203d 2073 656c 662e  ain, val = self.
+00003110: 6461 7461 7365 742e 5f62 7569 6c64 5f64  dataset._build_d
+00003120: 6174 6173 6574 2873 656c 662e 6461 7461  ataset(self.data
+00003130: 7365 742e 685f 7061 7261 6d73 5b27 7472  set.h_params['tr
+00003140: 6169 6e5f 7061 7468 7327 5d2c 0d0a 2020  ain_paths'],..  
+00003150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003180: 2074 7261 696e 5f62 6174 6368 3d73 656c   train_batch=sel
+00003190: 662e 6461 7461 7365 742e 7472 6169 6e69  f.dataset.traini
+000031a0: 6e67 5f62 6174 6368 2c0d 0a20 2020 2020  ng_batch,..     
+000031b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000031c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000031d0: 2020 2020 2020 2020 2020 2020 2020 7465                te
+000031e0: 7374 5f62 6174 6368 3d73 656c 662e 6461  st_batch=self.da
+000031f0: 7461 7365 742e 7661 6c69 6461 7469 6f6e  taset.validation
+00003200: 5f62 6174 6368 2c0d 0a20 2020 2020 2020  _batch,..       
+00003210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003230: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
+00003240: 743d 5472 7565 2c20 7661 6c5f 666f 6c64  t=True, val_fold
+00003250: 5f69 6e64 3d6a 6a29 0d0a 2020 2020 2020  _ind=jj)..      
+00003260: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
+00003270: 5f68 6973 7420 3d20 7365 6c66 2e6b 6d2e  _hist = self.km.
+00003280: 6669 7428 7472 6169 6e2c 0d0a 2020 2020  fit(train,..    
+00003290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000032a0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+000032b0: 616c 6964 6174 696f 6e5f 6461 7461 3d76  alidation_data=v
+000032c0: 616c 2c0d 0a20 2020 2020 2020 2020 2020  al,..           
+000032d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000032e0: 2020 2020 2020 2020 6570 6f63 6873 3d73          epochs=s
+000032f0: 656c 662e 6d65 7461 2e74 7261 696e 5f70  elf.meta.train_p
+00003300: 6172 616d 735b 276e 5f65 706f 6368 7327  arams['n_epochs'
+00003310: 5d2c 200d 0a20 2020 2020 2020 2020 2020  ], ..           
+00003320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003330: 2020 2020 2020 2020 7374 6570 735f 7065          steps_pe
+00003340: 725f 6570 6f63 683d 7365 6c66 2e6d 6574  r_epoch=self.met
+00003350: 612e 7472 6169 6e5f 7061 7261 6d73 5b27  a.train_params['
+00003360: 6576 616c 5f73 7465 7027 5d2c 0d0a 2020  eval_step'],..  
+00003370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003390: 2073 6875 6666 6c65 3d54 7275 652c 0d0a   shuffle=True,..
+000033a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000033b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000033c0: 2020 2020 666f 7220 6b2c 7620 696e 2072      for k,v in r
-000033d0: 6d73 2e69 7465 6d73 2829 3a0d 0a20 2020  ms.items():..   
-000033e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000033f0: 2020 2020 2072 6d73 735b 6b5d 2e61 7070       rmss[k].app
-00003400: 656e 6428 7629 0d0a 2020 2020 2020 2020  end(v)..        
-00003410: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00003420: 7428 2256 616c 6964 6174 696f 6e20 7365  t("Validation se
-00003430: 743a 2043 6f72 7220 3d22 2c20 726d 735b  t: Corr =", rms[
-00003440: 2763 6327 5d2c 2022 2052 3220 3d22 2c20  'cc'], " R2 =", 
-00003450: 726d 735b 2772 3227 5d29 0d0a 2020 2020  rms['r2'])..    
-00003460: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00003470: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00003480: 2020 2020 2020 2073 656c 662e 636d 202b         self.cm +
-00003490: 3d20 7365 6c66 2e5f 636f 6e66 7573 696f  = self._confusio
-000034a0: 6e5f 6d61 7472 6978 2879 5f74 7275 652c  n_matrix(y_true,
-000034b0: 2079 5f70 7265 6429 0d0a 2020 2020 2020   y_pred)..      
-000034c0: 2020 2020 2020 2020 2020 2020 2020 726d                rm
-000034d0: 7320 3d20 4e6f 6e65 0d0a 0d0a 2020 2020  s = None....    
-000034e0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-000034f0: 6f6c 6c65 6374 5f70 6174 7465 726e 7320  ollect_patterns 
-00003500: 616e 6420 7365 6c66 2e73 636f 7065 203d  and self.scope =
-00003510: 3d20 276c 6663 6e6e 273a 0d0a 2020 2020  = 'lfcnn':..    
-00003520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003530: 7365 6c66 2e63 6f6c 6c65 6374 5f70 6174  self.collect_pat
-00003540: 7465 726e 7328 666f 6c64 3d6a 6a2c 206e  terns(fold=jj, n
-00003550: 5f66 6f6c 6473 3d6e 5f66 6f6c 6473 2c0d  _folds=n_folds,.
-00003560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003580: 2020 2020 2020 2020 2020 206e 5f63 6f6d             n_com
-00003590: 703d 696e 7428 636f 6c6c 6563 745f 7061  p=int(collect_pa
-000035a0: 7474 6572 6e73 2929 0d0a 0d0a 0d0a 2020  tterns))......  
-000035b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000035c0: 206a 6a20 3c20 6e5f 666f 6c64 7320 2d20   jj < n_folds - 
-000035d0: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
-000035e0: 2020 2020 2020 2020 7365 6c66 2e73 6875          self.shu
-000035f0: 6666 6c65 5f77 6569 6768 7473 2829 0d0a  ffle_weights()..
+000033c0: 2020 2076 616c 6964 6174 696f 6e5f 7374     validation_st
+000033d0: 6570 733d 7365 6c66 2e64 6174 6173 6574  eps=self.dataset
+000033e0: 2e76 616c 6964 6174 696f 6e5f 7374 6570  .validation_step
+000033f0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+00003400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003410: 2020 2020 2020 2063 616c 6c62 6163 6b73         callbacks
+00003420: 3d5b 7374 6f70 5f65 6172 6c79 5d2c 2076  =[stop_early], v
+00003430: 6572 626f 7365 3d32 2c0d 0a20 2020 2020  erbose=2,..     
+00003440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003450: 2020 2020 2020 2020 2020 2020 2020 636c                cl
+00003460: 6173 735f 7765 6967 6874 3d63 6c61 7373  ass_weight=class
+00003470: 5f77 6569 6768 7473 290d 0a20 2020 2020  _weights)..     
+00003480: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+00003490: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000034a0: 662e 6d65 7461 2e74 7261 696e 5f70 6172  f.meta.train_par
+000034b0: 616d 732e 7570 6461 7465 287b 2274 7261  ams.update({"tra
+000034c0: 696e 6564 223a 5472 7565 7d29 0d0a 2020  ined":True})..  
+000034d0: 2020 2020 2020 2020 2020 2020 2020 765f                v_
+000034e0: 6c6f 7373 2c20 765f 6d65 7472 6963 203d  loss, v_metric =
+000034f0: 2073 656c 662e 6576 616c 7561 7465 2876   self.evaluate(v
+00003500: 616c 290d 0a20 2020 2020 2020 2020 2020  al)..           
+00003510: 2020 2020 2073 656c 662e 6376 5f6c 6f73       self.cv_los
+00003520: 7365 732e 6170 7065 6e64 2876 5f6c 6f73  ses.append(v_los
+00003530: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+00003540: 2020 2020 7365 6c66 2e63 765f 6d65 7472      self.cv_metr
+00003550: 6963 732e 6170 7065 6e64 2876 5f6d 6574  ics.append(v_met
+00003560: 7269 6329 0d0a 2020 2020 2020 2020 2020  ric)..          
+00003570: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
+00003580: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
+00003590: 6d73 5b27 7465 7374 5f70 6174 6873 275d  ms['test_paths']
+000035a0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000035b0: 2020 2020 2020 2020 745f 6c6f 7373 2c20          t_loss, 
+000035c0: 745f 6d65 7472 6963 203d 2073 656c 662e  t_metric = self.
+000035d0: 6576 616c 7561 7465 2873 656c 662e 6461  evaluate(self.da
+000035e0: 7461 7365 742e 685f 7061 7261 6d73 5b27  taset.h_params['
+000035f0: 7465 7374 5f70 6174 6873 275d 290d 0a20  test_paths']).. 
 00003600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003610: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00003620: 2020 2020 2020 2020 2020 2022 4e6f 7420             "Not 
-00003630: 7368 7566 666c 696e 6720 7468 6520 7765  shuffling the we
-00003640: 6967 6874 7320 666f 7220 7468 6520 6c61  ights for the la
-00003650: 7374 2066 6f6c 6422 0d0a 0d0a 2020 2020  st fold"....    
-00003660: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00003670: 7428 2222 2246 6f6c 643a 207b 7d20 5661  t("""Fold: {} Va
-00003680: 6c69 6461 7469 6f6e 2070 6572 666f 726d  lidation perform
-00003690: 616e 6365 3a5c 6e0d 0a20 2020 2020 2020  ance:\n..       
-000036a0: 2020 2020 2020 2020 2020 2020 2020 204c                 L
-000036b0: 6f73 733a 207b 3a2e 3466 7d2c 200d 0a20  oss: {:.4f}, .. 
-000036c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000036d0: 2020 2020 204d 6574 7269 633a 207b 3a2e       Metric: {:.
-000036e0: 3466 7d22 2222 2e66 6f72 6d61 7428 6a6a  4f}""".format(jj
-000036f0: 2c20 765f 6c6f 7373 2c20 765f 6d65 7472  , v_loss, v_metr
-00003700: 6963 2929 0d0a 0d0a 2020 2020 2020 2020  ic))....        
-00003710: 2020 2020 6d65 7472 6963 7320 3d20 7365      metrics = se
-00003720: 6c66 2e63 765f 6d65 7472 6963 730d 0a20  lf.cv_metrics.. 
-00003730: 2020 2020 2020 2020 2020 206c 6f73 7365             losse
-00003740: 7320 3d20 7365 6c66 2e63 765f 6c6f 7373  s = self.cv_loss
-00003750: 6573 0d0a 0d0a 2020 2020 2020 2020 2020  es....          
-00003760: 2020 7072 696e 7428 227b 7d20 7769 7468    print("{} with
-00003770: 207b 7d20 666f 6c64 7320 636f 6d70 6c65   {} folds comple
-00003780: 7465 642e 204c 6f73 733a 207b 3a2e 3466  ted. Loss: {:.4f
-00003790: 7d20 2b2f 2d20 7b3a 2e34 667d 2e20 4d65  } +/- {:.4f}. Me
-000037a0: 7472 6963 3a20 7b3a 2e34 667d 202b 2f2d  tric: {:.4f} +/-
-000037b0: 207b 3a2e 3466 7d22 2e66 6f72 6d61 7428   {:.4f}".format(
-000037c0: 6d6f 6465 2c20 6e5f 666f 6c64 732c 206e  mode, n_folds, n
-000037d0: 702e 6d65 616e 286c 6f73 7365 7329 2c20  p.mean(losses), 
-000037e0: 6e70 2e73 7464 286c 6f73 7365 7329 2c20  np.std(losses), 
-000037f0: 6e70 2e6d 6561 6e28 6d65 7472 6963 7329  np.mean(metrics)
-00003800: 2c20 6e70 2e73 7464 286d 6574 7269 6373  , np.std(metrics
-00003810: 2929 290d 0a0d 0a20 2020 2020 2020 2020  )))....         
-00003820: 2020 2069 6620 7365 6c66 2e64 6174 6173     if self.datas
-00003830: 6574 2e68 5f70 6172 616d 735b 2774 6172  et.h_params['tar
-00003840: 6765 745f 7479 7065 275d 203d 3d20 2766  get_type'] == 'f
-00003850: 6c6f 6174 273a 0d0a 2020 2020 2020 2020  loat':..        
-00003860: 2020 2020 2020 2020 726d 7320 3d20 7b6b          rms = {k
-00003870: 3a6e 702e 6d65 616e 2876 2920 666f 7220  :np.mean(v) for 
-00003880: 6b2c 2076 2069 6e20 726d 7373 2e69 7465  k, v in rmss.ite
-00003890: 6d73 2829 7d0d 0a20 2020 2020 2020 2020  ms()}..         
-000038a0: 2020 2020 2020 2072 6d73 2e75 7064 6174         rms.updat
-000038b0: 6528 7b6b 202b 2027 5f73 7464 273a 6e70  e({k + '_std':np
-000038c0: 2e73 7464 2876 2920 666f 7220 6b2c 2076  .std(v) for k, v
-000038d0: 2069 6e20 726d 7373 2e69 7465 6d73 2829   in rmss.items()
-000038e0: 7d29 0d0a 2020 2020 2020 2020 2020 2020  })..            
-000038f0: 2020 2020 7072 696e 7428 2256 616c 6964      print("Valid
-00003900: 6174 696f 6e20 7365 743a 2043 6f72 7220  ation set: Corr 
-00003910: 3a20 7b3a 2e33 667d 202b 2f2d 207b 3a2e  : {:.3f} +/- {:.
-00003920: 3366 7d2e 205c 0d0a 2020 2020 2020 2020  3f}. \..        
-00003930: 2020 2020 2020 2020 2020 2020 2020 525e                R^
-00003940: 323a 207b 3a2e 3366 7d20 2b2f 2d20 7b3a  2: {:.3f} +/- {:
-00003950: 2e33 667d 222e 666f 726d 6174 280d 0a20  .3f}".format(.. 
-00003960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003970: 2020 2020 2072 6d73 5b27 6363 275d 2c20       rms['cc'], 
-00003980: 726d 735b 2763 635f 7374 6427 5d2c 2072  rms['cc_std'], r
-00003990: 6d73 5b27 7232 275d 2c20 726d 735b 2772  ms['r2'], rms['r
-000039a0: 325f 7374 6427 5d29 290d 0a20 2020 2020  2_std']))..     
-000039b0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-000039c0: 2020 2020 2020 2020 2020 2020 2020 726d                rm
-000039d0: 7320 3d20 4e6f 6e65 0d0a 0d0a 0d0a 2020  s = None......  
-000039e0: 2020 2020 2020 656c 6966 206d 6f64 6520        elif mode 
-000039f0: 3d3d 2022 6c6f 736f 223a 0d0a 2020 2020  == "loso":..    
-00003a00: 2020 2020 2020 2020 6e5f 666f 6c64 7320          n_folds 
-00003a10: 3d20 6c65 6e28 7365 6c66 2e64 6174 6173  = len(self.datas
-00003a20: 6574 2e68 5f70 6172 616d 735b 2774 7261  et.h_params['tra
-00003a30: 696e 5f70 6174 6873 275d 290d 0a20 2020  in_paths'])..   
-00003a40: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-00003a50: 5275 6e6e 696e 6720 6c65 6176 652d 6f6e  Running leave-on
-00003a60: 652d 7375 626a 6563 742d 6f75 7420 4356  e-subject-out CV
-00003a70: 2077 6974 6820 7b7d 2073 7562 6a65 6374   with {} subject
-00003a80: 222e 666f 726d 6174 286e 5f66 6f6c 6473  ".format(n_folds
-00003a90: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
-00003aa0: 2020 666f 7220 6a6a 2069 6e20 7261 6e67    for jj in rang
-00003ab0: 6528 6e5f 666f 6c64 7329 3a0d 0a20 2020  e(n_folds):..   
-00003ac0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00003ad0: 6e74 2822 666f 6c64 3a22 2c20 6a6a 290d  nt("fold:", jj).
-00003ae0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00003af0: 2020 2074 6573 745f 7375 626a 203d 2073     test_subj = s
-00003b00: 656c 662e 6461 7461 7365 742e 685f 7061  elf.dataset.h_pa
-00003b10: 7261 6d73 5b27 7472 6169 6e5f 7061 7468  rams['train_path
-00003b20: 7327 5d5b 6a6a 5d0d 0a20 2020 2020 2020  s'][jj]..       
-00003b30: 2020 2020 2020 2020 2074 7261 696e 5f73           train_s
-00003b40: 7562 6a73 203d 2073 656c 662e 6461 7461  ubjs = self.data
-00003b50: 7365 742e 685f 7061 7261 6d73 5b27 7472  set.h_params['tr
-00003b60: 6169 6e5f 7061 7468 7327 5d2e 636f 7079  ain_paths'].copy
-00003b70: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00003b80: 2020 2020 7472 6169 6e5f 7375 626a 732e      train_subjs.
-00003b90: 706f 7028 6a6a 290d 0a0d 0a20 2020 2020  pop(jj)....     
-00003ba0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00003bb0: 2874 7261 696e 5f73 7562 6a73 290d 0a20  (train_subjs).. 
-00003bc0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00003bd0: 7269 6e74 2827 2a2a 2a27 290d 0a20 2020  rint('***')..   
-00003be0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00003bf0: 6e74 2874 6573 745f 7375 626a 290d 0a0d  nt(test_subj)...
-00003c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003c10: 2074 7261 696e 2c20 7661 6c20 3d20 7365   train, val = se
-00003c20: 6c66 2e64 6174 6173 6574 2e5f 6275 696c  lf.dataset._buil
-00003c30: 645f 6461 7461 7365 7428 7472 6169 6e5f  d_dataset(train_
-00003c40: 7375 626a 732c 0d0a 2020 2020 2020 2020  subjs,..        
-00003c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003c70: 2020 2020 2020 2020 2020 2074 7261 696e             train
-00003c80: 5f62 6174 6368 3d73 656c 662e 6461 7461  _batch=self.data
-00003c90: 7365 742e 7472 6169 6e69 6e67 5f62 6174  set.training_bat
-00003ca0: 6368 2c0d 0a20 2020 2020 2020 2020 2020  ch,..           
-00003cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003cd0: 2020 2020 2020 2020 7465 7374 5f62 6174          test_bat
-00003ce0: 6368 3d73 656c 662e 6461 7461 7365 742e  ch=self.dataset.
-00003cf0: 7661 6c69 6461 7469 6f6e 5f62 6174 6368  validation_batch
-00003d00: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00003d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d30: 2020 2020 2020 7370 6c69 743d 5472 7565        split=True
-00003d40: 2c20 7661 6c5f 666f 6c64 5f69 6e64 3d30  , val_fold_ind=0
-00003d50: 290d 0a0d 0a0d 0a20 2020 2020 2020 2020  )......         
-00003d60: 2020 2020 2020 2073 656c 662e 745f 6869         self.t_hi
-00003d70: 7374 203d 2073 656c 662e 6b6d 2e66 6974  st = self.km.fit
-00003d80: 2874 7261 696e 2c0d 0a20 2020 2020 2020  (train,..       
-00003d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003da0: 2020 2020 2020 2020 2020 2020 7661 6c69              vali
-00003db0: 6461 7469 6f6e 5f64 6174 613d 7661 6c2c  dation_data=val,
-00003dc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003de0: 2020 2020 2065 706f 6368 733d 7365 6c66       epochs=self
-00003df0: 2e6d 6574 612e 7472 6169 6e5f 7061 7261  .meta.train_para
-00003e00: 6d73 5b27 6e5f 6570 6f63 6873 275d 2c20  ms['n_epochs'], 
-00003e10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003610: 2020 2070 7269 6e74 2822 2222 5465 7374     print("""Test
+00003620: 2070 6572 666f 726d 616e 6365 3a0d 0a20   performance:.. 
+00003630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003640: 2020 2020 2020 2020 204c 6f73 733a 207b           Loss: {
+00003650: 3a2e 3466 7d20 0d0a 2020 2020 2020 2020  :.4f} ..        
+00003660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003670: 2020 4d65 7472 6963 3a20 7b3a 2e34 667d    Metric: {:.4f}
+00003680: 2222 222e 666f 726d 6174 2874 5f6c 6f73  """.format(t_los
+00003690: 732c 2074 5f6d 6574 7269 6329 290d 0a20  s, t_metric)).. 
+000036a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000036b0: 2020 2073 656c 662e 6376 5f74 6573 745f     self.cv_test_
+000036c0: 6c6f 7373 6573 2e61 7070 656e 6428 745f  losses.append(t_
+000036d0: 6c6f 7373 290d 0a20 2020 2020 2020 2020  loss)..         
+000036e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000036f0: 6376 5f74 6573 745f 6d65 7472 6963 732e  cv_test_metrics.
+00003700: 6170 7065 6e64 2874 5f6d 6574 7269 6329  append(t_metric)
+00003710: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00003720: 2020 2020 795f 7472 7565 2c20 795f 7072      y_true, y_pr
+00003730: 6564 203d 2073 656c 662e 7072 6564 6963  ed = self.predic
+00003740: 7428 7661 6c29 0d0a 0d0a 2020 2020 2020  t(val)....      
+00003750: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00003760: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
+00003770: 6d73 5b27 7461 7267 6574 5f74 7970 6527  ms['target_type'
+00003780: 5d20 3d3d 2027 666c 6f61 7427 3a0d 0a20  ] == 'float':.. 
+00003790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000037a0: 2020 2072 6d73 203d 2072 6567 7265 7373     rms = regress
+000037b0: 696f 6e5f 6d65 7472 6963 7328 795f 7472  ion_metrics(y_tr
+000037c0: 7565 2c20 795f 7072 6564 290d 0a20 2020  ue, y_pred)..   
+000037d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000037e0: 2066 6f72 206b 2c76 2069 6e20 726d 732e   for k,v in rms.
+000037f0: 6974 656d 7328 293a 0d0a 2020 2020 2020  items():..      
+00003800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003810: 2020 726d 7373 5b6b 5d2e 6170 7065 6e64    rmss[k].append
+00003820: 2876 290d 0a20 2020 2020 2020 2020 2020  (v)..           
+00003830: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00003840: 5661 6c69 6461 7469 6f6e 2073 6574 3a20  Validation set: 
+00003850: 436f 7272 203d 222c 2072 6d73 5b27 6363  Corr =", rms['cc
+00003860: 275d 2c20 2220 5232 203d 222c 2072 6d73  '], " R2 =", rms
+00003870: 5b27 7232 275d 290d 0a20 2020 2020 2020  ['r2'])..       
+00003880: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00003890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000038a0: 2020 2020 7365 6c66 2e63 6d20 2b3d 2073      self.cm += s
+000038b0: 656c 662e 5f63 6f6e 6675 7369 6f6e 5f6d  elf._confusion_m
+000038c0: 6174 7269 7828 795f 7472 7565 2c20 795f  atrix(y_true, y_
+000038d0: 7072 6564 290d 0a20 2020 2020 2020 2020  pred)..         
+000038e0: 2020 2020 2020 2020 2020 2072 6d73 203d             rms =
+000038f0: 204e 6f6e 650d 0a0d 0a20 2020 2020 2020   None....       
+00003900: 2020 2020 2020 2020 2069 6620 636f 6c6c           if coll
+00003910: 6563 745f 7061 7474 6572 6e73 2061 6e64  ect_patterns and
+00003920: 2073 656c 662e 7363 6f70 6520 3d3d 2027   self.scope == '
+00003930: 6c66 636e 6e27 3a0d 0a20 2020 2020 2020  lfcnn':..       
+00003940: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00003950: 662e 636f 6c6c 6563 745f 7061 7474 6572  f.collect_patter
+00003960: 6e73 2866 6f6c 643d 6a6a 2c20 6e5f 666f  ns(fold=jj, n_fo
+00003970: 6c64 733d 6e5f 666f 6c64 732c 0d0a 2020  lds=n_folds,..  
+00003980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000039a0: 2020 2020 2020 2020 6e5f 636f 6d70 3d69          n_comp=i
+000039b0: 6e74 2863 6f6c 6c65 6374 5f70 6174 7465  nt(collect_patte
+000039c0: 726e 7329 290d 0a0d 0a0d 0a20 2020 2020  rns))......     
+000039d0: 2020 2020 2020 2020 2020 2069 6620 6a6a             if jj
+000039e0: 203c 206e 5f66 6f6c 6473 202d 2031 3a0d   < n_folds - 1:.
+000039f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003a00: 2020 2020 2073 656c 662e 6b6d 2e6c 6f61       self.km.loa
+00003a10: 645f 7765 6967 6874 7328 6f73 2e70 6174  d_weights(os.pat
+00003a20: 682e 6a6f 696e 2873 656c 662e 6d6f 6465  h.join(self.mode
+00003a30: 6c5f 7061 7468 2c20 0d0a 2020 2020 2020  l_path, ..      
+00003a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a70: 7365 6c66 2e6d 6f64 656c 5f6e 616d 6520  self.model_name 
+00003a80: 2b20 2769 6e69 742e 6835 2729 290d 0a20  + 'init.h5')).. 
+00003a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003aa0: 2020 2073 656c 662e 7368 7566 666c 655f     self.shuffle_
+00003ab0: 7765 6967 6874 7328 290d 0a20 2020 2020  weights()..     
+00003ac0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00003ad0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003ae0: 2020 2020 2020 224e 6f74 2073 6875 6666        "Not shuff
+00003af0: 6c69 6e67 2074 6865 2077 6569 6768 7473  ling the weights
+00003b00: 2066 6f72 2074 6865 206c 6173 7420 666f   for the last fo
+00003b10: 6c64 220d 0a0d 0a20 2020 2020 2020 2020  ld"....         
+00003b20: 2020 2020 2020 2070 7269 6e74 2822 2222         print("""
+00003b30: 466f 6c64 3a20 7b7d 2056 616c 6964 6174  Fold: {} Validat
+00003b40: 696f 6e20 7065 7266 6f72 6d61 6e63 653a  ion performance:
+00003b50: 5c6e 0d0a 2020 2020 2020 2020 2020 2020  \n..            
+00003b60: 2020 2020 2020 2020 2020 4c6f 7373 3a20            Loss: 
+00003b70: 7b3a 2e34 667d 2c20 0d0a 2020 2020 2020  {:.4f}, ..      
+00003b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b90: 4d65 7472 6963 3a20 7b3a 2e34 667d 2222  Metric: {:.4f}""
+00003ba0: 222e 666f 726d 6174 286a 6a2c 2076 5f6c  ".format(jj, v_l
+00003bb0: 6f73 732c 2076 5f6d 6574 7269 6329 290d  oss, v_metric)).
+00003bc0: 0a0d 0a20 2020 2020 2020 2020 2020 206d  ...            m
+00003bd0: 6574 7269 6373 203d 2073 656c 662e 6376  etrics = self.cv
+00003be0: 5f6d 6574 7269 6373 0d0a 2020 2020 2020  _metrics..      
+00003bf0: 2020 2020 2020 6c6f 7373 6573 203d 2073        losses = s
+00003c00: 656c 662e 6376 5f6c 6f73 7365 730d 0a0d  elf.cv_losses...
+00003c10: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00003c20: 6e74 2822 7b7d 2077 6974 6820 7b7d 2066  nt("{} with {} f
+00003c30: 6f6c 6473 2063 6f6d 706c 6574 6564 2e20  olds completed. 
+00003c40: 4c6f 7373 3a20 7b3a 2e34 667d 202b 2f2d  Loss: {:.4f} +/-
+00003c50: 207b 3a2e 3466 7d2e 204d 6574 7269 633a   {:.4f}. Metric:
+00003c60: 207b 3a2e 3466 7d20 2b2f 2d20 7b3a 2e34   {:.4f} +/- {:.4
+00003c70: 667d 222e 666f 726d 6174 286d 6f64 652c  f}".format(mode,
+00003c80: 206e 5f66 6f6c 6473 2c20 6e70 2e6d 6561   n_folds, np.mea
+00003c90: 6e28 6c6f 7373 6573 292c 206e 702e 7374  n(losses), np.st
+00003ca0: 6428 6c6f 7373 6573 292c 206e 702e 6d65  d(losses), np.me
+00003cb0: 616e 286d 6574 7269 6373 292c 206e 702e  an(metrics), np.
+00003cc0: 7374 6428 6d65 7472 6963 7329 2929 0d0a  std(metrics)))..
+00003cd0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00003ce0: 2073 656c 662e 6461 7461 7365 742e 685f   self.dataset.h_
+00003cf0: 7061 7261 6d73 5b27 7461 7267 6574 5f74  params['target_t
+00003d00: 7970 6527 5d20 3d3d 2027 666c 6f61 7427  ype'] == 'float'
+00003d10: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00003d20: 2020 2072 6d73 203d 207b 6b3a 6e70 2e6d     rms = {k:np.m
+00003d30: 6561 6e28 7629 2066 6f72 206b 2c20 7620  ean(v) for k, v 
+00003d40: 696e 2072 6d73 732e 6974 656d 7328 297d  in rmss.items()}
+00003d50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003d60: 2020 726d 732e 7570 6461 7465 287b 6b20    rms.update({k 
+00003d70: 2b20 275f 7374 6427 3a6e 702e 7374 6428  + '_std':np.std(
+00003d80: 7629 2066 6f72 206b 2c20 7620 696e 2072  v) for k, v in r
+00003d90: 6d73 732e 6974 656d 7328 297d 290d 0a20  mss.items()}).. 
+00003da0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00003db0: 7269 6e74 2822 5661 6c69 6461 7469 6f6e  rint("Validation
+00003dc0: 2073 6574 3a20 436f 7272 203a 207b 3a2e   set: Corr : {:.
+00003dd0: 3366 7d20 2b2f 2d20 7b3a 2e33 667d 2e20  3f} +/- {:.3f}. 
+00003de0: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
+00003df0: 2020 2020 2020 2020 2052 5e32 3a20 7b3a           R^2: {:
+00003e00: 2e33 667d 202b 2f2d 207b 3a2e 3366 7d22  .3f} +/- {:.3f}"
+00003e10: 2e66 6f72 6d61 7428 0d0a 2020 2020 2020  .format(..      
 00003e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003e30: 2020 2020 2073 7465 7073 5f70 6572 5f65       steps_per_e
-00003e40: 706f 6368 3d73 656c 662e 6d65 7461 2e74  poch=self.meta.t
-00003e50: 7261 696e 5f70 6172 616d 735b 2765 7661  rain_params['eva
-00003e60: 6c5f 7374 6570 275d 2c0d 0a20 2020 2020  l_step'],..     
-00003e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003e80: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-00003e90: 7566 666c 653d 5472 7565 2c0d 0a20 2020  uffle=True,..   
-00003ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003ec0: 7661 6c69 6461 7469 6f6e 5f73 7465 7073  validation_steps
-00003ed0: 3d73 656c 662e 6461 7461 7365 742e 7661  =self.dataset.va
-00003ee0: 6c69 6461 7469 6f6e 5f73 7465 7073 2c0d  lidation_steps,.
-00003ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f10: 2020 2020 6361 6c6c 6261 636b 733d 5b73      callbacks=[s
-00003f20: 746f 705f 6561 726c 795d 2c20 7665 7262  top_early], verb
-00003f30: 6f73 653d 322c 0d0a 2020 2020 2020 2020  ose=2,..        
-00003f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f50: 2020 2020 2020 2020 2020 2063 6c61 7373             class
-00003f60: 5f77 6569 6768 743d 636c 6173 735f 7765  _weight=class_we
-00003f70: 6967 6874 7329 0d0a 0d0a 0d0a 2020 2020  ights)......    
-00003f80: 2020 2020 2020 2020 2020 2020 7465 7374              test
-00003f90: 203d 2073 656c 662e 6461 7461 7365 742e   = self.dataset.
-00003fa0: 5f62 7569 6c64 5f64 6174 6173 6574 2874  _build_dataset(t
-00003fb0: 6573 745f 7375 626a 2c0d 0a20 2020 2020  est_subj,..     
-00003fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003fe0: 2020 2020 2020 2020 2020 2020 2020 7465                te
-00003ff0: 7374 5f62 6174 6368 3d4e 6f6e 652c 0d0a  st_batch=None,..
-00004000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004030: 2020 2073 706c 6974 3d46 616c 7365 290d     split=False).
-00004040: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00004050: 2020 2076 5f6c 6f73 732c 2076 5f6d 6574     v_loss, v_met
-00004060: 7269 6320 3d20 7365 6c66 2e65 7661 6c75  ric = self.evalu
-00004070: 6174 6528 7661 6c29 0d0a 2020 2020 2020  ate(val)..      
-00004080: 2020 2020 2020 2020 2020 745f 6c6f 7373            t_loss
-00004090: 2c20 745f 6d65 7472 6963 203d 2073 656c  , t_metric = sel
-000040a0: 662e 6576 616c 7561 7465 2874 6573 7429  f.evaluate(test)
-000040b0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000040c0: 2020 2020 7072 696e 7428 2253 7562 6a3a      print("Subj:
-000040d0: 207b 7d20 4c6f 7373 3a20 7b3a 2e34 667d   {} Loss: {:.4f}
-000040e0: 2c20 4d65 7472 6963 3a20 7b3a 2e34 667d  , Metric: {:.4f}
-000040f0: 222e 666f 726d 6174 286a 6a2c 2074 5f6c  ".format(jj, t_l
-00004100: 6f73 732c 2074 5f6d 6574 7269 6329 290d  oss, t_metric)).
-00004110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004120: 2073 656c 662e 6376 5f6c 6f73 7365 732e   self.cv_losses.
-00004130: 6170 7065 6e64 2876 5f6c 6f73 7329 0d0a  append(v_loss)..
-00004140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004150: 7365 6c66 2e63 765f 6d65 7472 6963 732e  self.cv_metrics.
-00004160: 6170 7065 6e64 2876 5f6d 6574 7269 6329  append(v_metric)
-00004170: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004180: 2020 7365 6c66 2e63 765f 7465 7374 5f6c    self.cv_test_l
-00004190: 6f73 7365 732e 6170 7065 6e64 2874 5f6c  osses.append(t_l
-000041a0: 6f73 7329 0d0a 2020 2020 2020 2020 2020  oss)..          
-000041b0: 2020 2020 2020 7365 6c66 2e63 765f 7465        self.cv_te
-000041c0: 7374 5f6d 6574 7269 6373 2e61 7070 656e  st_metrics.appen
-000041d0: 6428 745f 6d65 7472 6963 290d 0a0d 0a20  d(t_metric).... 
-000041e0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-000041f0: 5f74 7275 652c 2079 5f70 7265 6420 3d20  _true, y_pred = 
-00004200: 7365 6c66 2e70 7265 6469 6374 2876 616c  self.predict(val
-00004210: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00004220: 2020 2069 6620 7365 6c66 2e64 6174 6173     if self.datas
-00004230: 6574 2e68 5f70 6172 616d 735b 2774 6172  et.h_params['tar
-00004240: 6765 745f 7479 7065 275d 203d 3d20 2766  get_type'] == 'f
-00004250: 6c6f 6174 273a 0d0a 2020 2020 2020 2020  loat':..        
-00004260: 2020 2020 2020 2020 2020 2020 795f 7472              y_tr
-00004270: 7565 2c20 795f 7072 6564 203d 2073 656c  ue, y_pred = sel
-00004280: 662e 7072 6564 6963 7428 7661 6c29 0d0a  f.predict(val)..
+00003e30: 726d 735b 2763 6327 5d2c 2072 6d73 5b27  rms['cc'], rms['
+00003e40: 6363 5f73 7464 275d 2c20 726d 735b 2772  cc_std'], rms['r
+00003e50: 3227 5d2c 2072 6d73 5b27 7232 5f73 7464  2'], rms['r2_std
+00003e60: 275d 2929 0d0a 2020 2020 2020 2020 2020  ']))..          
+00003e70: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00003e80: 2020 2020 2020 2020 2072 6d73 203d 204e           rms = N
+00003e90: 6f6e 650d 0a0d 0a0d 0a20 2020 2020 2020  one......       
+00003ea0: 2065 6c69 6620 6d6f 6465 203d 3d20 226c   elif mode == "l
+00003eb0: 6f73 6f22 3a0d 0a20 2020 2020 2020 2020  oso":..         
+00003ec0: 2020 206e 5f66 6f6c 6473 203d 206c 656e     n_folds = len
+00003ed0: 2873 656c 662e 6461 7461 7365 742e 685f  (self.dataset.h_
+00003ee0: 7061 7261 6d73 5b27 7472 6169 6e5f 7061  params['train_pa
+00003ef0: 7468 7327 5d29 0d0a 2020 2020 2020 2020  ths'])..        
+00003f00: 2020 2020 7072 696e 7428 2252 756e 6e69      print("Runni
+00003f10: 6e67 206c 6561 7665 2d6f 6e65 2d73 7562  ng leave-one-sub
+00003f20: 6a65 6374 2d6f 7574 2043 5620 7769 7468  ject-out CV with
+00003f30: 207b 7d20 7375 626a 6563 7422 2e66 6f72   {} subject".for
+00003f40: 6d61 7428 6e5f 666f 6c64 7329 290d 0a0d  mat(n_folds))...
+00003f50: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00003f60: 206a 6a20 696e 2072 616e 6765 286e 5f66   jj in range(n_f
+00003f70: 6f6c 6473 293a 0d0a 2020 2020 2020 2020  olds):..        
+00003f80: 2020 2020 2020 2020 7072 696e 7428 2266          print("f
+00003f90: 6f6c 643a 222c 206a 6a29 0d0a 0d0a 2020  old:", jj)....  
+00003fa0: 2020 2020 2020 2020 2020 2020 2020 7465                te
+00003fb0: 7374 5f73 7562 6a20 3d20 7365 6c66 2e64  st_subj = self.d
+00003fc0: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
+00003fd0: 2774 7261 696e 5f70 6174 6873 275d 5b6a  'train_paths'][j
+00003fe0: 6a5d 0d0a 2020 2020 2020 2020 2020 2020  j]..            
+00003ff0: 2020 2020 7472 6169 6e5f 7375 626a 7320      train_subjs 
+00004000: 3d20 7365 6c66 2e64 6174 6173 6574 2e68  = self.dataset.h
+00004010: 5f70 6172 616d 735b 2774 7261 696e 5f70  _params['train_p
+00004020: 6174 6873 275d 2e63 6f70 7928 290d 0a20  aths'].copy().. 
+00004030: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00004040: 7261 696e 5f73 7562 6a73 2e70 6f70 286a  rain_subjs.pop(j
+00004050: 6a29 0d0a 0d0a 2020 2020 2020 2020 2020  j)....          
+00004060: 2020 2020 2020 7072 696e 7428 7472 6169        print(trai
+00004070: 6e5f 7375 626a 7329 0d0a 2020 2020 2020  n_subjs)..      
+00004080: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00004090: 272a 2a2a 2729 0d0a 2020 2020 2020 2020  '***')..        
+000040a0: 2020 2020 2020 2020 7072 696e 7428 7465          print(te
+000040b0: 7374 5f73 7562 6a29 0d0a 0d0a 2020 2020  st_subj)....    
+000040c0: 2020 2020 2020 2020 2020 2020 7472 6169              trai
+000040d0: 6e2c 2076 616c 203d 2073 656c 662e 6461  n, val = self.da
+000040e0: 7461 7365 742e 5f62 7569 6c64 5f64 6174  taset._build_dat
+000040f0: 6173 6574 2874 7261 696e 5f73 7562 6a73  aset(train_subjs
+00004100: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00004110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004130: 2020 2020 2020 7472 6169 6e5f 6261 7463        train_batc
+00004140: 683d 7365 6c66 2e64 6174 6173 6574 2e74  h=self.dataset.t
+00004150: 7261 696e 696e 675f 6261 7463 682c 0d0a  raining_batch,..
+00004160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004190: 2020 2074 6573 745f 6261 7463 683d 7365     test_batch=se
+000041a0: 6c66 2e64 6174 6173 6574 2e76 616c 6964  lf.dataset.valid
+000041b0: 6174 696f 6e5f 6261 7463 682c 0d0a 2020  ation_batch,..  
+000041c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000041d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000041e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000041f0: 2073 706c 6974 3d54 7275 652c 2076 616c   split=True, val
+00004200: 5f66 6f6c 645f 696e 643d 3029 0d0a 0d0a  _fold_ind=0)....
+00004210: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004220: 2020 7365 6c66 2e74 5f68 6973 7420 3d20    self.t_hist = 
+00004230: 7365 6c66 2e6b 6d2e 6669 7428 7472 6169  self.km.fit(trai
+00004240: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+00004250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004260: 2020 2020 2020 2076 616c 6964 6174 696f         validatio
+00004270: 6e5f 6461 7461 3d76 616c 2c0d 0a20 2020  n_data=val,..   
+00004280: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00004290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042a0: 2020 2020 726d 7320 3d20 7265 6772 6573      rms = regres
-000042b0: 7369 6f6e 5f6d 6574 7269 6373 2879 5f74  sion_metrics(y_t
-000042c0: 7275 652c 2079 5f70 7265 6429 0d0a 2020  rue, y_pred)..  
+000042a0: 6570 6f63 6873 3d73 656c 662e 6d65 7461  epochs=self.meta
+000042b0: 2e74 7261 696e 5f70 6172 616d 735b 276e  .train_params['n
+000042c0: 5f65 706f 6368 7327 5d2c 200d 0a20 2020  _epochs'], ..   
 000042d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042e0: 2020 666f 7220 6b2c 7620 696e 2072 6d73    for k,v in rms
-000042f0: 2e69 7465 6d73 2829 3a0d 0a20 2020 2020  .items():..     
-00004300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004310: 2020 2072 6d73 735b 6b5d 2e61 7070 656e     rmss[k].appen
-00004320: 6428 7629 0d0a 2020 2020 2020 2020 2020  d(v)..          
-00004330: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00004340: 2256 616c 6964 6174 696f 6e20 7365 743a  "Validation set:
-00004350: 2043 6f72 7220 3d22 2c20 726d 735b 2763   Corr =", rms['c
-00004360: 6327 5d2c 2022 2052 3220 3d22 2c20 726d  c'], " R2 =", rm
-00004370: 735b 2772 3227 5d29 0d0a 2020 2020 2020  s['r2'])..      
-00004380: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-00004390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000043a0: 2020 2020 2073 656c 662e 636d 202b 3d20       self.cm += 
-000043b0: 7365 6c66 2e5f 636f 6e66 7573 696f 6e5f  self._confusion_
-000043c0: 6d61 7472 6978 2879 5f74 7275 652c 2079  matrix(y_true, y
-000043d0: 5f70 7265 6429 0d0a 2020 2020 2020 2020  _pred)..        
-000043e0: 2020 2020 2020 2020 2020 2020 726d 7320              rms 
-000043f0: 3d20 4e6f 6e65 0d0a 0d0a 2020 2020 2020  = None....      
-00004400: 2020 2020 2020 2020 2020 6966 2063 6f6c            if col
-00004410: 6c65 6374 5f70 6174 7465 726e 7320 616e  lect_patterns an
-00004420: 6420 7365 6c66 2e73 636f 7065 203d 3d20  d self.scope == 
-00004430: 276c 6663 6e6e 273a 0d0a 2020 2020 2020  'lfcnn':..      
-00004440: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00004450: 6c66 2e63 6f6c 6c65 6374 5f70 6174 7465  lf.collect_patte
-00004460: 726e 7328 666f 6c64 3d6a 6a2c 206e 5f66  rns(fold=jj, n_f
-00004470: 6f6c 6473 3d6e 5f66 6f6c 6473 2c0d 0a20  olds=n_folds,.. 
+000042e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000042f0: 7374 6570 735f 7065 725f 6570 6f63 683d  steps_per_epoch=
+00004300: 7365 6c66 2e6d 6574 612e 7472 6169 6e5f  self.meta.train_
+00004310: 7061 7261 6d73 5b27 6576 616c 5f73 7465  params['eval_ste
+00004320: 7027 5d2c 0d0a 2020 2020 2020 2020 2020  p'],..          
+00004330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004340: 2020 2020 2020 2020 2073 6875 6666 6c65           shuffle
+00004350: 3d54 7275 652c 0d0a 2020 2020 2020 2020  =True,..        
+00004360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004370: 2020 2020 2020 2020 2020 2076 616c 6964             valid
+00004380: 6174 696f 6e5f 7374 6570 733d 7365 6c66  ation_steps=self
+00004390: 2e64 6174 6173 6574 2e76 616c 6964 6174  .dataset.validat
+000043a0: 696f 6e5f 7374 6570 732c 0d0a 2020 2020  ion_steps,..    
+000043b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000043d0: 616c 6c62 6163 6b73 3d5b 7374 6f70 5f65  allbacks=[stop_e
+000043e0: 6172 6c79 5d2c 2076 6572 626f 7365 3d32  arly], verbose=2
+000043f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00004400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004410: 2020 2020 2020 636c 6173 735f 7765 6967        class_weig
+00004420: 6874 3d63 6c61 7373 5f77 6569 6768 7473  ht=class_weights
+00004430: 290d 0a0d 0a0d 0a20 2020 2020 2020 2020  )......         
+00004440: 2020 2020 2020 2074 6573 7420 3d20 7365         test = se
+00004450: 6c66 2e64 6174 6173 6574 2e5f 6275 696c  lf.dataset._buil
+00004460: 645f 6461 7461 7365 7428 7465 7374 5f73  d_dataset(test_s
+00004470: 7562 6a2c 0d0a 2020 2020 2020 2020 2020  ubj,..          
 00004480: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00004490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000044a0: 2020 2020 2020 2020 206e 5f63 6f6d 703d           n_comp=
-000044b0: 696e 7428 636f 6c6c 6563 745f 7061 7474  int(collect_patt
-000044c0: 6572 6e73 2929 0d0a 0d0a 2020 2020 2020  erns))....      
-000044d0: 2020 2020 2020 2020 2020 6966 206a 6a20            if jj 
-000044e0: 3c20 6e5f 666f 6c64 7320 2d31 3a0d 0a20  < n_folds -1:.. 
-000044f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004500: 2020 2073 656c 662e 7368 7566 666c 655f     self.shuffle_
-00004510: 7765 6967 6874 7328 290d 0a20 2020 2020  weights()..     
-00004520: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00004530: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004540: 2020 2020 2020 224e 6f74 2073 6875 6666        "Not shuff
-00004550: 6c69 6e67 2074 6865 2077 6569 6768 7473  ling the weights
-00004560: 2066 6f72 2074 6865 206c 6173 7420 666f   for the last fo
-00004570: 6c64 220d 0a0d 0a20 2020 2020 2020 2020  ld"....         
-00004580: 2020 2069 6620 7365 6c66 2e64 6174 6173     if self.datas
-00004590: 6574 2e68 5f70 6172 616d 735b 2774 6172  et.h_params['tar
-000045a0: 6765 745f 7479 7065 275d 203d 3d20 2766  get_type'] == 'f
-000045b0: 6c6f 6174 273a 0d0a 2020 2020 2020 2020  loat':..        
-000045c0: 2020 2020 2020 2020 726d 7320 3d20 7b6b          rms = {k
-000045d0: 3a6e 702e 6d65 616e 2876 2920 666f 7220  :np.mean(v) for 
-000045e0: 6b2c 2076 2069 6e20 726d 7373 2e69 7465  k, v in rmss.ite
-000045f0: 6d73 2829 7d0d 0a20 2020 2020 2020 2020  ms()}..         
-00004600: 2020 2020 2020 2072 6d73 2e75 7064 6174         rms.updat
-00004610: 6528 7b6b 202b 2027 5f73 7464 273a 6e70  e({k + '_std':np
-00004620: 2e73 7464 2876 2920 666f 7220 6b2c 2076  .std(v) for k, v
-00004630: 2069 6e20 726d 7373 2e69 7465 6d73 2829   in rmss.items()
-00004640: 7d29 0d0a 2020 2020 2020 2020 2020 2020  })..            
-00004650: 2020 2020 7072 696e 7428 2256 616c 6964      print("Valid
-00004660: 6174 696f 6e20 7365 743a 2043 6f72 7220  ation set: Corr 
-00004670: 3a20 7b3a 2e33 667d 202b 2f2d 207b 3a2e  : {:.3f} +/- {:.
-00004680: 3366 7d2e 205c 0d0a 2020 2020 2020 2020  3f}. \..        
-00004690: 2020 2020 2020 2020 2020 2020 2020 525e                R^
-000046a0: 323a 207b 3a2e 3366 7d20 2b2f 2d20 7b3a  2: {:.3f} +/- {:
-000046b0: 2e33 667d 222e 666f 726d 6174 280d 0a20  .3f}".format(.. 
-000046c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000046d0: 2020 2020 2072 6d73 5b27 6363 275d 2c20       rms['cc'], 
-000046e0: 726d 735b 2763 635f 7374 6427 5d2c 2072  rms['cc_std'], r
-000046f0: 6d73 5b27 7232 275d 2c20 726d 735b 2772  ms['r2'], rms['r
-00004700: 325f 7374 6427 5d29 290d 0a20 2020 2020  2_std']))..     
-00004710: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00004720: 2020 2020 2020 2020 2020 2020 2020 726d                rm
-00004730: 7320 3d20 4e6f 6e65 0d0a 0d0a 2020 2020  s = None....    
-00004740: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
-00004750: 6174 655f 6c6f 6728 726d 732c 2070 7265  ate_log(rms, pre
-00004760: 6669 783d 276c 6f73 6f5f 2729 0d0a 0d0a  fix='loso_')....
-00004770: 2020 2020 2020 2020 7072 696e 7428 2222          print(""
-00004780: 227b 7d20 7769 7468 207b 7d20 666f 6c64  "{} with {} fold
-00004790: 2873 2920 636f 6d70 6c65 7465 642e 205c  (s) completed. \
-000047a0: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
-000047b0: 2056 616c 6964 6174 696f 6e20 5065 7266   Validation Perf
-000047c0: 6f72 6d61 6e63 653a 200d 0a20 2020 2020  ormance: ..     
-000047d0: 2020 2020 2020 2020 204c 6f73 733a 207b           Loss: {
-000047e0: 3a2e 3466 7d20 2b2f 2d20 7b3a 2e34 667d  :.4f} +/- {:.4f}
-000047f0: 2e0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00004800: 204d 6574 7269 633a 207b 3a2e 3466 7d20   Metric: {:.4f} 
-00004810: 2b2f 2d20 7b3a 2e34 667d 2222 220d 0a20  +/- {:.4f}""".. 
-00004820: 2020 2020 2020 2020 2020 2020 202e 666f               .fo
-00004830: 726d 6174 286d 6f64 652c 206e 5f66 6f6c  rmat(mode, n_fol
-00004840: 6473 2c0d 0a20 2020 2020 2020 2020 2020  ds,..           
-00004850: 2020 2020 2020 2020 2020 206e 702e 6d65             np.me
-00004860: 616e 2873 656c 662e 6376 5f6c 6f73 7365  an(self.cv_losse
-00004870: 7329 2c20 6e70 2e73 7464 2873 656c 662e  s), np.std(self.
-00004880: 6376 5f6c 6f73 7365 7329 2c0d 0a20 2020  cv_losses),..   
-00004890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048a0: 2020 206e 702e 6d65 616e 2873 656c 662e     np.mean(self.
-000048b0: 6376 5f6d 6574 7269 6373 292c 206e 702e  cv_metrics), np.
-000048c0: 7374 6428 7365 6c66 2e63 765f 6d65 7472  std(self.cv_metr
-000048d0: 6963 7329 2929 0d0a 2020 2020 2020 2020  ics)))..        
-000048e0: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-000048f0: 2873 656c 662e 6461 7461 7365 742e 685f  (self.dataset.h_
-00004900: 7061 7261 6d73 5b27 7465 7374 5f70 6174  params['test_pat
-00004910: 6873 275d 2920 3e20 303a 0d0a 2020 2020  hs']) > 0:..    
-00004920: 2020 2020 2020 2020 7072 696e 7428 2222          print(""
-00004930: 225c 6e0d 0a20 2020 2020 2020 2020 2020  "\n..           
-00004940: 2020 2054 6573 7420 5065 7266 6f72 6d61     Test Performa
-00004950: 6e63 653a 200d 0a20 2020 2020 2020 2020  nce: ..         
-00004960: 2020 2020 204c 6f73 733a 207b 3a2e 3466       Loss: {:.4f
-00004970: 7d20 2b2f 2d20 7b3a 2e34 667d 2e0d 0a20  } +/- {:.4f}... 
-00004980: 2020 2020 2020 2020 2020 2020 204d 6574               Met
-00004990: 7269 633a 207b 3a2e 3466 7d20 2b2f 2d20  ric: {:.4f} +/- 
-000049a0: 7b3a 2e34 667d 2222 220d 0a20 2020 2020  {:.4f}"""..     
-000049b0: 2020 2020 2020 2020 202e 666f 726d 6174           .format
-000049c0: 286e 702e 6d65 616e 2873 656c 662e 6376  (np.mean(self.cv
-000049d0: 5f74 6573 745f 6c6f 7373 6573 292c 200d  _test_losses), .
-000049e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000049f0: 2020 2020 2020 206e 702e 7374 6428 7365         np.std(se
-00004a00: 6c66 2e63 765f 7465 7374 5f6c 6f73 7365  lf.cv_test_losse
-00004a10: 7329 2c0d 0a20 2020 2020 2020 2020 2020  s),..           
-00004a20: 2020 2020 2020 2020 2020 206e 702e 6d65             np.me
-00004a30: 616e 2873 656c 662e 6376 5f74 6573 745f  an(self.cv_test_
-00004a40: 6d65 7472 6963 7329 2c20 0d0a 2020 2020  metrics), ..    
-00004a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a60: 2020 6e70 2e73 7464 2873 656c 662e 6376    np.std(self.cv
-00004a70: 5f74 6573 745f 6d65 7472 6963 7329 2929  _test_metrics)))
-00004a80: 0d0a 2020 2020 2020 2020 7365 6c66 2e75  ..        self.u
-00004a90: 7064 6174 655f 6c6f 6728 726d 733d 726d  pdate_log(rms=rm
-00004aa0: 732c 2070 7265 6669 783d 6d6f 6465 2920  s, prefix=mode) 
-00004ab0: 2020 200d 0a20 2020 2020 2020 2023 7265     ..        #re
-00004ac0: 7475 726e 2073 656c 662e 6376 5f6c 6f73  turn self.cv_los
-00004ad0: 7365 732c 2073 656c 662e 6376 5f6d 6574  ses, self.cv_met
-00004ae0: 7269 6373 0d0a 0d0a 0d0a 2020 2020 6465  rics......    de
-00004af0: 6620 7072 756e 655f 7765 6967 6874 7328  f prune_weights(
-00004b00: 7365 6c66 2c20 696e 6372 6561 7365 5f72  self, increase_r
-00004b10: 6567 756c 6172 697a 6174 696f 6e3d 332e  egularization=3.
-00004b20: 293a 0d0a 2020 2020 2020 2020 7374 6f70  ):..        stop
-00004b30: 5f65 6172 6c79 203d 2074 662e 6b65 7261  _early = tf.kera
-00004b40: 732e 6361 6c6c 6261 636b 732e 4561 726c  s.callbacks.Earl
-00004b50: 7953 746f 7070 696e 6728 6d6f 6e69 746f  yStopping(monito
-00004b60: 723d 2776 616c 5f6c 6f73 7327 2c0d 0a20  r='val_loss',.. 
-00004b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ba0: 2020 2020 206d 696e 5f64 656c 7461 3d31       min_delta=1
-00004bb0: 652d 362c 0d0a 2020 2020 2020 2020 2020  e-6,..          
-00004bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004be0: 2020 2020 2020 2020 2020 2020 7061 7469              pati
-00004bf0: 656e 6365 3d31 302c 0d0a 2020 2020 2020  ence=10,..      
-00004c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c30: 7265 7374 6f72 655f 6265 7374 5f77 6569  restore_best_wei
-00004c40: 6768 7473 3d54 7275 6529 0d0a 2020 2020  ghts=True)..    
-00004c50: 2020 2020 7365 6c66 2e72 6174 6520 3d20      self.rate = 
-00004c60: 300d 0a20 2020 2020 2020 2073 656c 662e  0..        self.
-00004c70: 7370 6563 735b 226c 315f 6c61 6d62 6461  specs["l1_lambda
-00004c80: 225d 202a 3d20 696e 6372 6561 7365 5f72  "] *= increase_r
-00004c90: 6567 756c 6172 697a 6174 696f 6e0d 0a20  egularization.. 
-00004ca0: 2020 2020 2020 2073 656c 662e 7370 6563         self.spec
-00004cb0: 735b 226c 325f 6c61 6d62 6461 225d 202a  s["l2_lambda"] *
-00004cc0: 3d20 696e 6372 6561 7365 5f72 6567 756c  = increase_regul
-00004cd0: 6172 697a 6174 696f 6e0d 0a20 2020 2020  arization..     
-00004ce0: 2020 2070 7269 6e74 2827 5072 756e 696e     print('Prunin
-00004cf0: 6720 7765 6967 6874 7327 290d 0a20 2020  g weights')..   
-00004d00: 2020 2020 2073 656c 662e 745f 6869 7374       self.t_hist
-00004d10: 5f70 203d 2073 656c 662e 6b6d 2e66 6974  _p = self.km.fit
-00004d20: 2873 656c 662e 6461 7461 7365 742e 7472  (self.dataset.tr
-00004d30: 6169 6e2c 0d0a 2020 2020 2020 2020 2020  ain,..          
-00004d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d50: 2020 2020 2076 616c 6964 6174 696f 6e5f       validation_
-00004d60: 6461 7461 3d73 656c 662e 6461 7461 7365  data=self.datase
-00004d70: 742e 7661 6c2c 0d0a 2020 2020 2020 2020  t.val,..        
-00004d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d90: 2020 2020 2020 2065 706f 6368 733d 3330         epochs=30
-00004da0: 2c20 7374 6570 735f 7065 725f 6570 6f63  , steps_per_epoc
-00004db0: 683d 7365 6c66 2e6d 6574 612e 7472 6169  h=self.meta.trai
-00004dc0: 6e5f 7061 7261 6d73 5b27 6576 616c 5f73  n_params['eval_s
-00004dd0: 7465 7027 5d2c 0d0a 2020 2020 2020 2020  tep'],..        
-00004de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004df0: 2020 2020 2020 2073 6875 6666 6c65 3d54         shuffle=T
-00004e00: 7275 652c 0d0a 2020 2020 2020 2020 2020  rue,..          
-00004e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e20: 2020 2020 2076 616c 6964 6174 696f 6e5f       validation_
-00004e30: 7374 6570 733d 7365 6c66 2e64 6174 6173  steps=self.datas
-00004e40: 6574 2e76 616c 6964 6174 696f 6e5f 7374  et.validation_st
-00004e50: 6570 732c 0d0a 2020 2020 2020 2020 2020  eps,..          
-00004e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e70: 2020 2020 2063 616c 6c62 6163 6b73 3d5b       callbacks=[
-00004e80: 7374 6f70 5f65 6172 6c79 5d2c 2076 6572  stop_early], ver
-00004e90: 626f 7365 3d32 290d 0a0d 0a20 2020 2064  bose=2)....    d
-00004ea0: 6566 2073 6875 6666 6c65 5f77 6569 6768  ef shuffle_weigh
-00004eb0: 7473 2873 656c 6629 3a0d 0a20 2020 2020  ts(self):..     
-00004ec0: 2020 2070 7269 6e74 2822 5265 2d73 6875     print("Re-shu
-00004ed0: 6666 6c69 6e67 2077 6569 6768 7473 2062  ffling weights b
-00004ee0: 6574 7765 656e 2066 6f6c 6473 2229 0d0a  etween folds")..
-00004ef0: 2020 2020 2020 2020 7765 6967 6874 7320          weights 
-00004f00: 3d20 7365 6c66 2e6b 6d2e 6765 745f 7765  = self.km.get_we
-00004f10: 6967 6874 7328 290d 0a20 2020 2020 2020  ights()..       
-00004f20: 2077 6569 6768 7473 203d 205b 6e70 2e72   weights = [np.r
-00004f30: 616e 646f 6d2e 7065 726d 7574 6174 696f  andom.permutatio
-00004f40: 6e28 772e 666c 6174 292e 7265 7368 6170  n(w.flat).reshap
-00004f50: 6528 772e 7368 6170 6529 2066 6f72 2077  e(w.shape) for w
-00004f60: 2069 6e20 7765 6967 6874 735d 0d0a 2020   in weights]..  
-00004f70: 2020 2020 2020 7365 6c66 2e6b 6d2e 7365        self.km.se
-00004f80: 745f 7765 6967 6874 7328 7765 6967 6874  t_weights(weight
-00004f90: 7329 0d0a 0d0a 0d0a 2020 2020 2320 6465  s)......    # de
-00004fa0: 6620 7265 696e 6974 6961 6c69 7a65 5f77  f reinitialize_w
-00004fb0: 6569 6768 7473 2873 656c 6629 3a0d 0a20  eights(self):.. 
-00004fc0: 2020 2023 2020 2020 2073 6573 7369 6f6e     #     session
-00004fd0: 203d 204b 2e67 6574 5f73 6573 7369 6f6e   = K.get_session
-00004fe0: 2829 0d0a 2020 2020 2320 2020 2020 7072  ()..    #     pr
-00004ff0: 696e 7428 2252 652d 696e 6974 6961 6c69  int("Re-initiali
-00005000: 7a69 6e67 2077 6569 6768 7473 2229 0d0a  zing weights")..
-00005010: 2020 2020 2320 2020 2020 666f 7220 6c61      #     for la
-00005020: 7965 7220 696e 2073 656c 662e 6b6d 2e6c  yer in self.km.l
-00005030: 6179 6572 733a 200d 0a20 2020 2023 2020  ayers: ..    #  
-00005040: 2020 2020 2020 2069 6620 6861 7361 7474         if hasatt
-00005050: 7228 6c61 7965 722c 2027 6b65 726e 656c  r(layer, 'kernel
-00005060: 5f69 6e69 7469 616c 697a 6572 2729 3a0d  _initializer'):.
-00005070: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00005080: 2020 206c 6179 6572 2e6b 6572 6e65 6c2e     layer.kernel.
-00005090: 696e 6974 6961 6c69 7a65 722e 7275 6e28  initializer.run(
-000050a0: 7365 7373 696f 6e3d 7365 7373 696f 6e29  session=session)
-000050b0: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-000050c0: 6966 2068 6173 6174 7472 286c 6179 6572  if hasattr(layer
-000050d0: 2c20 2762 6961 735f 696e 6974 6961 6c69  , 'bias_initiali
-000050e0: 7a65 7227 293a 0d0a 2020 2020 2320 2020  zer'):..    #   
-000050f0: 2020 2020 2020 2020 2020 6c61 7965 722e            layer.
-00005100: 6269 6173 2e69 6e69 7469 616c 697a 6572  bias.initializer
-00005110: 2e72 756e 2873 6573 7369 6f6e 3d73 6573  .run(session=ses
-00005120: 7369 6f6e 290d 0a20 2020 2020 2020 2020  sion)..         
-00005130: 2020 2020 2020 200d 0a0d 0a20 2020 2064         ....    d
-00005140: 6566 2070 6c6f 745f 6869 7374 2873 656c  ef plot_hist(sel
-00005150: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
-00005160: 506c 6f74 206c 6f73 7320 6869 7374 6f72  Plot loss histor
-00005170: 7920 6475 7269 6e67 2074 7261 696e 696e  y during trainin
-00005180: 672e 2222 220d 0a20 2020 2020 2020 2070  g."""..        p
-00005190: 6c74 2e70 6c6f 7428 7365 6c66 2e74 5f68  lt.plot(self.t_h
-000051a0: 6973 742e 6869 7374 6f72 795b 276c 6f73  ist.history['los
-000051b0: 7327 5d29 0d0a 2020 2020 2020 2020 706c  s'])..        pl
-000051c0: 742e 706c 6f74 2873 656c 662e 745f 6869  t.plot(self.t_hi
-000051d0: 7374 2e68 6973 746f 7279 5b27 7661 6c5f  st.history['val_
-000051e0: 6c6f 7373 275d 290d 0a20 2020 2020 2020  loss'])..       
-000051f0: 2070 6c74 2e74 6974 6c65 2827 6d6f 6465   plt.title('mode
-00005200: 6c20 6c6f 7373 2729 0d0a 2020 2020 2020  l loss')..      
-00005210: 2020 706c 742e 796c 6162 656c 2827 6c6f    plt.ylabel('lo
-00005220: 7373 2729 0d0a 2020 2020 2020 2020 706c  ss')..        pl
-00005230: 742e 786c 6162 656c 2827 6570 6f63 6827  t.xlabel('epoch'
-00005240: 290d 0a20 2020 2020 2020 2070 6c74 2e6c  )..        plt.l
-00005250: 6567 656e 6428 5b27 7472 6169 6e27 2c20  egend(['train', 
-00005260: 2776 616c 6964 6174 696f 6e27 5d2c 206c  'validation'], l
-00005270: 6f63 3d27 7570 7065 7220 6c65 6674 2729  oc='upper left')
-00005280: 0d0a 2020 2020 2020 2020 706c 742e 7368  ..        plt.sh
-00005290: 6f77 2829 0d0a 0d0a 2020 2020 6465 6620  ow()....    def 
-000052a0: 5f63 6f6e 6675 7369 6f6e 5f6d 6174 7269  _confusion_matri
-000052b0: 7828 7365 6c66 2c20 795f 7472 7565 2c20  x(self, y_true, 
-000052c0: 795f 7072 6564 293a 0d0a 2020 2020 2020  y_pred):..      
-000052d0: 2020 2222 2243 6f6d 7075 7465 2075 6e6e    """Compute unn
-000052e0: 6f72 6d61 6c69 7a65 7764 2063 6f6e 6675  ormalizewd confu
-000052f0: 7369 6f6e 206d 6174 7269 7822 2222 0d0a  sion matrix"""..
-00005300: 2020 2020 2020 2020 795f 7020 3d20 5f6f          y_p = _o
-00005310: 6e65 686f 7428 6e70 2e61 7267 6d61 7828  nehot(np.argmax(
-00005320: 795f 7072 6564 2c31 292c 206e 5f63 6c61  y_pred,1), n_cla
-00005330: 7373 6573 3d73 656c 662e 795f 7368 6170  sses=self.y_shap
-00005340: 655b 2d31 5d29 0d0a 2020 2020 2020 2020  e[-1])..        
-00005350: 636d 203d 206e 702e 646f 7428 795f 702e  cm = np.dot(y_p.
-00005360: 542c 2079 5f74 7275 6529 0d0a 2020 2020  T, y_true)..    
-00005370: 2020 2020 7265 7475 726e 2063 6d0d 0a0d      return cm...
-00005380: 0a20 2020 2064 6566 2075 7064 6174 655f  .    def update_
-00005390: 6c6f 6728 7365 6c66 2c20 726d 733d 4e6f  log(self, rms=No
-000053a0: 6e65 2c20 7072 6566 6978 3d27 2729 3a0d  ne, prefix=''):.
-000053b0: 0a20 2020 2020 2020 2022 2222 4c6f 6773  .        """Logs
-000053c0: 2065 7870 6572 696d 656e 7420 746f 2073   experiment to s
-000053d0: 656c 662e 6d6f 6465 6c5f 7061 7468 202b  elf.model_path +
-000053e0: 2073 656c 662e 7363 6f70 6520 2b20 275f   self.scope + '_
-000053f0: 6c6f 672e 6373 7627 2e0d 0a0d 0a20 2020  log.csv'.....   
-00005400: 2020 2020 2049 6620 7468 6520 6669 6c65       If the file
-00005410: 2065 7869 7374 732c 2061 7070 656e 6473   exists, appends
-00005420: 2061 206c 696e 6520 746f 2074 6865 2065   a line to the e
-00005430: 7869 7374 696e 6720 6669 6c65 2e0d 0a20  xisting file... 
-00005440: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00005450: 2020 2020 7361 7665 7061 7468 203d 206f      savepath = o
-00005460: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
-00005470: 2e6d 6f64 656c 5f70 6174 682c 2073 656c  .model_path, sel
-00005480: 662e 7363 6f70 6520 2b20 275f 6c6f 672e  f.scope + '_log.
-00005490: 6373 7627 290d 0a20 2020 2020 2020 2061  csv')..        a
-000054a0: 7070 656e 6469 6e67 203d 206f 732e 7061  ppending = os.pa
-000054b0: 7468 2e65 7869 7374 7328 7361 7665 7061  th.exists(savepa
-000054c0: 7468 290d 0a0d 0a20 2020 2020 2020 206c  th)....        l
-000054d0: 6f67 203d 2064 6963 7428 290d 0a20 2020  og = dict()..   
-000054e0: 2020 2020 2069 6620 726d 733a 0d0a 2020       if rms:..  
-000054f0: 2020 2020 2020 2020 2020 6c6f 672e 7570            log.up
-00005500: 6461 7465 287b 7072 6566 6978 2b6b 3a76  date({prefix+k:v
-00005510: 2066 6f72 206b 2c76 2069 6e20 726d 732e   for k,v in rms.
-00005520: 6974 656d 7328 297d 290d 0a0d 0a20 2020  items()})....   
-00005530: 2020 2020 2023 6461 7461 7365 7420 696e       #dataset in
-00005540: 666f 0d0a 2020 2020 2020 2020 6c6f 675b  fo..        log[
-00005550: 2764 6174 615f 6964 275d 203d 2073 656c  'data_id'] = sel
-00005560: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
-00005570: 6d73 5b27 6461 7461 5f69 6427 5d0d 0a20  ms['data_id'].. 
-00005580: 2020 2020 2020 206c 6f67 5b27 6461 7461         log['data
-00005590: 5f70 6174 6827 5d20 3d20 7365 6c66 2e64  _path'] = self.d
-000055a0: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
-000055b0: 2764 6174 615f 7061 7468 275d 0d0a 0d0a  'data_path']....
-000055c0: 2020 2020 2020 2020 6c6f 675b 2779 5f73          log['y_s
-000055d0: 6861 7065 275d 203d 206e 702e 7072 6f64  hape'] = np.prod
-000055e0: 2873 656c 662e 6461 7461 7365 742e 685f  (self.dataset.h_
-000055f0: 7061 7261 6d73 5b27 795f 7368 6170 6527  params['y_shape'
-00005600: 5d29 0d0a 2020 2020 2020 2020 6c6f 675b  ])..        log[
-00005610: 2766 7327 5d20 3d20 7374 7228 7365 6c66  'fs'] = str(self
-00005620: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
-00005630: 735b 2766 7327 5d29 0d0a 0d0a 2020 2020  s['fs'])....    
-00005640: 2020 2020 2361 7263 6869 7465 6374 7572      #architectur
-00005650: 6520 616e 6420 7265 6775 6c61 7269 7a61  e and regulariza
-00005660: 7469 6f6e 0d0a 2020 2020 2020 2020 6c6f  tion..        lo
-00005670: 672e 7570 6461 7465 2873 656c 662e 7370  g.update(self.sp
-00005680: 6563 7329 0d0a 0d0a 2020 2020 2020 2020  ecs)....        
-00005690: 2374 7261 696e 696e 6720 7061 7261 6d74  #training paramt
-000056a0: 6572 730d 0a20 2020 2020 2020 206c 6f67  ers..        log
-000056b0: 5b27 6e5f 6570 6f63 6873 275d 203d 2073  ['n_epochs'] = s
-000056c0: 656c 662e 7472 6169 6e5f 7061 7261 6d73  elf.train_params
-000056d0: 5b27 6e5f 6570 6f63 6873 275d 0d0a 2020  ['n_epochs']..  
-000056e0: 2020 2020 2020 6c6f 675b 2765 7661 6c5f        log['eval_
-000056f0: 7374 6570 275d 203d 2073 656c 662e 7472  step'] = self.tr
-00005700: 6169 6e5f 7061 7261 6d73 5b27 6576 616c  ain_params['eval
-00005710: 5f73 7465 7027 5d0d 0a20 2020 2020 2020  _step']..       
-00005720: 206c 6f67 5b27 6561 726c 795f 7374 6f70   log['early_stop
-00005730: 7069 6e67 275d 203d 2073 656c 662e 7472  ping'] = self.tr
-00005740: 6169 6e5f 7061 7261 6d73 5b27 6561 726c  ain_params['earl
-00005750: 795f 7374 6f70 7069 6e67 275d 0d0a 2020  y_stopping']..  
-00005760: 2020 2020 2020 6c6f 675b 276d 6f64 6527        log['mode'
-00005770: 5d20 3d20 7365 6c66 2e74 7261 696e 5f70  ] = self.train_p
-00005780: 6172 616d 735b 276d 6f64 6527 5d0d 0a20  arams['mode'].. 
-00005790: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-000057a0: 206c 6f67 5b27 765f 6d65 7472 6963 275d   log['v_metric']
-000057b0: 203d 206e 702e 6d65 616e 2873 656c 662e   = np.mean(self.
-000057c0: 6376 5f6d 6574 7269 6373 290d 0a20 2020  cv_metrics)..   
-000057d0: 2020 2020 206c 6f67 5b27 765f 6c6f 7373       log['v_loss
-000057e0: 275d 203d 206e 702e 6d65 616e 2873 656c  '] = np.mean(sel
-000057f0: 662e 6376 5f6c 6f73 7365 7329 0d0a 2020  f.cv_losses)..  
-00005800: 2020 2020 2020 6c6f 675b 2763 765f 6d65        log['cv_me
-00005810: 7472 6963 7327 5d20 3d20 7365 6c66 2e63  trics'] = self.c
-00005820: 765f 6d65 7472 6963 730d 0a20 2020 2020  v_metrics..     
-00005830: 2020 206c 6f67 5b27 6376 5f6c 6f73 7365     log['cv_losse
-00005840: 7327 5d20 3d20 7365 6c66 2e63 765f 6c6f  s'] = self.cv_lo
-00005850: 7373 6573 0d0a 2020 2020 2020 2020 0d0a  sses..        ..
-00005860: 2020 2020 2020 2020 7472 5f6c 6f73 732c          tr_loss,
-00005870: 2074 725f 6d65 7472 6963 203d 2073 656c   tr_metric = sel
-00005880: 662e 6576 616c 7561 7465 2873 656c 662e  f.evaluate(self.
-00005890: 6461 7461 7365 742e 7472 6169 6e29 0d0a  dataset.train)..
-000058a0: 2020 2020 2020 2020 6c6f 675b 2774 725f          log['tr_
-000058b0: 6d65 7472 6963 275d 203d 2074 725f 6d65  metric'] = tr_me
-000058c0: 7472 6963 0d0a 2020 2020 2020 2020 6c6f  tric..        lo
-000058d0: 675b 2774 725f 6c6f 7373 275d 203d 2074  g['tr_loss'] = t
-000058e0: 725f 6c6f 7373 0d0a 0d0a 0d0a 2020 2020  r_loss......    
-000058f0: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
-00005900: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
-00005910: 5b27 7465 7374 5f70 6174 6873 275d 2920  ['test_paths']) 
-00005920: 3e20 303a 0d0a 2020 2020 2020 2020 2020  > 0:..          
-00005930: 2020 745f 6c6f 7373 203d 206e 702e 6d65    t_loss = np.me
-00005940: 616e 2873 656c 662e 6376 5f74 6573 745f  an(self.cv_test_
-00005950: 6c6f 7373 6573 290d 0a20 2020 2020 2020  losses)..       
-00005960: 2020 2020 2074 5f6d 6574 7269 6320 3d20       t_metric = 
-00005970: 6e70 2e6d 6561 6e28 7365 6c66 2e63 765f  np.mean(self.cv_
-00005980: 7465 7374 5f6d 6574 7269 6373 290d 0a20  test_metrics).. 
-00005990: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-000059a0: 6c66 2e64 6174 6173 6574 2e68 5f70 6172  lf.dataset.h_par
-000059b0: 616d 735b 2774 6172 6765 745f 7479 7065  ams['target_type
-000059c0: 275d 203d 3d20 2766 6c6f 6174 273a 0d0a  '] == 'float':..
-000059d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000059e0: 795f 7472 7565 2c20 795f 7072 6564 203d  y_true, y_pred =
-000059f0: 2073 656c 662e 7072 6564 6963 7428 7365   self.predict(se
-00005a00: 6c66 2e64 6174 6173 6574 2e68 5f70 6172  lf.dataset.h_par
-00005a10: 616d 735b 2774 6573 745f 7061 7468 7327  ams['test_paths'
-00005a20: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00005a30: 2020 2020 726d 735f 7465 7374 203d 2072      rms_test = r
-00005a40: 6567 7265 7373 696f 6e5f 6d65 7472 6963  egression_metric
-00005a50: 7328 795f 7472 7565 2c20 795f 7072 6564  s(y_true, y_pred
-00005a60: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00005a70: 2020 2070 7269 6e74 2822 5465 7374 2073     print("Test s
-00005a80: 6574 3a20 436f 7272 203d 222c 2072 6d73  et: Corr =", rms
-00005a90: 5f74 6573 745b 2763 6327 5d2c 2022 5232  _test['cc'], "R2
-00005aa0: 203d 222c 2072 6d73 5f74 6573 745b 2772   =", rms_test['r
-00005ab0: 3227 5d29 0d0a 2020 2020 2020 2020 2020  2'])..          
-00005ac0: 2020 2020 2020 6c6f 672e 7570 6461 7465        log.update
-00005ad0: 287b 2774 6573 745f 272b 6b3a 7620 666f  ({'test_'+k:v fo
-00005ae0: 7220 6b2c 7620 696e 2072 6d73 5f74 6573  r k,v in rms_tes
-00005af0: 742e 6974 656d 7328 297d 290d 0a20 2020  t.items()})..   
-00005b00: 2020 2020 2020 2020 206c 6f67 5b27 7465           log['te
-00005b10: 7374 5f6d 6574 7269 6327 5d20 3d20 745f  st_metric'] = t_
-00005b20: 6d65 7472 6963 0d0a 2020 2020 2020 2020  metric..        
-00005b30: 2020 2020 6c6f 675b 2774 6573 745f 6c6f      log['test_lo
-00005b40: 7373 275d 203d 2074 5f6c 6f73 730d 0a20  ss'] = t_loss.. 
-00005b50: 2020 2020 2020 2020 2020 206c 6f67 5b27             log['
-00005b60: 7465 7374 5f6d 6574 7269 6373 275d 203d  test_metrics'] =
-00005b70: 2073 656c 662e 6376 5f74 6573 745f 6d65   self.cv_test_me
-00005b80: 7472 6963 730d 0a20 2020 2020 2020 2020  trics..         
-00005b90: 2020 206c 6f67 5b27 7465 7374 5f6c 6f73     log['test_los
-00005ba0: 7365 7327 5d20 3d20 7365 6c66 2e63 765f  ses'] = self.cv_
-00005bb0: 7465 7374 5f6c 6f73 7365 730d 0a0d 0a20  test_losses.... 
-00005bc0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00005bd0: 2020 2020 2020 2020 2020 6c6f 675b 2774            log['t
-00005be0: 6573 745f 6d65 7472 6963 275d 203d 2022  est_metric'] = "
-00005bf0: 4e41 220d 0a20 2020 2020 2020 2020 2020  NA"..           
-00005c00: 206c 6f67 5b27 7465 7374 5f6c 6f73 7327   log['test_loss'
-00005c10: 5d20 3d20 224e 4122 0d0a 2020 2020 2020  ] = "NA"..      
-00005c20: 2020 2020 2020 6c6f 675b 2774 6573 745f        log['test_
-00005c30: 6d65 7472 6963 7327 5d20 3d20 224e 4122  metrics'] = "NA"
-00005c40: 0d0a 2020 2020 2020 2020 2020 2020 6c6f  ..            lo
-00005c50: 675b 2774 6573 745f 6c6f 7373 6573 275d  g['test_losses']
-00005c60: 203d 2022 4e41 220d 0a20 2020 2020 2020   = "NA"..       
-00005c70: 2073 656c 662e 6c6f 672e 7570 6461 7465   self.log.update
-00005c80: 286c 6f67 290d 0a0d 0a20 2020 2020 2020  (log)....       
-00005c90: 2077 6974 6820 6f70 656e 2873 6176 6570   with open(savep
-00005ca0: 6174 682c 2027 612b 272c 206e 6577 6c69  ath, 'a+', newli
-00005cb0: 6e65 3d27 2729 2061 7320 6373 765f 6669  ne='') as csv_fi
-00005cc0: 6c65 3a0d 0a20 2020 2020 2020 2020 2020  le:..           
-00005cd0: 2077 7269 7465 7220 3d20 6373 762e 4469   writer = csv.Di
-00005ce0: 6374 5772 6974 6572 2863 7376 5f66 696c  ctWriter(csv_fil
-00005cf0: 652c 2066 6965 6c64 6e61 6d65 733d 7365  e, fieldnames=se
-00005d00: 6c66 2e6c 6f67 2e6b 6579 7328 2929 0d0a  lf.log.keys())..
-00005d10: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00005d20: 6f74 2061 7070 656e 6469 6e67 3a0d 0a20  ot appending:.. 
-00005d30: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00005d40: 7269 7465 722e 7772 6974 6568 6561 6465  riter.writeheade
-00005d50: 7228 290d 0a20 2020 2020 2020 2020 2020  r()..           
-00005d60: 2077 7269 7465 722e 7772 6974 6572 6f77   writer.writerow
-00005d70: 2873 656c 662e 6c6f 6729 0d0a 2020 2020  (self.log)..    
-00005d80: 2020 2020 2020 2020 7072 696e 7428 2253          print("S
-00005d90: 6176 696e 6720 7570 6461 7465 6420 6c6f  aving updated lo
-00005da0: 6720 746f 3a20 222c 2020 7361 7665 7061  g to: ",  savepa
-00005db0: 7468 290d 0a0d 0a20 2020 2064 6566 2073  th)....    def s
-00005dc0: 6176 6528 7365 6c66 293a 0d0a 2020 2020  ave(self):..    
-00005dd0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00005de0: 2053 6176 6573 2074 6865 206d 6f64 656c   Saves the model
-00005df0: 2061 6e64 2028 6f70 7469 6f6e 616c 6c79   and (optionally
-00005e00: 2c20 7061 7474 6572 6e73 2c20 636f 6e66  , patterns, conf
-00005e10: 7573 696f 6e20 6d61 7472 6963 6573 290d  usion matrices).
-00005e20: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00005e30: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00005e40: 0d0a 2020 2020 2020 2020 2355 7064 6174  ..        #Updat
-00005e50: 6520 616e 6420 7361 7665 206d 6574 6120  e and save meta 
-00005e60: 6669 6c65 0d0a 2020 2020 2020 2020 7365  file..        se
-00005e70: 6c66 2e6d 6574 612e 7570 6461 7465 2864  lf.meta.update(d
-00005e80: 6174 613d 7365 6c66 2e64 6174 6173 6574  ata=self.dataset
-00005e90: 2e68 5f70 6172 616d 732c 0d0a 2020 2020  .h_params,..    
-00005ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005eb0: 2020 2020 206d 6f64 656c 5f73 7065 6373       model_specs
-00005ec0: 3d73 656c 662e 7370 6563 732c 0d0a 2020  =self.specs,..  
-00005ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ee0: 2020 2020 2020 2074 7261 696e 5f70 6172         train_par
-00005ef0: 616d 733d 7365 6c66 2e74 7261 696e 5f70  ams=self.train_p
-00005f00: 6172 616d 732c 0d0a 2020 2020 2020 2020  arams,..        
-00005f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f20: 2070 6174 7465 726e 733d 7365 6c66 2e63   patterns=self.c
-00005f30: 765f 7061 7474 6572 6e73 290d 0a20 2020  v_patterns)..   
-00005f40: 2020 2020 2073 656c 662e 6d65 7461 2e73       self.meta.s
-00005f50: 6176 6528 290d 0a20 2020 2020 2020 200d  ave()..        .
-00005f60: 0a20 2020 2020 2020 206d 6f64 656c 5f6e  .        model_n
-00005f70: 616d 6520 3d20 225f 222e 6a6f 696e 285b  ame = "_".join([
-00005f80: 7365 6c66 2e73 636f 7065 2c0d 0a20 2020  self.scope,..   
-00005f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fa0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00005fb0: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
-00005fc0: 735b 2764 6174 615f 6964 275d 5d29 0d0a  s['data_id']])..
-00005fd0: 2020 2020 2020 2020 2373 656c 662e 7370          #self.sp
-00005fe0: 6563 735b 276d 6f64 656c 5f6e 616d 6527  ecs['model_name'
-00005ff0: 5d20 3d20 6d6f 6465 6c5f 6e61 6d65 0d0a  ] = model_name..
-00006000: 0d0a 2020 2020 2020 2020 2373 6176 6520  ..        #save 
-00006010: 7468 6520 6d6f 6465 6c0d 0a20 2020 2020  the model..     
-00006020: 2020 2073 656c 662e 6b6d 2e73 6176 6528     self.km.save(
-00006030: 6f73 2e70 6174 682e 6a6f 696e 2873 656c  os.path.join(sel
-00006040: 662e 6d6f 6465 6c5f 7061 7468 2c20 6d6f  f.model_path, mo
-00006050: 6465 6c5f 6e61 6d65 202b 2027 2e68 3527  del_name + '.h5'
-00006060: 2929 0d0a 2020 2020 2020 2020 0d0a 0d0a  ))..        ....
-00006070: 2020 2020 2020 2020 2320 2353 6176 6520          # #Save 
-00006080: 7265 7375 6c74 7320 6672 6f6d 206d 756c  results from mul
-00006090: 7469 706c 6520 666f 6c64 730d 0a20 2020  tiple folds..   
-000060a0: 2020 2020 2023 2069 6620 6861 7361 7474       # if hasatt
-000060b0: 7228 7365 6c66 2c20 2763 765f 7061 7474  r(self, 'cv_patt
-000060c0: 6572 6e73 2729 3a0d 0a20 2020 2020 2020  erns'):..       
-000060d0: 2023 2020 2020 2023 6966 2068 6173 6174   #     #if hasat
-000060e0: 7472 2873 656c 662c 2027 6376 5f70 6174  tr(self, 'cv_pat
-000060f0: 7465 726e 7327 293a 0d0a 2020 2020 2020  terns'):..      
-00006100: 2020 2320 2020 2020 7072 696e 7428 2253    #     print("S
-00006110: 6176 696e 6720 7061 7474 6572 6e73 2074  aving patterns t
-00006120: 6f3a 2022 202b 2073 656c 662e 6d6f 6465  o: " + self.mode
-00006130: 6c5f 7061 7468 202b 2073 656c 662e 6d6f  l_path + self.mo
-00006140: 6465 6c5f 6e61 6d65 202b 2022 5c5c 6d6e  del_name + "\\mn
-00006150: 6566 6c6f 775f 7061 7474 6572 6e73 2e6e  eflow_patterns.n
-00006160: 707a 2220 290d 0a20 2020 2020 2020 2023  pz" )..        #
-00006170: 2020 2020 206e 702e 7361 7665 7a28 7365       np.savez(se
-00006180: 6c66 2e6d 6f64 656c 5f70 6174 6820 2b20  lf.model_path + 
-00006190: 7365 6c66 2e6d 6f64 656c 5f6e 616d 6520  self.model_name 
-000061a0: 2b20 225c 5c6d 6e65 666c 6f77 5f70 6174  + "\\mneflow_pat
-000061b0: 7465 726e 732e 6e70 7a22 2c0d 0a20 2020  terns.npz",..   
-000061c0: 2020 2020 2023 2020 2020 2020 2020 2020       #          
-000061d0: 2020 2020 6376 5f70 6174 7465 726e 733d      cv_patterns=
-000061e0: 7365 6c66 2e63 765f 7061 7474 6572 6e73  self.cv_patterns
-000061f0: 2c0d 0a20 2020 2020 2020 2023 2020 2020  ,..        #    
-00006200: 2020 2020 2020 2020 2020 7370 6563 733d            specs=
-00006210: 7365 6c66 2e73 7065 6373 2c0d 0a20 2020  self.specs,..   
-00006220: 2020 2020 2023 2020 2020 2020 2020 2020       #          
-00006230: 2020 2020 6d65 7461 3d73 656c 662e 6461      meta=self.da
-00006240: 7461 7365 742e 685f 7061 7261 6d73 2c0d  taset.h_params,.
-00006250: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
-00006260: 2020 2020 2020 2020 6c6f 673d 7365 6c66          log=self
-00006270: 2e6c 6f67 2c0d 0a20 2020 2020 2020 2023  .log,..        #
-00006280: 2020 2020 2020 2020 2020 2020 2020 636d                cm
-00006290: 3d73 656c 662e 636d 2c0d 0a20 2020 2020  =self.cm,..     
-000062a0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-000062b0: 2020 290d 0a0d 0a20 2020 2020 2020 2023    )....        #
-000062c0: 5570 6461 7465 206d 6574 6164 6174 6120  Update metadata 
-000062d0: 7769 7468 2073 7065 6373 2061 6e64 206e  with specs and n
-000062e0: 6577 2073 656c 662e 6461 7461 7365 7420  ew self.dataset 
-000062f0: 6f70 7469 6f6e 730d 0a20 2020 2020 2020  options..       
-00006300: 2023 466f 7220 4c46 434e 4e20 7361 7665   #For LFCNN save
-00006310: 2070 6174 7465 726e 730d 0a0d 0a20 2020   patterns....   
-00006320: 2023 2064 6566 2072 6573 746f 7265 2873   # def restore(s
-00006330: 656c 662c 206d 6574 6129 3a0d 0a20 2020  elf, meta):..   
-00006340: 2023 2020 2020 2023 544f 444f 3a20 7461   #     #TODO: ta
-00006350: 6b65 2070 6174 682c 2073 636f 7065 2c20  ke path, scope, 
-00006360: 616e 6420 6461 7461 5f69 6420 6173 2069  and data_id as i
-00006370: 6e70 7574 732e 0d0a 2020 2020 2320 2020  nputs...    #   
-00006380: 2020 2354 4f44 4f3a 2062 7569 6c64 2064    #TODO: build d
-00006390: 6174 6173 6574 2066 726f 6d20 6d65 7461  ataset from meta
-000063a0: 6461 7461 0d0a 2020 2020 2320 2020 2020  data..    #     
-000063b0: 2354 4f44 4f3a 2069 6e69 7469 616c 697a  #TODO: initializ
-000063c0: 6520 6672 6f6d 2073 7065 6373 0d0a 0d0a  e from specs....
-000063d0: 2020 2020 2320 2020 2020 7365 6c66 2e6d      #     self.m
-000063e0: 6f64 656c 5f6e 616d 6520 3d20 225f 222e  odel_name = "_".
-000063f0: 6a6f 696e 285b 7365 6c66 2e73 636f 7065  join([self.scope
-00006400: 2c0d 0a20 2020 2023 2020 2020 2020 2020  ,..    #        
-00006410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006420: 2020 2020 2020 2020 2073 656c 662e 6461           self.da
-00006430: 7461 7365 742e 685f 7061 7261 6d73 5b27  taset.h_params['
-00006440: 6461 7461 5f69 6427 5d5d 290d 0a20 2020  data_id']])..   
-00006450: 2023 2020 2020 2073 656c 662e 6b6d 2020   #     self.km  
-00006460: 3d20 7466 2e6b 6572 6173 2e6d 6f64 656c  = tf.keras.model
-00006470: 732e 6c6f 6164 5f6d 6f64 656c 2873 656c  s.load_model(sel
-00006480: 662e 6d6f 6465 6c5f 7061 7468 202b 2073  f.model_path + s
-00006490: 656c 662e 6d6f 6465 6c5f 6e61 6d65 290d  elf.model_name).
-000064a0: 0a20 2020 2023 2020 2020 2023 7472 793a  .    #     #try:
-000064b0: 0d0a 0d0a 2020 2020 2320 2020 2020 6966  ....    #     if
-000064c0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-000064d0: 7365 6c66 2e6d 6f64 656c 5f70 6174 6820  self.model_path 
-000064e0: 2b20 7365 6c66 2e6d 6f64 656c 5f6e 616d  + self.model_nam
-000064f0: 6520 2b20 225c 5c6d 6e65 666c 6f77 5f70  e + "\\mneflow_p
-00006500: 6174 7465 726e 732e 6e70 7a22 293a 0d0a  atterns.npz"):..
-00006510: 2020 2020 2320 2020 2020 2020 2020 7072      #         pr
-00006520: 696e 7428 2252 6573 746f 7269 6e67 2066  int("Restoring f
-00006530: 726f 6d3a 2220 2b20 7365 6c66 2e6d 6f64  rom:" + self.mod
-00006540: 656c 5f70 6174 6820 2b20 7365 6c66 2e6d  el_path + self.m
-00006550: 6f64 656c 5f6e 616d 6520 2b20 225c 5c6d  odel_name + "\\m
-00006560: 6e65 666c 6f77 5f70 6174 7465 726e 732e  neflow_patterns.
-00006570: 6e70 7a22 2029 0d0a 2020 2020 2320 2020  npz" )..    #   
-00006580: 2020 2020 2020 6620 3d20 6e70 2e6c 6f61        f = np.loa
-00006590: 6428 7365 6c66 2e6d 6f64 656c 5f70 6174  d(self.model_pat
-000065a0: 6820 2b20 7365 6c66 2e6d 6f64 656c 5f6e  h + self.model_n
-000065b0: 616d 6520 2b20 225c 5c6d 6e65 666c 6f77  ame + "\\mneflow
-000065c0: 5f70 6174 7465 726e 732e 6e70 7a22 2c0d  _patterns.npz",.
-000065d0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-000065e0: 2020 2020 2020 2020 2020 2061 6c6c 6f77             allow
-000065f0: 5f70 6963 6b6c 653d 5472 7565 290d 0a20  _pickle=True).. 
-00006600: 2020 2023 2020 2020 2020 2020 2073 656c     #         sel
-00006610: 662e 6376 5f70 6174 7465 726e 7320 3d20  f.cv_patterns = 
-00006620: 665b 2263 765f 7061 7474 6572 6e73 225d  f["cv_patterns"]
-00006630: 232e 6974 656d 2829 0d0a 2020 2020 2320  #.item()..    # 
-00006640: 2020 2020 2020 2020 7365 6c66 2e73 7065          self.spe
-00006650: 6373 203d 2066 5b22 7370 6563 7322 5d23  cs = f["specs"]#
-00006660: 2e69 7465 6d28 290d 0a20 2020 2023 2020  .item()..    #  
-00006670: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-00006680: 203d 2066 5b22 6d65 7461 225d 232e 6974   = f["meta"]#.it
-00006690: 656d 2829 0d0a 2020 2020 2320 2020 2020  em()..    #     
-000066a0: 2020 2020 7365 6c66 2e6c 6f67 203d 2066      self.log = f
-000066b0: 5b22 6c6f 6722 5d23 2e69 7465 6d28 290d  ["log"]#.item().
-000066c0: 0a20 2020 2023 2020 2020 2020 2020 2073  .    #         s
-000066d0: 656c 662e 636d 203d 2066 5b22 636d 225d  elf.cm = f["cm"]
-000066e0: 0d0a 0d0a 2020 2020 6465 6620 7072 6564  ....    def pred
-000066f0: 6963 745f 7361 6d70 6c65 2873 656c 662c  ict_sample(self,
-00006700: 2078 293a 0d0a 2020 2020 2020 2020 6e5f   x):..        n_
-00006710: 6368 203d 2073 656c 662e 6461 7461 7365  ch = self.datase
-00006720: 742e 685f 7061 7261 6d73 5b27 6e5f 6368  t.h_params['n_ch
-00006730: 275d 0d0a 2020 2020 2020 2020 6e5f 7420  ']..        n_t 
-00006740: 3d20 7365 6c66 2e64 6174 6173 6574 2e68  = self.dataset.h
-00006750: 5f70 6172 616d 735b 276e 5f74 275d 0d0a  _params['n_t']..
-00006760: 2020 2020 2020 2020 6173 7365 7274 2078          assert x
-00006770: 2e73 6861 7065 5b2d 323a 5d20 3d3d 2028  .shape[-2:] == (
-00006780: 6e5f 742c 206e 5f63 6829 2c20 2022 5368  n_t, n_ch),  "Sh
-00006790: 6170 6520 6d69 736d 6174 6368 2120 4578  ape mismatch! Ex
-000067a0: 7065 6374 6564 207b 7d78 7b7d 2c20 5c0d  pected {}x{}, \.
-000067b0: 0a20 2020 2020 2020 2020 2020 2067 6f74  .            got
-000067c0: 207b 7d78 7b7d 222e 666f 726d 6174 286e   {}x{}".format(n
-000067d0: 5f74 2c20 6e5f 6368 2c20 782e 7368 6170  _t, n_ch, x.shap
-000067e0: 655b 2d32 5d2c 2078 2e73 6861 7065 5b2d  e[-2], x.shape[-
-000067f0: 315d 290d 0a0d 0a20 2020 2020 2020 2077  1])....        w
-00006800: 6869 6c65 2078 2e6e 6469 6d20 3c20 343a  hile x.ndim < 4:
-00006810: 0d0a 2020 2020 2020 2020 2020 2020 7820  ..            x 
-00006820: 3d20 6e70 2e65 7870 616e 645f 6469 6d73  = np.expand_dims
-00006830: 2878 2c20 3029 0d0a 0d0a 2020 2020 2020  (x, 0)....      
-00006840: 2020 6f75 7420 3d20 7365 6c66 2e6b 6d2e    out = self.km.
-00006850: 7072 6564 6963 7428 7829 0d0a 2020 2020  predict(x)..    
-00006860: 2020 2020 6966 2073 656c 662e 6461 7461      if self.data
-00006870: 7365 742e 685f 7061 7261 6d73 5b27 7461  set.h_params['ta
-00006880: 7267 6574 5f74 7970 6527 5d20 3d3d 2027  rget_type'] == '
-00006890: 696e 7427 3a0d 0a20 2020 2020 2020 2020  int':..         
-000068a0: 2020 206f 7574 203d 206e 702e 6172 676d     out = np.argm
-000068b0: 6178 286f 7574 2c20 2d31 290d 0a0d 0a20  ax(out, -1).... 
-000068c0: 2020 2020 2020 2072 6574 7572 6e20 6f75         return ou
-000068d0: 740d 0a0d 0a20 2020 2064 6566 2070 7265  t....    def pre
-000068e0: 6469 6374 2873 656c 662c 2064 6174 6173  dict(self, datas
-000068f0: 6574 3d4e 6f6e 6529 3a0d 0a20 2020 2020  et=None):..     
-00006900: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00006910: 5265 7475 726e 730d 0a20 2020 2020 2020  Returns..       
-00006920: 202d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020   -------..      
-00006930: 2020 795f 7472 7565 203a 206e 702e 6172    y_true : np.ar
-00006940: 7261 790d 0a20 2020 2020 2020 2020 2020  ray..           
-00006950: 2020 2020 2067 726f 756e 6420 7472 7574       ground trut
-00006960: 6820 6c61 6265 6c73 2074 616b 656e 2066  h labels taken f
-00006970: 726f 6d20 7468 6520 6461 7461 7365 740d  rom the dataset.
-00006980: 0a0d 0a20 2020 2020 2020 2079 5f70 7265  ...        y_pre
-00006990: 6420 3a20 6e70 2e61 7272 6179 0d0a 2020  d : np.array..  
-000069a0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-000069b0: 6465 6c20 7072 6564 6963 7469 6f6e 730d  del predictions.
-000069c0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-000069d0: 2020 2020 2020 6966 206e 6f74 2064 6174        if not dat
-000069e0: 6173 6574 3a0d 0a20 2020 2020 2020 2020  aset:..         
-000069f0: 2020 2070 7269 6e74 2822 4e6f 2064 6174     print("No dat
-00006a00: 6173 6574 2073 7065 6369 6669 6564 2075  aset specified u
-00006a10: 7369 6e67 2076 616c 6964 6174 696f 6e20  sing validation 
-00006a20: 6461 7461 7365 7420 2844 6566 6175 6c74  dataset (Default
-00006a30: 2922 290d 0a20 2020 2020 2020 2020 2020  )")..           
-00006a40: 2064 6174 6173 6574 203d 2073 656c 662e   dataset = self.
-00006a50: 6461 7461 7365 742e 7661 6c0d 0a20 2020  dataset.val..   
-00006a60: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-00006a70: 616e 6365 2864 6174 6173 6574 2c20 7374  ance(dataset, st
-00006a80: 7229 206f 7220 6973 696e 7374 616e 6365  r) or isinstance
-00006a90: 2864 6174 6173 6574 2c20 286c 6973 742c  (dataset, (list,
-00006aa0: 2074 7570 6c65 2929 3a0d 0a20 2020 2020   tuple)):..     
-00006ab0: 2020 2020 2020 2064 6174 6173 6574 203d         dataset =
-00006ac0: 2073 656c 662e 6461 7461 7365 742e 5f62   self.dataset._b
-00006ad0: 7569 6c64 5f64 6174 6173 6574 2864 6174  uild_dataset(dat
-00006ae0: 6173 6574 2c0d 0a20 2020 2020 2020 2020  aset,..         
-00006af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b10: 2020 2020 2020 2020 7370 6c69 743d 4661          split=Fa
-00006b20: 6c73 652c 0d0a 2020 2020 2020 2020 2020  lse,..          
-00006b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b50: 2020 2020 2020 2074 6573 745f 6261 7463         test_batc
-00006b60: 683d 4e6f 6e65 2c0d 0a20 2020 2020 2020  h=None,..       
-00006b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b90: 2020 2020 2020 2020 2020 7265 7065 6174            repeat
-00006ba0: 3d46 616c 7365 290d 0a20 2020 2020 2020  =False)..       
-00006bb0: 2065 6c69 6620 6e6f 7420 6973 696e 7374   elif not isinst
-00006bc0: 616e 6365 2864 6174 6173 6574 2c20 7466  ance(dataset, tf
-00006bd0: 2e64 6174 612e 4461 7461 7365 7429 3a0d  .data.Dataset):.
-00006be0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00006bf0: 6e74 2822 5370 6563 6966 7920 6461 7461  nt("Specify data
-00006c00: 7365 7422 290d 0a20 2020 2020 2020 2020  set")..         
-00006c10: 2020 2072 6574 7572 6e20 4e6f 6e65 2c20     return None, 
-00006c20: 4e6f 6e65 0d0a 0d0a 2020 2020 2020 2020  None....        
-00006c30: 5820 3d20 5b5d 0d0a 2020 2020 2020 2020  X = []..        
-00006c40: 7920 3d20 5b5d 0d0a 0d0a 2020 2020 2020  y = []....      
-00006c50: 2020 666f 7220 726f 7720 696e 2064 6174    for row in dat
-00006c60: 6173 6574 2e74 616b 6528 3129 3a0d 0a20  aset.take(1):.. 
-00006c70: 2020 2020 2020 2020 2020 2058 2e61 7070             X.app
-00006c80: 656e 6428 726f 775b 305d 290d 0a20 2020  end(row[0])..   
-00006c90: 2020 2020 2020 2020 2079 2e61 7070 656e           y.appen
-00006ca0: 6428 726f 775b 315d 290d 0a0d 0a20 2020  d(row[1])....   
-00006cb0: 2020 2020 2079 5f70 7265 6420 3d20 7365       y_pred = se
-00006cc0: 6c66 2e6b 6d2e 7072 6564 6963 7428 6e70  lf.km.predict(np
-00006cd0: 2e63 6f6e 6361 7465 6e61 7465 2858 2929  .concatenate(X))
-00006ce0: 0d0a 2020 2020 2020 2020 795f 7472 7565  ..        y_true
-00006cf0: 203d 206e 702e 636f 6e63 6174 656e 6174   = np.concatenat
-00006d00: 6528 7929 0d0a 0d0a 2020 2020 2020 2020  e(y)....        
-00006d10: 2379 5f74 7275 6520 3d20 795f 7472 7565  #y_true = y_true
-00006d20: 2e6e 756d 7079 2829 0d0a 2020 2020 2020  .numpy()..      
-00006d30: 2020 7265 7475 726e 2079 5f74 7275 652c    return y_true,
-00006d40: 2079 5f70 7265 640d 0a0d 0a20 2020 2064   y_pred....    d
-00006d50: 6566 2065 7661 6c75 6174 6528 7365 6c66  ef evaluate(self
-00006d60: 2c20 6461 7461 7365 743d 4661 6c73 6529  , dataset=False)
-00006d70: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
-00006d80: 2020 2020 2020 2020 5265 7475 726e 730d          Returns.
-00006d90: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00006da0: 0d0a 2020 2020 2020 2020 6c6f 7373 6573  ..        losses
-00006db0: 203a 206c 6973 740d 0a20 2020 2020 2020   : list..       
-00006dc0: 2020 2020 2020 2020 206d 6f64 656c 206c           model l
-00006dd0: 6f73 7320 6f6e 2061 2073 7065 6369 6669  oss on a specifi
-00006de0: 6564 2064 6174 6173 6574 0d0a 0d0a 2020  ed dataset....  
-00006df0: 2020 2020 2020 6d65 7472 6963 7320 3a20        metrics : 
-00006e00: 6e70 2e61 7272 6179 0d0a 2020 2020 2020  np.array..      
-00006e10: 2020 2020 2020 2020 2020 6d65 7472 6963            metric
-00006e20: 7320 6576 616c 7561 7465 6420 6f6e 2061  s evaluated on a
-00006e30: 2073 7065 6369 6669 6564 2064 6174 6173   specified datas
-00006e40: 6574 0d0a 2020 2020 2020 2020 2222 220d  et..        """.
-00006e50: 0a0d 0a20 2020 2020 2020 2069 6620 6e6f  ...        if no
-00006e60: 7420 6461 7461 7365 743a 0d0a 2020 2020  t dataset:..    
-00006e70: 2020 2020 2020 2020 7072 696e 7428 224e          print("N
-00006e80: 6f20 6461 7461 7365 7420 7370 6563 6966  o dataset specif
-00006e90: 6965 6420 7573 696e 6720 7661 6c69 6461  ied using valida
-00006ea0: 7469 6f6e 2064 6174 6173 6574 2028 4465  tion dataset (De
-00006eb0: 6661 756c 7429 2229 0d0a 2020 2020 2020  fault)")..      
-00006ec0: 2020 2020 2020 6461 7461 7365 7420 3d20        dataset = 
-00006ed0: 7365 6c66 2e64 6174 6173 6574 2e76 616c  self.dataset.val
-00006ee0: 0d0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
-00006ef0: 7369 6e73 7461 6e63 6528 6461 7461 7365  sinstance(datase
-00006f00: 742c 2073 7472 2920 6f72 2069 7369 6e73  t, str) or isins
-00006f10: 7461 6e63 6528 6461 7461 7365 742c 2028  tance(dataset, (
-00006f20: 6c69 7374 2c20 7475 706c 6529 293a 0d0a  list, tuple)):..
-00006f30: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00006f40: 7365 7420 3d20 7365 6c66 2e64 6174 6173  set = self.datas
-00006f50: 6574 2e5f 6275 696c 645f 6461 7461 7365  et._build_datase
-00006f60: 7428 6461 7461 7365 742c 0d0a 2020 2020  t(dataset,..    
-00006f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f90: 2020 2020 2020 2020 2073 706c 6974 3d46           split=F
-00006fa0: 616c 7365 2c0d 0a20 2020 2020 2020 2020  alse,..         
-00006fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fd0: 2020 2020 7465 7374 5f62 6174 6368 3d4e      test_batch=N
-00006fe0: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
-00006ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007010: 2020 2072 6570 6561 743d 5472 7565 290d     repeat=True).
-00007020: 0a20 2020 2020 2020 2065 6c69 6620 6e6f  .        elif no
-00007030: 7420 6973 696e 7374 616e 6365 2864 6174  t isinstance(dat
-00007040: 6173 6574 2c20 7466 2e64 6174 612e 4461  aset, tf.data.Da
-00007050: 7461 7365 7429 3a0d 0a20 2020 2020 2020  taset):..       
-00007060: 2020 2020 2070 7269 6e74 2822 5370 6563       print("Spec
-00007070: 6966 7920 6461 7461 7365 7422 290d 0a20  ify dataset").. 
-00007080: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00007090: 6e20 4e6f 6e65 2c20 4e6f 6e65 0d0a 0d0a  n None, None....
-000070a0: 2020 2020 2020 2020 6c6f 7373 6573 2c20          losses, 
-000070b0: 6d65 7472 6963 7320 3d20 7365 6c66 2e6b  metrics = self.k
-000070c0: 6d2e 6576 616c 7561 7465 2864 6174 6173  m.evaluate(datas
-000070d0: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
-000070e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000070f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007100: 7374 6570 733d 7365 6c66 2e64 6174 6173  steps=self.datas
-00007110: 6574 2e76 616c 6964 6174 696f 6e5f 7374  et.validation_st
-00007120: 6570 732c 0d0a 2020 2020 2020 2020 2020  eps,..          
-00007130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007150: 2076 6572 626f 7365 3d30 290d 0a20 2020   verbose=0)..   
-00007160: 2020 2020 2072 6574 7572 6e20 206c 6f73       return  los
-00007170: 7365 732c 206d 6574 7269 6373 0d0a 0d0a  ses, metrics....
-00007180: 2020 2020 6465 6620 706c 6f74 5f63 6f6e      def plot_con
-00007190: 6675 7369 6f6e 5f6d 6174 7269 7828 7365  fusion_matrix(se
-000071a0: 6c66 2c20 636d 3d4e 6f6e 652c 0d0a 2020  lf, cm=None,..  
-000071b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000071c0: 2020 2020 2020 2020 2020 2020 636c 6173              clas
-000071d0: 7365 733d 4e6f 6e65 2c0d 0a20 2020 2020  ses=None,..     
-000071e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000071f0: 2020 2020 2020 2020 206e 6f72 6d61 6c69           normali
-00007200: 7a65 3d54 7275 652c 0d0a 2020 2020 2020  ze=True,..      
-00007210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007220: 2020 2020 2020 2020 7469 746c 653d 4e6f          title=No
-00007230: 6e65 2c0d 0a20 2020 2020 2020 2020 2020  ne,..           
-00007240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007250: 2020 2063 6d61 703d 706c 742e 636d 2e42     cmap=plt.cm.B
-00007260: 6c75 6573 293a 0d0a 2020 2020 2020 2020  lues):..        
-00007270: 2222 220d 0a20 2020 2020 2020 2054 6869  """..        Thi
-00007280: 7320 6675 6e63 7469 6f6e 2070 7269 6e74  s function print
-00007290: 7320 616e 6420 706c 6f74 7320 7468 6520  s and plots the 
-000072a0: 636f 6e66 7573 696f 6e20 6d61 7472 6978  confusion matrix
-000072b0: 2e0d 0a20 2020 2020 2020 204e 6f72 6d61  ...        Norma
-000072c0: 6c69 7a61 7469 6f6e 2063 616e 2062 6520  lization can be 
-000072d0: 6170 706c 6965 6420 6279 2073 6574 7469  applied by setti
-000072e0: 6e67 2060 6e6f 726d 616c 697a 653d 5472  ng `normalize=Tr
-000072f0: 7565 602e 0d0a 2020 2020 2020 2020 2222  ue`...        ""
-00007300: 220d 0a20 2020 2020 2020 2069 6620 6e6f  "..        if no
-00007310: 7420 7469 746c 653a 0d0a 2020 2020 2020  t title:..      
-00007320: 2020 2020 2020 6966 206e 6f72 6d61 6c69        if normali
-00007330: 7a65 3a0d 0a20 2020 2020 2020 2020 2020  ze:..           
-00007340: 2020 2020 2074 6974 6c65 203d 2027 4e6f       title = 'No
-00007350: 726d 616c 697a 6564 2063 6f6e 6675 7369  rmalized confusi
-00007360: 6f6e 206d 6174 7269 7827 0d0a 2020 2020  on matrix'..    
-00007370: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00007380: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00007390: 6974 6c65 203d 2027 436f 6e66 7573 696f  itle = 'Confusio
-000073a0: 6e20 6d61 7472 6978 2c20 7769 7468 6f75  n matrix, withou
-000073b0: 7420 6e6f 726d 616c 697a 6174 696f 6e27  t normalization'
-000073c0: 0d0a 0d0a 2020 2020 2020 2020 2320 436f  ....        # Co
-000073d0: 6d70 7574 6520 636f 6e66 7573 696f 6e20  mpute confusion 
-000073e0: 6d61 7472 6978 0d0a 2020 2020 2020 2020  matrix..        
-000073f0: 6966 206e 6f74 206e 702e 616e 7928 636d  if not np.any(cm
-00007400: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00007410: 636d 203d 2073 656c 662e 636d 0d0a 2020  cm = self.cm..  
-00007420: 2020 2020 2020 2320 4f6e 6c79 2075 7365        # Only use
-00007430: 2074 6865 206c 6162 656c 7320 7468 6174   the labels that
-00007440: 2061 7070 6561 7220 696e 2074 6865 2064   appear in the d
-00007450: 6174 610d 0a20 2020 2020 2020 2023 636c  ata..        #cl
-00007460: 6173 7365 7320 3d20 636c 6173 7365 735b  asses = classes[
-00007470: 756e 6971 7565 5f6c 6162 656c 7328 795f  unique_labels(y_
-00007480: 7472 7565 2c20 795f 7072 6564 295d 0d0a  true, y_pred)]..
-00007490: 2020 2020 2020 2020 6966 206e 6f74 2063          if not c
-000074a0: 6c61 7373 6573 3a0d 0a20 2020 2020 2020  lasses:..       
-000074b0: 2020 2020 2063 6c61 7373 6573 203d 205b       classes = [
-000074c0: 2720 272e 6a6f 696e 285b 2243 6c61 7373  ' '.join(["Class
-000074d0: 222c 2073 7472 2869 295d 2920 666f 7220  ", str(i)]) for 
-000074e0: 6920 696e 2072 616e 6765 2863 6d2e 7368  i in range(cm.sh
-000074f0: 6170 655b 305d 295d 0d0a 2020 2020 2020  ape[0])]..      
-00007500: 2020 6966 206e 6f72 6d61 6c69 7a65 3a0d    if normalize:.
-00007510: 0a20 2020 2020 2020 2020 2020 2063 6d20  .            cm 
-00007520: 3d20 636d 2e61 7374 7970 6528 2766 6c6f  = cm.astype('flo
-00007530: 6174 2729 202f 2063 6d2e 7375 6d28 6178  at') / cm.sum(ax
-00007540: 6973 3d31 295b 3a2c 206e 702e 6e65 7761  is=1)[:, np.newa
-00007550: 7869 735d 0d0a 0d0a 2020 2020 2020 2020  xis]....        
-00007560: 2370 7269 6e74 2863 6d29 0d0a 2020 2020  #print(cm)..    
-00007570: 2020 2020 6669 672c 2061 7820 3d20 706c      fig, ax = pl
-00007580: 742e 7375 6270 6c6f 7473 2829 0d0a 2020  t.subplots()..  
-00007590: 2020 2020 2020 696d 203d 2061 782e 696d        im = ax.im
-000075a0: 7368 6f77 2863 6d2c 2069 6e74 6572 706f  show(cm, interpo
-000075b0: 6c61 7469 6f6e 3d27 6e65 6172 6573 7427  lation='nearest'
-000075c0: 2c20 636d 6170 3d63 6d61 7029 0d0a 2020  , cmap=cmap)..  
-000075d0: 2020 2020 2020 6178 2e66 6967 7572 652e        ax.figure.
-000075e0: 636f 6c6f 7262 6172 2869 6d2c 2061 783d  colorbar(im, ax=
-000075f0: 6178 290d 0a20 2020 2020 2020 2023 2057  ax)..        # W
-00007600: 6520 7761 6e74 2074 6f20 7368 6f77 2061  e want to show a
-00007610: 6c6c 2074 6963 6b73 2e2e 2e0d 0a20 2020  ll ticks.....   
-00007620: 2020 2020 2061 782e 7365 7428 7874 6963       ax.set(xtic
-00007630: 6b73 3d6e 702e 6172 616e 6765 2863 6d2e  ks=np.arange(cm.
-00007640: 7368 6170 655b 315d 292c 0d0a 2020 2020  shape[1]),..    
-00007650: 2020 2020 2020 2020 2020 2079 7469 636b             ytick
-00007660: 733d 6e70 2e61 7261 6e67 6528 636d 2e73  s=np.arange(cm.s
-00007670: 6861 7065 5b30 5d29 2c0d 0a20 2020 2020  hape[0]),..     
-00007680: 2020 2020 2020 2020 2020 2320 2e2e 2e20            # ... 
-00007690: 616e 6420 6c61 6265 6c20 7468 656d 2077  and label them w
-000076a0: 6974 6820 7468 6520 7265 7370 6563 7469  ith the respecti
-000076b0: 7665 206c 6973 7420 656e 7472 6965 730d  ve list entries.
-000076c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000076d0: 7874 6963 6b6c 6162 656c 733d 636c 6173  xticklabels=clas
-000076e0: 7365 732c 2079 7469 636b 6c61 6265 6c73  ses, yticklabels
-000076f0: 3d63 6c61 7373 6573 2c0d 0a20 2020 2020  =classes,..     
-00007700: 2020 2020 2020 2020 2020 7469 746c 653d            title=
-00007710: 7469 746c 652c 0d0a 2020 2020 2020 2020  title,..        
-00007720: 2020 2020 2020 2079 6c61 6265 6c3d 2750         ylabel='P
-00007730: 7265 6469 6374 6564 206c 6162 656c 272c  redicted label',
-00007740: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00007750: 2078 6c61 6265 6c3d 2754 7275 6520 6c61   xlabel='True la
-00007760: 6265 6c27 290d 0a0d 0a20 2020 2020 2020  bel')....       
-00007770: 2023 2052 6f74 6174 6520 7468 6520 7469   # Rotate the ti
-00007780: 636b 206c 6162 656c 7320 616e 6420 7365  ck labels and se
-00007790: 7420 7468 6569 7220 616c 6967 6e6d 656e  t their alignmen
-000077a0: 742e 0d0a 2020 2020 2020 2020 706c 742e  t...        plt.
-000077b0: 7365 7470 2861 782e 6765 745f 7874 6963  setp(ax.get_xtic
-000077c0: 6b6c 6162 656c 7328 292c 2072 6f74 6174  klabels(), rotat
-000077d0: 696f 6e3d 3435 2c20 6861 3d22 7269 6768  ion=45, ha="righ
-000077e0: 7422 2c0d 0a20 2020 2020 2020 2020 2020  t",..           
-000077f0: 2020 2020 2020 726f 7461 7469 6f6e 5f6d        rotation_m
-00007800: 6f64 653d 2261 6e63 686f 7222 290d 0a0d  ode="anchor")...
-00007810: 0a20 2020 2020 2020 2023 204c 6f6f 7020  .        # Loop 
-00007820: 6f76 6572 2064 6174 6120 6469 6d65 6e73  over data dimens
-00007830: 696f 6e73 2061 6e64 2063 7265 6174 6520  ions and create 
-00007840: 7465 7874 2061 6e6e 6f74 6174 696f 6e73  text annotations
-00007850: 2e0d 0a20 2020 2020 2020 2066 6d74 203d  ...        fmt =
-00007860: 2027 2e32 6627 2069 6620 6e6f 726d 616c   '.2f' if normal
-00007870: 697a 6520 656c 7365 2027 2e30 6627 0d0a  ize else '.0f'..
-00007880: 2020 2020 2020 2020 7468 7265 7368 203d          thresh =
-00007890: 2063 6d2e 6d61 7828 2920 2f20 322e 0d0a   cm.max() / 2...
-000078a0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-000078b0: 2072 616e 6765 2863 6d2e 7368 6170 655b   range(cm.shape[
-000078c0: 305d 293a 0d0a 2020 2020 2020 2020 2020  0]):..          
-000078d0: 2020 666f 7220 6a20 696e 2072 616e 6765    for j in range
-000078e0: 2863 6d2e 7368 6170 655b 315d 293a 0d0a  (cm.shape[1]):..
-000078f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007900: 2369 6620 6920 3d3d 206a 3a0d 0a20 2020  #if i == j:..   
-00007910: 2020 2020 2020 2020 2020 2020 2061 782e               ax.
-00007920: 7465 7874 286a 2c20 692c 2066 6f72 6d61  text(j, i, forma
-00007930: 7428 636d 5b69 2c20 6a5d 2c20 666d 7429  t(cm[i, j], fmt)
-00007940: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00007950: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00007960: 613d 2263 656e 7465 7222 2c20 7661 3d22  a="center", va="
-00007970: 6365 6e74 6572 222c 0d0a 2020 2020 2020  center",..      
-00007980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007990: 2020 2020 2020 636f 6c6f 723d 2277 6869        color="whi
-000079a0: 7465 2220 6966 2063 6d5b 692c 206a 5d20  te" if cm[i, j] 
-000079b0: 3e20 7468 7265 7368 2065 6c73 6520 2262  > thresh else "b
-000079c0: 6c61 636b 2229 0d0a 2020 2020 2020 2020  lack")..        
-000079d0: 6669 672e 7469 6768 745f 6c61 796f 7574  fig.tight_layout
-000079e0: 2829 0d0a 2020 2020 2020 2020 2366 6967  ()..        #fig
-000079f0: 2e73 686f 7728 290d 0a20 2020 2020 2020  .show()..       
-00007a00: 2072 6574 7572 6e20 6669 670d 0a0d 0a0d   return fig.....
-00007a10: 0a0d 0a63 6c61 7373 204c 4643 4e4e 2842  ...class LFCNN(B
-00007a20: 6173 654d 6f64 656c 293a 0d0a 2020 2020  aseModel):..    
-00007a30: 2222 224c 462d 434e 4e2e 2049 6e63 6c75  """LF-CNN. Inclu
-00007a40: 6465 7320 6261 7369 6320 7061 7261 6d65  des basic parame
-00007a50: 7465 7220 696e 7465 7270 7265 7461 7469  ter interpretati
-00007a60: 6f6e 206f 7074 696f 6e73 2e0d 0a0d 0a20  on options..... 
-00007a70: 2020 2046 6f72 2064 6574 6169 6c73 2073     For details s
-00007a80: 6565 205b 315d 2e0d 0a20 2020 2052 6566  ee [1]...    Ref
-00007a90: 6572 656e 6365 730d 0a20 2020 202d 2d2d  erences..    ---
-00007aa0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-00007ab0: 205b 315d 2049 2e20 5a75 6261 7265 762c   [1] I. Zubarev,
-00007ac0: 2065 7420 616c 2e2c 2041 6461 7074 6976   et al., Adaptiv
-00007ad0: 6520 6e65 7572 616c 206e 6574 776f 726b  e neural network
-00007ae0: 2063 6c61 7373 6966 6965 7220 666f 720d   classifier for.
-00007af0: 0a20 2020 2020 2020 2064 6563 6f64 696e  .        decodin
-00007b00: 6720 4d45 4720 7369 676e 616c 732e 204e  g MEG signals. N
-00007b10: 6575 726f 696d 6167 652e 2028 3230 3139  euroimage. (2019
-00007b20: 2920 4d61 7920 343b 3139 373a 3432 352d  ) May 4;197:425-
-00007b30: 3433 340d 0a20 2020 2022 2222 0d0a 2020  434..    """..  
-00007b40: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00007b50: 656c 662c 206d 6574 612c 2064 6174 6173  elf, meta, datas
-00007b60: 6574 3d4e 6f6e 6529 3a0d 0a20 2020 2020  et=None):..     
-00007b70: 2020 2022 2222 0d0a 0d0a 2020 2020 2020     """....      
-00007b80: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
-00007b90: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00007ba0: 0d0a 2020 2020 2020 2020 4461 7461 7365  ..        Datase
-00007bb0: 7420 3a20 6d6e 6566 6c6f 772e 4461 7461  t : mneflow.Data
-00007bc0: 7365 740d 0a0d 0a20 2020 2020 2020 2073  set....        s
-00007bd0: 7065 6373 203a 2064 6963 740d 0a20 2020  pecs : dict..   
-00007be0: 2020 2020 2020 2020 2020 2020 2064 6963               dic
-00007bf0: 7469 6f6e 6172 7920 6f66 206d 6f64 656c  tionary of model
-00007c00: 2068 7970 6572 7061 7261 6d65 7465 7273   hyperparameters
-00007c10: 207b 0d0a 0d0a 2020 2020 2020 2020 6e5f   {....        n_
-00007c20: 6c61 7465 6e74 203a 2069 6e74 0d0a 2020  latent : int..  
-00007c30: 2020 2020 2020 2020 2020 4e75 6d62 6572            Number
-00007c40: 206f 6620 6c61 7465 6e74 2063 6f6d 706f   of latent compo
-00007c50: 6e65 6e74 732e 0d0a 2020 2020 2020 2020  nents...        
-00007c60: 2020 2020 4465 6661 756c 7473 2074 6f20      Defaults to 
-00007c70: 3332 2e0d 0a0d 0a20 2020 2020 2020 206e  32.....        n
-00007c80: 6f6e 6c69 6e20 3a20 6361 6c6c 6162 6c65  onlin : callable
-00007c90: 0d0a 2020 2020 2020 2020 2020 2020 4163  ..            Ac
-00007ca0: 7469 7661 7469 6f6e 2066 756e 6374 696f  tivation functio
-00007cb0: 6e20 6f66 2074 6865 2074 656d 706f 7261  n of the tempora
-00007cc0: 6c20 636f 6e76 6f6c 7574 696f 6e20 6c61  l convolution la
-00007cd0: 7965 722e 0d0a 2020 2020 2020 2020 2020  yer...          
-00007ce0: 2020 4465 6661 756c 7473 2074 6f20 7466    Defaults to tf
-00007cf0: 2e6e 6e2e 7265 6c75 0d0a 0d0a 2020 2020  .nn.relu....    
-00007d00: 2020 2020 6669 6c74 6572 5f6c 656e 6774      filter_lengt
-00007d10: 6820 3a20 696e 740d 0a20 2020 2020 2020  h : int..       
-00007d20: 2020 2020 204c 656e 6774 6820 6f66 2073       Length of s
-00007d30: 7061 7469 6f2d 7465 6d70 6f72 616c 206b  patio-temporal k
-00007d40: 6572 6e65 6c73 2069 6e20 7468 6520 7465  ernels in the te
-00007d50: 6d70 6f72 616c 0d0a 2020 2020 2020 2020  mporal..        
-00007d60: 2020 2020 636f 6e76 6f6c 7574 696f 6e20      convolution 
-00007d70: 6c61 7965 722e 2044 6566 6175 6c74 7320  layer. Defaults 
-00007d80: 746f 2037 2e0d 0a0d 0a20 2020 2020 2020  to 7.....       
-00007d90: 2070 6f6f 6c69 6e67 203a 2069 6e74 0d0a   pooling : int..
-00007da0: 2020 2020 2020 2020 2020 2020 506f 6f6c              Pool
-00007db0: 696e 6720 6661 6374 6f72 206f 6620 7468  ing factor of th
-00007dc0: 6520 6d61 7820 706f 6f6c 696e 6720 6c61  e max pooling la
-00007dd0: 7965 722e 2044 6566 6175 6c74 7320 746f  yer. Defaults to
-00007de0: 2032 0d0a 0d0a 2020 2020 2020 2020 706f   2....        po
-00007df0: 6f6c 5f74 7970 6520 3a20 7374 7220 7b27  ol_type : str {'
-00007e00: 6176 6727 2c20 276d 6178 277d 0d0a 2020  avg', 'max'}..  
-00007e10: 2020 2020 2020 2020 2020 5479 7065 206f            Type o
-00007e20: 6620 706f 6f6c 696e 6720 6f70 6572 6174  f pooling operat
-00007e30: 696f 6e2e 2044 6566 6175 6c74 7320 746f  ion. Defaults to
-00007e40: 2027 6d61 7827 2e0d 0a0d 0a20 2020 2020   'max'.....     
-00007e50: 2020 2070 6164 6469 6e67 203a 2073 7472     padding : str
-00007e60: 207b 2753 414d 4527 2c20 2746 554c 4c27   {'SAME', 'FULL'
-00007e70: 2c20 2756 414c 4944 277d 0d0a 2020 2020  , 'VALID'}..    
-00007e80: 2020 2020 2020 2020 436f 6e76 6f6c 7574          Convolut
-00007e90: 696f 6e20 7061 6464 696e 672e 2044 6566  ion padding. Def
-00007ea0: 6175 6c74 7320 746f 2027 5341 4d45 272e  aults to 'SAME'.
-00007eb0: 7d0d 0a0d 0a20 2020 2020 2020 2073 7472  }....        str
-00007ec0: 6964 6520 3a20 696e 740d 0a20 2020 2020  ide : int..     
-00007ed0: 2020 2053 7472 6964 6520 6f66 2074 6865     Stride of the
-00007ee0: 206d 6178 2070 6f6f 6c69 6e67 206c 6179   max pooling lay
-00007ef0: 6572 2e20 4465 6661 756c 7473 2074 6f20  er. Defaults to 
-00007f00: 312e 0d0a 2020 2020 2020 2020 2222 220d  1...        """.
-00007f10: 0a20 2020 2020 2020 2073 656c 662e 7363  .        self.sc
-00007f20: 6f70 6520 3d20 276c 6663 6e6e 270d 0a20  ope = 'lfcnn'.. 
-00007f30: 2020 2020 2020 2023 7370 6563 7320 3d20         #specs = 
-00007f40: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
-00007f50: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
-00007f60: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
-00007f70: 6661 756c 7428 2766 696c 7465 725f 6c65  fault('filter_le
-00007f80: 6e67 7468 272c 2037 290d 0a20 2020 2020  ngth', 7)..     
-00007f90: 2020 206d 6574 612e 6d6f 6465 6c5f 7370     meta.model_sp
-00007fa0: 6563 732e 7365 7464 6566 6175 6c74 2827  ecs.setdefault('
-00007fb0: 6e5f 6c61 7465 6e74 272c 2033 3229 0d0a  n_latent', 32)..
-00007fc0: 2020 2020 2020 2020 6d65 7461 2e6d 6f64          meta.mod
-00007fd0: 656c 5f73 7065 6373 2e73 6574 6465 6661  el_specs.setdefa
-00007fe0: 756c 7428 2770 6f6f 6c69 6e67 272c 2032  ult('pooling', 2
-00007ff0: 290d 0a20 2020 2020 2020 206d 6574 612e  )..        meta.
-00008000: 6d6f 6465 6c5f 7370 6563 732e 7365 7464  model_specs.setd
-00008010: 6566 6175 6c74 2827 7374 7269 6465 272c  efault('stride',
-00008020: 2032 290d 0a20 2020 2020 2020 206d 6574   2)..        met
-00008030: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
-00008040: 7464 6566 6175 6c74 2827 7061 6464 696e  tdefault('paddin
-00008050: 6727 2c20 2753 414d 4527 290d 0a20 2020  g', 'SAME')..   
-00008060: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
-00008070: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
-00008080: 2827 706f 6f6c 5f74 7970 6527 2c20 276d  ('pool_type', 'm
-00008090: 6178 2729 0d0a 2020 2020 2020 2020 6d65  ax')..        me
-000080a0: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
-000080b0: 6574 6465 6661 756c 7428 276e 6f6e 6c69  etdefault('nonli
-000080c0: 6e27 2c20 7466 2e6e 6e2e 7265 6c75 290d  n', tf.nn.relu).
-000080d0: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
-000080e0: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
-000080f0: 6175 6c74 2827 6c31 5f6c 616d 6264 6127  ault('l1_lambda'
-00008100: 2c20 3365 2d34 290d 0a20 2020 2020 2020  , 3e-4)..       
-00008110: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
-00008120: 732e 7365 7464 6566 6175 6c74 2827 6c32  s.setdefault('l2
-00008130: 5f6c 616d 6264 6127 2c20 302e 290d 0a20  _lambda', 0.).. 
-00008140: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
-00008150: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
-00008160: 6c74 2827 6c31 5f73 636f 7065 272c 205b  lt('l1_scope', [
-00008170: 2766 6327 2c20 2764 656d 6978 272c 2027  'fc', 'demix', '
-00008180: 6c66 5f63 6f6e 7627 5d29 0d0a 2020 2020  lf_conv'])..    
-00008190: 2020 2020 6d65 7461 2e6d 6f64 656c 5f73      meta.model_s
-000081a0: 7065 6373 2e73 6574 6465 6661 756c 7428  pecs.setdefault(
-000081b0: 276c 325f 7363 6f70 6527 2c20 5b5d 290d  'l2_scope', []).
-000081c0: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
-000081d0: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
-000081e0: 6175 6c74 2827 756e 6974 6e6f 726d 5f73  ault('unitnorm_s
-000081f0: 636f 7065 272c 205b 5d29 0d0a 2020 2020  cope', [])..    
-00008200: 2020 2020 6d65 7461 2e6d 6f64 656c 5f73      meta.model_s
-00008210: 7065 6373 5b27 7363 6f70 6527 5d20 3d20  pecs['scope'] = 
-00008220: 7365 6c66 2e73 636f 7065 0d0a 2020 2020  self.scope..    
-00008230: 2020 2020 2373 7065 6373 2e73 6574 6465      #specs.setde
-00008240: 6661 756c 7428 276d 6f64 656c 5f70 6174  fault('model_pat
-00008250: 6827 2c20 2073 656c 662e 6461 7461 7365  h',  self.datase
-00008260: 742e 685f 7061 7261 6d73 5b27 7361 7665  t.h_params['save
-00008270: 5f70 6174 6827 5d29 0d0a 2020 2020 2020  _path'])..      
-00008280: 2020 7375 7065 7228 4c46 434e 4e2c 2073    super(LFCNN, s
-00008290: 656c 6629 2e5f 5f69 6e69 745f 5f28 6d65  elf).__init__(me
-000082a0: 7461 2c20 6461 7461 7365 7429 0d0a 0d0a  ta, dataset)....
-000082b0: 0d0a 0d0a 2020 2020 6465 6620 6275 696c  ....    def buil
-000082c0: 645f 6772 6170 6828 7365 6c66 293a 0d0a  d_graph(self):..
-000082d0: 2020 2020 2020 2020 2222 2242 7569 6c64          """Build
-000082e0: 2063 6f6d 7075 7461 7469 6f6e 616c 2067   computational g
-000082f0: 7261 7068 2075 7369 6e67 2064 6566 696e  raph using defin
-00008300: 6564 2070 6c61 6365 686f 6c64 6572 2060  ed placeholder `
-00008310: 7365 6c66 2e58 600d 0a20 2020 2020 2020  self.X`..       
-00008320: 2061 7320 696e 7075 742e 0d0a 0d0a 2020   as input.....  
-00008330: 2020 2020 2020 5265 7475 726e 730d 0a20        Returns.. 
-00008340: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0d         --------.
-00008350: 0a20 2020 2020 2020 2079 5f70 7265 6420  .        y_pred 
-00008360: 3a20 7466 2e54 656e 736f 720d 0a20 2020  : tf.Tensor..   
-00008370: 2020 2020 2020 2020 204f 7574 7075 7420           Output 
-00008380: 6f66 2074 6865 2066 6f72 7761 7264 2070  of the forward p
-00008390: 6173 7320 6f66 2074 6865 2063 6f6d 7075  ass of the compu
-000083a0: 7461 7469 6f6e 616c 2067 7261 7068 2e0d  tational graph..
-000083b0: 0a20 2020 2020 2020 2020 2020 2050 7265  .            Pre
-000083c0: 6469 6374 696f 6e20 6f66 2074 6865 2074  diction of the t
-000083d0: 6172 6765 7420 7661 7269 6162 6c65 2e0d  arget variable..
-000083e0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-000083f0: 2020 2020 2020 7365 6c66 2e64 6d78 203d        self.dmx =
-00008400: 2044 654d 6978 696e 6728 7369 7a65 3d73   DeMixing(size=s
-00008410: 656c 662e 7370 6563 735b 276e 5f6c 6174  elf.specs['n_lat
-00008420: 656e 7427 5d2c 206e 6f6e 6c69 6e3d 7466  ent'], nonlin=tf
-00008430: 2e69 6465 6e74 6974 792c 0d0a 2020 2020  .identity,..    
-00008440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008450: 2020 2020 2020 2020 6178 6973 3d33 2c20          axis=3, 
-00008460: 7370 6563 733d 7365 6c66 2e73 7065 6373  specs=self.specs
-00008470: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00008480: 646d 785f 6f75 7420 3d20 7365 6c66 2e64  dmx_out = self.d
-00008490: 6d78 2873 656c 662e 696e 7075 7473 290d  mx(self.inputs).
-000084a0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-000084b0: 7463 6f6e 7620 3d20 4c46 5443 6f6e 7628  tconv = LFTConv(
-000084c0: 7369 7a65 3d73 656c 662e 7370 6563 735b  size=self.specs[
-000084d0: 276e 5f6c 6174 656e 7427 5d2c 0d0a 2020  'n_latent'],..  
-000084e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000084f0: 2020 2020 2020 2020 2020 206e 6f6e 6c69             nonli
-00008500: 6e3d 7365 6c66 2e73 7065 6373 5b27 6e6f  n=self.specs['no
-00008510: 6e6c 696e 275d 2c0d 0a20 2020 2020 2020  nlin'],..       
-00008520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008530: 2020 2020 2020 6669 6c74 6572 5f6c 656e        filter_len
-00008540: 6774 683d 7365 6c66 2e73 7065 6373 5b27  gth=self.specs['
-00008550: 6669 6c74 6572 5f6c 656e 6774 6827 5d2c  filter_length'],
-00008560: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008570: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00008580: 6164 6469 6e67 3d73 656c 662e 7370 6563  adding=self.spec
-00008590: 735b 2770 6164 6469 6e67 275d 2c0d 0a20  s['padding'],.. 
-000085a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000085b0: 2020 2020 2020 2020 2020 2020 7370 6563              spec
-000085c0: 733d 7365 6c66 2e73 7065 6373 0d0a 2020  s=self.specs..  
-000085d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000085e0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-000085f0: 2020 2020 2020 7365 6c66 2e74 636f 6e76        self.tconv
-00008600: 5f6f 7574 203d 2073 656c 662e 7463 6f6e  _out = self.tcon
-00008610: 7628 7365 6c66 2e64 6d78 5f6f 7574 290d  v(self.dmx_out).
-00008620: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00008630: 706f 6f6c 203d 2054 656d 7050 6f6f 6c69  pool = TempPooli
-00008640: 6e67 2870 6f6f 6c69 6e67 3d73 656c 662e  ng(pooling=self.
-00008650: 7370 6563 735b 2770 6f6f 6c69 6e67 275d  specs['pooling']
-00008660: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00008670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008680: 2020 2020 2070 6f6f 6c5f 7479 7065 3d73       pool_type=s
-00008690: 656c 662e 7370 6563 735b 2770 6f6f 6c5f  elf.specs['pool_
-000086a0: 7479 7065 275d 2c0d 0a20 2020 2020 2020  type'],..       
+000044a0: 2020 2020 2020 2020 2074 6573 745f 6261           test_ba
+000044b0: 7463 683d 4e6f 6e65 2c0d 0a20 2020 2020  tch=None,..     
+000044c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000044d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000044e0: 2020 2020 2020 2020 2020 2020 2020 7370                sp
+000044f0: 6c69 743d 4661 6c73 6529 0d0a 0d0a 2020  lit=False)....  
+00004500: 2020 2020 2020 2020 2020 2020 2020 765f                v_
+00004510: 6c6f 7373 2c20 765f 6d65 7472 6963 203d  loss, v_metric =
+00004520: 2073 656c 662e 6576 616c 7561 7465 2876   self.evaluate(v
+00004530: 616c 290d 0a20 2020 2020 2020 2020 2020  al)..           
+00004540: 2020 2020 2074 5f6c 6f73 732c 2074 5f6d       t_loss, t_m
+00004550: 6574 7269 6320 3d20 7365 6c66 2e65 7661  etric = self.eva
+00004560: 6c75 6174 6528 7465 7374 290d 0a0d 0a20  luate(test).... 
+00004570: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00004580: 7269 6e74 2822 5375 626a 3a20 7b7d 204c  rint("Subj: {} L
+00004590: 6f73 733a 207b 3a2e 3466 7d2c 204d 6574  oss: {:.4f}, Met
+000045a0: 7269 633a 207b 3a2e 3466 7d22 2e66 6f72  ric: {:.4f}".for
+000045b0: 6d61 7428 6a6a 2c20 745f 6c6f 7373 2c20  mat(jj, t_loss, 
+000045c0: 745f 6d65 7472 6963 2929 0d0a 2020 2020  t_metric))..    
+000045d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000045e0: 2e63 765f 6c6f 7373 6573 2e61 7070 656e  .cv_losses.appen
+000045f0: 6428 765f 6c6f 7373 290d 0a20 2020 2020  d(v_loss)..     
+00004600: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00004610: 6376 5f6d 6574 7269 6373 2e61 7070 656e  cv_metrics.appen
+00004620: 6428 765f 6d65 7472 6963 290d 0a20 2020  d(v_metric)..   
+00004630: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00004640: 662e 6376 5f74 6573 745f 6c6f 7373 6573  f.cv_test_losses
+00004650: 2e61 7070 656e 6428 745f 6c6f 7373 290d  .append(t_loss).
+00004660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004670: 2073 656c 662e 6376 5f74 6573 745f 6d65   self.cv_test_me
+00004680: 7472 6963 732e 6170 7065 6e64 2874 5f6d  trics.append(t_m
+00004690: 6574 7269 6329 0d0a 0d0a 2020 2020 2020  etric)....      
+000046a0: 2020 2020 2020 2020 2020 795f 7472 7565            y_true
+000046b0: 2c20 795f 7072 6564 203d 2073 656c 662e  , y_pred = self.
+000046c0: 7072 6564 6963 7428 7661 6c29 0d0a 2020  predict(val)..  
+000046d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000046e0: 2073 656c 662e 6461 7461 7365 742e 685f   self.dataset.h_
+000046f0: 7061 7261 6d73 5b27 7461 7267 6574 5f74  params['target_t
+00004700: 7970 6527 5d20 3d3d 2027 666c 6f61 7427  ype'] == 'float'
+00004710: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00004720: 2020 2020 2020 2079 5f74 7275 652c 2079         y_true, y
+00004730: 5f70 7265 6420 3d20 7365 6c66 2e70 7265  _pred = self.pre
+00004740: 6469 6374 2876 616c 290d 0a20 2020 2020  dict(val)..     
+00004750: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00004760: 6d73 203d 2072 6567 7265 7373 696f 6e5f  ms = regression_
+00004770: 6d65 7472 6963 7328 795f 7472 7565 2c20  metrics(y_true, 
+00004780: 795f 7072 6564 290d 0a20 2020 2020 2020  y_pred)..       
+00004790: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000047a0: 206b 2c76 2069 6e20 726d 732e 6974 656d   k,v in rms.item
+000047b0: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
+000047c0: 2020 2020 2020 2020 2020 2020 2020 726d                rm
+000047d0: 7373 5b6b 5d2e 6170 7065 6e64 2876 290d  ss[k].append(v).
+000047e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000047f0: 2020 2020 2070 7269 6e74 2822 5661 6c69       print("Vali
+00004800: 6461 7469 6f6e 2073 6574 3a20 436f 7272  dation set: Corr
+00004810: 203d 222c 2072 6d73 5b27 6363 275d 2c20   =", rms['cc'], 
+00004820: 2220 5232 203d 222c 2072 6d73 5b27 7232  " R2 =", rms['r2
+00004830: 275d 290d 0a20 2020 2020 2020 2020 2020  '])..           
+00004840: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00004850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004860: 7365 6c66 2e63 6d20 2b3d 2073 656c 662e  self.cm += self.
+00004870: 5f63 6f6e 6675 7369 6f6e 5f6d 6174 7269  _confusion_matri
+00004880: 7828 795f 7472 7565 2c20 795f 7072 6564  x(y_true, y_pred
+00004890: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000048a0: 2020 2020 2020 2072 6d73 203d 204e 6f6e         rms = Non
+000048b0: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
+000048c0: 2020 2020 2069 6620 636f 6c6c 6563 745f       if collect_
+000048d0: 7061 7474 6572 6e73 2061 6e64 2073 656c  patterns and sel
+000048e0: 662e 7363 6f70 6520 3d3d 2027 6c66 636e  f.scope == 'lfcn
+000048f0: 6e27 3a0d 0a20 2020 2020 2020 2020 2020  n':..           
+00004900: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+00004910: 6c6c 6563 745f 7061 7474 6572 6e73 2866  llect_patterns(f
+00004920: 6f6c 643d 6a6a 2c20 6e5f 666f 6c64 733d  old=jj, n_folds=
+00004930: 6e5f 666f 6c64 732c 0d0a 2020 2020 2020  n_folds,..      
+00004940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004960: 2020 2020 6e5f 636f 6d70 3d69 6e74 2863      n_comp=int(c
+00004970: 6f6c 6c65 6374 5f70 6174 7465 726e 7329  ollect_patterns)
+00004980: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00004990: 2020 2020 2069 6620 6a6a 203c 206e 5f66       if jj < n_f
+000049a0: 6f6c 6473 202d 313a 0d0a 2020 2020 2020  olds -1:..      
+000049b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000049c0: 6c66 2e6b 6d2e 6c6f 6164 5f77 6569 6768  lf.km.load_weigh
+000049d0: 7473 286f 732e 7061 7468 2e6a 6f69 6e28  ts(os.path.join(
+000049e0: 7365 6c66 2e6d 6f64 656c 5f70 6174 682c  self.model_path,
+000049f0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+00004a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a20: 2020 2020 2020 2020 2073 656c 662e 6d6f           self.mo
+00004a30: 6465 6c5f 6e61 6d65 202b 2027 696e 6974  del_name + 'init
+00004a40: 2e68 3527 2929 0d0a 2020 2020 2020 2020  .h5'))..        
+00004a50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00004a60: 2e73 6875 6666 6c65 5f77 6569 6768 7473  .shuffle_weights
+00004a70: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00004a80: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00004a90: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00004aa0: 4e6f 7420 7368 7566 666c 696e 6720 7468  Not shuffling th
+00004ab0: 6520 7765 6967 6874 7320 666f 7220 7468  e weights for th
+00004ac0: 6520 6c61 7374 2066 6f6c 6422 0d0a 0d0a  e last fold"....
+00004ad0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00004ae0: 656c 662e 6461 7461 7365 742e 685f 7061  elf.dataset.h_pa
+00004af0: 7261 6d73 5b27 7461 7267 6574 5f74 7970  rams['target_typ
+00004b00: 6527 5d20 3d3d 2027 666c 6f61 7427 3a0d  e'] == 'float':.
+00004b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004b20: 2072 6d73 203d 207b 6b3a 6e70 2e6d 6561   rms = {k:np.mea
+00004b30: 6e28 7629 2066 6f72 206b 2c20 7620 696e  n(v) for k, v in
+00004b40: 2072 6d73 732e 6974 656d 7328 297d 0d0a   rmss.items()}..
+00004b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b60: 726d 732e 7570 6461 7465 287b 6b20 2b20  rms.update({k + 
+00004b70: 275f 7374 6427 3a6e 702e 7374 6428 7629  '_std':np.std(v)
+00004b80: 2066 6f72 206b 2c20 7620 696e 2072 6d73   for k, v in rms
+00004b90: 732e 6974 656d 7328 297d 290d 0a20 2020  s.items()})..   
+00004ba0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00004bb0: 6e74 2822 5661 6c69 6461 7469 6f6e 2073  nt("Validation s
+00004bc0: 6574 3a20 436f 7272 203a 207b 3a2e 3366  et: Corr : {:.3f
+00004bd0: 7d20 2b2f 2d20 7b3a 2e33 667d 2e20 5c0d  } +/- {:.3f}. \.
+00004be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004bf0: 2020 2020 2020 2052 5e32 3a20 7b3a 2e33         R^2: {:.3
+00004c00: 667d 202b 2f2d 207b 3a2e 3366 7d22 2e66  f} +/- {:.3f}".f
+00004c10: 6f72 6d61 7428 0d0a 2020 2020 2020 2020  ormat(..        
+00004c20: 2020 2020 2020 2020 2020 2020 2020 726d                rm
+00004c30: 735b 2763 6327 5d2c 2072 6d73 5b27 6363  s['cc'], rms['cc
+00004c40: 5f73 7464 275d 2c20 726d 735b 2772 3227  _std'], rms['r2'
+00004c50: 5d2c 2072 6d73 5b27 7232 5f73 7464 275d  ], rms['r2_std']
+00004c60: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00004c70: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00004c80: 2020 2020 2020 2072 6d73 203d 204e 6f6e         rms = Non
+00004c90: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
+00004ca0: 2023 7365 6c66 2e75 7064 6174 655f 6c6f   #self.update_lo
+00004cb0: 6728 726d 732c 2070 7265 6669 783d 276c  g(rms, prefix='l
+00004cc0: 6f73 6f5f 2729 0d0a 0d0a 2020 2020 2020  oso_')....      
+00004cd0: 2020 7072 696e 7428 2222 227b 7d20 7769    print("""{} wi
+00004ce0: 7468 207b 7d20 666f 6c64 2873 2920 636f  th {} fold(s) co
+00004cf0: 6d70 6c65 7465 642e 205c 6e0d 0a20 2020  mpleted. \n..   
+00004d00: 2020 2020 2020 2020 2020 2056 616c 6964             Valid
+00004d10: 6174 696f 6e20 5065 7266 6f72 6d61 6e63  ation Performanc
+00004d20: 653a 200d 0a20 2020 2020 2020 2020 2020  e: ..           
+00004d30: 2020 204c 6f73 733a 207b 3a2e 3466 7d20     Loss: {:.4f} 
+00004d40: 2b2f 2d20 7b3a 2e34 667d 2e0d 0a20 2020  +/- {:.4f}...   
+00004d50: 2020 2020 2020 2020 2020 204d 6574 7269             Metri
+00004d60: 633a 207b 3a2e 3466 7d20 2b2f 2d20 7b3a  c: {:.4f} +/- {:
+00004d70: 2e34 667d 2222 220d 0a20 2020 2020 2020  .4f}"""..       
+00004d80: 2020 2020 2020 202e 666f 726d 6174 286d         .format(m
+00004d90: 6f64 652c 206e 5f66 6f6c 6473 2c0d 0a20  ode, n_folds,.. 
+00004da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004db0: 2020 2020 206e 702e 6d65 616e 2873 656c       np.mean(sel
+00004dc0: 662e 6376 5f6c 6f73 7365 7329 2c20 6e70  f.cv_losses), np
+00004dd0: 2e73 7464 2873 656c 662e 6376 5f6c 6f73  .std(self.cv_los
+00004de0: 7365 7329 2c0d 0a20 2020 2020 2020 2020  ses),..         
+00004df0: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+00004e00: 6d65 616e 2873 656c 662e 6376 5f6d 6574  mean(self.cv_met
+00004e10: 7269 6373 292c 206e 702e 7374 6428 7365  rics), np.std(se
+00004e20: 6c66 2e63 765f 6d65 7472 6963 7329 2929  lf.cv_metrics)))
+00004e30: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00004e40: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
+00004e50: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
+00004e60: 5b27 7465 7374 5f70 6174 6873 275d 2920  ['test_paths']) 
+00004e70: 3e20 303a 0d0a 2020 2020 2020 2020 2020  > 0:..          
+00004e80: 2020 7072 696e 7428 2222 225c 6e0d 0a20    print("""\n.. 
+00004e90: 2020 2020 2020 2020 2020 2020 2054 6573               Tes
+00004ea0: 7420 5065 7266 6f72 6d61 6e63 653a 200d  t Performance: .
+00004eb0: 0a20 2020 2020 2020 2020 2020 2020 204c  .              L
+00004ec0: 6f73 733a 207b 3a2e 3466 7d20 2b2f 2d20  oss: {:.4f} +/- 
+00004ed0: 7b3a 2e34 667d 2e0d 0a20 2020 2020 2020  {:.4f}...       
+00004ee0: 2020 2020 2020 204d 6574 7269 633a 207b         Metric: {
+00004ef0: 3a2e 3466 7d20 2b2f 2d20 7b3a 2e34 667d  :.4f} +/- {:.4f}
+00004f00: 2222 220d 0a20 2020 2020 2020 2020 2020  """..           
+00004f10: 2020 202e 666f 726d 6174 286e 702e 6d65     .format(np.me
+00004f20: 616e 2873 656c 662e 6376 5f74 6573 745f  an(self.cv_test_
+00004f30: 6c6f 7373 6573 292c 200d 0a20 2020 2020  losses), ..     
+00004f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004f50: 206e 702e 7374 6428 7365 6c66 2e63 765f   np.std(self.cv_
+00004f60: 7465 7374 5f6c 6f73 7365 7329 2c0d 0a20  test_losses),.. 
+00004f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004f80: 2020 2020 206e 702e 6d65 616e 2873 656c       np.mean(sel
+00004f90: 662e 6376 5f74 6573 745f 6d65 7472 6963  f.cv_test_metric
+00004fa0: 7329 2c20 0d0a 2020 2020 2020 2020 2020  s), ..          
+00004fb0: 2020 2020 2020 2020 2020 2020 6e70 2e73              np.s
+00004fc0: 7464 2873 656c 662e 6376 5f74 6573 745f  td(self.cv_test_
+00004fd0: 6d65 7472 6963 7329 2929 0d0a 2020 2020  metrics)))..    
+00004fe0: 2020 2020 0d0a 2020 2020 2020 2020 7365      ..        se
+00004ff0: 6c66 2e6d 6574 612e 7472 6169 6e5f 7061  lf.meta.train_pa
+00005000: 7261 6d73 2e75 7064 6174 6528 7b22 7472  rams.update({"tr
+00005010: 6169 6e65 6422 3a54 7275 657d 290d 0a20  ained":True}).. 
+00005020: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
+00005030: 7465 5f6c 6f67 2872 6d73 3d72 6d73 2c20  te_log(rms=rms, 
+00005040: 7072 6566 6978 3d6d 6f64 6529 2020 2020  prefix=mode)    
+00005050: 0d0a 2020 2020 2020 2020 2372 6574 7572  ..        #retur
+00005060: 6e20 7365 6c66 2e63 765f 6c6f 7373 6573  n self.cv_losses
+00005070: 2c20 7365 6c66 2e63 765f 6d65 7472 6963  , self.cv_metric
+00005080: 730d 0a0d 0a0d 0a20 2020 2064 6566 2070  s......    def p
+00005090: 7275 6e65 5f77 6569 6768 7473 2873 656c  rune_weights(sel
+000050a0: 662c 2069 6e63 7265 6173 655f 7265 6775  f, increase_regu
+000050b0: 6c61 7269 7a61 7469 6f6e 3d33 2e29 3a0d  larization=3.):.
+000050c0: 0a20 2020 2020 2020 2073 746f 705f 6561  .        stop_ea
+000050d0: 726c 7920 3d20 7466 2e6b 6572 6173 2e63  rly = tf.keras.c
+000050e0: 616c 6c62 6163 6b73 2e45 6172 6c79 5374  allbacks.EarlySt
+000050f0: 6f70 7069 6e67 286d 6f6e 6974 6f72 3d27  opping(monitor='
+00005100: 7661 6c5f 6c6f 7373 272c 0d0a 2020 2020  val_loss',..    
+00005110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005140: 2020 6d69 6e5f 6465 6c74 613d 3165 2d36    min_delta=1e-6
+00005150: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00005160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005180: 2020 2020 2020 2020 2070 6174 6965 6e63           patienc
+00005190: 653d 3130 2c0d 0a20 2020 2020 2020 2020  e=10,..         
+000051a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000051b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000051c0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+000051d0: 746f 7265 5f62 6573 745f 7765 6967 6874  tore_best_weight
+000051e0: 733d 5472 7565 290d 0a20 2020 2020 2020  s=True)..       
+000051f0: 2073 656c 662e 7261 7465 203d 2030 0d0a   self.rate = 0..
+00005200: 2020 2020 2020 2020 7365 6c66 2e73 7065          self.spe
+00005210: 6373 5b22 6c31 5f6c 616d 6264 6122 5d20  cs["l1_lambda"] 
+00005220: 2a3d 2069 6e63 7265 6173 655f 7265 6775  *= increase_regu
+00005230: 6c61 7269 7a61 7469 6f6e 0d0a 2020 2020  larization..    
+00005240: 2020 2020 7365 6c66 2e73 7065 6373 5b22      self.specs["
+00005250: 6c32 5f6c 616d 6264 6122 5d20 2a3d 2069  l2_lambda"] *= i
+00005260: 6e63 7265 6173 655f 7265 6775 6c61 7269  ncrease_regulari
+00005270: 7a61 7469 6f6e 0d0a 2020 2020 2020 2020  zation..        
+00005280: 7072 696e 7428 2750 7275 6e69 6e67 2077  print('Pruning w
+00005290: 6569 6768 7473 2729 0d0a 2020 2020 2020  eights')..      
+000052a0: 2020 7365 6c66 2e74 5f68 6973 745f 7020    self.t_hist_p 
+000052b0: 3d20 7365 6c66 2e6b 6d2e 6669 7428 7365  = self.km.fit(se
+000052c0: 6c66 2e64 6174 6173 6574 2e74 7261 696e  lf.dataset.train
+000052d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000052e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000052f0: 2020 7661 6c69 6461 7469 6f6e 5f64 6174    validation_dat
+00005300: 613d 7365 6c66 2e64 6174 6173 6574 2e76  a=self.dataset.v
+00005310: 616c 2c0d 0a20 2020 2020 2020 2020 2020  al,..           
+00005320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005330: 2020 2020 6570 6f63 6873 3d33 302c 2073      epochs=30, s
+00005340: 7465 7073 5f70 6572 5f65 706f 6368 3d73  teps_per_epoch=s
+00005350: 656c 662e 6d65 7461 2e74 7261 696e 5f70  elf.meta.train_p
+00005360: 6172 616d 735b 2765 7661 6c5f 7374 6570  arams['eval_step
+00005370: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
+00005380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005390: 2020 2020 7368 7566 666c 653d 5472 7565      shuffle=True
+000053a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000053b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000053c0: 2020 7661 6c69 6461 7469 6f6e 5f73 7465    validation_ste
+000053d0: 7073 3d73 656c 662e 6461 7461 7365 742e  ps=self.dataset.
+000053e0: 7661 6c69 6461 7469 6f6e 5f73 7465 7073  validation_steps
+000053f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00005400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005410: 2020 6361 6c6c 6261 636b 733d 5b73 746f    callbacks=[sto
+00005420: 705f 6561 726c 795d 2c20 7665 7262 6f73  p_early], verbos
+00005430: 653d 3229 0d0a 0d0a 2020 2020 6465 6620  e=2)....    def 
+00005440: 7368 7566 666c 655f 7765 6967 6874 7328  shuffle_weights(
+00005450: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00005460: 7072 696e 7428 2252 652d 7368 7566 666c  print("Re-shuffl
+00005470: 696e 6720 7765 6967 6874 7320 6265 7477  ing weights betw
+00005480: 6565 6e20 666f 6c64 7322 290d 0a20 2020  een folds")..   
+00005490: 2020 2020 2077 6569 6768 7473 203d 2073       weights = s
+000054a0: 656c 662e 6b6d 2e67 6574 5f77 6569 6768  elf.km.get_weigh
+000054b0: 7473 2829 0d0a 2020 2020 2020 2020 7765  ts()..        we
+000054c0: 6967 6874 7320 3d20 5b6e 702e 7261 6e64  ights = [np.rand
+000054d0: 6f6d 2e70 6572 6d75 7461 7469 6f6e 2877  om.permutation(w
+000054e0: 2e66 6c61 7429 2e72 6573 6861 7065 2877  .flat).reshape(w
+000054f0: 2e73 6861 7065 2920 666f 7220 7720 696e  .shape) for w in
+00005500: 2077 6569 6768 7473 5d0d 0a20 2020 2020   weights]..     
+00005510: 2020 2073 656c 662e 6b6d 2e73 6574 5f77     self.km.set_w
+00005520: 6569 6768 7473 2877 6569 6768 7473 290d  eights(weights).
+00005530: 0a0d 0a0d 0a20 2020 2023 2064 6566 2072  .....    # def r
+00005540: 6569 6e69 7469 616c 697a 655f 7765 6967  einitialize_weig
+00005550: 6874 7328 7365 6c66 293a 0d0a 2020 2020  hts(self):..    
+00005560: 2320 2020 2020 7365 7373 696f 6e20 3d20  #     session = 
+00005570: 4b2e 6765 745f 7365 7373 696f 6e28 290d  K.get_session().
+00005580: 0a20 2020 2023 2020 2020 2070 7269 6e74  .    #     print
+00005590: 2822 5265 2d69 6e69 7469 616c 697a 696e  ("Re-initializin
+000055a0: 6720 7765 6967 6874 7322 290d 0a20 2020  g weights")..   
+000055b0: 2023 2020 2020 2066 6f72 206c 6179 6572   #     for layer
+000055c0: 2069 6e20 7365 6c66 2e6b 6d2e 6c61 7965   in self.km.laye
+000055d0: 7273 3a20 0d0a 2020 2020 2320 2020 2020  rs: ..    #     
+000055e0: 2020 2020 6966 2068 6173 6174 7472 286c      if hasattr(l
+000055f0: 6179 6572 2c20 276b 6572 6e65 6c5f 696e  ayer, 'kernel_in
+00005600: 6974 6961 6c69 7a65 7227 293a 0d0a 2020  itializer'):..  
+00005610: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00005620: 6c61 7965 722e 6b65 726e 656c 2e69 6e69  layer.kernel.ini
+00005630: 7469 616c 697a 6572 2e72 756e 2873 6573  tializer.run(ses
+00005640: 7369 6f6e 3d73 6573 7369 6f6e 290d 0a20  sion=session).. 
+00005650: 2020 2023 2020 2020 2020 2020 2069 6620     #         if 
+00005660: 6861 7361 7474 7228 6c61 7965 722c 2027  hasattr(layer, '
+00005670: 6269 6173 5f69 6e69 7469 616c 697a 6572  bias_initializer
+00005680: 2729 3a0d 0a20 2020 2023 2020 2020 2020  '):..    #      
+00005690: 2020 2020 2020 206c 6179 6572 2e62 6961         layer.bia
+000056a0: 732e 696e 6974 6961 6c69 7a65 722e 7275  s.initializer.ru
+000056b0: 6e28 7365 7373 696f 6e3d 7365 7373 696f  n(session=sessio
+000056c0: 6e29 0d0a 2020 2020 2020 2020 2020 2020  n)..            
+000056d0: 2020 2020 0d0a 0d0a 2020 2020 6465 6620      ....    def 
+000056e0: 706c 6f74 5f68 6973 7428 7365 6c66 293a  plot_hist(self):
+000056f0: 0d0a 2020 2020 2020 2020 2222 2250 6c6f  ..        """Plo
+00005700: 7420 6c6f 7373 2068 6973 746f 7279 2064  t loss history d
+00005710: 7572 696e 6720 7472 6169 6e69 6e67 2e22  uring training."
+00005720: 2222 0d0a 2020 2020 2020 2020 706c 742e  ""..        plt.
+00005730: 706c 6f74 2873 656c 662e 745f 6869 7374  plot(self.t_hist
+00005740: 2e68 6973 746f 7279 5b27 6c6f 7373 275d  .history['loss']
+00005750: 290d 0a20 2020 2020 2020 2070 6c74 2e70  )..        plt.p
+00005760: 6c6f 7428 7365 6c66 2e74 5f68 6973 742e  lot(self.t_hist.
+00005770: 6869 7374 6f72 795b 2776 616c 5f6c 6f73  history['val_los
+00005780: 7327 5d29 0d0a 2020 2020 2020 2020 706c  s'])..        pl
+00005790: 742e 7469 746c 6528 276d 6f64 656c 206c  t.title('model l
+000057a0: 6f73 7327 290d 0a20 2020 2020 2020 2070  oss')..        p
+000057b0: 6c74 2e79 6c61 6265 6c28 276c 6f73 7327  lt.ylabel('loss'
+000057c0: 290d 0a20 2020 2020 2020 2070 6c74 2e78  )..        plt.x
+000057d0: 6c61 6265 6c28 2765 706f 6368 2729 0d0a  label('epoch')..
+000057e0: 2020 2020 2020 2020 706c 742e 6c65 6765          plt.lege
+000057f0: 6e64 285b 2774 7261 696e 272c 2027 7661  nd(['train', 'va
+00005800: 6c69 6461 7469 6f6e 275d 2c20 6c6f 633d  lidation'], loc=
+00005810: 2775 7070 6572 206c 6566 7427 290d 0a20  'upper left').. 
+00005820: 2020 2020 2020 2070 6c74 2e73 686f 7728         plt.show(
+00005830: 290d 0a0d 0a20 2020 2064 6566 205f 636f  )....    def _co
+00005840: 6e66 7573 696f 6e5f 6d61 7472 6978 2873  nfusion_matrix(s
+00005850: 656c 662c 2079 5f74 7275 652c 2079 5f70  elf, y_true, y_p
+00005860: 7265 6429 3a0d 0a20 2020 2020 2020 2022  red):..        "
+00005870: 2222 436f 6d70 7574 6520 756e 6e6f 726d  ""Compute unnorm
+00005880: 616c 697a 6577 6420 636f 6e66 7573 696f  alizewd confusio
+00005890: 6e20 6d61 7472 6978 2222 220d 0a20 2020  n matrix"""..   
+000058a0: 2020 2020 2079 5f70 203d 205f 6f6e 6568       y_p = _oneh
+000058b0: 6f74 286e 702e 6172 676d 6178 2879 5f70  ot(np.argmax(y_p
+000058c0: 7265 642c 3129 2c20 6e5f 636c 6173 7365  red,1), n_classe
+000058d0: 733d 7365 6c66 2e79 5f73 6861 7065 5b2d  s=self.y_shape[-
+000058e0: 315d 290d 0a20 2020 2020 2020 2063 6d20  1])..        cm 
+000058f0: 3d20 6e70 2e64 6f74 2879 5f70 2e54 2c20  = np.dot(y_p.T, 
+00005900: 795f 7472 7565 290d 0a20 2020 2020 2020  y_true)..       
+00005910: 2072 6574 7572 6e20 636d 0d0a 2020 2020   return cm..    
+00005920: 0d0a 2020 2020 6465 6620 7570 6461 7465  ..    def update
+00005930: 5f72 6573 756c 7473 2873 656c 6629 3a0d  _results(self):.
+00005940: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
+00005950: 203d 2064 6963 7428 290d 0a20 2020 2020   = dict()..     
+00005960: 2020 2072 6573 756c 7473 5b27 765f 6d65     results['v_me
+00005970: 7472 6963 275d 203d 206e 702e 6d65 616e  tric'] = np.mean
+00005980: 2873 656c 662e 6376 5f6d 6574 7269 6373  (self.cv_metrics
+00005990: 290d 0a20 2020 2020 2020 2072 6573 756c  )..        resul
+000059a0: 7473 5b27 765f 6c6f 7373 275d 203d 206e  ts['v_loss'] = n
+000059b0: 702e 6d65 616e 2873 656c 662e 6376 5f6c  p.mean(self.cv_l
+000059c0: 6f73 7365 7329 0d0a 2020 2020 2020 2020  osses)..        
+000059d0: 7265 7375 6c74 735b 2763 765f 6d65 7472  results['cv_metr
+000059e0: 6963 7327 5d20 3d20 7365 6c66 2e63 765f  ics'] = self.cv_
+000059f0: 6d65 7472 6963 730d 0a20 2020 2020 2020  metrics..       
+00005a00: 2072 6573 756c 7473 5b27 6376 5f6c 6f73   results['cv_los
+00005a10: 7365 7327 5d20 3d20 7365 6c66 2e63 765f  ses'] = self.cv_
+00005a20: 6c6f 7373 6573 0d0a 2020 2020 2020 2020  losses..        
+00005a30: 0d0a 2020 2020 2020 2020 7472 5f6c 6f73  ..        tr_los
+00005a40: 732c 2074 725f 6d65 7472 6963 203d 2073  s, tr_metric = s
+00005a50: 656c 662e 6576 616c 7561 7465 2873 656c  elf.evaluate(sel
+00005a60: 662e 6461 7461 7365 742e 7472 6169 6e29  f.dataset.train)
+00005a70: 0d0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
+00005a80: 735b 2774 725f 6d65 7472 6963 275d 203d  s['tr_metric'] =
+00005a90: 2074 725f 6d65 7472 6963 0d0a 2020 2020   tr_metric..    
+00005aa0: 2020 2020 7265 7375 6c74 735b 2774 725f      results['tr_
+00005ab0: 6c6f 7373 275d 203d 2074 725f 6c6f 7373  loss'] = tr_loss
+00005ac0: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6966  ......        if
+00005ad0: 206c 656e 2873 656c 662e 6461 7461 7365   len(self.datase
+00005ae0: 742e 685f 7061 7261 6d73 5b27 7465 7374  t.h_params['test
+00005af0: 5f70 6174 6873 275d 2920 3e20 303a 0d0a  _paths']) > 0:..
+00005b00: 2020 2020 2020 2020 2020 2020 745f 6c6f              t_lo
+00005b10: 7373 203d 206e 702e 6d65 616e 2873 656c  ss = np.mean(sel
+00005b20: 662e 6376 5f74 6573 745f 6c6f 7373 6573  f.cv_test_losses
+00005b30: 290d 0a20 2020 2020 2020 2020 2020 2074  )..            t
+00005b40: 5f6d 6574 7269 6320 3d20 6e70 2e6d 6561  _metric = np.mea
+00005b50: 6e28 7365 6c66 2e63 765f 7465 7374 5f6d  n(self.cv_test_m
+00005b60: 6574 7269 6373 290d 0a20 2020 2020 2020  etrics)..       
+00005b70: 2020 2020 2069 6620 7365 6c66 2e64 6174       if self.dat
+00005b80: 6173 6574 2e68 5f70 6172 616d 735b 2774  aset.h_params['t
+00005b90: 6172 6765 745f 7479 7065 275d 203d 3d20  arget_type'] == 
+00005ba0: 2766 6c6f 6174 273a 0d0a 2020 2020 2020  'float':..      
+00005bb0: 2020 2020 2020 2020 2020 795f 7472 7565            y_true
+00005bc0: 2c20 795f 7072 6564 203d 2073 656c 662e  , y_pred = self.
+00005bd0: 7072 6564 6963 7428 7365 6c66 2e64 6174  predict(self.dat
+00005be0: 6173 6574 2e68 5f70 6172 616d 735b 2774  aset.h_params['t
+00005bf0: 6573 745f 7061 7468 7327 5d29 0d0a 2020  est_paths'])..  
+00005c00: 2020 2020 2020 2020 2020 2020 2020 726d                rm
+00005c10: 735f 7465 7374 203d 2072 6567 7265 7373  s_test = regress
+00005c20: 696f 6e5f 6d65 7472 6963 7328 795f 7472  ion_metrics(y_tr
+00005c30: 7565 2c20 795f 7072 6564 290d 0a20 2020  ue, y_pred)..   
+00005c40: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00005c50: 6e74 2822 5465 7374 2073 6574 3a20 436f  nt("Test set: Co
+00005c60: 7272 203d 222c 2072 6d73 5f74 6573 745b  rr =", rms_test[
+00005c70: 2763 6327 5d2c 2022 5232 203d 222c 2072  'cc'], "R2 =", r
+00005c80: 6d73 5f74 6573 745b 2772 3227 5d29 0d0a  ms_test['r2'])..
+00005c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ca0: 7265 7375 6c74 732e 7570 6461 7465 287b  results.update({
+00005cb0: 2774 6573 745f 272b 6b3a 7620 666f 7220  'test_'+k:v for 
+00005cc0: 6b2c 7620 696e 2072 6d73 5f74 6573 742e  k,v in rms_test.
+00005cd0: 6974 656d 7328 297d 290d 0a20 2020 2020  items()})..     
+00005ce0: 2020 2020 2020 2072 6573 756c 7473 5b27         results['
+00005cf0: 7465 7374 5f6d 6574 7269 6327 5d20 3d20  test_metric'] = 
+00005d00: 745f 6d65 7472 6963 0d0a 2020 2020 2020  t_metric..      
+00005d10: 2020 2020 2020 7265 7375 6c74 735b 2774        results['t
+00005d20: 6573 745f 6c6f 7373 275d 203d 2074 5f6c  est_loss'] = t_l
+00005d30: 6f73 730d 0a20 2020 2020 2020 2020 2020  oss..           
+00005d40: 2072 6573 756c 7473 5b27 7465 7374 5f6d   results['test_m
+00005d50: 6574 7269 6373 275d 203d 2073 656c 662e  etrics'] = self.
+00005d60: 6376 5f74 6573 745f 6d65 7472 6963 730d  cv_test_metrics.
+00005d70: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00005d80: 756c 7473 5b27 7465 7374 5f6c 6f73 7365  ults['test_losse
+00005d90: 7327 5d20 3d20 7365 6c66 2e63 765f 7465  s'] = self.cv_te
+00005da0: 7374 5f6c 6f73 7365 730d 0a0d 0a20 2020  st_losses....   
+00005db0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00005dc0: 2020 2020 2020 2020 7265 7375 6c74 735b          results[
+00005dd0: 2774 6573 745f 6d65 7472 6963 275d 203d  'test_metric'] =
+00005de0: 2022 4e41 220d 0a20 2020 2020 2020 2020   "NA"..         
+00005df0: 2020 2072 6573 756c 7473 5b27 7465 7374     results['test
+00005e00: 5f6c 6f73 7327 5d20 3d20 224e 4122 0d0a  _loss'] = "NA"..
+00005e10: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00005e20: 6c74 735b 2774 6573 745f 6d65 7472 6963  lts['test_metric
+00005e30: 7327 5d20 3d20 224e 4122 0d0a 2020 2020  s'] = "NA"..    
+00005e40: 2020 2020 2020 2020 7265 7375 6c74 735b          results[
+00005e50: 2774 6573 745f 6c6f 7373 6573 275d 203d  'test_losses'] =
+00005e60: 2022 4e41 220d 0a20 2020 2020 2020 200d   "NA"..        .
+00005e70: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
+00005e80: 5b27 636d 275d 203d 2073 656c 662e 636d  ['cm'] = self.cm
+00005e90: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00005ea0: 2020 2020 7365 6c66 2e6d 6574 612e 7570      self.meta.up
+00005eb0: 6461 7465 2872 6573 756c 7473 3d72 6573  date(results=res
+00005ec0: 756c 7473 290d 0a20 2020 2020 2020 200d  ults)..        .
+00005ed0: 0a20 2020 2064 6566 2075 7064 6174 655f  .    def update_
+00005ee0: 6c6f 6728 7365 6c66 2c20 726d 733d 4e6f  log(self, rms=No
+00005ef0: 6e65 2c20 7072 6566 6978 3d27 2729 3a0d  ne, prefix=''):.
+00005f00: 0a20 2020 2020 2020 2022 2222 4c6f 6773  .        """Logs
+00005f10: 2065 7870 6572 696d 656e 7420 746f 2073   experiment to s
+00005f20: 656c 662e 6d6f 6465 6c5f 7061 7468 202b  elf.model_path +
+00005f30: 2073 656c 662e 7363 6f70 6520 2b20 275f   self.scope + '_
+00005f40: 6c6f 672e 6373 7627 2e0d 0a0d 0a20 2020  log.csv'.....   
+00005f50: 2020 2020 2049 6620 7468 6520 6669 6c65       If the file
+00005f60: 2065 7869 7374 732c 2061 7070 656e 6473   exists, appends
+00005f70: 2061 206c 696e 6520 746f 2074 6865 2065   a line to the e
+00005f80: 7869 7374 696e 6720 6669 6c65 2e0d 0a20  xisting file... 
+00005f90: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00005fa0: 2020 2020 7361 7665 7061 7468 203d 206f      savepath = o
+00005fb0: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
+00005fc0: 2e6d 6f64 656c 5f70 6174 682c 2073 656c  .model_path, sel
+00005fd0: 662e 7363 6f70 6520 2b20 275f 6c6f 672e  f.scope + '_log.
+00005fe0: 6373 7627 290d 0a20 2020 2020 2020 2061  csv')..        a
+00005ff0: 7070 656e 6469 6e67 203d 206f 732e 7061  ppending = os.pa
+00006000: 7468 2e65 7869 7374 7328 7361 7665 7061  th.exists(savepa
+00006010: 7468 290d 0a20 2020 2020 2020 2073 656c  th)..        sel
+00006020: 662e 7570 6461 7465 5f72 6573 756c 7473  f.update_results
+00006030: 2829 0d0a 0d0a 2020 2020 2020 2020 6c6f  ()....        lo
+00006040: 6720 3d20 6469 6374 2829 0d0a 2020 2020  g = dict()..    
+00006050: 2020 2020 6966 2072 6d73 3a0d 0a20 2020      if rms:..   
+00006060: 2020 2020 2020 2020 206c 6f67 2e75 7064           log.upd
+00006070: 6174 6528 7b70 7265 6669 782b 6b3a 7620  ate({prefix+k:v 
+00006080: 666f 7220 6b2c 7620 696e 2072 6d73 2e69  for k,v in rms.i
+00006090: 7465 6d73 2829 7d29 0d0a 0d0a 2020 2020  tems()})....    
+000060a0: 2020 2020 2364 6174 6173 6574 2069 6e66      #dataset inf
+000060b0: 6f0d 0a20 2020 2020 2020 2064 6174 615f  o..        data_
+000060c0: 6469 6374 203d 2073 656c 662e 6d65 7461  dict = self.meta
+000060d0: 2e64 6174 612e 636f 7079 2829 0d0a 2020  .data.copy()..  
+000060e0: 2020 2020 2020 5f20 3d20 6461 7461 5f64        _ = data_d
+000060f0: 6963 742e 706f 7028 2766 6f6c 6473 2729  ict.pop('folds')
+00006100: 0d0a 2020 2020 2020 2020 5f20 3d20 6461  ..        _ = da
+00006110: 7461 5f64 6963 742e 706f 7028 2774 6573  ta_dict.pop('tes
+00006120: 745f 666f 6c64 2729 0d0a 2020 2020 2020  t_fold')..      
+00006130: 2020 5f20 3d20 6461 7461 5f64 6963 742e    _ = data_dict.
+00006140: 706f 7028 2774 7261 696e 5f70 6174 6873  pop('train_paths
+00006150: 2729 0d0a 2020 2020 2020 2020 5f20 3d20  ')..        _ = 
+00006160: 6461 7461 5f64 6963 742e 706f 7028 2774  data_dict.pop('t
+00006170: 6573 745f 7061 7468 7327 290d 0a20 2020  est_paths')..   
+00006180: 2020 2020 206c 6f67 5b27 6461 7461 5f69       log['data_i
+00006190: 6427 5d20 3d20 6461 7461 5f64 6963 742e  d'] = data_dict.
+000061a0: 706f 7028 2764 6174 615f 6964 2729 0d0a  pop('data_id')..
+000061b0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+000061c0: 2020 2372 6573 756c 7473 2069 6e66 6f0d    #results info.
+000061d0: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
+000061e0: 5f64 6963 7420 3d20 7365 6c66 2e6d 6574  _dict = self.met
+000061f0: 612e 7265 7375 6c74 732e 636f 7079 2829  a.results.copy()
+00006200: 0d0a 2020 2020 2020 2020 6c6f 675b 2774  ..        log['t
+00006210: 7261 696e 206d 6574 7269 6327 5d20 3d20  rain metric'] = 
+00006220: 7265 7375 6c74 735f 6469 6374 2e70 6f70  results_dict.pop
+00006230: 2827 7472 5f6d 6574 7269 6327 290d 0a20  ('tr_metric').. 
+00006240: 2020 2020 2020 206c 6f67 5b27 7661 6c69         log['vali
+00006250: 6461 7469 6f6e 206d 6574 7269 6327 5d20  dation metric'] 
+00006260: 3d20 7265 7375 6c74 735f 6469 6374 2e70  = results_dict.p
+00006270: 6f70 2827 765f 6d65 7472 6963 2729 0d0a  op('v_metric')..
+00006280: 2020 2020 2020 2020 6c6f 675b 2774 6573          log['tes
+00006290: 7420 6d65 7472 6963 275d 203d 2020 7265  t metric'] =  re
+000062a0: 7375 6c74 735f 6469 6374 2e70 6f70 2827  sults_dict.pop('
+000062b0: 7465 7374 5f6d 6574 7269 6327 290d 0a20  test_metric').. 
+000062c0: 2020 2020 2020 206c 6f67 5b27 7472 6169         log['trai
+000062d0: 6e20 6c6f 7373 275d 203d 2072 6573 756c  n loss'] = resul
+000062e0: 7473 5f64 6963 742e 706f 7028 2774 725f  ts_dict.pop('tr_
+000062f0: 6c6f 7373 2729 0d0a 2020 2020 2020 2020  loss')..        
+00006300: 6c6f 675b 2776 616c 6964 6174 696f 6e20  log['validation 
+00006310: 6c6f 7373 275d 203d 2072 6573 756c 7473  loss'] = results
+00006320: 5f64 6963 742e 706f 7028 2776 5f6c 6f73  _dict.pop('v_los
+00006330: 7327 290d 0a20 2020 2020 2020 206c 6f67  s')..        log
+00006340: 5b27 7465 7374 206c 6f73 7327 5d20 3d20  ['test loss'] = 
+00006350: 2072 6573 756c 7473 5f64 6963 742e 706f   results_dict.po
+00006360: 7028 2774 6573 745f 6c6f 7373 2729 0d0a  p('test_loss')..
+00006370: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00006380: 2020 0d0a 2020 2020 2020 2020 2366 6f72    ..        #for
+00006390: 6d61 7420 7370 6563 733a 2061 7263 6869  mat specs: archi
+000063a0: 7465 6374 7572 6520 616e 6420 7265 6775  tecture and regu
+000063b0: 6c61 7269 7a61 7469 6f6e 0d0a 2020 2020  larization..    
+000063c0: 2020 2020 7370 6563 735f 6469 6374 203d      specs_dict =
+000063d0: 2073 656c 662e 6d65 7461 2e6d 6f64 656c   self.meta.model
+000063e0: 5f73 7065 6373 2e63 6f70 7928 290d 0a20  _specs.copy().. 
+000063f0: 2020 2020 2020 2073 7065 6373 5f64 6963         specs_dic
+00006400: 745b 276c 315f 7363 6f70 6527 5d20 3d20  t['l1_scope'] = 
+00006410: 272d 272e 6a6f 696e 2873 656c 662e 6d65  '-'.join(self.me
+00006420: 7461 2e6d 6f64 656c 5f73 7065 6373 5b27  ta.model_specs['
+00006430: 6c31 5f73 636f 7065 275d 290d 0a20 2020  l1_scope'])..   
+00006440: 2020 2020 2073 7065 6373 5f64 6963 745b       specs_dict[
+00006450: 276c 325f 7363 6f70 6527 5d20 3d20 272d  'l2_scope'] = '-
+00006460: 272e 6a6f 696e 2873 656c 662e 6d65 7461  '.join(self.meta
+00006470: 2e6d 6f64 656c 5f73 7065 6373 5b27 6c32  .model_specs['l2
+00006480: 5f73 636f 7065 275d 290d 0a20 2020 2020  _scope'])..     
+00006490: 2020 2073 7065 6373 5f64 6963 745b 2775     specs_dict['u
+000064a0: 6e69 746e 6f72 6d5f 7363 6f70 6527 5d20  nitnorm_scope'] 
+000064b0: 3d20 272d 272e 6a6f 696e 2873 656c 662e  = '-'.join(self.
+000064c0: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
+000064d0: 5b27 756e 6974 6e6f 726d 5f73 636f 7065  ['unitnorm_scope
+000064e0: 275d 290d 0a20 2020 2020 2020 205f 203d  '])..        _ =
+000064f0: 2073 7065 6373 5f64 6963 742e 706f 7028   specs_dict.pop(
+00006500: 276d 6f64 656c 5f70 6174 6827 290d 0a20  'model_path').. 
+00006510: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00006520: 616e 6365 2873 7065 6373 5f64 6963 745b  ance(specs_dict[
+00006530: 276e 6f6e 6c69 6e27 5d2c 2043 616c 6c61  'nonlin'], Calla
+00006540: 626c 6529 3a0d 0a20 2020 2020 2020 2020  ble):..         
+00006550: 2020 2073 7065 6373 5f64 6963 745b 276e     specs_dict['n
+00006560: 6f6e 6c69 6e27 5d20 3d20 7370 6563 735f  onlin'] = specs_
+00006570: 6469 6374 5b27 6e6f 6e6c 696e 275d 2e5f  dict['nonlin']._
+00006580: 5f6e 616d 655f 5f0d 0a20 2020 2020 2020  _name__..       
+00006590: 200d 0a20 2020 2020 2020 206c 6f67 2e75   ..        log.u
+000065a0: 7064 6174 6528 7370 6563 735f 6469 6374  pdate(specs_dict
+000065b0: 290d 0a20 2020 2020 2020 2023 7472 6169  )..        #trai
+000065c0: 6e69 6e67 2070 6172 616d 7465 7273 0d0a  ning paramters..
+000065d0: 2020 2020 2020 2020 6c6f 672e 7570 6461          log.upda
+000065e0: 7465 2873 656c 662e 6d65 7461 2e74 7261  te(self.meta.tra
+000065f0: 696e 5f70 6172 616d 7329 0d0a 2020 2020  in_params)..    
+00006600: 2020 2020 6c6f 672e 7570 6461 7465 2864      log.update(d
+00006610: 6174 615f 6469 6374 290d 0a20 2020 2020  ata_dict)..     
+00006620: 2020 206c 6f67 2e75 7064 6174 6528 7265     log.update(re
+00006630: 7375 6c74 735f 6469 6374 290d 0a20 2020  sults_dict)..   
+00006640: 2020 2020 200d 0a20 2020 2020 2020 200d       ..        .
+00006650: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
+00006660: 672e 7570 6461 7465 286c 6f67 290d 0a0d  g.update(log)...
+00006670: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
+00006680: 656e 2873 6176 6570 6174 682c 2027 612b  en(savepath, 'a+
+00006690: 272c 206e 6577 6c69 6e65 3d27 2729 2061  ', newline='') a
+000066a0: 7320 6373 765f 6669 6c65 3a0d 0a20 2020  s csv_file:..   
+000066b0: 2020 2020 2020 2020 2077 7269 7465 7220           writer 
+000066c0: 3d20 6373 762e 4469 6374 5772 6974 6572  = csv.DictWriter
+000066d0: 2863 7376 5f66 696c 652c 2066 6965 6c64  (csv_file, field
+000066e0: 6e61 6d65 733d 7365 6c66 2e6c 6f67 2e6b  names=self.log.k
+000066f0: 6579 7328 2929 0d0a 2020 2020 2020 2020  eys())..        
+00006700: 2020 2020 6966 206e 6f74 2061 7070 656e      if not appen
+00006710: 6469 6e67 3a0d 0a20 2020 2020 2020 2020  ding:..         
+00006720: 2020 2020 2020 2077 7269 7465 722e 7772         writer.wr
+00006730: 6974 6568 6561 6465 7228 290d 0a20 2020  iteheader()..   
+00006740: 2020 2020 2020 2020 2077 7269 7465 722e           writer.
+00006750: 7772 6974 6572 6f77 2873 656c 662e 6c6f  writerow(self.lo
+00006760: 6729 0d0a 2020 2020 2020 2020 2020 2020  g)..            
+00006770: 7072 696e 7428 2253 6176 696e 6720 7570  print("Saving up
+00006780: 6461 7465 6420 6c6f 6720 746f 3a20 222c  dated log to: ",
+00006790: 2020 7361 7665 7061 7468 290d 0a0d 0a20    savepath).... 
+000067a0: 2020 2064 6566 2073 6176 6528 7365 6c66     def save(self
+000067b0: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
+000067c0: 0a20 2020 2020 2020 2053 6176 6573 2074  .        Saves t
+000067d0: 6865 206d 6f64 656c 2061 6e64 2028 6f70  he model and (op
+000067e0: 7469 6f6e 616c 6c79 2c20 7061 7474 6572  tionally, patter
+000067f0: 6e73 2c20 636f 6e66 7573 696f 6e20 6d61  ns, confusion ma
+00006800: 7472 6963 6573 290d 0a20 2020 2020 2020  trices)..       
+00006810: 2022 2222 0d0a 2020 2020 2020 2020 0d0a   """..        ..
+00006820: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
+00006830: 6174 655f 7265 7375 6c74 7328 290d 0a20  ate_results().. 
+00006840: 2020 2020 2020 2077 6569 6768 7473 203d         weights =
+00006850: 207b 6b3a 206e 702e 7374 6163 6b28 7365   {k: np.stack(se
+00006860: 6c66 2e63 765f 7765 6967 6874 735b 6b5d  lf.cv_weights[k]
+00006870: 2c20 2d31 2920 666f 7220 6b20 696e 2073  , -1) for k in s
+00006880: 656c 662e 6376 5f77 6569 6768 7473 2e6b  elf.cv_weights.k
+00006890: 6579 7328 297d 0d0a 2020 2020 2020 2020  eys()}..        
+000068a0: 2355 7064 6174 6520 616e 6420 7361 7665  #Update and save
+000068b0: 206d 6574 6120 6669 6c65 0d0a 2020 2020   meta file..    
+000068c0: 2020 2020 7365 6c66 2e6d 6574 612e 7570      self.meta.up
+000068d0: 6461 7465 2864 6174 613d 7365 6c66 2e64  date(data=self.d
+000068e0: 6174 6173 6574 2e68 5f70 6172 616d 732c  ataset.h_params,
+000068f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006900: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+00006910: 5f73 7065 6373 3d73 656c 662e 7370 6563  _specs=self.spec
+00006920: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+00006930: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+00006940: 7465 726e 733d 7365 6c66 2e63 765f 7061  terns=self.cv_pa
+00006950: 7474 6572 6e73 2c0d 0a20 2020 2020 2020  tterns,..       
+00006960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006970: 2020 7765 6967 6874 733d 7765 6967 6874    weights=weight
+00006980: 7329 0d0a 2020 2020 2020 2020 2373 656c  s)..        #sel
+00006990: 662e 6d65 7461 2e73 6176 6528 290d 0a20  f.meta.save().. 
+000069a0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+000069b0: 2023 206d 6f64 656c 5f6e 616d 6520 3d20   # model_name = 
+000069c0: 225f 222e 6a6f 696e 285b 7365 6c66 2e73  "_".join([self.s
+000069d0: 636f 7065 2c0d 0a20 2020 2020 2020 2023  cope,..        #
+000069e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000069f0: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
+00006a00: 6173 6574 2e68 5f70 6172 616d 735b 2764  aset.h_params['d
+00006a10: 6174 615f 6964 275d 5d29 0d0a 2020 2020  ata_id']])..    
+00006a20: 2020 2020 2373 656c 662e 7370 6563 735b      #self.specs[
+00006a30: 276d 6f64 656c 5f6e 616d 6527 5d20 3d20  'model_name'] = 
+00006a40: 6d6f 6465 6c5f 6e61 6d65 0d0a 0d0a 2020  model_name....  
+00006a50: 2020 2020 2020 2373 6176 6520 7468 6520        #save the 
+00006a60: 6d6f 6465 6c0d 0a20 2020 2020 2020 2073  model..        s
+00006a70: 656c 662e 6b6d 2e73 6176 6528 6f73 2e70  elf.km.save(os.p
+00006a80: 6174 682e 6a6f 696e 2873 656c 662e 6d6f  ath.join(self.mo
+00006a90: 6465 6c5f 7061 7468 2c20 7365 6c66 2e6d  del_path, self.m
+00006aa0: 6f64 656c 5f6e 616d 6520 2b20 272e 6835  odel_name + '.h5
+00006ab0: 2729 290d 0a20 2020 2020 2020 200d 0a0d  '))..        ...
+00006ac0: 0a20 2020 2020 2020 2023 2023 5361 7665  .        # #Save
+00006ad0: 2072 6573 756c 7473 2066 726f 6d20 6d75   results from mu
+00006ae0: 6c74 6970 6c65 2066 6f6c 6473 0d0a 2020  ltiple folds..  
+00006af0: 2020 2020 2020 2320 6966 2068 6173 6174        # if hasat
+00006b00: 7472 2873 656c 662c 2027 6376 5f70 6174  tr(self, 'cv_pat
+00006b10: 7465 726e 7327 293a 0d0a 2020 2020 2020  terns'):..      
+00006b20: 2020 2320 2020 2020 2369 6620 6861 7361    #     #if hasa
+00006b30: 7474 7228 7365 6c66 2c20 2763 765f 7061  ttr(self, 'cv_pa
+00006b40: 7474 6572 6e73 2729 3a0d 0a20 2020 2020  tterns'):..     
+00006b50: 2020 2023 2020 2020 2070 7269 6e74 2822     #     print("
+00006b60: 5361 7669 6e67 2070 6174 7465 726e 7320  Saving patterns 
+00006b70: 746f 3a20 2220 2b20 7365 6c66 2e6d 6f64  to: " + self.mod
+00006b80: 656c 5f70 6174 6820 2b20 7365 6c66 2e6d  el_path + self.m
+00006b90: 6f64 656c 5f6e 616d 6520 2b20 225c 5c6d  odel_name + "\\m
+00006ba0: 6e65 666c 6f77 5f70 6174 7465 726e 732e  neflow_patterns.
+00006bb0: 6e70 7a22 2029 0d0a 2020 2020 2020 2020  npz" )..        
+00006bc0: 2320 2020 2020 6e70 2e73 6176 657a 2873  #     np.savez(s
+00006bd0: 656c 662e 6d6f 6465 6c5f 7061 7468 202b  elf.model_path +
+00006be0: 2073 656c 662e 6d6f 6465 6c5f 6e61 6d65   self.model_name
+00006bf0: 202b 2022 5c5c 6d6e 6566 6c6f 775f 7061   + "\\mneflow_pa
+00006c00: 7474 6572 6e73 2e6e 707a 222c 0d0a 2020  tterns.npz",..  
+00006c10: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+00006c20: 2020 2020 2063 765f 7061 7474 6572 6e73       cv_patterns
+00006c30: 3d73 656c 662e 6376 5f70 6174 7465 726e  =self.cv_pattern
+00006c40: 732c 0d0a 2020 2020 2020 2020 2320 2020  s,..        #   
+00006c50: 2020 2020 2020 2020 2020 2073 7065 6373             specs
+00006c60: 3d73 656c 662e 7370 6563 732c 0d0a 2020  =self.specs,..  
+00006c70: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+00006c80: 2020 2020 206d 6574 613d 7365 6c66 2e64       meta=self.d
+00006c90: 6174 6173 6574 2e68 5f70 6172 616d 732c  ataset.h_params,
+00006ca0: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
+00006cb0: 2020 2020 2020 2020 206c 6f67 3d73 656c           log=sel
+00006cc0: 662e 6c6f 672c 0d0a 2020 2020 2020 2020  f.log,..        
+00006cd0: 2320 2020 2020 2020 2020 2020 2020 2063  #              c
+00006ce0: 6d3d 7365 6c66 2e63 6d2c 0d0a 2020 2020  m=self.cm,..    
+00006cf0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00006d00: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
+00006d10: 2355 7064 6174 6520 6d65 7461 6461 7461  #Update metadata
+00006d20: 2077 6974 6820 7370 6563 7320 616e 6420   with specs and 
+00006d30: 6e65 7720 7365 6c66 2e64 6174 6173 6574  new self.dataset
+00006d40: 206f 7074 696f 6e73 0d0a 2020 2020 2020   options..      
+00006d50: 2020 2346 6f72 204c 4643 4e4e 2073 6176    #For LFCNN sav
+00006d60: 6520 7061 7474 6572 6e73 0d0a 0d0a 2020  e patterns....  
+00006d70: 2020 2320 6465 6620 7265 7374 6f72 6528    # def restore(
+00006d80: 7365 6c66 2c20 6d65 7461 293a 0d0a 2020  self, meta):..  
+00006d90: 2020 2320 2020 2020 2354 4f44 4f3a 2074    #     #TODO: t
+00006da0: 616b 6520 7061 7468 2c20 7363 6f70 652c  ake path, scope,
+00006db0: 2061 6e64 2064 6174 615f 6964 2061 7320   and data_id as 
+00006dc0: 696e 7075 7473 2e0d 0a20 2020 2023 2020  inputs...    #  
+00006dd0: 2020 2023 544f 444f 3a20 6275 696c 6420     #TODO: build 
+00006de0: 6461 7461 7365 7420 6672 6f6d 206d 6574  dataset from met
+00006df0: 6164 6174 610d 0a20 2020 2023 2020 2020  adata..    #    
+00006e00: 2023 544f 444f 3a20 696e 6974 6961 6c69   #TODO: initiali
+00006e10: 7a65 2066 726f 6d20 7370 6563 730d 0a0d  ze from specs...
+00006e20: 0a20 2020 2023 2020 2020 2073 656c 662e  .    #     self.
+00006e30: 6d6f 6465 6c5f 6e61 6d65 203d 2022 5f22  model_name = "_"
+00006e40: 2e6a 6f69 6e28 5b73 656c 662e 7363 6f70  .join([self.scop
+00006e50: 652c 0d0a 2020 2020 2320 2020 2020 2020  e,..    #       
+00006e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e70: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00006e80: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
+00006e90: 2764 6174 615f 6964 275d 5d29 0d0a 2020  'data_id']])..  
+00006ea0: 2020 2320 2020 2020 7365 6c66 2e6b 6d20    #     self.km 
+00006eb0: 203d 2074 662e 6b65 7261 732e 6d6f 6465   = tf.keras.mode
+00006ec0: 6c73 2e6c 6f61 645f 6d6f 6465 6c28 7365  ls.load_model(se
+00006ed0: 6c66 2e6d 6f64 656c 5f70 6174 6820 2b20  lf.model_path + 
+00006ee0: 7365 6c66 2e6d 6f64 656c 5f6e 616d 6529  self.model_name)
+00006ef0: 0d0a 2020 2020 2320 2020 2020 2374 7279  ..    #     #try
+00006f00: 3a0d 0a0d 0a20 2020 2023 2020 2020 2069  :....    #     i
+00006f10: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+00006f20: 2873 656c 662e 6d6f 6465 6c5f 7061 7468  (self.model_path
+00006f30: 202b 2073 656c 662e 6d6f 6465 6c5f 6e61   + self.model_na
+00006f40: 6d65 202b 2022 5c5c 6d6e 6566 6c6f 775f  me + "\\mneflow_
+00006f50: 7061 7474 6572 6e73 2e6e 707a 2229 3a0d  patterns.npz"):.
+00006f60: 0a20 2020 2023 2020 2020 2020 2020 2070  .    #         p
+00006f70: 7269 6e74 2822 5265 7374 6f72 696e 6720  rint("Restoring 
+00006f80: 6672 6f6d 3a22 202b 2073 656c 662e 6d6f  from:" + self.mo
+00006f90: 6465 6c5f 7061 7468 202b 2073 656c 662e  del_path + self.
+00006fa0: 6d6f 6465 6c5f 6e61 6d65 202b 2022 5c5c  model_name + "\\
+00006fb0: 6d6e 6566 6c6f 775f 7061 7474 6572 6e73  mneflow_patterns
+00006fc0: 2e6e 707a 2220 290d 0a20 2020 2023 2020  .npz" )..    #  
+00006fd0: 2020 2020 2020 2066 203d 206e 702e 6c6f         f = np.lo
+00006fe0: 6164 2873 656c 662e 6d6f 6465 6c5f 7061  ad(self.model_pa
+00006ff0: 7468 202b 2073 656c 662e 6d6f 6465 6c5f  th + self.model_
+00007000: 6e61 6d65 202b 2022 5c5c 6d6e 6566 6c6f  name + "\\mneflo
+00007010: 775f 7061 7474 6572 6e73 2e6e 707a 222c  w_patterns.npz",
+00007020: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
+00007030: 2020 2020 2020 2020 2020 2020 616c 6c6f              allo
+00007040: 775f 7069 636b 6c65 3d54 7275 6529 0d0a  w_pickle=True)..
+00007050: 2020 2020 2320 2020 2020 2020 2020 7365      #         se
+00007060: 6c66 2e63 765f 7061 7474 6572 6e73 203d  lf.cv_patterns =
+00007070: 2066 5b22 6376 5f70 6174 7465 726e 7322   f["cv_patterns"
+00007080: 5d23 2e69 7465 6d28 290d 0a20 2020 2023  ]#.item()..    #
+00007090: 2020 2020 2020 2020 2073 656c 662e 7370           self.sp
+000070a0: 6563 7320 3d20 665b 2273 7065 6373 225d  ecs = f["specs"]
+000070b0: 232e 6974 656d 2829 0d0a 2020 2020 2320  #.item()..    # 
+000070c0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+000070d0: 6120 3d20 665b 226d 6574 6122 5d23 2e69  a = f["meta"]#.i
+000070e0: 7465 6d28 290d 0a20 2020 2023 2020 2020  tem()..    #    
+000070f0: 2020 2020 2073 656c 662e 6c6f 6720 3d20       self.log = 
+00007100: 665b 226c 6f67 225d 232e 6974 656d 2829  f["log"]#.item()
+00007110: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
+00007120: 7365 6c66 2e63 6d20 3d20 665b 2263 6d22  self.cm = f["cm"
+00007130: 5d0d 0a0d 0a20 2020 2064 6566 2070 7265  ]....    def pre
+00007140: 6469 6374 5f73 616d 706c 6528 7365 6c66  dict_sample(self
+00007150: 2c20 7829 3a0d 0a20 2020 2020 2020 206e  , x):..        n
+00007160: 5f63 6820 3d20 7365 6c66 2e64 6174 6173  _ch = self.datas
+00007170: 6574 2e68 5f70 6172 616d 735b 276e 5f63  et.h_params['n_c
+00007180: 6827 5d0d 0a20 2020 2020 2020 206e 5f74  h']..        n_t
+00007190: 203d 2073 656c 662e 6461 7461 7365 742e   = self.dataset.
+000071a0: 685f 7061 7261 6d73 5b27 6e5f 7427 5d0d  h_params['n_t'].
+000071b0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+000071c0: 782e 7368 6170 655b 2d32 3a5d 203d 3d20  x.shape[-2:] == 
+000071d0: 286e 5f74 2c20 6e5f 6368 292c 2020 2253  (n_t, n_ch),  "S
+000071e0: 6861 7065 206d 6973 6d61 7463 6821 2045  hape mismatch! E
+000071f0: 7870 6563 7465 6420 7b7d 787b 7d2c 205c  xpected {}x{}, \
+00007200: 0d0a 2020 2020 2020 2020 2020 2020 676f  ..            go
+00007210: 7420 7b7d 787b 7d22 2e66 6f72 6d61 7428  t {}x{}".format(
+00007220: 6e5f 742c 206e 5f63 682c 2078 2e73 6861  n_t, n_ch, x.sha
+00007230: 7065 5b2d 325d 2c20 782e 7368 6170 655b  pe[-2], x.shape[
+00007240: 2d31 5d29 0d0a 0d0a 2020 2020 2020 2020  -1])....        
+00007250: 7768 696c 6520 782e 6e64 696d 203c 2034  while x.ndim < 4
+00007260: 3a0d 0a20 2020 2020 2020 2020 2020 2078  :..            x
+00007270: 203d 206e 702e 6578 7061 6e64 5f64 696d   = np.expand_dim
+00007280: 7328 782c 2030 290d 0a0d 0a20 2020 2020  s(x, 0)....     
+00007290: 2020 206f 7574 203d 2073 656c 662e 6b6d     out = self.km
+000072a0: 2e70 7265 6469 6374 2878 290d 0a20 2020  .predict(x)..   
+000072b0: 2020 2020 2069 6620 7365 6c66 2e64 6174       if self.dat
+000072c0: 6173 6574 2e68 5f70 6172 616d 735b 2774  aset.h_params['t
+000072d0: 6172 6765 745f 7479 7065 275d 203d 3d20  arget_type'] == 
+000072e0: 2769 6e74 273a 0d0a 2020 2020 2020 2020  'int':..        
+000072f0: 2020 2020 6f75 7420 3d20 6e70 2e61 7267      out = np.arg
+00007300: 6d61 7828 6f75 742c 202d 3129 0d0a 0d0a  max(out, -1)....
+00007310: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+00007320: 7574 0d0a 0d0a 2020 2020 6465 6620 7072  ut....    def pr
+00007330: 6564 6963 7428 7365 6c66 2c20 6461 7461  edict(self, data
+00007340: 7365 743d 4e6f 6e65 293a 0d0a 2020 2020  set=None):..    
+00007350: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00007360: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
+00007370: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020    -------..     
+00007380: 2020 2079 5f74 7275 6520 3a20 6e70 2e61     y_true : np.a
+00007390: 7272 6179 0d0a 2020 2020 2020 2020 2020  rray..          
+000073a0: 2020 2020 2020 6772 6f75 6e64 2074 7275        ground tru
+000073b0: 7468 206c 6162 656c 7320 7461 6b65 6e20  th labels taken 
+000073c0: 6672 6f6d 2074 6865 2064 6174 6173 6574  from the dataset
+000073d0: 0d0a 0d0a 2020 2020 2020 2020 795f 7072  ....        y_pr
+000073e0: 6564 203a 206e 702e 6172 7261 790d 0a20  ed : np.array.. 
+000073f0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00007400: 6f64 656c 2070 7265 6469 6374 696f 6e73  odel predictions
+00007410: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00007420: 2020 2020 2020 2069 6620 6e6f 7420 6461         if not da
+00007430: 7461 7365 743a 0d0a 2020 2020 2020 2020  taset:..        
+00007440: 2020 2020 7072 696e 7428 224e 6f20 6461      print("No da
+00007450: 7461 7365 7420 7370 6563 6966 6965 6420  taset specified 
+00007460: 7573 696e 6720 7661 6c69 6461 7469 6f6e  using validation
+00007470: 2064 6174 6173 6574 2028 4465 6661 756c   dataset (Defaul
+00007480: 7429 2229 0d0a 2020 2020 2020 2020 2020  t)")..          
+00007490: 2020 6461 7461 7365 7420 3d20 7365 6c66    dataset = self
+000074a0: 2e64 6174 6173 6574 2e76 616c 0d0a 2020  .dataset.val..  
+000074b0: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+000074c0: 7461 6e63 6528 6461 7461 7365 742c 2073  tance(dataset, s
+000074d0: 7472 2920 6f72 2069 7369 6e73 7461 6e63  tr) or isinstanc
+000074e0: 6528 6461 7461 7365 742c 2028 6c69 7374  e(dataset, (list
+000074f0: 2c20 7475 706c 6529 293a 0d0a 2020 2020  , tuple)):..    
+00007500: 2020 2020 2020 2020 6461 7461 7365 7420          dataset 
+00007510: 3d20 7365 6c66 2e64 6174 6173 6574 2e5f  = self.dataset._
+00007520: 6275 696c 645f 6461 7461 7365 7428 6461  build_dataset(da
+00007530: 7461 7365 742c 0d0a 2020 2020 2020 2020  taset,..        
+00007540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007560: 2020 2020 2020 2020 2073 706c 6974 3d46           split=F
+00007570: 616c 7365 2c0d 0a20 2020 2020 2020 2020  alse,..         
+00007580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075a0: 2020 2020 2020 2020 7465 7374 5f62 6174          test_bat
+000075b0: 6368 3d4e 6f6e 652c 0d0a 2020 2020 2020  ch=None,..      
+000075c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075e0: 2020 2020 2020 2020 2020 2072 6570 6561             repea
+000075f0: 743d 4661 6c73 6529 0d0a 2020 2020 2020  t=False)..      
+00007600: 2020 656c 6966 206e 6f74 2069 7369 6e73    elif not isins
+00007610: 7461 6e63 6528 6461 7461 7365 742c 2074  tance(dataset, t
+00007620: 662e 6461 7461 2e44 6174 6173 6574 293a  f.data.Dataset):
+00007630: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+00007640: 696e 7428 2253 7065 6369 6679 2064 6174  int("Specify dat
+00007650: 6173 6574 2229 0d0a 2020 2020 2020 2020  aset")..        
+00007660: 2020 2020 7265 7475 726e 204e 6f6e 652c      return None,
+00007670: 204e 6f6e 650d 0a0d 0a20 2020 2020 2020   None....       
+00007680: 2058 203d 205b 5d0d 0a20 2020 2020 2020   X = []..       
+00007690: 2079 203d 205b 5d0d 0a0d 0a20 2020 2020   y = []....     
+000076a0: 2020 2066 6f72 2072 6f77 2069 6e20 6461     for row in da
+000076b0: 7461 7365 742e 7461 6b65 2831 293a 0d0a  taset.take(1):..
+000076c0: 2020 2020 2020 2020 2020 2020 582e 6170              X.ap
+000076d0: 7065 6e64 2872 6f77 5b30 5d29 0d0a 2020  pend(row[0])..  
+000076e0: 2020 2020 2020 2020 2020 792e 6170 7065            y.appe
+000076f0: 6e64 2872 6f77 5b31 5d29 0d0a 0d0a 2020  nd(row[1])....  
+00007700: 2020 2020 2020 795f 7072 6564 203d 2073        y_pred = s
+00007710: 656c 662e 6b6d 2e70 7265 6469 6374 286e  elf.km.predict(n
+00007720: 702e 636f 6e63 6174 656e 6174 6528 5829  p.concatenate(X)
+00007730: 290d 0a20 2020 2020 2020 2079 5f74 7275  )..        y_tru
+00007740: 6520 3d20 6e70 2e63 6f6e 6361 7465 6e61  e = np.concatena
+00007750: 7465 2879 290d 0a0d 0a20 2020 2020 2020  te(y)....       
+00007760: 2023 795f 7472 7565 203d 2079 5f74 7275   #y_true = y_tru
+00007770: 652e 6e75 6d70 7928 290d 0a20 2020 2020  e.numpy()..     
+00007780: 2020 2072 6574 7572 6e20 795f 7472 7565     return y_true
+00007790: 2c20 795f 7072 6564 0d0a 0d0a 2020 2020  , y_pred....    
+000077a0: 6465 6620 6576 616c 7561 7465 2873 656c  def evaluate(sel
+000077b0: 662c 2064 6174 6173 6574 3d46 616c 7365  f, dataset=False
+000077c0: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
+000077d0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+000077e0: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
+000077f0: 2d0d 0a20 2020 2020 2020 206c 6f73 7365  -..        losse
+00007800: 7320 3a20 6c69 7374 0d0a 2020 2020 2020  s : list..      
+00007810: 2020 2020 2020 2020 2020 6d6f 6465 6c20            model 
+00007820: 6c6f 7373 206f 6e20 6120 7370 6563 6966  loss on a specif
+00007830: 6965 6420 6461 7461 7365 740d 0a0d 0a20  ied dataset.... 
+00007840: 2020 2020 2020 206d 6574 7269 6373 203a         metrics :
+00007850: 206e 702e 6172 7261 790d 0a20 2020 2020   np.array..     
+00007860: 2020 2020 2020 2020 2020 206d 6574 7269             metri
+00007870: 6373 2065 7661 6c75 6174 6564 206f 6e20  cs evaluated on 
+00007880: 6120 7370 6563 6966 6965 6420 6461 7461  a specified data
+00007890: 7365 740d 0a20 2020 2020 2020 2022 2222  set..        """
+000078a0: 0d0a 0d0a 2020 2020 2020 2020 6966 206e  ....        if n
+000078b0: 6f74 2064 6174 6173 6574 3a0d 0a20 2020  ot dataset:..   
+000078c0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+000078d0: 4e6f 2064 6174 6173 6574 2073 7065 6369  No dataset speci
+000078e0: 6669 6564 2075 7369 6e67 2076 616c 6964  fied using valid
+000078f0: 6174 696f 6e20 6461 7461 7365 7420 2844  ation dataset (D
+00007900: 6566 6175 6c74 2922 290d 0a20 2020 2020  efault)")..     
+00007910: 2020 2020 2020 2064 6174 6173 6574 203d         dataset =
+00007920: 2073 656c 662e 6461 7461 7365 742e 7661   self.dataset.va
+00007930: 6c0d 0a20 2020 2020 2020 2065 6c69 6620  l..        elif 
+00007940: 6973 696e 7374 616e 6365 2864 6174 6173  isinstance(datas
+00007950: 6574 2c20 7374 7229 206f 7220 6973 696e  et, str) or isin
+00007960: 7374 616e 6365 2864 6174 6173 6574 2c20  stance(dataset, 
+00007970: 286c 6973 742c 2074 7570 6c65 2929 3a0d  (list, tuple)):.
+00007980: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00007990: 6173 6574 203d 2073 656c 662e 6461 7461  aset = self.data
+000079a0: 7365 742e 5f62 7569 6c64 5f64 6174 6173  set._build_datas
+000079b0: 6574 2864 6174 6173 6574 2c0d 0a20 2020  et(dataset,..   
+000079c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000079d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000079e0: 2020 2020 2020 2020 2020 7370 6c69 743d            split=
+000079f0: 4661 6c73 652c 0d0a 2020 2020 2020 2020  False,..        
+00007a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a20: 2020 2020 2074 6573 745f 6261 7463 683d       test_batch=
+00007a30: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
+00007a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a60: 2020 2020 7265 7065 6174 3d54 7275 6529      repeat=True)
+00007a70: 0d0a 2020 2020 2020 2020 656c 6966 206e  ..        elif n
+00007a80: 6f74 2069 7369 6e73 7461 6e63 6528 6461  ot isinstance(da
+00007a90: 7461 7365 742c 2074 662e 6461 7461 2e44  taset, tf.data.D
+00007aa0: 6174 6173 6574 293a 0d0a 2020 2020 2020  ataset):..      
+00007ab0: 2020 2020 2020 7072 696e 7428 2253 7065        print("Spe
+00007ac0: 6369 6679 2064 6174 6173 6574 2229 0d0a  cify dataset")..
+00007ad0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00007ae0: 726e 204e 6f6e 652c 204e 6f6e 650d 0a0d  rn None, None...
+00007af0: 0a20 2020 2020 2020 206c 6f73 7365 732c  .        losses,
+00007b00: 206d 6574 7269 6373 203d 2073 656c 662e   metrics = self.
+00007b10: 6b6d 2e65 7661 6c75 6174 6528 6461 7461  km.evaluate(data
+00007b20: 7365 742c 0d0a 2020 2020 2020 2020 2020  set,..          
+00007b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007b50: 2073 7465 7073 3d73 656c 662e 6461 7461   steps=self.data
+00007b60: 7365 742e 7661 6c69 6461 7469 6f6e 5f73  set.validation_s
+00007b70: 7465 7073 2c0d 0a20 2020 2020 2020 2020  teps,..         
+00007b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ba0: 2020 7665 7262 6f73 653d 3029 0d0a 2020    verbose=0)..  
+00007bb0: 2020 2020 2020 7265 7475 726e 2020 6c6f        return  lo
+00007bc0: 7373 6573 2c20 6d65 7472 6963 730d 0a0d  sses, metrics...
+00007bd0: 0a0d 0a0d 0a0d 0a0d 0a63 6c61 7373 204c  .........class L
+00007be0: 4643 4e4e 2842 6173 654d 6f64 656c 293a  FCNN(BaseModel):
+00007bf0: 0d0a 2020 2020 2222 224c 462d 434e 4e2e  ..    """LF-CNN.
+00007c00: 2049 6e63 6c75 6465 7320 6261 7369 6320   Includes basic 
+00007c10: 7061 7261 6d65 7465 7220 696e 7465 7270  parameter interp
+00007c20: 7265 7461 7469 6f6e 206f 7074 696f 6e73  retation options
+00007c30: 2e0d 0a0d 0a20 2020 2046 6f72 2064 6574  .....    For det
+00007c40: 6169 6c73 2073 6565 205b 315d 2e0d 0a20  ails see [1]... 
+00007c50: 2020 2052 6566 6572 656e 6365 730d 0a20     References.. 
+00007c60: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
+00007c70: 2020 2020 2020 205b 315d 2049 2e20 5a75         [1] I. Zu
+00007c80: 6261 7265 762c 2065 7420 616c 2e2c 2041  barev, et al., A
+00007c90: 6461 7074 6976 6520 6e65 7572 616c 206e  daptive neural n
+00007ca0: 6574 776f 726b 2063 6c61 7373 6966 6965  etwork classifie
+00007cb0: 7220 666f 720d 0a20 2020 2020 2020 2064  r for..        d
+00007cc0: 6563 6f64 696e 6720 4d45 4720 7369 676e  ecoding MEG sign
+00007cd0: 616c 732e 204e 6575 726f 696d 6167 652e  als. Neuroimage.
+00007ce0: 2028 3230 3139 2920 4d61 7920 343b 3139   (2019) May 4;19
+00007cf0: 373a 3432 352d 3433 340d 0a20 2020 2022  7:425-434..    "
+00007d00: 2222 0d0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
+00007d10: 6974 5f5f 2873 656c 662c 206d 6574 612c  it__(self, meta,
+00007d20: 2064 6174 6173 6574 3d4e 6f6e 6529 3a0d   dataset=None):.
+00007d30: 0a20 2020 2020 2020 2022 2222 0d0a 0d0a  .        """....
+00007d40: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00007d50: 7273 0d0a 2020 2020 2020 2020 2d2d 2d2d  rs..        ----
+00007d60: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
+00007d70: 4461 7461 7365 7420 3a20 6d6e 6566 6c6f  Dataset : mneflo
+00007d80: 772e 4461 7461 7365 740d 0a0d 0a20 2020  w.Dataset....   
+00007d90: 2020 2020 2073 7065 6373 203a 2064 6963       specs : dic
+00007da0: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
+00007db0: 2020 2064 6963 7469 6f6e 6172 7920 6f66     dictionary of
+00007dc0: 206d 6f64 656c 2068 7970 6572 7061 7261   model hyperpara
+00007dd0: 6d65 7465 7273 207b 0d0a 0d0a 2020 2020  meters {....    
+00007de0: 2020 2020 6e5f 6c61 7465 6e74 203a 2069      n_latent : i
+00007df0: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
+00007e00: 4e75 6d62 6572 206f 6620 6c61 7465 6e74  Number of latent
+00007e10: 2063 6f6d 706f 6e65 6e74 732e 0d0a 2020   components...  
+00007e20: 2020 2020 2020 2020 2020 4465 6661 756c            Defaul
+00007e30: 7473 2074 6f20 3332 2e0d 0a0d 0a20 2020  ts to 32.....   
+00007e40: 2020 2020 206e 6f6e 6c69 6e20 3a20 6361       nonlin : ca
+00007e50: 6c6c 6162 6c65 0d0a 2020 2020 2020 2020  llable..        
+00007e60: 2020 2020 4163 7469 7661 7469 6f6e 2066      Activation f
+00007e70: 756e 6374 696f 6e20 6f66 2074 6865 2074  unction of the t
+00007e80: 656d 706f 7261 6c20 636f 6e76 6f6c 7574  emporal convolut
+00007e90: 696f 6e20 6c61 7965 722e 0d0a 2020 2020  ion layer...    
+00007ea0: 2020 2020 2020 2020 4465 6661 756c 7473          Defaults
+00007eb0: 2074 6f20 7466 2e6e 6e2e 7265 6c75 0d0a   to tf.nn.relu..
+00007ec0: 0d0a 2020 2020 2020 2020 6669 6c74 6572  ..        filter
+00007ed0: 5f6c 656e 6774 6820 3a20 696e 740d 0a20  _length : int.. 
+00007ee0: 2020 2020 2020 2020 2020 204c 656e 6774             Lengt
+00007ef0: 6820 6f66 2073 7061 7469 6f2d 7465 6d70  h of spatio-temp
+00007f00: 6f72 616c 206b 6572 6e65 6c73 2069 6e20  oral kernels in 
+00007f10: 7468 6520 7465 6d70 6f72 616c 0d0a 2020  the temporal..  
+00007f20: 2020 2020 2020 2020 2020 636f 6e76 6f6c            convol
+00007f30: 7574 696f 6e20 6c61 7965 722e 2044 6566  ution layer. Def
+00007f40: 6175 6c74 7320 746f 2037 2e0d 0a0d 0a20  aults to 7..... 
+00007f50: 2020 2020 2020 2070 6f6f 6c69 6e67 203a         pooling :
+00007f60: 2069 6e74 0d0a 2020 2020 2020 2020 2020   int..          
+00007f70: 2020 506f 6f6c 696e 6720 6661 6374 6f72    Pooling factor
+00007f80: 206f 6620 7468 6520 6d61 7820 706f 6f6c   of the max pool
+00007f90: 696e 6720 6c61 7965 722e 2044 6566 6175  ing layer. Defau
+00007fa0: 6c74 7320 746f 2032 0d0a 0d0a 2020 2020  lts to 2....    
+00007fb0: 2020 2020 706f 6f6c 5f74 7970 6520 3a20      pool_type : 
+00007fc0: 7374 7220 7b27 6176 6727 2c20 276d 6178  str {'avg', 'max
+00007fd0: 277d 0d0a 2020 2020 2020 2020 2020 2020  '}..            
+00007fe0: 5479 7065 206f 6620 706f 6f6c 696e 6720  Type of pooling 
+00007ff0: 6f70 6572 6174 696f 6e2e 2044 6566 6175  operation. Defau
+00008000: 6c74 7320 746f 2027 6d61 7827 2e0d 0a0d  lts to 'max'....
+00008010: 0a20 2020 2020 2020 2070 6164 6469 6e67  .        padding
+00008020: 203a 2073 7472 207b 2753 414d 4527 2c20   : str {'SAME', 
+00008030: 2746 554c 4c27 2c20 2756 414c 4944 277d  'FULL', 'VALID'}
+00008040: 0d0a 2020 2020 2020 2020 2020 2020 436f  ..            Co
+00008050: 6e76 6f6c 7574 696f 6e20 7061 6464 696e  nvolution paddin
+00008060: 672e 2044 6566 6175 6c74 7320 746f 2027  g. Defaults to '
+00008070: 5341 4d45 272e 7d0d 0a0d 0a20 2020 2020  SAME'.}....     
+00008080: 2020 2073 7472 6964 6520 3a20 696e 740d     stride : int.
+00008090: 0a20 2020 2020 2020 2053 7472 6964 6520  .        Stride 
+000080a0: 6f66 2074 6865 206d 6178 2070 6f6f 6c69  of the max pooli
+000080b0: 6e67 206c 6179 6572 2e20 4465 6661 756c  ng layer. Defaul
+000080c0: 7473 2074 6f20 312e 0d0a 2020 2020 2020  ts to 1...      
+000080d0: 2020 2222 220d 0a20 2020 2020 2020 2073    """..        s
+000080e0: 656c 662e 7363 6f70 6520 3d20 276c 6663  elf.scope = 'lfc
+000080f0: 6e6e 270d 0a20 2020 2020 2020 2023 7370  nn'..        #sp
+00008100: 6563 7320 3d20 6d65 7461 2e6d 6f64 656c  ecs = meta.model
+00008110: 5f73 7065 6373 0d0a 2020 2020 2020 2020  _specs..        
+00008120: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
+00008130: 2e73 6574 6465 6661 756c 7428 2766 696c  .setdefault('fil
+00008140: 7465 725f 6c65 6e67 7468 272c 2037 290d  ter_length', 7).
+00008150: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
+00008160: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
+00008170: 6175 6c74 2827 6e5f 6c61 7465 6e74 272c  ault('n_latent',
+00008180: 2033 3229 0d0a 2020 2020 2020 2020 6d65   32)..        me
+00008190: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
+000081a0: 6574 6465 6661 756c 7428 2770 6f6f 6c69  etdefault('pooli
+000081b0: 6e67 272c 2032 290d 0a20 2020 2020 2020  ng', 2)..       
+000081c0: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
+000081d0: 732e 7365 7464 6566 6175 6c74 2827 7374  s.setdefault('st
+000081e0: 7269 6465 272c 2032 290d 0a20 2020 2020  ride', 2)..     
+000081f0: 2020 206d 6574 612e 6d6f 6465 6c5f 7370     meta.model_sp
+00008200: 6563 732e 7365 7464 6566 6175 6c74 2827  ecs.setdefault('
+00008210: 7061 6464 696e 6727 2c20 2753 414d 4527  padding', 'SAME'
+00008220: 290d 0a20 2020 2020 2020 206d 6574 612e  )..        meta.
+00008230: 6d6f 6465 6c5f 7370 6563 732e 7365 7464  model_specs.setd
+00008240: 6566 6175 6c74 2827 706f 6f6c 5f74 7970  efault('pool_typ
+00008250: 6527 2c20 276d 6178 2729 0d0a 2020 2020  e', 'max')..    
+00008260: 2020 2020 6d65 7461 2e6d 6f64 656c 5f73      meta.model_s
+00008270: 7065 6373 2e73 6574 6465 6661 756c 7428  pecs.setdefault(
+00008280: 276e 6f6e 6c69 6e27 2c20 7466 2e6e 6e2e  'nonlin', tf.nn.
+00008290: 7265 6c75 290d 0a20 2020 2020 2020 206d  relu)..        m
+000082a0: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
+000082b0: 7365 7464 6566 6175 6c74 2827 6c31 5f6c  setdefault('l1_l
+000082c0: 616d 6264 6127 2c20 3365 2d34 290d 0a20  ambda', 3e-4).. 
+000082d0: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
+000082e0: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
+000082f0: 6c74 2827 6c32 5f6c 616d 6264 6127 2c20  lt('l2_lambda', 
+00008300: 302e 290d 0a20 2020 2020 2020 206d 6574  0.)..        met
+00008310: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
+00008320: 7464 6566 6175 6c74 2827 6c31 5f73 636f  tdefault('l1_sco
+00008330: 7065 272c 205b 2766 6327 2c20 2764 656d  pe', ['fc', 'dem
+00008340: 6978 272c 2027 6c66 5f63 6f6e 7627 5d29  ix', 'lf_conv'])
+00008350: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
+00008360: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
+00008370: 6661 756c 7428 276c 325f 7363 6f70 6527  fault('l2_scope'
+00008380: 2c20 5b5d 290d 0a20 2020 2020 2020 206d  , [])..        m
+00008390: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
+000083a0: 7365 7464 6566 6175 6c74 2827 756e 6974  setdefault('unit
+000083b0: 6e6f 726d 5f73 636f 7065 272c 205b 5d29  norm_scope', [])
+000083c0: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
+000083d0: 6f64 656c 5f73 7065 6373 5b27 7363 6f70  odel_specs['scop
+000083e0: 6527 5d20 3d20 7365 6c66 2e73 636f 7065  e'] = self.scope
+000083f0: 0d0a 2020 2020 2020 2020 2373 7065 6373  ..        #specs
+00008400: 2e73 6574 6465 6661 756c 7428 276d 6f64  .setdefault('mod
+00008410: 656c 5f70 6174 6827 2c20 2073 656c 662e  el_path',  self.
+00008420: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
+00008430: 5b27 7361 7665 5f70 6174 6827 5d29 0d0a  ['save_path'])..
+00008440: 2020 2020 2020 2020 7375 7065 7228 4c46          super(LF
+00008450: 434e 4e2c 2073 656c 6629 2e5f 5f69 6e69  CNN, self).__ini
+00008460: 745f 5f28 6d65 7461 2c20 6461 7461 7365  t__(meta, datase
+00008470: 7429 0d0a 0d0a 0d0a 0d0a 2020 2020 6465  t)........    de
+00008480: 6620 6275 696c 645f 6772 6170 6828 7365  f build_graph(se
+00008490: 6c66 293a 0d0a 2020 2020 2020 2020 2222  lf):..        ""
+000084a0: 2242 7569 6c64 2063 6f6d 7075 7461 7469  "Build computati
+000084b0: 6f6e 616c 2067 7261 7068 2075 7369 6e67  onal graph using
+000084c0: 2064 6566 696e 6564 2070 6c61 6365 686f   defined placeho
+000084d0: 6c64 6572 2060 7365 6c66 2e58 600d 0a20  lder `self.X`.. 
+000084e0: 2020 2020 2020 2061 7320 696e 7075 742e         as input.
+000084f0: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
+00008500: 726e 730d 0a20 2020 2020 2020 202d 2d2d  rns..        ---
+00008510: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2079  -----..        y
+00008520: 5f70 7265 6420 3a20 7466 2e54 656e 736f  _pred : tf.Tenso
+00008530: 720d 0a20 2020 2020 2020 2020 2020 204f  r..            O
+00008540: 7574 7075 7420 6f66 2074 6865 2066 6f72  utput of the for
+00008550: 7761 7264 2070 6173 7320 6f66 2074 6865  ward pass of the
+00008560: 2063 6f6d 7075 7461 7469 6f6e 616c 2067   computational g
+00008570: 7261 7068 2e0d 0a20 2020 2020 2020 2020  raph...         
+00008580: 2020 2050 7265 6469 6374 696f 6e20 6f66     Prediction of
+00008590: 2074 6865 2074 6172 6765 7420 7661 7269   the target vari
+000085a0: 6162 6c65 2e0d 0a20 2020 2020 2020 2022  able...        "
+000085b0: 2222 0d0a 2020 2020 2020 2020 7365 6c66  ""..        self
+000085c0: 2e64 6d78 203d 2044 654d 6978 696e 6728  .dmx = DeMixing(
+000085d0: 7369 7a65 3d73 656c 662e 7370 6563 735b  size=self.specs[
+000085e0: 276e 5f6c 6174 656e 7427 5d2c 206e 6f6e  'n_latent'], non
+000085f0: 6c69 6e3d 7466 2e69 6465 6e74 6974 792c  lin=tf.identity,
+00008600: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008610: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+00008620: 6973 3d33 2c20 7370 6563 733d 7365 6c66  is=3, specs=self
+00008630: 2e73 7065 6373 290d 0a20 2020 2020 2020  .specs)..       
+00008640: 2073 656c 662e 646d 785f 6f75 7420 3d20   self.dmx_out = 
+00008650: 7365 6c66 2e64 6d78 2873 656c 662e 696e  self.dmx(self.in
+00008660: 7075 7473 290d 0a0d 0a20 2020 2020 2020  puts)....       
+00008670: 2073 656c 662e 7463 6f6e 7620 3d20 4c46   self.tconv = LF
+00008680: 5443 6f6e 7628 7369 7a65 3d73 656c 662e  TConv(size=self.
+00008690: 7370 6563 735b 276e 5f6c 6174 656e 7427  specs['n_latent'
+000086a0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
 000086b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000086c0: 2020 2020 2020 2020 2020 2073 7472 6964             strid
-000086d0: 653d 7365 6c66 2e73 7065 6373 5b27 7374  e=self.specs['st
-000086e0: 7269 6465 275d 2c0d 0a20 2020 2020 2020  ride'],..       
-000086f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008700: 2020 2020 2020 2020 2020 2070 6164 6469             paddi
-00008710: 6e67 3d27 5341 4d45 272c 2373 656c 662e  ng='SAME',#self.
-00008720: 7370 6563 735b 2770 6164 6469 6e67 275d  specs['padding']
-00008730: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008750: 2020 2020 290d 0a20 2020 2020 2020 2073      )..        s
-00008760: 656c 662e 706f 6f6c 6564 203d 2073 656c  elf.pooled = sel
-00008770: 662e 706f 6f6c 2873 656c 662e 7463 6f6e  f.pool(self.tcon
-00008780: 765f 6f75 7429 0d0a 0d0a 2020 2020 2020  v_out)....      
-00008790: 2020 7365 6c66 2e64 726f 706f 7574 203d    self.dropout =
-000087a0: 2044 726f 706f 7574 2873 656c 662e 7370   Dropout(self.sp
-000087b0: 6563 735b 2764 726f 706f 7574 275d 2c0d  ecs['dropout'],.
-000087c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000087d0: 2020 2020 2020 2020 2020 206e 6f69 7365             noise
-000087e0: 5f73 6861 7065 3d4e 6f6e 6529 2873 656c  _shape=None)(sel
-000087f0: 662e 706f 6f6c 6564 290d 0a0d 0a20 2020  f.pooled)....   
-00008800: 2020 2020 2073 656c 662e 6669 6e5f 6663       self.fin_fc
-00008810: 203d 2046 756c 6c79 436f 6e6e 6563 7465   = FullyConnecte
-00008820: 6428 7369 7a65 3d73 656c 662e 6f75 745f  d(size=self.out_
-00008830: 6469 6d2c 206e 6f6e 6c69 6e3d 7466 2e69  dim, nonlin=tf.i
-00008840: 6465 6e74 6974 792c 0d0a 2020 2020 2020  dentity,..      
-00008850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008860: 2020 2020 2020 7370 6563 733d 7365 6c66        specs=self
-00008870: 2e73 7065 6373 290d 0a0d 0a20 2020 2020  .specs)....     
-00008880: 2020 2079 5f70 7265 6420 3d20 7365 6c66     y_pred = self
-00008890: 2e66 696e 5f66 6328 7365 6c66 2e64 726f  .fin_fc(self.dro
-000088a0: 706f 7574 290d 0a0d 0a20 2020 2020 2020  pout)....       
-000088b0: 2072 6574 7572 6e20 795f 7072 6564 0d0a   return y_pred..
-000088c0: 0d0a 2020 2020 6465 6620 6275 696c 645f  ..    def build_
-000088d0: 656e 636f 6465 7228 7365 6c66 293a 0d0a  encoder(self):..
-000088e0: 2020 2020 2020 2020 2222 2242 7569 6c64          """Build
-000088f0: 2063 6f6d 7075 7461 7469 6f6e 616c 2067   computational g
-00008900: 7261 7068 2066 6f72 2061 6e20 696e 7465  raph for an inte
-00008910: 7270 7265 7461 626c 6520 4765 6e65 7261  rpretable Genera
-00008920: 746f 720d 0a0d 0a20 2020 2020 2020 2052  tor....        R
-00008930: 6574 7572 6e73 0d0a 2020 2020 2020 2020  eturns..        
-00008940: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-00008950: 2020 795f 7072 6564 203a 2074 662e 5465    y_pred : tf.Te
-00008960: 6e73 6f72 0d0a 2020 2020 2020 2020 2020  nsor..          
-00008970: 2020 4f75 7470 7574 206f 6620 7468 6520    Output of the 
-00008980: 666f 7277 6172 6420 7061 7373 206f 6620  forward pass of 
-00008990: 7468 6520 636f 6d70 7574 6174 696f 6e61  the computationa
-000089a0: 6c20 6772 6170 682e 0d0a 2020 2020 2020  l graph...      
-000089b0: 2020 2020 2020 5072 6564 6963 7469 6f6e        Prediction
-000089c0: 206f 6620 7468 6520 7461 7267 6574 2076   of the target v
-000089d0: 6172 6961 626c 652e 0d0a 2020 2020 2020  ariable...      
-000089e0: 2020 2222 220d 0a20 2020 2020 2020 2073    """..        s
-000089f0: 656c 662e 6b6d 2e74 7261 696e 6162 6c65  elf.km.trainable
-00008a00: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-00008a10: 2020 7072 696e 7428 2246 7265 657a 696e    print("Freezin
-00008a20: 6720 7468 6520 6465 636f 6465 7222 290d  g the decoder").
-00008a30: 0a20 2020 2020 2020 2023 2828 726f 7773  .        #((rows
-00008a40: 202d 2031 2920 2a20 7374 7269 6465 735b   - 1) * strides[
-00008a50: 305d 202b 206b 6572 6e65 6c5f 7369 7a65  0] + kernel_size
-00008a60: 5b30 5d20 2d20 3220 2a20 7061 6464 696e  [0] - 2 * paddin
-00008a70: 675b 305d 202b 206f 7574 7075 745f 7061  g[0] + output_pa
-00008a80: 6464 696e 675b 305d 290d 0a20 2020 2020  dding[0])..     
-00008a90: 2020 2069 6620 7365 6c66 2e64 6174 6173     if self.datas
-00008aa0: 6574 2e68 5f70 6172 616d 735b 276e 5f74  et.h_params['n_t
-00008ab0: 275d 2573 656c 662e 7370 6563 735b 2773  ']%self.specs['s
-00008ac0: 7472 6964 6527 5d20 3d3d 2030 3a0d 0a20  tride'] == 0:.. 
-00008ad0: 2020 2020 2020 2020 2020 2070 6164 6469             paddi
-00008ae0: 6e67 3d4e 6f6e 650d 0a20 2020 2020 2020  ng=None..       
-00008af0: 2065 6c69 6620 7365 6c66 2e64 6174 6173   elif self.datas
-00008b00: 6574 2e68 5f70 6172 616d 735b 276e 5f74  et.h_params['n_t
-00008b10: 275d 2573 656c 662e 7370 6563 735b 2773  ']%self.specs['s
-00008b20: 7472 6964 6527 5d20 2d20 3120 3e3d 2031  tride'] - 1 >= 1
-00008b30: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
-00008b40: 6164 6469 6e67 203d 2028 7365 6c66 2e64  adding = (self.d
-00008b50: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
-00008b60: 276e 5f74 275d 2573 656c 662e 7370 6563  'n_t']%self.spec
-00008b70: 735b 2773 7472 6964 6527 5d20 2d20 312c  s['stride'] - 1,
-00008b80: 2030 290d 0a20 2020 2020 2020 2065 6c73   0)..        els
-00008b90: 6520 3a0d 0a20 2020 2020 2020 2020 2020  e :..           
-00008ba0: 2070 6164 6469 6e67 203d 2028 2873 656c   padding = ((sel
-00008bb0: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
-00008bc0: 6d73 5b27 6e5f 7427 5d20 2d20 3129 2573  ms['n_t'] - 1)%s
-00008bd0: 656c 662e 7370 6563 735b 2773 7472 6964  elf.specs['strid
-00008be0: 6527 5d20 2c20 3029 0d0a 0d0a 0d0a 2020  e'] , 0)......  
-00008bf0: 2020 2020 2020 7072 696e 7428 7061 6464        print(padd
-00008c00: 696e 6729 0d0a 0d0a 0d0a 2020 2020 2020  ing)......      
-00008c10: 2020 2373 7461 7274 2077 6974 6820 7468    #start with th
-00008c20: 6520 6f75 7470 7574 206f 6620 6465 636f  e output of deco
-00008c30: 6465 720d 0a20 2020 2020 2020 2023 656c  der..        #el
-00008c40: 662e 656e 635f 696e 7075 7473 203d 206c  f.enc_inputs = l
-00008c50: 6179 6572 732e 496e 7075 7428 7365 6c66  ayers.Input(self
-00008c60: 2e79 5f73 6861 7065 290d 0a20 2020 2020  .y_shape)..     
-00008c70: 2020 2073 656c 662e 656e 635f 6663 203d     self.enc_fc =
-00008c80: 2046 756c 6c79 436f 6e6e 6563 7465 6428   FullyConnected(
-00008c90: 7369 7a65 3d73 656c 662e 6669 6e5f 6663  size=self.fin_fc
-00008ca0: 2e77 2e73 6861 7065 5b30 5d2c 206e 6f6e  .w.shape[0], non
-00008cb0: 6c69 6e3d 7466 2e69 6465 6e74 6974 792c  lin=tf.identity,
-00008cc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008cd0: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-00008ce0: 6563 733d 7365 6c66 2e73 7065 6373 290d  ecs=self.specs).
-00008cf0: 0a20 2020 2020 2020 2065 6e63 5f74 636f  .        enc_tco
-00008d00: 6e76 5f61 6374 6976 6174 696f 6e73 203d  nv_activations =
-00008d10: 2020 7365 6c66 2e65 6e63 5f66 6328 7365    self.enc_fc(se
-00008d20: 6c66 2e79 5f70 7265 6429 0d0a 2020 2020  lf.y_pred)..    
-00008d30: 2020 2020 656e 635f 7463 6f6e 765f 6163      enc_tconv_ac
-00008d40: 7469 7661 7469 6f6e 735f 7220 3d20 7466  tivations_r = tf
-00008d50: 2e72 6573 6861 7065 2865 6e63 5f74 636f  .reshape(enc_tco
-00008d60: 6e76 5f61 6374 6976 6174 696f 6e73 2c0d  nv_activations,.
-00008d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d90: 2020 2020 2020 2020 2020 2020 2020 5b2d                [-
-00008da0: 312c 2031 2c20 7365 6c66 2e70 6f6f 6c65  1, 1, self.poole
-00008db0: 642e 7368 6170 655b 2d32 5d2c 0d0a 2020  d.shape[-2],..  
-00008dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008de0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008df0: 7370 6563 735b 276e 5f6c 6174 656e 7427  specs['n_latent'
-00008e00: 5d5d 290d 0a20 2020 2020 2020 2070 7269  ]])..        pri
-00008e10: 6e74 2865 6e63 5f74 636f 6e76 5f61 6374  nt(enc_tconv_act
-00008e20: 6976 6174 696f 6e73 5f72 2e73 6861 7065  ivations_r.shape
-00008e30: 290d 0a20 2020 2020 2020 2065 6e63 5f64  )..        enc_d
-00008e40: 726f 706f 7574 203d 2044 726f 706f 7574  ropout = Dropout
-00008e50: 2873 656c 662e 7370 6563 735b 2764 726f  (self.specs['dro
-00008e60: 706f 7574 275d 2c0d 0a20 2020 2020 2020  pout'],..       
-00008e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e80: 2020 206e 6f69 7365 5f73 6861 7065 3d4e     noise_shape=N
-00008e90: 6f6e 6529 2865 6e63 5f74 636f 6e76 5f61  one)(enc_tconv_a
-00008ea0: 6374 6976 6174 696f 6e73 5f72 290d 0a20  ctivations_r).. 
-00008eb0: 2020 2020 2020 2023 7570 6f6f 6c20 616e         #upool an
-00008ec0: 6420 6170 706c 7920 7472 616e 7370 6f73  d apply transpos
-00008ed0: 6564 2064 6570 7468 7769 7365 2063 6f6e  ed depthwise con
-00008ee0: 766f 6c75 7469 6f6e 0d0a 2020 2020 2020  volution..      
-00008ef0: 2020 2320 7365 6c66 2e65 6e63 5f74 636f    # self.enc_tco
-00008f00: 6e76 5f74 7261 6e73 203d 204c 4654 436f  nv_trans = LFTCo
-00008f10: 6e76 5472 616e 7370 6f73 6531 2866 696c  nvTranspose1(fil
-00008f20: 7465 7273 3d73 656c 662e 7463 6f6e 762e  ters=self.tconv.
-00008f30: 6669 6c74 6572 732c 0d0a 2020 2020 2020  filters,..      
-00008f40: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+000086c0: 206e 6f6e 6c69 6e3d 7365 6c66 2e73 7065   nonlin=self.spe
+000086d0: 6373 5b27 6e6f 6e6c 696e 275d 2c0d 0a20  cs['nonlin'],.. 
+000086e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000086f0: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
+00008700: 6572 5f6c 656e 6774 683d 7365 6c66 2e73  er_length=self.s
+00008710: 7065 6373 5b27 6669 6c74 6572 5f6c 656e  pecs['filter_len
+00008720: 6774 6827 5d2c 0d0a 2020 2020 2020 2020  gth'],..        
+00008730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008740: 2020 2020 2070 6164 6469 6e67 3d73 656c       padding=sel
+00008750: 662e 7370 6563 735b 2770 6164 6469 6e67  f.specs['padding
+00008760: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
+00008770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008780: 2020 7370 6563 733d 7365 6c66 2e73 7065    specs=self.spe
+00008790: 6373 0d0a 2020 2020 2020 2020 2020 2020  cs..            
+000087a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000087b0: 2029 0d0a 2020 2020 2020 2020 7365 6c66   )..        self
+000087c0: 2e74 636f 6e76 5f6f 7574 203d 2073 656c  .tconv_out = sel
+000087d0: 662e 7463 6f6e 7628 7365 6c66 2e64 6d78  f.tconv(self.dmx
+000087e0: 5f6f 7574 290d 0a0d 0a20 2020 2020 2020  _out)....       
+000087f0: 2073 656c 662e 706f 6f6c 203d 2054 656d   self.pool = Tem
+00008800: 7050 6f6f 6c69 6e67 2870 6f6f 6c69 6e67  pPooling(pooling
+00008810: 3d73 656c 662e 7370 6563 735b 2770 6f6f  =self.specs['poo
+00008820: 6c69 6e67 275d 2c0d 0a20 2020 2020 2020  ling'],..       
+00008830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008840: 2020 2020 2020 2020 2020 2070 6f6f 6c5f             pool_
+00008850: 7479 7065 3d73 656c 662e 7370 6563 735b  type=self.specs[
+00008860: 2770 6f6f 6c5f 7479 7065 275d 2c0d 0a20  'pool_type'],.. 
+00008870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008890: 2073 7472 6964 653d 7365 6c66 2e73 7065   stride=self.spe
+000088a0: 6373 5b27 7374 7269 6465 275d 2c0d 0a20  cs['stride'],.. 
+000088b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000088c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000088d0: 2070 6164 6469 6e67 3d27 5341 4d45 272c   padding='SAME',
+000088e0: 2373 656c 662e 7370 6563 735b 2770 6164  #self.specs['pad
+000088f0: 6469 6e67 275d 0d0a 2020 2020 2020 2020  ding']..        
+00008900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008910: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00008920: 2020 2020 2073 656c 662e 706f 6f6c 6564       self.pooled
+00008930: 203d 2073 656c 662e 706f 6f6c 2873 656c   = self.pool(sel
+00008940: 662e 7463 6f6e 765f 6f75 7429 0d0a 0d0a  f.tconv_out)....
+00008950: 2020 2020 2020 2020 7365 6c66 2e64 726f          self.dro
+00008960: 706f 7574 203d 2044 726f 706f 7574 2873  pout = Dropout(s
+00008970: 656c 662e 7370 6563 735b 2764 726f 706f  elf.specs['dropo
+00008980: 7574 275d 2c0d 0a20 2020 2020 2020 2020  ut'],..         
+00008990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000089a0: 206e 6f69 7365 5f73 6861 7065 3d4e 6f6e   noise_shape=Non
+000089b0: 6529 2873 656c 662e 706f 6f6c 6564 290d  e)(self.pooled).
+000089c0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+000089d0: 6669 6e5f 6663 203d 2046 756c 6c79 436f  fin_fc = FullyCo
+000089e0: 6e6e 6563 7465 6428 7369 7a65 3d73 656c  nnected(size=sel
+000089f0: 662e 6f75 745f 6469 6d2c 206e 6f6e 6c69  f.out_dim, nonli
+00008a00: 6e3d 7466 2e69 6465 6e74 6974 792c 0d0a  n=tf.identity,..
+00008a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008a20: 2020 2020 2020 2020 2020 2020 7370 6563              spec
+00008a30: 733d 7365 6c66 2e73 7065 6373 290d 0a0d  s=self.specs)...
+00008a40: 0a20 2020 2020 2020 2079 5f70 7265 6420  .        y_pred 
+00008a50: 3d20 7365 6c66 2e66 696e 5f66 6328 7365  = self.fin_fc(se
+00008a60: 6c66 2e64 726f 706f 7574 290d 0a0d 0a20  lf.dropout).... 
+00008a70: 2020 2020 2020 2072 6574 7572 6e20 795f         return y_
+00008a80: 7072 6564 0d0a 0d0a 2020 2020 6465 6620  pred....    def 
+00008a90: 6275 696c 645f 656e 636f 6465 7228 7365  build_encoder(se
+00008aa0: 6c66 293a 0d0a 2020 2020 2020 2020 2222  lf):..        ""
+00008ab0: 2242 7569 6c64 2063 6f6d 7075 7461 7469  "Build computati
+00008ac0: 6f6e 616c 2067 7261 7068 2066 6f72 2061  onal graph for a
+00008ad0: 6e20 696e 7465 7270 7265 7461 626c 6520  n interpretable 
+00008ae0: 4765 6e65 7261 746f 720d 0a0d 0a20 2020  Generator....   
+00008af0: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
+00008b00: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0d0a        --------..
+00008b10: 2020 2020 2020 2020 795f 7072 6564 203a          y_pred :
+00008b20: 2074 662e 5465 6e73 6f72 0d0a 2020 2020   tf.Tensor..    
+00008b30: 2020 2020 2020 2020 4f75 7470 7574 206f          Output o
+00008b40: 6620 7468 6520 666f 7277 6172 6420 7061  f the forward pa
+00008b50: 7373 206f 6620 7468 6520 636f 6d70 7574  ss of the comput
+00008b60: 6174 696f 6e61 6c20 6772 6170 682e 0d0a  ational graph...
+00008b70: 2020 2020 2020 2020 2020 2020 5072 6564              Pred
+00008b80: 6963 7469 6f6e 206f 6620 7468 6520 7461  iction of the ta
+00008b90: 7267 6574 2076 6172 6961 626c 652e 0d0a  rget variable...
+00008ba0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00008bb0: 2020 2020 2073 656c 662e 6b6d 2e74 7261       self.km.tra
+00008bc0: 696e 6162 6c65 203d 2046 616c 7365 0d0a  inable = False..
+00008bd0: 2020 2020 2020 2020 7072 696e 7428 2246          print("F
+00008be0: 7265 657a 696e 6720 7468 6520 6465 636f  reezing the deco
+00008bf0: 6465 7222 290d 0a20 2020 2020 2020 2023  der")..        #
+00008c00: 2828 726f 7773 202d 2031 2920 2a20 7374  ((rows - 1) * st
+00008c10: 7269 6465 735b 305d 202b 206b 6572 6e65  rides[0] + kerne
+00008c20: 6c5f 7369 7a65 5b30 5d20 2d20 3220 2a20  l_size[0] - 2 * 
+00008c30: 7061 6464 696e 675b 305d 202b 206f 7574  padding[0] + out
+00008c40: 7075 745f 7061 6464 696e 675b 305d 290d  put_padding[0]).
+00008c50: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00008c60: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
+00008c70: 735b 276e 5f74 275d 2573 656c 662e 7370  s['n_t']%self.sp
+00008c80: 6563 735b 2773 7472 6964 6527 5d20 3d3d  ecs['stride'] ==
+00008c90: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00008ca0: 2070 6164 6469 6e67 3d4e 6f6e 650d 0a20   padding=None.. 
+00008cb0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00008cc0: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
+00008cd0: 735b 276e 5f74 275d 2573 656c 662e 7370  s['n_t']%self.sp
+00008ce0: 6563 735b 2773 7472 6964 6527 5d20 2d20  ecs['stride'] - 
+00008cf0: 3120 3e20 303a 0d0a 2020 2020 2020 2020  1 > 0:..        
+00008d00: 2020 2020 7061 6464 696e 6720 3d20 2873      padding = (s
+00008d10: 656c 662e 6461 7461 7365 742e 685f 7061  elf.dataset.h_pa
+00008d20: 7261 6d73 5b27 6e5f 7427 5d25 7365 6c66  rams['n_t']%self
+00008d30: 2e73 7065 6373 5b27 7374 7269 6465 275d  .specs['stride']
+00008d40: 202d 2031 2c20 3029 0d0a 2020 2020 2020   - 1, 0)..      
+00008d50: 2020 656c 7365 203a 0d0a 2020 2020 2020    else :..      
+00008d60: 2020 2020 2020 7061 6464 696e 6720 3d20        padding = 
+00008d70: 2828 7365 6c66 2e64 6174 6173 6574 2e68  ((self.dataset.h
+00008d80: 5f70 6172 616d 735b 276e 5f74 275d 202d  _params['n_t'] -
+00008d90: 2031 2925 7365 6c66 2e73 7065 6373 5b27   1)%self.specs['
+00008da0: 7374 7269 6465 275d 202c 2030 290d 0a0d  stride'] , 0)...
+00008db0: 0a0d 0a20 2020 2020 2020 2070 7269 6e74  ...        print
+00008dc0: 2870 6164 6469 6e67 290d 0a0d 0a0d 0a20  (padding)...... 
+00008dd0: 2020 2020 2020 2023 7374 6172 7420 7769         #start wi
+00008de0: 7468 2074 6865 206f 7574 7075 7420 6f66  th the output of
+00008df0: 2064 6563 6f64 6572 0d0a 2020 2020 2020   decoder..      
+00008e00: 2020 2365 6c66 2e65 6e63 5f69 6e70 7574    #elf.enc_input
+00008e10: 7320 3d20 6c61 7965 7273 2e49 6e70 7574  s = layers.Input
+00008e20: 2873 656c 662e 795f 7368 6170 6529 0d0a  (self.y_shape)..
+00008e30: 2020 2020 2020 2020 7365 6c66 2e65 6e63          self.enc
+00008e40: 5f66 6320 3d20 4675 6c6c 7943 6f6e 6e65  _fc = FullyConne
+00008e50: 6374 6564 2873 697a 653d 7365 6c66 2e66  cted(size=self.f
+00008e60: 696e 5f66 632e 772e 7368 6170 655b 305d  in_fc.w.shape[0]
+00008e70: 2c20 6e6f 6e6c 696e 3d74 662e 6964 656e  , nonlin=tf.iden
+00008e80: 7469 7479 2c0d 0a20 2020 2020 2020 2020  tity,..         
+00008e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ea0: 2020 2073 7065 6373 3d73 656c 662e 7370     specs=self.sp
+00008eb0: 6563 7329 0d0a 2020 2020 2020 2020 656e  ecs)..        en
+00008ec0: 635f 7463 6f6e 765f 6163 7469 7661 7469  c_tconv_activati
+00008ed0: 6f6e 7320 3d20 2073 656c 662e 656e 635f  ons =  self.enc_
+00008ee0: 6663 2873 656c 662e 795f 7072 6564 290d  fc(self.y_pred).
+00008ef0: 0a20 2020 2020 2020 2065 6e63 5f74 636f  .        enc_tco
+00008f00: 6e76 5f61 6374 6976 6174 696f 6e73 5f72  nv_activations_r
+00008f10: 203d 2074 662e 7265 7368 6170 6528 656e   = tf.reshape(en
+00008f20: 635f 7463 6f6e 765f 6163 7469 7661 7469  c_tconv_activati
+00008f30: 6f6e 732c 0d0a 2020 2020 2020 2020 2020  ons,..          
+00008f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00008f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f60: 2020 2020 2020 206b 6572 6e65 6c5f 7369         kernel_si
-00008f70: 7a65 3d20 7365 6c66 2e73 7065 6373 5b27  ze= self.specs['
-00008f80: 6669 6c74 6572 5f6c 656e 6774 6827 5d2c  filter_length'],
-00008f90: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
+00008f60: 2020 205b 2d31 2c20 312c 2073 656c 662e     [-1, 1, self.
+00008f70: 706f 6f6c 6564 2e73 6861 7065 5b2d 325d  pooled.shape[-2]
+00008f80: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00008f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00008fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008fb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00008fc0: 7472 6964 653d 7365 6c66 2e73 7065 6373  tride=self.specs
-00008fd0: 5b27 7374 7269 6465 275d 2c0d 0a20 2020  ['stride'],..   
-00008fe0: 2020 2020 2023 2020 2020 2020 2020 2020       #          
-00008ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009000: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-00009010: 5f70 6164 6469 6e67 3d6e 5f70 6164 6469  _padding=n_paddi
-00009020: 6e67 290d 0a20 2020 2020 2020 2023 6e5f  ng)..        #n_
-00009030: 7061 6464 696e 670d 0a20 2020 2020 2020  padding..       
-00009040: 2073 656c 662e 656e 635f 7463 6f6e 765f   self.enc_tconv_
-00009050: 7472 616e 733d 7466 2e6b 6572 6173 2e6c  trans=tf.keras.l
-00009060: 6179 6572 732e 436f 6e76 3244 5472 616e  ayers.Conv2DTran
-00009070: 7370 6f73 6528 0d0a 2020 2020 2020 2020  spose(..        
-00009080: 2020 2020 6669 6c74 6572 733d 312c 0d0a      filters=1,..
-00009090: 2020 2020 2020 2020 2020 2020 6b65 726e              kern
-000090a0: 656c 5f73 697a 653d 2873 656c 662e 7370  el_size=(self.sp
-000090b0: 6563 735b 2766 696c 7465 725f 6c65 6e67  ecs['filter_leng
-000090c0: 7468 275d 2c20 7365 6c66 2e73 7065 6373  th'], self.specs
-000090d0: 5b27 6e5f 6c61 7465 6e74 275d 292c 0d0a  ['n_latent']),..
-000090e0: 2020 2020 2020 2020 2020 2020 7374 7269              stri
-000090f0: 6465 733d 2873 656c 662e 7370 6563 735b  des=(self.specs[
-00009100: 2773 7472 6964 6527 5d2c 2031 292c 0d0a  'stride'], 1),..
-00009110: 2020 2020 2020 2020 2020 2020 7061 6464              padd
-00009120: 696e 673d 2773 616d 6527 2c0d 0a20 2020  ing='same',..   
-00009130: 2020 2020 2020 2020 206f 7574 7075 745f           output_
-00009140: 7061 6464 696e 673d 7061 6464 696e 672c  padding=padding,
-00009150: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
-00009160: 7461 5f66 6f72 6d61 743d 2763 6861 6e6e  ta_format='chann
-00009170: 656c 735f 6669 7273 7427 2c0d 0a20 2020  els_first',..   
-00009180: 2020 2020 2020 2020 2064 696c 6174 696f           dilatio
-00009190: 6e5f 7261 7465 3d28 312c 2031 292c 0d0a  n_rate=(1, 1),..
-000091a0: 2020 2020 2020 2020 2020 2020 6163 7469              acti
-000091b0: 7661 7469 6f6e 3d4e 6f6e 652c 0d0a 2020  vation=None,..  
-000091c0: 2020 2020 2020 2020 2020 7573 655f 6269            use_bi
-000091d0: 6173 3d46 616c 7365 2c0d 0a20 2020 2020  as=False,..     
-000091e0: 2020 2020 2020 206b 6572 6e65 6c5f 696e         kernel_in
-000091f0: 6974 6961 6c69 7a65 723d 2767 6c6f 726f  itializer='gloro
-00009200: 745f 756e 6966 6f72 6d27 2c0d 0a20 2020  t_uniform',..   
-00009210: 2020 2020 2020 2020 2062 6961 735f 696e           bias_in
-00009220: 6974 6961 6c69 7a65 723d 277a 6572 6f73  itializer='zeros
-00009230: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-00009240: 6b65 726e 656c 5f72 6567 756c 6172 697a  kernel_regulariz
-00009250: 6572 3d74 662e 6b65 7261 732e 7265 6775  er=tf.keras.regu
-00009260: 6c61 7269 7a65 7273 2e6c 3128 7365 6c66  larizers.l1(self
-00009270: 2e73 7065 6373 5b27 6c31 5f6c 616d 6264  .specs['l1_lambd
-00009280: 6127 5d29 2c0d 0a20 2020 2020 2020 2020  a']),..         
-00009290: 2020 2062 6961 735f 7265 6775 6c61 7269     bias_regulari
-000092a0: 7a65 723d 4e6f 6e65 2c0d 0a20 2020 2020  zer=None,..     
-000092b0: 2020 2020 2020 2061 6374 6976 6974 795f         activity_
-000092c0: 7265 6775 6c61 7269 7a65 723d 4e6f 6e65  regularizer=None
-000092d0: 2c0d 0a20 2020 2020 2020 2020 2020 206b  ,..            k
-000092e0: 6572 6e65 6c5f 636f 6e73 7472 6169 6e74  ernel_constraint
-000092f0: 3d74 662e 6b65 7261 732e 636f 6e73 7472  =tf.keras.constr
-00009300: 6169 6e74 732e 556e 6974 4e6f 726d 2861  aints.UnitNorm(a
-00009310: 7869 733d 3029 2c0d 0a20 2020 2020 2020  xis=0),..       
-00009320: 2020 2020 2062 6961 735f 636f 6e73 7472       bias_constr
-00009330: 6169 6e74 3d4e 6f6e 652c 0d0a 2020 2020  aint=None,..    
-00009340: 2020 2020 290d 0a0d 0a0d 0a20 2020 2020      )......     
-00009350: 2020 2065 6e63 5f64 6563 6f6e 7620 3d20     enc_deconv = 
-00009360: 7365 6c66 2e65 6e63 5f74 636f 6e76 5f74  self.enc_tconv_t
-00009370: 7261 6e73 2865 6e63 5f64 726f 706f 7574  rans(enc_dropout
-00009380: 290d 0a20 2020 2020 2020 2023 656e 635f  )..        #enc_
-00009390: 6465 636f 6e76 203d 2074 662e 7472 616e  deconv = tf.tran
-000093a0: 7370 6f73 6528 656e 635f 6465 636f 6e76  spose(enc_deconv
-000093b0: 2c20 7065 726d 3d5b 302c 332c 312c 325d  , perm=[0,3,1,2]
-000093c0: 290d 0a20 2020 2020 2020 2070 7269 6e74  )..        print
-000093d0: 2822 456e 635f 6465 636f 6e76 3a22 2c20  ("Enc_deconv:", 
-000093e0: 656e 635f 6465 636f 6e76 2e73 6861 7065  enc_deconv.shape
-000093f0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-00009400: 662e 6465 5f64 6d78 203d 2044 654d 6978  f.de_dmx = DeMix
-00009410: 696e 6728 7369 7a65 3d73 656c 662e 6461  ing(size=self.da
-00009420: 7461 7365 742e 685f 7061 7261 6d73 5b27  taset.h_params['
-00009430: 6e5f 6368 275d 2c20 6e6f 6e6c 696e 3d74  n_ch'], nonlin=t
-00009440: 662e 6964 656e 7469 7479 2c0d 0a20 2020  f.identity,..   
-00009450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009460: 2020 2020 2020 2020 2061 7869 733d 332c           axis=3,
-00009470: 2073 7065 6373 3d73 656c 662e 7370 6563   specs=self.spec
-00009480: 7329 0d0a 0d0a 2020 2020 2020 2020 7365  s)....        se
-00009490: 6c66 2e58 5f70 7265 6420 3d20 7365 6c66  lf.X_pred = self
-000094a0: 2e64 655f 646d 7828 656e 635f 6465 636f  .de_dmx(enc_deco
-000094b0: 6e76 290d 0a20 2020 2020 2020 2070 7269  nv)..        pri
-000094c0: 6e74 2873 656c 662e 585f 7072 6564 2e73  nt(self.X_pred.s
-000094d0: 6861 7065 290d 0a20 2020 2020 2020 2073  hape)..        s
-000094e0: 656c 662e 6b6d 5f65 6e63 203d 2074 662e  elf.km_enc = tf.
-000094f0: 6b65 7261 732e 4d6f 6465 6c28 696e 7075  keras.Model(inpu
-00009500: 7473 3d73 656c 662e 696e 7075 7473 2c20  ts=self.inputs, 
-00009510: 6f75 7470 7574 733d 7365 6c66 2e58 5f70  outputs=self.X_p
-00009520: 7265 6429 0d0a 0d0a 2020 2020 2020 2020  red)....        
-00009530: 7365 6c66 2e70 6172 616d 735b 2765 6e63  self.params['enc
-00009540: 5f6c 6f73 7327 5d20 3d20 5b74 662e 6b65  _loss'] = [tf.ke
-00009550: 7261 732e 6c6f 7373 6573 2e4d 4145 5d23  ras.losses.MAE]#
-00009560: 7466 2e72 6564 7563 655f 6d65 616e 2828  tf.reduce_mean((
-00009570: 7365 6c66 2e58 5f70 7265 6420 2d20 7365  self.X_pred - se
-00009580: 6c66 2e69 6e70 7574 7329 2a2a 3229 0d0a  lf.inputs)**2)..
-00009590: 2020 2020 2020 2020 2373 656c 662e 7061          #self.pa
-000095a0: 7261 6d73 5b27 656e 635f 6d65 7472 6963  rams['enc_metric
-000095b0: 7327 5d20 3d20 7466 2e6b 6572 6173 2e6d  s'] = tf.keras.m
-000095c0: 6574 7269 6373 2e52 6f6f 744d 6561 6e53  etrics.RootMeanS
-000095d0: 7175 6172 6564 4572 726f 7228 6e61 6d65  quaredError(name
-000095e0: 3d22 524d 5345 2229 0d0a 0d0a 0d0a 2020  ="RMSE")......  
-000095f0: 2020 2020 2020 2370 7269 6e74 2870 6172        #print(par
-00009600: 616d 7329 0d0a 2020 2020 2020 2020 7365  ams)..        se
-00009610: 6c66 2e6b 6d5f 656e 632e 636f 6d70 696c  lf.km_enc.compil
-00009620: 6528 6f70 7469 6d69 7a65 723d 7466 2e6b  e(optimizer=tf.k
-00009630: 6572 6173 2e6f 7074 696d 697a 6572 732e  eras.optimizers.
-00009640: 6c65 6761 6379 2e41 6461 6d28 292c 0d0a  legacy.Adam(),..
-00009650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009660: 2020 2020 2020 2020 6c6f 7373 3d73 656c          loss=sel
-00009670: 662e 7061 7261 6d73 5b27 656e 635f 6c6f  f.params['enc_lo
-00009680: 7373 275d 290d 0a0d 0a20 2020 2064 6566  ss'])....    def
-00009690: 2063 6f6d 7075 7465 5f65 6e63 5f70 6174   compute_enc_pat
-000096a0: 7465 726e 7328 7365 6c66 2c20 696e 7075  terns(self, inpu
-000096b0: 7473 3d4e 6f6e 6529 3a0d 0a20 2020 2020  ts=None):..     
-000096c0: 2020 2022 2222 0d0a 0d0a 2020 2020 2020     """....      
-000096d0: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
-000096e0: 6620 6e6f 7420 6e70 2e61 6e79 2869 6e70  f not np.any(inp
-000096f0: 7574 7329 3a0d 0a20 2020 2020 2020 2020  uts):..         
-00009700: 2020 2070 7269 6e74 2827 5573 696e 6720     print('Using 
-00009710: 6661 6b65 2069 6e70 7574 7327 290d 0a20  fake inputs').. 
-00009720: 2020 2020 2020 2020 2020 2069 6e70 7574             input
-00009730: 7320 3d20 6e70 2e69 6465 6e74 6974 7928  s = np.identity(
-00009740: 7365 6c66 2e6f 7574 5f64 696d 290d 0a20  self.out_dim).. 
-00009750: 2020 2020 2020 2070 6f6f 6c65 6420 3d20         pooled = 
-00009760: 7466 2e72 6573 6861 7065 2873 656c 662e  tf.reshape(self.
-00009770: 656e 635f 6663 2869 6e70 7574 7329 2c0d  enc_fc(inputs),.
-00009780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009790: 2020 2020 5b73 656c 662e 6f75 745f 6469      [self.out_di
-000097a0: 6d2c 0d0a 2020 2020 2020 2020 2020 2020  m,..            
-000097b0: 2020 2020 2020 2020 312c 0d0a 2020 2020          1,..    
-000097c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000097d0: 7365 6c66 2e70 6f6f 6c65 642e 7368 6170  self.pooled.shap
-000097e0: 655b 2d32 5d2c 0d0a 2020 2020 2020 2020  e[-2],..        
-000097f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00009800: 2e73 7065 6373 5b27 6e5f 6c61 7465 6e74  .specs['n_latent
-00009810: 275d 5d29 0d0a 2020 2020 2020 2020 756e  ']])..        un
-00009820: 706f 6f6c 6564 5f77 6673 203d 2073 656c  pooled_wfs = sel
-00009830: 662e 656e 635f 7463 6f6e 765f 7472 616e  f.enc_tconv_tran
-00009840: 7328 706f 6f6c 6564 290d 0a20 2020 2020  s(pooled)..     
-00009850: 2020 2070 6174 7465 726e 7320 3d20 7365     patterns = se
-00009860: 6c66 2e64 655f 646d 7828 756e 706f 6f6c  lf.de_dmx(unpool
-00009870: 6564 5f77 6673 290d 0a0d 0a20 2020 2020  ed_wfs)....     
-00009880: 2020 2072 6574 7572 6e20 6e70 2e73 7175     return np.squ
-00009890: 6565 7a65 2870 6174 7465 726e 7329 2c20  eeze(patterns), 
-000098a0: 756e 706f 6f6c 6564 5f77 6673 0d0a 0d0a  unpooled_wfs....
-000098b0: 2020 2020 6465 6620 7472 6169 6e5f 656e      def train_en
-000098c0: 636f 6465 7228 7365 6c66 2c20 6e5f 6570  coder(self, n_ep
-000098d0: 6f63 6873 2c20 6576 616c 5f73 7465 703d  ochs, eval_step=
-000098e0: 4e6f 6e65 2c20 6d69 6e5f 6465 6c74 613d  None, min_delta=
-000098f0: 3165 2d36 2c0d 0a20 2020 2020 2020 2020  1e-6,..         
-00009900: 2020 2020 2065 6172 6c79 5f73 746f 7070       early_stopp
-00009910: 696e 673d 332c 2063 6f6c 6c65 6374 5f70  ing=3, collect_p
-00009920: 6174 7465 726e 733d 4661 6c73 6529 3a0d  atterns=False):.
-00009930: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
-00009940: 5f74 7261 696e 203d 2073 656c 662e 6461  _train = self.da
-00009950: 7461 7365 742e 7472 6169 6e2e 6d61 7028  taset.train.map(
-00009960: 6c61 6d62 6461 2078 2c20 7920 3a20 2878  lambda x, y : (x
-00009970: 2c20 7829 290d 0a20 2020 2020 2020 2064  , x))..        d
-00009980: 6174 6173 6574 5f76 616c 203d 2073 656c  ataset_val = sel
-00009990: 662e 6461 7461 7365 742e 7661 6c2e 6d61  f.dataset.val.ma
-000099a0: 7028 6c61 6d62 6461 2078 2c20 7920 3a20  p(lambda x, y : 
-000099b0: 2878 2c20 7829 290d 0a20 2020 2020 2020  (x, x))..       
-000099c0: 2073 746f 705f 6561 726c 7920 3d20 7466   stop_early = tf
-000099d0: 2e6b 6572 6173 2e63 616c 6c62 6163 6b73  .keras.callbacks
-000099e0: 2e45 6172 6c79 5374 6f70 7069 6e67 286d  .EarlyStopping(m
-000099f0: 6f6e 6974 6f72 3d27 7661 6c5f 6c6f 7373  onitor='val_loss
-00009a00: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-00009a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a30: 2020 2020 2020 2020 2020 6d69 6e5f 6465            min_de
-00009a40: 6c74 613d 6d69 6e5f 6465 6c74 612c 0d0a  lta=min_delta,..
-00009a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a80: 2020 2020 2020 7061 7469 656e 6365 3d65        patience=e
-00009a90: 6172 6c79 5f73 746f 7070 696e 672c 0d0a  arly_stopping,..
-00009aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ad0: 2020 2020 2020 7265 7374 6f72 655f 6265        restore_be
-00009ae0: 7374 5f77 6569 6768 7473 3d54 7275 6529  st_weights=True)
-00009af0: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
-00009b00: 5f68 6973 7420 3d20 7365 6c66 2e6b 6d5f  _hist = self.km_
-00009b10: 656e 632e 6669 7428 6461 7461 7365 745f  enc.fit(dataset_
-00009b20: 7472 6169 6e2c 0d0a 2020 2020 2020 2020  train,..        
-00009b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b40: 2020 2020 2020 2020 2020 2076 616c 6964             valid
-00009b50: 6174 696f 6e5f 6461 7461 3d64 6174 6173  ation_data=datas
-00009b60: 6574 5f76 616c 2c0d 0a20 2020 2020 2020  et_val,..       
-00009b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b80: 2020 2020 2020 2020 2020 2020 6570 6f63              epoc
-00009b90: 6873 3d6e 5f65 706f 6368 732c 2073 7465  hs=n_epochs, ste
-00009ba0: 7073 5f70 6572 5f65 706f 6368 3d65 7661  ps_per_epoch=eva
-00009bb0: 6c5f 7374 6570 2c0d 0a20 2020 2020 2020  l_step,..       
-00009bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bd0: 2020 2020 2020 2020 2020 2020 7368 7566              shuf
-00009be0: 666c 653d 5472 7565 2c0d 0a20 2020 2020  fle=True,..     
+00008fb0: 7365 6c66 2e73 7065 6373 5b27 6e5f 6c61  self.specs['n_la
+00008fc0: 7465 6e74 275d 5d29 0d0a 2020 2020 2020  tent']])..      
+00008fd0: 2020 7072 696e 7428 656e 635f 7463 6f6e    print(enc_tcon
+00008fe0: 765f 6163 7469 7661 7469 6f6e 735f 722e  v_activations_r.
+00008ff0: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
+00009000: 656e 635f 6472 6f70 6f75 7420 3d20 4472  enc_dropout = Dr
+00009010: 6f70 6f75 7428 7365 6c66 2e73 7065 6373  opout(self.specs
+00009020: 5b27 6472 6f70 6f75 7427 5d2c 0d0a 2020  ['dropout'],..  
+00009030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009040: 2020 2020 2020 2020 6e6f 6973 655f 7368          noise_sh
+00009050: 6170 653d 4e6f 6e65 2928 656e 635f 7463  ape=None)(enc_tc
+00009060: 6f6e 765f 6163 7469 7661 7469 6f6e 735f  onv_activations_
+00009070: 7229 0d0a 2020 2020 2020 2020 2375 706f  r)..        #upo
+00009080: 6f6c 2061 6e64 2061 7070 6c79 2074 7261  ol and apply tra
+00009090: 6e73 706f 7365 6420 6465 7074 6877 6973  nsposed depthwis
+000090a0: 6520 636f 6e76 6f6c 7574 696f 6e0d 0a20  e convolution.. 
+000090b0: 2020 2020 2020 2023 2073 656c 662e 656e         # self.en
+000090c0: 635f 7463 6f6e 765f 7472 616e 7320 3d20  c_tconv_trans = 
+000090d0: 4c46 5443 6f6e 7654 7261 6e73 706f 7365  LFTConvTranspose
+000090e0: 3128 6669 6c74 6572 733d 7365 6c66 2e74  1(filters=self.t
+000090f0: 636f 6e76 2e66 696c 7465 7273 2c0d 0a20  conv.filters,.. 
+00009100: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+00009110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009120: 2020 2020 2020 2020 2020 2020 6b65 726e              kern
+00009130: 656c 5f73 697a 653d 2073 656c 662e 7370  el_size= self.sp
+00009140: 6563 735b 2766 696c 7465 725f 6c65 6e67  ecs['filter_leng
+00009150: 7468 275d 2c0d 0a20 2020 2020 2020 2023  th'],..        #
+00009160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009180: 2020 2020 7374 7269 6465 3d73 656c 662e      stride=self.
+00009190: 7370 6563 735b 2773 7472 6964 6527 5d2c  specs['stride'],
+000091a0: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
+000091b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000091c0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000091d0: 7574 7075 745f 7061 6464 696e 673d 6e5f  utput_padding=n_
+000091e0: 7061 6464 696e 6729 0d0a 2020 2020 2020  padding)..      
+000091f0: 2020 236e 5f70 6164 6469 6e67 0d0a 2020    #n_padding..  
+00009200: 2020 2020 2020 7365 6c66 2e65 6e63 5f74        self.enc_t
+00009210: 636f 6e76 5f74 7261 6e73 3d74 662e 6b65  conv_trans=tf.ke
+00009220: 7261 732e 6c61 7965 7273 2e43 6f6e 7632  ras.layers.Conv2
+00009230: 4454 7261 6e73 706f 7365 280d 0a20 2020  DTranspose(..   
+00009240: 2020 2020 2020 2020 2066 696c 7465 7273           filters
+00009250: 3d31 2c0d 0a20 2020 2020 2020 2020 2020  =1,..           
+00009260: 206b 6572 6e65 6c5f 7369 7a65 3d28 7365   kernel_size=(se
+00009270: 6c66 2e73 7065 6373 5b27 6669 6c74 6572  lf.specs['filter
+00009280: 5f6c 656e 6774 6827 5d2c 2073 656c 662e  _length'], self.
+00009290: 7370 6563 735b 276e 5f6c 6174 656e 7427  specs['n_latent'
+000092a0: 5d29 2c0d 0a20 2020 2020 2020 2020 2020  ]),..           
+000092b0: 2073 7472 6964 6573 3d28 7365 6c66 2e73   strides=(self.s
+000092c0: 7065 6373 5b27 7374 7269 6465 275d 2c20  pecs['stride'], 
+000092d0: 3129 2c0d 0a20 2020 2020 2020 2020 2020  1),..           
+000092e0: 2070 6164 6469 6e67 3d27 7361 6d65 272c   padding='same',
+000092f0: 0d0a 2020 2020 2020 2020 2020 2020 6f75  ..            ou
+00009300: 7470 7574 5f70 6164 6469 6e67 3d70 6164  tput_padding=pad
+00009310: 6469 6e67 2c0d 0a20 2020 2020 2020 2020  ding,..         
+00009320: 2020 2064 6174 615f 666f 726d 6174 3d27     data_format='
+00009330: 6368 616e 6e65 6c73 5f66 6972 7374 272c  channels_first',
+00009340: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
+00009350: 6c61 7469 6f6e 5f72 6174 653d 2831 2c20  lation_rate=(1, 
+00009360: 3129 2c0d 0a20 2020 2020 2020 2020 2020  1),..           
+00009370: 2061 6374 6976 6174 696f 6e3d 4e6f 6e65   activation=None
+00009380: 2c0d 0a20 2020 2020 2020 2020 2020 2075  ,..            u
+00009390: 7365 5f62 6961 733d 4661 6c73 652c 0d0a  se_bias=False,..
+000093a0: 2020 2020 2020 2020 2020 2020 6b65 726e              kern
+000093b0: 656c 5f69 6e69 7469 616c 697a 6572 3d27  el_initializer='
+000093c0: 676c 6f72 6f74 5f75 6e69 666f 726d 272c  glorot_uniform',
+000093d0: 0d0a 2020 2020 2020 2020 2020 2020 6269  ..            bi
+000093e0: 6173 5f69 6e69 7469 616c 697a 6572 3d27  as_initializer='
+000093f0: 7a65 726f 7327 2c0d 0a20 2020 2020 2020  zeros',..       
+00009400: 2020 2020 206b 6572 6e65 6c5f 7265 6775       kernel_regu
+00009410: 6c61 7269 7a65 723d 7466 2e6b 6572 6173  larizer=tf.keras
+00009420: 2e72 6567 756c 6172 697a 6572 732e 6c31  .regularizers.l1
+00009430: 2873 656c 662e 7370 6563 735b 276c 315f  (self.specs['l1_
+00009440: 6c61 6d62 6461 275d 292c 0d0a 2020 2020  lambda']),..    
+00009450: 2020 2020 2020 2020 6269 6173 5f72 6567          bias_reg
+00009460: 756c 6172 697a 6572 3d4e 6f6e 652c 0d0a  ularizer=None,..
+00009470: 2020 2020 2020 2020 2020 2020 6163 7469              acti
+00009480: 7669 7479 5f72 6567 756c 6172 697a 6572  vity_regularizer
+00009490: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
+000094a0: 2020 2020 6b65 726e 656c 5f63 6f6e 7374      kernel_const
+000094b0: 7261 696e 743d 7466 2e6b 6572 6173 2e63  raint=tf.keras.c
+000094c0: 6f6e 7374 7261 696e 7473 2e55 6e69 744e  onstraints.UnitN
+000094d0: 6f72 6d28 6178 6973 3d30 292c 0d0a 2020  orm(axis=0),..  
+000094e0: 2020 2020 2020 2020 2020 6269 6173 5f63            bias_c
+000094f0: 6f6e 7374 7261 696e 743d 4e6f 6e65 2c0d  onstraint=None,.
+00009500: 0a20 2020 2020 2020 2029 0d0a 0d0a 0d0a  .        )......
+00009510: 2020 2020 2020 2020 656e 635f 6465 636f          enc_deco
+00009520: 6e76 203d 2073 656c 662e 656e 635f 7463  nv = self.enc_tc
+00009530: 6f6e 765f 7472 616e 7328 656e 635f 6472  onv_trans(enc_dr
+00009540: 6f70 6f75 7429 0d0a 2020 2020 2020 2020  opout)..        
+00009550: 2365 6e63 5f64 6563 6f6e 7620 3d20 7466  #enc_deconv = tf
+00009560: 2e74 7261 6e73 706f 7365 2865 6e63 5f64  .transpose(enc_d
+00009570: 6563 6f6e 762c 2070 6572 6d3d 5b30 2c33  econv, perm=[0,3
+00009580: 2c31 2c32 5d29 0d0a 2020 2020 2020 2020  ,1,2])..        
+00009590: 7072 696e 7428 2245 6e63 5f64 6563 6f6e  print("Enc_decon
+000095a0: 763a 222c 2065 6e63 5f64 6563 6f6e 762e  v:", enc_deconv.
+000095b0: 7368 6170 6529 0d0a 0d0a 2020 2020 2020  shape)....      
+000095c0: 2020 7365 6c66 2e64 655f 646d 7820 3d20    self.de_dmx = 
+000095d0: 4465 4d69 7869 6e67 2873 697a 653d 7365  DeMixing(size=se
+000095e0: 6c66 2e64 6174 6173 6574 2e68 5f70 6172  lf.dataset.h_par
+000095f0: 616d 735b 276e 5f63 6827 5d2c 206e 6f6e  ams['n_ch'], non
+00009600: 6c69 6e3d 7466 2e69 6465 6e74 6974 792c  lin=tf.identity,
+00009610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009620: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+00009630: 6973 3d33 2c20 7370 6563 733d 7365 6c66  is=3, specs=self
+00009640: 2e73 7065 6373 290d 0a0d 0a20 2020 2020  .specs)....     
+00009650: 2020 2073 656c 662e 585f 7072 6564 203d     self.X_pred =
+00009660: 2073 656c 662e 6465 5f64 6d78 2865 6e63   self.de_dmx(enc
+00009670: 5f64 6563 6f6e 7629 0d0a 2020 2020 2020  _deconv)..      
+00009680: 2020 7072 696e 7428 7365 6c66 2e58 5f70    print(self.X_p
+00009690: 7265 642e 7368 6170 6529 0d0a 2020 2020  red.shape)..    
+000096a0: 2020 2020 7365 6c66 2e6b 6d5f 656e 6320      self.km_enc 
+000096b0: 3d20 7466 2e6b 6572 6173 2e4d 6f64 656c  = tf.keras.Model
+000096c0: 2869 6e70 7574 733d 7365 6c66 2e69 6e70  (inputs=self.inp
+000096d0: 7574 732c 206f 7574 7075 7473 3d73 656c  uts, outputs=sel
+000096e0: 662e 585f 7072 6564 290d 0a0d 0a20 2020  f.X_pred)....   
+000096f0: 2020 2020 2073 656c 662e 6d65 7461 2e74       self.meta.t
+00009700: 7261 696e 5f70 6172 616d 735b 2765 6e63  rain_params['enc
+00009710: 5f6c 6f73 7327 5d20 3d20 5b74 662e 6b65  _loss'] = [tf.ke
+00009720: 7261 732e 6c6f 7373 6573 2e4d 4145 5d23  ras.losses.MAE]#
+00009730: 7466 2e72 6564 7563 655f 6d65 616e 2828  tf.reduce_mean((
+00009740: 7365 6c66 2e58 5f70 7265 6420 2d20 7365  self.X_pred - se
+00009750: 6c66 2e69 6e70 7574 7329 2a2a 3229 0d0a  lf.inputs)**2)..
+00009760: 2020 2020 2020 2020 2373 656c 662e 7061          #self.pa
+00009770: 7261 6d73 5b27 656e 635f 6d65 7472 6963  rams['enc_metric
+00009780: 7327 5d20 3d20 7466 2e6b 6572 6173 2e6d  s'] = tf.keras.m
+00009790: 6574 7269 6373 2e52 6f6f 744d 6561 6e53  etrics.RootMeanS
+000097a0: 7175 6172 6564 4572 726f 7228 6e61 6d65  quaredError(name
+000097b0: 3d22 524d 5345 2229 0d0a 0d0a 0d0a 2020  ="RMSE")......  
+000097c0: 2020 2020 2020 2370 7269 6e74 2870 6172        #print(par
+000097d0: 616d 7329 0d0a 2020 2020 2020 2020 7365  ams)..        se
+000097e0: 6c66 2e6b 6d5f 656e 632e 636f 6d70 696c  lf.km_enc.compil
+000097f0: 6528 6f70 7469 6d69 7a65 723d 7466 2e6b  e(optimizer=tf.k
+00009800: 6572 6173 2e6f 7074 696d 697a 6572 732e  eras.optimizers.
+00009810: 6c65 6761 6379 2e41 6461 6d28 292c 0d0a  legacy.Adam(),..
+00009820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009830: 2020 2020 2020 2020 6c6f 7373 3d73 656c          loss=sel
+00009840: 662e 6d65 7461 2e74 7261 696e 5f70 6172  f.meta.train_par
+00009850: 616d 735b 2765 6e63 5f6c 6f73 7327 5d29  ams['enc_loss'])
+00009860: 0d0a 0d0a 2020 2020 6465 6620 636f 6d70  ....    def comp
+00009870: 7574 655f 656e 635f 7061 7474 6572 6e73  ute_enc_patterns
+00009880: 2873 656c 662c 2069 6e70 7574 733d 4e6f  (self, inputs=No
+00009890: 6e65 293a 0d0a 2020 2020 2020 2020 2222  ne):..        ""
+000098a0: 220d 0a0d 0a20 2020 2020 2020 2022 2222  "....        """
+000098b0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+000098c0: 206e 702e 616e 7928 696e 7075 7473 293a   np.any(inputs):
+000098d0: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+000098e0: 696e 7428 2755 7369 6e67 2066 616b 6520  int('Using fake 
+000098f0: 696e 7075 7473 2729 0d0a 2020 2020 2020  inputs')..      
+00009900: 2020 2020 2020 696e 7075 7473 203d 206e        inputs = n
+00009910: 702e 6964 656e 7469 7479 2873 656c 662e  p.identity(self.
+00009920: 6f75 745f 6469 6d29 0d0a 2020 2020 2020  out_dim)..      
+00009930: 2020 706f 6f6c 6564 203d 2074 662e 7265    pooled = tf.re
+00009940: 7368 6170 6528 7365 6c66 2e65 6e63 5f66  shape(self.enc_f
+00009950: 6328 696e 7075 7473 292c 0d0a 2020 2020  c(inputs),..    
+00009960: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00009970: 2d31 2c0d 0a20 2020 2020 2020 2020 2020  -1,..           
+00009980: 2020 2020 2020 2020 2031 2c0d 0a20 2020           1,..   
+00009990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000099a0: 2073 656c 662e 706f 6f6c 6564 2e73 6861   self.pooled.sha
+000099b0: 7065 5b2d 325d 2c0d 0a20 2020 2020 2020  pe[-2],..       
+000099c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000099d0: 662e 7370 6563 735b 276e 5f6c 6174 656e  f.specs['n_laten
+000099e0: 7427 5d5d 290d 0a20 2020 2020 2020 2075  t']])..        u
+000099f0: 6e70 6f6f 6c65 645f 7766 7320 3d20 7365  npooled_wfs = se
+00009a00: 6c66 2e65 6e63 5f74 636f 6e76 5f74 7261  lf.enc_tconv_tra
+00009a10: 6e73 2870 6f6f 6c65 6429 0d0a 2020 2020  ns(pooled)..    
+00009a20: 2020 2020 7061 7474 6572 6e73 203d 2073      patterns = s
+00009a30: 656c 662e 6465 5f64 6d78 2875 6e70 6f6f  elf.de_dmx(unpoo
+00009a40: 6c65 645f 7766 7329 0d0a 0d0a 2020 2020  led_wfs)....    
+00009a50: 2020 2020 7265 7475 726e 206e 702e 7371      return np.sq
+00009a60: 7565 657a 6528 7061 7474 6572 6e73 2920  ueeze(patterns) 
+00009a70: 232c 2075 6e70 6f6f 6c65 645f 7766 730d  #, unpooled_wfs.
+00009a80: 0a0d 0a20 2020 2064 6566 2074 7261 696e  ...    def train
+00009a90: 5f65 6e63 6f64 6572 2873 656c 662c 206e  _encoder(self, n
+00009aa0: 5f65 706f 6368 732c 2065 7661 6c5f 7374  _epochs, eval_st
+00009ab0: 6570 3d4e 6f6e 652c 206d 696e 5f64 656c  ep=None, min_del
+00009ac0: 7461 3d31 652d 362c 0d0a 2020 2020 2020  ta=1e-6,..      
+00009ad0: 2020 2020 2020 2020 6561 726c 795f 7374          early_st
+00009ae0: 6f70 7069 6e67 3d33 2c20 636f 6c6c 6563  opping=3, collec
+00009af0: 745f 7061 7474 6572 6e73 3d46 616c 7365  t_patterns=False
+00009b00: 293a 0d0a 2020 2020 2020 2020 6461 7461  ):..        data
+00009b10: 7365 745f 7472 6169 6e20 3d20 7365 6c66  set_train = self
+00009b20: 2e64 6174 6173 6574 2e74 7261 696e 2e6d  .dataset.train.m
+00009b30: 6170 286c 616d 6264 6120 782c 2079 203a  ap(lambda x, y :
+00009b40: 2028 782c 2078 2929 0d0a 2020 2020 2020   (x, x))..      
+00009b50: 2020 6461 7461 7365 745f 7661 6c20 3d20    dataset_val = 
+00009b60: 7365 6c66 2e64 6174 6173 6574 2e76 616c  self.dataset.val
+00009b70: 2e6d 6170 286c 616d 6264 6120 782c 2079  .map(lambda x, y
+00009b80: 203a 2028 782c 2078 2929 0d0a 2020 2020   : (x, x))..    
+00009b90: 2020 2020 7374 6f70 5f65 6172 6c79 203d      stop_early =
+00009ba0: 2074 662e 6b65 7261 732e 6361 6c6c 6261   tf.keras.callba
+00009bb0: 636b 732e 4561 726c 7953 746f 7070 696e  cks.EarlyStoppin
+00009bc0: 6728 6d6f 6e69 746f 723d 2776 616c 5f6c  g(monitor='val_l
+00009bd0: 6f73 7327 2c0d 0a20 2020 2020 2020 2020  oss',..         
+00009be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c00: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00009c10: 6c69 6461 7469 6f6e 5f73 7465 7073 3d73  lidation_steps=s
-00009c20: 656c 662e 6461 7461 7365 742e 7661 6c69  elf.dataset.vali
-00009c30: 6461 7469 6f6e 5f73 7465 7073 2c0d 0a20  dation_steps,.. 
+00009c00: 2020 2020 2020 2020 2020 2020 206d 696e               min
+00009c10: 5f64 656c 7461 3d6d 696e 5f64 656c 7461  _delta=min_delta
+00009c20: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00009c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00009c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c60: 2020 6361 6c6c 6261 636b 733d 5b73 746f    callbacks=[sto
-00009c70: 705f 6561 726c 795d 2c20 7665 7262 6f73  p_early], verbos
-00009c80: 653d 322c 0d0a 2020 2020 2020 2020 2020  e=2,..          
+00009c50: 2020 2020 2020 2020 2070 6174 6965 6e63           patienc
+00009c60: 653d 6561 726c 795f 7374 6f70 7069 6e67  e=early_stopping
+00009c70: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00009c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00009c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ca0: 2020 2020 2020 2020 2023 636c 6173 735f           #class_
-00009cb0: 7765 6967 6874 3d63 6c61 7373 5f77 6569  weight=class_wei
-00009cc0: 6768 7473 0d0a 2020 2020 2020 2020 2020  ghts..          
-00009cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ce0: 2020 2020 2020 2020 2029 0d0a 0d0a 2020           )....  
-00009cf0: 2020 6465 6620 6765 745f 636f 6e66 6967    def get_config
-00009d00: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00009d10: 2020 2020 2023 2044 6f20 6e6f 7420 6361       # Do not ca
-00009d20: 6c6c 2073 7570 6572 2e67 6574 5f63 6f6e  ll super.get_con
-00009d30: 6669 6721 0d0a 2020 2020 2020 2020 2020  fig!..          
-00009d40: 2020 2320 5468 6973 2067 6176 6520 616e    # This gave an
-00009d50: 2065 7272 6f72 2066 6f72 206d 652e 0d0a   error for me...
-00009d60: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-00009d70: 6967 203d 207b 0d0a 2020 2020 2020 2020  ig = {..        
-00009d80: 2020 2020 2020 2020 2264 6d78 223a 2073          "dmx": s
-00009d90: 656c 662e 646d 782c 0d0a 2020 2020 2020  elf.dmx,..      
-00009da0: 2020 2020 2020 2020 2020 2264 6d78 5f6f            "dmx_o
-00009db0: 7574 223a 2073 656c 662e 646d 785f 6f75  ut": self.dmx_ou
-00009dc0: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-00009dd0: 2020 2020 2274 6f63 6e76 223a 2073 656c      "tocnv": sel
-00009de0: 662e 7463 6f6e 762c 0d0a 2020 2020 2020  f.tconv,..      
-00009df0: 2020 2020 2020 2020 2020 2274 636f 6e76            "tconv
-00009e00: 5f6f 7574 223a 2073 656c 662e 7463 6f6e  _out": self.tcon
-00009e10: 765f 6f75 742c 0d0a 2020 2020 2020 2020  v_out,..        
-00009e20: 2020 2020 2020 2020 2270 6f6f 6c22 3a20          "pool": 
-00009e30: 7365 6c66 2e70 6f6f 6c2c 0d0a 2020 2020  self.pool,..    
-00009e40: 2020 2020 2020 2020 2020 2020 2270 6f6f              "poo
-00009e50: 6c65 6422 3a20 7365 6c66 2e70 6f6f 6c65  led": self.poole
-00009e60: 642c 0d0a 2020 2020 2020 2020 2020 2020  d,..            
-00009e70: 2020 2020 2264 726f 706f 7574 223a 2073      "dropout": s
-00009e80: 656c 662e 6472 6f70 6f75 742c 0d0a 2020  elf.dropout,..  
-00009e90: 2020 2020 2020 2020 2020 2020 2020 2266                "f
-00009ea0: 696e 5f66 6322 3a20 7365 6c66 2e66 696e  in_fc": self.fin
-00009eb0: 5f66 630d 0a20 2020 2020 2020 2020 2020  _fc..           
-00009ec0: 207d 0d0a 2020 2020 2020 2020 2020 2020   }..            
-00009ed0: 7265 7475 726e 2063 6f6e 6669 670d 0a0d  return config...
-00009ee0: 0a20 2020 2064 6566 205f 6765 745f 636c  .    def _get_cl
-00009ef0: 6173 735f 636f 6e64 6974 696f 6e61 6c5f  ass_conditional_
-00009f00: 7370 6174 6961 6c5f 636f 7661 7269 616e  spatial_covarian
-00009f10: 6365 2873 656c 662c 2058 2c20 7929 3a0d  ce(self, X, y):.
-00009f20: 0a20 2020 2020 2020 2022 2222 436f 6d70  .        """Comp
-00009f30: 7574 6520 7370 6174 6961 6c20 636c 6173  ute spatial clas
-00009f40: 732d 636f 6e64 6974 696f 6e61 6c20 636f  s-conditional co
-00009f50: 7661 7269 616e 6365 206d 6174 7269 7820  variance matrix 
-00009f60: 6672 6f6d 2074 6865 2064 6174 6173 6574  from the dataset
-00009f70: 0d0a 0d0a 2020 2020 2020 2020 5061 7261  ....        Para
-00009f80: 6d65 7465 7273 3a0d 0a20 2020 2020 2020  meters:..       
-00009f90: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020   -----------..  
-00009fa0: 2020 2020 2020 6461 7461 7365 7420 3a20        dataset : 
-00009fb0: 7466 2e64 6174 612e 4461 7461 7365 740d  tf.data.Dataset.
-00009fc0: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-00009fd0: 6e73 203a 2064 636f 7620 5b79 5f73 6861  ns : dcov [y_sha
-00009fe0: 7065 2c20 6e5f 6368 2c20 6e5f 6368 5d0d  pe, n_ch, n_ch].
-00009ff0: 0a0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-0000a000: 0d0a 2020 2020 2020 2020 6463 6f76 7320  ..        dcovs 
-0000a010: 3d20 5b5d 0d0a 2020 2020 2020 2020 6463  = []..        dc
-0000a020: 6f76 735f 6e20 3d20 5b5d 0d0a 2020 2020  ovs_n = []..    
-0000a030: 2020 2020 666f 7220 636c 6173 735f 7920      for class_y 
-0000a040: 696e 2072 616e 6765 2873 656c 662e 6f75  in range(self.ou
-0000a050: 745f 6469 6d29 3a0d 0a20 2020 2020 2020  t_dim):..       
-0000a060: 2020 2020 2063 6c61 7373 5f69 6e64 203d       class_ind =
-0000a070: 2074 662e 7371 7565 657a 6528 7466 2e77   tf.squeeze(tf.w
-0000a080: 6865 7265 2874 662e 6172 676d 6178 2879  here(tf.argmax(y
-0000a090: 2c20 3129 3d3d 636c 6173 735f 7929 2923  , 1)==class_y))#
-0000a0a0: 5b30 5d0d 0a20 2020 2020 2020 2020 2020  [0]..           
-0000a0b0: 2078 7320 3d20 6e70 2e73 7175 6565 7a65   xs = np.squeeze
-0000a0c0: 2858 2e6e 756d 7079 2829 5b63 6c61 7373  (X.numpy()[class
-0000a0d0: 5f69 6e64 2c20 2e2e 2e5d 290d 0a20 2020  _ind, ...])..   
-0000a0e0: 2020 2020 2020 2020 2023 7873 202d 3d20           #xs -= 
-0000a0f0: 6e70 2e6d 6561 6e28 7873 2c20 6178 6973  np.mean(xs, axis
-0000a100: 3d2d 322c 206b 6565 7064 696d 733d 5472  =-2, keepdims=Tr
-0000a110: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-0000a120: 2064 646f 665f 7320 3d20 7873 2e73 6861   ddof_s = xs.sha
-0000a130: 7065 5b30 5d2a 7365 6c66 2e64 6174 6173  pe[0]*self.datas
-0000a140: 6574 2e68 5f70 6172 616d 735b 276e 5f74  et.h_params['n_t
-0000a150: 275d 202d 2031 0d0a 2020 2020 2020 2020  '] - 1..        
-0000a160: 2020 2020 636f 765f 7320 3d20 6e70 2e65      cov_s = np.e
-0000a170: 696e 7375 6d28 2769 6a6b 2c20 696a 6c20  insum('ijk, ijl 
-0000a180: 2d3e 206b 6c27 2c20 7873 2c20 7873 2920  -> kl', xs, xs) 
-0000a190: 2f20 6464 6f66 5f73 0d0a 0d0a 2020 2020  / ddof_s....    
-0000a1a0: 2020 2020 2020 2020 616e 7469 5f63 6c61          anti_cla
-0000a1b0: 7373 5f69 6e64 203d 2074 662e 7371 7565  ss_ind = tf.sque
-0000a1c0: 657a 6528 7466 2e77 6865 7265 2874 662e  eze(tf.where(tf.
-0000a1d0: 6172 676d 6178 2879 2c20 3129 213d 636c  argmax(y, 1)!=cl
-0000a1e0: 6173 735f 7929 2923 5b30 5d0d 0a20 2020  ass_y))#[0]..   
-0000a1f0: 2020 2020 2020 2020 2078 6e20 3d20 6e70           xn = np
-0000a200: 2e73 7175 6565 7a65 2858 2e6e 756d 7079  .squeeze(X.numpy
-0000a210: 2829 5b61 6e74 695f 636c 6173 735f 696e  ()[anti_class_in
-0000a220: 642c 202e 2e2e 5d29 0d0a 2020 2020 2020  d, ...])..      
-0000a230: 2020 2020 2020 6464 6f66 5f6e 203d 2078        ddof_n = x
-0000a240: 6e2e 7368 6170 655b 305d 2a73 656c 662e  n.shape[0]*self.
-0000a250: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
-0000a260: 5b27 6e5f 7427 5d20 2d20 310d 0a20 2020  ['n_t'] - 1..   
-0000a270: 2020 2020 2020 2020 2063 6f76 5f6e 203d           cov_n =
-0000a280: 206e 702e 6569 6e73 756d 2827 696a 6b2c   np.einsum('ijk,
-0000a290: 2069 6a6c 202d 3e20 6b6c 272c 2078 6e2c   ijl -> kl', xn,
-0000a2a0: 2078 6e29 202f 2064 646f 665f 6e0d 0a0d   xn) / ddof_n...
-0000a2b0: 0a20 2020 2020 2020 2020 2020 2064 636f  .            dco
-0000a2c0: 7673 2e61 7070 656e 6428 636f 765f 7329  vs.append(cov_s)
-0000a2d0: 2023 2020 2d20 636f 765f 6e0d 0a20 2020   #  - cov_n..   
-0000a2e0: 2020 2020 2020 2020 2064 636f 7673 5f6e           dcovs_n
-0000a2f0: 2e61 7070 656e 6428 636f 765f 6e29 0d0a  .append(cov_n)..
-0000a300: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-0000a310: 702e 6172 7261 7928 6463 6f76 7329 2c20  p.array(dcovs), 
-0000a320: 6e70 2e61 7272 6179 2864 636f 7673 5f6e  np.array(dcovs_n
-0000a330: 290d 0a0d 0a0d 0a20 2020 2064 6566 2070  )......    def p
-0000a340: 6174 7465 726e 735f 636f 765f 7878 2873  atterns_cov_xx(s
-0000a350: 656c 662c 2079 2c20 7765 6967 6874 732c  elf, y, weights,
-0000a360: 2061 6374 6976 6174 696f 6e73 2c20 6463   activations, dc
-0000a370: 6f76 293a 0d0a 2020 2020 2020 2020 2222  ov):..        ""
-0000a380: 220d 0a20 2020 2020 2020 2058 202d 205b  "..        X - [
-0000a390: 692c 2e2e 2e2c 6d5d 0d0a 2020 2020 2020  i,...,m]..      
-0000a3a0: 2020 7920 2d20 5b69 2c2e 2e2e 2c6a 5d20    y - [i,...,j] 
-0000a3b0: 2d20 7573 6564 2066 6f72 2063 6f76 5b79  - used for cov[y
-0000a3c0: 5d0d 0a20 2020 2020 2020 2077 202d 205b  ]..        w - [
-0000a3d0: 6b2c 2e2e 2e2c 6a5d 0d0a 2020 2020 2020  k,...,j]..      
-0000a3e0: 2020 5378 202d 205b 6b2c 2e2e 2e2c 6d6a    Sx - [k,...,mj
-0000a3f0: 5d22 2222 0d0a 2020 2020 2020 2020 785f  ]"""..        x_
-0000a400: 7368 6170 6520 3d20 6c69 7374 2861 6374  shape = list(act
-0000a410: 6976 6174 696f 6e73 5b27 7463 6f6e 7627  ivations['tconv'
-0000a420: 5d2e 7368 6170 6529 0d0a 2020 2020 2020  ].shape)..      
-0000a430: 2020 795f 7368 6170 6520 3d20 6c69 7374    y_shape = list
-0000a440: 2879 2e73 6861 7065 290d 0a20 2020 2020  (y.shape)..     
-0000a450: 2020 2023 6f75 745f 7368 6170 6520 3d20     #out_shape = 
-0000a460: 785f 7368 6170 655b 313a 5d20 2b20 795f  x_shape[1:] + y_
-0000a470: 7368 6170 655b 313a 5d0d 0a20 2020 2020  shape[1:]..     
-0000a480: 2020 2023 7072 696e 7428 785f 7368 6170     #print(x_shap
-0000a490: 652c 2079 5f73 6861 7065 2c20 7765 6967  e, y_shape, weig
-0000a4a0: 6874 735b 276f 7574 5f77 6569 6768 7473  hts['out_weights
-0000a4b0: 275d 2e73 6861 7065 290d 0a20 2020 2020  '].shape)..     
-0000a4c0: 2020 2064 646f 6620 3d20 6163 7469 7661     ddof = activa
-0000a4d0: 7469 6f6e 735b 2774 636f 6e76 275d 2e73  tions['tconv'].s
-0000a4e0: 6861 7065 5b30 5d20 2d20 310d 0a20 2020  hape[0] - 1..   
-0000a4f0: 2020 2020 2058 203d 206e 702e 7265 7368       X = np.resh
-0000a500: 6170 6528 6163 7469 7661 7469 6f6e 735b  ape(activations[
-0000a510: 2774 636f 6e76 275d 2c20 5b61 6374 6976  'tconv'], [activ
-0000a520: 6174 696f 6e73 5b27 7463 6f6e 7627 5d2e  ations['tconv'].
-0000a530: 7368 6170 655b 305d 2c20 2d31 5d29 0d0a  shape[0], -1])..
-0000a540: 2020 2020 2020 2020 7920 3d20 6e70 2e72          y = np.r
-0000a550: 6573 6861 7065 2879 2c20 5b79 2e73 6861  eshape(y, [y.sha
-0000a560: 7065 5b30 5d2c 202d 315d 290d 0a0d 0a20  pe[0], -1]).... 
-0000a570: 2020 2020 2020 2077 203d 206e 702e 7265         w = np.re
-0000a580: 7368 6170 6528 7765 6967 6874 735b 276f  shape(weights['o
-0000a590: 7574 5f77 6569 6768 7473 275d 2c20 5b2d  ut_weights'], [-
-0000a5a0: 312c 2077 6569 6768 7473 5b27 6f75 745f  1, weights['out_
-0000a5b0: 7765 6967 6874 7327 5d2e 7368 6170 655b  weights'].shape[
-0000a5c0: 2d31 5d5d 290d 0a20 2020 2020 2020 2061  -1]])..        a
-0000a5d0: 7373 6572 7428 582e 7368 6170 655b 2d31  ssert(X.shape[-1
-0000a5e0: 5d20 3d3d 2077 2e73 6861 7065 5b30 5d29  ] == w.shape[0])
-0000a5f0: 2c20 2753 6861 7065 206d 6973 6d61 7463  , 'Shape mismatc
-0000a600: 6820 583a 7b7d 2077 3a7b 7d27 2e66 6f72  h X:{} w:{}'.for
-0000a610: 6d61 7428 582e 7368 6170 652c 2077 2e73  mat(X.shape, w.s
-0000a620: 6861 7065 290d 0a20 2020 2020 2020 2061  hape)..        a
-0000a630: 7373 6572 7428 792e 7368 6170 655b 2d31  ssert(y.shape[-1
-0000a640: 5d20 3d3d 2077 2e73 6861 7065 5b31 5d29  ] == w.shape[1])
-0000a650: 2c20 2753 6861 7065 206d 6973 6d61 7463  , 'Shape mismatc
-0000a660: 6820 793a 7b7d 2077 3a7b 7d27 2e66 6f72  h y:{} w:{}'.for
-0000a670: 6d61 7428 792e 7368 6170 652c 2077 2e73  mat(y.shape, w.s
-0000a680: 6861 7065 290d 0a20 2020 2020 2020 2058  hape)..        X
-0000a690: 203d 2058 202d 2058 2e6d 6561 6e28 302c   = X - X.mean(0,
-0000a6a0: 206b 6565 7064 696d 733d 5472 7565 290d   keepdims=True).
-0000a6b0: 0a20 2020 2020 2020 2063 6f76 5f78 7820  .        cov_xx 
-0000a6c0: 3d20 6e70 2e65 696e 7375 6d28 2769 6b20  = np.einsum('ik 
-0000a6d0: 2c69 6a20 2d3e 206b 6a20 272c 2058 2c20  ,ij -> kj ', X, 
-0000a6e0: 5829 202f 2064 646f 660d 0a0d 0a20 2020  X) / ddof....   
-0000a6f0: 2020 2020 2023 636f 6d70 7574 6520 696e       #compute in
-0000a700: 7665 7273 6520 636f 7661 7269 616e 6365  verse covariance
-0000a710: 206f 6620 7468 6520 6f75 7470 7574 0d0a   of the output..
-0000a720: 2020 2020 2020 2020 636f 765f 7979 203d          cov_yy =
-0000a730: 206e 702e 6569 6e73 756d 2827 696a 2c20   np.einsum('ij, 
-0000a740: 696b 202d 3e20 6a6b 272c 2079 2c20 7929  ik -> jk', y, y)
-0000a750: 202f 2064 646f 660d 0a20 2020 2020 2020   / ddof..       
-0000a760: 2070 7265 635f 7979 203d 2074 662e 6c69   prec_yy = tf.li
-0000a770: 6e61 6c67 2e70 696e 7628 636f 765f 7979  nalg.pinv(cov_yy
-0000a780: 290d 0a0d 0a20 2020 2020 2020 2023 636f  )....        #co
-0000a790: 6d70 7574 6520 6469 7265 6374 696f 6e73  mpute directions
-0000a7a0: 206f 6620 5378 3a20 6120 3d20 636f 765f   of Sx: a = cov_
-0000a7b0: 7879 2a28 636f 765f 7979 292a 2a2d 310d  xy*(cov_yy)**-1.
-0000a7c0: 0a20 2020 2020 2020 2061 5f6f 7574 203d  .        a_out =
-0000a7d0: 206e 702e 6569 6e73 756d 2827 6969 2c20   np.einsum('ii, 
-0000a7e0: 696a 2c20 6a6a 202d 3e20 696a 272c 2063  ij, jj -> ij', c
-0000a7f0: 6f76 5f78 782c 2077 2c20 7072 6563 5f79  ov_xx, w, prec_y
-0000a800: 7929 0d0a 0d0a 2020 2020 2020 2020 2320  y)....        # 
-0000a810: 412e 2a77 0d0a 2020 2020 2020 2020 2361  A.*w..        #a
-0000a820: 7720 3d20 615f 6f75 7420 2a20 7720 2373  w = a_out * w #s
-0000a830: 6861 7065 203d 205b 2e2e 2e5d 0d0a 2020  hape = [...]..  
-0000a840: 2020 2020 2020 2320 6163 7469 7661 7469        # activati
-0000a850: 6f6e 206f 6620 7463 6f6e 7620 6279 2065  on of tconv by e
-0000a860: 6163 6820 7369 676e 616c 2063 6f6d 706f  ach signal compo
-0000a870: 6e65 6e74 206f 6620 6561 6368 2073 616d  nent of each sam
-0000a880: 706c 650d 0a20 2020 2020 2020 2053 7820  ple..        Sx 
-0000a890: 3d20 6e70 2e65 696e 7375 6d28 2769 6c2c  = np.einsum('il,
-0000a8a0: 2069 6c2c 206a 6920 2d3e 206a 696c 272c   il, ji -> jil',
-0000a8b0: 2061 5f6f 7574 2c20 772c 2058 290d 0a20   a_out, w, X).. 
-0000a8c0: 2020 2020 2020 2053 7820 3d20 6e70 2e72         Sx = np.r
-0000a8d0: 6573 6861 7065 2853 782c 205b 2d31 2c20  eshape(Sx, [-1, 
-0000a8e0: 785f 7368 6170 655b 2d31 5d2c 2079 5f73  x_shape[-1], y_s
-0000a8f0: 6861 7065 5b2d 315d 5d29 0d0a 2020 2020  hape[-1]])..    
-0000a900: 2020 2020 5378 203d 2053 7820 2d20 5378      Sx = Sx - Sx
-0000a910: 2e6d 6561 6e28 312c 206b 6565 7064 696d  .mean(1, keepdim
-0000a920: 733d 5472 7565 290d 0a20 2020 2020 2020  s=True)..       
-0000a930: 2064 646f 6620 3d20 5378 2e73 6861 7065   ddof = Sx.shape
-0000a940: 5b30 5d20 2d20 310d 0a20 2020 2020 2020  [0] - 1..       
-0000a950: 2063 6f76 5f73 7820 3d20 6e70 2e65 696e   cov_sx = np.ein
-0000a960: 7375 6d28 2769 6a6b 2c20 696c 6b20 2d3e  sum('ijk, ilk ->
-0000a970: 206a 6c6b 272c 2053 782c 2053 7829 202f   jlk', Sx, Sx) /
-0000a980: 2064 646f 660d 0a0d 0a20 2020 2020 2020   ddof....       
-0000a990: 2070 6174 7465 726e 7320 3d20 5b5d 0d0a   patterns = []..
-0000a9a0: 2020 2020 2020 2020 2364 6320 3d20 6463          #dc = dc
-0000a9b0: 6f76 5b27 696e 7075 745f 7370 6174 6961  ov['input_spatia
-0000a9c0: 6c27 5d0d 0a20 2020 2020 2020 2066 6f72  l']..        for
-0000a9d0: 2069 2069 6e20 7261 6e67 6528 792e 7368   i in range(y.sh
-0000a9e0: 6170 655b 2d31 5d29 3a0d 0a20 2020 2020  ape[-1]):..     
-0000a9f0: 2020 2020 2020 2070 7265 635f 7378 203d         prec_sx =
-0000aa00: 206e 702e 6c69 6e61 6c67 2e70 696e 7628   np.linalg.pinv(
-0000aa10: 636f 765f 7378 5b2e 2e2e 2c69 5d29 0d0a  cov_sx[...,i])..
-0000aa20: 2020 2020 2020 2020 2020 2020 6463 203d              dc =
-0000aa30: 2064 636f 765b 2763 6c61 7373 5f63 6f6e   dcov['class_con
-0000aa40: 6469 7469 6f6e 616c 275d 5b69 5d0d 0a20  ditional'][i].. 
-0000aa50: 2020 2020 2020 2020 2020 2070 6174 7465             patte
-0000aa60: 726e 732e 6170 7065 6e64 286e 702e 6569  rns.append(np.ei
-0000aa70: 6e73 756d 2827 6869 2c20 696a 2c20 6a6b  nsum('hi, ij, jk
-0000aa80: 202d 3e20 6827 2c0d 0a20 2020 2020 2020   -> h',..       
-0000aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aaa0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000aab0: 632c 2077 6569 6768 7473 5b27 646d 7827  c, weights['dmx'
-0000aac0: 5d2c 2070 7265 635f 7378 2929 0d0a 2020  ], prec_sx))..  
-0000aad0: 2020 2020 2020 7061 7474 6572 6e73 203d        patterns =
-0000aae0: 206e 702e 7374 6163 6b28 7061 7474 6572   np.stack(patter
-0000aaf0: 6e73 2c20 2d31 290d 0a20 2020 2020 2020  ns, -1)..       
-0000ab00: 2072 6574 7572 6e20 7061 7474 6572 6e73   return patterns
-0000ab10: 0d0a 0d0a 0d0a 2020 2020 6465 6620 7061  ......    def pa
-0000ab20: 7474 6572 6e73 5f63 6f76 5f78 795f 6861  tterns_cov_xy_ha
-0000ab30: 7428 7365 6c66 2c20 582c 2079 2c20 6163  t(self, X, y, ac
-0000ab40: 7469 7661 7469 6f6e 732c 2077 6569 6768  tivations, weigh
-0000ab50: 7473 293a 0d0a 2020 2020 2020 2020 5378  ts):..        Sx
-0000ab60: 5f74 636f 6e76 203d 2073 656c 662e 6261  _tconv = self.ba
-0000ab70: 636b 7072 6f70 5f66 6328 6163 7469 7661  ckprop_fc(activa
-0000ab80: 7469 6f6e 735b 2774 636f 6e76 275d 2c0d  tions['tconv'],.
-0000ab90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000abb0: 2020 2020 2061 6374 6976 6174 696f 6e73       activations
-0000abc0: 5b27 6663 275d 2c0d 0a20 2020 2020 2020  ['fc'],..       
-0000abd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000abe0: 2020 2020 2020 2020 2020 2020 2079 2c0d               y,.
-0000abf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ac00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac10: 2020 2020 2077 6569 6768 7473 5b27 6f75       weights['ou
-0000ac20: 745f 7765 6967 6874 7327 5d29 0d0a 2020  t_weights'])..  
-0000ac30: 2020 2020 2020 5378 5f64 6d78 203d 2073        Sx_dmx = s
-0000ac40: 656c 662e 6261 636b 7072 6f70 5f63 6f76  elf.backprop_cov
-0000ac50: 7879 2858 2c0d 0a20 2020 2020 2020 2020  xy(X,..         
-0000ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac70: 2020 2020 2020 2020 2020 2061 6374 6976             activ
-0000ac80: 6174 696f 6e73 5b27 646d 7827 5d2c 0d0a  ations['dmx'],..
+00009ca0: 2020 2020 2020 2020 2072 6573 746f 7265           restore
+00009cb0: 5f62 6573 745f 7765 6967 6874 733d 5472  _best_weights=Tr
+00009cc0: 7565 290d 0a20 2020 2020 2020 2073 656c  ue)..        sel
+00009cd0: 662e 745f 6869 7374 203d 2073 656c 662e  f.t_hist = self.
+00009ce0: 6b6d 5f65 6e63 2e66 6974 2864 6174 6173  km_enc.fit(datas
+00009cf0: 6574 5f74 7261 696e 2c0d 0a20 2020 2020  et_train,..     
+00009d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d10: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00009d20: 6c69 6461 7469 6f6e 5f64 6174 613d 6461  lidation_data=da
+00009d30: 7461 7365 745f 7661 6c2c 0d0a 2020 2020  taset_val,..    
+00009d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d50: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00009d60: 706f 6368 733d 6e5f 6570 6f63 6873 2c20  pochs=n_epochs, 
+00009d70: 7374 6570 735f 7065 725f 6570 6f63 683d  steps_per_epoch=
+00009d80: 6576 616c 5f73 7465 702c 0d0a 2020 2020  eval_step,..    
+00009d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009da0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00009db0: 6875 6666 6c65 3d54 7275 652c 0d0a 2020  huffle=True,..  
+00009dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009de0: 2076 616c 6964 6174 696f 6e5f 7374 6570   validation_step
+00009df0: 733d 7365 6c66 2e64 6174 6173 6574 2e76  s=self.dataset.v
+00009e00: 616c 6964 6174 696f 6e5f 7374 6570 732c  alidation_steps,
+00009e10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e30: 2020 2020 2063 616c 6c62 6163 6b73 3d5b       callbacks=[
+00009e40: 7374 6f70 5f65 6172 6c79 5d2c 2076 6572  stop_early], ver
+00009e50: 626f 7365 3d32 2c0d 0a20 2020 2020 2020  bose=2,..       
+00009e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e70: 2020 2020 2020 2020 2020 2020 2363 6c61              #cla
+00009e80: 7373 5f77 6569 6768 743d 636c 6173 735f  ss_weight=class_
+00009e90: 7765 6967 6874 730d 0a20 2020 2020 2020  weights..       
+00009ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009eb0: 2020 2020 2020 2020 2020 2020 290d 0a0d              )...
+00009ec0: 0a20 2020 2064 6566 2067 6574 5f63 6f6e  .    def get_con
+00009ed0: 6669 6728 7365 6c66 293a 0d0a 2020 2020  fig(self):..    
+00009ee0: 2020 2020 2020 2020 2320 446f 206e 6f74          # Do not
+00009ef0: 2063 616c 6c20 7375 7065 722e 6765 745f   call super.get_
+00009f00: 636f 6e66 6967 210d 0a20 2020 2020 2020  config!..       
+00009f10: 2020 2020 2023 2054 6869 7320 6761 7665       # This gave
+00009f20: 2061 6e20 6572 726f 7220 666f 7220 6d65   an error for me
+00009f30: 2e0d 0a20 2020 2020 2020 2020 2020 2063  ...            c
+00009f40: 6f6e 6669 6720 3d20 7b0d 0a20 2020 2020  onfig = {..     
+00009f50: 2020 2020 2020 2020 2020 2022 646d 7822             "dmx"
+00009f60: 3a20 7365 6c66 2e64 6d78 2c0d 0a20 2020  : self.dmx,..   
+00009f70: 2020 2020 2020 2020 2020 2020 2022 646d               "dm
+00009f80: 785f 6f75 7422 3a20 7365 6c66 2e64 6d78  x_out": self.dmx
+00009f90: 5f6f 7574 2c0d 0a20 2020 2020 2020 2020  _out,..         
+00009fa0: 2020 2020 2020 2022 746f 636e 7622 3a20         "tocnv": 
+00009fb0: 7365 6c66 2e74 636f 6e76 2c0d 0a20 2020  self.tconv,..   
+00009fc0: 2020 2020 2020 2020 2020 2020 2022 7463               "tc
+00009fd0: 6f6e 765f 6f75 7422 3a20 7365 6c66 2e74  onv_out": self.t
+00009fe0: 636f 6e76 5f6f 7574 2c0d 0a20 2020 2020  conv_out,..     
+00009ff0: 2020 2020 2020 2020 2020 2022 706f 6f6c             "pool
+0000a000: 223a 2073 656c 662e 706f 6f6c 2c0d 0a20  ": self.pool,.. 
+0000a010: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000a020: 706f 6f6c 6564 223a 2073 656c 662e 706f  pooled": self.po
+0000a030: 6f6c 6564 2c0d 0a20 2020 2020 2020 2020  oled,..         
+0000a040: 2020 2020 2020 2022 6472 6f70 6f75 7422         "dropout"
+0000a050: 3a20 7365 6c66 2e64 726f 706f 7574 2c0d  : self.dropout,.
+0000a060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a070: 2022 6669 6e5f 6663 223a 2073 656c 662e   "fin_fc": self.
+0000a080: 6669 6e5f 6663 0d0a 2020 2020 2020 2020  fin_fc..        
+0000a090: 2020 2020 7d0d 0a20 2020 2020 2020 2020      }..         
+0000a0a0: 2020 2072 6574 7572 6e20 636f 6e66 6967     return config
+0000a0b0: 0d0a 0d0a 2020 2020 6465 6620 5f67 6574  ....    def _get
+0000a0c0: 5f63 6c61 7373 5f63 6f6e 6469 7469 6f6e  _class_condition
+0000a0d0: 616c 5f73 7061 7469 616c 5f63 6f76 6172  al_spatial_covar
+0000a0e0: 6961 6e63 6528 7365 6c66 2c20 582c 2079  iance(self, X, y
+0000a0f0: 293a 0d0a 2020 2020 2020 2020 2222 2243  ):..        """C
+0000a100: 6f6d 7075 7465 2073 7061 7469 616c 2063  ompute spatial c
+0000a110: 6c61 7373 2d63 6f6e 6469 7469 6f6e 616c  lass-conditional
+0000a120: 2063 6f76 6172 6961 6e63 6520 6d61 7472   covariance matr
+0000a130: 6978 2066 726f 6d20 7468 6520 6461 7461  ix from the data
+0000a140: 7365 740d 0a0d 0a20 2020 2020 2020 2050  set....        P
+0000a150: 6172 616d 6574 6572 733a 0d0a 2020 2020  arameters:..    
+0000a160: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d      -----------.
+0000a170: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
+0000a180: 203a 2074 662e 6461 7461 2e44 6174 6173   : tf.data.Datas
+0000a190: 6574 0d0a 0d0a 2020 2020 2020 2020 5265  et....        Re
+0000a1a0: 7475 726e 7320 3a20 6463 6f76 205b 795f  turns : dcov [y_
+0000a1b0: 7368 6170 652c 206e 5f63 682c 206e 5f63  shape, n_ch, n_c
+0000a1c0: 685d 0d0a 0d0a 2020 2020 2020 2020 2222  h]....        ""
+0000a1d0: 220d 0a20 2020 2020 2020 2023 544f 444f  "..        #TODO
+0000a1e0: 3a20 4669 7820 7265 6772 6573 7369 6f6e  : Fix regression
+0000a1f0: 2063 6173 650d 0a20 2020 2020 2020 2064   case..        d
+0000a200: 636f 7673 203d 205b 5d0d 0a20 2020 2020  covs = []..     
+0000a210: 2020 2064 636f 7673 5f6e 203d 205b 5d0d     dcovs_n = [].
+0000a220: 0a20 2020 2020 2020 2066 6f72 2063 6c61  .        for cla
+0000a230: 7373 5f79 2069 6e20 7261 6e67 6528 7365  ss_y in range(se
+0000a240: 6c66 2e6f 7574 5f64 696d 293a 0d0a 2020  lf.out_dim):..  
+0000a250: 2020 2020 2020 2020 2020 636c 6173 735f            class_
+0000a260: 696e 6420 3d20 7466 2e73 7175 6565 7a65  ind = tf.squeeze
+0000a270: 2874 662e 7768 6572 6528 7466 2e61 7267  (tf.where(tf.arg
+0000a280: 6d61 7828 792c 2031 293d 3d63 6c61 7373  max(y, 1)==class
+0000a290: 5f79 2929 235b 305d 0d0a 2020 2020 2020  _y))#[0]..      
+0000a2a0: 2020 2020 2020 7873 203d 206e 702e 7371        xs = np.sq
+0000a2b0: 7565 657a 6528 582e 6e75 6d70 7928 295b  ueeze(X.numpy()[
+0000a2c0: 636c 6173 735f 696e 642c 202e 2e2e 5d29  class_ind, ...])
+0000a2d0: 0d0a 2020 2020 2020 2020 2020 2020 2378  ..            #x
+0000a2e0: 7320 2d3d 206e 702e 6d65 616e 2878 732c  s -= np.mean(xs,
+0000a2f0: 2061 7869 733d 2d32 2c20 6b65 6570 6469   axis=-2, keepdi
+0000a300: 6d73 3d54 7275 6529 0d0a 2020 2020 2020  ms=True)..      
+0000a310: 2020 2020 2020 6464 6f66 5f73 203d 2078        ddof_s = x
+0000a320: 732e 7368 6170 655b 305d 2a73 656c 662e  s.shape[0]*self.
+0000a330: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
+0000a340: 5b27 6e5f 7427 5d20 2d20 310d 0a20 2020  ['n_t'] - 1..   
+0000a350: 2020 2020 2020 2020 2063 6f76 5f73 203d           cov_s =
+0000a360: 206e 702e 6569 6e73 756d 2827 696a 6b2c   np.einsum('ijk,
+0000a370: 2069 6a6c 202d 3e20 6b6c 272c 2078 732c   ijl -> kl', xs,
+0000a380: 2078 7329 202f 2064 646f 665f 730d 0a0d   xs) / ddof_s...
+0000a390: 0a20 2020 2020 2020 2020 2020 2061 6e74  .            ant
+0000a3a0: 695f 636c 6173 735f 696e 6420 3d20 7466  i_class_ind = tf
+0000a3b0: 2e73 7175 6565 7a65 2874 662e 7768 6572  .squeeze(tf.wher
+0000a3c0: 6528 7466 2e61 7267 6d61 7828 792c 2031  e(tf.argmax(y, 1
+0000a3d0: 2921 3d63 6c61 7373 5f79 2929 235b 305d  )!=class_y))#[0]
+0000a3e0: 0d0a 2020 2020 2020 2020 2020 2020 786e  ..            xn
+0000a3f0: 203d 206e 702e 7371 7565 657a 6528 582e   = np.squeeze(X.
+0000a400: 6e75 6d70 7928 295b 616e 7469 5f63 6c61  numpy()[anti_cla
+0000a410: 7373 5f69 6e64 2c20 2e2e 2e5d 290d 0a20  ss_ind, ...]).. 
+0000a420: 2020 2020 2020 2020 2020 2064 646f 665f             ddof_
+0000a430: 6e20 3d20 786e 2e73 6861 7065 5b30 5d2a  n = xn.shape[0]*
+0000a440: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
+0000a450: 6172 616d 735b 276e 5f74 275d 202d 2031  arams['n_t'] - 1
+0000a460: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+0000a470: 765f 6e20 3d20 6e70 2e65 696e 7375 6d28  v_n = np.einsum(
+0000a480: 2769 6a6b 2c20 696a 6c20 2d3e 206b 6c27  'ijk, ijl -> kl'
+0000a490: 2c20 786e 2c20 786e 2920 2f20 6464 6f66  , xn, xn) / ddof
+0000a4a0: 5f6e 0d0a 0d0a 2020 2020 2020 2020 2020  _n....          
+0000a4b0: 2020 6463 6f76 732e 6170 7065 6e64 2863    dcovs.append(c
+0000a4c0: 6f76 5f73 2920 2320 202d 2063 6f76 5f6e  ov_s) #  - cov_n
+0000a4d0: 0d0a 2020 2020 2020 2020 2020 2020 6463  ..            dc
+0000a4e0: 6f76 735f 6e2e 6170 7065 6e64 2863 6f76  ovs_n.append(cov
+0000a4f0: 5f6e 290d 0a20 2020 2020 2020 2072 6574  _n)..        ret
+0000a500: 7572 6e20 6e70 2e61 7272 6179 2864 636f  urn np.array(dco
+0000a510: 7673 292c 206e 702e 6172 7261 7928 6463  vs), np.array(dc
+0000a520: 6f76 735f 6e29 0d0a 0d0a 0d0a 2020 2020  ovs_n)......    
+0000a530: 6465 6620 7061 7474 6572 6e73 5f63 6f76  def patterns_cov
+0000a540: 5f78 7828 7365 6c66 2c20 792c 2077 6569  _xx(self, y, wei
+0000a550: 6768 7473 2c20 6163 7469 7661 7469 6f6e  ghts, activation
+0000a560: 732c 2064 636f 7629 3a0d 0a20 2020 2020  s, dcov):..     
+0000a570: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0000a580: 5820 2d20 5b69 2c2e 2e2e 2c6d 5d0d 0a20  X - [i,...,m].. 
+0000a590: 2020 2020 2020 2079 202d 205b 692c 2e2e         y - [i,..
+0000a5a0: 2e2c 6a5d 202d 2075 7365 6420 666f 7220  .,j] - used for 
+0000a5b0: 636f 765b 795d 0d0a 2020 2020 2020 2020  cov[y]..        
+0000a5c0: 7720 2d20 5b6b 2c2e 2e2e 2c6a 5d0d 0a20  w - [k,...,j].. 
+0000a5d0: 2020 2020 2020 2053 7820 2d20 5b6b 2c2e         Sx - [k,.
+0000a5e0: 2e2e 2c6d 6a5d 2222 220d 0a20 2020 2020  ..,mj]"""..     
+0000a5f0: 2020 2078 5f73 6861 7065 203d 206c 6973     x_shape = lis
+0000a600: 7428 6163 7469 7661 7469 6f6e 735b 2774  t(activations['t
+0000a610: 636f 6e76 275d 2e73 6861 7065 290d 0a20  conv'].shape).. 
+0000a620: 2020 2020 2020 2079 5f73 6861 7065 203d         y_shape =
+0000a630: 206c 6973 7428 792e 7368 6170 6529 0d0a   list(y.shape)..
+0000a640: 2020 2020 2020 2020 236f 7574 5f73 6861          #out_sha
+0000a650: 7065 203d 2078 5f73 6861 7065 5b31 3a5d  pe = x_shape[1:]
+0000a660: 202b 2079 5f73 6861 7065 5b31 3a5d 0d0a   + y_shape[1:]..
+0000a670: 2020 2020 2020 2020 2370 7269 6e74 2878          #print(x
+0000a680: 5f73 6861 7065 2c20 795f 7368 6170 652c  _shape, y_shape,
+0000a690: 2077 6569 6768 7473 5b27 6f75 745f 7765   weights['out_we
+0000a6a0: 6967 6874 7327 5d2e 7368 6170 6529 0d0a  ights'].shape)..
+0000a6b0: 2020 2020 2020 2020 6464 6f66 203d 2061          ddof = a
+0000a6c0: 6374 6976 6174 696f 6e73 5b27 7463 6f6e  ctivations['tcon
+0000a6d0: 7627 5d2e 7368 6170 655b 305d 202d 2031  v'].shape[0] - 1
+0000a6e0: 0d0a 2020 2020 2020 2020 5820 3d20 6e70  ..        X = np
+0000a6f0: 2e72 6573 6861 7065 2861 6374 6976 6174  .reshape(activat
+0000a700: 696f 6e73 5b27 7463 6f6e 7627 5d2c 205b  ions['tconv'], [
+0000a710: 6163 7469 7661 7469 6f6e 735b 2774 636f  activations['tco
+0000a720: 6e76 275d 2e73 6861 7065 5b30 5d2c 202d  nv'].shape[0], -
+0000a730: 315d 290d 0a20 2020 2020 2020 2079 203d  1])..        y =
+0000a740: 206e 702e 7265 7368 6170 6528 792c 205b   np.reshape(y, [
+0000a750: 792e 7368 6170 655b 305d 2c20 2d31 5d29  y.shape[0], -1])
+0000a760: 0d0a 0d0a 2020 2020 2020 2020 7720 3d20  ....        w = 
+0000a770: 6e70 2e72 6573 6861 7065 2877 6569 6768  np.reshape(weigh
+0000a780: 7473 5b27 6f75 745f 7765 6967 6874 7327  ts['out_weights'
+0000a790: 5d2c 205b 2d31 2c20 7765 6967 6874 735b  ], [-1, weights[
+0000a7a0: 276f 7574 5f77 6569 6768 7473 275d 2e73  'out_weights'].s
+0000a7b0: 6861 7065 5b2d 315d 5d29 0d0a 2020 2020  hape[-1]])..    
+0000a7c0: 2020 2020 6173 7365 7274 2858 2e73 6861      assert(X.sha
+0000a7d0: 7065 5b2d 315d 203d 3d20 772e 7368 6170  pe[-1] == w.shap
+0000a7e0: 655b 305d 292c 2027 5368 6170 6520 6d69  e[0]), 'Shape mi
+0000a7f0: 736d 6174 6368 2058 3a7b 7d20 773a 7b7d  smatch X:{} w:{}
+0000a800: 272e 666f 726d 6174 2858 2e73 6861 7065  '.format(X.shape
+0000a810: 2c20 772e 7368 6170 6529 0d0a 2020 2020  , w.shape)..    
+0000a820: 2020 2020 6173 7365 7274 2879 2e73 6861      assert(y.sha
+0000a830: 7065 5b2d 315d 203d 3d20 772e 7368 6170  pe[-1] == w.shap
+0000a840: 655b 315d 292c 2027 5368 6170 6520 6d69  e[1]), 'Shape mi
+0000a850: 736d 6174 6368 2079 3a7b 7d20 773a 7b7d  smatch y:{} w:{}
+0000a860: 272e 666f 726d 6174 2879 2e73 6861 7065  '.format(y.shape
+0000a870: 2c20 772e 7368 6170 6529 0d0a 2020 2020  , w.shape)..    
+0000a880: 2020 2020 5820 3d20 5820 2d20 582e 6d65      X = X - X.me
+0000a890: 616e 2830 2c20 6b65 6570 6469 6d73 3d54  an(0, keepdims=T
+0000a8a0: 7275 6529 0d0a 2020 2020 2020 2020 636f  rue)..        co
+0000a8b0: 765f 7878 203d 206e 702e 6569 6e73 756d  v_xx = np.einsum
+0000a8c0: 2827 696b 202c 696a 202d 3e20 6b6a 2027  ('ik ,ij -> kj '
+0000a8d0: 2c20 582c 2058 2920 2f20 6464 6f66 0d0a  , X, X) / ddof..
+0000a8e0: 0d0a 2020 2020 2020 2020 2363 6f6d 7075  ..        #compu
+0000a8f0: 7465 2069 6e76 6572 7365 2063 6f76 6172  te inverse covar
+0000a900: 6961 6e63 6520 6f66 2074 6865 206f 7574  iance of the out
+0000a910: 7075 740d 0a20 2020 2020 2020 2063 6f76  put..        cov
+0000a920: 5f79 7920 3d20 6e70 2e65 696e 7375 6d28  _yy = np.einsum(
+0000a930: 2769 6a2c 2069 6b20 2d3e 206a 6b27 2c20  'ij, ik -> jk', 
+0000a940: 792c 2079 2920 2f20 6464 6f66 0d0a 2020  y, y) / ddof..  
+0000a950: 2020 2020 2020 7072 6563 5f79 7920 3d20        prec_yy = 
+0000a960: 7466 2e6c 696e 616c 672e 7069 6e76 2863  tf.linalg.pinv(c
+0000a970: 6f76 5f79 7929 0d0a 0d0a 2020 2020 2020  ov_yy)....      
+0000a980: 2020 2363 6f6d 7075 7465 2064 6972 6563    #compute direc
+0000a990: 7469 6f6e 7320 6f66 2053 783a 2061 203d  tions of Sx: a =
+0000a9a0: 2063 6f76 5f78 792a 2863 6f76 5f79 7929   cov_xy*(cov_yy)
+0000a9b0: 2a2a 2d31 0d0a 2020 2020 2020 2020 615f  **-1..        a_
+0000a9c0: 6f75 7420 3d20 6e70 2e65 696e 7375 6d28  out = np.einsum(
+0000a9d0: 2769 692c 2069 6a2c 206a 6a20 2d3e 2069  'ii, ij, jj -> i
+0000a9e0: 6a27 2c20 636f 765f 7878 2c20 772c 2070  j', cov_xx, w, p
+0000a9f0: 7265 635f 7979 290d 0a0d 0a20 2020 2020  rec_yy)....     
+0000aa00: 2020 2023 2041 2e2a 770d 0a20 2020 2020     # A.*w..     
+0000aa10: 2020 2023 6177 203d 2061 5f6f 7574 202a     #aw = a_out *
+0000aa20: 2077 2023 7368 6170 6520 3d20 5b2e 2e2e   w #shape = [...
+0000aa30: 5d0d 0a20 2020 2020 2020 2023 2061 6374  ]..        # act
+0000aa40: 6976 6174 696f 6e20 6f66 2074 636f 6e76  ivation of tconv
+0000aa50: 2062 7920 6561 6368 2073 6967 6e61 6c20   by each signal 
+0000aa60: 636f 6d70 6f6e 656e 7420 6f66 2065 6163  component of eac
+0000aa70: 6820 7361 6d70 6c65 0d0a 2020 2020 2020  h sample..      
+0000aa80: 2020 5378 203d 206e 702e 6569 6e73 756d    Sx = np.einsum
+0000aa90: 2827 696c 2c20 696c 2c20 6a69 202d 3e20  ('il, il, ji -> 
+0000aaa0: 6a69 6c27 2c20 615f 6f75 742c 2077 2c20  jil', a_out, w, 
+0000aab0: 5829 0d0a 2020 2020 2020 2020 5378 203d  X)..        Sx =
+0000aac0: 206e 702e 7265 7368 6170 6528 5378 2c20   np.reshape(Sx, 
+0000aad0: 5b2d 312c 2078 5f73 6861 7065 5b2d 315d  [-1, x_shape[-1]
+0000aae0: 2c20 795f 7368 6170 655b 2d31 5d5d 290d  , y_shape[-1]]).
+0000aaf0: 0a20 2020 2020 2020 2053 7820 3d20 5378  .        Sx = Sx
+0000ab00: 202d 2053 782e 6d65 616e 2831 2c20 6b65   - Sx.mean(1, ke
+0000ab10: 6570 6469 6d73 3d54 7275 6529 0d0a 2020  epdims=True)..  
+0000ab20: 2020 2020 2020 6464 6f66 203d 2053 782e        ddof = Sx.
+0000ab30: 7368 6170 655b 305d 202d 2031 0d0a 2020  shape[0] - 1..  
+0000ab40: 2020 2020 2020 636f 765f 7378 203d 206e        cov_sx = n
+0000ab50: 702e 6569 6e73 756d 2827 696a 6b2c 2069  p.einsum('ijk, i
+0000ab60: 6c6b 202d 3e20 6a6c 6b27 2c20 5378 2c20  lk -> jlk', Sx, 
+0000ab70: 5378 2920 2f20 6464 6f66 0d0a 0d0a 2020  Sx) / ddof....  
+0000ab80: 2020 2020 2020 7061 7474 6572 6e73 203d        patterns =
+0000ab90: 205b 5d0d 0a20 2020 2020 2020 2023 6463   []..        #dc
+0000aba0: 203d 2064 636f 765b 2769 6e70 7574 5f73   = dcov['input_s
+0000abb0: 7061 7469 616c 275d 0d0a 2020 2020 2020  patial']..      
+0000abc0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+0000abd0: 2879 2e73 6861 7065 5b2d 315d 293a 0d0a  (y.shape[-1]):..
+0000abe0: 2020 2020 2020 2020 2020 2020 7072 6563              prec
+0000abf0: 5f73 7820 3d20 6e70 2e6c 696e 616c 672e  _sx = np.linalg.
+0000ac00: 7069 6e76 2863 6f76 5f73 785b 2e2e 2e2c  pinv(cov_sx[...,
+0000ac10: 695d 290d 0a20 2020 2020 2020 2020 2020  i])..           
+0000ac20: 2064 6320 3d20 6463 6f76 5b27 636c 6173   dc = dcov['clas
+0000ac30: 735f 636f 6e64 6974 696f 6e61 6c27 5d5b  s_conditional'][
+0000ac40: 695d 0d0a 2020 2020 2020 2020 2020 2020  i]..            
+0000ac50: 7061 7474 6572 6e73 2e61 7070 656e 6428  patterns.append(
+0000ac60: 6e70 2e65 696e 7375 6d28 2768 692c 2069  np.einsum('hi, i
+0000ac70: 6a2c 206a 6b20 2d3e 2068 272c 0d0a 2020  j, jk -> h',..  
+0000ac80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acb0: 2020 2020 5378 5f74 636f 6e76 2c0d 0a20      Sx_tconv,.. 
-0000acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ace0: 2020 2077 6569 6768 7473 5b27 646d 7827     weights['dmx'
-0000acf0: 5d29 0d0a 2020 2020 2020 2020 7265 7475  ])..        retu
-0000ad00: 726e 2053 785f 7463 6f6e 762c 2053 785f  rn Sx_tconv, Sx_
-0000ad10: 646d 780d 0a0d 0a0d 0a20 2020 2064 6566  dmx......    def
-0000ad20: 2062 6163 6b70 726f 705f 6663 2873 656c   backprop_fc(sel
-0000ad30: 662c 2058 2c20 795f 6861 742c 2079 2c20  f, X, y_hat, y, 
-0000ad40: 7729 3a0d 0a20 2020 2020 2020 2022 2222  w):..        """
-0000ad50: 0d0a 2020 2020 2020 2020 5820 2d20 5b69  ..        X - [i
-0000ad60: 2c2e 2e2e 2c6d 5d0d 0a20 2020 2020 2020  ,...,m]..       
-0000ad70: 2079 202d 205b 692c 2e2e 2e2c 6a5d 0d0a   y - [i,...,j]..
-0000ad80: 2020 2020 2020 2020 7720 2d20 5b6b 2c2e          w - [k,.
-0000ad90: 2e2e 2c6a 5d0d 0a20 2020 2020 2020 2053  ..,j]..        S
-0000ada0: 7820 2d20 5b6b 2c2e 2e2e 2c6d 6a5d 2222  x - [k,...,mj]""
-0000adb0: 220d 0a20 2020 2020 2020 2078 5f73 6861  "..        x_sha
-0000adc0: 7065 203d 206c 6973 7428 582e 7368 6170  pe = list(X.shap
-0000add0: 6529 0d0a 2020 2020 2020 2020 795f 7368  e)..        y_sh
-0000ade0: 6170 6520 3d20 6c69 7374 2879 5f68 6174  ape = list(y_hat
-0000adf0: 2e73 6861 7065 290d 0a20 2020 2020 2020  .shape)..       
-0000ae00: 2023 6f75 745f 7368 6170 6520 3d20 785f   #out_shape = x_
-0000ae10: 7368 6170 655b 313a 5d20 2b20 795f 7368  shape[1:] + y_sh
-0000ae20: 6170 655b 313a 5d0d 0a20 2020 2020 2020  ape[1:]..       
-0000ae30: 2023 7072 696e 7428 785f 7368 6170 652c   #print(x_shape,
-0000ae40: 2079 5f73 6861 7065 2c20 772e 7368 6170   y_shape, w.shap
-0000ae50: 6529 0d0a 2020 2020 2020 2020 6464 6f66  e)..        ddof
-0000ae60: 203d 2058 2e73 6861 7065 5b30 5d20 2d20   = X.shape[0] - 
-0000ae70: 310d 0a20 2020 2020 2020 2058 203d 206e  1..        X = n
-0000ae80: 702e 7265 7368 6170 6528 582c 205b 582e  p.reshape(X, [X.
-0000ae90: 7368 6170 655b 305d 2c20 2d31 5d29 0d0a  shape[0], -1])..
-0000aea0: 2020 2020 2020 2020 7920 3d20 6e70 2e72          y = np.r
-0000aeb0: 6573 6861 7065 2879 2c20 5b79 2e73 6861  eshape(y, [y.sha
-0000aec0: 7065 5b30 5d2c 202d 315d 290d 0a20 2020  pe[0], -1])..   
-0000aed0: 2020 2020 2079 5f68 6174 203d 206e 702e       y_hat = np.
-0000aee0: 7265 7368 6170 6528 795f 6861 742c 205b  reshape(y_hat, [
-0000aef0: 795f 6861 742e 7368 6170 655b 305d 2c20  y_hat.shape[0], 
-0000af00: 2d31 5d29 0d0a 2020 2020 2020 2020 7720  -1])..        w 
-0000af10: 3d20 6e70 2e72 6573 6861 7065 2877 2c20  = np.reshape(w, 
-0000af20: 5b2d 312c 2077 2e73 6861 7065 5b2d 315d  [-1, w.shape[-1]
-0000af30: 5d29 0d0a 0d0a 2020 2020 2020 2020 6173  ])....        as
-0000af40: 7365 7274 2858 2e73 6861 7065 5b2d 315d  sert(X.shape[-1]
-0000af50: 203d 3d20 772e 7368 6170 655b 305d 292c   == w.shape[0]),
-0000af60: 2027 5368 6170 6520 6d69 736d 6174 6368   'Shape mismatch
-0000af70: 2058 3a7b 7d20 773a 7b7d 272e 666f 726d   X:{} w:{}'.form
-0000af80: 6174 2858 2e73 6861 6570 2c20 772e 7368  at(X.shaep, w.sh
-0000af90: 6170 6529 0d0a 2020 2020 2020 2020 6173  ape)..        as
-0000afa0: 7365 7274 2879 5f68 6174 2e73 6861 7065  sert(y_hat.shape
-0000afb0: 5b2d 315d 203d 3d20 772e 7368 6170 655b  [-1] == w.shape[
-0000afc0: 315d 292c 2027 5368 6170 6520 6d69 736d  1]), 'Shape mism
-0000afd0: 6174 6368 2079 3a7b 7d20 773a 7b7d 272e  atch y:{} w:{}'.
-0000afe0: 666f 726d 6174 2879 5f68 6174 2e73 6861  format(y_hat.sha
-0000aff0: 7065 2c20 772e 7368 6170 6529 0d0a 2020  pe, w.shape)..  
-0000b000: 2020 2020 2020 5820 3d20 5820 2d20 582e        X = X - X.
-0000b010: 6d65 616e 2830 2c20 6b65 6570 6469 6d73  mean(0, keepdims
-0000b020: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-0000b030: 795f 6861 7420 3d20 795f 6861 7420 2d20  y_hat = y_hat - 
-0000b040: 795f 6861 742e 6d65 616e 2830 2c20 6b65  y_hat.mean(0, ke
-0000b050: 6570 6469 6d73 3d54 7275 6529 0d0a 2020  epdims=True)..  
-0000b060: 2020 2020 2020 7920 3d20 7920 2d20 792e        y = y - y.
-0000b070: 6d65 616e 2830 2c20 6b65 6570 6469 6d73  mean(0, keepdims
-0000b080: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-0000b090: 636f 765f 7879 203d 206e 702e 6569 6e73  cov_xy = np.eins
-0000b0a0: 756d 2827 696b 202c 696a 202d 3e20 6b6a  um('ik ,ij -> kj
-0000b0b0: 2027 2c20 582c 2079 5f68 6174 2920 2f20   ', X, y_hat) / 
-0000b0c0: 6464 6f66 0d0a 2020 2020 2020 2020 2363  ddof..        #c
-0000b0d0: 6f76 5f78 7920 3d20 6e70 2e63 6f76 2858  ov_xy = np.cov(X
-0000b0e0: 2c20 7929 0d0a 0d0a 0d0a 2020 2020 2020  , y)......      
-0000b0f0: 2020 2363 6f6d 7075 7465 2069 6e76 6572    #compute inver
-0000b100: 7365 2063 6f76 6172 6961 6e63 6520 6f66  se covariance of
-0000b110: 2074 6865 206f 7574 7075 740d 0a20 2020   the output..   
-0000b120: 2020 2020 2023 636f 765f 7979 203d 206e       #cov_yy = n
-0000b130: 702e 6569 6e73 756d 2827 696a 2c20 696b  p.einsum('ij, ik
-0000b140: 202d 3e20 6a6b 272c 2079 5f68 6174 2c20   -> jk', y_hat, 
-0000b150: 795f 6861 7429 202f 2064 646f 660d 0a20  y_hat) / ddof.. 
-0000b160: 2020 2020 2020 2063 6f76 5f79 7920 3d20         cov_yy = 
-0000b170: 6e70 2e65 696e 7375 6d28 2769 6a2c 2069  np.einsum('ij, i
-0000b180: 6b20 2d3e 206a 6b27 2c20 792c 2079 2920  k -> jk', y, y) 
-0000b190: 2f20 6464 6f66 0d0a 2020 2020 2020 2020  / ddof..        
-0000b1a0: 7072 6563 5f79 7920 3d20 7466 2e6c 696e  prec_yy = tf.lin
-0000b1b0: 616c 672e 696e 7628 636f 765f 7979 290d  alg.inv(cov_yy).
-0000b1c0: 0a0d 0a20 2020 2020 2020 2023 636f 6d70  ...        #comp
-0000b1d0: 7574 6520 6469 7265 6374 696f 6e73 206f  ute directions o
-0000b1e0: 6620 5378 3a20 6120 3d20 636f 765f 7879  f Sx: a = cov_xy
-0000b1f0: 2a28 636f 765f 7979 292a 2a2d 310d 0a20  *(cov_yy)**-1.. 
-0000b200: 2020 2020 2020 2061 5f6f 7574 203d 206e         a_out = n
-0000b210: 702e 6569 6e73 756d 2827 6a6b 2c20 6b6c  p.einsum('jk, kl
-0000b220: 202d 3e20 6a6c 272c 2063 6f76 5f78 792c   -> jl', cov_xy,
-0000b230: 2070 7265 635f 7979 2920 2373 6861 7065   prec_yy) #shape
-0000b240: 203d 205b 6e5f 745f 706f 6f6c 6564 2c20   = [n_t_pooled, 
-0000b250: 6e5f 6c61 7465 6e74 2c20 6e5f 636c 6173  n_latent, n_clas
-0000b260: 7365 735d 0d0a 0d0a 2020 2020 2020 2020  ses]....        
-0000b270: 2320 412e 2a77 0d0a 2020 2020 2020 2020  # A.*w..        
-0000b280: 2361 7720 3d20 615f 6f75 7420 2a20 7720  #aw = a_out * w 
-0000b290: 2373 6861 7065 203d 205b 2e2e 2e5d 0d0a  #shape = [...]..
-0000b2a0: 2020 2020 2020 2020 2320 6163 7469 7661          # activa
-0000b2b0: 7469 6f6e 206f 6620 7463 6f6e 7620 6279  tion of tconv by
-0000b2c0: 2065 6163 6820 7369 676e 616c 2063 6f6d   each signal com
-0000b2d0: 706f 6e65 6e74 206f 6620 6561 6368 2073  ponent of each s
-0000b2e0: 616d 706c 650d 0a20 2020 2020 2020 2023  ample..        #
-0000b2f0: 5378 203d 206e 702e 6569 6e73 756d 2827  Sx = np.einsum('
-0000b300: 696c 2c20 6b6c 202d 3e20 696b 272c 2079  il, kl -> ik', y
-0000b310: 5f68 6174 2c20 6177 2920 2373 6861 7065  _hat, aw) #shape
-0000b320: 203d 205b 6e5f 6261 7463 682c 202e 2e2e   = [n_batch, ...
-0000b330: 5d0d 0a20 2020 2020 2020 2053 7820 3d20  ]..        Sx = 
-0000b340: 6e70 2e65 696e 7375 6d28 2769 6c2c 2069  np.einsum('il, i
-0000b350: 6c2c 206a 6920 2d3e 206a 696c 272c 2061  l, ji -> jil', a
-0000b360: 5f6f 7574 2c20 772c 2058 290d 0a20 2020  _out, w, X)..   
-0000b370: 2020 2020 2053 7820 3d20 6e70 2e73 7175       Sx = np.squ
-0000b380: 6565 7a65 286e 702e 7265 7368 6170 6528  eeze(np.reshape(
-0000b390: 5378 2c20 785f 7368 6170 6520 2b20 795f  Sx, x_shape + y_
-0000b3a0: 7368 6170 655b 313a 5d29 290d 0a20 2020  shape[1:]))..   
-0000b3b0: 2020 2020 2072 6574 7572 6e20 5378 0d0a       return Sx..
-0000b3c0: 0d0a 2020 2020 6465 6620 6261 636b 7072  ..    def backpr
-0000b3d0: 6f70 5f63 6f76 7879 2873 656c 662c 2058  op_covxy(self, X
-0000b3e0: 2c20 4878 2c20 5378 2c20 7729 3a0d 0a20  , Hx, Sx, w):.. 
-0000b3f0: 2020 2020 2020 2078 646d 7820 3d20 6e70         xdmx = np
-0000b400: 2e72 6573 6861 7065 2848 782c 205b 2d31  .reshape(Hx, [-1
-0000b410: 2c20 4878 2e73 6861 7065 5b2d 315d 5d29  , Hx.shape[-1]])
-0000b420: 0d0a 2020 2020 2020 2020 7864 6d78 203d  ..        xdmx =
-0000b430: 2078 646d 7820 2d20 7864 6d78 2e6d 6561   xdmx - xdmx.mea
-0000b440: 6e28 302c 206b 6565 7064 696d 733d 5472  n(0, keepdims=Tr
-0000b450: 7565 290d 0a20 2020 2020 2020 2078 696e  ue)..        xin
-0000b460: 7020 3d20 6e70 2e72 6573 6861 7065 2858  p = np.reshape(X
-0000b470: 2c20 5b2d 312c 2058 2e73 6861 7065 5b2d  , [-1, X.shape[-
-0000b480: 315d 5d29 0d0a 2020 2020 2020 2020 7869  1]])..        xi
-0000b490: 6e70 203d 2078 696e 7020 2d20 7869 6e70  np = xinp - xinp
-0000b4a0: 2e6d 6561 6e28 302c 206b 6565 7064 696d  .mean(0, keepdim
-0000b4b0: 733d 5472 7565 290d 0a20 2020 2020 2020  s=True)..       
-0000b4c0: 2063 6f76 5f78 7920 3d20 6e70 2e64 6f74   cov_xy = np.dot
-0000b4d0: 2878 696e 702e 542c 2078 646d 7829 0d0a  (xinp.T, xdmx)..
-0000b4e0: 2020 2020 2020 2020 6177 203d 2063 6f76          aw = cov
-0000b4f0: 5f78 790d 0a20 2020 2020 2020 2073 7820  _xy..        sx 
-0000b500: 3d20 6e70 2e72 6573 6861 7065 2853 782c  = np.reshape(Sx,
-0000b510: 205b 2d31 2c20 5378 2e73 6861 7065 5b2d   [-1, Sx.shape[-
-0000b520: 325d 2c20 5378 2e73 6861 7065 5b2d 315d  2], Sx.shape[-1]
-0000b530: 5d29 0d0a 2020 2020 2020 2020 7378 203d  ])..        sx =
-0000b540: 2073 7820 2d20 7378 2e6d 6561 6e28 302c   sx - sx.mean(0,
-0000b550: 206b 6565 7064 696d 733d 5472 7565 290d   keepdims=True).
-0000b560: 0a20 2020 2020 2020 2064 646f 6620 3d20  .        ddof = 
-0000b570: 7378 2e73 6861 7065 5b30 5d20 2d20 310d  sx.shape[0] - 1.
-0000b580: 0a20 2020 2020 2020 2063 6f76 5f73 7820  .        cov_sx 
-0000b590: 3d20 6e70 2e65 696e 7375 6d28 2769 6a6b  = np.einsum('ijk
-0000b5a0: 2c20 696c 6b20 2d3e 206b 6a6c 272c 2073  , ilk -> kjl', s
-0000b5b0: 782c 7378 2920 2f20 6464 6f66 0d0a 2020  x,sx) / ddof..  
-0000b5c0: 2020 2020 2020 7072 6563 5f79 795f 6861        prec_yy_ha
-0000b5d0: 7420 3d20 6e70 2e73 7461 636b 285b 6e70  t = np.stack([np
-0000b5e0: 2e6c 696e 616c 672e 7069 6e76 2873 2920  .linalg.pinv(s) 
-0000b5f0: 666f 7220 7320 696e 2063 6f76 5f73 785d  for s in cov_sx]
-0000b600: 290d 0a20 2020 2020 2020 2077 7720 3d20  )..        ww = 
-0000b610: 6e70 2e65 696e 7375 6d28 2769 6a2c 206c  np.einsum('ij, l
-0000b620: 6a6b 202d 3e20 696b 6c27 2c20 772c 2070  jk -> ikl', w, p
-0000b630: 7265 635f 7979 5f68 6174 290d 0a20 2020  rec_yy_hat)..   
-0000b640: 2020 2020 2061 203d 206e 702e 6569 6e73       a = np.eins
-0000b650: 756d 2827 696a 2c20 696a 6b20 2d3e 2069  um('ij, ijk -> i
-0000b660: 6b27 2c20 636f 765f 7879 2c20 7777 290d  k', cov_xy, ww).
-0000b670: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
-0000b680: 6e20 610d 0a0d 0a20 2020 2020 2020 2023  n a....        #
-0000b690: 2070 7269 6e74 2863 6f76 5f78 792e 7368   print(cov_xy.sh
-0000b6a0: 6170 6529 0d0a 2020 2020 2020 2020 2320  ape)..        # 
-0000b6b0: 7061 7474 6572 6e73 203d 205b 5d0d 0a20  patterns = [].. 
-0000b6c0: 2020 2020 2020 2023 2066 6f72 2063 6c61         # for cla
-0000b6d0: 7373 5f79 2069 6e20 7261 6e67 6528 5378  ss_y in range(Sx
-0000b6e0: 2e73 6861 7065 5b2d 315d 293a 0d0a 2020  .shape[-1]):..  
-0000b6f0: 2020 2020 2020 2320 2020 2020 7378 203d        #     sx =
-0000b700: 206e 702e 7265 7368 6170 6528 5378 2c20   np.reshape(Sx, 
-0000b710: 5b2d 312c 2053 782e 7368 6170 655b 2d32  [-1, Sx.shape[-2
-0000b720: 5d2c 2053 782e 7368 6170 655b 2d31 5d5d  ], Sx.shape[-1]]
-0000b730: 290d 0a20 2020 2020 2020 2023 2020 2020  )..        #    
-0000b740: 2073 7820 2d3d 2073 782e 6d65 616e 2830   sx -= sx.mean(0
-0000b750: 2c20 6b65 6570 6469 6d73 3d54 7275 6529  , keepdims=True)
-0000b760: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
-0000b770: 7072 6563 5f73 7820 3d20 6e70 2e6c 696e  prec_sx = np.lin
-0000b780: 616c 672e 696e 7628 6e70 2e64 6f74 2873  alg.inv(np.dot(s
-0000b790: 782e 542c 2073 7829 290d 0a0d 0a20 2020  x.T, sx))....   
-0000b7a0: 2020 2020 2023 2020 2020 2061 7720 3d20       #     aw = 
-0000b7b0: 6e70 2e64 6f74 2863 6f76 5f78 792c 2070  np.dot(cov_xy, p
-0000b7c0: 7265 635f 7378 2920 2a20 770d 0a20 2020  rec_sx) * w..   
-0000b7d0: 2020 2020 2023 2020 2020 2023 636f 6d70       #     #comp
-0000b7e0: 6f6e 656e 745f 6163 7469 7661 7469 6f6e  onent_activation
-0000b7f0: 7320 3d20 6e70 2e64 6f74 2861 772c 2070  s = np.dot(aw, p
-0000b800: 7265 635f 7378 290d 0a20 2020 2020 2020  rec_sx)..       
-0000b810: 2023 2020 2020 2070 6174 7465 726e 732e   #     patterns.
-0000b820: 6170 7065 6e64 2861 772e 7375 6d28 2d31  append(aw.sum(-1
-0000b830: 2929 0d0a 0d0a 2020 2020 2020 2020 2320  ))....        # 
-0000b840: 7265 7475 726e 206e 702e 7374 6163 6b28  return np.stack(
-0000b850: 7061 7474 6572 6e73 2c20 3129 0d0a 0d0a  patterns, 1)....
-0000b860: 2020 2020 2320 6465 6620 6261 636b 7072      # def backpr
-0000b870: 6f70 5f64 6d78 2873 656c 662c 2058 2c20  op_dmx(self, X, 
-0000b880: 795f 6861 742c 2079 2c20 7729 3a0d 0a20  y_hat, y, w):.. 
-0000b890: 2020 2023 2020 2020 2078 5f73 6861 7065     #     x_shape
-0000b8a0: 203d 206c 6973 7428 582e 7368 6170 6529   = list(X.shape)
-0000b8b0: 0d0a 2020 2020 2320 2020 2020 795f 7368  ..    #     y_sh
-0000b8c0: 6170 6520 3d20 6c69 7374 2879 5f68 6174  ape = list(y_hat
-0000b8d0: 2e73 6861 7065 290d 0a20 2020 2023 2020  .shape)..    #  
-0000b8e0: 2020 206b 203d 2079 2e73 6861 7065 5b2d     k = y.shape[-
-0000b8f0: 315d 0d0a 2020 2020 2320 2020 2020 795f  1]..    #     y_
-0000b900: 6861 7420 3d20 6e70 2e72 6573 6861 7065  hat = np.reshape
-0000b910: 2879 5f68 6174 2c20 5b79 5f68 6174 2e73  (y_hat, [y_hat.s
-0000b920: 6861 7065 5b30 5d2c 202d 315d 290d 0a20  hape[0], -1]).. 
-0000b930: 2020 2023 2020 2020 2023 6f75 745f 7368     #     #out_sh
-0000b940: 6170 6520 3d20 785f 7368 6170 655b 313a  ape = x_shape[1:
-0000b950: 5d20 2b20 795f 7368 6170 655b 313a 5d0d  ] + y_shape[1:].
-0000b960: 0a20 2020 2023 2020 2020 2023 7072 696e  .    #     #prin
-0000b970: 7428 785f 7368 6170 652c 2079 5f73 6861  t(x_shape, y_sha
-0000b980: 7065 2c20 772e 7368 6170 6529 0d0a 2020  pe, w.shape)..  
-0000b990: 2020 2320 2020 2020 6464 6f66 5f78 7920    #     ddof_xy 
-0000b9a0: 3d20 6e70 2e70 726f 6428 785f 7368 6170  = np.prod(x_shap
-0000b9b0: 655b 3a33 5d29 202d 2031 0d0a 2020 2020  e[:3]) - 1..    
-0000b9c0: 2320 2020 2020 6464 6f66 5f79 7920 3d20  #     ddof_yy = 
-0000b9d0: 6e70 2e70 726f 6428 795f 7368 6170 655b  np.prod(y_shape[
-0000b9e0: 3a33 5d29 202d 2031 0d0a 0d0a 2020 2020  :3]) - 1....    
-0000b9f0: 2320 2020 2020 636f 765f 7879 203d 206e  #     cov_xy = n
-0000ba00: 702e 6569 6e73 756d 2827 696a 6b6c 2c20  p.einsum('ijkl, 
-0000ba10: 696a 6d6e 202d 3e20 6c6e 6d27 2c20 582c  ijmn -> lnm', X,
-0000ba20: 2079 5f68 6174 2920 2f20 6464 6f66 5f78   y_hat) / ddof_x
-0000ba30: 7920 2373 6861 7065 203d 205b 6e5f 6368  y #shape = [n_ch
-0000ba40: 2c20 6e5f 6c61 746e 6574 2c20 6e5f 6269  , n_latnet, n_bi
-0000ba50: 6e73 5d0d 0a20 2020 2023 2020 2020 2063  ns]..    #     c
-0000ba60: 6f76 5f79 7920 3d20 6e70 2e65 696e 7375  ov_yy = np.einsu
-0000ba70: 6d28 2769 6a6b 6c2c 2069 6a6b 6d20 2d3e  m('ijkl, ijkm ->
-0000ba80: 206b 6c6d 272c 2079 5f68 6174 2c20 795f   klm', y_hat, y_
-0000ba90: 6861 7429 202f 2064 646f 665f 7979 0d0a  hat) / ddof_yy..
-0000baa0: 2020 2020 2320 2020 2020 7072 6563 5f79      #     prec_y
-0000bab0: 7920 3d20 6e70 2e61 7272 6179 285b 6e70  y = np.array([np
-0000bac0: 2e6c 696e 616c 672e 696e 7628 6376 7929  .linalg.inv(cvy)
-0000bad0: 2066 6f72 2063 7679 2069 6e20 636f 765f   for cvy in cov_
-0000bae0: 7979 5d29 0d0a 2020 2020 2320 2020 2020  yy])..    #     
-0000baf0: 615f 6f75 7420 3d20 6e70 2e65 696e 7375  a_out = np.einsu
-0000bb00: 6d28 276a 6b6d 2c20 6d6b 6c20 2d3e 206a  m('jkm, mkl -> j
-0000bb10: 6c6d 272c 2063 6f76 5f78 792c 2070 7265  lm', cov_xy, pre
-0000bb20: 635f 7979 290d 0a20 2020 2023 2020 2020  c_yy)..    #    
-0000bb30: 2061 7720 3d20 615f 6f75 7420 2a20 775b   aw = a_out * w[
-0000bb40: 2e2e 2e2c 204e 6f6e 655d 0d0a 2020 2020  ..., None]..    
-0000bb50: 2320 2020 2020 2320 6163 7469 7661 7469  #     # activati
-0000bb60: 6f6e 206f 6620 7463 6f6e 7620 6279 2065  on of tconv by e
-0000bb70: 6163 6820 7369 676e 616c 2063 6f6d 706f  ach signal compo
-0000bb80: 6e65 6e74 206f 6620 6561 6368 2073 616d  nent of each sam
-0000bb90: 706c 650d 0a20 2020 2023 2020 2020 2053  ple..    #     S
-0000bba0: 7820 3d20 6e70 2e65 696e 7375 6d28 2769  x = np.einsum('i
-0000bbb0: 6a6b 6c2c 2063 6c6b 202d 3e20 6963 6b27  jkl, clk -> ick'
-0000bbc0: 2c20 795f 6861 742c 2061 7729 2023 7368  , y_hat, aw) #sh
-0000bbd0: 6170 6520 3d20 5b6e 5f62 6174 6368 2c20  ape = [n_batch, 
-0000bbe0: 2e2e 2e5d 0d0a 0d0a 2020 2020 2320 2020  ...]....    #   
-0000bbf0: 2020 7265 7475 726e 2053 780d 0a0d 0a20    return Sx.... 
-0000bc00: 2020 2064 6566 2070 6174 7465 726e 735f     def patterns_
-0000bc10: 7069 6e76 5f77 2873 656c 662c 2079 2c20  pinv_w(self, y, 
-0000bc20: 7765 6967 6874 732c 2061 6374 6976 6174  weights, activat
-0000bc30: 696f 6e73 2c20 6463 6f76 293a 0d0a 2020  ions, dcov):..  
-0000bc40: 2020 2020 2020 636f 6d62 696e 6564 5f74        combined_t
-0000bc50: 6f70 6f73 203d 205b 5d0d 0a20 2020 2020  opos = []..     
-0000bc60: 2020 2070 696e 765f 646d 7820 3d20 6e70     pinv_dmx = np
-0000bc70: 2e6c 696e 616c 672e 7069 6e76 2877 6569  .linalg.pinv(wei
-0000bc80: 6768 7473 5b27 646d 7827 5d29 2e54 236e  ghts['dmx']).T#n
-0000bc90: 702e 646f 7428 7370 6174 6961 6c5f 6669  p.dot(spatial_fi
-0000bca0: 6c74 6572 732c 206e 702e 6c69 6e61 6c67  lters, np.linalg
-0000bcb0: 2e69 6e76 286e 702e 646f 7428 7370 6174  .inv(np.dot(spat
-0000bcc0: 6961 6c5f 6669 6c74 6572 732e 542c 2073  ial_filters.T, s
-0000bcd0: 7061 7469 616c 5f66 696c 7465 7273 2929  patial_filters))
-0000bce0: 290d 0a20 2020 2020 2020 2070 696e 765f  )..        pinv_
-0000bcf0: 7766 6320 3d20 6e70 2e6c 696e 616c 672e  wfc = np.linalg.
-0000bd00: 7069 6e76 2877 6569 6768 7473 5b27 6f75  pinv(weights['ou
-0000bd10: 745f 775f 666c 6174 275d 292e 5423 6e70  t_w_flat']).T#np
-0000bd20: 2e64 6f74 286f 7574 5f77 5f66 6c61 742c  .dot(out_w_flat,
-0000bd30: 206e 702e 6c69 6e61 6c67 2e69 6e76 286e   np.linalg.inv(n
-0000bd40: 702e 646f 7428 6f75 745f 775f 666c 6174  p.dot(out_w_flat
-0000bd50: 2e54 2c20 6f75 745f 775f 666c 6174 2929  .T, out_w_flat))
-0000bd60: 290d 0a20 2020 2020 2020 2070 696e 765f  )..        pinv_
-0000bd70: 7463 6b20 3d20 6e70 2e6c 696e 616c 672e  tck = np.linalg.
-0000bd80: 7069 6e76 2877 6569 6768 7473 5b27 7463  pinv(weights['tc
-0000bd90: 6f6e 7627 5d29 2e54 2023 6e70 2e64 6f74  onv']).T #np.dot
-0000bda0: 2874 636f 6e76 5f6b 6572 6e65 6c73 2c20  (tconv_kernels, 
-0000bdb0: 6e70 2e6c 696e 616c 672e 696e 7628 6e70  np.linalg.inv(np
-0000bdc0: 2e64 6f74 2874 636f 6e76 5f6b 6572 6e65  .dot(tconv_kerne
-0000bdd0: 6c73 2e54 2c20 7463 6f6e 765f 6b65 726e  ls.T, tconv_kern
-0000bde0: 656c 7329 2929 0d0a 0d0a 2020 2020 2020  els)))....      
-0000bdf0: 2020 234c 6561 7374 2073 7175 6172 6520    #Least square 
-0000be00: 7369 6e67 616c 2065 7374 696d 6174 6520  singal estimate 
-0000be10: 696e 2074 636f 6e76 2067 6976 656e 2077  in tconv given w
-0000be20: 6663 2061 6e64 2066 635f 6163 7469 7661  fc and fc_activa
-0000be30: 7469 6f6e 730d 0a20 2020 2020 2020 2053  tions..        S
-0000be40: 785f 7463 6f6e 7620 3d20 6e70 2e65 696e  x_tconv = np.ein
-0000be50: 7375 6d28 276a 6b2c 2069 6b20 2d3e 696a  sum('jk, ik ->ij
-0000be60: 272c 2070 696e 765f 7766 632c 2061 6374  ', pinv_wfc, act
-0000be70: 6976 6174 696f 6e73 5b27 6663 275d 290d  ivations['fc']).
-0000be80: 0a20 2020 2020 2020 2053 785f 7463 6f6e  .        Sx_tcon
-0000be90: 7620 3d20 6e70 2e72 6573 6861 7065 2853  v = np.reshape(S
-0000bea0: 785f 7463 6f6e 762c 2061 6374 6976 6174  x_tconv, activat
-0000beb0: 696f 6e73 5b27 7463 6f6e 7627 5d2e 7368  ions['tconv'].sh
-0000bec0: 6170 6529 0d0a 0d0a 2020 2020 2020 2020  ape)....        
-0000bed0: 2352 6576 6572 7365 2070 6f6f 6c69 6e67  #Reverse pooling
-0000bee0: 2061 6e64 2064 6570 7468 7769 7365 2063   and depthwise c
-0000bef0: 6f6e 766f 6c75 7469 6f6e 2066 6f72 2065  onvolution for e
-0000bf00: 6163 6820 636c 6173 730d 0a20 2020 2020  ach class..     
-0000bf10: 2020 2053 785f 646d 7820 3d20 5b5d 0d0a     Sx_dmx = []..
-0000bf20: 2020 2020 2020 2020 2364 6320 3d20 6463          #dc = dc
-0000bf30: 6f76 5b27 696e 7075 745f 7370 6174 6961  ov['input_spatia
-0000bf40: 6c27 5d0d 0a20 2020 2020 2020 2023 6e5f  l']..        #n_
-0000bf50: 7061 6464 696e 6720 3d20 7365 6c66 2e64  padding = self.d
-0000bf60: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
-0000bf70: 276e 5f74 275d 2573 656c 662e 7370 6563  'n_t']%self.spec
-0000bf80: 735b 2773 7472 6964 6527 5d0d 0a20 2020  s['stride']..   
-0000bf90: 2020 2020 2066 6f72 2063 6c61 7373 5f79       for class_y
-0000bfa0: 2069 6e20 7261 6e67 6528 7365 6c66 2e6f   in range(self.o
-0000bfb0: 7574 5f64 696d 293a 0d0a 2020 2020 2020  ut_dim):..      
-0000bfc0: 2020 2020 2020 636c 6173 735f 696e 6420        class_ind 
-0000bfd0: 3d20 7466 2e73 7175 6565 7a65 2874 662e  = tf.squeeze(tf.
-0000bfe0: 7768 6572 6528 7466 2e61 7267 6d61 7828  where(tf.argmax(
-0000bff0: 792c 2031 293d 3d63 6c61 7373 5f79 2929  y, 1)==class_y))
-0000c000: 235b 305d 0d0a 2020 2020 2020 2020 2020  #[0]..          
-0000c010: 2020 5378 6d20 3d20 6e70 2e73 7175 6565    Sxm = np.squee
-0000c020: 7a65 2853 785f 7463 6f6e 765b 636c 6173  ze(Sx_tconv[clas
-0000c030: 735f 696e 642c 203a 5d2e 6d65 616e 2830  s_ind, :].mean(0
-0000c040: 2c20 6b65 6570 6469 6d73 3d54 7275 6529  , keepdims=True)
-0000c050: 290d 0a20 2020 2020 2020 2020 2020 2053  )..            S
-0000c060: 786d 203d 206e 702e 6174 6c65 6173 745f  xm = np.atleast_
-0000c070: 3264 2853 786d 290d 0a20 2020 2020 2020  2d(Sxm)..       
-0000c080: 2020 2020 2064 6320 3d20 6463 6f76 5b27       dc = dcov['
-0000c090: 636c 6173 735f 636f 6e64 6974 696f 6e61  class_conditiona
-0000c0a0: 6c27 5d5b 636c 6173 735f 795d 0d0a 2020  l'][class_y]..  
-0000c0b0: 2020 2020 2020 2020 2020 636f 6d62 696e            combin
-0000c0c0: 6564 5f74 6f70 6f73 2e61 7070 656e 6428  ed_topos.append(
-0000c0d0: 6e70 2e65 696e 7375 6d28 2768 692c 696a  np.einsum('hi,ij
-0000c0e0: 2c74 6a2d 3e68 7427 2c0d 0a20 2020 2020  ,tj->ht',..     
-0000c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c110: 2020 2020 2020 2064 632c 0d0a 2020 2020         dc,..    
-0000c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c140: 2020 2020 2020 2020 7765 6967 6874 735b          weights[
-0000c150: 2764 6d78 275d 2c0d 0a20 2020 2020 2020  'dmx'],..       
-0000c160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c180: 2020 2020 2053 786d 2929 0d0a 2020 2020       Sxm))..    
-0000c190: 2020 2020 746f 706f 7320 3d20 6e70 2e73      topos = np.s
-0000c1a0: 7461 636b 2863 6f6d 6269 6e65 645f 746f  tack(combined_to
-0000c1b0: 706f 732c 2031 290d 0a20 2020 2020 2020  pos, 1)..       
-0000c1c0: 2072 6574 7572 6e20 746f 706f 730d 0a0d   return topos...
-0000c1d0: 0a0d 0a20 2020 2064 6566 2070 6174 7465  ...    def patte
-0000c1e0: 726e 735f 7766 635f 6d65 616e 2873 656c  rns_wfc_mean(sel
-0000c1f0: 662c 2079 2c20 7765 6967 6874 732c 2061  f, y, weights, a
-0000c200: 6374 6976 6174 696f 6e73 2c20 6463 6f76  ctivations, dcov
-0000c210: 293a 0d0a 2020 2020 2020 2020 636f 6d62  ):..        comb
-0000c220: 696e 6564 5f74 6f70 6f73 203d 205b 5d0d  ined_topos = [].
-0000c230: 0a20 2020 2020 2020 2023 7573 6573 2079  .        #uses y
-0000c240: 2065 7870 6c69 6369 7465 6c79 2069 6e73   explicitely ins
-0000c250: 7465 6164 206f 6620 636f 765b 782c 795d  tead of cov[x,y]
-0000c260: 0d0a 2020 2020 2020 2020 2361 6363 7572  ..        #accur
-0000c270: 6174 6520 6275 7420 6861 7320 6c69 7474  ate but has litt
-0000c280: 6c65 2074 6f20 646f 2077 6974 6820 7468  le to do with th
-0000c290: 6520 6d6f 6465 6c0d 0a20 2020 2020 2020  e model..       
-0000c2a0: 2023 6463 203d 2064 636f 765b 2769 6e70   #dc = dcov['inp
-0000c2b0: 7574 5f73 7061 7469 616c 275d 0d0a 2020  ut_spatial']..  
-0000c2c0: 2020 2020 2020 666f 7220 636c 6173 735f        for class_
-0000c2d0: 7920 696e 2072 616e 6765 2873 656c 662e  y in range(self.
-0000c2e0: 6f75 745f 6469 6d29 3a0d 0a20 2020 2020  out_dim):..     
-0000c2f0: 2020 2020 2020 2023 636f 6d70 7574 6520         #compute 
-0000c300: 6d65 616e 2061 6374 6976 6174 696f 6e20  mean activation 
-0000c310: 6f66 2066 696e 616c 206c 6179 6572 2066  of final layer f
-0000c320: 6f72 2065 6163 6820 636c 6173 730d 0a20  or each class.. 
-0000c330: 2020 2020 2020 2020 2020 2023 544f 444f             #TODO
-0000c340: 3a20 2d3e 2074 6f20 7365 6c66 2e61 6374  : -> to self.act
-0000c350: 6976 6174 696f 6e73 0d0a 2020 2020 2020  ivations..      
-0000c360: 2020 2020 2020 636c 6173 735f 696e 6420        class_ind 
-0000c370: 3d20 7466 2e73 7175 6565 7a65 2874 662e  = tf.squeeze(tf.
-0000c380: 7768 6572 6528 7466 2e61 7267 6d61 7828  where(tf.argmax(
-0000c390: 792c 2031 293d 3d63 6c61 7373 5f79 2929  y, 1)==class_y))
-0000c3a0: 235b 305d 0d0a 2020 2020 2020 2020 2020  #[0]..          
-0000c3b0: 2020 6663 5f62 705f 6f75 7420 3d20 286e    fc_bp_out = (n
-0000c3c0: 702e 646f 7428 6163 7469 7661 7469 6f6e  p.dot(activation
-0000c3d0: 735b 2766 6327 5d2e 6e75 6d70 7928 295b  s['fc'].numpy()[
-0000c3e0: 636c 6173 735f 696e 642c 203a 5d2c 0d0a  class_ind, :],..
+0000aca0: 2020 2020 6463 2c20 7765 6967 6874 735b      dc, weights[
+0000acb0: 2764 6d78 275d 2c20 7072 6563 5f73 7829  'dmx'], prec_sx)
+0000acc0: 290d 0a20 2020 2020 2020 2070 6174 7465  )..        patte
+0000acd0: 726e 7320 3d20 6e70 2e73 7461 636b 2870  rns = np.stack(p
+0000ace0: 6174 7465 726e 732c 202d 3129 0d0a 2020  atterns, -1)..  
+0000acf0: 2020 2020 2020 7265 7475 726e 2070 6174        return pat
+0000ad00: 7465 726e 730d 0a0d 0a0d 0a20 2020 2064  terns......    d
+0000ad10: 6566 2070 6174 7465 726e 735f 636f 765f  ef patterns_cov_
+0000ad20: 7879 5f68 6174 2873 656c 662c 2058 2c20  xy_hat(self, X, 
+0000ad30: 792c 2061 6374 6976 6174 696f 6e73 2c20  y, activations, 
+0000ad40: 7765 6967 6874 7329 3a0d 0a20 2020 2020  weights):..     
+0000ad50: 2020 2053 785f 7463 6f6e 7620 3d20 7365     Sx_tconv = se
+0000ad60: 6c66 2e62 6163 6b70 726f 705f 6663 2861  lf.backprop_fc(a
+0000ad70: 6374 6976 6174 696f 6e73 5b27 7463 6f6e  ctivations['tcon
+0000ad80: 7627 5d2c 0d0a 2020 2020 2020 2020 2020  v'],..          
+0000ad90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ada0: 2020 2020 2020 2020 2020 6163 7469 7661            activa
+0000adb0: 7469 6f6e 735b 2766 6327 5d2c 0d0a 2020  tions['fc'],..  
+0000adc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ade0: 2020 792c 0d0a 2020 2020 2020 2020 2020    y,..          
+0000adf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae00: 2020 2020 2020 2020 2020 7765 6967 6874            weight
+0000ae10: 735b 276f 7574 5f77 6569 6768 7473 275d  s['out_weights']
+0000ae20: 290d 0a20 2020 2020 2020 2053 785f 646d  )..        Sx_dm
+0000ae30: 7820 3d20 7365 6c66 2e62 6163 6b70 726f  x = self.backpro
+0000ae40: 705f 636f 7678 7928 582c 0d0a 2020 2020  p_covxy(X,..    
+0000ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae70: 6163 7469 7661 7469 6f6e 735b 2764 6d78  activations['dmx
+0000ae80: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
+0000ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aea0: 2020 2020 2020 2020 2053 785f 7463 6f6e           Sx_tcon
+0000aeb0: 762c 0d0a 2020 2020 2020 2020 2020 2020  v,..            
+0000aec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aed0: 2020 2020 2020 2020 7765 6967 6874 735b          weights[
+0000aee0: 2764 6d78 275d 290d 0a20 2020 2020 2020  'dmx'])..       
+0000aef0: 2072 6574 7572 6e20 5378 5f74 636f 6e76   return Sx_tconv
+0000af00: 2c20 5378 5f64 6d78 0d0a 0d0a 0d0a 2020  , Sx_dmx......  
+0000af10: 2020 6465 6620 6261 636b 7072 6f70 5f66    def backprop_f
+0000af20: 6328 7365 6c66 2c20 582c 2079 5f68 6174  c(self, X, y_hat
+0000af30: 2c20 792c 2077 293a 0d0a 2020 2020 2020  , y, w):..      
+0000af40: 2020 2222 220d 0a20 2020 2020 2020 2058    """..        X
+0000af50: 202d 205b 692c 2e2e 2e2c 6d5d 0d0a 2020   - [i,...,m]..  
+0000af60: 2020 2020 2020 7920 2d20 5b69 2c2e 2e2e        y - [i,...
+0000af70: 2c6a 5d0d 0a20 2020 2020 2020 2077 202d  ,j]..        w -
+0000af80: 205b 6b2c 2e2e 2e2c 6a5d 0d0a 2020 2020   [k,...,j]..    
+0000af90: 2020 2020 5378 202d 205b 6b2c 2e2e 2e2c      Sx - [k,...,
+0000afa0: 6d6a 5d22 2222 0d0a 2020 2020 2020 2020  mj]"""..        
+0000afb0: 785f 7368 6170 6520 3d20 6c69 7374 2858  x_shape = list(X
+0000afc0: 2e73 6861 7065 290d 0a20 2020 2020 2020  .shape)..       
+0000afd0: 2079 5f73 6861 7065 203d 206c 6973 7428   y_shape = list(
+0000afe0: 795f 6861 742e 7368 6170 6529 0d0a 2020  y_hat.shape)..  
+0000aff0: 2020 2020 2020 236f 7574 5f73 6861 7065        #out_shape
+0000b000: 203d 2078 5f73 6861 7065 5b31 3a5d 202b   = x_shape[1:] +
+0000b010: 2079 5f73 6861 7065 5b31 3a5d 0d0a 2020   y_shape[1:]..  
+0000b020: 2020 2020 2020 2370 7269 6e74 2878 5f73        #print(x_s
+0000b030: 6861 7065 2c20 795f 7368 6170 652c 2077  hape, y_shape, w
+0000b040: 2e73 6861 7065 290d 0a20 2020 2020 2020  .shape)..       
+0000b050: 2064 646f 6620 3d20 582e 7368 6170 655b   ddof = X.shape[
+0000b060: 305d 202d 2031 0d0a 2020 2020 2020 2020  0] - 1..        
+0000b070: 5820 3d20 6e70 2e72 6573 6861 7065 2858  X = np.reshape(X
+0000b080: 2c20 5b58 2e73 6861 7065 5b30 5d2c 202d  , [X.shape[0], -
+0000b090: 315d 290d 0a20 2020 2020 2020 2079 203d  1])..        y =
+0000b0a0: 206e 702e 7265 7368 6170 6528 792c 205b   np.reshape(y, [
+0000b0b0: 792e 7368 6170 655b 305d 2c20 2d31 5d29  y.shape[0], -1])
+0000b0c0: 0d0a 2020 2020 2020 2020 795f 6861 7420  ..        y_hat 
+0000b0d0: 3d20 6e70 2e72 6573 6861 7065 2879 5f68  = np.reshape(y_h
+0000b0e0: 6174 2c20 5b79 5f68 6174 2e73 6861 7065  at, [y_hat.shape
+0000b0f0: 5b30 5d2c 202d 315d 290d 0a20 2020 2020  [0], -1])..     
+0000b100: 2020 2077 203d 206e 702e 7265 7368 6170     w = np.reshap
+0000b110: 6528 772c 205b 2d31 2c20 772e 7368 6170  e(w, [-1, w.shap
+0000b120: 655b 2d31 5d5d 290d 0a0d 0a20 2020 2020  e[-1]])....     
+0000b130: 2020 2061 7373 6572 7428 582e 7368 6170     assert(X.shap
+0000b140: 655b 2d31 5d20 3d3d 2077 2e73 6861 7065  e[-1] == w.shape
+0000b150: 5b30 5d29 2c20 2753 6861 7065 206d 6973  [0]), 'Shape mis
+0000b160: 6d61 7463 6820 583a 7b7d 2077 3a7b 7d27  match X:{} w:{}'
+0000b170: 2e66 6f72 6d61 7428 582e 7368 6165 702c  .format(X.shaep,
+0000b180: 2077 2e73 6861 7065 290d 0a20 2020 2020   w.shape)..     
+0000b190: 2020 2061 7373 6572 7428 795f 6861 742e     assert(y_hat.
+0000b1a0: 7368 6170 655b 2d31 5d20 3d3d 2077 2e73  shape[-1] == w.s
+0000b1b0: 6861 7065 5b31 5d29 2c20 2753 6861 7065  hape[1]), 'Shape
+0000b1c0: 206d 6973 6d61 7463 6820 793a 7b7d 2077   mismatch y:{} w
+0000b1d0: 3a7b 7d27 2e66 6f72 6d61 7428 795f 6861  :{}'.format(y_ha
+0000b1e0: 742e 7368 6170 652c 2077 2e73 6861 7065  t.shape, w.shape
+0000b1f0: 290d 0a20 2020 2020 2020 2058 203d 2058  )..        X = X
+0000b200: 202d 2058 2e6d 6561 6e28 302c 206b 6565   - X.mean(0, kee
+0000b210: 7064 696d 733d 5472 7565 290d 0a20 2020  pdims=True)..   
+0000b220: 2020 2020 2079 5f68 6174 203d 2079 5f68       y_hat = y_h
+0000b230: 6174 202d 2079 5f68 6174 2e6d 6561 6e28  at - y_hat.mean(
+0000b240: 302c 206b 6565 7064 696d 733d 5472 7565  0, keepdims=True
+0000b250: 290d 0a20 2020 2020 2020 2079 203d 2079  )..        y = y
+0000b260: 202d 2079 2e6d 6561 6e28 302c 206b 6565   - y.mean(0, kee
+0000b270: 7064 696d 733d 5472 7565 290d 0a20 2020  pdims=True)..   
+0000b280: 2020 2020 2063 6f76 5f78 7920 3d20 6e70       cov_xy = np
+0000b290: 2e65 696e 7375 6d28 2769 6b20 2c69 6a20  .einsum('ik ,ij 
+0000b2a0: 2d3e 206b 6a20 272c 2058 2c20 795f 6861  -> kj ', X, y_ha
+0000b2b0: 7429 202f 2064 646f 660d 0a20 2020 2020  t) / ddof..     
+0000b2c0: 2020 2023 636f 765f 7879 203d 206e 702e     #cov_xy = np.
+0000b2d0: 636f 7628 582c 2079 290d 0a0d 0a0d 0a20  cov(X, y)...... 
+0000b2e0: 2020 2020 2020 2023 636f 6d70 7574 6520         #compute 
+0000b2f0: 696e 7665 7273 6520 636f 7661 7269 616e  inverse covarian
+0000b300: 6365 206f 6620 7468 6520 6f75 7470 7574  ce of the output
+0000b310: 0d0a 2020 2020 2020 2020 2363 6f76 5f79  ..        #cov_y
+0000b320: 7920 3d20 6e70 2e65 696e 7375 6d28 2769  y = np.einsum('i
+0000b330: 6a2c 2069 6b20 2d3e 206a 6b27 2c20 795f  j, ik -> jk', y_
+0000b340: 6861 742c 2079 5f68 6174 2920 2f20 6464  hat, y_hat) / dd
+0000b350: 6f66 0d0a 2020 2020 2020 2020 636f 765f  of..        cov_
+0000b360: 7979 203d 206e 702e 6569 6e73 756d 2827  yy = np.einsum('
+0000b370: 696a 2c20 696b 202d 3e20 6a6b 272c 2079  ij, ik -> jk', y
+0000b380: 2c20 7929 202f 2064 646f 660d 0a20 2020  , y) / ddof..   
+0000b390: 2020 2020 2070 7265 635f 7979 203d 2074       prec_yy = t
+0000b3a0: 662e 6c69 6e61 6c67 2e69 6e76 2863 6f76  f.linalg.inv(cov
+0000b3b0: 5f79 7929 0d0a 0d0a 2020 2020 2020 2020  _yy)....        
+0000b3c0: 2363 6f6d 7075 7465 2064 6972 6563 7469  #compute directi
+0000b3d0: 6f6e 7320 6f66 2053 783a 2061 203d 2063  ons of Sx: a = c
+0000b3e0: 6f76 5f78 792a 2863 6f76 5f79 7929 2a2a  ov_xy*(cov_yy)**
+0000b3f0: 2d31 0d0a 2020 2020 2020 2020 615f 6f75  -1..        a_ou
+0000b400: 7420 3d20 6e70 2e65 696e 7375 6d28 276a  t = np.einsum('j
+0000b410: 6b2c 206b 6c20 2d3e 206a 6c27 2c20 636f  k, kl -> jl', co
+0000b420: 765f 7879 2c20 7072 6563 5f79 7929 2023  v_xy, prec_yy) #
+0000b430: 7368 6170 6520 3d20 5b6e 5f74 5f70 6f6f  shape = [n_t_poo
+0000b440: 6c65 642c 206e 5f6c 6174 656e 742c 206e  led, n_latent, n
+0000b450: 5f63 6c61 7373 6573 5d0d 0a0d 0a20 2020  _classes]....   
+0000b460: 2020 2020 2023 2041 2e2a 770d 0a20 2020       # A.*w..   
+0000b470: 2020 2020 2023 6177 203d 2061 5f6f 7574       #aw = a_out
+0000b480: 202a 2077 2023 7368 6170 6520 3d20 5b2e   * w #shape = [.
+0000b490: 2e2e 5d0d 0a20 2020 2020 2020 2023 2061  ..]..        # a
+0000b4a0: 6374 6976 6174 696f 6e20 6f66 2074 636f  ctivation of tco
+0000b4b0: 6e76 2062 7920 6561 6368 2073 6967 6e61  nv by each signa
+0000b4c0: 6c20 636f 6d70 6f6e 656e 7420 6f66 2065  l component of e
+0000b4d0: 6163 6820 7361 6d70 6c65 0d0a 2020 2020  ach sample..    
+0000b4e0: 2020 2020 2353 7820 3d20 6e70 2e65 696e      #Sx = np.ein
+0000b4f0: 7375 6d28 2769 6c2c 206b 6c20 2d3e 2069  sum('il, kl -> i
+0000b500: 6b27 2c20 795f 6861 742c 2061 7729 2023  k', y_hat, aw) #
+0000b510: 7368 6170 6520 3d20 5b6e 5f62 6174 6368  shape = [n_batch
+0000b520: 2c20 2e2e 2e5d 0d0a 2020 2020 2020 2020  , ...]..        
+0000b530: 5378 203d 206e 702e 6569 6e73 756d 2827  Sx = np.einsum('
+0000b540: 696c 2c20 696c 2c20 6a69 202d 3e20 6a69  il, il, ji -> ji
+0000b550: 6c27 2c20 615f 6f75 742c 2077 2c20 5829  l', a_out, w, X)
+0000b560: 0d0a 2020 2020 2020 2020 5378 203d 206e  ..        Sx = n
+0000b570: 702e 7371 7565 657a 6528 6e70 2e72 6573  p.squeeze(np.res
+0000b580: 6861 7065 2853 782c 2078 5f73 6861 7065  hape(Sx, x_shape
+0000b590: 202b 2079 5f73 6861 7065 5b31 3a5d 2929   + y_shape[1:]))
+0000b5a0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0000b5b0: 2053 780d 0a0d 0a20 2020 2064 6566 2062   Sx....    def b
+0000b5c0: 6163 6b70 726f 705f 636f 7678 7928 7365  ackprop_covxy(se
+0000b5d0: 6c66 2c20 582c 2048 782c 2053 782c 2077  lf, X, Hx, Sx, w
+0000b5e0: 293a 0d0a 2020 2020 2020 2020 7864 6d78  ):..        xdmx
+0000b5f0: 203d 206e 702e 7265 7368 6170 6528 4878   = np.reshape(Hx
+0000b600: 2c20 5b2d 312c 2048 782e 7368 6170 655b  , [-1, Hx.shape[
+0000b610: 2d31 5d5d 290d 0a20 2020 2020 2020 2078  -1]])..        x
+0000b620: 646d 7820 3d20 7864 6d78 202d 2078 646d  dmx = xdmx - xdm
+0000b630: 782e 6d65 616e 2830 2c20 6b65 6570 6469  x.mean(0, keepdi
+0000b640: 6d73 3d54 7275 6529 0d0a 2020 2020 2020  ms=True)..      
+0000b650: 2020 7869 6e70 203d 206e 702e 7265 7368    xinp = np.resh
+0000b660: 6170 6528 582c 205b 2d31 2c20 582e 7368  ape(X, [-1, X.sh
+0000b670: 6170 655b 2d31 5d5d 290d 0a20 2020 2020  ape[-1]])..     
+0000b680: 2020 2078 696e 7020 3d20 7869 6e70 202d     xinp = xinp -
+0000b690: 2078 696e 702e 6d65 616e 2830 2c20 6b65   xinp.mean(0, ke
+0000b6a0: 6570 6469 6d73 3d54 7275 6529 0d0a 2020  epdims=True)..  
+0000b6b0: 2020 2020 2020 636f 765f 7879 203d 206e        cov_xy = n
+0000b6c0: 702e 646f 7428 7869 6e70 2e54 2c20 7864  p.dot(xinp.T, xd
+0000b6d0: 6d78 290d 0a20 2020 2020 2020 2070 7269  mx)..        pri
+0000b6e0: 6e74 2822 6177 222c 2063 6f76 5f78 792e  nt("aw", cov_xy.
+0000b6f0: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
+0000b700: 6177 203d 2063 6f76 5f78 790d 0a20 2020  aw = cov_xy..   
+0000b710: 2020 2020 2073 7820 3d20 6e70 2e72 6573       sx = np.res
+0000b720: 6861 7065 2853 782c 205b 2d31 2c20 5378  hape(Sx, [-1, Sx
+0000b730: 2e73 6861 7065 5b2d 325d 2c20 5378 2e73  .shape[-2], Sx.s
+0000b740: 6861 7065 5b2d 315d 5d29 0d0a 2020 2020  hape[-1]])..    
+0000b750: 2020 2020 7378 203d 2073 7820 2d20 7378      sx = sx - sx
+0000b760: 2e6d 6561 6e28 302c 206b 6565 7064 696d  .mean(0, keepdim
+0000b770: 733d 5472 7565 290d 0a20 2020 2020 2020  s=True)..       
+0000b780: 2064 646f 6620 3d20 7378 2e73 6861 7065   ddof = sx.shape
+0000b790: 5b30 5d20 2d20 310d 0a20 2020 2020 2020  [0] - 1..       
+0000b7a0: 2063 6f76 5f73 7820 3d20 6e70 2e65 696e   cov_sx = np.ein
+0000b7b0: 7375 6d28 2769 6a6b 2c20 696c 6b20 2d3e  sum('ijk, ilk ->
+0000b7c0: 206b 6a6c 272c 2073 782c 7378 2920 2f20   kjl', sx,sx) / 
+0000b7d0: 6464 6f66 0d0a 2020 2020 2020 2020 7072  ddof..        pr
+0000b7e0: 696e 7428 2263 6f76 5f73 783a 222c 2063  int("cov_sx:", c
+0000b7f0: 6f76 5f73 782e 7368 6170 6529 0d0a 2020  ov_sx.shape)..  
+0000b800: 2020 2020 2020 7072 6563 5f79 795f 6861        prec_yy_ha
+0000b810: 7420 3d20 6e70 2e73 7461 636b 285b 6e70  t = np.stack([np
+0000b820: 2e6c 696e 616c 672e 7069 6e76 2873 2920  .linalg.pinv(s) 
+0000b830: 666f 7220 7320 696e 2063 6f76 5f73 785d  for s in cov_sx]
+0000b840: 290d 0a20 2020 2020 2020 2070 7269 6e74  )..        print
+0000b850: 2877 2e73 6861 7065 2c20 7072 6563 5f79  (w.shape, prec_y
+0000b860: 795f 6861 742e 7368 6170 6529 0d0a 2020  y_hat.shape)..  
+0000b870: 2020 2020 2020 7777 203d 206e 702e 6569        ww = np.ei
+0000b880: 6e73 756d 2827 696a 2c20 6a6c 6b20 2d3e  nsum('ij, jlk ->
+0000b890: 2069 6b6c 272c 2077 2c20 7072 6563 5f79   ikl', w, prec_y
+0000b8a0: 795f 6861 7429 0d0a 2020 2020 2020 2020  y_hat)..        
+0000b8b0: 7072 696e 7428 636f 765f 7879 2e73 6861  print(cov_xy.sha
+0000b8c0: 7065 2c20 7777 2e73 6861 7065 290d 0a20  pe, ww.shape).. 
+0000b8d0: 2020 2020 2020 2061 203d 206e 702e 6569         a = np.ei
+0000b8e0: 6e73 756d 2827 696a 2c20 696a 6b20 2d3e  nsum('ij, ijk ->
+0000b8f0: 2069 6b27 2c20 636f 765f 7879 2c20 7777   ik', cov_xy, ww
+0000b900: 290d 0a0d 0a20 2020 2020 2020 2072 6574  )....        ret
+0000b910: 7572 6e20 610d 0a0d 0a20 2020 2020 2020  urn a....       
+0000b920: 2023 2070 7269 6e74 2863 6f76 5f78 792e   # print(cov_xy.
+0000b930: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
+0000b940: 2320 7061 7474 6572 6e73 203d 205b 5d0d  # patterns = [].
+0000b950: 0a20 2020 2020 2020 2023 2066 6f72 2063  .        # for c
+0000b960: 6c61 7373 5f79 2069 6e20 7261 6e67 6528  lass_y in range(
+0000b970: 5378 2e73 6861 7065 5b2d 315d 293a 0d0a  Sx.shape[-1]):..
+0000b980: 2020 2020 2020 2020 2320 2020 2020 7378          #     sx
+0000b990: 203d 206e 702e 7265 7368 6170 6528 5378   = np.reshape(Sx
+0000b9a0: 2c20 5b2d 312c 2053 782e 7368 6170 655b  , [-1, Sx.shape[
+0000b9b0: 2d32 5d2c 2053 782e 7368 6170 655b 2d31  -2], Sx.shape[-1
+0000b9c0: 5d5d 290d 0a20 2020 2020 2020 2023 2020  ]])..        #  
+0000b9d0: 2020 2073 7820 2d3d 2073 782e 6d65 616e     sx -= sx.mean
+0000b9e0: 2830 2c20 6b65 6570 6469 6d73 3d54 7275  (0, keepdims=Tru
+0000b9f0: 6529 0d0a 2020 2020 2020 2020 2320 2020  e)..        #   
+0000ba00: 2020 7072 6563 5f73 7820 3d20 6e70 2e6c    prec_sx = np.l
+0000ba10: 696e 616c 672e 696e 7628 6e70 2e64 6f74  inalg.inv(np.dot
+0000ba20: 2873 782e 542c 2073 7829 290d 0a0d 0a20  (sx.T, sx)).... 
+0000ba30: 2020 2020 2020 2023 2020 2020 2061 7720         #     aw 
+0000ba40: 3d20 6e70 2e64 6f74 2863 6f76 5f78 792c  = np.dot(cov_xy,
+0000ba50: 2070 7265 635f 7378 2920 2a20 770d 0a20   prec_sx) * w.. 
+0000ba60: 2020 2020 2020 2023 2020 2020 2023 636f         #     #co
+0000ba70: 6d70 6f6e 656e 745f 6163 7469 7661 7469  mponent_activati
+0000ba80: 6f6e 7320 3d20 6e70 2e64 6f74 2861 772c  ons = np.dot(aw,
+0000ba90: 2070 7265 635f 7378 290d 0a20 2020 2020   prec_sx)..     
+0000baa0: 2020 2023 2020 2020 2070 6174 7465 726e     #     pattern
+0000bab0: 732e 6170 7065 6e64 2861 772e 7375 6d28  s.append(aw.sum(
+0000bac0: 2d31 2929 0d0a 0d0a 2020 2020 2020 2020  -1))....        
+0000bad0: 2320 7265 7475 726e 206e 702e 7374 6163  # return np.stac
+0000bae0: 6b28 7061 7474 6572 6e73 2c20 3129 0d0a  k(patterns, 1)..
+0000baf0: 0d0a 2020 2020 2320 6465 6620 6261 636b  ..    # def back
+0000bb00: 7072 6f70 5f64 6d78 2873 656c 662c 2058  prop_dmx(self, X
+0000bb10: 2c20 795f 6861 742c 2079 2c20 7729 3a0d  , y_hat, y, w):.
+0000bb20: 0a20 2020 2023 2020 2020 2078 5f73 6861  .    #     x_sha
+0000bb30: 7065 203d 206c 6973 7428 582e 7368 6170  pe = list(X.shap
+0000bb40: 6529 0d0a 2020 2020 2320 2020 2020 795f  e)..    #     y_
+0000bb50: 7368 6170 6520 3d20 6c69 7374 2879 5f68  shape = list(y_h
+0000bb60: 6174 2e73 6861 7065 290d 0a20 2020 2023  at.shape)..    #
+0000bb70: 2020 2020 206b 203d 2079 2e73 6861 7065       k = y.shape
+0000bb80: 5b2d 315d 0d0a 2020 2020 2320 2020 2020  [-1]..    #     
+0000bb90: 795f 6861 7420 3d20 6e70 2e72 6573 6861  y_hat = np.resha
+0000bba0: 7065 2879 5f68 6174 2c20 5b79 5f68 6174  pe(y_hat, [y_hat
+0000bbb0: 2e73 6861 7065 5b30 5d2c 202d 315d 290d  .shape[0], -1]).
+0000bbc0: 0a20 2020 2023 2020 2020 2023 6f75 745f  .    #     #out_
+0000bbd0: 7368 6170 6520 3d20 785f 7368 6170 655b  shape = x_shape[
+0000bbe0: 313a 5d20 2b20 795f 7368 6170 655b 313a  1:] + y_shape[1:
+0000bbf0: 5d0d 0a20 2020 2023 2020 2020 2023 7072  ]..    #     #pr
+0000bc00: 696e 7428 785f 7368 6170 652c 2079 5f73  int(x_shape, y_s
+0000bc10: 6861 7065 2c20 772e 7368 6170 6529 0d0a  hape, w.shape)..
+0000bc20: 2020 2020 2320 2020 2020 6464 6f66 5f78      #     ddof_x
+0000bc30: 7920 3d20 6e70 2e70 726f 6428 785f 7368  y = np.prod(x_sh
+0000bc40: 6170 655b 3a33 5d29 202d 2031 0d0a 2020  ape[:3]) - 1..  
+0000bc50: 2020 2320 2020 2020 6464 6f66 5f79 7920    #     ddof_yy 
+0000bc60: 3d20 6e70 2e70 726f 6428 795f 7368 6170  = np.prod(y_shap
+0000bc70: 655b 3a33 5d29 202d 2031 0d0a 0d0a 2020  e[:3]) - 1....  
+0000bc80: 2020 2320 2020 2020 636f 765f 7879 203d    #     cov_xy =
+0000bc90: 206e 702e 6569 6e73 756d 2827 696a 6b6c   np.einsum('ijkl
+0000bca0: 2c20 696a 6d6e 202d 3e20 6c6e 6d27 2c20  , ijmn -> lnm', 
+0000bcb0: 582c 2079 5f68 6174 2920 2f20 6464 6f66  X, y_hat) / ddof
+0000bcc0: 5f78 7920 2373 6861 7065 203d 205b 6e5f  _xy #shape = [n_
+0000bcd0: 6368 2c20 6e5f 6c61 746e 6574 2c20 6e5f  ch, n_latnet, n_
+0000bce0: 6269 6e73 5d0d 0a20 2020 2023 2020 2020  bins]..    #    
+0000bcf0: 2063 6f76 5f79 7920 3d20 6e70 2e65 696e   cov_yy = np.ein
+0000bd00: 7375 6d28 2769 6a6b 6c2c 2069 6a6b 6d20  sum('ijkl, ijkm 
+0000bd10: 2d3e 206b 6c6d 272c 2079 5f68 6174 2c20  -> klm', y_hat, 
+0000bd20: 795f 6861 7429 202f 2064 646f 665f 7979  y_hat) / ddof_yy
+0000bd30: 0d0a 2020 2020 2320 2020 2020 7072 6563  ..    #     prec
+0000bd40: 5f79 7920 3d20 6e70 2e61 7272 6179 285b  _yy = np.array([
+0000bd50: 6e70 2e6c 696e 616c 672e 696e 7628 6376  np.linalg.inv(cv
+0000bd60: 7929 2066 6f72 2063 7679 2069 6e20 636f  y) for cvy in co
+0000bd70: 765f 7979 5d29 0d0a 2020 2020 2320 2020  v_yy])..    #   
+0000bd80: 2020 615f 6f75 7420 3d20 6e70 2e65 696e    a_out = np.ein
+0000bd90: 7375 6d28 276a 6b6d 2c20 6d6b 6c20 2d3e  sum('jkm, mkl ->
+0000bda0: 206a 6c6d 272c 2063 6f76 5f78 792c 2070   jlm', cov_xy, p
+0000bdb0: 7265 635f 7979 290d 0a20 2020 2023 2020  rec_yy)..    #  
+0000bdc0: 2020 2061 7720 3d20 615f 6f75 7420 2a20     aw = a_out * 
+0000bdd0: 775b 2e2e 2e2c 204e 6f6e 655d 0d0a 2020  w[..., None]..  
+0000bde0: 2020 2320 2020 2020 2320 6163 7469 7661    #     # activa
+0000bdf0: 7469 6f6e 206f 6620 7463 6f6e 7620 6279  tion of tconv by
+0000be00: 2065 6163 6820 7369 676e 616c 2063 6f6d   each signal com
+0000be10: 706f 6e65 6e74 206f 6620 6561 6368 2073  ponent of each s
+0000be20: 616d 706c 650d 0a20 2020 2023 2020 2020  ample..    #    
+0000be30: 2053 7820 3d20 6e70 2e65 696e 7375 6d28   Sx = np.einsum(
+0000be40: 2769 6a6b 6c2c 2063 6c6b 202d 3e20 6963  'ijkl, clk -> ic
+0000be50: 6b27 2c20 795f 6861 742c 2061 7729 2023  k', y_hat, aw) #
+0000be60: 7368 6170 6520 3d20 5b6e 5f62 6174 6368  shape = [n_batch
+0000be70: 2c20 2e2e 2e5d 0d0a 0d0a 2020 2020 2320  , ...]....    # 
+0000be80: 2020 2020 7265 7475 726e 2053 780d 0a0d      return Sx...
+0000be90: 0a20 2020 2064 6566 2070 6174 7465 726e  .    def pattern
+0000bea0: 735f 7069 6e76 5f77 2873 656c 662c 2079  s_pinv_w(self, y
+0000beb0: 2c20 7765 6967 6874 732c 2061 6374 6976  , weights, activ
+0000bec0: 6174 696f 6e73 2c20 6463 6f76 293a 0d0a  ations, dcov):..
+0000bed0: 2020 2020 2020 2020 636f 6d62 696e 6564          combined
+0000bee0: 5f74 6f70 6f73 203d 205b 5d0d 0a20 2020  _topos = []..   
+0000bef0: 2020 2020 2070 696e 765f 646d 7820 3d20       pinv_dmx = 
+0000bf00: 6e70 2e6c 696e 616c 672e 7069 6e76 2877  np.linalg.pinv(w
+0000bf10: 6569 6768 7473 5b27 646d 7827 5d29 2e54  eights['dmx']).T
+0000bf20: 236e 702e 646f 7428 7370 6174 6961 6c5f  #np.dot(spatial_
+0000bf30: 6669 6c74 6572 732c 206e 702e 6c69 6e61  filters, np.lina
+0000bf40: 6c67 2e69 6e76 286e 702e 646f 7428 7370  lg.inv(np.dot(sp
+0000bf50: 6174 6961 6c5f 6669 6c74 6572 732e 542c  atial_filters.T,
+0000bf60: 2073 7061 7469 616c 5f66 696c 7465 7273   spatial_filters
+0000bf70: 2929 290d 0a20 2020 2020 2020 2070 696e  )))..        pin
+0000bf80: 765f 7766 6320 3d20 6e70 2e6c 696e 616c  v_wfc = np.linal
+0000bf90: 672e 7069 6e76 2877 6569 6768 7473 5b27  g.pinv(weights['
+0000bfa0: 6f75 745f 775f 666c 6174 275d 292e 5423  out_w_flat']).T#
+0000bfb0: 6e70 2e64 6f74 286f 7574 5f77 5f66 6c61  np.dot(out_w_fla
+0000bfc0: 742c 206e 702e 6c69 6e61 6c67 2e69 6e76  t, np.linalg.inv
+0000bfd0: 286e 702e 646f 7428 6f75 745f 775f 666c  (np.dot(out_w_fl
+0000bfe0: 6174 2e54 2c20 6f75 745f 775f 666c 6174  at.T, out_w_flat
+0000bff0: 2929 290d 0a20 2020 2020 2020 2070 696e  )))..        pin
+0000c000: 765f 7463 6b20 3d20 6e70 2e6c 696e 616c  v_tck = np.linal
+0000c010: 672e 7069 6e76 2877 6569 6768 7473 5b27  g.pinv(weights['
+0000c020: 7463 6f6e 7627 5d29 2e54 2023 6e70 2e64  tconv']).T #np.d
+0000c030: 6f74 2874 636f 6e76 5f6b 6572 6e65 6c73  ot(tconv_kernels
+0000c040: 2c20 6e70 2e6c 696e 616c 672e 696e 7628  , np.linalg.inv(
+0000c050: 6e70 2e64 6f74 2874 636f 6e76 5f6b 6572  np.dot(tconv_ker
+0000c060: 6e65 6c73 2e54 2c20 7463 6f6e 765f 6b65  nels.T, tconv_ke
+0000c070: 726e 656c 7329 2929 0d0a 0d0a 2020 2020  rnels)))....    
+0000c080: 2020 2020 234c 6561 7374 2073 7175 6172      #Least squar
+0000c090: 6520 7369 6e67 616c 2065 7374 696d 6174  e singal estimat
+0000c0a0: 6520 696e 2074 636f 6e76 2067 6976 656e  e in tconv given
+0000c0b0: 2077 6663 2061 6e64 2066 635f 6163 7469   wfc and fc_acti
+0000c0c0: 7661 7469 6f6e 730d 0a20 2020 2020 2020  vations..       
+0000c0d0: 2053 785f 7463 6f6e 7620 3d20 6e70 2e65   Sx_tconv = np.e
+0000c0e0: 696e 7375 6d28 276a 6b2c 2069 6b20 2d3e  insum('jk, ik ->
+0000c0f0: 696a 272c 2070 696e 765f 7766 632c 2061  ij', pinv_wfc, a
+0000c100: 6374 6976 6174 696f 6e73 5b27 6663 275d  ctivations['fc']
+0000c110: 290d 0a20 2020 2020 2020 2053 785f 7463  )..        Sx_tc
+0000c120: 6f6e 7620 3d20 6e70 2e72 6573 6861 7065  onv = np.reshape
+0000c130: 2853 785f 7463 6f6e 762c 2061 6374 6976  (Sx_tconv, activ
+0000c140: 6174 696f 6e73 5b27 7463 6f6e 7627 5d2e  ations['tconv'].
+0000c150: 7368 6170 6529 0d0a 0d0a 2020 2020 2020  shape)....      
+0000c160: 2020 2352 6576 6572 7365 2070 6f6f 6c69    #Reverse pooli
+0000c170: 6e67 2061 6e64 2064 6570 7468 7769 7365  ng and depthwise
+0000c180: 2063 6f6e 766f 6c75 7469 6f6e 2066 6f72   convolution for
+0000c190: 2065 6163 6820 636c 6173 730d 0a20 2020   each class..   
+0000c1a0: 2020 2020 2053 785f 646d 7820 3d20 5b5d       Sx_dmx = []
+0000c1b0: 0d0a 2020 2020 2020 2020 2364 6320 3d20  ..        #dc = 
+0000c1c0: 6463 6f76 5b27 696e 7075 745f 7370 6174  dcov['input_spat
+0000c1d0: 6961 6c27 5d0d 0a20 2020 2020 2020 2023  ial']..        #
+0000c1e0: 6e5f 7061 6464 696e 6720 3d20 7365 6c66  n_padding = self
+0000c1f0: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
+0000c200: 735b 276e 5f74 275d 2573 656c 662e 7370  s['n_t']%self.sp
+0000c210: 6563 735b 2773 7472 6964 6527 5d0d 0a20  ecs['stride'].. 
+0000c220: 2020 2020 2020 2066 6f72 2063 6c61 7373         for class
+0000c230: 5f79 2069 6e20 7261 6e67 6528 7365 6c66  _y in range(self
+0000c240: 2e6f 7574 5f64 696d 293a 0d0a 2020 2020  .out_dim):..    
+0000c250: 2020 2020 2020 2020 636c 6173 735f 696e          class_in
+0000c260: 6420 3d20 7466 2e73 7175 6565 7a65 2874  d = tf.squeeze(t
+0000c270: 662e 7768 6572 6528 7466 2e61 7267 6d61  f.where(tf.argma
+0000c280: 7828 792c 2031 293d 3d63 6c61 7373 5f79  x(y, 1)==class_y
+0000c290: 2929 235b 305d 0d0a 2020 2020 2020 2020  ))#[0]..        
+0000c2a0: 2020 2020 5378 6d20 3d20 6e70 2e73 7175      Sxm = np.squ
+0000c2b0: 6565 7a65 2853 785f 7463 6f6e 765b 636c  eeze(Sx_tconv[cl
+0000c2c0: 6173 735f 696e 642c 203a 5d2e 6d65 616e  ass_ind, :].mean
+0000c2d0: 2830 2c20 6b65 6570 6469 6d73 3d54 7275  (0, keepdims=Tru
+0000c2e0: 6529 290d 0a20 2020 2020 2020 2020 2020  e))..           
+0000c2f0: 2053 786d 203d 206e 702e 6174 6c65 6173   Sxm = np.atleas
+0000c300: 745f 3264 2853 786d 290d 0a20 2020 2020  t_2d(Sxm)..     
+0000c310: 2020 2020 2020 2064 6320 3d20 6463 6f76         dc = dcov
+0000c320: 5b27 636c 6173 735f 636f 6e64 6974 696f  ['class_conditio
+0000c330: 6e61 6c27 5d5b 636c 6173 735f 795d 0d0a  nal'][class_y]..
+0000c340: 2020 2020 2020 2020 2020 2020 636f 6d62              comb
+0000c350: 696e 6564 5f74 6f70 6f73 2e61 7070 656e  ined_topos.appen
+0000c360: 6428 6e70 2e65 696e 7375 6d28 2768 692c  d(np.einsum('hi,
+0000c370: 696a 2c74 6a2d 3e68 7427 2c0d 0a20 2020  ij,tj->ht',..   
+0000c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3a0: 2020 2020 2020 2020 2064 632c 0d0a 2020           dc,..  
+0000c3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3d0: 2020 2020 2020 2020 2020 7765 6967 6874            weight
+0000c3e0: 735b 2764 6d78 275d 2c0d 0a20 2020 2020  s['dmx'],..     
 0000c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c400: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0000c410: 6569 6768 7473 5b27 6f75 745f 775f 666c  eights['out_w_fl
-0000c420: 6174 275d 2e54 2929 2e6d 6561 6e28 3029  at'].T)).mean(0)
-0000c430: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0000c440: 6663 5f62 705f 6f75 7420 3d20 6663 5f62  fc_bp_out = fc_b
-0000c450: 705f 6f75 742e 7265 7368 6170 6528 5b61  p_out.reshape([a
-0000c460: 6374 6976 6174 696f 6e73 5b27 7463 6f6e  ctivations['tcon
-0000c470: 7627 5d2e 7368 6170 655b 325d 2c0d 0a20  v'].shape[2],.. 
-0000c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4a0: 2020 2020 2020 2020 2020 6163 7469 7661            activa
-0000c4b0: 7469 6f6e 735b 2774 636f 6e76 275d 2e73  tions['tconv'].s
-0000c4c0: 6861 7065 5b33 5d5d 2c0d 0a20 2020 2020  hape[3]],..     
-0000c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4f0: 2020 2020 2020 6f72 6465 723d 2743 2729        order='C')
-0000c500: 0d0a 2020 2020 2020 2020 2020 2020 6463  ..            dc
-0000c510: 203d 2064 636f 765b 2763 6c61 7373 5f63   = dcov['class_c
-0000c520: 6f6e 6469 7469 6f6e 616c 275d 5b63 6c61  onditional'][cla
-0000c530: 7373 5f79 5d0d 0a20 2020 2020 2020 2020  ss_y]..         
-0000c540: 2020 2023 6663 5f62 705f 6f75 7420 3d20     #fc_bp_out = 
-0000c550: 6e70 2e6d 6178 696d 756d 2866 635f 6270  np.maximum(fc_bp
-0000c560: 5f6f 7574 2c20 3029 0d0a 2020 2020 2020  _out, 0)..      
-0000c570: 2020 2020 2020 636c 6173 735f 7061 7474        class_patt
-0000c580: 6572 6e73 203d 206e 702e 646f 7428 6463  erns = np.dot(dc
-0000c590: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5b0: 2020 2020 2020 2077 6569 6768 7473 5b27         weights['
-0000c5c0: 646d 7827 5d29 0d0a 2020 2020 2020 2020  dmx'])..        
-0000c5d0: 2020 2020 6370 203d 206e 702e 6569 6e73      cp = np.eins
-0000c5e0: 756d 2827 636b 2c20 696b 202d 3e20 6327  um('ck, ik -> c'
-0000c5f0: 2c20 636c 6173 735f 7061 7474 6572 6e73  , class_patterns
-0000c600: 2c20 6663 5f62 705f 6f75 7429 0d0a 0d0a  , fc_bp_out)....
-0000c610: 2020 2020 2020 2020 2020 2020 636f 6d62              comb
-0000c620: 696e 6564 5f74 6f70 6f73 2e61 7070 656e  ined_topos.appen
-0000c630: 6428 6370 2920 2320 2b20 7370 6174 6961  d(cp) # + spatia
-0000c640: 6c5f 6269 6173 6573 5b63 6c61 7373 5f79  l_biases[class_y
-0000c650: 5d0d 0a0d 0a20 2020 2020 2020 2074 6f70  ]....        top
-0000c660: 6f73 203d 206e 702e 7374 6163 6b28 636f  os = np.stack(co
-0000c670: 6d62 696e 6564 5f74 6f70 6f73 2c20 3129  mbined_topos, 1)
-0000c680: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000c690: 2074 6f70 6f73 0d0a 0d0a 0d0a 0d0a 2020   topos........  
-0000c6a0: 2020 2020 2020 2345 7870 6572 696d 656e        #Experimen
-0000c6b0: 7420 340d 0a20 2020 2020 2020 2020 2020  t 4..           
-0000c6c0: 2023 0d0a 2020 2020 2020 2020 2020 2020   #..            
-0000c6d0: 2363 6f6d 6269 6e65 645f 746f 706f 7320  #combined_topos 
-0000c6e0: 3d20 5b5d 0d0a 2020 2020 2020 2020 2020  = []..          
-0000c6f0: 2020 2363 6c61 7373 5f70 6174 7465 726e    #class_pattern
-0000c700: 7320 3d20 6e70 2e64 6f74 2873 656c 662e  s = np.dot(self.
-0000c710: 6463 6f76 2c20 7370 6174 6961 6c5f 6669  dcov, spatial_fi
-0000c720: 6c74 6572 7329 0d0a 2020 2020 2020 2020  lters)..        
-0000c730: 2020 2020 2366 6f72 2063 6c61 7373 5f79      #for class_y
-0000c740: 2069 6e20 7261 6e67 6528 7365 6c66 2e6f   in range(self.o
-0000c750: 7574 5f64 696d 293a 0d0a 2020 2020 2020  ut_dim):..      
-0000c760: 2020 2020 2020 2363 6c61 7373 5f79 203d        #class_y =
-0000c770: 2030 2023 2074 7275 6520 636c 6173 730d   0 # true class.
-0000c780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c790: 2023 636c 6173 735f 6e6f 745f 7920 3d20   #class_not_y = 
-0000c7a0: 6e70 2e61 7272 6179 285b 6920 666f 7220  np.array([i for 
-0000c7b0: 6920 696e 2072 616e 6765 2873 656c 662e  i in range(self.
-0000c7c0: 6f75 745f 6469 6d29 2069 6620 6921 3d63  out_dim) if i!=c
-0000c7d0: 6c61 7373 5f79 5d29 0d0a 2020 2020 2020  lass_y])..      
-0000c7e0: 2020 2020 2020 2020 2020 2363 6c61 7373            #class
-0000c7f0: 5f69 6e64 203d 2074 662e 7371 7565 657a  _ind = tf.squeez
-0000c800: 6528 7466 2e77 6865 7265 2874 662e 6172  e(tf.where(tf.ar
-0000c810: 676d 6178 2879 2c20 3129 3d3d 636c 6173  gmax(y, 1)==clas
-0000c820: 735f 7929 2923 5b30 5d0d 0a20 2020 2020  s_y))#[0]..     
-0000c830: 2020 2020 2020 2020 2020 2023 616e 7469             #anti
-0000c840: 5f63 6c61 7373 5f69 6e64 203d 2074 662e  _class_ind = tf.
-0000c850: 7371 7565 657a 6528 7466 2e77 6865 7265  squeeze(tf.where
-0000c860: 2874 662e 6172 676d 6178 2879 2c20 3129  (tf.argmax(y, 1)
-0000c870: 213d 636c 6173 735f 7929 2923 5b30 5d0d  !=class_y))#[0].
-0000c880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c890: 2023 4578 7065 7269 6d65 6e74 2031 0d0a   #Experiment 1..
-0000c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c8b0: 2320 6663 5f62 705f 6f75 7420 3d20 6e70  # fc_bp_out = np
-0000c8c0: 2e64 6f74 2866 635f 6163 7469 7661 7469  .dot(fc_activati
-0000c8d0: 6f6e 732e 6e75 6d70 7928 295b 636c 6173  ons.numpy()[clas
-0000c8e0: 735f 696e 642c 203a 5d2c 206f 7574 5f77  s_ind, :], out_w
-0000c8f0: 5f66 6c61 742e 5429 2e6d 6561 6e28 3029  _flat.T).mean(0)
-0000c900: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c910: 2020 2320 6663 5f61 6e74 695f 6f75 7420    # fc_anti_out 
-0000c920: 3d20 6e70 2e64 6f74 2866 635f 6163 7469  = np.dot(fc_acti
-0000c930: 7661 7469 6f6e 732e 6e75 6d70 7928 295b  vations.numpy()[
-0000c940: 616e 7469 5f63 6c61 7373 5f69 6e64 2c20  anti_class_ind, 
-0000c950: 3a5d 2c20 6f75 745f 775f 666c 6174 2e54  :], out_w_flat.T
-0000c960: 292e 6d65 616e 2830 290d 0a20 2020 2020  ).mean(0)..     
-0000c970: 2020 2020 2020 2020 2020 2023 2066 635f             # fc_
-0000c980: 6270 5f6f 7574 202d 3d20 6663 5f61 6e74  bp_out -= fc_ant
-0000c990: 695f 6f75 740d 0a20 2020 2020 2020 2020  i_out..         
-0000c9a0: 2020 2020 2020 2023 2066 635f 6270 5f6f         # fc_bp_o
-0000c9b0: 7574 203d 2066 635f 6270 5f6f 7574 2e72  ut = fc_bp_out.r
-0000c9c0: 6573 6861 7065 285b 706f 6f6c 6564 5f74  eshape([pooled_t
-0000c9d0: 636f 6e76 5f6f 7574 7075 7473 2e73 6861  conv_outputs.sha
-0000c9e0: 7065 5b32 5d2c 0d0a 2020 2020 2020 2020  pe[2],..        
-0000c9f0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-0000ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca10: 2020 2020 2020 2020 2073 656c 662e 646d           self.dm
-0000ca20: 782e 7369 7a65 5d2c 0d0a 2020 2020 2020  x.size],..      
-0000ca30: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-0000ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca50: 2020 2020 2020 2020 2020 6f72 6465 723d            order=
-0000ca60: 2743 2729 0d0a 0d0a 2020 2020 2020 2020  'C')....        
-0000ca70: 2020 2020 2020 2020 2366 635f 6270 5f6f          #fc_bp_o
-0000ca80: 7574 203d 2066 635f 6270 5f6f 7574 2e6e  ut = fc_bp_out.n
-0000ca90: 756d 7079 2829 2e73 756d 282d 3129 2023  umpy().sum(-1) #
-0000caa0: 2d20 6e70 2e6d 6561 6e28 290d 0a20 2020  - np.mean()..   
-0000cab0: 2020 2020 2020 2020 2020 2020 2023 6663               #fc
-0000cac0: 5f62 705f 6f75 745f 7265 6374 203d 206e  _bp_out_rect = n
-0000cad0: 702e 6d61 7869 6d75 6d28 6663 5f62 705f  p.maximum(fc_bp_
-0000cae0: 6f75 742c 2030 290d 0a0d 0a0d 0a0d 0a20  out, 0)........ 
-0000caf0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000cb00: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0000cb10: 2320 636c 6173 735f 7061 7474 6572 6e73  # class_patterns
-0000cb20: 203d 206e 702e 646f 7428 6463 6f76 735b   = np.dot(dcovs[
-0000cb30: 636c 6173 735f 792c 202e 2e2e 5d2c 2073  class_y, ...], s
-0000cb40: 7061 7469 616c 5f66 696c 7465 7273 290d  patial_filters).
-0000cb50: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
-0000cb60: 2023 636f 6d62 696e 6564 5f74 6f70 6f73   #combined_topos
-0000cb70: 2e61 7070 656e 6428 6e70 2e65 696e 7375  .append(np.einsu
-0000cb80: 6d28 2763 6b2c 2069 6b20 2d3e 2063 272c  m('ck, ik -> c',
-0000cb90: 2063 6c61 7373 5f70 6174 7465 726e 732c   class_patterns,
-0000cba0: 2066 635f 6270 5f6f 7574 5f72 6563 7429   fc_bp_out_rect)
-0000cbb0: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0000cbc0: 2063 6f6d 6269 6e65 645f 746f 706f 732e   combined_topos.
-0000cbd0: 6170 7065 6e64 286e 702e 6569 6e73 756d  append(np.einsum
-0000cbe0: 2827 636b 2c20 696b 202d 3e20 6327 2c20  ('ck, ik -> c', 
-0000cbf0: 636c 6173 735f 7061 7474 6572 6e73 2c20  class_patterns, 
-0000cc00: 5378 2929 0d0a 2020 2020 2020 2020 2020  Sx))..          
-0000cc10: 2020 2320 746f 706f 7320 3d20 6e70 2e73    # topos = np.s
-0000cc20: 7461 636b 2863 6f6d 6269 6e65 645f 746f  tack(combined_to
-0000cc30: 706f 732c 2031 290d 0a20 2020 2020 2020  pos, 1)..       
-0000cc40: 2023 2074 6f70 6f73 203d 206e 702e 7374   # topos = np.st
-0000cc50: 6163 6b28 636f 6d62 696e 6564 5f74 6f70  ack(combined_top
-0000cc60: 6f73 2c20 3129 0d0a 2020 2020 2020 2020  os, 1)..        
-0000cc70: 2320 6966 2068 6173 6174 7472 2873 656c  # if hasattr(sel
-0000cc80: 662c 2027 7472 7565 5f65 766f 6b65 6427  f, 'true_evoked'
-0000cc90: 293a 0d0a 2020 2020 2020 2020 2320 2020  ):..        #   
-0000cca0: 2020 6966 206e 702e 6e64 696d 2874 6f70    if np.ndim(top
-0000ccb0: 6f73 2920 3d3d 2032 3a0d 0a20 2020 2020  os) == 2:..     
-0000ccc0: 2020 2023 2020 2020 2020 2020 2074 7275     #         tru
-0000ccd0: 655f 636f 7272 203d 206e 702e 6469 6167  e_corr = np.diag
-0000cce0: 286e 702e 636f 7272 636f 6566 2874 6f70  (np.corrcoef(top
-0000ccf0: 6f73 2e54 2c20 7365 6c66 2e74 7275 655f  os.T, self.true_
-0000cd00: 6576 6f6b 6564 2e5f 6461 7461 2e54 292c  evoked._data.T),
-0000cd10: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
-0000cd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd30: 2020 2020 2020 2020 7365 6c66 2e74 7275          self.tru
-0000cd40: 655f 6576 6f6b 6564 2e5f 6461 7461 2e73  e_evoked._data.s
-0000cd50: 6861 7065 5b2d 315d 290d 0a20 2020 2020  hape[-1])..     
-0000cd60: 2020 2023 2020 2020 2065 6c69 6620 6e70     #     elif np
-0000cd70: 2e6e 6469 6d28 746f 706f 7329 203d 3d20  .ndim(topos) == 
-0000cd80: 333a 0d0a 2020 2020 2020 2020 2320 2020  3:..        #   
-0000cd90: 2020 2020 2020 7072 696e 7428 746f 706f        print(topo
-0000cda0: 732e 7368 6170 6529 0d0a 2020 2020 2020  s.shape)..      
-0000cdb0: 2020 2320 2020 2020 2020 2020 7472 7565    #         true
-0000cdc0: 5f63 6f72 7220 3d20 6e70 2e64 6961 6728  _corr = np.diag(
-0000cdd0: 6e70 2e63 6f72 7263 6f65 6628 746f 706f  np.corrcoef(topo
-0000cde0: 735b 3a2c 3a2c 2031 5d2e 542c 2073 656c  s[:,:, 1].T, sel
-0000cdf0: 662e 7472 7565 5f65 766f 6b65 642e 5f64  f.true_evoked._d
-0000ce00: 6174 612e 5429 2c0d 0a20 2020 2020 2020  ata.T),..       
-0000ce10: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000ce20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000ce30: 656c 662e 7472 7565 5f65 766f 6b65 642e  elf.true_evoked.
-0000ce40: 5f64 6174 612e 7368 6170 655b 2d31 5d29  _data.shape[-1])
-0000ce50: 0d0a 0d0a 2020 2020 2020 2020 2320 2020  ....        #   
-0000ce60: 2020 7072 696e 7428 274d 6561 6e20 6162    print('Mean ab
-0000ce70: 7320 636f 7272 3a20 7b3a 2e32 667d 2020  s corr: {:.2f}  
-0000ce80: 6e5f 6261 6473 3a20 7b7d 204d 696e 4d61  n_bads: {} MinMa
-0000ce90: 783a 207b 3a2e 3466 7d2d 7b3a 2e34 667d  x: {:.4f}-{:.4f}
-0000cea0: 272e 666f 726d 6174 280d 0a20 2020 2020  '.format(..     
-0000ceb0: 2020 2023 2020 2020 2020 2020 206e 702e     #         np.
-0000cec0: 6162 7328 7472 7565 5f63 6f72 7229 2e6d  abs(true_corr).m
-0000ced0: 6561 6e28 292c 0d0a 2020 2020 2020 2020  ean(),..        
-0000cee0: 2320 2020 2020 2020 2020 6e70 2e73 756d  #         np.sum
-0000cef0: 286e 702e 6162 7328 7472 7565 5f63 6f72  (np.abs(true_cor
-0000cf00: 7229 203c 202e 3929 2c0d 0a20 2020 2020  r) < .9),..     
-0000cf10: 2020 2023 2020 2020 2020 2020 206e 702e     #         np.
-0000cf20: 6d69 6e28 7472 7565 5f63 6f72 7229 2c20  min(true_corr), 
-0000cf30: 6e70 2e6d 6178 2874 7275 655f 636f 7272  np.max(true_corr
-0000cf40: 292c 0d0a 2020 2020 2020 2020 2320 2020  ),..        #   
-0000cf50: 2020 2020 2020 2020 2929 0d0a 0d0a 2020          ))....  
-0000cf60: 2020 2020 2020 2320 7265 7475 726e 2074        # return t
-0000cf70: 6f70 6f73 0d0a 0d0a 0d0a 0d0a 0d0a 2020  opos..........  
-0000cf80: 2020 6465 6620 636f 6d70 7574 655f 7061    def compute_pa
-0000cf90: 7474 6572 6e73 2873 656c 662c 2064 6174  tterns(self, dat
-0000cfa0: 615f 7061 7468 3d4e 6f6e 6529 3a0d 0a20  a_path=None):.. 
-0000cfb0: 2020 2020 2020 2022 2222 436f 6d70 7574         """Comput
-0000cfc0: 6573 2073 7061 7469 616c 2070 6174 7465  es spatial patte
-0000cfd0: 726e 7320 6672 6f6d 2066 696c 7465 7220  rns from filter 
-0000cfe0: 7765 6967 6874 732e 0d0a 2020 2020 2020  weights...      
-0000cff0: 2020 5265 7175 6972 6564 2066 6f72 2076    Required for v
-0000d000: 6973 7561 6c69 7a61 7469 6f6e 2e0d 0a0d  isualization....
-0000d010: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-0000d020: 6572 730d 0a20 2020 2020 2020 202d 2d2d  ers..        ---
-0000d030: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
-0000d040: 2064 6174 615f 7061 7468 203a 2073 7472   data_path : str
-0000d050: 206f 7220 6c69 7374 206f 6620 7374 720d   or list of str.
-0000d060: 0a20 2020 2020 2020 2020 2020 2050 6174  .            Pat
-0000d070: 6820 746f 2054 4652 6563 6f72 6420 6669  h to TFRecord fi
-0000d080: 6c65 7320 6f6e 2077 6869 6368 2074 6865  les on which the
-0000d090: 2070 6174 7465 726e 7320 6172 6520 6573   patterns are es
-0000d0a0: 7469 6d61 7465 642e 0d0a 0d0a 2020 2020  timated.....    
-0000d0b0: 2020 2020 6f75 7470 7574 203a 2073 7472      output : str
-0000d0c0: 207b 2770 6174 7465 726e 732c 2027 6669   {'patterns, 'fi
-0000d0d0: 6c74 6572 7327 2c20 2766 756c 6c5f 7061  lters', 'full_pa
-0000d0e0: 7474 6572 6e73 277d 0d0a 2020 2020 2020  tterns'}..      
-0000d0f0: 2020 2020 2020 5374 7269 6e67 2073 7065        String spe
-0000d100: 6369 6679 696e 6720 7468 6520 6f75 7470  cifying the outp
-0000d110: 7574 2e0d 0a0d 0a20 2020 2020 2020 2020  ut.....         
-0000d120: 2020 2027 6669 6c74 6572 7327 202d 2065     'filters' - e
-0000d130: 7874 7261 6374 7320 7765 6967 6874 7320  xtracts weights 
-0000d140: 6f66 2074 6865 2073 7061 7469 616c 2066  of the spatial f
-0000d150: 696c 7465 7273 0d0a 0d0a 2020 2020 2020  ilters....      
-0000d160: 2020 2020 2020 2770 6174 7465 726e 7327        'patterns'
-0000d170: 202d 2065 7874 7261 6374 7320 6163 7469   - extracts acti
-0000d180: 7661 7469 6f6e 2070 6174 7465 726e 732c  vation patterns,
-0000d190: 206f 6274 6169 6e65 6420 6279 0d0a 2020   obtained by..  
-0000d1a0: 2020 2020 2020 2020 2020 6c65 6674 2d6d            left-m
-0000d1b0: 756c 7469 7079 696e 6720 7468 6520 7370  ultipying the sp
-0000d1c0: 6174 6961 6c20 6669 6c74 6572 2077 6569  atial filter wei
-0000d1d0: 6768 7473 2062 7920 7468 6520 2873 7061  ghts by the (spa
-0000d1e0: 7469 616c 290d 0a20 2020 2020 2020 2020  tial)..         
-0000d1f0: 2020 2064 6174 6120 636f 7661 7269 616e     data covarian
-0000d200: 6365 2e0d 0a0d 0a20 2020 2020 2020 2020  ce.....         
-0000d210: 2020 2027 6675 6c6c 2d70 6174 7465 726e     'full-pattern
-0000d220: 7327 202d 2061 6464 6974 696f 6e61 6c6c  s' - additionall
-0000d230: 7920 6d75 6c74 6970 6c69 6573 2061 6374  y multiplies act
-0000d240: 6976 6174 696f 6e0d 0a20 2020 2020 2020  ivation..       
-0000d250: 2020 2020 2070 6174 7465 726e 7320 6279       patterns by
-0000d260: 2074 6865 2070 7265 6369 7369 6f6e 2028   the precision (
-0000d270: 696e 7665 7273 6520 636f 7661 7269 616e  inverse covarian
-0000d280: 6365 2920 6f66 2074 6865 0d0a 2020 2020  ce) of the..    
-0000d290: 2020 2020 2020 2020 6c61 7465 6e74 2073          latent s
-0000d2a0: 6f75 7263 6573 0d0a 0d0a 2020 2020 2020  ources....      
-0000d2b0: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
-0000d2c0: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
-0000d2d0: 2020 2020 7365 6c66 2e70 6174 7465 726e      self.pattern
-0000d2e0: 730d 0a20 2020 2020 2020 2020 2020 2073  s..            s
-0000d2f0: 7061 7469 616c 2066 696c 7465 7273 206f  patial filters o
-0000d300: 7220 6163 7469 7661 7469 6f6e 2070 6174  r activation pat
-0000d310: 7465 726e 732c 2064 6570 656e 6469 6e67  terns, depending
-0000d320: 206f 6e20 7468 650d 0a20 2020 2020 2020   on the..       
-0000d330: 2020 2020 2076 616c 7565 206f 6620 276f       value of 'o
-0000d340: 7574 7075 7427 2070 6172 616d 6574 6572  utput' parameter
-0000d350: 2e0d 0a0d 0a20 2020 2020 2020 2073 656c  .....        sel
-0000d360: 662e 6c61 745f 7463 730d 0a20 2020 2020  f.lat_tcs..     
-0000d370: 2020 2020 2020 2074 696d 6520 636f 7572         time cour
-0000d380: 7365 7320 6f66 206c 6174 656e 7420 736f  ses of latent so
-0000d390: 7572 7365 732e 0d0a 0d0a 2020 2020 2020  urses.....      
-0000d3a0: 2020 7365 6c66 2e66 696c 7465 7273 0d0a    self.filters..
-0000d3b0: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
-0000d3c0: 6f72 616c 2063 6f6e 766f 6c75 7469 6f6e  oral convolution
-0000d3d0: 616c 2066 696c 7465 7220 636f 6566 6669  al filter coeffi
-0000d3e0: 6369 656e 7473 2e0d 0a0d 0a20 2020 2020  cients.....     
-0000d3f0: 2020 2073 656c 662e 6f75 745f 7765 6967     self.out_weig
-0000d400: 6874 730d 0a20 2020 2020 2020 2020 2020  hts..           
-0000d410: 2077 6569 6768 7473 206f 6620 7468 6520   weights of the 
-0000d420: 6f75 7470 7574 206c 6179 6572 2e0d 0a0d  output layer....
-0000d430: 0a20 2020 2020 2020 2073 656c 662e 7266  .        self.rf
-0000d440: 6f63 730d 0a20 2020 2020 2020 2020 2020  ocs..           
-0000d450: 2066 6561 7475 7265 2072 656c 6576 616e   feature relevan
-0000d460: 6365 7320 666f 7220 7468 6520 6f75 7470  ces for the outp
-0000d470: 7574 206c 6179 6572 2e0d 0a20 2020 2020  ut layer...     
-0000d480: 2020 2020 2020 2028 5365 6520 7365 6c66         (See self
-0000d490: 2e67 6574 5f6f 7574 7075 745f 636f 7272  .get_output_corr
-0000d4a0: 656c 6174 696f 6e73 290d 0a0d 0a20 2020  elations)....   
-0000d4b0: 2020 2020 2052 6169 7365 733a 0d0a 2020       Raises:..  
-0000d4c0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
-0000d4d0: 2020 2020 2020 2020 2020 2041 7474 7269             Attri
-0000d4e0: 6275 7465 4572 726f 723a 2049 6620 6064  buteError: If `d
-0000d4f0: 6174 615f 7061 7468 6020 6973 206e 6f74  ata_path` is not
-0000d500: 2073 7065 6369 6669 6564 2e0d 0a20 2020   specified...   
-0000d510: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0000d520: 2020 2376 6973 5f64 6963 7420 3d20 4e6f    #vis_dict = No
-0000d530: 6e65 0d0a 2020 2020 2020 2020 6966 206e  ne..        if n
-0000d540: 6f74 2064 6174 615f 7061 7468 3a0d 0a20  ot data_path:.. 
-0000d550: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0000d560: 2822 436f 6d70 7574 696e 6720 7061 7474  ("Computing patt
-0000d570: 6572 6e73 3a20 4e6f 2070 6174 6820 7370  erns: No path sp
-0000d580: 6563 6966 6965 642c 2075 7369 6e67 2076  ecified, using v
-0000d590: 616c 6964 6174 696f 6e20 6461 7461 7365  alidation datase
-0000d5a0: 7420 2844 6566 6175 6c74 2922 290d 0a20  t (Default)").. 
-0000d5b0: 2020 2020 2020 2020 2020 2064 7320 3d20             ds = 
-0000d5c0: 7365 6c66 2e64 6174 6173 6574 2e76 616c  self.dataset.val
-0000d5d0: 0d0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
-0000d5e0: 7369 6e73 7461 6e63 6528 6461 7461 5f70  sinstance(data_p
-0000d5f0: 6174 682c 2073 7472 2920 6f72 2069 7369  ath, str) or isi
-0000d600: 6e73 7461 6e63 6528 6461 7461 5f70 6174  nstance(data_pat
-0000d610: 682c 2028 6c69 7374 2c20 7475 706c 6529  h, (list, tuple)
-0000d620: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0000d630: 2354 4f44 4f3a 2072 6562 616c 6e63 653f  #TODO: rebalnce?
-0000d640: 0d0a 2020 2020 2020 2020 2020 2020 6473  ..            ds
-0000d650: 203d 2073 656c 662e 6461 7461 7365 742e   = self.dataset.
-0000d660: 5f62 7569 6c64 5f64 6174 6173 6574 2864  _build_dataset(d
-0000d670: 6174 615f 7061 7468 2c0d 0a20 2020 2020  ata_path,..     
-0000d680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6a0: 2020 2020 2020 2020 7370 6c69 743d 4661          split=Fa
-0000d6b0: 6c73 652c 0d0a 2020 2020 2020 2020 2020  lse,..          
-0000d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6e0: 2020 2074 6573 745f 6261 7463 683d 4e6f     test_batch=No
-0000d6f0: 6e65 2c0d 0a20 2020 2020 2020 2020 2020  ne,..           
-0000d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d720: 2020 7265 7065 6174 3d54 7275 6529 0d0a    repeat=True)..
-0000d730: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-0000d740: 6e73 7461 6e63 6528 6461 7461 5f70 6174  nstance(data_pat
-0000d750: 682c 2044 6174 6173 6574 293a 0d0a 2020  h, Dataset):..  
-0000d760: 2020 2020 2020 2020 2020 6966 2068 6173            if has
-0000d770: 6174 7472 2864 6174 615f 7061 7468 2c20  attr(data_path, 
-0000d780: 2774 6573 7427 293a 0d0a 2020 2020 2020  'test'):..      
-0000d790: 2020 2020 2020 2020 2020 6473 203d 2064            ds = d
-0000d7a0: 6174 615f 7061 7468 2e74 6573 740d 0a20  ata_path.test.. 
-0000d7b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000d7c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d7d0: 2020 6473 203d 2064 6174 615f 7061 7468    ds = data_path
-0000d7e0: 2e76 616c 0d0a 2020 2020 2020 2020 656c  .val..        el
-0000d7f0: 6966 2069 7369 6e73 7461 6e63 6528 6461  if isinstance(da
-0000d800: 7461 5f70 6174 682c 2074 662e 6461 7461  ta_path, tf.data
-0000d810: 2e44 6174 6173 6574 293a 0d0a 2020 2020  .Dataset):..    
-0000d820: 2020 2020 2020 2020 6473 203d 2064 6174          ds = dat
-0000d830: 615f 7061 7468 0d0a 2020 2020 2020 2020  a_path..        
-0000d840: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0000d850: 2020 2072 6169 7365 2041 7474 7269 6275     raise Attribu
-0000d860: 7465 4572 726f 7228 2753 7065 6369 6679  teError('Specify
-0000d870: 2064 6174 6173 6574 206f 7220 6461 7461   dataset or data
-0000d880: 2070 6174 682e 2729 0d0a 0d0a 0d0a 2020   path.')......  
-0000d890: 2020 2020 2020 582c 2079 203d 205b 726f        X, y = [ro
-0000d8a0: 7720 666f 7220 726f 7720 696e 2064 732e  w for row in ds.
-0000d8b0: 7461 6b65 2831 295d 5b30 5d0d 0a0d 0a20  take(1)][0].... 
-0000d8c0: 2020 2020 2020 2073 656c 662e 6e66 6674         self.nfft
-0000d8d0: 203d 2031 3238 0d0a 2020 2020 2020 2020   = 128..        
-0000d8e0: 6e64 6f66 203d 2058 2e73 6861 7065 5b30  ndof = X.shape[0
-0000d8f0: 5d20 2a20 7365 6c66 2e64 6174 6173 6574  ] * self.dataset
-0000d900: 2e68 5f70 6172 616d 735b 276e 5f74 275d  .h_params['n_t']
-0000d910: 202d 2031 0d0a 0d0a 2020 2020 2020 2020   - 1....        
-0000d920: 2363 6f6d 6269 6e65 645f 746f 706f 7320  #combined_topos 
-0000d930: 3d20 5b5d 0d0a 0d0a 2020 2020 2020 2020  = []....        
-0000d940: 2367 6574 206c 6179 6572 2061 6374 6976  #get layer activ
-0000d950: 6174 696f 6e73 0d0a 2020 2020 2020 2020  ations..        
-0000d960: 6163 7469 7661 7469 6f6e 7320 3d20 7b7d  activations = {}
-0000d970: 0d0a 2020 2020 2020 2020 2320 4578 7472  ..        # Extr
-0000d980: 6163 7420 6163 7469 7661 7469 6f6e 730d  act activations.
-0000d990: 0a20 2020 2020 2020 2061 6374 6976 6174  .        activat
-0000d9a0: 696f 6e73 5b27 646d 7827 5d20 3d20 7365  ions['dmx'] = se
-0000d9b0: 6c66 2e64 6d78 2858 290d 0a20 2020 2020  lf.dmx(X)..     
-0000d9c0: 2020 2061 6374 6976 6174 696f 6e73 5b27     activations['
-0000d9d0: 7463 6f6e 7627 5d20 3d20 7365 6c66 2e70  tconv'] = self.p
-0000d9e0: 6f6f 6c28 7365 6c66 2e74 636f 6e76 2861  ool(self.tconv(a
-0000d9f0: 6374 6976 6174 696f 6e73 5b27 646d 7827  ctivations['dmx'
-0000da00: 5d29 290d 0a20 2020 2020 2020 2061 6374  ]))..        act
-0000da10: 6976 6174 696f 6e73 5b27 6663 275d 2020  ivations['fc']  
-0000da20: 3d20 7365 6c66 2e66 696e 5f66 6328 6163  = self.fin_fc(ac
-0000da30: 7469 7661 7469 6f6e 735b 2774 636f 6e76  tivations['tconv
-0000da40: 275d 290d 0a0d 0a20 2020 2020 2020 2070  '])....        p
-0000da50: 7269 6e74 2822 2222 2241 6374 6976 6174  rint(""""Activat
-0000da60: 696f 6e73 3a20 5c6e 0d0a 2020 2020 2020  ions: \n..      
-0000da70: 2020 2020 2020 2020 444d 583a 207b 7d0d          DMX: {}.
-0000da80: 0a20 2020 2020 2020 2020 2020 2020 2054  .              T
-0000da90: 434f 4e56 3a20 7b7d 0d0a 2020 2020 2020  CONV: {}..      
-0000daa0: 2020 2020 2020 2020 4643 5f44 454e 5345          FC_DENSE
-0000dab0: 3a20 7b7d 2222 222e 666f 726d 6174 280d  : {}""".format(.
-0000dac0: 0a20 2020 2020 2020 2020 2020 2020 2061  .              a
-0000dad0: 6374 6976 6174 696f 6e73 5b27 646d 7827  ctivations['dmx'
-0000dae0: 5d2e 7368 6170 652c 0d0a 2020 2020 2020  ].shape,..      
-0000daf0: 2020 2020 2020 2020 6163 7469 7661 7469          activati
-0000db00: 6f6e 735b 2774 636f 6e76 275d 2e73 6861  ons['tconv'].sha
-0000db10: 7065 2c0d 0a20 2020 2020 2020 2020 2020  pe,..           
-0000db20: 2020 2061 6374 6976 6174 696f 6e73 5b27     activations['
-0000db30: 6663 275d 2e73 6861 7065 2929 0d0a 0d0a  fc'].shape))....
-0000db40: 2020 2020 2020 2020 7061 7474 6572 6e73          patterns
-0000db50: 5f73 7472 7563 7420 3d20 7b27 7765 6967  _struct = {'weig
-0000db60: 6874 7327 203a 207b 2764 6d78 273a 5b5d  hts' : {'dmx':[]
-0000db70: 2c20 2774 636f 6e76 273a 5b5d 2c20 2766  , 'tconv':[], 'f
-0000db80: 6327 3a5b 5d2c 2027 7463 6f6e 765f 6672  c':[], 'tconv_fr
-0000db90: 6571 5f72 6573 706f 7365 7327 3a7b 7d7d  eq_resposes':{}}
-0000dba0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000dbb0: 2020 2020 2020 2020 2020 2020 2020 2763                'c
-0000dbc0: 636d 7327 203a 207b 2764 6d78 273a 5b5d  cms' : {'dmx':[]
-0000dbd0: 2c20 2774 636f 6e76 273a 5b5d 2c20 2766  , 'tconv':[], 'f
-0000dbe0: 6327 3a5b 5d2c 2027 696e 7075 7427 3a5b  c':[], 'input':[
-0000dbf0: 5d2c 2027 646d 785f 7073 6427 3a5b 5d7d  ], 'dmx_psd':[]}
-0000dc00: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000dc10: 2020 2020 2020 2020 2020 2020 2020 2764                'd
-0000dc20: 636f 7627 203a 207b 2769 6e70 7574 5f73  cov' : {'input_s
-0000dc30: 7061 7469 616c 273a 5b5d 2c20 2763 6c61  patial':[], 'cla
-0000dc40: 7373 5f63 6f6e 6469 7469 6f6e 616c 273a  ss_conditional':
-0000dc50: 5b5d 2c0d 0a20 2020 2020 2020 2020 2020  [],..           
-0000dc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc70: 2020 2020 2020 2020 2020 276b 2d31 273a            'k-1':
-0000dc80: 5b5d 7d2c 0d0a 2020 2020 2020 2020 2020  []},..          
-0000dc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dca0: 2027 7061 7474 6572 6e73 2720 3a20 7b7d   'patterns' : {}
-0000dcb0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000dcc0: 2020 2020 2020 2020 2020 2020 2020 2773                's
-0000dcd0: 7065 6374 7261 273a 207b 7d2c 0d0a 2020  pectra': {},..  
-0000dce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dcf0: 2020 2020 2020 2020 207d 0d0a 2020 2020           }..    
-0000dd00: 2020 2020 7765 6967 6874 7320 3d20 7365      weights = se
-0000dd10: 6c66 2e67 6574 5f77 6569 6768 7473 2829  lf.get_weights()
-0000dd20: 0d0a 2020 2020 2020 2020 7370 6563 7472  ..        spectr
-0000dd30: 6120 3d20 7365 6c66 2e67 6574 5f73 7065  a = self.get_spe
-0000dd40: 6374 7261 2877 6569 6768 7473 3d77 6569  ctra(weights=wei
-0000dd50: 6768 7473 2c20 6163 7469 7661 7469 6f6e  ghts, activation
-0000dd60: 733d 6163 7469 7661 7469 6f6e 7329 0d0a  s=activations)..
-0000dd70: 0d0a 2020 2020 2020 2020 2343 434d 7320  ..        #CCMs 
-0000dd80: 6172 6520 6d65 616e 2061 6374 6976 6174  are mean activat
-0000dd90: 696f 6e73 206f 6620 6561 6368 206c 6179  ions of each lay
-0000dda0: 6572 2066 6f72 2065 6163 6820 636c 6173  er for each clas
-0000ddb0: 730d 0a0d 0a20 2020 2020 2020 2064 636f  s....        dco
-0000ddc0: 7620 3d20 7b7d 0d0a 2020 2020 2020 2020  v = {}..        
-0000ddd0: 6463 6f76 5b27 696e 7075 745f 7370 6174  dcov['input_spat
-0000dde0: 6961 6c27 5d20 3d20 6e70 2e65 696e 7375  ial'] = np.einsu
-0000ddf0: 6d28 2768 696a 6b2c 2068 696a 6c20 2d3e  m('hijk, hijl ->
-0000de00: 206b 6c27 2c20 582c 2058 2920 2f20 6e64   kl', X, X) / nd
-0000de10: 6f66 0d0a 2020 2020 2020 2020 6463 6f76  of..        dcov
-0000de20: 5b27 636c 6173 735f 636f 6e64 6974 696f  ['class_conditio
-0000de30: 6e61 6c27 5d2c 2064 636f 765b 276b 2d31  nal'], dcov['k-1
-0000de40: 275d 2020 3d20 7365 6c66 2e5f 6765 745f  ']  = self._get_
-0000de50: 636c 6173 735f 636f 6e64 6974 696f 6e61  class_conditiona
-0000de60: 6c5f 7370 6174 6961 6c5f 636f 7661 7269  l_spatial_covari
-0000de70: 616e 6365 2858 2c20 7929 0d0a 0d0a 2020  ance(X, y)....  
-0000de80: 2020 2020 2020 2323 5472 7565 2065 766f        ##True evo
-0000de90: 6b65 640d 0a20 2020 2020 2020 2069 6620  ked..        if 
-0000dea0: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
-0000deb0: 6172 616d 735b 2774 6172 6765 745f 7479  arams['target_ty
-0000dec0: 7065 275d 203d 3d20 2766 6c6f 6174 273a  pe'] == 'float':
-0000ded0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000dee0: 6c66 2e74 7275 655f 6576 6f6b 6564 5f64  lf.true_evoked_d
-0000def0: 6174 6120 3d20 582e 6e75 6d70 7928 292e  ata = X.numpy().
-0000df00: 6d65 616e 2830 290d 0a20 2020 2020 2020  mean(0)..       
-0000df10: 2065 6c69 6620 7365 6c66 2e64 6174 6173   elif self.datas
-0000df20: 6574 2e68 5f70 6172 616d 735b 2774 6172  et.h_params['tar
-0000df30: 6765 745f 7479 7065 275d 203d 3d20 2769  get_type'] == 'i
-0000df40: 6e74 273a 0d0a 2020 2020 2020 2020 2020  nt':..          
-0000df50: 2020 795f 696e 7420 3d20 6e70 2e61 7267    y_int = np.arg
-0000df60: 6d61 7828 792c 2031 290d 0a20 2020 2020  max(y, 1)..     
-0000df70: 2020 2020 2020 2079 5f75 6e69 7175 6520         y_unique 
-0000df80: 3d20 6e70 2e75 6e69 7175 6528 795f 696e  = np.unique(y_in
-0000df90: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-0000dfa0: 6576 6f6b 6564 7320 3d20 6e70 2e61 7272  evokeds = np.arr
-0000dfb0: 6179 285b 582e 6e75 6d70 7928 295b 795f  ay([X.numpy()[y_
-0000dfc0: 696e 7420 3d3d 2069 2c20 2e2e 2e5d 2e6d  int == i, ...].m
-0000dfd0: 6561 6e28 3029 0d0a 2020 2020 2020 2020  ean(0)..        
-0000dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dff0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-0000e000: 2079 5f75 6e69 7175 655d 290d 0a20 2020   y_unique])..   
-0000e010: 2020 2020 2020 2020 2073 656c 662e 7472           self.tr
-0000e020: 7565 5f65 766f 6b65 645f 6461 7461 203d  ue_evoked_data =
-0000e030: 206e 702e 7371 7565 657a 6528 6576 6f6b   np.squeeze(evok
-0000e040: 6564 7329 0d0a 0d0a 0d0a 2020 2020 2020  eds)......      
-0000e050: 2020 2320 636f 6d70 7574 6520 7468 6520    # compute the 
-0000e060: 6566 6665 6374 206f 6620 7265 6d6f 7669  effect of removi
-0000e070: 6e67 2065 6163 6820 6c61 7465 6e74 2063  ng each latent c
-0000e080: 6f6d 706f 6e65 6e74 206f 6e20 7468 6520  omponent on the 
-0000e090: 636f 7374 2066 756e 6374 696f 6e0d 0a20  cost function.. 
-0000e0a0: 2020 2020 2020 2073 656c 662e 636f 6d70         self.comp
-0000e0b0: 7769 7365 5f6c 6f73 7365 7320 3d20 7365  wise_losses = se
-0000e0c0: 6c66 2e63 6f6d 7075 7465 5f63 6f6d 706f  lf.compute_compo
-0000e0d0: 6e65 6e74 7769 7365 5f6c 6f73 7328 582c  nentwise_loss(X,
-0000e0e0: 2079 2c20 7765 6967 6874 7329 0d0a 0d0a   y, weights)....
-0000e0f0: 2020 2020 2020 2020 2354 4f44 4f3a 2063          #TODO: c
-0000e100: 6c61 7373 2063 6f6e 6474 6974 696f 6e61  lass condtitiona
-0000e110: 6c20 7761 7665 666f 726d 7320 2d3e 2061  l waveforms -> a
-0000e120: 6374 6976 6174 696f 6e73 0d0a 2020 2020  ctivations..    
-0000e130: 2020 2020 2373 656c 662e 7761 7665 666f      #self.wavefo
-0000e140: 726d 7320 3d20 6e70 2e6d 6561 6e28 6163  rms = np.mean(ac
-0000e150: 7469 7661 7469 6f6e 735b 2764 6d78 275d  tivations['dmx']
-0000e160: 292e 540d 0a20 2020 2020 2020 2070 6174  ).T..        pat
-0000e170: 7465 726e 7320 3d20 7b7d 0d0a 2020 2020  terns = {}..    
-0000e180: 2020 2020 7061 7474 6572 6e73 5b27 636f      patterns['co
-0000e190: 765f 7878 275d 203d 2073 656c 662e 7061  v_xx'] = self.pa
-0000e1a0: 7474 6572 6e73 5f63 6f76 5f78 7828 792c  tterns_cov_xx(y,
-0000e1b0: 2077 6569 6768 7473 2c20 6163 7469 7661   weights, activa
-0000e1c0: 7469 6f6e 732c 2064 636f 7629 0d0a 0d0a  tions, dcov)....
-0000e1d0: 2020 2020 2020 2020 5378 5f74 636f 6e76          Sx_tconv
-0000e1e0: 2c20 5378 5f64 6d78 203d 204e 6f6e 652c  , Sx_dmx = None,
-0000e1f0: 204e 6f6e 6523 7365 6c66 2e70 6174 7465   None#self.patte
-0000e200: 726e 735f 636f 765f 7879 5f68 6174 2858  rns_cov_xy_hat(X
-0000e210: 2c20 792c 2061 6374 6976 6174 696f 6e73  , y, activations
-0000e220: 2c20 7765 6967 6874 7329 0d0a 2020 2020  , weights)..    
-0000e230: 2020 2020 2320 5378 5f74 636f 6e76 5f63      # Sx_tconv_c
-0000e240: 636d 203d 205b 5d0d 0a20 2020 2020 2020  cm = []..       
-0000e250: 2023 2023 5378 5f64 6d78 5f63 636d 203d   # #Sx_dmx_ccm =
-0000e260: 205b 5d0d 0a20 2020 2020 2020 2023 2053   []..        # S
-0000e270: 785f 6663 5f63 636d 203d 205b 5d0d 0a20  x_fc_ccm = [].. 
-0000e280: 2020 2020 2020 2023 2070 6174 7465 726e         # pattern
-0000e290: 735f 6378 7920 3d20 5b5d 0d0a 2020 2020  s_cxy = []..    
-0000e2a0: 2020 2020 2320 666f 7220 636c 6173 735f      # for class_
-0000e2b0: 7920 696e 2072 616e 6765 2873 656c 662e  y in range(self.
-0000e2c0: 6f75 745f 6469 6d29 3a0d 0a20 2020 2020  out_dim):..     
-0000e2d0: 2020 2023 2020 2020 2063 6c61 7373 5f69     #     class_i
-0000e2e0: 6e64 203d 2074 662e 7371 7565 657a 6528  nd = tf.squeeze(
-0000e2f0: 7466 2e77 6865 7265 2874 662e 6172 676d  tf.where(tf.argm
-0000e300: 6178 2879 2c20 3129 3d3d 636c 6173 735f  ax(y, 1)==class_
-0000e310: 7929 2923 5b30 5d0d 0a20 2020 2020 2020  y))#[0]..       
-0000e320: 2023 2020 2020 2053 785f 7463 6f6e 765f   #     Sx_tconv_
-0000e330: 6363 6d2e 6170 7065 6e64 2853 785f 7463  ccm.append(Sx_tc
-0000e340: 6f6e 765b 636c 6173 735f 696e 642c 202e  onv[class_ind, .
-0000e350: 2e2e 5d2e 6d65 616e 2830 2929 0d0a 2020  ..].mean(0))..  
-0000e360: 2020 2020 2020 2320 2020 2020 2353 785f        #     #Sx_
-0000e370: 646d 785f 6363 6d2e 6170 7065 6e64 2853  dmx_ccm.append(S
-0000e380: 785f 646d 785b 636c 6173 735f 696e 642c  x_dmx[class_ind,
-0000e390: 202e 2e2e 5d2e 6d65 616e 2830 2c20 6b65   ...].mean(0, ke
-0000e3a0: 6570 6469 6d73 3d54 7275 6529 290d 0a20  epdims=True)).. 
-0000e3b0: 2020 2020 2020 2023 2020 2020 2023 6120         #     #a 
-0000e3c0: 3d20 6163 7469 7661 7469 6f6e 735b 2774  = activations['t
-0000e3d0: 636f 6e76 275d 2e6e 756d 7079 2829 5b63  conv'].numpy()[c
-0000e3e0: 6c61 7373 5f69 6e64 2c20 2e2e 2e5d 2e6d  lass_ind, ...].m
-0000e3f0: 6561 6e28 3029 2a77 6569 6768 7473 5b27  ean(0)*weights['
-0000e400: 6f75 745f 7765 6967 6874 7327 5d5b 4e6f  out_weights'][No
-0000e410: 6e65 2c20 2e2e 2e2c 2063 6c61 7373 5f79  ne, ..., class_y
-0000e420: 5d0d 0a20 2020 2020 2020 2023 2020 2020  ]..        #    
-0000e430: 2053 785f 6663 5f63 636d 2e61 7070 656e   Sx_fc_ccm.appen
-0000e440: 6428 6163 7469 7661 7469 6f6e 735b 2766  d(activations['f
-0000e450: 6327 5d2e 6e75 6d70 7928 295b 636c 6173  c'].numpy()[clas
-0000e460: 735f 696e 642c 202e 2e2e 5d2e 6d65 616e  s_ind, ...].mean
-0000e470: 2830 2c20 6b65 6570 6469 6d73 3d54 7275  (0, keepdims=Tru
-0000e480: 6529 290d 0a20 2020 2020 2020 2023 2020  e))..        #  
-0000e490: 2020 2023 2070 6174 7465 726e 735f 6378     # patterns_cx
-0000e4a0: 792e 6170 7065 6e64 286e 702e 646f 7428  y.append(np.dot(
-0000e4b0: 6463 6f76 5b27 636c 6173 735f 636f 6e64  dcov['class_cond
-0000e4c0: 6974 696f 6e61 6c27 5d5b 636c 6173 735f  itional'][class_
-0000e4d0: 795d 2c0d 0a20 2020 2020 2020 2023 2020  y],..        #  
-0000e4e0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000e4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e500: 2020 2020 5378 5f64 6d78 5b63 6c61 7373      Sx_dmx[class
-0000e510: 5f69 6e64 2c20 2e2e 2e5d 2e6d 6561 6e28  _ind, ...].mean(
-0000e520: 3029 2929 0d0a 2020 2020 2020 2020 2320  0)))..        # 
-0000e530: 2020 2020 2370 6174 7465 726e 735f 6378      #patterns_cx
-0000e540: 792e 6170 7065 6e64 286e 702e 646f 7428  y.append(np.dot(
-0000e550: 6463 6f76 5b27 696e 7075 745f 7370 6174  dcov['input_spat
-0000e560: 6961 6c27 5d2c 0d0a 2020 2020 2020 2020  ial'],..        
-0000e570: 2320 2020 2020 2320 2020 2020 2020 2020  #     #         
-0000e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e590: 2020 2053 785f 646d 785b 636c 6173 735f     Sx_dmx[class_
-0000e5a0: 696e 642c 202e 2e2e 5d2e 6d65 616e 2830  ind, ...].mean(0
-0000e5b0: 2929 290d 0a20 2020 2020 2020 2023 2063  )))..        # c
-0000e5c0: 636d 7320 3d20 7b7d 0d0a 2020 2020 2020  cms = {}..      
-0000e5d0: 2020 2320 6363 6d73 5b27 7463 6f6e 7627    # ccms['tconv'
-0000e5e0: 5d20 3d20 6e70 2e63 6f6e 6361 7465 6e61  ] = np.concatena
-0000e5f0: 7465 2853 785f 7463 6f6e 765f 6363 6d2c  te(Sx_tconv_ccm,
-0000e600: 2030 290d 0a20 2020 2020 2020 2023 6363   0)..        #cc
-0000e610: 6d73 5b27 646d 7827 5d20 3d20 6e70 2e63  ms['dmx'] = np.c
-0000e620: 6f6e 6361 7465 6e61 7465 2853 785f 646d  oncatenate(Sx_dm
-0000e630: 785f 6363 6d2c 2030 290d 0a20 2020 2020  x_ccm, 0)..     
-0000e640: 2020 2023 6363 6d73 5b27 6663 275d 203d     #ccms['fc'] =
-0000e650: 206e 702e 636f 6e63 6174 656e 6174 6528   np.concatenate(
-0000e660: 5378 5f66 635f 6363 6d2c 2030 290d 0a0d  Sx_fc_ccm, 0)...
-0000e670: 0a0d 0a20 2020 2020 2020 2023 7061 7474  ...        #patt
-0000e680: 6572 6e73 5b27 636f 765f 7879 275d 203d  erns['cov_xy'] =
-0000e690: 2053 785f 646d 780d 0a20 2020 2020 2020   Sx_dmx..       
-0000e6a0: 2070 6174 7465 726e 735b 2770 696e 765f   patterns['pinv_
-0000e6b0: 7727 5d20 3d20 7365 6c66 2e70 6174 7465  w'] = self.patte
-0000e6c0: 726e 735f 7069 6e76 5f77 2879 2c20 7765  rns_pinv_w(y, we
-0000e6d0: 6967 6874 732c 2061 6374 6976 6174 696f  ights, activatio
-0000e6e0: 6e73 2c20 6463 6f76 292e 6d65 616e 282d  ns, dcov).mean(-
-0000e6f0: 3129 0d0a 0d0a 2020 2020 2020 2020 7061  1)....        pa
-0000e700: 7474 6572 6e73 5b27 7766 635f 6d65 616e  tterns['wfc_mean
-0000e710: 275d 203d 2073 656c 662e 7061 7474 6572  '] = self.patter
-0000e720: 6e73 5f77 6663 5f6d 6561 6e28 792c 2077  ns_wfc_mean(y, w
-0000e730: 6569 6768 7473 2c20 6163 7469 7661 7469  eights, activati
-0000e740: 6f6e 732c 2064 636f 7629 0d0a 0d0a 0d0a  ons, dcov)......
-0000e750: 2020 2020 2020 2020 7061 7474 6572 6e73          patterns
-0000e760: 5f73 7472 7563 745b 2777 6569 6768 7473  _struct['weights
-0000e770: 275d 203d 2077 6569 6768 7473 0d0a 2020  '] = weights..  
-0000e780: 2020 2020 2020 7061 7474 6572 6e73 5f73        patterns_s
-0000e790: 7472 7563 745b 2773 7065 6374 7261 275d  truct['spectra']
-0000e7a0: 203d 2073 7065 6374 7261 0d0a 2020 2020   = spectra..    
-0000e7b0: 2020 2020 7061 7474 6572 6e73 5f73 7472      patterns_str
-0000e7c0: 7563 745b 2764 636f 7627 5d20 3d20 6463  uct['dcov'] = dc
-0000e7d0: 6f76 0d0a 2020 2020 2020 2020 7061 7474  ov..        patt
-0000e7e0: 6572 6e73 5f73 7472 7563 745b 2763 636d  erns_struct['ccm
-0000e7f0: 7327 5d20 3d20 7b7d 2363 636d 730d 0a20  s'] = {}#ccms.. 
-0000e800: 2020 2020 2020 2070 6174 7465 726e 735f         patterns_
-0000e810: 7374 7275 6374 5b27 7061 7474 6572 6e73  struct['patterns
-0000e820: 275d 203d 2070 6174 7465 726e 730d 0a0d  '] = patterns...
-0000e830: 0a20 2020 2020 2020 2023 636f 6d70 7574  .        #comput
-0000e840: 6520 7468 6520 6566 6665 6374 206f 6620  e the effect of 
-0000e850: 7265 6d6f 7669 6e67 2065 6163 6820 6c61  removing each la
-0000e860: 7465 6e74 2063 6f6d 706f 6e65 6e74 206f  tent component o
-0000e870: 6e20 7468 6520 636f 7374 2066 756e 6374  n the cost funct
-0000e880: 696f 6e0d 0a20 2020 2020 2020 2070 6174  ion..        pat
-0000e890: 7465 726e 735f 7374 7275 6374 5b27 636f  terns_struct['co
-0000e8a0: 6d70 7769 7365 5f6c 6f73 7327 5d20 3d20  mpwise_loss'] = 
-0000e8b0: 7365 6c66 2e63 6f6d 7075 7465 5f63 6f6d  self.compute_com
-0000e8c0: 706f 6e65 6e74 7769 7365 5f6c 6f73 7328  ponentwise_loss(
-0000e8d0: 582c 2079 2c20 7765 6967 6874 7329 0d0a  X, y, weights)..
-0000e8e0: 2020 2020 2020 2020 2363 6f72 7265 6c61          #correla
-0000e8f0: 7469 6f6e 206f 6620 6663 2061 6374 6976  tion of fc activ
-0000e900: 6174 696f 6e73 2074 6f20 790d 0a20 2020  ations to y..   
-0000e910: 2020 2020 2070 6174 7465 726e 735f 7374       patterns_st
-0000e920: 7275 6374 5b27 636f 7272 5f74 6f5f 6f75  ruct['corr_to_ou
-0000e930: 7470 7574 275d 203d 2073 656c 662e 6765  tput'] = self.ge
-0000e940: 745f 6f75 7470 7574 5f63 6f72 7265 6c61  t_output_correla
-0000e950: 7469 6f6e 7328 6163 7469 7661 7469 6f6e  tions(activation
-0000e960: 7329 0d0a 2020 2020 2020 2020 2373 656c  s)..        #sel
-0000e970: 662e 6f75 745f 7765 6967 6874 7320 3d20  f.out_weights = 
-0000e980: 7765 6967 6874 735b 276f 7574 5f77 6569  weights['out_wei
-0000e990: 6768 7473 275d 0d0a 2020 2020 2020 2020  ghts']..        
-0000e9a0: 6465 6c20 582c 2061 6374 6976 6174 696f  del X, activatio
-0000e9b0: 6e73 0d0a 0d0a 2020 2020 2020 2020 7265  ns....        re
-0000e9c0: 7475 726e 2070 6174 7465 726e 735f 7374  turn patterns_st
-0000e9d0: 7275 6374 0d0a 2020 2020 2020 2020 2320  ruct..        # 
-0000e9e0: 4f74 6865 720d 0a20 2020 2020 2020 2023  Other..        #
-0000e9f0: 7365 6c66 2e79 5f74 7275 6520 3d20 6e70  self.y_true = np
-0000ea00: 2e73 7175 6565 7a65 2879 2e6e 756d 7079  .squeeze(y.numpy
-0000ea10: 2829 290d 0a0d 0a0d 0a20 2020 2064 6566  ())......    def
-0000ea20: 2063 6f6c 6c65 6374 5f70 6174 7465 726e   collect_pattern
-0000ea30: 7328 7365 6c66 2c20 666f 6c64 3d30 2c20  s(self, fold=0, 
-0000ea40: 6e5f 666f 6c64 733d 312c 206e 5f63 6f6d  n_folds=1, n_com
-0000ea50: 703d 312c 0d0a 2020 2020 2020 2020 2020  p=1,..          
-0000ea60: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000ea70: 6574 686f 6473 3d5b 2777 6569 6768 7427  ethods=['weight'
-0000ea80: 2c20 2763 6f6d 7077 6973 655f 6c6f 7373  , 'compwise_loss
+0000c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c410: 2020 2020 2020 2053 786d 2929 0d0a 2020         Sxm))..  
+0000c420: 2020 2020 2020 746f 706f 7320 3d20 6e70        topos = np
+0000c430: 2e73 7461 636b 2863 6f6d 6269 6e65 645f  .stack(combined_
+0000c440: 746f 706f 732c 2031 290d 0a20 2020 2020  topos, 1)..     
+0000c450: 2020 2072 6574 7572 6e20 746f 706f 730d     return topos.
+0000c460: 0a0d 0a0d 0a20 2020 2064 6566 2070 6174  .....    def pat
+0000c470: 7465 726e 735f 7766 635f 6d65 616e 2873  terns_wfc_mean(s
+0000c480: 656c 662c 2079 2c20 7765 6967 6874 732c  elf, y, weights,
+0000c490: 2061 6374 6976 6174 696f 6e73 2c20 6463   activations, dc
+0000c4a0: 6f76 293a 0d0a 2020 2020 2020 2020 636f  ov):..        co
+0000c4b0: 6d62 696e 6564 5f74 6f70 6f73 203d 205b  mbined_topos = [
+0000c4c0: 5d0d 0a20 2020 2020 2020 2023 7573 6573  ]..        #uses
+0000c4d0: 2079 2065 7870 6c69 6369 7465 6c79 2069   y explicitely i
+0000c4e0: 6e73 7465 6164 206f 6620 636f 765b 782c  nstead of cov[x,
+0000c4f0: 795d 0d0a 2020 2020 2020 2020 2361 6363  y]..        #acc
+0000c500: 7572 6174 6520 6275 7420 6861 7320 6c69  urate but has li
+0000c510: 7474 6c65 2074 6f20 646f 2077 6974 6820  ttle to do with 
+0000c520: 7468 6520 6d6f 6465 6c0d 0a20 2020 2020  the model..     
+0000c530: 2020 2023 6463 203d 2064 636f 765b 2769     #dc = dcov['i
+0000c540: 6e70 7574 5f73 7061 7469 616c 275d 0d0a  nput_spatial']..
+0000c550: 2020 2020 2020 2020 666f 7220 636c 6173          for clas
+0000c560: 735f 7920 696e 2072 616e 6765 2873 656c  s_y in range(sel
+0000c570: 662e 6f75 745f 6469 6d29 3a0d 0a20 2020  f.out_dim):..   
+0000c580: 2020 2020 2020 2020 2023 636f 6d70 7574           #comput
+0000c590: 6520 6d65 616e 2061 6374 6976 6174 696f  e mean activatio
+0000c5a0: 6e20 6f66 2066 696e 616c 206c 6179 6572  n of final layer
+0000c5b0: 2066 6f72 2065 6163 6820 636c 6173 730d   for each class.
+0000c5c0: 0a20 2020 2020 2020 2020 2020 2023 544f  .            #TO
+0000c5d0: 444f 3a20 2d3e 2074 6f20 7365 6c66 2e61  DO: -> to self.a
+0000c5e0: 6374 6976 6174 696f 6e73 0d0a 2020 2020  ctivations..    
+0000c5f0: 2020 2020 2020 2020 636c 6173 735f 696e          class_in
+0000c600: 6420 3d20 7466 2e73 7175 6565 7a65 2874  d = tf.squeeze(t
+0000c610: 662e 7768 6572 6528 7466 2e61 7267 6d61  f.where(tf.argma
+0000c620: 7828 792c 2031 293d 3d63 6c61 7373 5f79  x(y, 1)==class_y
+0000c630: 2929 235b 305d 0d0a 2020 2020 2020 2020  ))#[0]..        
+0000c640: 2020 2020 6663 5f62 705f 6f75 7420 3d20      fc_bp_out = 
+0000c650: 286e 702e 646f 7428 6163 7469 7661 7469  (np.dot(activati
+0000c660: 6f6e 735b 2766 6327 5d2e 6e75 6d70 7928  ons['fc'].numpy(
+0000c670: 295b 636c 6173 735f 696e 642c 203a 5d2c  )[class_ind, :],
+0000c680: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6a0: 2077 6569 6768 7473 5b27 6f75 745f 775f   weights['out_w_
+0000c6b0: 666c 6174 275d 2e54 2929 2e6d 6561 6e28  flat'].T)).mean(
+0000c6c0: 3029 0d0a 0d0a 2020 2020 2020 2020 2020  0)....          
+0000c6d0: 2020 6663 5f62 705f 6f75 7420 3d20 6663    fc_bp_out = fc
+0000c6e0: 5f62 705f 6f75 742e 7265 7368 6170 6528  _bp_out.reshape(
+0000c6f0: 5b61 6374 6976 6174 696f 6e73 5b27 7463  [activations['tc
+0000c700: 6f6e 7627 5d2e 7368 6170 655b 325d 2c0d  onv'].shape[2],.
+0000c710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c730: 2020 2020 2020 2020 2020 2020 6163 7469              acti
+0000c740: 7661 7469 6f6e 735b 2774 636f 6e76 275d  vations['tconv']
+0000c750: 2e73 6861 7065 5b33 5d5d 2c0d 0a20 2020  .shape[3]],..   
+0000c760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c780: 2020 2020 2020 2020 6f72 6465 723d 2743          order='C
+0000c790: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+0000c7a0: 6463 203d 2064 636f 765b 2763 6c61 7373  dc = dcov['class
+0000c7b0: 5f63 6f6e 6469 7469 6f6e 616c 275d 5b63  _conditional'][c
+0000c7c0: 6c61 7373 5f79 5d0d 0a20 2020 2020 2020  lass_y]..       
+0000c7d0: 2020 2020 2023 6663 5f62 705f 6f75 7420       #fc_bp_out 
+0000c7e0: 3d20 6e70 2e6d 6178 696d 756d 2866 635f  = np.maximum(fc_
+0000c7f0: 6270 5f6f 7574 2c20 3029 0d0a 2020 2020  bp_out, 0)..    
+0000c800: 2020 2020 2020 2020 636c 6173 735f 7061          class_pa
+0000c810: 7474 6572 6e73 203d 206e 702e 646f 7428  tterns = np.dot(
+0000c820: 6463 2c0d 0a20 2020 2020 2020 2020 2020  dc,..           
+0000c830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c840: 2020 2020 2020 2020 2077 6569 6768 7473           weights
+0000c850: 5b27 646d 7827 5d29 0d0a 2020 2020 2020  ['dmx'])..      
+0000c860: 2020 2020 2020 6370 203d 206e 702e 6569        cp = np.ei
+0000c870: 6e73 756d 2827 636b 2c20 696b 202d 3e20  nsum('ck, ik -> 
+0000c880: 6327 2c20 636c 6173 735f 7061 7474 6572  c', class_patter
+0000c890: 6e73 2c20 6663 5f62 705f 6f75 7429 0d0a  ns, fc_bp_out)..
+0000c8a0: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+0000c8b0: 6d62 696e 6564 5f74 6f70 6f73 2e61 7070  mbined_topos.app
+0000c8c0: 656e 6428 6370 2920 2320 2b20 7370 6174  end(cp) # + spat
+0000c8d0: 6961 6c5f 6269 6173 6573 5b63 6c61 7373  ial_biases[class
+0000c8e0: 5f79 5d0d 0a0d 0a20 2020 2020 2020 2074  _y]....        t
+0000c8f0: 6f70 6f73 203d 206e 702e 7374 6163 6b28  opos = np.stack(
+0000c900: 636f 6d62 696e 6564 5f74 6f70 6f73 2c20  combined_topos, 
+0000c910: 3129 0d0a 2020 2020 2020 2020 7265 7475  1)..        retu
+0000c920: 726e 2074 6f70 6f73 0d0a 0d0a 0d0a 0d0a  rn topos........
+0000c930: 0d0a 2020 2020 6465 6620 636f 6d70 7574  ..    def comput
+0000c940: 655f 7061 7474 6572 6e73 2873 656c 662c  e_patterns(self,
+0000c950: 2064 6174 615f 7061 7468 3d4e 6f6e 652c   data_path=None,
+0000c960: 2076 6572 626f 7365 3d46 616c 7365 293a   verbose=False):
+0000c970: 0d0a 2020 2020 2020 2020 2222 2243 6f6d  ..        """Com
+0000c980: 7075 7465 7320 7370 6174 6961 6c20 7061  putes spatial pa
+0000c990: 7474 6572 6e73 2066 726f 6d20 6669 6c74  tterns from filt
+0000c9a0: 6572 2077 6569 6768 7473 2e0d 0a20 2020  er weights...   
+0000c9b0: 2020 2020 2052 6571 7569 7265 6420 666f       Required fo
+0000c9c0: 7220 7669 7375 616c 697a 6174 696f 6e2e  r visualization.
+0000c9d0: 0d0a 0d0a 2020 2020 2020 2020 5061 7261  ....        Para
+0000c9e0: 6d65 7465 7273 0d0a 2020 2020 2020 2020  meters..        
+0000c9f0: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
+0000ca00: 2020 2020 6461 7461 5f70 6174 6820 3a20      data_path : 
+0000ca10: 7374 7220 6f72 206c 6973 7420 6f66 2073  str or list of s
+0000ca20: 7472 0d0a 2020 2020 2020 2020 2020 2020  tr..            
+0000ca30: 5061 7468 2074 6f20 5446 5265 636f 7264  Path to TFRecord
+0000ca40: 2066 696c 6573 206f 6e20 7768 6963 6820   files on which 
+0000ca50: 7468 6520 7061 7474 6572 6e73 2061 7265  the patterns are
+0000ca60: 2065 7374 696d 6174 6564 2e0d 0a0d 0a20   estimated..... 
+0000ca70: 2020 2020 2020 206f 7574 7075 7420 3a20         output : 
+0000ca80: 7374 7220 7b27 7061 7474 6572 6e73 2c20  str {'patterns, 
+0000ca90: 2766 696c 7465 7273 272c 2027 6675 6c6c  'filters', 'full
+0000caa0: 5f70 6174 7465 726e 7327 7d0d 0a20 2020  _patterns'}..   
+0000cab0: 2020 2020 2020 2020 2053 7472 696e 6720           String 
+0000cac0: 7370 6563 6966 7969 6e67 2074 6865 206f  specifying the o
+0000cad0: 7574 7075 742e 0d0a 0d0a 2020 2020 2020  utput.....      
+0000cae0: 2020 2020 2020 2766 696c 7465 7273 2720        'filters' 
+0000caf0: 2d20 6578 7472 6163 7473 2077 6569 6768  - extracts weigh
+0000cb00: 7473 206f 6620 7468 6520 7370 6174 6961  ts of the spatia
+0000cb10: 6c20 6669 6c74 6572 730d 0a0d 0a20 2020  l filters....   
+0000cb20: 2020 2020 2020 2020 2027 7061 7474 6572           'patter
+0000cb30: 6e73 2720 2d20 6578 7472 6163 7473 2061  ns' - extracts a
+0000cb40: 6374 6976 6174 696f 6e20 7061 7474 6572  ctivation patter
+0000cb50: 6e73 2c20 6f62 7461 696e 6564 2062 790d  ns, obtained by.
+0000cb60: 0a20 2020 2020 2020 2020 2020 206c 6566  .            lef
+0000cb70: 742d 6d75 6c74 6970 7969 6e67 2074 6865  t-multipying the
+0000cb80: 2073 7061 7469 616c 2066 696c 7465 7220   spatial filter 
+0000cb90: 7765 6967 6874 7320 6279 2074 6865 2028  weights by the (
+0000cba0: 7370 6174 6961 6c29 0d0a 2020 2020 2020  spatial)..      
+0000cbb0: 2020 2020 2020 6461 7461 2063 6f76 6172        data covar
+0000cbc0: 6961 6e63 652e 0d0a 0d0a 2020 2020 2020  iance.....      
+0000cbd0: 2020 2020 2020 2766 756c 6c2d 7061 7474        'full-patt
+0000cbe0: 6572 6e73 2720 2d20 6164 6469 7469 6f6e  erns' - addition
+0000cbf0: 616c 6c79 206d 756c 7469 706c 6965 7320  ally multiplies 
+0000cc00: 6163 7469 7661 7469 6f6e 0d0a 2020 2020  activation..    
+0000cc10: 2020 2020 2020 2020 7061 7474 6572 6e73          patterns
+0000cc20: 2062 7920 7468 6520 7072 6563 6973 696f   by the precisio
+0000cc30: 6e20 2869 6e76 6572 7365 2063 6f76 6172  n (inverse covar
+0000cc40: 6961 6e63 6529 206f 6620 7468 650d 0a20  iance) of the.. 
+0000cc50: 2020 2020 2020 2020 2020 206c 6174 656e             laten
+0000cc60: 7420 736f 7572 6365 730d 0a0d 0a20 2020  t sources....   
+0000cc70: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
+0000cc80: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
+0000cc90: 2020 2020 2020 2073 656c 662e 7061 7474         self.patt
+0000cca0: 6572 6e73 0d0a 2020 2020 2020 2020 2020  erns..          
+0000ccb0: 2020 7370 6174 6961 6c20 6669 6c74 6572    spatial filter
+0000ccc0: 7320 6f72 2061 6374 6976 6174 696f 6e20  s or activation 
+0000ccd0: 7061 7474 6572 6e73 2c20 6465 7065 6e64  patterns, depend
+0000cce0: 696e 6720 6f6e 2074 6865 0d0a 2020 2020  ing on the..    
+0000ccf0: 2020 2020 2020 2020 7661 6c75 6520 6f66          value of
+0000cd00: 2027 6f75 7470 7574 2720 7061 7261 6d65   'output' parame
+0000cd10: 7465 722e 0d0a 0d0a 2020 2020 2020 2020  ter.....        
+0000cd20: 7365 6c66 2e6c 6174 5f74 6373 0d0a 2020  self.lat_tcs..  
+0000cd30: 2020 2020 2020 2020 2020 7469 6d65 2063            time c
+0000cd40: 6f75 7273 6573 206f 6620 6c61 7465 6e74  ourses of latent
+0000cd50: 2073 6f75 7273 6573 2e0d 0a0d 0a20 2020   sourses.....   
+0000cd60: 2020 2020 2073 656c 662e 6669 6c74 6572       self.filter
+0000cd70: 730d 0a20 2020 2020 2020 2020 2020 2074  s..            t
+0000cd80: 656d 706f 7261 6c20 636f 6e76 6f6c 7574  emporal convolut
+0000cd90: 696f 6e61 6c20 6669 6c74 6572 2063 6f65  ional filter coe
+0000cda0: 6666 6963 6965 6e74 732e 0d0a 0d0a 2020  fficients.....  
+0000cdb0: 2020 2020 2020 7365 6c66 2e6f 7574 5f77        self.out_w
+0000cdc0: 6569 6768 7473 0d0a 2020 2020 2020 2020  eights..        
+0000cdd0: 2020 2020 7765 6967 6874 7320 6f66 2074      weights of t
+0000cde0: 6865 206f 7574 7075 7420 6c61 7965 722e  he output layer.
+0000cdf0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+0000ce00: 2e72 666f 6373 0d0a 2020 2020 2020 2020  .rfocs..        
+0000ce10: 2020 2020 6665 6174 7572 6520 7265 6c65      feature rele
+0000ce20: 7661 6e63 6573 2066 6f72 2074 6865 206f  vances for the o
+0000ce30: 7574 7075 7420 6c61 7965 722e 0d0a 2020  utput layer...  
+0000ce40: 2020 2020 2020 2020 2020 2853 6565 2073            (See s
+0000ce50: 656c 662e 6765 745f 6f75 7470 7574 5f63  elf.get_output_c
+0000ce60: 6f72 7265 6c61 7469 6f6e 7329 0d0a 0d0a  orrelations)....
+0000ce70: 2020 2020 2020 2020 5261 6973 6573 3a0d          Raises:.
+0000ce80: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0000ce90: 0d0a 2020 2020 2020 2020 2020 2020 4174  ..            At
+0000cea0: 7472 6962 7574 6545 7272 6f72 3a20 4966  tributeError: If
+0000ceb0: 2060 6461 7461 5f70 6174 6860 2069 7320   `data_path` is 
+0000cec0: 6e6f 7420 7370 6563 6966 6965 642e 0d0a  not specified...
+0000ced0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0000cee0: 2020 2020 200d 0a20 2020 2020 2020 2073       ..        s
+0000cef0: 656c 662e 6e66 6674 203d 2031 3238 0d0a  elf.nfft = 128..
+0000cf00: 2020 2020 2020 2020 7061 7474 6572 6e73          patterns
+0000cf10: 5f73 7472 7563 7420 3d20 7b27 7765 6967  _struct = {'weig
+0000cf20: 6874 7327 203a 207b 2764 6d78 273a 5b5d  hts' : {'dmx':[]
+0000cf30: 2c20 2774 636f 6e76 273a 5b5d 2c20 2766  , 'tconv':[], 'f
+0000cf40: 6327 3a5b 5d2c 2027 7463 6f6e 765f 6672  c':[], 'tconv_fr
+0000cf50: 6571 5f72 6573 706f 7365 7327 3a7b 7d7d  eq_resposes':{}}
+0000cf60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000cf70: 2020 2020 2020 2020 2020 2020 2020 2763                'c
+0000cf80: 636d 7327 203a 207b 2764 6d78 273a 5b5d  cms' : {'dmx':[]
+0000cf90: 2c20 2774 636f 6e76 273a 5b5d 2c20 2766  , 'tconv':[], 'f
+0000cfa0: 6327 3a5b 5d2c 2027 696e 7075 7427 3a5b  c':[], 'input':[
+0000cfb0: 5d2c 2027 646d 785f 7073 6427 3a5b 5d7d  ], 'dmx_psd':[]}
+0000cfc0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000cfd0: 2020 2020 2020 2020 2020 2020 2020 2764                'd
+0000cfe0: 636f 7627 203a 207b 2769 6e70 7574 5f73  cov' : {'input_s
+0000cff0: 7061 7469 616c 273a 5b5d 2c20 2763 6c61  patial':[], 'cla
+0000d000: 7373 5f63 6f6e 6469 7469 6f6e 616c 273a  ss_conditional':
+0000d010: 5b5d 2c0d 0a20 2020 2020 2020 2020 2020  [],..           
+0000d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d030: 2020 2020 2020 2020 2020 276b 2d31 273a            'k-1':
+0000d040: 5b5d 7d2c 0d0a 2020 2020 2020 2020 2020  []},..          
+0000d050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d060: 2027 7061 7474 6572 6e73 2720 3a20 7b7d   'patterns' : {}
+0000d070: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000d080: 2020 2020 2020 2020 2020 2020 2020 2773                's
+0000d090: 7065 6374 7261 273a 207b 7d2c 0d0a 2020  pectra': {},..  
+0000d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0b0: 2020 2020 2020 2020 2027 6672 6571 7327           'freqs'
+0000d0c0: 3a20 4e6f 6e65 0d0a 2020 2020 2020 2020  : None..        
+0000d0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0e0: 2020 207d 0d0a 2020 2020 2020 2020 0d0a     }..        ..
+0000d0f0: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
+0000d100: 6174 615f 7061 7468 3a0d 0a20 2020 2020  ata_path:..     
+0000d110: 2020 2020 2020 2070 7269 6e74 2822 436f         print("Co
+0000d120: 6d70 7574 696e 6720 7061 7474 6572 6e73  mputing patterns
+0000d130: 3a20 4e6f 2070 6174 6820 7370 6563 6966  : No path specif
+0000d140: 6965 642c 2075 7369 6e67 2076 616c 6964  ied, using valid
+0000d150: 6174 696f 6e20 6461 7461 7365 7420 2844  ation dataset (D
+0000d160: 6566 6175 6c74 2922 290d 0a20 2020 2020  efault)")..     
+0000d170: 2020 2020 2020 2064 7320 3d20 7365 6c66         ds = self
+0000d180: 2e64 6174 6173 6574 2e76 616c 0d0a 2020  .dataset.val..  
+0000d190: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+0000d1a0: 7461 6e63 6528 6461 7461 5f70 6174 682c  tance(data_path,
+0000d1b0: 2073 7472 2920 6f72 2069 7369 6e73 7461   str) or isinsta
+0000d1c0: 6e63 6528 6461 7461 5f70 6174 682c 2028  nce(data_path, (
+0000d1d0: 6c69 7374 2c20 7475 706c 6529 293a 0d0a  list, tuple)):..
+0000d1e0: 2020 2020 2020 2020 2020 2020 2354 4f44              #TOD
+0000d1f0: 4f3a 2072 6562 616c 6e63 653f 0d0a 2020  O: rebalnce?..  
+0000d200: 2020 2020 2020 2020 2020 6473 203d 2073            ds = s
+0000d210: 656c 662e 6461 7461 7365 742e 5f62 7569  elf.dataset._bui
+0000d220: 6c64 5f64 6174 6173 6574 2864 6174 615f  ld_dataset(data_
+0000d230: 7061 7468 2c0d 0a20 2020 2020 2020 2020  path,..         
+0000d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d260: 2020 2020 7370 6c69 743d 4661 6c73 652c      split=False,
+0000d270: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d290: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000d2a0: 6573 745f 6261 7463 683d 4e6f 6e65 2c0d  est_batch=None,.
+0000d2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d2d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000d2e0: 7065 6174 3d54 7275 6529 0d0a 2020 2020  peat=True)..    
+0000d2f0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+0000d300: 6e63 6528 6461 7461 5f70 6174 682c 2044  nce(data_path, D
+0000d310: 6174 6173 6574 293a 0d0a 2020 2020 2020  ataset):..      
+0000d320: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
+0000d330: 2864 6174 615f 7061 7468 2c20 2774 6573  (data_path, 'tes
+0000d340: 7427 293a 0d0a 2020 2020 2020 2020 2020  t'):..          
+0000d350: 2020 2020 2020 6473 203d 2064 6174 615f        ds = data_
+0000d360: 7061 7468 2e74 6573 740d 0a20 2020 2020  path.test..     
+0000d370: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0000d380: 2020 2020 2020 2020 2020 2020 2020 6473                ds
+0000d390: 203d 2064 6174 615f 7061 7468 2e76 616c   = data_path.val
+0000d3a0: 0d0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
+0000d3b0: 7369 6e73 7461 6e63 6528 6461 7461 5f70  sinstance(data_p
+0000d3c0: 6174 682c 2074 662e 6461 7461 2e44 6174  ath, tf.data.Dat
+0000d3d0: 6173 6574 293a 0d0a 2020 2020 2020 2020  aset):..        
+0000d3e0: 2020 2020 6473 203d 2064 6174 615f 7061      ds = data_pa
+0000d3f0: 7468 0d0a 2020 2020 2020 2020 656c 7365  th..        else
+0000d400: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0000d410: 6169 7365 2041 7474 7269 6275 7465 4572  aise AttributeEr
+0000d420: 726f 7228 2753 7065 6369 6679 2064 6174  ror('Specify dat
+0000d430: 6173 6574 206f 7220 6461 7461 2070 6174  aset or data pat
+0000d440: 682e 2729 0d0a 0d0a 0d0a 2020 2020 2020  h.')......      
+0000d450: 2020 582c 2079 203d 205b 726f 7720 666f    X, y = [row fo
+0000d460: 7220 726f 7720 696e 2064 732e 7461 6b65  r row in ds.take
+0000d470: 2831 295d 5b30 5d0d 0a20 2020 2020 2020  (1)][0]..       
+0000d480: 206e 646f 6620 3d20 582e 7368 6170 655b   ndof = X.shape[
+0000d490: 305d 202a 2073 656c 662e 6461 7461 7365  0] * self.datase
+0000d4a0: 742e 685f 7061 7261 6d73 5b27 6e5f 7427  t.h_params['n_t'
+0000d4b0: 5d20 2d20 310d 0a20 2020 2020 2020 2020  ] - 1..         
+0000d4c0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000d4d0: 2023 6765 7420 6c61 7965 7220 6163 7469   #get layer acti
+0000d4e0: 7661 7469 6f6e 730d 0a20 2020 2020 2020  vations..       
+0000d4f0: 2061 6374 6976 6174 696f 6e73 203d 207b   activations = {
+0000d500: 7d0d 0a20 2020 2020 2020 2023 2045 7874  }..        # Ext
+0000d510: 7261 6374 2061 6374 6976 6174 696f 6e73  ract activations
+0000d520: 0d0a 2020 2020 2020 2020 6163 7469 7661  ..        activa
+0000d530: 7469 6f6e 735b 2764 6d78 275d 203d 2073  tions['dmx'] = s
+0000d540: 656c 662e 646d 7828 5829 0d0a 2020 2020  elf.dmx(X)..    
+0000d550: 2020 2020 6163 7469 7661 7469 6f6e 735b      activations[
+0000d560: 2774 636f 6e76 275d 203d 2073 656c 662e  'tconv'] = self.
+0000d570: 706f 6f6c 2873 656c 662e 7463 6f6e 7628  pool(self.tconv(
+0000d580: 6163 7469 7661 7469 6f6e 735b 2764 6d78  activations['dmx
+0000d590: 275d 2929 0d0a 2020 2020 2020 2020 6163  ']))..        ac
+0000d5a0: 7469 7661 7469 6f6e 735b 2766 6327 5d20  tivations['fc'] 
+0000d5b0: 203d 2073 656c 662e 6669 6e5f 6663 2861   = self.fin_fc(a
+0000d5c0: 6374 6976 6174 696f 6e73 5b27 7463 6f6e  ctivations['tcon
+0000d5d0: 7627 5d29 0d0a 2020 2020 2020 2020 6966  v'])..        if
+0000d5e0: 2076 6572 626f 7365 3a0d 0a20 2020 2020   verbose:..     
+0000d5f0: 2020 2020 2020 2070 7269 6e74 2822 2222         print("""
+0000d600: 2241 6374 6976 6174 696f 6e73 3a20 5c6e  "Activations: \n
+0000d610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d620: 2020 2020 444d 583a 207b 7d0d 0a20 2020      DMX: {}..   
+0000d630: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+0000d640: 434f 4e56 3a20 7b7d 0d0a 2020 2020 2020  CONV: {}..      
+0000d650: 2020 2020 2020 2020 2020 2020 4643 5f44              FC_D
+0000d660: 454e 5345 3a20 7b7d 2222 222e 666f 726d  ENSE: {}""".form
+0000d670: 6174 280d 0a20 2020 2020 2020 2020 2020  at(..           
+0000d680: 2020 2020 2020 2061 6374 6976 6174 696f         activatio
+0000d690: 6e73 5b27 646d 7827 5d2e 7368 6170 652c  ns['dmx'].shape,
+0000d6a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d6b0: 2020 2020 6163 7469 7661 7469 6f6e 735b      activations[
+0000d6c0: 2774 636f 6e76 275d 2e73 6861 7065 2c0d  'tconv'].shape,.
+0000d6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d6e0: 2020 2061 6374 6976 6174 696f 6e73 5b27     activations['
+0000d6f0: 6663 275d 2e73 6861 7065 2929 0d0a 0d0a  fc'].shape))....
+0000d700: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+0000d710: 2020 7765 6967 6874 7320 3d20 7365 6c66    weights = self
+0000d720: 2e67 6574 5f77 6569 6768 7473 2829 0d0a  .get_weights()..
+0000d730: 2020 2020 2020 2020 7370 6563 7472 6120          spectra 
+0000d740: 3d20 7365 6c66 2e67 6574 5f73 7065 6374  = self.get_spect
+0000d750: 7261 2877 6569 6768 7473 3d77 6569 6768  ra(weights=weigh
+0000d760: 7473 2c20 6163 7469 7661 7469 6f6e 733d  ts, activations=
+0000d770: 6163 7469 7661 7469 6f6e 7329 0d0a 2020  activations)..  
+0000d780: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000d790: 6966 206e 6f74 2070 6174 7465 726e 735f  if not patterns_
+0000d7a0: 7374 7275 6374 5b27 6672 6571 7327 5d3a  struct['freqs']:
+0000d7b0: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
+0000d7c0: 7474 6572 6e73 5f73 7472 7563 745b 2766  tterns_struct['f
+0000d7d0: 7265 7173 275d 203d 2073 7065 6374 7261  reqs'] = spectra
+0000d7e0: 5b27 6672 6571 7327 5d0d 0a20 2020 2020  ['freqs']..     
+0000d7f0: 2020 2023 4343 4d73 2061 7265 206d 6561     #CCMs are mea
+0000d800: 6e20 6163 7469 7661 7469 6f6e 7320 6f66  n activations of
+0000d810: 2065 6163 6820 6c61 7965 7220 666f 7220   each layer for 
+0000d820: 6561 6368 2063 6c61 7373 0d0a 0d0a 2020  each class....  
+0000d830: 2020 2020 2020 6463 6f76 203d 207b 7d0d        dcov = {}.
+0000d840: 0a20 2020 2020 2020 2064 636f 765b 2769  .        dcov['i
+0000d850: 6e70 7574 5f73 7061 7469 616c 275d 203d  nput_spatial'] =
+0000d860: 206e 702e 6569 6e73 756d 2827 6869 6a6b   np.einsum('hijk
+0000d870: 2c20 6869 6a6c 202d 3e20 6b6c 272c 2058  , hijl -> kl', X
+0000d880: 2c20 5829 202f 206e 646f 660d 0a20 2020  , X) / ndof..   
+0000d890: 2020 2020 2064 636f 765b 2763 6c61 7373       dcov['class
+0000d8a0: 5f63 6f6e 6469 7469 6f6e 616c 275d 2c20  _conditional'], 
+0000d8b0: 6463 6f76 5b27 6b2d 3127 5d20 203d 2073  dcov['k-1']  = s
+0000d8c0: 656c 662e 5f67 6574 5f63 6c61 7373 5f63  elf._get_class_c
+0000d8d0: 6f6e 6469 7469 6f6e 616c 5f73 7061 7469  onditional_spati
+0000d8e0: 616c 5f63 6f76 6172 6961 6e63 6528 582c  al_covariance(X,
+0000d8f0: 2079 290d 0a0d 0a20 2020 2020 2020 2023   y)....        #
+0000d900: 2354 7275 6520 6576 6f6b 6564 0d0a 2020  #True evoked..  
+0000d910: 2020 2020 2020 6966 2073 656c 662e 6461        if self.da
+0000d920: 7461 7365 742e 685f 7061 7261 6d73 5b27  taset.h_params['
+0000d930: 7461 7267 6574 5f74 7970 6527 5d20 3d3d  target_type'] ==
+0000d940: 2027 666c 6f61 7427 3a0d 0a20 2020 2020   'float':..     
+0000d950: 2020 2020 2020 2073 656c 662e 7472 7565         self.true
+0000d960: 5f65 766f 6b65 645f 6461 7461 203d 2058  _evoked_data = X
+0000d970: 2e6e 756d 7079 2829 2e6d 6561 6e28 3029  .numpy().mean(0)
+0000d980: 0d0a 2020 2020 2020 2020 656c 6966 2073  ..        elif s
+0000d990: 656c 662e 6461 7461 7365 742e 685f 7061  elf.dataset.h_pa
+0000d9a0: 7261 6d73 5b27 7461 7267 6574 5f74 7970  rams['target_typ
+0000d9b0: 6527 5d20 3d3d 2027 696e 7427 3a0d 0a20  e'] == 'int':.. 
+0000d9c0: 2020 2020 2020 2020 2020 2079 5f69 6e74             y_int
+0000d9d0: 203d 206e 702e 6172 676d 6178 2879 2c20   = np.argmax(y, 
+0000d9e0: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+0000d9f0: 795f 756e 6971 7565 203d 206e 702e 756e  y_unique = np.un
+0000da00: 6971 7565 2879 5f69 6e74 290d 0a20 2020  ique(y_int)..   
+0000da10: 2020 2020 2020 2020 2065 766f 6b65 6473           evokeds
+0000da20: 203d 206e 702e 6172 7261 7928 5b58 2e6e   = np.array([X.n
+0000da30: 756d 7079 2829 5b79 5f69 6e74 203d 3d20  umpy()[y_int == 
+0000da40: 692c 202e 2e2e 5d2e 6d65 616e 2830 290d  i, ...].mean(0).
+0000da50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000da60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000da70: 2066 6f72 2069 2069 6e20 795f 756e 6971   for i in y_uniq
+0000da80: 7565 5d29 0d0a 2020 2020 2020 2020 2020  ue])..          
+0000da90: 2020 7365 6c66 2e74 7275 655f 6576 6f6b    self.true_evok
+0000daa0: 6564 5f64 6174 6120 3d20 6e70 2e73 7175  ed_data = np.squ
+0000dab0: 6565 7a65 2865 766f 6b65 6473 290d 0a0d  eeze(evokeds)...
+0000dac0: 0a0d 0a20 2020 2020 2020 2023 2063 6f6d  ...        # com
+0000dad0: 7075 7465 2074 6865 2065 6666 6563 7420  pute the effect 
+0000dae0: 6f66 2072 656d 6f76 696e 6720 6561 6368  of removing each
+0000daf0: 206c 6174 656e 7420 636f 6d70 6f6e 656e   latent componen
+0000db00: 7420 6f6e 2074 6865 2063 6f73 7420 6675  t on the cost fu
+0000db10: 6e63 7469 6f6e 0d0a 2020 2020 2020 2020  nction..        
+0000db20: 2370 6174 7465 726e 735f 7374 7275 6374  #patterns_struct
+0000db30: 5b27 636f 6d70 7769 7365 5f6c 6f73 7365  ['compwise_losse
+0000db40: 7327 5d20 3d20 7365 6c66 2e63 6f6d 7075  s'] = self.compu
+0000db50: 7465 5f63 6f6d 706f 6e65 6e74 7769 7365  te_componentwise
+0000db60: 5f6c 6f73 7328 582c 2079 2c20 7765 6967  _loss(X, y, weig
+0000db70: 6874 7329 0d0a 0d0a 2020 2020 2020 2020  hts)....        
+0000db80: 2354 4f44 4f3a 2063 6c61 7373 2063 6f6e  #TODO: class con
+0000db90: 6474 6974 696f 6e61 6c20 7761 7665 666f  dtitional wavefo
+0000dba0: 726d 7320 2d3e 2061 6374 6976 6174 696f  rms -> activatio
+0000dbb0: 6e73 0d0a 2020 2020 2020 2020 2373 656c  ns..        #sel
+0000dbc0: 662e 7761 7665 666f 726d 7320 3d20 6e70  f.waveforms = np
+0000dbd0: 2e6d 6561 6e28 6163 7469 7661 7469 6f6e  .mean(activation
+0000dbe0: 735b 2764 6d78 275d 292e 540d 0a20 2020  s['dmx']).T..   
+0000dbf0: 2020 2020 200d 0a0d 0a0d 0a20 2020 2020       ......     
+0000dc00: 2020 2070 6174 7465 726e 735f 7374 7275     patterns_stru
+0000dc10: 6374 5b27 7765 6967 6874 7327 5d20 3d20  ct['weights'] = 
+0000dc20: 7765 6967 6874 730d 0a20 2020 2020 2020  weights..       
+0000dc30: 2070 6174 7465 726e 735f 7374 7275 6374   patterns_struct
+0000dc40: 5b27 7370 6563 7472 6127 5d20 3d20 7370  ['spectra'] = sp
+0000dc50: 6563 7472 610d 0a20 2020 2020 2020 2070  ectra..        p
+0000dc60: 6174 7465 726e 735f 7374 7275 6374 5b27  atterns_struct['
+0000dc70: 6463 6f76 275d 203d 2064 636f 760d 0a20  dcov'] = dcov.. 
+0000dc80: 2020 2020 2020 2070 6174 7465 726e 735f         patterns_
+0000dc90: 7374 7275 6374 5b27 6363 6d73 275d 203d  struct['ccms'] =
+0000dca0: 207b 7d23 6363 6d73 0d0a 2020 2020 2020   {}#ccms..      
+0000dcb0: 2020 2353 785f 7463 6f6e 762c 2053 785f    #Sx_tconv, Sx_
+0000dcc0: 646d 7820 3d20 7365 6c66 2e70 6174 7465  dmx = self.patte
+0000dcd0: 726e 735f 636f 765f 7879 5f68 6174 2858  rns_cov_xy_hat(X
+0000dce0: 2c20 792c 2061 6374 6976 6174 696f 6e73  , y, activations
+0000dcf0: 2c20 7765 6967 6874 7329 0d0a 2020 2020  , weights)..    
+0000dd00: 2020 2020 5378 5f74 636f 6e76 5f63 636d      Sx_tconv_ccm
+0000dd10: 203d 205b 5d0d 0a20 2020 2020 2020 2023   = []..        #
+0000dd20: 5378 5f64 6d78 5f63 636d 203d 205b 5d0d  Sx_dmx_ccm = [].
+0000dd30: 0a20 2020 2020 2020 2053 785f 6663 5f63  .        Sx_fc_c
+0000dd40: 636d 203d 205b 5d0d 0a20 2020 2020 2020  cm = []..       
+0000dd50: 2070 6174 7465 726e 735f 6378 7920 3d20   patterns_cxy = 
+0000dd60: 5b5d 0d0a 2020 2020 2020 2020 2320 666f  []..        # fo
+0000dd70: 7220 636c 6173 735f 7920 696e 2072 616e  r class_y in ran
+0000dd80: 6765 2873 656c 662e 6f75 745f 6469 6d29  ge(self.out_dim)
+0000dd90: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
+0000dda0: 2063 6c61 7373 5f69 6e64 203d 2074 662e   class_ind = tf.
+0000ddb0: 7371 7565 657a 6528 7466 2e77 6865 7265  squeeze(tf.where
+0000ddc0: 2874 662e 6172 676d 6178 2879 2c20 3129  (tf.argmax(y, 1)
+0000ddd0: 3d3d 636c 6173 735f 7929 2923 5b30 5d0d  ==class_y))#[0].
+0000dde0: 0a20 2020 2020 2020 2023 2020 2020 2053  .        #     S
+0000ddf0: 785f 7463 6f6e 765f 6363 6d2e 6170 7065  x_tconv_ccm.appe
+0000de00: 6e64 2853 785f 7463 6f6e 765b 636c 6173  nd(Sx_tconv[clas
+0000de10: 735f 696e 642c 202e 2e2e 5d2e 6d65 616e  s_ind, ...].mean
+0000de20: 2830 2929 0d0a 2020 2020 2020 2020 2320  (0))..        # 
+0000de30: 2020 2020 2353 785f 646d 785f 6363 6d2e      #Sx_dmx_ccm.
+0000de40: 6170 7065 6e64 2853 785f 646d 785b 636c  append(Sx_dmx[cl
+0000de50: 6173 735f 696e 642c 202e 2e2e 5d2e 6d65  ass_ind, ...].me
+0000de60: 616e 2830 2c20 6b65 6570 6469 6d73 3d54  an(0, keepdims=T
+0000de70: 7275 6529 290d 0a20 2020 2020 2020 2023  rue))..        #
+0000de80: 2020 2020 2023 6120 3d20 6163 7469 7661       #a = activa
+0000de90: 7469 6f6e 735b 2774 636f 6e76 275d 2e6e  tions['tconv'].n
+0000dea0: 756d 7079 2829 5b63 6c61 7373 5f69 6e64  umpy()[class_ind
+0000deb0: 2c20 2e2e 2e5d 2e6d 6561 6e28 3029 2a77  , ...].mean(0)*w
+0000dec0: 6569 6768 7473 5b27 6f75 745f 7765 6967  eights['out_weig
+0000ded0: 6874 7327 5d5b 4e6f 6e65 2c20 2e2e 2e2c  hts'][None, ...,
+0000dee0: 2063 6c61 7373 5f79 5d0d 0a20 2020 2020   class_y]..     
+0000def0: 2020 2023 2020 2020 2053 785f 6663 5f63     #     Sx_fc_c
+0000df00: 636d 2e61 7070 656e 6428 6163 7469 7661  cm.append(activa
+0000df10: 7469 6f6e 735b 2766 6327 5d2e 6e75 6d70  tions['fc'].nump
+0000df20: 7928 295b 636c 6173 735f 696e 642c 202e  y()[class_ind, .
+0000df30: 2e2e 5d2e 6d65 616e 2830 2c20 6b65 6570  ..].mean(0, keep
+0000df40: 6469 6d73 3d54 7275 6529 290d 0a20 2020  dims=True))..   
+0000df50: 2020 2020 2023 2020 2020 2023 2070 6174       #     # pat
+0000df60: 7465 726e 735f 6378 792e 6170 7065 6e64  terns_cxy.append
+0000df70: 286e 702e 646f 7428 6463 6f76 5b27 636c  (np.dot(dcov['cl
+0000df80: 6173 735f 636f 6e64 6974 696f 6e61 6c27  ass_conditional'
+0000df90: 5d5b 636c 6173 735f 795d 2c0d 0a20 2020  ][class_y],..   
+0000dfa0: 2020 2020 2023 2020 2020 2023 2020 2020       #     #    
+0000dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfc0: 2020 2020 2020 2020 2020 2020 5378 5f64              Sx_d
+0000dfd0: 6d78 5b63 6c61 7373 5f69 6e64 2c20 2e2e  mx[class_ind, ..
+0000dfe0: 2e5d 2e6d 6561 6e28 3029 2929 0d0a 2020  .].mean(0)))..  
+0000dff0: 2020 2020 2020 2320 2020 2020 2370 6174        #     #pat
+0000e000: 7465 726e 735f 6378 792e 6170 7065 6e64  terns_cxy.append
+0000e010: 286e 702e 646f 7428 6463 6f76 5b27 696e  (np.dot(dcov['in
+0000e020: 7075 745f 7370 6174 6961 6c27 5d2c 0d0a  put_spatial'],..
+0000e030: 2020 2020 2020 2020 2320 2020 2020 2320          #     # 
+0000e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e050: 2020 2020 2020 2020 2020 2053 785f 646d             Sx_dm
+0000e060: 785b 636c 6173 735f 696e 642c 202e 2e2e  x[class_ind, ...
+0000e070: 5d2e 6d65 616e 2830 2929 290d 0a20 2020  ].mean(0)))..   
+0000e080: 2020 2020 2023 6363 6d73 203d 207b 7d0d       #ccms = {}.
+0000e090: 0a20 2020 2020 2020 2023 6363 6d73 5b27  .        #ccms['
+0000e0a0: 7463 6f6e 7627 5d20 3d20 6e70 2e63 6f6e  tconv'] = np.con
+0000e0b0: 6361 7465 6e61 7465 2853 785f 7463 6f6e  catenate(Sx_tcon
+0000e0c0: 765f 6363 6d2c 2030 290d 0a20 2020 2020  v_ccm, 0)..     
+0000e0d0: 2020 2023 6363 6d73 5b27 646d 7827 5d20     #ccms['dmx'] 
+0000e0e0: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
+0000e0f0: 2853 785f 646d 785f 6363 6d2c 2030 290d  (Sx_dmx_ccm, 0).
+0000e100: 0a20 2020 2020 2020 2023 6363 6d73 5b27  .        #ccms['
+0000e110: 6663 275d 203d 206e 702e 636f 6e63 6174  fc'] = np.concat
+0000e120: 656e 6174 6528 5378 5f66 635f 6363 6d2c  enate(Sx_fc_ccm,
+0000e130: 2030 290d 0a20 2020 2020 2020 200d 0a20   0)..        .. 
+0000e140: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000e150: 200d 0a20 2020 2020 2020 2070 6174 7465   ..        patte
+0000e160: 726e 735f 7374 7275 6374 5b27 7061 7474  rns_struct['patt
+0000e170: 6572 6e73 275d 203d 2073 656c 662e 5f63  erns'] = self._c
+0000e180: 6f6d 7075 7465 5f63 6f6d 6269 6e65 645f  ompute_combined_
+0000e190: 7061 7474 6572 6e73 2879 2c20 7765 6967  patterns(y, weig
+0000e1a0: 6874 732c 2061 6374 6976 6174 696f 6e73  hts, activations
+0000e1b0: 2c20 6463 6f76 290d 0a0d 0a20 2020 2020  , dcov)....     
+0000e1c0: 2020 2023 636f 6d70 7574 6520 7468 6520     #compute the 
+0000e1d0: 6566 6665 6374 206f 6620 7265 6d6f 7669  effect of removi
+0000e1e0: 6e67 2065 6163 6820 6c61 7465 6e74 2063  ng each latent c
+0000e1f0: 6f6d 706f 6e65 6e74 206f 6e20 7468 6520  omponent on the 
+0000e200: 636f 7374 2066 756e 6374 696f 6e0d 0a20  cost function.. 
+0000e210: 2020 2020 2020 2070 6174 7465 726e 735f         patterns_
+0000e220: 7374 7275 6374 5b27 636f 6d70 7769 7365  struct['compwise
+0000e230: 5f6c 6f73 7327 5d20 3d20 7365 6c66 2e63  _loss'] = self.c
+0000e240: 6f6d 7075 7465 5f63 6f6d 706f 6e65 6e74  ompute_component
+0000e250: 7769 7365 5f6c 6f73 7328 582c 2079 2c20  wise_loss(X, y, 
+0000e260: 7765 6967 6874 7329 0d0a 2020 2020 2020  weights)..      
+0000e270: 2020 2363 6f72 7265 6c61 7469 6f6e 206f    #correlation o
+0000e280: 6620 6663 2061 6374 6976 6174 696f 6e73  f fc activations
+0000e290: 2074 6f20 790d 0a20 2020 2020 2020 2070   to y..        p
+0000e2a0: 6174 7465 726e 735f 7374 7275 6374 5b27  atterns_struct['
+0000e2b0: 636f 7272 5f74 6f5f 6f75 7470 7574 275d  corr_to_output']
+0000e2c0: 203d 2073 656c 662e 6765 745f 6f75 7470   = self.get_outp
+0000e2d0: 7574 5f63 6f72 7265 6c61 7469 6f6e 7328  ut_correlations(
+0000e2e0: 6163 7469 7661 7469 6f6e 732c 2079 290d  activations, y).
+0000e2f0: 0a20 2020 2020 2020 2023 7365 6c66 2e6f  .        #self.o
+0000e300: 7574 5f77 6569 6768 7473 203d 2077 6569  ut_weights = wei
+0000e310: 6768 7473 5b27 6f75 745f 7765 6967 6874  ghts['out_weight
+0000e320: 7327 5d0d 0a20 2020 2020 2020 2064 656c  s']..        del
+0000e330: 2058 2c20 6163 7469 7661 7469 6f6e 730d   X, activations.
+0000e340: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
+0000e350: 6e20 7061 7474 6572 6e73 5f73 7472 7563  n patterns_struc
+0000e360: 740d 0a20 2020 2020 2020 2023 204f 7468  t..        # Oth
+0000e370: 6572 0d0a 2020 2020 2020 2020 2373 656c  er..        #sel
+0000e380: 662e 795f 7472 7565 203d 206e 702e 7371  f.y_true = np.sq
+0000e390: 7565 657a 6528 792e 6e75 6d70 7928 2929  ueeze(y.numpy())
+0000e3a0: 0d0a 2020 2020 0d0a 2020 2020 6465 6620  ..    ..    def 
+0000e3b0: 5f63 6f6d 7075 7465 5f63 6f6d 6269 6e65  _compute_combine
+0000e3c0: 645f 7061 7474 6572 6e73 2873 656c 662c  d_patterns(self,
+0000e3d0: 2079 2c20 7765 6967 6874 732c 2061 6374   y, weights, act
+0000e3e0: 6976 6174 696f 6e73 2c20 6463 6f76 293a  ivations, dcov):
+0000e3f0: 0d0a 2020 2020 2020 2020 7061 7474 6572  ..        patter
+0000e400: 6e73 203d 207b 7d0d 0a20 2020 2020 2020  ns = {}..       
+0000e410: 2070 6174 7465 726e 735b 2763 6f76 5f78   patterns['cov_x
+0000e420: 7827 5d20 3d20 7365 6c66 2e70 6174 7465  x'] = self.patte
+0000e430: 726e 735f 636f 765f 7878 2879 2c20 7765  rns_cov_xx(y, we
+0000e440: 6967 6874 732c 2061 6374 6976 6174 696f  ights, activatio
+0000e450: 6e73 2c20 6463 6f76 290d 0a0d 0a20 2020  ns, dcov)....   
+0000e460: 2020 2020 2023 5378 5f74 636f 6e76 2c20       #Sx_tconv, 
+0000e470: 5378 5f64 6d78 203d 204e 6f6e 652c 204e  Sx_dmx = None, N
+0000e480: 6f6e 6523 7365 6c66 2e70 6174 7465 726e  one#self.pattern
+0000e490: 735f 636f 765f 7879 5f68 6174 2858 2c20  s_cov_xy_hat(X, 
+0000e4a0: 792c 2061 6374 6976 6174 696f 6e73 2c20  y, activations, 
+0000e4b0: 7765 6967 6874 7329 0d0a 2020 2020 2020  weights)..      
+0000e4c0: 2020 2320 5378 5f74 636f 6e76 5f63 636d    # Sx_tconv_ccm
+0000e4d0: 203d 205b 5d0d 0a20 2020 2020 2020 2023   = []..        #
+0000e4e0: 2023 5378 5f64 6d78 5f63 636d 203d 205b   #Sx_dmx_ccm = [
+0000e4f0: 5d0d 0a20 2020 2020 2020 2023 2053 785f  ]..        # Sx_
+0000e500: 6663 5f63 636d 203d 205b 5d0d 0a20 2020  fc_ccm = []..   
+0000e510: 2020 2020 2023 2070 6174 7465 726e 735f       # patterns_
+0000e520: 6378 7920 3d20 5b5d 0d0a 2020 2020 2020  cxy = []..      
+0000e530: 2020 2320 666f 7220 636c 6173 735f 7920    # for class_y 
+0000e540: 696e 2072 616e 6765 2873 656c 662e 6f75  in range(self.ou
+0000e550: 745f 6469 6d29 3a0d 0a20 2020 2020 2020  t_dim):..       
+0000e560: 2023 2020 2020 2063 6c61 7373 5f69 6e64   #     class_ind
+0000e570: 203d 2074 662e 7371 7565 657a 6528 7466   = tf.squeeze(tf
+0000e580: 2e77 6865 7265 2874 662e 6172 676d 6178  .where(tf.argmax
+0000e590: 2879 2c20 3129 3d3d 636c 6173 735f 7929  (y, 1)==class_y)
+0000e5a0: 2923 5b30 5d0d 0a20 2020 2020 2020 2023  )#[0]..        #
+0000e5b0: 2020 2020 2053 785f 7463 6f6e 765f 6363       Sx_tconv_cc
+0000e5c0: 6d2e 6170 7065 6e64 2853 785f 7463 6f6e  m.append(Sx_tcon
+0000e5d0: 765b 636c 6173 735f 696e 642c 202e 2e2e  v[class_ind, ...
+0000e5e0: 5d2e 6d65 616e 2830 2929 0d0a 2020 2020  ].mean(0))..    
+0000e5f0: 2020 2020 2320 2020 2020 2353 785f 646d      #     #Sx_dm
+0000e600: 785f 6363 6d2e 6170 7065 6e64 2853 785f  x_ccm.append(Sx_
+0000e610: 646d 785b 636c 6173 735f 696e 642c 202e  dmx[class_ind, .
+0000e620: 2e2e 5d2e 6d65 616e 2830 2c20 6b65 6570  ..].mean(0, keep
+0000e630: 6469 6d73 3d54 7275 6529 290d 0a20 2020  dims=True))..   
+0000e640: 2020 2020 2023 2020 2020 2023 6120 3d20       #     #a = 
+0000e650: 6163 7469 7661 7469 6f6e 735b 2774 636f  activations['tco
+0000e660: 6e76 275d 2e6e 756d 7079 2829 5b63 6c61  nv'].numpy()[cla
+0000e670: 7373 5f69 6e64 2c20 2e2e 2e5d 2e6d 6561  ss_ind, ...].mea
+0000e680: 6e28 3029 2a77 6569 6768 7473 5b27 6f75  n(0)*weights['ou
+0000e690: 745f 7765 6967 6874 7327 5d5b 4e6f 6e65  t_weights'][None
+0000e6a0: 2c20 2e2e 2e2c 2063 6c61 7373 5f79 5d0d  , ..., class_y].
+0000e6b0: 0a20 2020 2020 2020 2023 2020 2020 2053  .        #     S
+0000e6c0: 785f 6663 5f63 636d 2e61 7070 656e 6428  x_fc_ccm.append(
+0000e6d0: 6163 7469 7661 7469 6f6e 735b 2766 6327  activations['fc'
+0000e6e0: 5d2e 6e75 6d70 7928 295b 636c 6173 735f  ].numpy()[class_
+0000e6f0: 696e 642c 202e 2e2e 5d2e 6d65 616e 2830  ind, ...].mean(0
+0000e700: 2c20 6b65 6570 6469 6d73 3d54 7275 6529  , keepdims=True)
+0000e710: 290d 0a20 2020 2020 2020 2023 2020 2020  )..        #    
+0000e720: 2023 2070 6174 7465 726e 735f 6378 792e   # patterns_cxy.
+0000e730: 6170 7065 6e64 286e 702e 646f 7428 6463  append(np.dot(dc
+0000e740: 6f76 5b27 636c 6173 735f 636f 6e64 6974  ov['class_condit
+0000e750: 696f 6e61 6c27 5d5b 636c 6173 735f 795d  ional'][class_y]
+0000e760: 2c0d 0a20 2020 2020 2020 2023 2020 2020  ,..        #    
+0000e770: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0000e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e790: 2020 5378 5f64 6d78 5b63 6c61 7373 5f69    Sx_dmx[class_i
+0000e7a0: 6e64 2c20 2e2e 2e5d 2e6d 6561 6e28 3029  nd, ...].mean(0)
+0000e7b0: 2929 0d0a 2020 2020 2020 2020 2320 2020  ))..        #   
+0000e7c0: 2020 2370 6174 7465 726e 735f 6378 792e    #patterns_cxy.
+0000e7d0: 6170 7065 6e64 286e 702e 646f 7428 6463  append(np.dot(dc
+0000e7e0: 6f76 5b27 696e 7075 745f 7370 6174 6961  ov['input_spatia
+0000e7f0: 6c27 5d2c 0d0a 2020 2020 2020 2020 2320  l'],..        # 
+0000e800: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000e810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e820: 2053 785f 646d 785b 636c 6173 735f 696e   Sx_dmx[class_in
+0000e830: 642c 202e 2e2e 5d2e 6d65 616e 2830 2929  d, ...].mean(0))
+0000e840: 290d 0a20 2020 2020 2020 2023 2063 636d  )..        # ccm
+0000e850: 7320 3d20 7b7d 0d0a 2020 2020 2020 2020  s = {}..        
+0000e860: 2320 6363 6d73 5b27 7463 6f6e 7627 5d20  # ccms['tconv'] 
+0000e870: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
+0000e880: 2853 785f 7463 6f6e 765f 6363 6d2c 2030  (Sx_tconv_ccm, 0
+0000e890: 290d 0a20 2020 2020 2020 2023 6363 6d73  )..        #ccms
+0000e8a0: 5b27 646d 7827 5d20 3d20 6e70 2e63 6f6e  ['dmx'] = np.con
+0000e8b0: 6361 7465 6e61 7465 2853 785f 646d 785f  catenate(Sx_dmx_
+0000e8c0: 6363 6d2c 2030 290d 0a20 2020 2020 2020  ccm, 0)..       
+0000e8d0: 2023 6363 6d73 5b27 6663 275d 203d 206e   #ccms['fc'] = n
+0000e8e0: 702e 636f 6e63 6174 656e 6174 6528 5378  p.concatenate(Sx
+0000e8f0: 5f66 635f 6363 6d2c 2030 290d 0a0d 0a0d  _fc_ccm, 0).....
+0000e900: 0a20 2020 2020 2020 2023 7061 7474 6572  .        #patter
+0000e910: 6e73 5b27 636f 765f 7879 275d 203d 2053  ns['cov_xy'] = S
+0000e920: 785f 646d 780d 0a20 2020 2020 2020 2070  x_dmx..        p
+0000e930: 6174 7465 726e 735b 2770 696e 765f 7727  atterns['pinv_w'
+0000e940: 5d20 3d20 7365 6c66 2e70 6174 7465 726e  ] = self.pattern
+0000e950: 735f 7069 6e76 5f77 2879 2c20 7765 6967  s_pinv_w(y, weig
+0000e960: 6874 732c 2061 6374 6976 6174 696f 6e73  hts, activations
+0000e970: 2c20 6463 6f76 292e 6d65 616e 282d 3129  , dcov).mean(-1)
+0000e980: 0d0a 0d0a 2020 2020 2020 2020 7061 7474  ....        patt
+0000e990: 6572 6e73 5b27 7766 635f 6d65 616e 275d  erns['wfc_mean']
+0000e9a0: 203d 2073 656c 662e 7061 7474 6572 6e73   = self.patterns
+0000e9b0: 5f77 6663 5f6d 6561 6e28 792c 2077 6569  _wfc_mean(y, wei
+0000e9c0: 6768 7473 2c20 6163 7469 7661 7469 6f6e  ghts, activation
+0000e9d0: 732c 2064 636f 7629 0d0a 2020 2020 2020  s, dcov)..      
+0000e9e0: 2020 7265 7475 726e 2070 6174 7465 726e    return pattern
+0000e9f0: 730d 0a0d 0a20 2020 2064 6566 2063 6f6c  s....    def col
+0000ea00: 6c65 6374 5f70 6174 7465 726e 7328 7365  lect_patterns(se
+0000ea10: 6c66 2c20 666f 6c64 3d30 2c20 6e5f 666f  lf, fold=0, n_fo
+0000ea20: 6c64 733d 312c 206e 5f63 6f6d 703d 312c  lds=1, n_comp=1,
+0000ea30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ea40: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+0000ea50: 6473 3d5b 2777 6569 6768 7427 2c20 0d0a  ds=['weight', ..
+0000ea60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea80: 2020 2763 6f6d 7077 6973 655f 6c6f 7373    'compwise_loss
 0000ea90: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
 0000eaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eab0: 2020 2020 2020 276c 3227 2c20 2761 6273        'l2', 'abs
-0000eac0: 5f77 6569 6768 7427 2c20 276f 7574 7075  _weight', 'outpu
-0000ead0: 745f 636f 7272 270d 0a20 2020 2020 2020  t_corr'..       
-0000eae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eaf0: 2020 2020 2020 2020 2020 205d 293a 0d0a             ]):..
-0000eb00: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0000eb10: 2020 2020 2043 6f6d 7075 7465 2061 6e64       Compute and
-0000eb20: 2073 746f 7265 2070 6174 7465 726e 7320   store patterns 
-0000eb30: 6475 7269 6e67 2063 726f 7373 2d76 616c  during cross-val
-0000eb40: 6964 6174 696f 6e2e 0d0a 0d0a 2020 2020  idation.....    
-0000eb50: 2020 2020 2222 220d 0a0d 0a20 2020 2020      """....     
-0000eb60: 2020 2070 6174 7465 726e 735f 7374 7275     patterns_stru
-0000eb70: 6374 203d 2073 656c 662e 636f 6d70 7574  ct = self.comput
-0000eb80: 655f 7061 7474 6572 6e73 2829 0d0a 2020  e_patterns()..  
-0000eb90: 2020 2020 2020 636f 6d62 696e 6564 5f6d        combined_m
-0000eba0: 6574 686f 6473 203d 206c 6973 7428 7061  ethods = list(pa
-0000ebb0: 7474 6572 6e73 5f73 7472 7563 745b 2770  tterns_struct['p
-0000ebc0: 6174 7465 726e 7327 5d2e 6b65 7973 2829  atterns'].keys()
-0000ebd0: 290d 0a20 2020 2020 2020 206d 6574 686f  )..        metho
-0000ebe0: 6473 202b 3d20 636f 6d62 696e 6564 5f6d  ds += combined_m
-0000ebf0: 6574 686f 6473 0d0a 2020 2020 2020 2020  ethods..        
-0000ec00: 6966 206c 656e 2873 656c 662e 6376 5f70  if len(self.cv_p
-0000ec10: 6174 7465 726e 732e 6974 656d 7328 2929  atterns.items())
-0000ec20: 203d 3d20 3020 6f72 2066 6f6c 643d 3d30   == 0 or fold==0
-0000ec30: 3a0d 0a20 2020 2020 2020 2020 2020 206e  :..            n
-0000ec40: 5f63 6820 3d20 7365 6c66 2e64 6174 6173  _ch = self.datas
-0000ec50: 6574 2e68 5f70 6172 616d 735b 276e 5f63  et.h_params['n_c
-0000ec60: 6827 5d0d 0a20 2020 2020 2020 2020 2020  h']..           
-0000ec70: 2073 656c 662e 6376 5f70 6174 7465 726e   self.cv_pattern
-0000ec80: 7320 3d20 6465 6661 756c 7464 6963 7428  s = defaultdict(
-0000ec90: 6469 6374 290d 0a20 2020 2020 2020 2020  dict)..         
-0000eca0: 2020 2066 6f72 206d 6574 686f 6420 696e     for method in
-0000ecb0: 206d 6574 686f 6473 3a0d 0a20 2020 2020   methods:..     
-0000ecc0: 2020 2020 2020 2023 6e5f 666f 6c64 7320         #n_folds 
-0000ecd0: 3d20 6c65 6e28 7365 6c66 2e64 6174 6173  = len(self.datas
-0000ece0: 6574 2e68 5f70 6172 616d 735b 2766 6f6c  et.h_params['fol
-0000ecf0: 6473 275d 5b30 5d29 0d0a 2020 2020 2020  ds'][0])..      
+0000eab0: 2020 2020 2020 2777 6569 6768 745f 6e6f        'weight_no
+0000eac0: 726d 272c 200d 0a20 2020 2020 2020 2020  rm', ..         
+0000ead0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eae0: 2020 2020 2020 2020 2023 2761 6273 5f77           #'abs_w
+0000eaf0: 6569 6768 7427 2c20 0d0a 2020 2020 2020  eight', ..      
+0000eb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb10: 2020 2020 2020 2020 2020 2020 276f 7574              'out
+0000eb20: 7075 745f 636f 7272 270d 0a20 2020 2020  put_corr'..     
+0000eb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb40: 2020 2020 2020 2020 2020 2020 205d 293a               ]):
+0000eb50: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+0000eb60: 2020 2020 2020 2043 6f6d 7075 7465 2061         Compute a
+0000eb70: 6e64 2073 746f 7265 2070 6174 7465 726e  nd store pattern
+0000eb80: 7320 6475 7269 6e67 2063 726f 7373 2d76  s during cross-v
+0000eb90: 616c 6964 6174 696f 6e2e 0d0a 0d0a 2020  alidation.....  
+0000eba0: 2020 2020 2020 2222 220d 0a0d 0a20 2020        """....   
+0000ebb0: 2020 2020 2070 6174 7465 726e 735f 7374       patterns_st
+0000ebc0: 7275 6374 203d 2073 656c 662e 636f 6d70  ruct = self.comp
+0000ebd0: 7574 655f 7061 7474 6572 6e73 2829 2020  ute_patterns()  
+0000ebe0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000ebf0: 636f 6d62 696e 6564 5f6d 6574 686f 6473  combined_methods
+0000ec00: 203d 206c 6973 7428 7061 7474 6572 6e73   = list(patterns
+0000ec10: 5f73 7472 7563 745b 2770 6174 7465 726e  _struct['pattern
+0000ec20: 7327 5d2e 6b65 7973 2829 290d 0a20 2020  s'].keys())..   
+0000ec30: 2020 2020 206d 6574 686f 6473 202b 3d20       methods += 
+0000ec40: 636f 6d62 696e 6564 5f6d 6574 686f 6473  combined_methods
+0000ec50: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+0000ec60: 2873 656c 662e 6376 5f70 6174 7465 726e  (self.cv_pattern
+0000ec70: 732e 6974 656d 7328 2929 203d 3d20 3020  s.items()) == 0 
+0000ec80: 6f72 2066 6f6c 643d 3d30 3a0d 0a20 2020  or fold==0:..   
+0000ec90: 2020 2020 2020 2020 206e 5f63 6820 3d20           n_ch = 
+0000eca0: 7365 6c66 2e6d 6574 612e 6461 7461 5b27  self.meta.data['
+0000ecb0: 6e5f 6368 275d 0d0a 2020 2020 2020 2020  n_ch']..        
+0000ecc0: 2020 2020 6e5f 7420 3d20 7061 7474 6572      n_t = patter
+0000ecd0: 6e73 5f73 7472 7563 745b 2777 6569 6768  ns_struct['weigh
+0000ece0: 7473 275d 5b27 6f75 745f 7765 6967 6874  ts']['out_weight
+0000ecf0: 7327 5d2e 7368 6170 655b 305d 0d0a 2020  s'].shape[0]..  
 0000ed00: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-0000ed10: 765f 7061 7474 6572 6e73 5b6d 6574 686f  v_patterns[metho
-0000ed20: 645d 5b27 7370 6174 6961 6c27 5d20 3d20  d]['spatial'] = 
-0000ed30: 6e70 2e7a 6572 6f73 285b 6e5f 6368 2c0d  np.zeros([n_ch,.
-0000ed40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ed50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed60: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000ed70: 6c66 2e79 5f73 6861 7065 5b30 5d2c 0d0a  lf.y_shape[0],..
-0000ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eda0: 2020 2020 2020 2020 2020 2020 206e 5f66               n_f
-0000edb0: 6f6c 6473 5d29 0d0a 2020 2020 2020 2020  olds])..        
-0000edc0: 2020 2020 2020 2020 7365 6c66 2e63 765f          self.cv_
-0000edd0: 7061 7474 6572 6e73 5b6d 6574 686f 645d  patterns[method]
-0000ede0: 5b27 7465 6d70 6f72 616c 275d 203d 206e  ['temporal'] = n
-0000edf0: 702e 7a65 726f 7328 5b73 656c 662e 6e66  p.zeros([self.nf
-0000ee00: 6674 2c0d 0a20 2020 2020 2020 2020 2020  ft,..           
-0000ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee40: 2020 2020 2020 2073 656c 662e 795f 7368         self.y_sh
-0000ee50: 6170 655b 305d 2c0d 0a20 2020 2020 2020  ape[0],..       
-0000ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed10: 765f 7061 7474 6572 6e73 203d 2064 6566  v_patterns = def
+0000ed20: 6175 6c74 6469 6374 2864 6963 7429 0d0a  aultdict(dict)..
+0000ed30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000ed40: 2e63 765f 7061 7474 6572 6e73 5b27 6672  .cv_patterns['fr
+0000ed50: 6571 7327 5d20 3d20 7061 7474 6572 6e73  eqs'] = patterns
+0000ed60: 5f73 7472 7563 745b 2766 7265 7173 275d  _struct['freqs']
+0000ed70: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0000ed80: 6c66 2e63 765f 7061 7474 6572 6e73 5b27  lf.cv_patterns['
+0000ed90: 6463 6f76 275d 5b27 696e 7075 745f 7370  dcov']['input_sp
+0000eda0: 6174 6961 6c27 5d20 3d20 6e70 2e7a 6572  atial'] = np.zer
+0000edb0: 6f73 285b 6e5f 6368 2c20 6e5f 6368 2c0d  os([n_ch, n_ch,.
+0000edc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000edd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee00: 2020 206e 5f66 6f6c 6473 5d29 0d0a 2020     n_folds])..  
+0000ee10: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+0000ee20: 765f 7061 7474 6572 6e73 5b27 6463 6f76  v_patterns['dcov
+0000ee30: 275d 5b27 636c 6173 735f 636f 6e64 6974  ']['class_condit
+0000ee40: 696f 6e61 6c27 5d20 3d20 6e70 2e7a 6572  ional'] = np.zer
+0000ee50: 6f73 285b 7365 6c66 2e79 5f73 6861 7065  os([self.y_shape
+0000ee60: 5b30 5d2c 0d0a 2020 2020 2020 2020 2020  [0],..          
 0000ee70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee90: 2020 2020 2020 2020 2020 206e 5f66 6f6c             n_fol
-0000eea0: 6473 5d29 0d0a 2020 2020 2020 2020 2020  ds])..          
-0000eeb0: 2020 2020 2020 7365 6c66 2e63 765f 7061        self.cv_pa
-0000eec0: 7474 6572 6e73 5b6d 6574 686f 645d 5b27  tterns[method]['
-0000eed0: 7073 6473 275d 203d 206e 702e 7a65 726f  psds'] = np.zero
-0000eee0: 7328 5b73 656c 662e 6e66 6674 2c0d 0a20  s([self.nfft,.. 
+0000ee90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eea0: 2020 2020 2020 2020 2020 2020 206e 5f63               n_c
+0000eeb0: 682c 206e 5f63 682c 0d0a 2020 2020 2020  h, n_ch,..      
+0000eec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef20: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000ef30: 662e 795f 7368 6170 655b 305d 2c0d 0a20  f.y_shape[0],.. 
-0000ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef00: 206e 5f66 6f6c 6473 5d29 0d0a 2020 2020   n_folds])..    
+0000ef10: 2020 2020 2020 2020 7365 6c66 2e63 765f          self.cv_
+0000ef20: 7061 7474 6572 6e73 5b27 6463 6f76 275d  patterns['dcov']
+0000ef30: 5b27 6b2d 3127 5d20 3d20 6e70 2e7a 6572  ['k-1'] = np.zer
+0000ef40: 6f73 285b 7365 6c66 2e79 5f73 6861 7065  os([self.y_shape
+0000ef50: 5b30 5d2c 0d0a 2020 2020 2020 2020 2020  [0],..          
 0000ef60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef70: 2020 2020 2020 2020 2020 2020 206e 5f66               n_f
-0000ef80: 6f6c 6473 5d29 0d0a 2020 2020 2020 2020  olds])..        
-0000ef90: 666f 7220 6d65 7468 6f64 2069 6e20 6d65  for method in me
-0000efa0: 7468 6f64 733a 0d0a 0d0a 2020 2020 2020  thods:....      
-0000efb0: 2020 2020 2020 6966 206d 6574 686f 6420        if method 
-0000efc0: 6e6f 7420 696e 2063 6f6d 6269 6e65 645f  not in combined_
-0000efd0: 6d65 7468 6f64 733a 0d0a 2020 2020 2020  methods:..      
-0000efe0: 2020 2020 2020 2020 2020 2363 6f6c 6c65            #colle
-0000eff0: 6374 2073 7061 7469 616c 2070 6174 7465  ct spatial patte
-0000f000: 726e 7320 666f 7220 2777 6569 6768 7427  rns for 'weight'
-0000f010: 2073 6f72 7469 6e67 0d0a 2020 2020 2020   sorting..      
-0000f020: 2020 2020 2020 2020 2020 746f 706f 2c20            topo, 
-0000f030: 7370 6563 7472 612c 2070 7364 7320 3d20  spectra, psds = 
-0000f040: 7365 6c66 2e73 696e 676c 655f 636f 6d70  self.single_comp
-0000f050: 6f6e 656e 745f 7061 7474 6572 6e28 7061  onent_pattern(pa
-0000f060: 7474 6572 6e73 5f73 7472 7563 742c 0d0a  tterns_struct,..
-0000f070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef80: 2020 2020 2020 2020 2020 2020 2020 6e5f                n_
+0000ef90: 6368 2c20 6e5f 6368 2c0d 0a20 2020 2020  ch, n_ch,..     
+0000efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efd0: 2020 206e 5f66 6f6c 6473 5d29 0d0a 2020     n_folds])..  
+0000efe0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+0000eff0: 2020 2020 2020 2020 666f 7220 6d65 7468          for meth
+0000f000: 6f64 2069 6e20 6d65 7468 6f64 733a 0d0a  od in methods:..
+0000f010: 2020 2020 2020 2020 2020 2020 236e 5f66              #n_f
+0000f020: 6f6c 6473 203d 206c 656e 2873 656c 662e  olds = len(self.
+0000f030: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
+0000f040: 5b27 666f 6c64 7327 5d5b 305d 290d 0a20  ['folds'][0]).. 
+0000f050: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000f060: 656c 662e 6376 5f70 6174 7465 726e 735b  elf.cv_patterns[
+0000f070: 6d65 7468 6f64 5d5b 2773 7061 7469 616c  method]['spatial
+0000f080: 275d 203d 206e 702e 7a65 726f 7328 5b6e  '] = np.zeros([n
+0000f090: 5f63 682c 0d0a 2020 2020 2020 2020 2020  _ch,..          
 0000f0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0b0: 2020 2020 736f 7274 696e 673d 6d65 7468      sorting=meth
-0000f0c0: 6f64 2c0d 0a20 2020 2020 2020 2020 2020  od,..           
-0000f0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0d0: 2020 2020 2020 7365 6c66 2e79 5f73 6861        self.y_sha
+0000f0e0: 7065 5b30 5d2c 0d0a 2020 2020 2020 2020  pe[0],..        
 0000f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f100: 2020 2020 2020 2020 206e 5f63 6f6d 703d           n_comp=
-0000f110: 6e5f 636f 6d70 290d 0a20 2020 2020 2020  n_comp)..       
-0000f120: 2020 2020 2020 2020 2073 656c 662e 6376           self.cv
-0000f130: 5f70 6174 7465 726e 735b 6d65 7468 6f64  _patterns[method
-0000f140: 5d5b 2773 7061 7469 616c 275d 5b3a 2c20  ]['spatial'][:, 
-0000f150: 3a2c 2066 6f6c 645d 203d 2074 6f70 6f0d  :, fold] = topo.
-0000f160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f170: 2073 656c 662e 6376 5f70 6174 7465 726e   self.cv_pattern
-0000f180: 735b 6d65 7468 6f64 5d5b 2774 656d 706f  s[method]['tempo
-0000f190: 7261 6c27 5d5b 3a2c 203a 2c20 666f 6c64  ral'][:, :, fold
-0000f1a0: 5d20 3d20 7370 6563 7472 610d 0a20 2020  ] = spectra..   
-0000f1b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000f1c0: 662e 6376 5f70 6174 7465 726e 735b 6d65  f.cv_patterns[me
-0000f1d0: 7468 6f64 5d5b 2770 7364 7327 5d5b 3a2c  thod]['psds'][:,
-0000f1e0: 203a 2c20 666f 6c64 5d20 3d20 7073 6473   :, fold] = psds
-0000f1f0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-0000f200: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0000f210: 2020 2020 2073 656c 662e 6376 5f70 6174       self.cv_pat
-0000f220: 7465 726e 735b 6d65 7468 6f64 5d5b 2773  terns[method]['s
-0000f230: 7061 7469 616c 275d 5b3a 2c20 3a2c 2066  patial'][:, :, f
-0000f240: 6f6c 645d 203d 2070 6174 7465 726e 735f  old] = patterns_
-0000f250: 7374 7275 6374 5b27 7061 7474 6572 6e73  struct['patterns
-0000f260: 275d 5b6d 6574 686f 645d 0d0a 0d0a 2020  '][method]....  
-0000f270: 2020 6465 6620 6765 745f 7370 6563 7472    def get_spectr
-0000f280: 6128 7365 6c66 2c20 7765 6967 6874 732c  a(self, weights,
-0000f290: 2061 6374 6976 6174 696f 6e73 2c20 6e66   activations, nf
-0000f2a0: 6674 3d31 3238 293a 0d0a 2020 2020 2020  ft=128):..      
-0000f2b0: 2020 2323 5073 6473 2061 6e64 2066 7265    ##Psds and fre
-0000f2c0: 7120 7265 7370 6f6e 7365 730d 0a20 2020  q responses..   
-0000f2d0: 2020 2020 2023 2020 436f 6d70 7574 6520       #  Compute 
-0000f2e0: 6672 6571 7565 6e63 7920 7265 7370 6f6e  frequency respon
-0000f2f0: 7365 7320 616e 6420 736f 7572 6365 2073  ses and source s
-0000f300: 7065 6374 7261 0d0a 2020 2020 2020 2020  pectra..        
-0000f310: 7265 616c 6820 3d20 5b5d 0d0a 2020 2020  realh = []..    
-0000f320: 2020 2020 7073 6473 203d 205b 5d0d 0a20      psds = [].. 
-0000f330: 2020 2020 2020 2066 6f72 2069 2c20 666c         for i, fl
-0000f340: 7420 696e 2065 6e75 6d65 7261 7465 2877  t in enumerate(w
-0000f350: 6569 6768 7473 5b27 7463 6f6e 7627 5d2e  eights['tconv'].
-0000f360: 5429 3a0d 0a20 2020 2020 2020 2020 2020  T):..           
-0000f370: 2066 6c74 202d 3d20 666c 742e 6d65 616e   flt -= flt.mean
-0000f380: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0000f390: 2366 6c74 202d 3d20 7365 6c66 2e74 5f63  #flt -= self.t_c
-0000f3a0: 6f6e 765f 6269 6173 6573 5b69 5d2f 7365  onv_biases[i]/se
-0000f3b0: 6c66 2e73 7065 6373 5b27 6669 6c74 6572  lf.specs['filter
-0000f3c0: 5f6c 656e 6774 6827 5d0d 0a20 2020 2020  _length']..     
-0000f3d0: 2020 2020 2020 206c 7463 203d 2061 6374         ltc = act
-0000f3e0: 6976 6174 696f 6e73 5b27 646d 7827 5d5b  ivations['dmx'][
-0000f3f0: 3a2c 2030 2c20 3a2c 2069 5d20 2d20 6e70  :, 0, :, i] - np
-0000f400: 2e6d 6561 6e28 6163 7469 7661 7469 6f6e  .mean(activation
-0000f410: 735b 2764 6d78 275d 5b3a 2c20 302c 203a  s['dmx'][:, 0, :
-0000f420: 2c20 695d 2c20 6178 6973 3d31 2c20 6b65  , i], axis=1, ke
-0000f430: 6570 6469 6d73 3d54 7275 6529 0d0a 2020  epdims=True)..  
-0000f440: 2020 2020 2020 2020 2020 6672 2c20 7073            fr, ps
-0000f450: 6420 3d20 7765 6c63 6828 6c74 632c 0d0a  d = welch(ltc,..
-0000f460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f470: 2020 2020 2020 2020 2020 2020 6673 3d73              fs=s
-0000f480: 656c 662e 6461 7461 7365 742e 685f 7061  elf.dataset.h_pa
-0000f490: 7261 6d73 5b27 6673 275d 2c0d 0a20 2020  rams['fs'],..   
-0000f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4b0: 2020 2020 2020 2020 206e 6666 743d 6e66           nfft=nf
-0000f4c0: 6674 202a 2032 2c0d 0a20 2020 2020 2020  ft * 2,..       
-0000f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4e0: 2020 2020 206e 7065 7273 6567 3d6e 6666       nperseg=nff
-0000f4f0: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-0000f500: 6966 206c 656e 2866 725b 3a2d 315d 2920  if len(fr[:-1]) 
-0000f510: 3c20 6e66 6674 3a0d 0a20 2020 2020 2020  < nfft:..       
-0000f520: 2020 2020 2020 2020 206e 6666 7420 3d20           nfft = 
-0000f530: 6c65 6e28 6672 5b3a 2d31 5d29 0d0a 0d0a  len(fr[:-1])....
-0000f540: 2020 2020 2020 2020 2020 2020 772c 2068              w, h
-0000f550: 203d 2066 7265 717a 2866 6c74 2c20 312c   = freqz(flt, 1,
-0000f560: 2077 6f72 4e3d 6e66 6674 2c20 6673 203d   worN=nfft, fs =
-0000f570: 2073 656c 662e 6461 7461 7365 742e 685f   self.dataset.h_
-0000f580: 7061 7261 6d73 5b27 6673 275d 290d 0a0d  params['fs'])...
-0000f590: 0a20 2020 2020 2020 2020 2020 2070 7364  .            psd
-0000f5a0: 732e 6170 7065 6e64 2870 7364 5b3a 2c20  s.append(psd[:, 
-0000f5b0: 3a2d 315d 2e6d 6561 6e28 3029 290d 0a20  :-1].mean(0)).. 
-0000f5c0: 2020 2020 2020 2020 2020 2072 6561 6c68             realh
-0000f5d0: 2e61 7070 656e 6428 6e70 2e61 6273 2868  .append(np.abs(h
-0000f5e0: 2929 0d0a 0d0a 2020 2020 2020 2020 7370  ))....        sp
-0000f5f0: 6563 7472 6120 3d20 7b7d 0d0a 2020 2020  ectra = {}..    
-0000f600: 2020 2020 7370 6563 7472 615b 2766 7265      spectra['fre
-0000f610: 715f 7265 7370 6f6e 7365 7327 5d20 3d20  q_responses'] = 
-0000f620: 6e70 2e61 7272 6179 2872 6561 6c68 290d  np.array(realh).
-0000f630: 0a20 2020 2020 2020 2073 7065 6374 7261  .        spectra
-0000f640: 5b27 7073 6473 275d 203d 206e 702e 6172  ['psds'] = np.ar
-0000f650: 7261 7928 7073 6473 290d 0a20 2020 2020  ray(psds)..     
-0000f660: 2020 2073 7065 6374 7261 5b27 6672 6571     spectra['freq
-0000f670: 7327 5d20 3d20 770d 0a20 2020 2020 2020  s'] = w..       
-0000f680: 2072 6574 7572 6e20 7370 6563 7472 610d   return spectra.
-0000f690: 0a0d 0a0d 0a0d 0a20 2020 2064 6566 2067  .......    def g
-0000f6a0: 6574 5f77 6569 6768 7473 2873 656c 6629  et_weights(self)
-0000f6b0: 3a0d 0a20 2020 2020 2020 2077 6569 6768  :..        weigh
-0000f6c0: 7473 203d 207b 7d0d 0a20 2020 2020 2020  ts = {}..       
-0000f6d0: 2023 2045 7874 7261 6374 2077 6569 6768   # Extract weigh
-0000f6e0: 7473 0d0a 2020 2020 2020 2020 2320 5370  ts..        # Sp
-0000f6f0: 6174 6961 6c20 6578 7472 6163 7469 6f6e  atial extraction
-0000f700: 2066 6974 6572 730d 0a20 2020 2020 2020   fiters..       
-0000f710: 2077 6569 6768 7473 5b27 646d 7827 5d20   weights['dmx'] 
-0000f720: 3d20 6e70 2e73 7175 6565 7a65 2873 656c  = np.squeeze(sel
-0000f730: 662e 646d 782e 772e 6e75 6d70 7928 2929  f.dmx.w.numpy())
-0000f740: 0d0a 2020 2020 2020 2020 7765 6967 6874  ..        weight
-0000f750: 735b 2764 6d78 5f62 275d 203d 2073 656c  s['dmx_b'] = sel
-0000f760: 662e 646d 782e 625f 696e 2e6e 756d 7079  f.dmx.b_in.numpy
-0000f770: 2829 0d0a 2020 2020 2020 2020 2320 5465  ()..        # Te
-0000f780: 6d70 6f72 616c 206b 6572 6e65 6c73 0d0a  mporal kernels..
-0000f790: 2020 2020 2020 2020 7765 6967 6874 735b          weights[
-0000f7a0: 2774 636f 6e76 275d 203d 206e 702e 7371  'tconv'] = np.sq
-0000f7b0: 7565 657a 6528 7365 6c66 2e74 636f 6e76  ueeze(self.tconv
-0000f7c0: 2e66 696c 7465 7273 2e6e 756d 7079 2829  .filters.numpy()
-0000f7d0: 290d 0a20 2020 2020 2020 2077 6569 6768  )..        weigh
-0000f7e0: 7473 5b27 7463 6f6e 765f 6227 5d20 3d20  ts['tconv_b'] = 
-0000f7f0: 6e70 2e73 7175 6565 7a65 2873 656c 662e  np.squeeze(self.
-0000f800: 7463 6f6e 762e 622e 6e75 6d70 7928 2929  tconv.b.numpy())
-0000f810: 0d0a 2020 2020 2020 2020 2320 4669 6e61  ..        # Fina
-0000f820: 6c20 6c61 7965 720d 0a20 2020 2020 2020  l layer..       
-0000f830: 2077 6569 6768 7473 5b27 6f75 745f 775f   weights['out_w_
-0000f840: 666c 6174 275d 203d 2073 656c 662e 6669  flat'] = self.fi
-0000f850: 6e5f 6663 2e77 2e6e 756d 7079 2829 0d0a  n_fc.w.numpy()..
-0000f860: 2020 2020 2020 2020 7765 6967 6874 735b          weights[
-0000f870: 276f 7574 5f77 6569 6768 7473 275d 203d  'out_weights'] =
-0000f880: 206e 702e 7265 7368 6170 6528 7365 6c66   np.reshape(self
-0000f890: 2e66 696e 5f66 632e 772e 6e75 6d70 7928  .fin_fc.w.numpy(
-0000f8a0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-0000f8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f8c0: 2020 2020 205b 7365 6c66 2e70 6f6f 6c65       [self.poole
-0000f8d0: 642e 7368 6170 655b 325d 2c0d 0a20 2020  d.shape[2],..   
-0000f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f8f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000f900: 656c 662e 646d 782e 7369 7a65 2c0d 0a20  elf.dmx.size,.. 
-0000f910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f930: 2073 656c 662e 6f75 745f 6469 6d5d 2c0d   self.out_dim],.
-0000f940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f960: 2020 6f72 6465 723d 2743 2729 0d0a 2020    order='C')..  
-0000f970: 2020 2020 2020 7765 6967 6874 735b 2766        weights['f
-0000f980: 635f 6227 5d20 3d20 7365 6c66 2e66 696e  c_b'] = self.fin
-0000f990: 5f66 632e 622e 6e75 6d70 7928 290d 0a0d  _fc.b.numpy()...
-0000f9a0: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-0000f9b0: 2222 2257 6569 6768 7473 3a20 5c6e 0d0a  """Weights: \n..
-0000f9c0: 2020 2020 2020 2020 2020 2020 2020 444d                DM
-0000f9d0: 583a 207b 7d0d 0a20 2020 2020 2020 2020  X: {}..         
-0000f9e0: 2020 2020 2054 434f 4e56 3a20 7b7d 0d0a       TCONV: {}..
-0000f9f0: 2020 2020 2020 2020 2020 2020 2020 4643                FC
-0000fa00: 5f44 454e 5345 3a20 7b7d 2222 222e 666f  _DENSE: {}""".fo
-0000fa10: 726d 6174 2877 6569 6768 7473 5b27 646d  rmat(weights['dm
-0000fa20: 7827 5d2e 7368 6170 652c 0d0a 2020 2020  x'].shape,..    
-0000fa30: 2020 2020 2020 2020 2020 7765 6967 6874            weight
-0000fa40: 735b 2774 636f 6e76 275d 2e73 6861 7065  s['tconv'].shape
-0000fa50: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000fa60: 2077 6569 6768 7473 5b27 6f75 745f 7765   weights['out_we
-0000fa70: 6967 6874 7327 5d2e 7368 6170 6529 290d  ights'].shape)).
-0000fa80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000fa90: 7765 6967 6874 730d 0a0d 0a20 2020 2064  weights....    d
-0000faa0: 6566 2063 6f6d 7075 7465 5f63 6f6d 706f  ef compute_compo
-0000fab0: 6e65 6e74 7769 7365 5f6c 6f73 7328 7365  nentwise_loss(se
-0000fac0: 6c66 2c20 582c 2079 2c20 7765 6967 6874  lf, X, y, weight
-0000fad0: 7329 3a0d 0a0d 0a0d 0a0d 0a20 2020 2020  s):........     
-0000fae0: 2020 2022 2222 436f 6d70 7574 6520 636f     """Compute co
-0000faf0: 6d70 6f6e 656e 7420 7265 6c65 7661 6e63  mponent relevanc
-0000fb00: 6573 2062 7920 7265 6375 7273 6976 6520  es by recursive 
-0000fb10: 656c 696d 696e 6174 696f 6e0d 0a20 2020  elimination..   
-0000fb20: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0000fb30: 2020 6d6f 6465 6c5f 7765 6967 6874 7320    model_weights 
-0000fb40: 3d20 7365 6c66 2e6b 6d2e 6765 745f 7765  = self.km.get_we
-0000fb50: 6967 6874 7328 290d 0a20 2020 2020 2020  ights()..       
-0000fb60: 2062 6173 655f 6c6f 7373 2c20 6261 7365   base_loss, base
-0000fb70: 5f70 6572 666f 726d 616e 6365 203d 2073  _performance = s
-0000fb80: 656c 662e 6b6d 2e65 7661 6c75 6174 6528  elf.km.evaluate(
-0000fb90: 582c 2079 2c20 7665 7262 6f73 653d 3029  X, y, verbose=0)
-0000fba0: 0d0a 2020 2020 2020 2020 2320 6966 206c  ..        # if l
-0000fbb0: 656e 2862 6173 655f 7065 7266 6f72 6d61  en(base_performa
-0000fbc0: 6e63 6520 3e20 3129 3a0d 0a20 2020 2020  nce > 1):..     
-0000fbd0: 2020 2023 2020 2020 6261 7365 5f70 6572     #    base_per
-0000fbe0: 666f 726d 616e 6365 203d 2062 6261 7365  formance = bbase
-0000fbf0: 5f70 6572 666f 726d 616e 6365 5b30 5d0d  _performance[0].
-0000fc00: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
-0000fc10: 5f72 656c 6576 616e 6365 735f 6c6f 7373  _relevances_loss
-0000fc20: 203d 205b 5d0d 0a20 2020 2020 2020 206e   = []..        n
-0000fc30: 5f6f 7574 5f74 203d 2077 6569 6768 7473  _out_t = weights
-0000fc40: 5b27 6f75 745f 7765 6967 6874 7327 5d2e  ['out_weights'].
-0000fc50: 7368 6170 655b 305d 0d0a 2020 2020 2020  shape[0]..      
-0000fc60: 2020 6e5f 6f75 745f 7920 3d20 7765 6967    n_out_y = weig
-0000fc70: 6874 735b 276f 7574 5f77 6569 6768 7473  hts['out_weights
-0000fc80: 275d 2e73 6861 7065 5b2d 315d 0d0a 2020  '].shape[-1]..  
-0000fc90: 2020 2020 2020 7a65 726f 7765 6967 6874        zeroweight
-0000fca0: 7320 3d20 6e70 2e7a 6572 6f73 2828 6e5f  s = np.zeros((n_
-0000fcb0: 6f75 745f 742c 2929 0d0a 2020 2020 2020  out_t,))..      
-0000fcc0: 2020 6c6f 7373 6573 203d 206e 702e 7a65    losses = np.ze
-0000fcd0: 726f 7328 5b73 656c 662e 7370 6563 735b  ros([self.specs[
-0000fce0: 276e 5f6c 6174 656e 7427 5d2c 206e 5f6f  'n_latent'], n_o
-0000fcf0: 7574 5f79 5d29 0d0a 2020 2020 2020 2020  ut_y])..        
-0000fd00: 666f 7220 6a6a 2069 6e20 7261 6e67 6528  for jj in range(
-0000fd10: 6e5f 6f75 745f 7929 3a0d 0a20 2020 2020  n_out_y):..     
-0000fd20: 2020 2020 2020 2023 666f 7220 6561 6368         #for each
-0000fd30: 2063 6c61 7373 0d0a 2020 2020 2020 2020   class..        
-0000fd40: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-0000fd50: 6765 2873 656c 662e 7370 6563 735b 226e  ge(self.specs["n
-0000fd60: 5f6c 6174 656e 7422 5d29 3a0d 0a20 2020  _latent"]):..   
-0000fd70: 2020 2020 2020 2020 2020 2020 2023 666f               #fo
-0000fd80: 7220 6561 6368 2063 6f6d 706f 6e65 6e74  r each component
-0000fd90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000fda0: 2020 6c6f 7373 5f70 6572 5f63 6f6d 706f    loss_per_compo
-0000fdb0: 6e65 6e74 203d 205b 5d0d 0a0d 0a20 2020  nent = []....   
-0000fdc0: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0000fdd0: 5f77 6569 6768 7473 203d 2077 6569 6768  _weights = weigh
-0000fde0: 7473 5b27 6f75 745f 7765 6967 6874 7327  ts['out_weights'
-0000fdf0: 5d2e 636f 7079 2829 0d0a 2020 2020 2020  ].copy()..      
-0000fe00: 2020 2020 2020 2020 2020 6e65 775f 6269            new_bi
-0000fe10: 6173 203d 2077 6569 6768 7473 5b27 6663  as = weights['fc
-0000fe20: 5f62 275d 2e63 6f70 7928 290d 0a20 2020  _b'].copy()..   
-0000fe30: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0000fe40: 5f77 6569 6768 7473 5b3a 2c20 692c 206a  _weights[:, i, j
-0000fe50: 6a5d 203d 207a 6572 6f77 6569 6768 7473  j] = zeroweights
-0000fe60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000fe70: 2020 6e65 775f 6269 6173 5b6a 6a5d 203d    new_bias[jj] =
-0000fe80: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
-0000fe90: 2020 2020 6e65 775f 7765 6967 6874 7320      new_weights 
-0000fea0: 3d20 6e70 2e72 6573 6861 7065 286e 6577  = np.reshape(new
-0000feb0: 5f77 6569 6768 7473 2c20 7765 6967 6874  _weights, weight
-0000fec0: 735b 276f 7574 5f77 5f66 6c61 7427 5d2e  s['out_w_flat'].
-0000fed0: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
-0000fee0: 2020 2020 2020 2020 6d6f 6465 6c5f 7765          model_we
-0000fef0: 6967 6874 735b 2d32 5d20 3d20 6e65 775f  ights[-2] = new_
-0000ff00: 7765 6967 6874 730d 0a20 2020 2020 2020  weights..       
-0000ff10: 2020 2020 2020 2020 206d 6f64 656c 5f77           model_w
-0000ff20: 6569 6768 7473 5b2d 315d 203d 206e 6577  eights[-1] = new
-0000ff30: 5f62 6961 730d 0a20 2020 2020 2020 2020  _bias..         
-0000ff40: 2020 2020 2020 2073 656c 662e 6b6d 2e73         self.km.s
-0000ff50: 6574 5f77 6569 6768 7473 286d 6f64 656c  et_weights(model
-0000ff60: 5f77 6569 6768 7473 290d 0a20 2020 2020  _weights)..     
-0000ff70: 2020 2020 2020 2020 2020 206c 6f73 7320             loss 
-0000ff80: 3d20 7365 6c66 2e6b 6d2e 6576 616c 7561  = self.km.evalua
-0000ff90: 7465 2858 2c20 792c 2076 6572 626f 7365  te(X, y, verbose
-0000ffa0: 3d30 295b 305d 0d0a 0d0a 2020 2020 2020  =0)[0]....      
-0000ffb0: 2020 2020 2020 2020 2020 236c 6f73 735f            #loss_
-0000ffc0: 7065 725f 636f 6d70 6f6e 656e 742e 6170  per_component.ap
-0000ffd0: 7065 6e64 2862 6173 655f 6c6f 7373 202d  pend(base_loss -
-0000ffe0: 206c 6f73 7329 0d0a 2020 2020 2020 2020   loss)..        
-0000fff0: 2020 2020 2020 2020 6c6f 7373 6573 5b69          losses[i
-00010000: 2c20 6a6a 5d20 3d20 6261 7365 5f6c 6f73  , jj] = base_los
-00010010: 7320 2d20 6c6f 7373 0d0a 2020 2020 2020  s - loss..      
-00010020: 2020 2020 2020 2366 6561 7475 7265 5f72        #feature_r
-00010030: 656c 6576 616e 6365 735f 6c6f 7373 2e61  elevances_loss.a
-00010040: 7070 656e 6428 6e70 2e61 7272 6179 286c  ppend(np.array(l
-00010050: 6f73 735f 7065 725f 6363 6f6d 706f 6e65  oss_per_ccompone
-00010060: 6e74 2929 0d0a 2020 2020 2020 2020 7265  nt))..        re
-00010070: 7475 726e 206c 6f73 7365 730d 0a0d 0a0d  turn losses.....
-00010080: 0a20 2020 2064 6566 2067 6574 5f6f 7574  .    def get_out
-00010090: 7075 745f 636f 7272 656c 6174 696f 6e73  put_correlations
-000100a0: 2873 656c 662c 2061 6374 6976 6174 696f  (self, activatio
-000100b0: 6e73 293a 0d0a 2020 2020 2020 2020 2222  ns):..        ""
-000100c0: 2243 6f6d 7075 7465 7320 6120 7369 6d69  "Computes a simi
-000100d0: 6c61 7269 7479 206d 6574 7269 6320 6265  larity metric be
-000100e0: 7477 6565 6e20 6561 6368 206f 6620 7468  tween each of th
-000100f0: 6520 6578 7472 6163 7465 640d 0a20 2020  e extracted..   
-00010100: 2020 2020 2066 6561 7475 7265 7320 616e       features an
-00010110: 6420 7468 6520 7461 7267 6574 2076 6172  d the target var
-00010120: 6961 626c 652e 0d0a 0d0a 2020 2020 2020  iable.....      
-00010130: 2020 5468 6520 6d65 7472 6963 2069 7320    The metric is 
-00010140: 6120 4d61 6e68 6174 7461 6e20 6469 7374  a Manhattan dist
-00010150: 616e 6365 2066 6f72 2064 6963 7265 7465  ance for dicrete
-00010160: 2074 6172 6765 7473 2c20 616e 640d 0a20   targets, and.. 
-00010170: 2020 2020 2020 2053 7065 6172 6d61 6e20         Spearman 
-00010180: 636f 7272 656c 6174 696f 6e20 666f 7220  correlation for 
-00010190: 636f 6e74 696e 756f 7573 2074 6172 6765  continuous targe
-000101a0: 7473 2e0d 0a20 2020 2020 2020 2022 2222  ts...        """
-000101b0: 0d0a 2020 2020 2020 2020 636f 7272 5f74  ..        corr_t
-000101c0: 6f5f 6f75 7470 7574 203d 205b 5d0d 0a20  o_output = [].. 
-000101d0: 2020 2020 2020 2079 5f74 7275 6520 3d20         y_true = 
-000101e0: 6163 7469 7661 7469 6f6e 735b 2766 6327  activations['fc'
-000101f0: 5d2e 6e75 6d70 7928 2920 2379 5f74 7275  ].numpy() #y_tru
-00010200: 652e 6e75 6d70 7928 290d 0a20 2020 2020  e.numpy()..     
-00010210: 2020 2066 6c61 745f 6665 6174 7320 3d20     flat_feats = 
-00010220: 6163 7469 7661 7469 6f6e 735b 2774 636f  activations['tco
-00010230: 6e76 275d 2e6e 756d 7079 2829 2e72 6573  nv'].numpy().res
-00010240: 6861 7065 2879 5f74 7275 652e 7368 6170  hape(y_true.shap
-00010250: 655b 305d 2c20 2d31 290d 0a0d 0a20 2020  e[0], -1)....   
-00010260: 2020 2020 2023 6966 2073 656c 662e 6461       #if self.da
-00010270: 7461 7365 742e 685f 7061 7261 6d73 5b27  taset.h_params['
-00010280: 7461 7267 6574 5f74 7970 6527 5d20 696e  target_type'] in
-00010290: 205b 2766 6c6f 6174 272c 2027 7369 676e   ['float', 'sign
-000102a0: 616c 275d 3a0d 0a20 2020 2020 2020 2066  al']:..        f
-000102b0: 6f72 2079 5f20 696e 2079 5f74 7275 652e  or y_ in y_true.
-000102c0: 543a 0d0a 0d0a 2020 2020 2020 2020 2020  T:....          
-000102d0: 2020 7266 6f63 7320 3d20 6e70 2e61 7272    rfocs = np.arr
-000102e0: 6179 285b 7370 6561 726d 616e 7228 795f  ay([spearmanr(y_
-000102f0: 2c20 6629 5b30 5d20 666f 7220 6620 696e  , f)[0] for f in
-00010300: 2066 6c61 745f 6665 6174 732e 545d 290d   flat_feats.T]).
-00010310: 0a20 2020 2020 2020 2020 2020 2063 6f72  .            cor
-00010320: 725f 746f 5f6f 7574 7075 742e 6170 7065  r_to_output.appe
-00010330: 6e64 2872 666f 6373 2e72 6573 6861 7065  nd(rfocs.reshape
-00010340: 2861 6374 6976 6174 696f 6e73 5b27 7463  (activations['tc
-00010350: 6f6e 7627 5d2e 7368 6170 655b 313a 5d29  onv'].shape[1:])
-00010360: 290d 0a0d 0a0d 0a20 2020 2020 2020 2023  )......        #
-00010370: 2065 6c69 6620 7365 6c66 2e64 6174 6173   elif self.datas
-00010380: 6574 2e68 5f70 6172 616d 735b 2774 6172  et.h_params['tar
-00010390: 6765 745f 7479 7065 275d 203d 3d20 2769  get_type'] == 'i
-000103a0: 6e74 273a 0d0a 2020 2020 2020 2020 2320  nt':..        # 
-000103b0: 2020 2020 795f 7472 7565 203d 2079 5f74      y_true = y_t
-000103c0: 7275 652f 6e70 2e6c 696e 616c 672e 6e6f  rue/np.linalg.no
-000103d0: 726d 2879 5f74 7275 652c 206f 7264 3d31  rm(y_true, ord=1
-000103e0: 2c20 6178 6973 3d30 295b 4e6f 6e65 2c20  , axis=0)[None, 
-000103f0: 3a5d 0d0a 2020 2020 2020 2020 2320 2020  :]..        #   
-00010400: 2020 666c 6174 5f64 6976 203d 206e 702e    flat_div = np.
-00010410: 6c69 6e61 6c67 2e6e 6f72 6d28 666c 6174  linalg.norm(flat
-00010420: 5f66 6561 7473 2c20 312c 2061 7869 733d  _feats, 1, axis=
-00010430: 3029 5b4e 6f6e 652c 203a 5d0d 0a20 2020  0)[None, :]..   
-00010440: 2020 2020 2023 2020 2020 2066 6c61 745f       #     flat_
-00010450: 6665 6174 7320 3d20 666c 6174 5f66 6561  feats = flat_fea
-00010460: 7473 2f66 6c61 745f 6469 760d 0a20 2020  ts/flat_div..   
-00010470: 2020 2020 2023 2020 2020 2023 7072 696e       #     #prin
-00010480: 7428 2266 663a 222c 2066 6c61 745f 6665  t("ff:", flat_fe
-00010490: 6174 732e 7368 6170 6529 0d0a 2020 2020  ats.shape)..    
-000104a0: 2020 2020 2320 2020 2020 2370 7269 6e74      #     #print
-000104b0: 2822 795f 7472 7565 3a22 2c20 795f 7472  ("y_true:", y_tr
-000104c0: 7565 2e73 6861 7065 290d 0a20 2020 2020  ue.shape)..     
-000104d0: 2020 2023 2020 2020 2066 6f72 2079 5f20     #     for y_ 
-000104e0: 696e 2079 5f74 7275 652e 543a 0d0a 2020  in y_true.T:..  
-000104f0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-00010500: 2370 7269 6e74 2827 792e 543a 272c 2079  #print('y.T:', y
-00010510: 5f2e 7368 6170 6529 0d0a 2020 2020 2020  _.shape)..      
-00010520: 2020 2320 2020 2020 2020 2020 7266 6f63    #         rfoc
-00010530: 7320 3d20 322e 202d 206e 702e 7375 6d28  s = 2. - np.sum(
-00010540: 6e70 2e61 6273 2866 6c61 745f 6665 6174  np.abs(flat_feat
-00010550: 7320 2d20 795f 5b3a 2c20 4e6f 6e65 5d29  s - y_[:, None])
-00010560: 2c20 3029 0d0a 2020 2020 2020 2020 2320  , 0)..        # 
-00010570: 2020 2020 2020 2020 636f 7272 5f74 6f5f          corr_to_
-00010580: 6f75 7470 7574 2e61 7070 656e 6428 7266  output.append(rf
-00010590: 6f63 732e 7265 7368 6170 6528 6163 7469  ocs.reshape(acti
-000105a0: 7661 7469 6f6e 735b 2774 636f 6e76 275d  vations['tconv']
-000105b0: 2e73 6861 7065 5b31 3a5d 2929 0d0a 0d0a  .shape[1:]))....
-000105c0: 2020 2020 2020 2020 636f 7272 5f74 6f5f          corr_to_
-000105d0: 6f75 7470 7574 203d 206e 702e 6e61 6e6d  output = np.nanm
-000105e0: 6178 286e 702e 636f 6e63 6174 656e 6174  ax(np.concatenat
-000105f0: 6528 636f 7272 5f74 6f5f 6f75 7470 7574  e(corr_to_output
-00010600: 2c30 292c 2031 292e 540d 0a0d 0a20 2020  ,0), 1).T....   
-00010610: 2020 2020 2069 6620 6e70 2e61 6e79 286e       if np.any(n
-00010620: 702e 6973 6e61 6e28 636f 7272 5f74 6f5f  p.isnan(corr_to_
-00010630: 6f75 7470 7574 2929 3a0d 0a20 2020 2020  output)):..     
-00010640: 2020 2020 2020 2063 6f72 725f 746f 5f6f         corr_to_o
-00010650: 7574 7075 745b 6e70 2e69 736e 616e 2863  utput[np.isnan(c
-00010660: 6f72 725f 746f 5f6f 7574 7075 7429 5d20  orr_to_output)] 
-00010670: 3d20 300d 0a20 2020 2020 2020 2072 6574  = 0..        ret
-00010680: 7572 6e20 636f 7272 5f74 6f5f 6f75 7470  urn corr_to_outp
-00010690: 7574 0d0a 0d0a 2020 2020 2320 2d2d 2d20  ut....    # --- 
-000106a0: 4c46 434e 4e20 706c 6f74 2066 756e 6374  LFCNN plot funct
-000106b0: 696f 6e73 202d 2d2d 0d0a 0d0a 2020 2020  ions ---....    
-000106c0: 6465 6620 706c 6f74 5f65 766f 6b65 645f  def plot_evoked_
-000106d0: 7065 616b 7328 7365 6c66 2c20 6461 7461  peaks(self, data
-000106e0: 3d4e 6f6e 652c 2074 3d4e 6f6e 652c 2063  =None, t=None, c
-000106f0: 6c61 7373 5f73 7562 7365 743d 4e6f 6e65  lass_subset=None
-00010700: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00010710: 2020 2020 2020 2020 2020 2020 2073 656e               sen
-00010720: 736f 725f 6c61 796f 7574 3d27 5665 6374  sor_layout='Vect
-00010730: 6f72 7669 6577 2d6d 6167 2729 3a0d 0a20  orview-mag'):.. 
-00010740: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00010750: 2020 2020 506c 6f74 206f 6e65 2073 7061      Plot one spa
-00010760: 7469 616c 2074 6f70 6f67 7261 7068 7920  tial topography 
-00010770: 6f66 2063 6c61 7373 2d63 6f6e 6469 7469  of class-conditi
-00010780: 6f6e 616c 2061 7665 7261 6765 206f 6620  onal average of 
-00010790: 7468 6520 696e 7075 742e 0d0a 2020 2020  the input...    
-000107a0: 2020 2020 4966 2074 696d 6570 6f69 6e74      If timepoint
-000107b0: 2069 7320 6e6f 7420 7370 6563 6966 6965   is not specifie
-000107c0: 6420 6974 2069 7320 7069 636b 6564 2061  d it is picked a
-000107d0: 7320 6120 6d61 7869 6d75 6d20 524d 5320  s a maximum RMS 
-000107e0: 666f 7220 6561 6368 0d0a 2020 2020 2020  for each..      
-000107f0: 2020 636c 6173 732e 0d0a 0d0a 0d0a 2020    class.......  
-00010800: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00010810: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-00010820: 2d2d 2d2d 0d0a 2020 2020 2020 2020 746f  ----..        to
-00010830: 706f 7320 3a20 6e70 2e61 7272 6179 0d0a  pos : np.array..
-00010840: 2020 2020 2020 2020 2020 2020 5b6e 5f63              [n_c
-00010850: 682c 206e 5f74 2c20 6e5f 636c 6173 7365  h, n_t, n_classe
-00010860: 735d 0d0a 2020 2020 2020 2020 7365 6e73  s]..        sens
-00010870: 6f72 5f6c 6179 6f75 7420 3a20 5459 5045  or_layout : TYPE
-00010880: 2c20 6f70 7469 6f6e 616c 0d0a 2020 2020  , optional..    
-00010890: 2020 2020 2020 2020 4445 5343 5249 5054          DESCRIPT
-000108a0: 494f 4e2e 2054 6865 2064 6566 6175 6c74  ION. The default
-000108b0: 2069 7320 2756 6563 746f 7276 6965 772d   is 'Vectorview-
-000108c0: 6d61 6727 2e0d 0a0d 0a20 2020 2020 2020  mag'.....       
-000108d0: 2022 2222 0d0a 2020 2020 2020 2020 6e20   """..        n 
-000108e0: 3d20 7365 6c66 2e6f 7574 5f64 696d 0d0a  = self.out_dim..
-000108f0: 0d0a 2020 2020 2020 2020 6966 2064 6174  ..        if dat
-00010900: 6120 6973 204e 6f6e 653a 0d0a 2020 2020  a is None:..    
-00010910: 2020 2020 2020 2020 6461 7461 203d 2073          data = s
-00010920: 656c 662e 7472 7565 5f65 766f 6b65 645f  elf.true_evoked_
-00010930: 6461 7461 0d0a 2020 2020 2020 2020 2020  data..          
-00010940: 2020 7469 746c 6520 3d20 2754 7275 6520    title = 'True 
-00010950: 5061 7474 6572 6e73 270d 0a20 2020 2020  Patterns'..     
-00010960: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00010970: 2020 2020 2020 7469 746c 6520 3d20 274d        title = 'M
-00010980: 6f64 656c 2d64 6572 6976 6564 2070 6174  odel-derived pat
-00010990: 7465 726e 7327 0d0a 0d0a 2020 2020 2020  terns'....      
-000109a0: 2020 6966 2074 2069 7320 4e6f 6e65 3a0d    if t is None:.
-000109b0: 0a20 2020 2020 2020 2020 2020 2074 203d  .            t =
-000109c0: 206e 702e 6172 676d 6178 286e 702e 6d65   np.argmax(np.me
-000109d0: 616e 2864 6174 612a 2a32 2c20 6178 6973  an(data**2, axis
-000109e0: 3d30 292e 6d65 616e 282d 3129 290d 0a0d  =0).mean(-1))...
-000109f0: 0a20 2020 2020 2020 2065 6420 3d20 6e70  .        ed = np
-00010a00: 2e73 7461 636b 285b 6461 7461 5b69 2c20  .stack([data[i, 
-00010a10: 742c 203a 5d20 666f 7220 6920 696e 2072  t, :] for i in r
-00010a20: 616e 6765 286e 295d 2c20 6178 6973 3d2d  ange(n)], axis=-
-00010a30: 3129 0d0a 2020 2020 2020 2020 6173 7365  1)..        asse
-00010a40: 7274 2065 642e 6e64 696d 3d3d 320d 0a20  rt ed.ndim==2.. 
-00010a50: 2020 2020 2020 2074 6f70 6f70 6c6f 7420         topoplot 
-00010a60: 3d20 7365 6c66 2e70 6c6f 745f 746f 706f  = self.plot_topo
-00010a70: 7328 6564 2c20 7365 6e73 6f72 5f6c 6179  s(ed, sensor_lay
-00010a80: 6f75 743d 7365 6e73 6f72 5f6c 6179 6f75  out=sensor_layou
-00010a90: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-00010aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ab0: 2020 2020 2020 2063 6c61 7373 5f73 7562         class_sub
-00010ac0: 7365 743d 636c 6173 735f 7375 6273 6574  set=class_subset
-00010ad0: 290d 0a0d 0a20 2020 2020 2020 2074 6f70  )....        top
-00010ae0: 6f70 6c6f 742e 6669 6775 7265 2e73 7570  oplot.figure.sup
-00010af0: 7469 746c 6528 7469 746c 6529 0d0a 2020  title(title)..  
-00010b00: 2020 2020 2020 746f 706f 706c 6f74 2e73        topoplot.s
-00010b10: 686f 7728 290d 0a20 2020 2020 2020 2072  how()..        r
-00010b20: 6574 7572 6e20 746f 706f 706c 6f74 0d0a  eturn topoplot..
-00010b30: 0d0a 0d0a 2020 2020 6465 6620 6d61 6b65  ....    def make
-00010b40: 5f66 616b 655f 6576 6f6b 6564 2873 656c  _fake_evoked(sel
-00010b50: 662c 2074 6f70 6f73 2c20 7365 6e73 6f72  f, topos, sensor
-00010b60: 5f6c 6179 6f75 7429 3a0d 0a20 2020 2020  _layout):..     
-00010b70: 2020 2069 6620 2769 6e66 6f27 206e 6f74     if 'info' not
-00010b80: 2069 6e20 7365 6c66 2e64 6174 6173 6574   in self.dataset
-00010b90: 2e68 5f70 6172 616d 732e 6b65 7973 2829  .h_params.keys()
-00010ba0: 3a0d 0a20 2020 2020 2020 2020 2020 206c  :..            l
-00010bb0: 6f20 3d20 6368 616e 6e65 6c73 2e72 6561  o = channels.rea
-00010bc0: 645f 6c61 796f 7574 2873 656e 736f 725f  d_layout(sensor_
-00010bd0: 6c61 796f 7574 290d 0a20 2020 2020 2020  layout)..       
-00010be0: 2020 2020 2023 6c6f 203d 2063 6861 6e6e       #lo = chann
-00010bf0: 656c 732e 6765 6e65 7261 7465 5f32 645f  els.generate_2d_
-00010c00: 6c61 796f 7574 286c 6f2e 706f 7329 0d0a  layout(lo.pos)..
-00010c10: 2020 2020 2020 2020 2020 2020 696e 666f              info
-00010c20: 203d 2063 7265 6174 655f 696e 666f 286c   = create_info(l
-00010c30: 6f2e 6e61 6d65 732c 2031 2e2c 2073 656e  o.names, 1., sen
-00010c40: 736f 725f 6c61 796f 7574 2e73 706c 6974  sor_layout.split
-00010c50: 2827 2d27 295b 2d31 5d29 0d0a 2020 2020  ('-')[-1])..    
-00010c60: 2020 2020 2020 2020 6f72 6967 5f78 7920          orig_xy 
-00010c70: 3d20 6e70 2e6d 6561 6e28 6c6f 2e70 6f73  = np.mean(lo.pos
-00010c80: 5b3a 2c20 3a32 5d2c 2030 290d 0a20 2020  [:, :2], 0)..   
-00010c90: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
-00010ca0: 6368 2069 6e20 656e 756d 6572 6174 6528  ch in enumerate(
-00010cb0: 6c6f 2e6e 616d 6573 293a 0d0a 2020 2020  lo.names):..    
-00010cc0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00010cd0: 6e66 6f5b 2763 6873 275d 5b69 5d5b 2763  nfo['chs'][i]['c
-00010ce0: 685f 6e61 6d65 275d 203d 3d20 6368 3a0d  h_name'] == ch:.
-00010cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010d00: 2020 2020 2069 6e66 6f5b 2763 6873 275d       info['chs']
-00010d10: 5b69 5d5b 276c 6f63 275d 5b3a 325d 203d  [i]['loc'][:2] =
-00010d20: 2028 6c6f 2e70 6f73 5b69 2c20 3a32 5d20   (lo.pos[i, :2] 
-00010d30: 2d20 6f72 6967 5f78 7929 2f34 2e35 0d0a  - orig_xy)/4.5..
-00010d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d50: 2020 2020 2369 6e66 6f5b 2763 6873 275d      #info['chs']
-00010d60: 5b69 5d5b 276c 6f63 275d 5b34 3a5d 203d  [i]['loc'][4:] =
-00010d70: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
-00010d80: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00010d90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00010da0: 7269 6e74 2822 4368 616e 6e65 6c20 6e61  rint("Channel na
-00010db0: 6d65 206d 6973 6d61 7463 682e 2069 6e66  me mismatch. inf
-00010dc0: 6f3a 207b 7d20 7673 206c 6f3a 207b 7d22  o: {} vs lo: {}"
-00010dd0: 2e66 6f72 6d61 7428 0d0a 2020 2020 2020  .format(..      
-00010de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010df0: 2020 696e 666f 5b27 6368 7327 5d5b 695d    info['chs'][i]
-00010e00: 5b27 6368 5f6e 616d 6527 5d2c 2063 6829  ['ch_name'], ch)
-00010e10: 290d 0a20 2020 2020 2020 2023 696e 666f  )..        #info
-00010e20: 5b27 7366 7265 7127 5d20 3d20 310d 0a20  ['sfreq'] = 1.. 
-00010e30: 2020 2020 2020 2066 616b 655f 6576 6f6b         fake_evok
-00010e40: 6564 203d 2065 766f 6b65 642e 4576 6f6b  ed = evoked.Evok
-00010e50: 6564 4172 7261 7928 746f 706f 732c 2069  edArray(topos, i
-00010e60: 6e66 6f29 0d0a 2020 2020 2020 2020 7265  nfo)..        re
-00010e70: 7475 726e 2066 616b 655f 6576 6f6b 6564  turn fake_evoked
-00010e80: 0d0a 0d0a 2020 2020 6465 6620 706c 6f74  ....    def plot
-00010e90: 5f74 6f70 6f73 2873 656c 662c 2074 6f70  _topos(self, top
-00010ea0: 6f73 2c20 7365 6e73 6f72 5f6c 6179 6f75  os, sensor_layou
-00010eb0: 743d 2756 6563 746f 7276 6965 772d 6d61  t='Vectorview-ma
-00010ec0: 6727 2c20 636c 6173 735f 7375 6273 6574  g', class_subset
-00010ed0: 3d4e 6f6e 6529 3a0d 0a20 2020 2020 2020  =None):..       
-00010ee0: 2022 2222 0d0a 2020 2020 2020 2020 506c   """..        Pl
-00010ef0: 6f74 2061 6e79 2073 7061 7469 616c 2064  ot any spatial d
-00010f00: 6973 7472 6962 7574 696f 6e20 696e 2074  istribution in t
-00010f10: 6865 2073 656e 736f 7220 7370 6163 652e  he sensor space.
-00010f20: 0d0a 2020 2020 2020 2020 544f 444f 3a20  ..        TODO: 
-00010f30: 496e 7465 7270 6f6c 6174 696f 6e3f 3f0d  Interpolation??.
-00010f40: 0a0d 0a0d 0a20 2020 2020 2020 2050 6172  .....        Par
-00010f50: 616d 6574 6572 730d 0a20 2020 2020 2020  ameters..       
-00010f60: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
-00010f70: 2020 2020 2074 6f70 6f73 203a 206e 702e       topos : np.
-00010f80: 6172 7261 790d 0a20 2020 2020 2020 2020  array..         
-00010f90: 2020 205b 6e5f 6368 2c20 6e5f 636c 6173     [n_ch, n_clas
-00010fa0: 7365 732c 202e 2e2e 5d0d 0a20 2020 2020  ses, ...]..     
-00010fb0: 2020 2073 656e 736f 725f 6c61 796f 7574     sensor_layout
-00010fc0: 203a 2054 5950 452c 206f 7074 696f 6e61   : TYPE, optiona
-00010fd0: 6c0d 0a20 2020 2020 2020 2020 2020 2044  l..            D
-00010fe0: 4553 4352 4950 5449 4f4e 2e20 5468 6520  ESCRIPTION. The 
-00010ff0: 6465 6661 756c 7420 6973 2027 5665 6374  default is 'Vect
-00011000: 6f72 7669 6577 2d6d 6167 272e 0d0a 2020  orview-mag'...  
-00011010: 2020 2020 2020 636c 6173 735f 7375 6273        class_subs
-00011020: 6574 2020 3a20 6e70 2e61 7272 6179 2c20  et  : np.array, 
-00011030: 6f70 7469 6f6e 616c 0d0a 0d0a 2020 2020  optional....    
-00011040: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
-00011050: 2020 2020 202d 2d2d 2d2d 2d2d 0d0a 2020       -------..  
-00011060: 2020 2020 2020 4e6f 6e65 2e0d 0a0d 0a20        None..... 
-00011070: 2020 2020 2020 2022 2222 0d0a 200d 0a20         """.. .. 
-00011080: 2020 2020 2020 2069 6620 746f 706f 732e         if topos.
-00011090: 6e64 696d 203e 2032 3a0d 0a20 2020 2020  ndim > 2:..     
-000110a0: 2020 2020 2020 2074 6f70 6f73 203d 2074         topos = t
-000110b0: 6f70 6f73 2e6d 6561 6e28 2d31 290d 0a20  opos.mean(-1).. 
-000110c0: 2020 2020 2020 2074 6f70 6f73 5f6e 6577         topos_new
-000110d0: 203d 2074 6f70 6f73 202f 2074 6f70 6f73   = topos / topos
-000110e0: 2e73 7464 2830 2c20 6b65 6570 6469 6d73  .std(0, keepdims
-000110f0: 3d54 7275 6529 0d0a 0d0a 2020 2020 2020  =True)....      
-00011100: 2020 6e20 3d20 746f 706f 732e 7368 6170    n = topos.shap
-00011110: 655b 315d 0d0a 0d0a 2020 2020 2020 2020  e[1]....        
-00011120: 6966 2063 6c61 7373 5f73 7562 7365 7420  if class_subset 
-00011130: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-00011140: 2020 2020 2020 636c 6173 735f 7375 6273        class_subs
-00011150: 6574 203d 206e 702e 6172 616e 6765 2830  et = np.arange(0
-00011160: 2c20 206e 2c20 312e 290d 0a0d 0a20 2020  ,  n, 1.)....   
-00011170: 2020 2020 2066 616b 655f 6576 6f6b 6564       fake_evoked
-00011180: 203d 2073 656c 662e 6d61 6b65 5f66 616b   = self.make_fak
-00011190: 655f 6576 6f6b 6564 2874 6f70 6f73 5f6e  e_evoked(topos_n
-000111a0: 6577 2c20 7365 6e73 6f72 5f6c 6179 6f75  ew, sensor_layou
-000111b0: 7429 0d0a 0d0a 2020 2020 2020 2020 6674  t)....        ft
-000111c0: 203d 2066 616b 655f 6576 6f6b 6564 2e70   = fake_evoked.p
-000111d0: 6c6f 745f 746f 706f 6d61 7028 7469 6d65  lot_topomap(time
-000111e0: 733d 636c 6173 735f 7375 6273 6574 2c0d  s=class_subset,.
-000111f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011210: 2020 2020 2063 6f6c 6f72 6261 723d 5472       colorbar=Tr
-00011220: 7565 2c0d 0a20 2020 2020 2020 2020 2020  ue,..           
-00011230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011240: 2020 2020 2020 2020 2073 6361 6c69 6e67           scaling
-00011250: 733d 312c 0d0a 2020 2020 2020 2020 2020  s=1,..          
-00011260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011270: 2020 2020 2020 2020 2020 7469 6d65 5f66            time_f
-00011280: 6f72 6d61 743d 2243 6c61 7373 2025 6722  ormat="Class %g"
-00011290: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000112a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112b0: 2020 2020 2020 206f 7574 6c69 6e65 733d         outlines=
-000112c0: 2768 6561 6427 2c0d 0a20 2020 2020 2020  'head',..       
-000112d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112e0: 2020 2020 2020 2020 2020 2020 2023 766c               #vl
-000112f0: 696d 3d20 6e70 2e70 6572 6365 6e74 696c  im= np.percentil
-00011300: 6528 746f 706f 732c 205b 352c 2039 355d  e(topos, [5, 95]
-00011310: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00011320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011330: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-00011340: 2020 2366 742e 7368 6f77 2829 0d0a 2020    #ft.show()..  
-00011350: 2020 2020 2020 7265 7475 726e 2066 740d        return ft.
-00011360: 0a0d 0a0d 0a20 2020 2064 6566 2065 7870  .....    def exp
-00011370: 6c6f 7265 5f63 6f6d 706f 6e65 6e74 7328  lore_components(
-00011380: 7365 6c66 2c20 7061 7474 6572 6e73 5f73  self, patterns_s
-00011390: 7472 7563 742c 2073 6f72 7469 6e67 3d27  truct, sorting='
-000113a0: 6f75 7470 7574 5f63 6f72 7227 2c0d 0a20  output_corr',.. 
-000113b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000113c0: 2020 2020 2020 2020 696e 7465 6772 6174          integrat
-000113d0: 653d 276d 6178 272c 2069 6e66 6f3d 4e6f  e='max', info=No
-000113e0: 6e65 2c20 7365 6e73 6f72 5f6c 6179 6f75  ne, sensor_layou
-000113f0: 743d 2756 6563 746f 7276 6965 772d 6d61  t='Vectorview-ma
-00011400: 6727 2c0d 0a20 2020 2020 2020 2020 2020  g',..           
-00011410: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-00011420: 6173 735f 6e61 6d65 733d 4e6f 6e65 293a  ass_names=None):
-00011430: 0d0a 2020 2020 2020 2020 2222 2250 6c6f  ..        """Plo
-00011440: 7473 2074 6865 2077 6569 6768 7473 206f  ts the weights o
-00011450: 6620 7468 6520 6f75 7470 7574 206c 6179  f the output lay
-00011460: 6572 2e0d 0a0d 0a20 2020 2020 2020 2050  er.....        P
-00011470: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
-00011480: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a0d     ----------...
-00011490: 0a20 2020 2020 2020 2070 6174 203a 2069  .        pat : i
-000114a0: 6e74 205b 302c 2073 656c 662e 7370 6563  nt [0, self.spec
-000114b0: 735b 276e 5f6c 6174 656e 7427 5d29 0d0a  s['n_latent'])..
-000114c0: 2020 2020 2020 2020 2020 2020 496e 6465              Inde
-000114d0: 7820 6f66 2074 6865 206c 6174 656e 7420  x of the latent 
-000114e0: 636f 6d70 6f6e 656e 7420 746f 2068 6967  component to hig
-000114f0: 6c69 6768 740d 0a0d 0a20 2020 2020 2020  light....       
-00011500: 2074 203a 2069 6e74 205b 302c 2073 656c   t : int [0, sel
-00011510: 662e 685f 7061 7261 6d73 5b27 6e5f 7427  f.h_params['n_t'
-00011520: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00011530: 496e 6465 7820 6f66 2074 696d 6570 6f69  Index of timepoi
-00011540: 6e74 2074 6f20 6869 6768 6c69 6768 740d  nt to highlight.
-00011550: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-00011560: 6e73 0d0a 2020 2020 2020 2020 2d2d 2d2d  ns..        ----
-00011570: 2d2d 2d0d 0a20 2020 2020 2020 2066 6967  ---..        fig
-00011580: 7572 6520 3a0d 0a20 2020 2020 2020 2020  ure :..         
-00011590: 2020 2049 6d73 686f 7720 5b6e 5f6c 6174     Imshow [n_lat
-000115a0: 656e 742c 2079 5f73 6861 7065 5d0d 0a0d  ent, y_shape]...
-000115b0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-000115c0: 2020 2020 2020 6465 6620 5f6f 6e63 6c69        def _oncli
-000115d0: 636b 5f63 6f6d 706f 6e65 6e74 2865 7665  ck_component(eve
-000115e0: 6e74 293a 0d0a 2020 2020 2020 2020 2020  nt):..          
-000115f0: 2020 636c 6173 735f 696e 6420 3d20 6e70    class_ind = np
-00011600: 2e6d 6178 696d 756d 286e 702e 726f 756e  .maximum(np.roun
-00011610: 6428 6576 656e 742e 7864 6174 612c 2030  d(event.xdata, 0
-00011620: 292e 6173 7479 7065 2869 6e74 292c 2030  ).astype(int), 0
-00011630: 290d 0a20 2020 2020 2020 2020 2020 2063  )..            c
-00011640: 6f6d 706f 6e65 6e74 5f69 6e64 203d 206e  omponent_ind = n
-00011650: 702e 6d61 7869 6d75 6d28 6e70 2e72 6f75  p.maximum(np.rou
-00011660: 6e64 2865 7665 6e74 2e79 6461 7461 292e  nd(event.ydata).
-00011670: 6173 7479 7065 2869 6e74 292c 2030 290d  astype(int), 0).
-00011680: 0a0d 0a0d 0a20 2020 2020 2020 2020 2020  .....           
-00011690: 2066 312c 2061 7820 3d20 706c 742e 7375   f1, ax = plt.su
-000116a0: 6270 6c6f 7473 2832 2c32 290d 0a20 2020  bplots(2,2)..   
-000116b0: 2020 2020 2020 2020 2066 312e 7365 745f           f1.set_
-000116c0: 6c61 796f 7574 5f65 6e67 696e 6528 2763  layout_engine('c
-000116d0: 6f6e 7374 7261 696e 6564 2729 0d0a 2020  onstrained')..  
-000116e0: 2020 2020 2020 2020 2020 6631 2e73 7570            f1.sup
-000116f0: 7469 746c 6528 2243 6c61 7373 3a20 7b7d  title("Class: {}
-00011700: 2020 436f 6d70 6f6e 656e 743a 207b 7d22    Component: {}"
-00011710: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011720: 2020 2020 2e66 6f72 6d61 7428 636c 6173      .format(clas
-00011730: 735f 696e 642c 2063 6f6d 706f 6e65 6e74  s_ind, component
-00011740: 5f69 6e64 2929 0d0a 0d0a 2020 2020 2020  _ind))....      
-00011750: 2020 2020 2020 6120 3d20 6e70 2e64 6f74        a = np.dot
-00011760: 2870 6174 7465 726e 735f 7374 7275 6374  (patterns_struct
-00011770: 5b27 6463 6f76 275d 5b27 636c 6173 735f  ['dcov']['class_
-00011780: 636f 6e64 6974 696f 6e61 6c27 5d5b 636c  conditional'][cl
-00011790: 6173 735f 696e 645d 2c0d 0a20 2020 2020  ass_ind],..     
-000117a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000117b0: 2020 7061 7474 6572 6e73 5f73 7472 7563    patterns_struc
-000117c0: 745b 2777 6569 6768 7473 275d 5b27 646d  t['weights']['dm
-000117d0: 7827 5d29 0d0a 0d0a 2020 2020 2020 2020  x'])....        
-000117e0: 2020 2020 7365 6c66 2e66 616b 655f 6576      self.fake_ev
-000117f0: 6f6b 6564 5f69 6e74 6572 6163 7469 7665  oked_interactive
-00011800: 2e64 6174 615b 3a2c 2063 6f6d 706f 6e65  .data[:, compone
-00011810: 6e74 5f69 6e64 5d20 3d20 615b 3a2c 2063  nt_ind] = a[:, c
-00011820: 6f6d 706f 6e65 6e74 5f69 6e64 5d0d 0a20  omponent_ind].. 
-00011830: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00011840: 6661 6b65 5f65 766f 6b65 645f 696e 7465  fake_evoked_inte
-00011850: 7261 6374 6976 652e 706c 6f74 5f74 6f70  ractive.plot_top
-00011860: 6f6d 6170 2874 696d 6573 3d5b 636f 6d70  omap(times=[comp
-00011870: 6f6e 656e 745f 696e 645d 2c0d 0a20 2020  onent_ind],..   
-00011880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118b0: 2020 2061 7865 733d 6178 5b30 2c20 305d     axes=ax[0, 0]
-000118c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000118d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118f0: 2020 2020 2020 2020 2063 6f6c 6f72 6261           colorba
-00011900: 723d 4661 6c73 652c 0d0a 2020 2020 2020  r=False,..      
-00011910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011940: 7469 6d65 5f66 6f72 6d61 743d 2753 7061  time_format='Spa
-00011950: 7469 616c 2061 6374 6976 6174 696f 6e20  tial activation 
-00011960: 7061 7474 6572 6e2c 205b 6175 5d27 0d0a  pattern, [au]'..
-00011970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119a0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000119b0: 2020 2020 2070 7364 203d 2070 7364 735b       psd = psds[
-000119c0: 636f 6d70 6f6e 656e 745f 696e 642c 203a  component_ind, :
-000119d0: 5d2e 540d 0a20 2020 2020 2020 2020 2020  ].T..           
-000119e0: 2066 7265 715f 7265 7370 6f6e 7365 203d   freq_response =
-000119f0: 2066 7265 715f 7265 7370 6f6e 7365 735b   freq_responses[
-00011a00: 636f 6d70 6f6e 656e 745f 696e 642c 203a  component_ind, :
-00011a10: 5d2e 540d 0a20 2020 2020 2020 2020 2020  ].T..           
-00011a20: 206f 7574 5f70 7364 203d 2070 7364 2a66   out_psd = psd*f
-00011a30: 7265 715f 7265 7370 6f6e 7365 0d0a 2020  req_response..  
-00011a40: 2020 2020 2020 2020 2020 7073 6420 2f3d            psd /=
-00011a50: 206e 702e 6d61 7869 6d75 6d28 6e70 2e73   np.maximum(np.s
-00011a60: 756d 2870 7364 292c 2031 652d 3929 0d0a  um(psd), 1e-9)..
-00011a70: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-00011a80: 7073 6420 2f3d 206e 702e 6d61 7869 6d75  psd /= np.maximu
-00011a90: 6d28 6e70 2e73 756d 286f 7574 5f70 7364  m(np.sum(out_psd
-00011aa0: 292c 2031 652d 3929 0d0a 2020 2020 2020  ), 1e-9)..      
-00011ab0: 2020 2020 2020 2366 7265 7120 2f3d 206e        #freq /= n
-00011ac0: 702e 6d61 7869 6d75 6d28 6e70 2e73 756d  p.maximum(np.sum
-00011ad0: 286f 7574 5f70 7364 292c 2031 652d 3929  (out_psd), 1e-9)
-00011ae0: 0d0a 2020 2020 2020 2020 2020 2020 2361  ..            #a
-00011af0: 785b 312c 5d2e 636c 6561 7228 290d 0a20  x[1,].clear().. 
-00011b00: 2020 2020 2020 2020 2020 2061 785b 302c             ax[0,
-00011b10: 315d 2e73 656d 696c 6f67 7928 7061 7474  1].semilogy(patt
-00011b20: 6572 6e73 5f73 7472 7563 745b 2773 7065  erns_struct['spe
-00011b30: 6374 7261 275d 5b27 6672 6571 7327 5d2c  ctra']['freqs'],
-00011b40: 2070 7364 2c0d 0a20 2020 2020 2020 2020   psd,..         
-00011b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b60: 6c61 6265 6c3d 2749 6e70 7574 2052 5053  label='Input RPS
-00011b70: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
-00011b80: 6178 5b30 2c31 5d2e 7365 6d69 6c6f 6779  ax[0,1].semilogy
-00011b90: 2870 6174 7465 726e 735f 7374 7275 6374  (patterns_struct
-00011ba0: 5b27 7370 6563 7472 6127 5d5b 2766 7265  ['spectra']['fre
-00011bb0: 7173 275d 2c20 6f75 745f 7073 642c 0d0a  qs'], out_psd,..
-00011bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011bd0: 2020 2020 2020 2020 206c 6162 656c 3d27           label='
-00011be0: 4f75 7470 7574 2052 5053 2729 0d0a 2020  Output RPS')..  
-00011bf0: 2020 2020 2020 2020 2020 2361 785b 302c            #ax[0,
-00011c00: 315d 2e73 656d 696c 6f67 7928 7061 7474  1].semilogy(patt
-00011c10: 6572 6e73 5f73 7472 7563 745b 2773 7065  erns_struct['spe
-00011c20: 6374 7261 275d 5b27 6672 6571 7327 5d2c  ctra']['freqs'],
-00011c30: 2066 7265 715f 7265 7370 6f6e 7365 2c0d   freq_response,.
-00011c40: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
-00011c50: 2020 2020 2020 2020 2020 206c 6162 656c             label
-00011c60: 3d27 4672 6571 5f72 6573 706f 6e73 6527  ='Freq_response'
-00011c70: 290d 0a20 2020 2020 2020 2020 2020 2061  )..            a
-00011c80: 785b 302c 315d 2e73 6574 5f78 6c69 6d28  x[0,1].set_xlim(
-00011c90: 312c 2031 3235 2e29 0d0a 2020 2020 2020  1, 125.)..      
-00011ca0: 2020 2020 2020 6178 5b30 2c31 5d2e 7365        ax[0,1].se
-00011cb0: 745f 796c 696d 2831 652d 362c 2031 2e29  t_ylim(1e-6, 1.)
-00011cc0: 0d0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
-00011cd0: 5b30 2c31 5d2e 6c65 6765 6e64 2866 7261  [0,1].legend(fra
-00011ce0: 6d65 6f6e 3d46 616c 7365 290d 0a20 2020  meon=False)..   
-00011cf0: 2020 2020 2020 2020 2061 785b 302c 315d           ax[0,1]
-00011d00: 2e73 6574 5f74 6974 6c65 2827 5265 6c61  .set_title('Rela
-00011d10: 7469 7665 2070 6f77 6572 2073 7065 6374  tive power spect
-00011d20: 7261 2729 0d0a 0d0a 0d0a 2020 2020 2020  ra')......      
-00011d30: 2020 2020 2020 6178 5b31 2c30 5d2e 7374        ax[1,0].st
-00011d40: 656d 2874 636f 6e76 5f6b 6572 6e65 6c73  em(tconv_kernels
-00011d50: 5b3a 2c20 636f 6d70 6f6e 656e 745f 696e  [:, component_in
-00011d60: 645d 290d 0a20 2020 2020 2020 2020 2020  d])..           
-00011d70: 2061 785b 312c 305d 2e73 6574 5f74 6974   ax[1,0].set_tit
-00011d80: 6c65 2827 5465 6d70 6f72 616c 2063 6f6e  le('Temporal con
-00011d90: 766f 6c75 7469 6f6e 206b 6572 6e65 6c20  volution kernel 
-00011da0: 636f 6566 6669 6369 656e 7473 2729 0d0a  coefficients')..
-00011db0: 0d0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
-00011dc0: 5b31 2c31 5d2e 706c 6f74 2846 5b63 6f6d  [1,1].plot(F[com
-00011dd0: 706f 6e65 6e74 5f69 6e64 2c20 3a5d 2c20  ponent_ind, :], 
-00011de0: 276b 7327 290d 0a20 2020 2020 2020 2020  'ks')..         
-00011df0: 2020 2061 785b 312c 315d 2e70 6c6f 7428     ax[1,1].plot(
-00011e00: 636c 6173 735f 696e 642c 2046 5b63 6f6d  class_ind, F[com
-00011e10: 706f 6e65 6e74 5f69 6e64 2c20 636c 6173  ponent_ind, clas
-00011e20: 735f 696e 645d 2c20 2772 7327 290d 0a20  s_ind], 'rs').. 
-00011e30: 2020 2020 2020 2020 2020 2061 785b 312c             ax[1,
-00011e40: 315d 2e73 6574 5f74 6974 6c65 2827 7b7d  1].set_title('{}
-00011e50: 2070 6572 2063 6c61 7373 2e20 5265 643d   per class. Red=
-00011e60: 7b7d 272e 666f 726d 6174 2873 6f72 7469  {}'.format(sorti
-00011e70: 6e67 2c20 636c 6173 735f 696e 6429 290d  ng, class_ind)).
-00011e80: 0a20 2020 2020 2020 2020 2020 2061 785b  .            ax[
-00011e90: 312c 315d 2e73 6574 5f78 6c61 6265 6c28  1,1].set_xlabel(
-00011ea0: 2243 6c61 7373 2229 0d0a 0d0a 0d0a 0d0a  "Class")........
-00011eb0: 2020 2020 2020 2020 6966 2073 6f72 7469          if sorti
-00011ec0: 6e67 203d 3d20 2777 6569 6768 7427 3a0d  ng == 'weight':.
-00011ed0: 0a20 2020 2020 2020 2020 2020 2046 203d  .            F =
-00011ee0: 2070 6174 7465 726e 735f 7374 7275 6374   patterns_struct
-00011ef0: 5b27 7765 6967 6874 7327 5d5b 276f 7574  ['weights']['out
-00011f00: 5f77 6569 6768 7473 275d 0d0a 2020 2020  _weights']..    
-00011f10: 2020 2020 656c 6966 2073 6f72 7469 6e67      elif sorting
-00011f20: 203d 3d20 276f 7574 7075 745f 636f 7272   == 'output_corr
-00011f30: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-00011f40: 4620 3d20 7061 7474 6572 6e73 5f73 7472  F = patterns_str
-00011f50: 7563 745b 2763 6f72 725f 746f 5f6f 7574  uct['corr_to_out
-00011f60: 7075 7427 5d0d 0a20 2020 2020 2020 2065  put']..        e
-00011f70: 6c69 6620 736f 7274 696e 6720 3d3d 2027  lif sorting == '
-00011f80: 636f 6d70 7769 7365 5f6c 6f73 7327 3a0d  compwise_loss':.
-00011f90: 0a20 2020 2020 2020 2020 2020 2046 203d  .            F =
-00011fa0: 2070 6174 7465 726e 735f 7374 7275 6374   patterns_struct
-00011fb0: 5b27 636f 6d70 7769 7365 5f6c 6f73 7327  ['compwise_loss'
-00011fc0: 5d0d 0a20 2020 2020 2020 2069 6620 736f  ]..        if so
-00011fd0: 7274 696e 6720 3d3d 2027 7765 6967 6874  rting == 'weight
-00011fe0: 5f63 6f72 7227 3a0d 0a20 2020 2020 2020  _corr':..       
-00011ff0: 2020 2020 2046 203d 2070 6174 7465 726e       F = pattern
-00012000: 735f 7374 7275 6374 5b27 7765 6967 6874  s_struct['weight
-00012010: 7327 5d5b 276f 7574 5f77 6569 6768 7473  s']['out_weights
-00012020: 275d 202a 2070 6174 7465 726e 735f 7374  '] * patterns_st
-00012030: 7275 6374 5b27 636f 7272 5f74 6f5f 6f75  ruct['corr_to_ou
-00012040: 7470 7574 275d 0d0a 0d0a 0d0a 2020 2020  tput']......    
-00012050: 2020 2020 6966 2069 6e74 6567 7261 7465      if integrate
-00012060: 2069 6e20 276d 6178 273a 0d0a 2020 2020   in 'max':..    
-00012070: 2020 2020 2020 2020 6966 2046 2e6e 6469          if F.ndi
-00012080: 6d20 3d3d 333a 0d0a 2020 2020 2020 2020  m ==3:..        
-00012090: 2020 2020 2020 2020 4620 3d20 462e 6d61          F = F.ma
-000120a0: 7828 3029 0d0a 2020 2020 2020 2020 2020  x(0)..          
-000120b0: 2020 696e 6473 203d 206e 702e 6172 676d    inds = np.argm
-000120c0: 6178 2846 2c20 3029 0d0a 0d0a 0d0a 0d0a  ax(F, 0)........
-000120d0: 2020 2020 2020 2020 2370 7364 7320 3d20          #psds = 
-000120e0: 7061 7474 6572 6e73 5f73 7472 7563 745b  patterns_struct[
-000120f0: 2773 7065 6374 7261 275d 5b27 7073 6473  'spectra']['psds
-00012100: 275d 0d0a 2020 2020 2020 2020 746f 706f  ']..        topo
-00012110: 7320 3d20 6e70 2e64 6f74 2870 6174 7465  s = np.dot(patte
-00012120: 726e 735f 7374 7275 6374 5b27 6463 6f76  rns_struct['dcov
-00012130: 275d 5b27 696e 7075 745f 7370 6174 6961  ']['input_spatia
-00012140: 6c27 5d2c 0d0a 2020 2020 2020 2020 2020  l'],..          
-00012150: 2020 2020 2020 2020 2020 2020 2070 6174               pat
-00012160: 7465 726e 735f 7374 7275 6374 5b27 7765  terns_struct['we
-00012170: 6967 6874 7327 5d5b 2764 6d78 275d 290d  ights']['dmx']).
-00012180: 0a20 2020 2020 2020 2070 7364 7320 3d20  .        psds = 
-00012190: 7061 7474 6572 6e73 5f73 7472 7563 745b  patterns_struct[
-000121a0: 2773 7065 6374 7261 275d 5b27 7073 6473  'spectra']['psds
-000121b0: 275d 0d0a 2020 2020 2020 2020 6672 6571  ']..        freq
-000121c0: 5f72 6573 706f 6e73 6573 203d 2070 6174  _responses = pat
-000121d0: 7465 726e 735f 7374 7275 6374 5b27 7370  terns_struct['sp
-000121e0: 6563 7472 6127 5d5b 2766 7265 715f 7265  ectra']['freq_re
-000121f0: 7370 6f6e 7365 7327 5d0d 0a20 2020 2020  sponses']..     
-00012200: 2020 2074 636f 6e76 5f6b 6572 6e65 6c73     tconv_kernels
-00012210: 203d 2070 6174 7465 726e 735f 7374 7275   = patterns_stru
-00012220: 6374 5b27 7765 6967 6874 7327 5d5b 2774  ct['weights']['t
-00012230: 636f 6e76 275d 0d0a 2020 2020 2020 2020  conv']..        
-00012240: 7365 6c66 2e66 616b 655f 6576 6f6b 6564  self.fake_evoked
-00012250: 5f69 6e74 6572 6163 7469 7665 203d 2073  _interactive = s
-00012260: 656c 662e 6d61 6b65 5f66 616b 655f 6576  elf.make_fake_ev
-00012270: 6f6b 6564 2874 6f70 6f73 2c20 7365 6e73  oked(topos, sens
-00012280: 6f72 5f6c 6179 6f75 7429 0d0a 0d0a 2020  or_layout)....  
-00012290: 2020 2020 2020 766d 696e 203d 206e 702e        vmin = np.
-000122a0: 6d69 6e28 4629 0d0a 2020 2020 2020 2020  min(F)..        
-000122b0: 766d 6178 203d 206e 702e 6d61 7828 4629  vmax = np.max(F)
-000122c0: 0d0a 0d0a 2020 2020 2020 2020 6620 3d20  ....        f = 
-000122d0: 706c 742e 6669 6775 7265 2829 0d0a 2020  plt.figure()..  
-000122e0: 2020 2020 2020 6178 203d 2066 2e67 6361        ax = f.gca
-000122f0: 2829 0d0a 0d0a 2020 2020 2020 2020 696d  ()....        im
-00012300: 203d 2061 782e 696d 7368 6f77 2846 2c20   = ax.imshow(F, 
-00012310: 636d 6170 3d27 626f 6e65 5f72 272c 2076  cmap='bone_r', v
-00012320: 6d69 6e3d 766d 696e 2c20 766d 6178 3d76  min=vmin, vmax=v
-00012330: 6d61 7829 0d0a 0d0a 2020 2020 2020 2020  max)....        
-00012340: 7220 3d20 5b70 7463 682e 5265 6374 616e  r = [ptch.Rectan
-00012350: 676c 6528 2869 202d 202e 352c 2069 6e64  gle((i - .5, ind
-00012360: 202d 202e 3529 2c20 7769 6474 683d 312c   - .5), width=1,
-00012370: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012380: 2020 2020 2020 2020 2020 2020 2020 6865                he
-00012390: 6967 6874 3d31 2c20 616e 676c 653d 302e  ight=1, angle=0.
-000123a0: 302c 2066 6163 6563 6f6c 6f72 3d27 6e6f  0, facecolor='no
-000123b0: 6e65 2729 2066 6f72 2069 2c20 696e 6420  ne') for i, ind 
-000123c0: 696e 2065 6e75 6d65 7261 7465 2869 6e64  in enumerate(ind
-000123d0: 7329 5d0d 0a0d 0a20 2020 2020 2020 2070  s)]....        p
-000123e0: 6320 3d20 636f 6c6c 6563 7469 6f6e 732e  c = collections.
-000123f0: 5061 7463 6843 6f6c 6c65 6374 696f 6e28  PatchCollection(
-00012400: 722c 2066 6163 6563 6f6c 6f72 3d27 6e6f  r, facecolor='no
-00012410: 6e65 272c 2061 6c70 6861 3d2e 352c 0d0a  ne', alpha=.5,..
-00012420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012440: 2020 2020 2020 2020 2020 6564 6765 636f            edgeco
-00012450: 6c6f 723d 2772 6564 2729 0d0a 2020 2020  lor='red')..    
-00012460: 2020 2020 2361 7820 3d20 662e 6763 6128      #ax = f.gca(
-00012470: 290d 0a20 2020 2020 2020 2061 782e 6164  )..        ax.ad
-00012480: 645f 636f 6c6c 6563 7469 6f6e 2870 6329  d_collection(pc)
-00012490: 0d0a 2020 2020 2020 2020 6178 2e73 6574  ..        ax.set
-000124a0: 5f79 6c61 6265 6c28 2743 6f6d 706f 6e65  _ylabel('Compone
-000124b0: 6e74 2729 0d0a 2020 2020 2020 2020 6178  nt')..        ax
-000124c0: 2e73 6574 5f78 6c61 6265 6c28 2743 6c61  .set_xlabel('Cla
-000124d0: 7373 2729 0d0a 2020 2020 2020 2020 6178  ss')..        ax
-000124e0: 2e73 6574 5f74 6974 6c65 2827 436f 6d70  .set_title('Comp
-000124f0: 6f6e 656e 7420 7265 6c65 7661 6e63 6520  onent relevance 
-00012500: 6d61 703a 205b 7b7d 5d20 2843 6c69 636b  map: [{}] (Click
-00012510: 6162 6c65 2927 2e66 6f72 6d61 7428 736f  able)'.format(so
-00012520: 7274 696e 6729 290d 0a0d 0a20 2020 2020  rting))....     
-00012530: 2020 2066 2e63 6f6c 6f72 6261 7228 696d     f.colorbar(im
-00012540: 290d 0a20 2020 2020 2020 2066 2e63 616e  )..        f.can
-00012550: 7661 732e 6d70 6c5f 636f 6e6e 6563 7428  vas.mpl_connect(
-00012560: 2762 7574 746f 6e5f 7072 6573 735f 6576  'button_press_ev
-00012570: 656e 7427 2c20 5f6f 6e63 6c69 636b 5f63  ent', _onclick_c
-00012580: 6f6d 706f 6e65 6e74 290d 0a20 2020 2020  omponent)..     
-00012590: 2020 2066 2e73 686f 7728 290d 0a20 2020     f.show()..   
-000125a0: 2020 2020 2072 6574 7572 6e20 660d 0a0d       return f...
-000125b0: 0a0d 0a0d 0a0d 0a20 2020 2064 6566 2070  .......    def p
-000125c0: 6c6f 745f 7761 7665 666f 726d 7328 7365  lot_waveforms(se
-000125d0: 6c66 2c20 7061 7474 6572 6e73 5f73 7472  lf, patterns_str
-000125e0: 7563 742c 2073 6f72 7469 6e67 3d27 636f  uct, sorting='co
-000125f0: 6d70 7769 7365 5f6c 6f73 7327 2c20 746d  mpwise_loss', tm
-00012600: 696e 3d30 2c20 636c 6173 735f 6e61 6d65  in=0, class_name
-00012610: 733d 4e6f 6e65 2c0d 0a20 2020 2020 2020  s=None,..       
-00012620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012630: 6270 5f66 696c 7465 723d 4661 6c73 652c  bp_filter=False,
-00012640: 2074 6c69 6d3d 4e6f 6e65 2c20 6170 706c   tlim=None, appl
-00012650: 795f 6b65 726e 656c 733d 4661 6c73 6529  y_kernels=False)
-00012660: 3a0d 0a20 2020 2020 2020 2022 2222 506c  :..        """Pl
-00012670: 6f74 7320 7469 6d65 636f 7572 7365 7320  ots timecourses 
-00012680: 6f66 206c 6174 656e 7420 636f 6d70 6f6e  of latent compon
-00012690: 656e 7473 2e0d 0a0d 0a20 2020 2020 2020  ents.....       
-000126a0: 2050 6172 616d 6574 6572 730d 0a20 2020   Parameters..   
-000126b0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d       ----------.
-000126c0: 0a20 2020 2020 2020 2074 6d69 6e20 3a20  .        tmin : 
-000126d0: 666c 6f61 740d 0a20 2020 2020 2020 2020  float..         
-000126e0: 2020 2042 6567 696e 6e69 6e67 206f 6620     Beginning of 
-000126f0: 7468 6520 4d45 4720 6570 6f63 6820 7769  the MEG epoch wi
-00012700: 7468 2072 6567 6172 6420 746f 2072 6566  th regard to ref
-00012710: 6572 656e 6365 2065 7665 6e74 2e0d 0a20  erence event... 
-00012720: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
-00012730: 6c74 7320 746f 2030 2e0d 0a0d 0a0d 0a20  lts to 0....... 
-00012740: 2020 2020 2020 2073 6f72 7469 6e67 203a         sorting :
-00012750: 2073 7472 0d0a 2020 2020 2020 2020 2020   str..          
-00012760: 2020 6865 7572 6973 7469 6320 666f 7220    heuristic for 
-00012770: 7365 6c65 6374 696e 6720 7265 6c65 7661  selecting releva
-00012780: 6e74 2063 6f6d 706f 6e65 6e74 732e 2053  nt components. S
-00012790: 6565 204c 4643 4e4e 2e5f 736f 7274 696e  ee LFCNN._sortin
-000127a0: 670d 0a20 2020 2020 2020 2022 2222 0d0a  g..        """..
-000127b0: 2020 2020 2020 2020 2369 6620 6e6f 7420          #if not 
-000127c0: 6861 7361 7474 7228 7365 6c66 2c20 2777  hasattr(self, 'w
-000127d0: 6176 6566 6f72 6d73 2729 3a0d 0a20 2020  aveforms'):..   
-000127e0: 2020 2020 2023 2020 2020 7365 6c66 2e63       #    self.c
-000127f0: 6f6d 7075 7465 5f70 6174 7465 726e 7328  ompute_patterns(
-00012800: 7365 6c66 2e64 6174 6173 6574 290d 0a0d  self.dataset)...
-00012810: 0a20 2020 2020 2020 2023 6966 206e 6f74  .        #if not
-00012820: 2068 6173 6174 7472 2873 656c 662c 2027   hasattr(self, '
-00012830: 756f 7264 6572 2729 3a0d 0a20 2020 2020  uorder'):..     
-00012840: 2020 206f 7264 6572 2c20 5f20 3d20 7365     order, _ = se
-00012850: 6c66 2e5f 736f 7274 696e 6728 7061 7474  lf._sorting(patt
-00012860: 6572 6e73 5f73 7472 7563 742c 2073 6f72  erns_struct, sor
-00012870: 7469 6e67 290d 0a20 2020 2020 2020 2073  ting)..        s
-00012880: 656c 662e 756f 7264 6572 203d 206f 7264  elf.uorder = ord
-00012890: 6572 2e72 6176 656c 2829 0d0a 2020 2020  er.ravel()..    
-000128a0: 2020 2020 7761 7665 666f 726d 7320 3d20      waveforms = 
-000128b0: 7061 7474 6572 6e73 5f73 7472 7563 745b  patterns_struct[
-000128c0: 2763 636d 7327 5d5b 2774 636f 6e76 275d  'ccms']['tconv']
-000128d0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000128e0: 2373 656c 662e 756f 7264 6572 203d 206e  #self.uorder = n
-000128f0: 702e 7371 7565 657a 6528 6f72 6465 7229  p.squeeze(order)
-00012900: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
-00012910: 7365 6c66 2e75 6f72 6465 7229 0d0a 2020  self.uorder)..  
-00012920: 2020 2020 2020 6966 206e 6f74 2063 6c61        if not cla
-00012930: 7373 5f6e 616d 6573 3a0d 0a20 2020 2020  ss_names:..     
-00012940: 2020 2020 2020 2063 6c61 7373 5f6e 616d         class_nam
-00012950: 6573 203d 205b 2243 6c61 7373 207b 7d22  es = ["Class {}"
-00012960: 2e66 6f72 6d61 7428 6929 2066 6f72 2069  .format(i) for i
-00012970: 2069 6e20 7261 6e67 6528 7365 6c66 2e79   in range(self.y
-00012980: 5f73 6861 7065 5b2d 315d 295d 0d0a 0d0a  _shape[-1])]....
-00012990: 2020 2020 2020 2020 662c 2061 7820 3d20          f, ax = 
-000129a0: 706c 742e 7375 6270 6c6f 7473 2832 2c20  plt.subplots(2, 
-000129b0: 3229 0d0a 2020 2020 2020 2020 662e 7365  2)..        f.se
-000129c0: 745f 7369 7a65 5f69 6e63 6865 7328 5b31  t_size_inches([1
-000129d0: 362c 2031 365d 290d 0a20 2020 2020 2020  6, 16])..       
-000129e0: 2069 6620 6e70 2e61 6e79 2873 656c 662e   if np.any(self.
-000129f0: 756f 7264 6572 293a 0d0a 2020 2020 2020  uorder):..      
-00012a00: 2020 2020 2020 2366 6f72 206a 6a2c 2075        #for jj, u
-00012a10: 6f20 696e 2065 6e75 6d65 7261 7465 2873  o in enumerate(s
-00012a20: 656c 662e 756f 7264 6572 293a 0d0a 2020  elf.uorder):..  
-00012a30: 2020 2020 2020 2020 2020 6e74 203d 2073            nt = s
-00012a40: 656c 662e 6461 7461 7365 742e 685f 7061  elf.dataset.h_pa
-00012a50: 7261 6d73 5b27 6e5f 7427 5d0d 0a0d 0a20  rams['n_t'].... 
-00012a60: 2020 2020 2020 2020 2020 2074 7374 6570             tstep
-00012a70: 203d 2031 2f66 6c6f 6174 2873 656c 662e   = 1/float(self.
-00012a80: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
-00012a90: 5b27 6673 275d 290d 0a20 2020 2020 2020  ['fs'])..       
-00012aa0: 2020 2020 2074 696d 6573 203d 2074 6d69       times = tmi
-00012ab0: 6e20 2b20 7473 7465 702a 6e70 2e61 7261  n + tstep*np.ara
-00012ac0: 6e67 6528 6e74 290d 0a20 2020 2020 2020  nge(nt)..       
-00012ad0: 2020 2020 2069 6620 6170 706c 795f 6b65       if apply_ke
-00012ae0: 726e 656c 733a 0d0a 2020 2020 2020 2020  rnels:..        
-00012af0: 2020 2020 2020 2020 7363 616c 6564 5f77          scaled_w
-00012b00: 6176 6566 6f72 6d73 203d 206e 702e 6172  aveforms = np.ar
-00012b10: 7261 7928 5b6e 702e 636f 6e76 6f6c 7665  ray([np.convolve
-00012b20: 286b 6572 6e2c 2077 662c 2027 7361 6d65  (kern, wf, 'same
-00012b30: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
-00012b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b50: 666f 7220 6b65 726e 2c20 7766 2069 6e20  for kern, wf in 
-00012b60: 7a69 7028 7365 6c66 2e66 696c 7465 7273  zip(self.filters
-00012b70: 2c20 7365 6c66 2e77 6176 6566 6f72 6d73  , self.waveforms
-00012b80: 295d 290d 0a20 2020 2020 2020 2020 2020  )])..           
-00012b90: 2020 2020 2023 7363 616c 6564 5f77 6176       #scaled_wav
-00012ba0: 6566 6f72 6d73 203d 2873 6361 6c65 645f  eforms =(scaled_
-00012bb0: 7761 7665 666f 726d 7320 2d20 7363 616c  waveforms - scal
-00012bc0: 6564 5f77 6176 6566 6f72 6d73 2e6d 6561  ed_waveforms.mea
-00012bd0: 6e28 2d31 2c20 6b65 6570 6469 6d73 3d54  n(-1, keepdims=T
-00012be0: 7275 6529 2920 202f 2028 322a 7363 616c  rue))  / (2*scal
-00012bf0: 6564 5f77 6176 6566 6f72 6d73 2e73 7464  ed_waveforms.std
-00012c00: 282d 312c 206b 6565 7064 696d 733d 5472  (-1, keepdims=Tr
-00012c10: 7565 2929 0d0a 2020 2020 2020 2020 2020  ue))..          
-00012c20: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00012c30: 2020 2020 2020 2020 2023 7363 616c 696e           #scalin
-00012c40: 6720 3d20 332a 6e70 2e6d 6561 6e28 6e70  g = 3*np.mean(np
-00012c50: 2e73 7464 2873 656c 662e 7761 7665 666f  .std(self.wavefo
-00012c60: 726d 732c 202d 3129 290d 0a0d 0a20 2020  rms, -1))....   
-00012c70: 2020 2020 2020 2020 2020 2020 2073 6361               sca
-00012c80: 6c65 645f 7761 7665 666f 726d 7320 3d20  led_waveforms = 
-00012c90: 2877 6176 6566 6f72 6d73 202d 2077 6176  (waveforms - wav
-00012ca0: 6566 6f72 6d73 2e6d 6561 6e28 2d31 2c20  eforms.mean(-1, 
-00012cb0: 6b65 6570 6469 6d73 3d54 7275 6529 2920  keepdims=True)) 
-00012cc0: 202f 2028 322a 7761 7665 666f 726d 732e   / (2*waveforms.
-00012cd0: 7374 6428 2d31 2c20 6b65 6570 6469 6d73  std(-1, keepdims
-00012ce0: 3d54 7275 6529 290d 0a20 2020 2020 2020  =True))..       
-00012cf0: 2020 2020 2069 6620 6270 5f66 696c 7465       if bp_filte
-00012d00: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-00012d10: 2020 2020 7363 616c 6564 5f77 6176 6566      scaled_wavef
-00012d20: 6f72 6d73 203d 2073 6361 6c65 645f 7761  orms = scaled_wa
-00012d30: 7665 666f 726d 732e 6173 7479 7065 286e  veforms.astype(n
-00012d40: 702e 666c 6f61 7436 3429 0d0a 2020 2020  p.float64)..    
-00012d50: 2020 2020 2020 2020 2020 2020 7363 616c              scal
-00012d60: 6564 5f77 6176 6566 6f72 6d73 203d 2066  ed_waveforms = f
-00012d70: 696c 7465 725f 6461 7461 2873 6361 6c65  ilter_data(scale
-00012d80: 645f 7761 7665 666f 726d 732c 0d0a 2020  d_waveforms,..  
-00012d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012dc0: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
-00012dd0: 6172 616d 735b 2766 7327 5d2c 0d0a 2020  arams['fs'],..  
-00012de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e10: 6c5f 6672 6571 3d62 705f 6669 6c74 6572  l_freq=bp_filter
-00012e20: 5b30 5d2c 0d0a 2020 2020 2020 2020 2020  [0],..          
-00012e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e50: 2020 2020 2020 2020 685f 6672 6571 3d62          h_freq=b
-00012e60: 705f 6669 6c74 6572 5b31 5d2c 0d0a 2020  p_filter[1],..  
-00012e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ea0: 6d65 7468 6f64 3d27 6969 7227 2c0d 0a20  method='iir',.. 
-00012eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ee0: 2076 6572 626f 7365 3d46 616c 7365 290d   verbose=False).
-00012ef0: 0a20 2020 2020 2020 2020 2020 205b 6178  .            [ax
-00012f00: 5b30 2c20 305d 2e70 6c6f 7428 7469 6d65  [0, 0].plot(time
-00012f10: 732c 2077 662c 2063 6f6c 6f72 3d27 7461  s, wf, color='ta
-00012f20: 623a 6772 6579 272c 2061 6c70 6861 3d2e  b:grey', alpha=.
-00012f30: 3235 290d 0a20 2020 2020 2020 2020 2020  25)..           
-00012f40: 2020 666f 7220 692c 2077 6620 696e 2065    for i, wf in e
-00012f50: 6e75 6d65 7261 7465 2873 6361 6c65 645f  numerate(scaled_
-00012f60: 7761 7665 666f 726d 7329 2069 6620 6920  waveforms) if i 
-00012f70: 6e6f 7420 696e 2073 656c 662e 756f 7264  not in self.uord
-00012f80: 6572 5d0d 0a0d 0a20 2020 2020 2020 2020  er]....         
-00012f90: 2020 205b 6178 5b30 2c20 305d 2e70 6c6f     [ax[0, 0].plo
-00012fa0: 7428 7469 6d65 732c 0d0a 2020 2020 2020  t(times,..      
-00012fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fc0: 2020 2020 7363 616c 6564 5f77 6176 6566      scaled_wavef
-00012fd0: 6f72 6d73 5b75 6f5d 2c0d 0a20 2020 2020  orms[uo],..     
-00012fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ff0: 2020 2020 206c 696e 6577 6964 7468 3d32       linewidth=2
-00013000: 2e2c 206c 6162 656c 3d63 6c61 7373 5f6e  ., label=class_n
-00013010: 616d 6573 5b69 5d2c 2061 6c70 6861 3d2e  ames[i], alpha=.
-00013020: 3735 290d 0a20 2020 2020 2020 2020 2020  75)..           
-00013030: 2020 666f 7220 692c 2075 6f20 696e 2065    for i, uo in e
-00013040: 6e75 6d65 7261 7465 2873 656c 662e 756f  numerate(self.uo
-00013050: 7264 6572 295d 0d0a 2020 2020 2020 2020  rder)]..        
-00013060: 2020 2020 6178 5b30 2c20 305d 2e73 6574      ax[0, 0].set
-00013070: 5f74 6974 6c65 2827 4c61 7465 6e74 2063  _title('Latent c
-00013080: 6f6d 706f 6e65 6e74 2077 6176 6566 6f72  omponent wavefor
-00013090: 6d73 2729 0d0a 2020 2020 2020 2020 2020  ms')..          
-000130a0: 2020 6966 2074 6c69 6d3a 0d0a 2020 2020    if tlim:..    
-000130b0: 2020 2020 2020 2020 2020 2020 6178 5b30              ax[0
-000130c0: 2c20 305d 2e73 6574 5f78 6c69 6d28 746c  , 0].set_xlim(tl
-000130d0: 696d 290d 0a0d 0a20 2020 2020 2020 2020  im)....         
-000130e0: 2020 2074 7374 6570 203d 2066 6c6f 6174     tstep = float
-000130f0: 2873 656c 662e 7370 6563 735b 2773 7472  (self.specs['str
-00013100: 6964 6527 5d29 2f73 656c 662e 6461 7461  ide'])/self.data
-00013110: 7365 742e 685f 7061 7261 6d73 5b27 6673  set.h_params['fs
-00013120: 275d 0d0a 2020 2020 2020 2020 2020 2020  ']..            
-00013130: 7374 7269 6465 7331 203d 206e 702e 6172  strides1 = np.ar
-00013140: 616e 6765 2874 696d 6573 5b30 5d2c 2074  ange(times[0], t
-00013150: 696d 6573 5b2d 315d 202b 2074 7374 6570  imes[-1] + tstep
-00013160: 2f32 2c20 7473 7465 7029 0d0a 2020 2020  /2, tstep)..    
-00013170: 2020 2020 2020 2020 6178 5b31 2c20 305d          ax[1, 0]
-00013180: 2e70 636f 6c6f 7228 7374 7269 6465 7331  .pcolor(strides1
-00013190: 2c20 6e70 2e61 7261 6e67 6528 7365 6c66  , np.arange(self
-000131a0: 2e73 7065 6373 5b27 6e5f 6c61 7465 6e74  .specs['n_latent
-000131b0: 275d 292c 0d0a 2020 2020 2020 2020 2020  ']),..          
-000131c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000131d0: 206e 702e 6d65 616e 2873 656c 662e 7463   np.mean(self.tc
-000131e0: 5f6f 7574 2c20 3029 2e54 2c20 2373 6861  _out, 0).T, #sha
-000131f0: 6469 6e67 3d27 6175 746f 270d 0a20 2020  ding='auto'..   
-00013200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013210: 2020 2020 2020 2020 290d 0a23 2020 2020          )..#    
-00013220: 2020 2020 2020 2020 7463 6f75 7420 3d20          tcout = 
-00013230: 6e70 2e6d 6561 6e28 7365 6c66 2e74 635f  np.mean(self.tc_
-00013240: 6f75 745f 756e 706f 6f6c 6564 2c30 292e  out_unpooled,0).
-00013250: 5420 2d20 7365 6c66 2e74 5f63 6f6e 765f  T - self.t_conv_
-00013260: 6269 6173 6573 5b3a 2c20 4e6f 6e65 5d0d  biases[:, None].
-00013270: 0a23 2020 2020 2020 2020 2020 2020 5b61  .#            [a
-00013280: 785b 312c 2030 5d2e 706c 6f74 2874 696d  x[1, 0].plot(tim
-00013290: 6573 2c20 7463 6f75 7469 2c20 636f 6c6f  es, tcouti, colo
-000132a0: 723d 2774 6162 3a67 7265 7927 2c20 616c  r='tab:grey', al
-000132b0: 7068 613d 2e32 3529 0d0a 2320 2020 2020  pha=.25)..#     
-000132c0: 2020 2020 2020 2066 6f72 2069 2c20 7463         for i, tc
-000132d0: 6f75 7469 2069 6e20 656e 756d 6572 6174  outi in enumerat
-000132e0: 6528 7463 6f75 7429 2069 6620 6920 6e6f  e(tcout) if i no
-000132f0: 7420 696e 2073 656c 662e 756f 7264 6572  t in self.uorder
-00013300: 5d0d 0a0d 0a23 2020 2020 2020 2020 2020  ]....#          
-00013310: 2020 5b61 785b 312c 2030 5d2e 706c 6f74    [ax[1, 0].plot
-00013320: 2874 696d 6573 2c20 7463 6f75 745b 756f  (times, tcout[uo
-00013330: 5d29 2066 6f72 2069 2c20 756f 2069 6e20  ]) for i, uo in 
-00013340: 656e 756d 6572 6174 6528 7365 6c66 2e75  enumerate(self.u
-00013350: 6f72 6465 7229 5d0d 0a20 2020 2020 2020  order)]..       
-00013360: 2020 2020 2061 785b 312c 2030 5d2e 7365       ax[1, 0].se
-00013370: 745f 7469 746c 6528 2241 7667 2e20 5465  t_title("Avg. Te
-00013380: 6d70 6f72 616c 2043 6f6e 766f 6c75 7469  mporal Convoluti
-00013390: 6f6e 204f 7574 7075 7422 290d 0a20 2020  on Output")..   
-000133a0: 2020 2020 2020 2020 2061 785b 312c 2030           ax[1, 0
-000133b0: 5d2e 7365 745f 796c 6162 656c 2822 436f  ].set_ylabel("Co
-000133c0: 6d70 6f6e 656e 7420 696e 6465 7822 290d  mponent index").
-000133d0: 0a20 2020 2020 2020 2020 2020 2061 785b  .            ax[
-000133e0: 312c 2030 5d2e 7365 745f 786c 6162 656c  1, 0].set_xlabel
-000133f0: 2822 5469 6d65 2c20 7322 290d 0a20 2020  ("Time, s")..   
-00013400: 2020 2020 2020 2020 2069 6620 746c 696d           if tlim
-00013410: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00013420: 2020 2061 785b 312c 2030 5d2e 7365 745f     ax[1, 0].set_
-00013430: 786c 696d 2874 6c69 6d29 0d0a 2020 2020  xlim(tlim)..    
-00013440: 2020 2020 2020 2020 6966 206e 6f74 2068          if not h
-00013450: 6173 6174 7472 2873 656c 662c 2027 7061  asattr(self, 'pa
-00013460: 7474 6572 6e5f 7765 6967 6874 7327 293a  ttern_weights'):
+0000f100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f120: 2020 2020 2020 2020 6e5f 666f 6c64 735d          n_folds]
+0000f130: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000f140: 2020 2073 656c 662e 6376 5f70 6174 7465     self.cv_patte
+0000f150: 726e 735b 6d65 7468 6f64 5d5b 2774 656d  rns[method]['tem
+0000f160: 706f 7261 6c27 5d20 3d20 6e70 2e7a 6572  poral'] = np.zer
+0000f170: 6f73 285b 7365 6c66 2e6e 6666 742c 0d0a  os([self.nfft,..
+0000f180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1c0: 2073 656c 662e 795f 7368 6170 655b 305d   self.y_shape[0]
+0000f1d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000f1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f210: 2020 2020 6e5f 666f 6c64 735d 290d 0a20      n_folds]).. 
+0000f220: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000f230: 656c 662e 6376 5f70 6174 7465 726e 735b  elf.cv_patterns[
+0000f240: 6d65 7468 6f64 5d5b 2770 7364 7327 5d20  method]['psds'] 
+0000f250: 3d20 6e70 2e7a 6572 6f73 285b 7365 6c66  = np.zeros([self
+0000f260: 2e6e 6666 742c 0d0a 2020 2020 2020 2020  .nfft,..        
+0000f270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2a0: 2020 2020 2073 656c 662e 795f 7368 6170       self.y_shap
+0000f2b0: 655b 305d 2c0d 0a20 2020 2020 2020 2020  e[0],..         
+0000f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2f0: 2020 2020 6e5f 666f 6c64 735d 290d 0a20      n_folds]).. 
+0000f300: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000f310: 656c 662e 6376 5f70 6174 7465 726e 735b  elf.cv_patterns[
+0000f320: 6d65 7468 6f64 5d5b 2766 6561 7475 7265  method]['feature
+0000f330: 5f72 656c 6576 616e 6365 275d 203d 206e  _relevance'] = n
+0000f340: 702e 7a65 726f 7328 5b6e 5f74 2c0d 0a20  p.zeros([n_t,.. 
+0000f350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f380: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000f390: 2e73 7065 6373 5b27 6e5f 6c61 7465 6e74  .specs['n_latent
+0000f3a0: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
+0000f3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3e0: 2020 7365 6c66 2e79 5f73 6861 7065 5b30    self.y_shape[0
+0000f3f0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+0000f400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f430: 206e 5f66 6f6c 6473 5d29 0d0a 2020 2020   n_folds])..    
+0000f440: 2020 2020 666f 7220 6d65 7468 6f64 2069      for method i
+0000f450: 6e20 6d65 7468 6f64 733a 0d0a 0d0a 2020  n methods:....  
+0000f460: 2020 2020 2020 2020 2020 6966 206d 6574            if met
+0000f470: 686f 6420 6e6f 7420 696e 2063 6f6d 6269  hod not in combi
+0000f480: 6e65 645f 6d65 7468 6f64 733a 0d0a 2020  ned_methods:..  
+0000f490: 2020 2020 2020 2020 2020 2020 2020 2363                #c
+0000f4a0: 6f6c 6c65 6374 2073 7061 7469 616c 2070  ollect spatial p
+0000f4b0: 6174 7465 726e 7320 666f 7220 2777 6569  atterns for 'wei
+0000f4c0: 6768 7427 2073 6f72 7469 6e67 0d0a 2020  ght' sorting..  
+0000f4d0: 2020 2020 2020 2020 2020 2020 2020 746f                to
+0000f4e0: 706f 2c20 7370 6563 7472 612c 2070 7364  po, spectra, psd
+0000f4f0: 7320 3d20 7365 6c66 2e73 696e 676c 655f  s = self.single_
+0000f500: 636f 6d70 6f6e 656e 745f 7061 7474 6572  component_patter
+0000f510: 6e28 7061 7474 6572 6e73 5f73 7472 7563  n(patterns_struc
+0000f520: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+0000f530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f560: 2020 2020 2020 2020 736f 7274 696e 673d          sorting=
+0000f570: 6d65 7468 6f64 2c0d 0a20 2020 2020 2020  method,..       
+0000f580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f5b0: 2020 2020 2020 2020 2020 2020 206e 5f63               n_c
+0000f5c0: 6f6d 703d 6e5f 636f 6d70 290d 0a20 2020  omp=n_comp)..   
+0000f5d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000f5e0: 662e 6376 5f70 6174 7465 726e 735b 6d65  f.cv_patterns[me
+0000f5f0: 7468 6f64 5d5b 2773 7061 7469 616c 275d  thod]['spatial']
+0000f600: 5b3a 2c20 3a2c 2066 6f6c 645d 203d 2074  [:, :, fold] = t
+0000f610: 6f70 6f0d 0a20 2020 2020 2020 2020 2020  opo..           
+0000f620: 2020 2020 2073 656c 662e 6376 5f70 6174       self.cv_pat
+0000f630: 7465 726e 735b 6d65 7468 6f64 5d5b 2774  terns[method]['t
+0000f640: 656d 706f 7261 6c27 5d5b 3a2c 203a 2c20  emporal'][:, :, 
+0000f650: 666f 6c64 5d20 3d20 7370 6563 7472 610d  fold] = spectra.
+0000f660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f670: 2073 656c 662e 6376 5f70 6174 7465 726e   self.cv_pattern
+0000f680: 735b 6d65 7468 6f64 5d5b 2770 7364 7327  s[method]['psds'
+0000f690: 5d5b 3a2c 203a 2c20 666f 6c64 5d20 3d20  ][:, :, fold] = 
+0000f6a0: 7073 6473 0d0a 2020 2020 2020 2020 2020  psds..          
+0000f6b0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000f6c0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0000f6d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000f6e0: 6376 5f70 6174 7465 726e 735b 6d65 7468  cv_patterns[meth
+0000f6f0: 6f64 5d5b 2773 7061 7469 616c 275d 5b3a  od]['spatial'][:
+0000f700: 2c20 3a2c 2066 6f6c 645d 203d 2070 6174  , :, fold] = pat
+0000f710: 7465 726e 735f 7374 7275 6374 5b27 7061  terns_struct['pa
+0000f720: 7474 6572 6e73 275d 5b6d 6574 686f 645d  tterns'][method]
+0000f730: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+0000f740: 2020 2020 7365 6c66 2e63 765f 7061 7474      self.cv_patt
+0000f750: 6572 6e73 5b27 6463 6f76 275d 5b27 696e  erns['dcov']['in
+0000f760: 7075 745f 7370 6174 6961 6c27 5d5b 3a2c  put_spatial'][:,
+0000f770: 203a 2c20 666f 6c64 5d20 3d20 7061 7474   :, fold] = patt
+0000f780: 6572 6e73 5f73 7472 7563 745b 2764 636f  erns_struct['dco
+0000f790: 7627 5d5b 2769 6e70 7574 5f73 7061 7469  v']['input_spati
+0000f7a0: 616c 275d 0d0a 2020 2020 2020 2020 7365  al']..        se
+0000f7b0: 6c66 2e63 765f 7061 7474 6572 6e73 5b27  lf.cv_patterns['
+0000f7c0: 6463 6f76 275d 5b27 636c 6173 735f 636f  dcov']['class_co
+0000f7d0: 6e64 6974 696f 6e61 6c27 5d5b 3a2c 203a  nditional'][:, :
+0000f7e0: 2c20 3a2c 2066 6f6c 645d 203d 2070 6174  , :, fold] = pat
+0000f7f0: 7465 726e 735f 7374 7275 6374 5b27 6463  terns_struct['dc
+0000f800: 6f76 275d 5b27 636c 6173 735f 636f 6e64  ov']['class_cond
+0000f810: 6974 696f 6e61 6c27 5d0d 0a20 2020 2020  itional']..     
+0000f820: 2020 2073 656c 662e 6376 5f70 6174 7465     self.cv_patte
+0000f830: 726e 735b 2763 6f6d 7077 6973 655f 6c6f  rns['compwise_lo
+0000f840: 7373 275d 5b27 6665 6174 7572 655f 7265  ss']['feature_re
+0000f850: 6c65 7661 6e63 6527 5d5b 3a2c 203a 2c20  levance'][:, :, 
+0000f860: 3a2c 2066 6f6c 645d 203d 2070 6174 7465  :, fold] = patte
+0000f870: 726e 735f 7374 7275 6374 5b27 636f 6d70  rns_struct['comp
+0000f880: 7769 7365 5f6c 6f73 7327 5d0d 0a20 2020  wise_loss']..   
+0000f890: 2020 2020 2073 656c 662e 6376 5f70 6174       self.cv_pat
+0000f8a0: 7465 726e 735b 276f 7574 7075 745f 636f  terns['output_co
+0000f8b0: 7272 275d 5b27 6665 6174 7572 655f 7265  rr']['feature_re
+0000f8c0: 6c65 7661 6e63 6527 5d5b 3a2c 203a 2c20  levance'][:, :, 
+0000f8d0: 3a2c 2066 6f6c 645d 203d 2070 6174 7465  :, fold] = patte
+0000f8e0: 726e 735f 7374 7275 6374 5b27 636f 7272  rns_struct['corr
+0000f8f0: 5f74 6f5f 6f75 7470 7574 275d 0d0a 2020  _to_output']..  
+0000f900: 2020 2020 2020 7365 6c66 2e63 765f 7061        self.cv_pa
+0000f910: 7474 6572 6e73 5b27 7765 6967 6874 275d  tterns['weight']
+0000f920: 5b27 6665 6174 7572 655f 7265 6c65 7661  ['feature_releva
+0000f930: 6e63 6527 5d5b 3a2c 203a 2c20 3a2c 2066  nce'][:, :, :, f
+0000f940: 6f6c 645d 203d 2070 6174 7465 726e 735f  old] = patterns_
+0000f950: 7374 7275 6374 5b27 7765 6967 6874 7327  struct['weights'
+0000f960: 5d5b 276f 7574 5f77 6569 6768 7473 275d  ]['out_weights']
+0000f970: 0d0a 2020 2020 2020 2020 5b73 656c 662e  ..        [self.
+0000f980: 6376 5f77 6569 6768 7473 5b6b 5d2e 6170  cv_weights[k].ap
+0000f990: 7065 6e64 2870 6174 7465 726e 735f 7374  pend(patterns_st
+0000f9a0: 7275 6374 5b27 7765 6967 6874 7327 5d5b  ruct['weights'][
+0000f9b0: 6b5d 2920 0d0a 2020 2020 2020 2020 2066  k]) ..         f
+0000f9c0: 6f72 206b 2069 6e20 7061 7474 6572 6e73  or k in patterns
+0000f9d0: 5f73 7472 7563 745b 2777 6569 6768 7473  _struct['weights
+0000f9e0: 275d 2e6b 6579 7328 295d 0d0a 0d0a 2020  '].keys()]....  
+0000f9f0: 2020 6465 6620 6765 745f 7370 6563 7472    def get_spectr
+0000fa00: 6128 7365 6c66 2c20 7765 6967 6874 732c  a(self, weights,
+0000fa10: 2061 6374 6976 6174 696f 6e73 2c20 6e66   activations, nf
+0000fa20: 6674 3d31 3238 293a 0d0a 2020 2020 2020  ft=128):..      
+0000fa30: 2020 2323 5073 6473 2061 6e64 2066 7265    ##Psds and fre
+0000fa40: 7120 7265 7370 6f6e 7365 730d 0a20 2020  q responses..   
+0000fa50: 2020 2020 2023 2020 436f 6d70 7574 6520       #  Compute 
+0000fa60: 6672 6571 7565 6e63 7920 7265 7370 6f6e  frequency respon
+0000fa70: 7365 7320 616e 6420 736f 7572 6365 2073  ses and source s
+0000fa80: 7065 6374 7261 0d0a 2020 2020 2020 2020  pectra..        
+0000fa90: 7265 616c 6820 3d20 5b5d 0d0a 2020 2020  realh = []..    
+0000faa0: 2020 2020 7073 6473 203d 205b 5d0d 0a20      psds = [].. 
+0000fab0: 2020 2020 2020 2066 6f72 2069 2c20 666c         for i, fl
+0000fac0: 7420 696e 2065 6e75 6d65 7261 7465 2877  t in enumerate(w
+0000fad0: 6569 6768 7473 5b27 7463 6f6e 7627 5d2e  eights['tconv'].
+0000fae0: 5429 3a0d 0a20 2020 2020 2020 2020 2020  T):..           
+0000faf0: 2066 6c74 202d 3d20 666c 742e 6d65 616e   flt -= flt.mean
+0000fb00: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0000fb10: 2366 6c74 202d 3d20 7365 6c66 2e74 5f63  #flt -= self.t_c
+0000fb20: 6f6e 765f 6269 6173 6573 5b69 5d2f 7365  onv_biases[i]/se
+0000fb30: 6c66 2e73 7065 6373 5b27 6669 6c74 6572  lf.specs['filter
+0000fb40: 5f6c 656e 6774 6827 5d0d 0a20 2020 2020  _length']..     
+0000fb50: 2020 2020 2020 206c 7463 203d 2061 6374         ltc = act
+0000fb60: 6976 6174 696f 6e73 5b27 646d 7827 5d5b  ivations['dmx'][
+0000fb70: 3a2c 2030 2c20 3a2c 2069 5d20 2d20 6e70  :, 0, :, i] - np
+0000fb80: 2e6d 6561 6e28 6163 7469 7661 7469 6f6e  .mean(activation
+0000fb90: 735b 2764 6d78 275d 5b3a 2c20 302c 203a  s['dmx'][:, 0, :
+0000fba0: 2c20 695d 2c20 6178 6973 3d31 2c20 6b65  , i], axis=1, ke
+0000fbb0: 6570 6469 6d73 3d54 7275 6529 0d0a 2020  epdims=True)..  
+0000fbc0: 2020 2020 2020 2020 2020 6672 2c20 7073            fr, ps
+0000fbd0: 6420 3d20 7765 6c63 6828 6c74 632c 0d0a  d = welch(ltc,..
+0000fbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fbf0: 2020 2020 2020 2020 2020 2020 6673 3d73              fs=s
+0000fc00: 656c 662e 6461 7461 7365 742e 685f 7061  elf.dataset.h_pa
+0000fc10: 7261 6d73 5b27 6673 275d 2c0d 0a20 2020  rams['fs'],..   
+0000fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc30: 2020 2020 2020 2020 206e 6666 743d 6e66           nfft=nf
+0000fc40: 6674 202a 2032 2c0d 0a20 2020 2020 2020  ft * 2,..       
+0000fc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc60: 2020 2020 206e 7065 7273 6567 3d6e 6666       nperseg=nff
+0000fc70: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+0000fc80: 6966 206c 656e 2866 725b 3a2d 315d 2920  if len(fr[:-1]) 
+0000fc90: 3c20 6e66 6674 3a0d 0a20 2020 2020 2020  < nfft:..       
+0000fca0: 2020 2020 2020 2020 206e 6666 7420 3d20           nfft = 
+0000fcb0: 6c65 6e28 6672 5b3a 2d31 5d29 0d0a 0d0a  len(fr[:-1])....
+0000fcc0: 2020 2020 2020 2020 2020 2020 772c 2068              w, h
+0000fcd0: 203d 2066 7265 717a 2866 6c74 2c20 312c   = freqz(flt, 1,
+0000fce0: 2077 6f72 4e3d 6e66 6674 2c20 6673 203d   worN=nfft, fs =
+0000fcf0: 2073 656c 662e 6461 7461 7365 742e 685f   self.dataset.h_
+0000fd00: 7061 7261 6d73 5b27 6673 275d 290d 0a0d  params['fs'])...
+0000fd10: 0a20 2020 2020 2020 2020 2020 2070 7364  .            psd
+0000fd20: 732e 6170 7065 6e64 2870 7364 5b3a 2c20  s.append(psd[:, 
+0000fd30: 3a2d 315d 2e6d 6561 6e28 3029 290d 0a20  :-1].mean(0)).. 
+0000fd40: 2020 2020 2020 2020 2020 2072 6561 6c68             realh
+0000fd50: 2e61 7070 656e 6428 6e70 2e61 6273 2868  .append(np.abs(h
+0000fd60: 2929 0d0a 0d0a 2020 2020 2020 2020 7370  ))....        sp
+0000fd70: 6563 7472 6120 3d20 7b7d 0d0a 2020 2020  ectra = {}..    
+0000fd80: 2020 2020 7370 6563 7472 615b 2766 7265      spectra['fre
+0000fd90: 715f 7265 7370 6f6e 7365 7327 5d20 3d20  q_responses'] = 
+0000fda0: 6e70 2e61 7272 6179 2872 6561 6c68 290d  np.array(realh).
+0000fdb0: 0a20 2020 2020 2020 2073 7065 6374 7261  .        spectra
+0000fdc0: 5b27 7073 6473 275d 203d 206e 702e 6172  ['psds'] = np.ar
+0000fdd0: 7261 7928 7073 6473 290d 0a20 2020 2020  ray(psds)..     
+0000fde0: 2020 2073 7065 6374 7261 5b27 6672 6571     spectra['freq
+0000fdf0: 7327 5d20 3d20 770d 0a20 2020 2020 2020  s'] = w..       
+0000fe00: 2072 6574 7572 6e20 7370 6563 7472 610d   return spectra.
+0000fe10: 0a0d 0a0d 0a0d 0a20 2020 2064 6566 2067  .......    def g
+0000fe20: 6574 5f77 6569 6768 7473 2873 656c 662c  et_weights(self,
+0000fe30: 2076 6572 626f 7365 3d46 616c 7365 293a   verbose=False):
+0000fe40: 0d0a 2020 2020 2020 2020 7765 6967 6874  ..        weight
+0000fe50: 7320 3d20 7b7d 0d0a 2020 2020 2020 2020  s = {}..        
+0000fe60: 2320 4578 7472 6163 7420 7765 6967 6874  # Extract weight
+0000fe70: 730d 0a20 2020 2020 2020 2023 2053 7061  s..        # Spa
+0000fe80: 7469 616c 2065 7874 7261 6374 696f 6e20  tial extraction 
+0000fe90: 6669 7465 7273 0d0a 2020 2020 2020 2020  fiters..        
+0000fea0: 7765 6967 6874 735b 2764 6d78 275d 203d  weights['dmx'] =
+0000feb0: 206e 702e 7371 7565 657a 6528 7365 6c66   np.squeeze(self
+0000fec0: 2e64 6d78 2e77 2e6e 756d 7079 2829 290d  .dmx.w.numpy()).
+0000fed0: 0a20 2020 2020 2020 2077 6569 6768 7473  .        weights
+0000fee0: 5b27 646d 785f 6227 5d20 3d20 7365 6c66  ['dmx_b'] = self
+0000fef0: 2e64 6d78 2e62 5f69 6e2e 6e75 6d70 7928  .dmx.b_in.numpy(
+0000ff00: 290d 0a20 2020 2020 2020 2023 2054 656d  )..        # Tem
+0000ff10: 706f 7261 6c20 6b65 726e 656c 730d 0a20  poral kernels.. 
+0000ff20: 2020 2020 2020 2077 6569 6768 7473 5b27         weights['
+0000ff30: 7463 6f6e 7627 5d20 3d20 6e70 2e73 7175  tconv'] = np.squ
+0000ff40: 6565 7a65 2873 656c 662e 7463 6f6e 762e  eeze(self.tconv.
+0000ff50: 6669 6c74 6572 732e 6e75 6d70 7928 2929  filters.numpy())
+0000ff60: 0d0a 2020 2020 2020 2020 7765 6967 6874  ..        weight
+0000ff70: 735b 2774 636f 6e76 5f62 275d 203d 206e  s['tconv_b'] = n
+0000ff80: 702e 7371 7565 657a 6528 7365 6c66 2e74  p.squeeze(self.t
+0000ff90: 636f 6e76 2e62 2e6e 756d 7079 2829 290d  conv.b.numpy()).
+0000ffa0: 0a20 2020 2020 2020 2023 2046 696e 616c  .        # Final
+0000ffb0: 206c 6179 6572 0d0a 2020 2020 2020 2020   layer..        
+0000ffc0: 7765 6967 6874 735b 276f 7574 5f77 5f66  weights['out_w_f
+0000ffd0: 6c61 7427 5d20 3d20 7365 6c66 2e66 696e  lat'] = self.fin
+0000ffe0: 5f66 632e 772e 6e75 6d70 7928 290d 0a20  _fc.w.numpy().. 
+0000fff0: 2020 2020 2020 2077 6569 6768 7473 5b27         weights['
+00010000: 6f75 745f 7765 6967 6874 7327 5d20 3d20  out_weights'] = 
+00010010: 6e70 2e72 6573 6861 7065 2873 656c 662e  np.reshape(self.
+00010020: 6669 6e5f 6663 2e77 2e6e 756d 7079 2829  fin_fc.w.numpy()
+00010030: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00010040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010050: 2020 2020 5b73 656c 662e 706f 6f6c 6564      [self.pooled
+00010060: 2e73 6861 7065 5b32 5d2c 0d0a 2020 2020  .shape[2],..    
+00010070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010080: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00010090: 6c66 2e64 6d78 2e73 697a 652c 0d0a 2020  lf.dmx.size,..  
+000100a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000100b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000100c0: 7365 6c66 2e6f 7574 5f64 696d 5d2c 0d0a  self.out_dim],..
+000100d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000100e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000100f0: 206f 7264 6572 3d27 4327 290d 0a20 2020   order='C')..   
+00010100: 2020 2020 2077 6569 6768 7473 5b27 6663       weights['fc
+00010110: 5f62 275d 203d 2073 656c 662e 6669 6e5f  _b'] = self.fin_
+00010120: 6663 2e62 2e6e 756d 7079 2829 0d0a 2020  fc.b.numpy()..  
+00010130: 2020 2020 2020 6966 2076 6572 626f 7365        if verbose
+00010140: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+00010150: 7269 6e74 2822 2222 2257 6569 6768 7473  rint(""""Weights
+00010160: 3a20 5c6e 0d0a 2020 2020 2020 2020 2020  : \n..          
+00010170: 2020 2020 2020 2020 444d 583a 207b 7d0d          DMX: {}.
+00010180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010190: 2020 2054 434f 4e56 3a20 7b7d 0d0a 2020     TCONV: {}..  
+000101a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101b0: 4643 5f44 454e 5345 3a20 7b7d 2222 222e  FC_DENSE: {}""".
+000101c0: 666f 726d 6174 2877 6569 6768 7473 5b27  format(weights['
+000101d0: 646d 7827 5d2e 7368 6170 652c 0d0a 2020  dmx'].shape,..  
+000101e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101f0: 7765 6967 6874 735b 2774 636f 6e76 275d  weights['tconv']
+00010200: 2e73 6861 7065 2c0d 0a20 2020 2020 2020  .shape,..       
+00010210: 2020 2020 2020 2020 2020 2077 6569 6768             weigh
+00010220: 7473 5b27 6f75 745f 7765 6967 6874 7327  ts['out_weights'
+00010230: 5d2e 7368 6170 6529 290d 0a20 2020 2020  ].shape))..     
+00010240: 2020 2072 6574 7572 6e20 7765 6967 6874     return weight
+00010250: 730d 0a0d 0a20 2020 2064 6566 2063 6f6d  s....    def com
+00010260: 7075 7465 5f63 6f6d 706f 6e65 6e74 7769  pute_componentwi
+00010270: 7365 5f6c 6f73 7328 7365 6c66 2c20 582c  se_loss(self, X,
+00010280: 2079 2c20 7765 6967 6874 7329 3a0d 0a0d   y, weights):...
+00010290: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+000102a0: 2020 2020 2020 436f 6d70 7574 6520 636f        Compute co
+000102b0: 6d70 6f6e 656e 7420 7265 6c65 7661 6e63  mponent relevanc
+000102c0: 6573 2062 7920 7265 6375 7273 6976 6520  es by recursive 
+000102d0: 656c 696d 696e 6174 696f 6e0d 0a20 2020  elimination..   
+000102e0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+000102f0: 2020 6d6f 6465 6c5f 7765 6967 6874 7320    model_weights 
+00010300: 3d20 7365 6c66 2e6b 6d2e 6765 745f 7765  = self.km.get_we
+00010310: 6967 6874 7328 290d 0a20 2020 2020 2020  ights()..       
+00010320: 206f 7269 6769 6e61 6c5f 7765 6967 6874   original_weight
+00010330: 7320 3d20 6d6f 6465 6c5f 7765 6967 6874  s = model_weight
+00010340: 732e 636f 7079 2829 0d0a 2020 2020 2020  s.copy()..      
+00010350: 2020 6261 7365 5f6c 6f73 732c 2062 6173    base_loss, bas
+00010360: 655f 7065 7266 6f72 6d61 6e63 6520 3d20  e_performance = 
+00010370: 7365 6c66 2e6b 6d2e 6576 616c 7561 7465  self.km.evaluate
+00010380: 2858 2c20 792c 2076 6572 626f 7365 3d30  (X, y, verbose=0
+00010390: 290d 0a20 2020 2020 2020 2023 2069 6620  )..        # if 
+000103a0: 6c65 6e28 6261 7365 5f70 6572 666f 726d  len(base_perform
+000103b0: 616e 6365 203e 2031 293a 0d0a 2020 2020  ance > 1):..    
+000103c0: 2020 2020 2320 2020 2062 6173 655f 7065      #    base_pe
+000103d0: 7266 6f72 6d61 6e63 6520 3d20 6262 6173  rformance = bbas
+000103e0: 655f 7065 7266 6f72 6d61 6e63 655b 305d  e_performance[0]
+000103f0: 0d0a 2020 2020 2020 2020 6665 6174 7572  ..        featur
+00010400: 655f 7265 6c65 7661 6e63 6573 5f6c 6f73  e_relevances_los
+00010410: 7320 3d20 5b5d 0d0a 2020 2020 2020 2020  s = []..        
+00010420: 6e5f 6f75 745f 7420 3d20 7765 6967 6874  n_out_t = weight
+00010430: 735b 276f 7574 5f77 6569 6768 7473 275d  s['out_weights']
+00010440: 2e73 6861 7065 5b30 5d0d 0a20 2020 2020  .shape[0]..     
+00010450: 2020 206e 5f6f 7574 5f79 203d 2077 6569     n_out_y = wei
+00010460: 6768 7473 5b27 6f75 745f 7765 6967 6874  ghts['out_weight
+00010470: 7327 5d2e 7368 6170 655b 2d31 5d0d 0a20  s'].shape[-1].. 
+00010480: 2020 2020 2020 2023 7a65 726f 7765 6967         #zeroweig
+00010490: 6874 7320 3d20 6e70 2e7a 6572 6f73 2828  hts = np.zeros((
+000104a0: 6e5f 6f75 745f 742c 2929 0d0a 2020 2020  n_out_t,))..    
+000104b0: 2020 2020 6c6f 7373 6573 203d 206e 702e      losses = np.
+000104c0: 7a65 726f 7328 5b6e 5f6f 7574 5f74 2c20  zeros([n_out_t, 
+000104d0: 7365 6c66 2e73 7065 6373 5b27 6e5f 6c61  self.specs['n_la
+000104e0: 7465 6e74 275d 2c20 6e5f 6f75 745f 795d  tent'], n_out_y]
+000104f0: 290d 0a20 2020 2020 2020 2066 6f72 2074  )..        for t
+00010500: 2069 6e20 7261 6e67 6528 6e5f 6f75 745f   in range(n_out_
+00010510: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
+00010520: 2066 6f72 206a 6a20 696e 2072 616e 6765   for jj in range
+00010530: 286e 5f6f 7574 5f79 293a 0d0a 2020 2020  (n_out_y):..    
+00010540: 2020 2020 2020 2020 2020 2020 2366 6f72              #for
+00010550: 2065 6163 6820 636c 6173 730d 0a20 2020   each class..   
+00010560: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00010570: 2069 2069 6e20 7261 6e67 6528 7365 6c66   i in range(self
+00010580: 2e73 7065 6373 5b22 6e5f 6c61 7465 6e74  .specs["n_latent
+00010590: 225d 293a 0d0a 2020 2020 2020 2020 2020  "]):..          
+000105a0: 2020 2020 2020 2020 2020 2366 6f72 2065            #for e
+000105b0: 6163 6820 636f 6d70 6f6e 656e 740d 0a20  ach component.. 
+000105c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105d0: 2020 2023 6c6f 7373 5f70 6572 5f63 6f6d     #loss_per_com
+000105e0: 706f 6e65 6e74 203d 205b 5d0d 0a20 2020  ponent = []..   
+000105f0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+00010600: 2020 2020 2020 206e 6577 5f77 6569 6768         new_weigh
+00010610: 7473 203d 2077 6569 6768 7473 5b27 6f75  ts = weights['ou
+00010620: 745f 7765 6967 6874 7327 5d2e 636f 7079  t_weights'].copy
+00010630: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00010640: 2020 2020 2020 2020 6e65 775f 6269 6173          new_bias
+00010650: 203d 2077 6569 6768 7473 5b27 6663 5f62   = weights['fc_b
+00010660: 275d 2e63 6f70 7928 290d 0a20 2020 2020  '].copy()..     
+00010670: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00010680: 6577 5f77 6569 6768 7473 5b74 2c20 692c  ew_weights[t, i,
+00010690: 206a 6a5d 203d 2030 0d0a 2020 2020 2020   jj] = 0..      
+000106a0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+000106b0: 775f 6269 6173 5b6a 6a5d 203d 2030 0d0a  w_bias[jj] = 0..
+000106c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000106d0: 2020 2020 6e65 775f 7765 6967 6874 7320      new_weights 
+000106e0: 3d20 6e70 2e72 6573 6861 7065 286e 6577  = np.reshape(new
+000106f0: 5f77 6569 6768 7473 2c20 7765 6967 6874  _weights, weight
+00010700: 735b 276f 7574 5f77 5f66 6c61 7427 5d2e  s['out_w_flat'].
+00010710: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
+00010720: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+00010730: 6c5f 7765 6967 6874 735b 2d32 5d20 3d20  l_weights[-2] = 
+00010740: 6e65 775f 7765 6967 6874 730d 0a20 2020  new_weights..   
+00010750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010760: 206d 6f64 656c 5f77 6569 6768 7473 5b2d   model_weights[-
+00010770: 315d 203d 206e 6577 5f62 6961 730d 0a20  1] = new_bias.. 
+00010780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010790: 2020 2073 656c 662e 6b6d 2e73 6574 5f77     self.km.set_w
+000107a0: 6569 6768 7473 286d 6f64 656c 5f77 6569  eights(model_wei
+000107b0: 6768 7473 290d 0a20 2020 2020 2020 2020  ghts)..         
+000107c0: 2020 2020 2020 2020 2020 206c 6f73 7320             loss 
+000107d0: 3d20 7365 6c66 2e6b 6d2e 6576 616c 7561  = self.km.evalua
+000107e0: 7465 2858 2c20 792c 2076 6572 626f 7365  te(X, y, verbose
+000107f0: 3d30 295b 305d 0d0a 2020 2020 0d0a 2020  =0)[0]..    ..  
+00010800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010810: 2020 236c 6f73 735f 7065 725f 636f 6d70    #loss_per_comp
+00010820: 6f6e 656e 742e 6170 7065 6e64 2862 6173  onent.append(bas
+00010830: 655f 6c6f 7373 202d 206c 6f73 7329 0d0a  e_loss - loss)..
+00010840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010850: 2020 2020 6c6f 7373 6573 5b74 2c20 692c      losses[t, i,
+00010860: 206a 6a5d 203d 206c 6f73 7320 2d20 6261   jj] = loss - ba
+00010870: 7365 5f6c 6f73 730d 0a20 2020 2020 2020  se_loss..       
+00010880: 2020 2020 2023 6665 6174 7572 655f 7265       #feature_re
+00010890: 6c65 7661 6e63 6573 5f6c 6f73 732e 6170  levances_loss.ap
+000108a0: 7065 6e64 286e 702e 6172 7261 7928 6c6f  pend(np.array(lo
+000108b0: 7373 5f70 6572 5f63 636f 6d70 6f6e 656e  ss_per_ccomponen
+000108c0: 7429 290d 0a20 2020 2020 2020 2023 7072  t))..        #pr
+000108d0: 696e 7428 6c6f 7373 6573 2e73 6861 7065  int(losses.shape
+000108e0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000108f0: 6b6d 2e73 6574 5f77 6569 6768 7473 286f  km.set_weights(o
+00010900: 7269 6769 6e61 6c5f 7765 6967 6874 7329  riginal_weights)
+00010910: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00010920: 206c 6f73 7365 730d 0a0d 0a0d 0a20 2020   losses......   
+00010930: 2064 6566 2067 6574 5f6f 7574 7075 745f   def get_output_
+00010940: 636f 7272 656c 6174 696f 6e73 2873 656c  correlations(sel
+00010950: 662c 2061 6374 6976 6174 696f 6e73 2c20  f, activations, 
+00010960: 795f 7472 7565 293a 0d0a 2020 2020 2020  y_true):..      
+00010970: 2020 2222 2243 6f6d 7075 7465 7320 6120    """Computes a 
+00010980: 7369 6d69 6c61 7269 7479 206d 6574 7269  similarity metri
+00010990: 6320 6265 7477 6565 6e20 6561 6368 206f  c between each o
+000109a0: 6620 7468 6520 6578 7472 6163 7465 640d  f the extracted.
+000109b0: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
+000109c0: 7320 616e 6420 7468 6520 7461 7267 6574  s and the target
+000109d0: 2076 6172 6961 626c 652e 0d0a 0d0a 2020   variable.....  
+000109e0: 2020 2020 2020 5468 6520 6d65 7472 6963        The metric
+000109f0: 2069 7320 6120 4d61 6e68 6174 7461 6e20   is a Manhattan 
+00010a00: 6469 7374 616e 6365 2066 6f72 2064 6963  distance for dic
+00010a10: 7265 7465 2074 6172 6765 7473 2c20 616e  rete targets, an
+00010a20: 640d 0a20 2020 2020 2020 2053 7065 6172  d..        Spear
+00010a30: 6d61 6e20 636f 7272 656c 6174 696f 6e20  man correlation 
+00010a40: 666f 7220 636f 6e74 696e 756f 7573 2074  for continuous t
+00010a50: 6172 6765 7473 2e0d 0a20 2020 2020 2020  argets...       
+00010a60: 2022 2222 0d0a 2020 2020 2020 2020 636f   """..        co
+00010a70: 7272 5f74 6f5f 6f75 7470 7574 203d 205b  rr_to_output = [
+00010a80: 5d0d 0a20 2020 2020 2020 2079 5f74 7275  ]..        y_tru
+00010a90: 6520 3d20 795f 7472 7565 2e6e 756d 7079  e = y_true.numpy
+00010aa0: 2829 0d0a 2020 2020 2020 2020 666c 6174  ()..        flat
+00010ab0: 5f66 6561 7473 203d 2061 6374 6976 6174  _feats = activat
+00010ac0: 696f 6e73 5b27 7463 6f6e 7627 5d2e 6e75  ions['tconv'].nu
+00010ad0: 6d70 7928 292e 7265 7368 6170 6528 795f  mpy().reshape(y_
+00010ae0: 7472 7565 2e73 6861 7065 5b30 5d2c 202d  true.shape[0], -
+00010af0: 3129 0d0a 0d0a 2020 2020 2020 2020 0d0a  1)....        ..
+00010b00: 2020 2020 2020 2020 666f 7220 795f 2069          for y_ i
+00010b10: 6e20 795f 7472 7565 2e54 3a0d 0a20 2020  n y_true.T:..   
+00010b20: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00010b30: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
+00010b40: 735b 2774 6172 6765 745f 7479 7065 275d  s['target_type']
+00010b50: 2069 6e20 5b27 666c 6f61 7427 2c20 2773   in ['float', 's
+00010b60: 6967 6e61 6c27 5d3a 0d0a 2020 2020 2020  ignal']:..      
+00010b70: 2020 2020 2020 2020 2020 7266 6f63 7320            rfocs 
+00010b80: 3d20 6e70 2e61 7272 6179 285b 7370 6561  = np.array([spea
+00010b90: 726d 616e 7228 795f 2c20 6629 5b30 5d20  rmanr(y_, f)[0] 
+00010ba0: 666f 7220 6620 696e 2066 6c61 745f 6665  for f in flat_fe
+00010bb0: 6174 732e 545d 290d 0a20 2020 2020 2020  ats.T])..       
+00010bc0: 2020 2020 2020 2020 2063 6f72 725f 746f           corr_to
+00010bd0: 5f6f 7574 7075 742e 6170 7065 6e64 2872  _output.append(r
+00010be0: 666f 6373 2e72 6573 6861 7065 2861 6374  focs.reshape(act
+00010bf0: 6976 6174 696f 6e73 5b27 7463 6f6e 7627  ivations['tconv'
+00010c00: 5d2e 7368 6170 655b 313a 5d29 290d 0a0d  ].shape[1:]))...
+00010c10: 0a0d 0a20 2020 2020 2020 2020 2020 2065  ...            e
+00010c20: 6c69 6620 7365 6c66 2e64 6174 6173 6574  lif self.dataset
+00010c30: 2e68 5f70 6172 616d 735b 2774 6172 6765  .h_params['targe
+00010c40: 745f 7479 7065 275d 203d 3d20 2769 6e74  t_type'] == 'int
+00010c50: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
+00010c60: 2020 2020 7266 6f63 7320 3d20 6e70 2e61      rfocs = np.a
+00010c70: 7272 6179 285b 7065 6172 736f 6e72 2879  rray([pearsonr(y
+00010c80: 5f2c 2066 295b 305d 2066 6f72 2066 2069  _, f)[0] for f i
+00010c90: 6e20 666c 6174 5f66 6561 7473 2e54 5d29  n flat_feats.T])
+00010ca0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010cb0: 2020 636f 7272 5f74 6f5f 6f75 7470 7574    corr_to_output
+00010cc0: 2e61 7070 656e 6428 7266 6f63 732e 7265  .append(rfocs.re
+00010cd0: 7368 6170 6528 6163 7469 7661 7469 6f6e  shape(activation
+00010ce0: 735b 2774 636f 6e76 275d 2e73 6861 7065  s['tconv'].shape
+00010cf0: 5b31 3a5d 2929 0d0a 2020 2020 2020 2020  [1:]))..        
+00010d00: 2020 2020 2020 2020 2379 5f74 7275 6520          #y_true 
+00010d10: 3d20 795f 7472 7565 2f6e 702e 6c69 6e61  = y_true/np.lina
+00010d20: 6c67 2e6e 6f72 6d28 795f 7472 7565 2c20  lg.norm(y_true, 
+00010d30: 6f72 643d 312c 2061 7869 733d 3029 5b4e  ord=1, axis=0)[N
+00010d40: 6f6e 652c 203a 5d0d 0a20 2020 2020 2020  one, :]..       
+00010d50: 2020 2020 2020 2020 2023 666c 6174 5f64           #flat_d
+00010d60: 6976 203d 206e 702e 6c69 6e61 6c67 2e6e  iv = np.linalg.n
+00010d70: 6f72 6d28 666c 6174 5f66 6561 7473 2c20  orm(flat_feats, 
+00010d80: 312c 2061 7869 733d 3029 5b4e 6f6e 652c  1, axis=0)[None,
+00010d90: 203a 5d0d 0a20 2020 2020 2020 2020 2020   :]..           
+00010da0: 2020 2020 2023 666c 6174 5f66 6561 7473       #flat_feats
+00010db0: 203d 2066 6c61 745f 6665 6174 732f 666c   = flat_feats/fl
+00010dc0: 6174 5f64 6976 0d0a 2020 2020 2020 2020  at_div..        
+00010dd0: 2020 2020 2020 2020 2370 7269 6e74 2822          #print("
+00010de0: 6666 3a22 2c20 666c 6174 5f66 6561 7473  ff:", flat_feats
+00010df0: 2e73 6861 7065 290d 0a20 2020 2020 2020  .shape)..       
+00010e00: 2020 2020 2020 2020 2023 7072 696e 7428           #print(
+00010e10: 2279 5f74 7275 653a 222c 2079 5f74 7275  "y_true:", y_tru
+00010e20: 652e 7368 6170 6529 0d0a 2020 2020 2020  e.shape)..      
+00010e30: 2020 2020 2020 2020 2020 2366 6f72 2079            #for y
+00010e40: 5f20 696e 2079 5f74 7275 652e 543a 0d0a  _ in y_true.T:..
+00010e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e60: 2020 2020 2370 7269 6e74 2827 792e 543a      #print('y.T:
+00010e70: 272c 2079 5f2e 7368 6170 6529 0d0a 2020  ', y_.shape)..  
+00010e80: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00010e90: 2020 2072 666f 6373 203d 2032 2e20 2d20     rfocs = 2. - 
+00010ea0: 6e70 2e73 756d 286e 702e 6162 7328 666c  np.sum(np.abs(fl
+00010eb0: 6174 5f66 6561 7473 202d 2079 5f5b 3a2c  at_feats - y_[:,
+00010ec0: 204e 6f6e 655d 292c 2030 290d 0a20 2020   None]), 0)..   
+00010ed0: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+00010ee0: 2020 636f 7272 5f74 6f5f 6f75 7470 7574    corr_to_output
+00010ef0: 2e61 7070 656e 6428 7266 6f63 732e 7265  .append(rfocs.re
+00010f00: 7368 6170 6528 6163 7469 7661 7469 6f6e  shape(activation
+00010f10: 735b 2774 636f 6e76 275d 2e73 6861 7065  s['tconv'].shape
+00010f20: 5b31 3a5d 2929 0d0a 0d0a 2020 2020 2020  [1:]))....      
+00010f30: 2020 636f 7272 5f74 6f5f 6f75 7470 7574    corr_to_output
+00010f40: 203d 206e 702e 636f 6e63 6174 656e 6174   = np.concatenat
+00010f50: 6528 636f 7272 5f74 6f5f 6f75 7470 7574  e(corr_to_output
+00010f60: 2c20 3029 2e74 7261 6e73 706f 7365 285b  , 0).transpose([
+00010f70: 312c 2032 2c20 305d 290d 0a20 2020 2020  1, 2, 0])..     
+00010f80: 2020 2023 7072 696e 7428 636f 7272 5f74     #print(corr_t
+00010f90: 6f5f 6f75 7470 7574 2e73 6861 7065 290d  o_output.shape).
+00010fa0: 0a20 2020 2020 2020 2069 6620 6e70 2e61  .        if np.a
+00010fb0: 6e79 286e 702e 6973 6e61 6e28 636f 7272  ny(np.isnan(corr
+00010fc0: 5f74 6f5f 6f75 7470 7574 2929 3a0d 0a20  _to_output)):.. 
+00010fd0: 2020 2020 2020 2020 2020 2063 6f72 725f             corr_
+00010fe0: 746f 5f6f 7574 7075 745b 6e70 2e69 736e  to_output[np.isn
+00010ff0: 616e 2863 6f72 725f 746f 5f6f 7574 7075  an(corr_to_outpu
+00011000: 7429 5d20 3d20 300d 0a20 2020 2020 2020  t)] = 0..       
+00011010: 2072 6574 7572 6e20 636f 7272 5f74 6f5f   return corr_to_
+00011020: 6f75 7470 7574 0d0a 0d0a 2020 2020 2320  output....    # 
+00011030: 2d2d 2d20 4c46 434e 4e20 706c 6f74 2066  --- LFCNN plot f
+00011040: 756e 6374 696f 6e73 202d 2d2d 0d0a 0d0a  unctions ---....
+00011050: 2020 2020 6465 6620 706c 6f74 5f65 766f      def plot_evo
+00011060: 6b65 645f 7065 616b 7328 7365 6c66 2c20  ked_peaks(self, 
+00011070: 6461 7461 3d4e 6f6e 652c 2074 3d4e 6f6e  data=None, t=Non
+00011080: 652c 2063 6c61 7373 5f73 7562 7365 743d  e, class_subset=
+00011090: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
+000110a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000110b0: 2073 656e 736f 725f 6c61 796f 7574 3d27   sensor_layout='
+000110c0: 5665 6374 6f72 7669 6577 2d6d 6167 272c  Vectorview-mag',
+000110d0: 2074 6974 6c65 3d4e 6f6e 652c 2073 6176   title=None, sav
+000110e0: 6566 6967 3d4e 6f6e 6529 3a0d 0a20 2020  efig=None):..   
+000110f0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00011100: 2020 506c 6f74 206f 6e65 2073 7061 7469    Plot one spati
+00011110: 616c 2074 6f70 6f67 7261 7068 7920 6f66  al topography of
+00011120: 2063 6c61 7373 2d63 6f6e 6469 7469 6f6e   class-condition
+00011130: 616c 2061 7665 7261 6765 206f 6620 7468  al average of th
+00011140: 6520 696e 7075 742e 0d0a 2020 2020 2020  e input...      
+00011150: 2020 4966 2074 696d 6570 6f69 6e74 2069    If timepoint i
+00011160: 7320 6e6f 7420 7370 6563 6966 6965 6420  s not specified 
+00011170: 6974 2069 7320 7069 636b 6564 2061 7320  it is picked as 
+00011180: 6120 6d61 7869 6d75 6d20 524d 5320 666f  a maximum RMS fo
+00011190: 7220 6561 6368 0d0a 2020 2020 2020 2020  r each..        
+000111a0: 636c 6173 732e 0d0a 0d0a 0d0a 2020 2020  class.......    
+000111b0: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
+000111c0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000111d0: 2d2d 0d0a 2020 2020 2020 2020 746f 706f  --..        topo
+000111e0: 7320 3a20 6e70 2e61 7272 6179 0d0a 2020  s : np.array..  
+000111f0: 2020 2020 2020 2020 2020 5b6e 5f63 682c            [n_ch,
+00011200: 206e 5f74 2c20 6e5f 636c 6173 7365 735d   n_t, n_classes]
+00011210: 0d0a 2020 2020 2020 2020 7365 6e73 6f72  ..        sensor
+00011220: 5f6c 6179 6f75 7420 3a20 5459 5045 2c20  _layout : TYPE, 
+00011230: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
+00011240: 2020 2020 2020 4445 5343 5249 5054 494f        DESCRIPTIO
+00011250: 4e2e 2054 6865 2064 6566 6175 6c74 2069  N. The default i
+00011260: 7320 2756 6563 746f 7276 6965 772d 6d61  s 'Vectorview-ma
+00011270: 6727 2e0d 0a0d 0a20 2020 2020 2020 2022  g'.....        "
+00011280: 2222 0d0a 2020 2020 2020 2020 6e20 3d20  ""..        n = 
+00011290: 7365 6c66 2e6f 7574 5f64 696d 0d0a 0d0a  self.out_dim....
+000112a0: 2020 2020 2020 2020 6966 2064 6174 6120          if data 
+000112b0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+000112c0: 2020 2020 2020 6461 7461 203d 2073 656c        data = sel
+000112d0: 662e 7472 7565 5f65 766f 6b65 645f 6461  f.true_evoked_da
+000112e0: 7461 0d0a 2020 2020 2020 2020 2020 2020  ta..            
+000112f0: 6966 206e 6f74 2074 6974 6c65 3a0d 0a20  if not title:.. 
+00011300: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00011310: 6974 6c65 203d 2027 5472 7565 2050 6174  itle = 'True Pat
+00011320: 7465 726e 7327 0d0a 2020 2020 2020 2020  terns'..        
+00011330: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00011340: 2020 2074 6974 6c65 203d 2027 4d6f 6465     title = 'Mode
+00011350: 6c2d 6465 7269 7665 6420 7061 7474 6572  l-derived patter
+00011360: 6e73 270d 0a0d 0a20 2020 2020 2020 2069  ns'....        i
+00011370: 6620 7420 6973 204e 6f6e 653a 0d0a 2020  f t is None:..  
+00011380: 2020 2020 2020 2020 2020 7420 3d20 6e70            t = np
+00011390: 2e61 7267 6d61 7828 6e70 2e6d 6561 6e28  .argmax(np.mean(
+000113a0: 6461 7461 2a2a 322c 2061 7869 733d 3029  data**2, axis=0)
+000113b0: 2e6d 6561 6e28 2d31 2929 0d0a 2020 2020  .mean(-1))..    
+000113c0: 2020 2020 7469 746c 6520 3d20 7469 746c      title = titl
+000113d0: 6520 2b20 2027 743d 7b7d 272e 666f 726d  e +  't={}'.form
+000113e0: 6174 2874 290d 0a20 2020 2020 2020 2065  at(t)..        e
+000113f0: 6420 3d20 6e70 2e73 7461 636b 285b 6461  d = np.stack([da
+00011400: 7461 5b69 2c20 742c 203a 5d20 666f 7220  ta[i, t, :] for 
+00011410: 6920 696e 2072 616e 6765 286e 295d 2c20  i in range(n)], 
+00011420: 6178 6973 3d2d 3129 0d0a 2020 2020 2020  axis=-1)..      
+00011430: 2020 6173 7365 7274 2065 642e 6e64 696d    assert ed.ndim
+00011440: 3d3d 320d 0a20 2020 2020 2020 2074 6f70  ==2..        top
+00011450: 6f70 6c6f 7420 3d20 7365 6c66 2e70 6c6f  oplot = self.plo
+00011460: 745f 746f 706f 7328 6564 2c20 7365 6e73  t_topos(ed, sens
+00011470: 6f72 5f6c 6179 6f75 743d 7365 6e73 6f72  or_layout=sensor
+00011480: 5f6c 6179 6f75 742c 0d0a 2020 2020 2020  _layout,..      
+00011490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114a0: 2020 2020 2020 2020 2020 2020 2063 6c61               cla
+000114b0: 7373 5f73 7562 7365 743d 636c 6173 735f  ss_subset=class_
+000114c0: 7375 6273 6574 2c20 7469 746c 653d 7469  subset, title=ti
+000114d0: 746c 6529 0d0a 0d0a 2020 2020 2020 2020  tle)....        
+000114e0: 2374 6f70 6f70 6c6f 742e 6669 6775 7265  #topoplot.figure
+000114f0: 2e73 7570 7469 746c 6528 7469 746c 6529  .suptitle(title)
+00011500: 0d0a 2020 2020 2020 2020 746f 706f 706c  ..        topopl
+00011510: 6f74 2e73 686f 7728 290d 0a20 2020 2020  ot.show()..     
+00011520: 2020 2069 6620 7361 7665 6669 673a 0d0a     if savefig:..
+00011530: 2020 2020 2020 2020 2020 2020 6669 676e              fign
+00011540: 616d 6520 3d20 272d 272e 6a6f 696e 285b  ame = '-'.join([
+00011550: 7365 6c66 2e6d 6574 612e 6461 7461 5b27  self.meta.data['
+00011560: 7061 7468 275d 202b 2073 656c 662e 7363  path'] + self.sc
+00011570: 6f70 652c 2073 656c 662e 6d65 7461 2e64  ope, self.meta.d
+00011580: 6174 615b 2764 6174 615f 6964 275d 2c20  ata['data_id'], 
+00011590: 7469 746c 652c 2022 746f 706f 732e 7376  title, "topos.sv
+000115a0: 6722 5d29 0d0a 2020 2020 2020 2020 2020  g"])..          
+000115b0: 2020 746f 706f 706c 6f74 2e73 6176 6566    topoplot.savef
+000115c0: 6967 2866 6967 6e61 6d65 2c20 666f 726d  ig(figname, form
+000115d0: 6174 3d27 7376 6727 2c20 7472 616e 7370  at='svg', transp
+000115e0: 6172 656e 743d 5472 7565 290d 0a20 2020  arent=True)..   
+000115f0: 2020 2020 2072 6574 7572 6e20 746f 706f       return topo
+00011600: 706c 6f74 0d0a 2020 2020 0d0a 2020 2020  plot..    ..    
+00011610: 6465 6620 706c 6f74 5f74 6f70 6f73 2873  def plot_topos(s
+00011620: 656c 662c 2074 6f70 6f73 2c20 7365 6e73  elf, topos, sens
+00011630: 6f72 5f6c 6179 6f75 743d 2756 6563 746f  or_layout='Vecto
+00011640: 7276 6965 772d 6d61 6727 2c20 636c 6173  rview-mag', clas
+00011650: 735f 7375 6273 6574 3d4e 6f6e 652c 0d0a  s_subset=None,..
+00011660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011670: 2020 2074 6974 6c65 3d22 436c 6173 7320     title="Class 
+00011680: 2567 2229 3a0d 0a20 2020 2020 2020 2022  %g"):..        "
+00011690: 2222 0d0a 2020 2020 2020 2020 506c 6f74  ""..        Plot
+000116a0: 2061 6e79 2073 7061 7469 616c 2064 6973   any spatial dis
+000116b0: 7472 6962 7574 696f 6e20 696e 2074 6865  tribution in the
+000116c0: 2073 656e 736f 7220 7370 6163 652e 0d0a   sensor space...
+000116d0: 2020 2020 2020 2020 544f 444f 3a20 496e          TODO: In
+000116e0: 7465 7270 6f6c 6174 696f 6e3f 3f0d 0a0d  terpolation??...
+000116f0: 0a0d 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+00011700: 6574 6572 730d 0a20 2020 2020 2020 202d  eters..        -
+00011710: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020  ---------..     
+00011720: 2020 2074 6f70 6f73 203a 206e 702e 6172     topos : np.ar
+00011730: 7261 790d 0a20 2020 2020 2020 2020 2020  ray..           
+00011740: 205b 6e5f 6368 2c20 6e5f 636c 6173 7365   [n_ch, n_classe
+00011750: 732c 202e 2e2e 5d0d 0a20 2020 2020 2020  s, ...]..       
+00011760: 2073 656e 736f 725f 6c61 796f 7574 203a   sensor_layout :
+00011770: 2054 5950 452c 206f 7074 696f 6e61 6c0d   TYPE, optional.
+00011780: 0a20 2020 2020 2020 2020 2020 2044 4553  .            DES
+00011790: 4352 4950 5449 4f4e 2e20 5468 6520 6465  CRIPTION. The de
+000117a0: 6661 756c 7420 6973 2027 5665 6374 6f72  fault is 'Vector
+000117b0: 7669 6577 2d6d 6167 272e 0d0a 2020 2020  view-mag'...    
+000117c0: 2020 2020 636c 6173 735f 7375 6273 6574      class_subset
+000117d0: 2020 3a20 6e70 2e61 7272 6179 2c20 6f70    : np.array, op
+000117e0: 7469 6f6e 616c 0d0a 0d0a 2020 2020 2020  tional....      
+000117f0: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
+00011800: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
+00011810: 2020 2020 4e6f 6e65 2e0d 0a0d 0a20 2020      None.....   
+00011820: 2020 2020 2022 2222 0d0a 200d 0a20 2020       """.. ..   
+00011830: 2020 2020 2069 6620 746f 706f 732e 6e64       if topos.nd
+00011840: 696d 203e 2032 3a0d 0a20 2020 2020 2020  im > 2:..       
+00011850: 2020 2020 2074 6f70 6f73 203d 2074 6f70       topos = top
+00011860: 6f73 2e6d 6561 6e28 2d31 290d 0a20 2020  os.mean(-1)..   
+00011870: 2020 2020 2074 6f70 6f73 5f6e 6577 203d       topos_new =
+00011880: 2074 6f70 6f73 202f 2074 6f70 6f73 2e73   topos / topos.s
+00011890: 7464 2830 2c20 6b65 6570 6469 6d73 3d54  td(0, keepdims=T
+000118a0: 7275 6529 0d0a 0d0a 2020 2020 2020 2020  rue)....        
+000118b0: 6e20 3d20 746f 706f 732e 7368 6170 655b  n = topos.shape[
+000118c0: 315d 0d0a 0d0a 2020 2020 2020 2020 6966  1]....        if
+000118d0: 2063 6c61 7373 5f73 7562 7365 7420 6973   class_subset is
+000118e0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+000118f0: 2020 2020 636c 6173 735f 7375 6273 6574      class_subset
+00011900: 203d 206e 702e 6172 616e 6765 2830 2c20   = np.arange(0, 
+00011910: 206e 2c20 312e 290d 0a0d 0a20 2020 2020   n, 1.)....     
+00011920: 2020 2066 616b 655f 6576 6f6b 6564 203d     fake_evoked =
+00011930: 2073 656c 662e 6d61 6b65 5f66 616b 655f   self.make_fake_
+00011940: 6576 6f6b 6564 2874 6f70 6f73 5f6e 6577  evoked(topos_new
+00011950: 2c20 7365 6e73 6f72 5f6c 6179 6f75 7429  , sensor_layout)
+00011960: 0d0a 0d0a 2020 2020 2020 2020 6674 203d  ....        ft =
+00011970: 2066 616b 655f 6576 6f6b 6564 2e70 6c6f   fake_evoked.plo
+00011980: 745f 746f 706f 6d61 7028 7469 6d65 733d  t_topomap(times=
+00011990: 636c 6173 735f 7375 6273 6574 2c0d 0a20  class_subset,.. 
+000119a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119c0: 2020 2063 6f6c 6f72 6261 723d 5472 7565     colorbar=True
+000119d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000119e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119f0: 2020 2020 2020 2073 6361 6c69 6e67 733d         scalings=
+00011a00: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
+00011a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a20: 2020 2020 2020 2020 7469 6d65 5f66 6f72          time_for
+00011a30: 6d61 743d 7469 746c 652c 0d0a 2020 2020  mat=title,..    
+00011a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a60: 6f75 746c 696e 6573 3d27 6865 6164 272c  outlines='head',
+00011a70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a90: 2020 2020 2020 2376 6c69 6d3d 206e 702e        #vlim= np.
+00011aa0: 7065 7263 656e 7469 6c65 2874 6f70 6f73  percentile(topos
+00011ab0: 2c20 5b35 2c20 3935 5d29 0d0a 2020 2020  , [5, 95])..    
+00011ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ae0: 290d 0a20 2020 2020 2020 2023 6674 2e73  )..        #ft.s
+00011af0: 686f 7728 290d 0a20 2020 2020 2020 2072  how()..        r
+00011b00: 6574 7572 6e20 6674 0d0a 2020 2020 0d0a  eturn ft..    ..
+00011b10: 2020 2020 6465 6620 6d61 6b65 5f66 616b      def make_fak
+00011b20: 655f 6576 6f6b 6564 2873 656c 662c 2074  e_evoked(self, t
+00011b30: 6f70 6f73 2c20 7365 6e73 6f72 5f6c 6179  opos, sensor_lay
+00011b40: 6f75 7429 3a0d 0a20 2020 2020 2020 2069  out):..        i
+00011b50: 6620 2769 6e66 6f27 206e 6f74 2069 6e20  f 'info' not in 
+00011b60: 7365 6c66 2e6d 6574 612e 6461 7461 2e6b  self.meta.data.k
+00011b70: 6579 7328 293a 0d0a 2020 2020 2020 2020  eys():..        
+00011b80: 2020 2020 6c6f 203d 2063 6861 6e6e 656c      lo = channel
+00011b90: 732e 7265 6164 5f6c 6179 6f75 7428 7365  s.read_layout(se
+00011ba0: 6e73 6f72 5f6c 6179 6f75 7429 0d0a 2020  nsor_layout)..  
+00011bb0: 2020 2020 2020 2020 2020 236c 6f20 3d20            #lo = 
+00011bc0: 6368 616e 6e65 6c73 2e67 656e 6572 6174  channels.generat
+00011bd0: 655f 3264 5f6c 6179 6f75 7428 6c6f 2e70  e_2d_layout(lo.p
+00011be0: 6f73 290d 0a20 2020 2020 2020 2020 2020  os)..           
+00011bf0: 2069 6e66 6f20 3d20 6372 6561 7465 5f69   info = create_i
+00011c00: 6e66 6f28 6c6f 2e6e 616d 6573 2c20 312e  nfo(lo.names, 1.
+00011c10: 2c20 7365 6e73 6f72 5f6c 6179 6f75 742e  , sensor_layout.
+00011c20: 7370 6c69 7428 272d 2729 5b2d 315d 290d  split('-')[-1]).
+00011c30: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
+00011c40: 675f 7879 203d 206e 702e 6d65 616e 286c  g_xy = np.mean(l
+00011c50: 6f2e 706f 735b 3a2c 203a 325d 2c20 3029  o.pos[:, :2], 0)
+00011c60: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00011c70: 7220 692c 2063 6820 696e 2065 6e75 6d65  r i, ch in enume
+00011c80: 7261 7465 286c 6f2e 6e61 6d65 7329 3a0d  rate(lo.names):.
+00011c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011ca0: 2069 6620 696e 666f 5b27 6368 7327 5d5b   if info['chs'][
+00011cb0: 695d 5b27 6368 5f6e 616d 6527 5d20 3d3d  i]['ch_name'] ==
+00011cc0: 2063 683a 0d0a 2020 2020 2020 2020 2020   ch:..          
+00011cd0: 2020 2020 2020 2020 2020 696e 666f 5b27            info['
+00011ce0: 6368 7327 5d5b 695d 5b27 6c6f 6327 5d5b  chs'][i]['loc'][
+00011cf0: 3a32 5d20 3d20 286c 6f2e 706f 735b 692c  :2] = (lo.pos[i,
+00011d00: 203a 325d 202d 206f 7269 675f 7879 292f   :2] - orig_xy)/
+00011d10: 342e 350d 0a20 2020 2020 2020 2020 2020  4.5..           
+00011d20: 2020 2020 2020 2020 2023 696e 666f 5b27           #info['
+00011d30: 6368 7327 5d5b 695d 5b27 6c6f 6327 5d5b  chs'][i]['loc'][
+00011d40: 343a 5d20 3d20 300d 0a20 2020 2020 2020  4:] = 0..       
+00011d50: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00011d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d70: 2020 2020 7072 696e 7428 2243 6861 6e6e      print("Chann
+00011d80: 656c 206e 616d 6520 6d69 736d 6174 6368  el name mismatch
+00011d90: 2e20 696e 666f 3a20 7b7d 2076 7320 6c6f  . info: {} vs lo
+00011da0: 3a20 7b7d 222e 666f 726d 6174 280d 0a20  : {}".format(.. 
+00011db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011dc0: 2020 2020 2020 2069 6e66 6f5b 2763 6873         info['chs
+00011dd0: 275d 5b69 5d5b 2763 685f 6e61 6d65 275d  '][i]['ch_name']
+00011de0: 2c20 6368 2929 0d0a 2020 2020 2020 2020  , ch))..        
+00011df0: 2369 6e66 6f5b 2773 6672 6571 275d 203d  #info['sfreq'] =
+00011e00: 2031 0d0a 2020 2020 2020 2020 6661 6b65   1..        fake
+00011e10: 5f65 766f 6b65 6420 3d20 6576 6f6b 6564  _evoked = evoked
+00011e20: 2e45 766f 6b65 6441 7272 6179 2874 6f70  .EvokedArray(top
+00011e30: 6f73 2c20 696e 666f 290d 0a20 2020 2020  os, info)..     
+00011e40: 2020 2072 6574 7572 6e20 6661 6b65 5f65     return fake_e
+00011e50: 766f 6b65 640d 0a0d 0a0d 0a20 2020 2064  voked......    d
+00011e60: 6566 2065 7870 6c6f 7265 5f63 6f6d 706f  ef explore_compo
+00011e70: 6e65 6e74 7328 7365 6c66 2c20 7061 7474  nents(self, patt
+00011e80: 6572 6e73 5f73 7472 7563 742c 2073 6f72  erns_struct, sor
+00011e90: 7469 6e67 3d27 6f75 7470 7574 5f63 6f72  ting='output_cor
+00011ea0: 7227 2c0d 0a20 2020 2020 2020 2020 2020  r',..           
+00011eb0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00011ec0: 7465 6772 6174 653d 276d 6178 272c 2069  tegrate='max', i
+00011ed0: 6e66 6f3d 4e6f 6e65 2c20 7365 6e73 6f72  nfo=None, sensor
+00011ee0: 5f6c 6179 6f75 743d 2756 6563 746f 7276  _layout='Vectorv
+00011ef0: 6965 772d 6772 6164 272c 0d0a 2020 2020  iew-grad',..    
+00011f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f10: 2020 2020 2063 6c61 7373 5f6e 616d 6573       class_names
+00011f20: 3d4e 6f6e 6529 3a0d 0a20 2020 2020 2020  =None):..       
+00011f30: 2022 2222 506c 6f74 7320 7468 6520 7765   """Plots the we
+00011f40: 6967 6874 7320 6f66 2074 6865 206f 7574  ights of the out
+00011f50: 7075 7420 6c61 7965 722e 0d0a 0d0a 2020  put layer.....  
+00011f60: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00011f70: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
+00011f80: 2d2d 2d2d 0d0a 0d0a 2020 2020 2020 2020  ----....        
+00011f90: 7061 7420 3a20 696e 7420 5b30 2c20 7365  pat : int [0, se
+00011fa0: 6c66 2e73 7065 6373 5b27 6e5f 6c61 7465  lf.specs['n_late
+00011fb0: 6e74 275d 290d 0a20 2020 2020 2020 2020  nt'])..         
+00011fc0: 2020 2049 6e64 6578 206f 6620 7468 6520     Index of the 
+00011fd0: 6c61 7465 6e74 2063 6f6d 706f 6e65 6e74  latent component
+00011fe0: 2074 6f20 6869 676c 6967 6874 0d0a 0d0a   to higlight....
+00011ff0: 2020 2020 2020 2020 7420 3a20 696e 7420          t : int 
+00012000: 5b30 2c20 7365 6c66 2e68 5f70 6172 616d  [0, self.h_param
+00012010: 735b 276e 5f74 275d 290d 0a20 2020 2020  s['n_t'])..     
+00012020: 2020 2020 2020 2049 6e64 6578 206f 6620         Index of 
+00012030: 7469 6d65 706f 696e 7420 746f 2068 6967  timepoint to hig
+00012040: 686c 6967 6874 0d0a 0d0a 2020 2020 2020  hlight....      
+00012050: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
+00012060: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
+00012070: 2020 2020 6669 6775 7265 203a 0d0a 2020      figure :..  
+00012080: 2020 2020 2020 2020 2020 496d 7368 6f77            Imshow
+00012090: 205b 6e5f 6c61 7465 6e74 2c20 795f 7368   [n_latent, y_sh
+000120a0: 6170 655d 0d0a 0d0a 2020 2020 2020 2020  ape]....        
+000120b0: 2222 220d 0a20 2020 2020 2020 2073 656c  """..        sel
+000120c0: 662e 6d65 7461 2e65 7870 6c6f 7265 5f63  f.meta.explore_c
+000120d0: 6f6d 706f 6e65 6e74 7328 290d 0a0d 0a0d  omponents().....
+000120e0: 0a0d 0a0d 0a20 2020 2064 6566 2070 6c6f  .....    def plo
+000120f0: 745f 7761 7665 666f 726d 7328 7365 6c66  t_waveforms(self
+00012100: 2c20 7061 7474 6572 6e73 5f73 7472 7563  , patterns_struc
+00012110: 742c 2073 6f72 7469 6e67 3d27 636f 6d70  t, sorting='comp
+00012120: 7769 7365 5f6c 6f73 7327 2c20 746d 696e  wise_loss', tmin
+00012130: 3d30 2c20 636c 6173 735f 6e61 6d65 733d  =0, class_names=
+00012140: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
+00012150: 2020 2020 2020 2020 2020 2020 2020 6270                bp
+00012160: 5f66 696c 7465 723d 4661 6c73 652c 2074  _filter=False, t
+00012170: 6c69 6d3d 4e6f 6e65 2c20 6170 706c 795f  lim=None, apply_
+00012180: 6b65 726e 656c 733d 4661 6c73 6529 3a0d  kernels=False):.
+00012190: 0a20 2020 2020 2020 2022 2222 506c 6f74  .        """Plot
+000121a0: 7320 7469 6d65 636f 7572 7365 7320 6f66  s timecourses of
+000121b0: 206c 6174 656e 7420 636f 6d70 6f6e 656e   latent componen
+000121c0: 7473 2e0d 0a0d 0a20 2020 2020 2020 2050  ts.....        P
+000121d0: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
+000121e0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
+000121f0: 2020 2020 2020 2074 6d69 6e20 3a20 666c         tmin : fl
+00012200: 6f61 740d 0a20 2020 2020 2020 2020 2020  oat..           
+00012210: 2042 6567 696e 6e69 6e67 206f 6620 7468   Beginning of th
+00012220: 6520 4d45 4720 6570 6f63 6820 7769 7468  e MEG epoch with
+00012230: 2072 6567 6172 6420 746f 2072 6566 6572   regard to refer
+00012240: 656e 6365 2065 7665 6e74 2e0d 0a20 2020  ence event...   
+00012250: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
+00012260: 7320 746f 2030 2e0d 0a0d 0a0d 0a20 2020  s to 0.......   
+00012270: 2020 2020 2073 6f72 7469 6e67 203a 2073       sorting : s
+00012280: 7472 0d0a 2020 2020 2020 2020 2020 2020  tr..            
+00012290: 6865 7572 6973 7469 6320 666f 7220 7365  heuristic for se
+000122a0: 6c65 6374 696e 6720 7265 6c65 7661 6e74  lecting relevant
+000122b0: 2063 6f6d 706f 6e65 6e74 732e 2053 6565   components. See
+000122c0: 204c 4643 4e4e 2e5f 736f 7274 696e 670d   LFCNN._sorting.
+000122d0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+000122e0: 2020 2020 2020 2369 6620 6e6f 7420 6861        #if not ha
+000122f0: 7361 7474 7228 7365 6c66 2c20 2777 6176  sattr(self, 'wav
+00012300: 6566 6f72 6d73 2729 3a0d 0a20 2020 2020  eforms'):..     
+00012310: 2020 2023 2020 2020 7365 6c66 2e63 6f6d     #    self.com
+00012320: 7075 7465 5f70 6174 7465 726e 7328 7365  pute_patterns(se
+00012330: 6c66 2e64 6174 6173 6574 290d 0a0d 0a20  lf.dataset).... 
+00012340: 2020 2020 2020 2023 6966 206e 6f74 2068         #if not h
+00012350: 6173 6174 7472 2873 656c 662c 2027 756f  asattr(self, 'uo
+00012360: 7264 6572 2729 3a0d 0a20 2020 2020 2020  rder'):..       
+00012370: 206f 7264 6572 2c20 5f20 3d20 7365 6c66   order, _ = self
+00012380: 2e5f 736f 7274 696e 6728 7061 7474 6572  ._sorting(patter
+00012390: 6e73 5f73 7472 7563 742c 2073 6f72 7469  ns_struct, sorti
+000123a0: 6e67 290d 0a20 2020 2020 2020 2073 656c  ng)..        sel
+000123b0: 662e 756f 7264 6572 203d 206f 7264 6572  f.uorder = order
+000123c0: 2e72 6176 656c 2829 0d0a 2020 2020 2020  .ravel()..      
+000123d0: 2020 7761 7665 666f 726d 7320 3d20 7061    waveforms = pa
+000123e0: 7474 6572 6e73 5f73 7472 7563 745b 2763  tterns_struct['c
+000123f0: 636d 7327 5d5b 2774 636f 6e76 275d 0d0a  cms']['tconv']..
+00012400: 0d0a 2020 2020 2020 2020 2020 2020 2373  ..            #s
+00012410: 656c 662e 756f 7264 6572 203d 206e 702e  elf.uorder = np.
+00012420: 7371 7565 657a 6528 6f72 6465 7229 0d0a  squeeze(order)..
+00012430: 2020 2020 2020 2020 2370 7269 6e74 2873          #print(s
+00012440: 656c 662e 756f 7264 6572 290d 0a20 2020  elf.uorder)..   
+00012450: 2020 2020 2069 6620 6e6f 7420 636c 6173       if not clas
+00012460: 735f 6e61 6d65 733a 0d0a 2020 2020 2020  s_names:..      
+00012470: 2020 2020 2020 636c 6173 735f 6e61 6d65        class_name
+00012480: 7320 3d20 5b22 436c 6173 7320 7b7d 222e  s = ["Class {}".
+00012490: 666f 726d 6174 2869 2920 666f 7220 6920  format(i) for i 
+000124a0: 696e 2072 616e 6765 2873 656c 662e 795f  in range(self.y_
+000124b0: 7368 6170 655b 2d31 5d29 5d0d 0a0d 0a20  shape[-1])].... 
+000124c0: 2020 2020 2020 2066 2c20 6178 203d 2070         f, ax = p
+000124d0: 6c74 2e73 7562 706c 6f74 7328 322c 2032  lt.subplots(2, 2
+000124e0: 290d 0a20 2020 2020 2020 2066 2e73 6574  )..        f.set
+000124f0: 5f73 697a 655f 696e 6368 6573 285b 3136  _size_inches([16
+00012500: 2c20 3136 5d29 0d0a 2020 2020 2020 2020  , 16])..        
+00012510: 6966 206e 702e 616e 7928 7365 6c66 2e75  if np.any(self.u
+00012520: 6f72 6465 7229 3a0d 0a20 2020 2020 2020  order):..       
+00012530: 2020 2020 2023 666f 7220 6a6a 2c20 756f       #for jj, uo
+00012540: 2069 6e20 656e 756d 6572 6174 6528 7365   in enumerate(se
+00012550: 6c66 2e75 6f72 6465 7229 3a0d 0a20 2020  lf.uorder):..   
+00012560: 2020 2020 2020 2020 206e 7420 3d20 7365           nt = se
+00012570: 6c66 2e64 6174 6173 6574 2e68 5f70 6172  lf.dataset.h_par
+00012580: 616d 735b 276e 5f74 275d 0d0a 0d0a 2020  ams['n_t']....  
+00012590: 2020 2020 2020 2020 2020 7473 7465 7020            tstep 
+000125a0: 3d20 312f 666c 6f61 7428 7365 6c66 2e64  = 1/float(self.d
+000125b0: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
+000125c0: 2766 7327 5d29 0d0a 2020 2020 2020 2020  'fs'])..        
+000125d0: 2020 2020 7469 6d65 7320 3d20 746d 696e      times = tmin
+000125e0: 202b 2074 7374 6570 2a6e 702e 6172 616e   + tstep*np.aran
+000125f0: 6765 286e 7429 0d0a 2020 2020 2020 2020  ge(nt)..        
+00012600: 2020 2020 6966 2061 7070 6c79 5f6b 6572      if apply_ker
+00012610: 6e65 6c73 3a0d 0a20 2020 2020 2020 2020  nels:..         
+00012620: 2020 2020 2020 2073 6361 6c65 645f 7761         scaled_wa
+00012630: 7665 666f 726d 7320 3d20 6e70 2e61 7272  veforms = np.arr
+00012640: 6179 285b 6e70 2e63 6f6e 766f 6c76 6528  ay([np.convolve(
+00012650: 6b65 726e 2c20 7766 2c20 2773 616d 6527  kern, wf, 'same'
+00012660: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00012670: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00012680: 6f72 206b 6572 6e2c 2077 6620 696e 207a  or kern, wf in z
+00012690: 6970 2873 656c 662e 6669 6c74 6572 732c  ip(self.filters,
+000126a0: 2073 656c 662e 7761 7665 666f 726d 7329   self.waveforms)
+000126b0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+000126c0: 2020 2020 2373 6361 6c65 645f 7761 7665      #scaled_wave
+000126d0: 666f 726d 7320 3d28 7363 616c 6564 5f77  forms =(scaled_w
+000126e0: 6176 6566 6f72 6d73 202d 2073 6361 6c65  aveforms - scale
+000126f0: 645f 7761 7665 666f 726d 732e 6d65 616e  d_waveforms.mean
+00012700: 282d 312c 206b 6565 7064 696d 733d 5472  (-1, keepdims=Tr
+00012710: 7565 2929 2020 2f20 2832 2a73 6361 6c65  ue))  / (2*scale
+00012720: 645f 7761 7665 666f 726d 732e 7374 6428  d_waveforms.std(
+00012730: 2d31 2c20 6b65 6570 6469 6d73 3d54 7275  -1, keepdims=Tru
+00012740: 6529 290d 0a20 2020 2020 2020 2020 2020  e))..           
+00012750: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00012760: 2020 2020 2020 2020 2373 6361 6c69 6e67          #scaling
+00012770: 203d 2033 2a6e 702e 6d65 616e 286e 702e   = 3*np.mean(np.
+00012780: 7374 6428 7365 6c66 2e77 6176 6566 6f72  std(self.wavefor
+00012790: 6d73 2c20 2d31 2929 0d0a 0d0a 2020 2020  ms, -1))....    
+000127a0: 2020 2020 2020 2020 2020 2020 7363 616c              scal
+000127b0: 6564 5f77 6176 6566 6f72 6d73 203d 2028  ed_waveforms = (
+000127c0: 7761 7665 666f 726d 7320 2d20 7761 7665  waveforms - wave
+000127d0: 666f 726d 732e 6d65 616e 282d 312c 206b  forms.mean(-1, k
+000127e0: 6565 7064 696d 733d 5472 7565 2929 2020  eepdims=True))  
+000127f0: 2f20 2832 2a77 6176 6566 6f72 6d73 2e73  / (2*waveforms.s
+00012800: 7464 282d 312c 206b 6565 7064 696d 733d  td(-1, keepdims=
+00012810: 5472 7565 2929 0d0a 2020 2020 2020 2020  True))..        
+00012820: 2020 2020 6966 2062 705f 6669 6c74 6572      if bp_filter
+00012830: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00012840: 2020 2073 6361 6c65 645f 7761 7665 666f     scaled_wavefo
+00012850: 726d 7320 3d20 7363 616c 6564 5f77 6176  rms = scaled_wav
+00012860: 6566 6f72 6d73 2e61 7374 7970 6528 6e70  eforms.astype(np
+00012870: 2e66 6c6f 6174 3634 290d 0a20 2020 2020  .float64)..     
+00012880: 2020 2020 2020 2020 2020 2073 6361 6c65             scale
+00012890: 645f 7761 7665 666f 726d 7320 3d20 6669  d_waveforms = fi
+000128a0: 6c74 6572 5f64 6174 6128 7363 616c 6564  lter_data(scaled
+000128b0: 5f77 6176 6566 6f72 6d73 2c0d 0a20 2020  _waveforms,..   
+000128c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000128d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000128e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000128f0: 656c 662e 6461 7461 7365 742e 685f 7061  elf.dataset.h_pa
+00012900: 7261 6d73 5b27 6673 275d 2c0d 0a20 2020  rams['fs'],..   
+00012910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012930: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00012940: 5f66 7265 713d 6270 5f66 696c 7465 725b  _freq=bp_filter[
+00012950: 305d 2c0d 0a20 2020 2020 2020 2020 2020  0],..           
+00012960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012980: 2020 2020 2020 2068 5f66 7265 713d 6270         h_freq=bp
+00012990: 5f66 696c 7465 725b 315d 2c0d 0a20 2020  _filter[1],..   
+000129a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129c0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000129d0: 6574 686f 643d 2769 6972 272c 0d0a 2020  ethod='iir',..  
+000129e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a10: 7665 7262 6f73 653d 4661 6c73 6529 0d0a  verbose=False)..
+00012a20: 2020 2020 2020 2020 2020 2020 5b61 785b              [ax[
+00012a30: 302c 2030 5d2e 706c 6f74 2874 696d 6573  0, 0].plot(times
+00012a40: 2c20 7766 2c20 636f 6c6f 723d 2774 6162  , wf, color='tab
+00012a50: 3a67 7265 7927 2c20 616c 7068 613d 2e32  :grey', alpha=.2
+00012a60: 3529 0d0a 2020 2020 2020 2020 2020 2020  5)..            
+00012a70: 2066 6f72 2069 2c20 7766 2069 6e20 656e   for i, wf in en
+00012a80: 756d 6572 6174 6528 7363 616c 6564 5f77  umerate(scaled_w
+00012a90: 6176 6566 6f72 6d73 2920 6966 2069 206e  aveforms) if i n
+00012aa0: 6f74 2069 6e20 7365 6c66 2e75 6f72 6465  ot in self.uorde
+00012ab0: 725d 0d0a 0d0a 2020 2020 2020 2020 2020  r]....          
+00012ac0: 2020 5b61 785b 302c 2030 5d2e 706c 6f74    [ax[0, 0].plot
+00012ad0: 2874 696d 6573 2c0d 0a20 2020 2020 2020  (times,..       
+00012ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012af0: 2020 2073 6361 6c65 645f 7761 7665 666f     scaled_wavefo
+00012b00: 726d 735b 756f 5d2c 0d0a 2020 2020 2020  rms[uo],..      
+00012b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b20: 2020 2020 6c69 6e65 7769 6474 683d 322e      linewidth=2.
+00012b30: 2c20 6c61 6265 6c3d 636c 6173 735f 6e61  , label=class_na
+00012b40: 6d65 735b 695d 2c20 616c 7068 613d 2e37  mes[i], alpha=.7
+00012b50: 3529 0d0a 2020 2020 2020 2020 2020 2020  5)..            
+00012b60: 2066 6f72 2069 2c20 756f 2069 6e20 656e   for i, uo in en
+00012b70: 756d 6572 6174 6528 7365 6c66 2e75 6f72  umerate(self.uor
+00012b80: 6465 7229 5d0d 0a20 2020 2020 2020 2020  der)]..         
+00012b90: 2020 2061 785b 302c 2030 5d2e 7365 745f     ax[0, 0].set_
+00012ba0: 7469 746c 6528 274c 6174 656e 7420 636f  title('Latent co
+00012bb0: 6d70 6f6e 656e 7420 7761 7665 666f 726d  mponent waveform
+00012bc0: 7327 290d 0a20 2020 2020 2020 2020 2020  s')..           
+00012bd0: 2069 6620 746c 696d 3a0d 0a20 2020 2020   if tlim:..     
+00012be0: 2020 2020 2020 2020 2020 2061 785b 302c             ax[0,
+00012bf0: 2030 5d2e 7365 745f 786c 696d 2874 6c69   0].set_xlim(tli
+00012c00: 6d29 0d0a 0d0a 2020 2020 2020 2020 2020  m)....          
+00012c10: 2020 7473 7465 7020 3d20 666c 6f61 7428    tstep = float(
+00012c20: 7365 6c66 2e73 7065 6373 5b27 7374 7269  self.specs['stri
+00012c30: 6465 275d 292f 7365 6c66 2e64 6174 6173  de'])/self.datas
+00012c40: 6574 2e68 5f70 6172 616d 735b 2766 7327  et.h_params['fs'
+00012c50: 5d0d 0a20 2020 2020 2020 2020 2020 2073  ]..            s
+00012c60: 7472 6964 6573 3120 3d20 6e70 2e61 7261  trides1 = np.ara
+00012c70: 6e67 6528 7469 6d65 735b 305d 2c20 7469  nge(times[0], ti
+00012c80: 6d65 735b 2d31 5d20 2b20 7473 7465 702f  mes[-1] + tstep/
+00012c90: 322c 2074 7374 6570 290d 0a20 2020 2020  2, tstep)..     
+00012ca0: 2020 2020 2020 2061 785b 312c 2030 5d2e         ax[1, 0].
+00012cb0: 7063 6f6c 6f72 2873 7472 6964 6573 312c  pcolor(strides1,
+00012cc0: 206e 702e 6172 616e 6765 2873 656c 662e   np.arange(self.
+00012cd0: 7370 6563 735b 276e 5f6c 6174 656e 7427  specs['n_latent'
+00012ce0: 5d29 2c0d 0a20 2020 2020 2020 2020 2020  ]),..           
+00012cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d00: 6e70 2e6d 6561 6e28 7365 6c66 2e74 635f  np.mean(self.tc_
+00012d10: 6f75 742c 2030 292e 542c 2023 7368 6164  out, 0).T, #shad
+00012d20: 696e 673d 2761 7574 6f27 0d0a 2020 2020  ing='auto'..    
+00012d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d40: 2020 2020 2020 2029 0d0a 2320 2020 2020         )..#     
+00012d50: 2020 2020 2020 2074 636f 7574 203d 206e         tcout = n
+00012d60: 702e 6d65 616e 2873 656c 662e 7463 5f6f  p.mean(self.tc_o
+00012d70: 7574 5f75 6e70 6f6f 6c65 642c 3029 2e54  ut_unpooled,0).T
+00012d80: 202d 2073 656c 662e 745f 636f 6e76 5f62   - self.t_conv_b
+00012d90: 6961 7365 735b 3a2c 204e 6f6e 655d 0d0a  iases[:, None]..
+00012da0: 2320 2020 2020 2020 2020 2020 205b 6178  #            [ax
+00012db0: 5b31 2c20 305d 2e70 6c6f 7428 7469 6d65  [1, 0].plot(time
+00012dc0: 732c 2074 636f 7574 692c 2063 6f6c 6f72  s, tcouti, color
+00012dd0: 3d27 7461 623a 6772 6579 272c 2061 6c70  ='tab:grey', alp
+00012de0: 6861 3d2e 3235 290d 0a23 2020 2020 2020  ha=.25)..#      
+00012df0: 2020 2020 2020 666f 7220 692c 2074 636f        for i, tco
+00012e00: 7574 6920 696e 2065 6e75 6d65 7261 7465  uti in enumerate
+00012e10: 2874 636f 7574 2920 6966 2069 206e 6f74  (tcout) if i not
+00012e20: 2069 6e20 7365 6c66 2e75 6f72 6465 725d   in self.uorder]
+00012e30: 0d0a 0d0a 2320 2020 2020 2020 2020 2020  ....#           
+00012e40: 205b 6178 5b31 2c20 305d 2e70 6c6f 7428   [ax[1, 0].plot(
+00012e50: 7469 6d65 732c 2074 636f 7574 5b75 6f5d  times, tcout[uo]
+00012e60: 2920 666f 7220 692c 2075 6f20 696e 2065  ) for i, uo in e
+00012e70: 6e75 6d65 7261 7465 2873 656c 662e 756f  numerate(self.uo
+00012e80: 7264 6572 295d 0d0a 2020 2020 2020 2020  rder)]..        
+00012e90: 2020 2020 6178 5b31 2c20 305d 2e73 6574      ax[1, 0].set
+00012ea0: 5f74 6974 6c65 2822 4176 672e 2054 656d  _title("Avg. Tem
+00012eb0: 706f 7261 6c20 436f 6e76 6f6c 7574 696f  poral Convolutio
+00012ec0: 6e20 4f75 7470 7574 2229 0d0a 2020 2020  n Output")..    
+00012ed0: 2020 2020 2020 2020 6178 5b31 2c20 305d          ax[1, 0]
+00012ee0: 2e73 6574 5f79 6c61 6265 6c28 2243 6f6d  .set_ylabel("Com
+00012ef0: 706f 6e65 6e74 2069 6e64 6578 2229 0d0a  ponent index")..
+00012f00: 2020 2020 2020 2020 2020 2020 6178 5b31              ax[1
+00012f10: 2c20 305d 2e73 6574 5f78 6c61 6265 6c28  , 0].set_xlabel(
+00012f20: 2254 696d 652c 2073 2229 0d0a 2020 2020  "Time, s")..    
+00012f30: 2020 2020 2020 2020 6966 2074 6c69 6d3a          if tlim:
+00012f40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012f50: 2020 6178 5b31 2c20 305d 2e73 6574 5f78    ax[1, 0].set_x
+00012f60: 6c69 6d28 746c 696d 290d 0a20 2020 2020  lim(tlim)..     
+00012f70: 2020 2020 2020 2069 6620 6e6f 7420 6861         if not ha
+00012f80: 7361 7474 7228 7365 6c66 2c20 2770 6174  sattr(self, 'pat
+00012f90: 7465 726e 5f77 6569 6768 7473 2729 3a0d  tern_weights'):.
+00012fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012fb0: 2070 6174 7465 726e 5f77 6569 6768 7473   pattern_weights
+00012fc0: 203d 206e 702e 6569 6e73 756d 2827 696a   = np.einsum('ij
+00012fd0: 6b2c 206a 6b6c 202d 3e69 6b6c 272c 2073  k, jkl ->ikl', s
+00012fe0: 656c 662e 7463 5f6f 7574 2c20 7365 6c66  elf.tc_out, self
+00012ff0: 2e6f 7574 5f77 6569 6768 7473 290d 0a20  .out_weights).. 
+00013000: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00013010: 656c 662e 7061 7474 6572 6e5f 7765 6967  elf.pattern_weig
+00013020: 6874 7320 3d20 6e70 2e6d 6178 696d 756d  hts = np.maximum
+00013030: 2870 6174 7465 726e 5f77 6569 6768 7473  (pattern_weights
+00013040: 202b 2073 656c 662e 6f75 745f 6269 6173   + self.out_bias
+00013050: 6573 5b4e 6f6e 652c 203a 5d2c 2030 2e29  es[None, :], 0.)
+00013060: 2e6d 6561 6e28 3029 0d0a 0d0a 2020 2020  .mean(0)....    
+00013070: 2020 2020 2020 2020 6120 3d20 6178 5b30          a = ax[0
+00013080: 2c20 315d 2e70 636f 6c6f 7228 7365 6c66  , 1].pcolor(self
+00013090: 2e70 6174 7465 726e 5f77 6569 6768 7473  .pattern_weights
+000130a0: 2c20 636d 6170 3d27 626f 6e65 5f72 2729  , cmap='bone_r')
+000130b0: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
+000130c0: 7669 6465 7220 3d20 6d61 6b65 5f61 7865  vider = make_axe
+000130d0: 735f 6c6f 6361 7461 626c 6528 6178 5b30  s_locatable(ax[0
+000130e0: 2c31 5d29 0d0a 2020 2020 2020 2020 2020  ,1])..          
+000130f0: 2020 6361 7820 3d20 6469 7669 6465 722e    cax = divider.
+00013100: 6170 7065 6e64 5f61 7865 7328 2772 6967  append_axes('rig
+00013110: 6874 272c 2073 697a 653d 2735 2527 2c20  ht', size='5%', 
+00013120: 7061 643d 302e 3035 290d 0a20 2020 2020  pad=0.05)..     
+00013130: 2020 2020 2020 2066 2e63 6f6c 6f72 6261         f.colorba
+00013140: 7228 612c 2063 6178 3d63 6178 2c20 6f72  r(a, cax=cax, or
+00013150: 6965 6e74 6174 696f 6e3d 2776 6572 7469  ientation='verti
+00013160: 6361 6c27 290d 0a20 2020 2020 2020 2020  cal')..         
+00013170: 2020 2072 203d 205b 7074 6368 2e52 6563     r = [ptch.Rec
+00013180: 7461 6e67 6c65 2828 692c 2075 6f29 2c20  tangle((i, uo), 
+00013190: 7769 6474 683d 312c 0d0a 2020 2020 2020  width=1,..      
+000131a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000131b0: 2020 2020 2020 2020 2020 6865 6967 6874            height
+000131c0: 3d31 2c20 616e 676c 653d 302e 3029 2066  =1, angle=0.0) f
+000131d0: 6f72 2069 2c20 756f 2069 6e20 656e 756d  or i, uo in enum
+000131e0: 6572 6174 6528 7365 6c66 2e75 6f72 6465  erate(self.uorde
+000131f0: 7229 5d0d 0a20 2020 2020 2020 2020 2020  r)]..           
+00013200: 2070 6320 3d20 636f 6c6c 6563 7469 6f6e   pc = collection
+00013210: 732e 5061 7463 6843 6f6c 6c65 6374 696f  s.PatchCollectio
+00013220: 6e28 722c 2066 6163 6563 6f6c 6f72 3d4e  n(r, facecolor=N
+00013230: 6f6e 652c 2061 6c70 6861 3d2e 352c 0d0a  one, alpha=.5,..
+00013240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013260: 2020 2020 2020 2020 2020 2020 206c 696e               lin
+00013270: 6577 6964 7468 3d32 2e2c 0d0a 2020 2020  ewidth=2.,..    
+00013280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000132a0: 2020 2020 2020 2020 2065 6467 6563 6f6c           edgecol
+000132b0: 6f72 3d27 7461 623a 6f72 616e 6765 2729  or='tab:orange')
+000132c0: 0d0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
+000132d0: 5b30 2c20 315d 2e61 6464 5f63 6f6c 6c65  [0, 1].add_colle
+000132e0: 6374 696f 6e28 7063 290d 0a0d 0a20 2020  ction(pc)....   
+000132f0: 2020 2020 2020 2020 2061 785b 302c 2031           ax[0, 1
+00013300: 5d2e 7365 745f 7469 746c 6528 2250 6174  ].set_title("Pat
+00013310: 7465 726e 2077 6569 6768 7473 2229 0d0a  tern weights")..
+00013320: 2020 2020 2020 2020 2020 2020 6178 5b30              ax[0
+00013330: 2c20 315d 2e73 6574 5f79 6c61 6265 6c28  , 1].set_ylabel(
+00013340: 2243 6f6d 706f 6e65 6e74 2069 6e64 6578  "Component index
+00013350: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00013360: 6178 5b30 2c20 315d 2e73 6574 5f78 7469  ax[0, 1].set_xti
+00013370: 636b 7328 6e70 2e61 7261 6e67 6528 302e  cks(np.arange(0.
+00013380: 352c 2030 2e35 2b6c 656e 2863 6c61 7373  5, 0.5+len(class
+00013390: 5f6e 616d 6573 292c 2031 2929 0d0a 2020  _names), 1))..  
+000133a0: 2020 2020 2020 2020 2020 6178 5b30 2c20            ax[0, 
+000133b0: 315d 2e73 6574 5f78 7469 636b 6c61 6265  1].set_xticklabe
+000133c0: 6c73 2863 6c61 7373 5f6e 616d 6573 290d  ls(class_names).
+000133d0: 0a20 2020 2020 2020 2020 2020 2072 7073  .            rps
+000133e0: 7320 3d20 5b5d 0d0a 2020 2020 2020 2020  s = []..        
+000133f0: 2020 2020 666f 7220 692c 2066 6c74 2069      for i, flt i
+00013400: 6e20 656e 756d 6572 6174 6528 7365 6c66  n enumerate(self
+00013410: 2e66 696c 7465 7273 2e54 293a 0d0a 0d0a  .filters.T):....
+00013420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013430: 666c 7420 2d3d 2066 6c74 2e6d 6561 6e28  flt -= flt.mean(
+00013440: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00013450: 2020 2068 203d 2073 656c 662e 6672 6571     h = self.freq
+00013460: 5f72 6573 706f 6e73 6573 5b69 2c20 3a5d  _responses[i, :]
 00013470: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013480: 2020 7061 7474 6572 6e5f 7765 6967 6874    pattern_weight
-00013490: 7320 3d20 6e70 2e65 696e 7375 6d28 2769  s = np.einsum('i
-000134a0: 6a6b 2c20 6a6b 6c20 2d3e 696b 6c27 2c20  jk, jkl ->ikl', 
-000134b0: 7365 6c66 2e74 635f 6f75 742c 2073 656c  self.tc_out, sel
-000134c0: 662e 6f75 745f 7765 6967 6874 7329 0d0a  f.out_weights)..
-000134d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134e0: 7365 6c66 2e70 6174 7465 726e 5f77 6569  self.pattern_wei
-000134f0: 6768 7473 203d 206e 702e 6d61 7869 6d75  ghts = np.maximu
-00013500: 6d28 7061 7474 6572 6e5f 7765 6967 6874  m(pattern_weight
-00013510: 7320 2b20 7365 6c66 2e6f 7574 5f62 6961  s + self.out_bia
-00013520: 7365 735b 4e6f 6e65 2c20 3a5d 2c20 302e  ses[None, :], 0.
-00013530: 292e 6d65 616e 2830 290d 0a0d 0a20 2020  ).mean(0)....   
-00013540: 2020 2020 2020 2020 2061 203d 2061 785b           a = ax[
-00013550: 302c 2031 5d2e 7063 6f6c 6f72 2873 656c  0, 1].pcolor(sel
-00013560: 662e 7061 7474 6572 6e5f 7765 6967 6874  f.pattern_weight
-00013570: 732c 2063 6d61 703d 2762 6f6e 655f 7227  s, cmap='bone_r'
-00013580: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
-00013590: 6976 6964 6572 203d 206d 616b 655f 6178  ivider = make_ax
-000135a0: 6573 5f6c 6f63 6174 6162 6c65 2861 785b  es_locatable(ax[
-000135b0: 302c 315d 290d 0a20 2020 2020 2020 2020  0,1])..         
-000135c0: 2020 2063 6178 203d 2064 6976 6964 6572     cax = divider
-000135d0: 2e61 7070 656e 645f 6178 6573 2827 7269  .append_axes('ri
-000135e0: 6768 7427 2c20 7369 7a65 3d27 3525 272c  ght', size='5%',
-000135f0: 2070 6164 3d30 2e30 3529 0d0a 2020 2020   pad=0.05)..    
-00013600: 2020 2020 2020 2020 662e 636f 6c6f 7262          f.colorb
-00013610: 6172 2861 2c20 6361 783d 6361 782c 206f  ar(a, cax=cax, o
-00013620: 7269 656e 7461 7469 6f6e 3d27 7665 7274  rientation='vert
-00013630: 6963 616c 2729 0d0a 2020 2020 2020 2020  ical')..        
-00013640: 2020 2020 7220 3d20 5b70 7463 682e 5265      r = [ptch.Re
-00013650: 6374 616e 676c 6528 2869 2c20 756f 292c  ctangle((i, uo),
-00013660: 2077 6964 7468 3d31 2c0d 0a20 2020 2020   width=1,..     
-00013670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013680: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
-00013690: 743d 312c 2061 6e67 6c65 3d30 2e30 2920  t=1, angle=0.0) 
-000136a0: 666f 7220 692c 2075 6f20 696e 2065 6e75  for i, uo in enu
-000136b0: 6d65 7261 7465 2873 656c 662e 756f 7264  merate(self.uord
-000136c0: 6572 295d 0d0a 2020 2020 2020 2020 2020  er)]..          
-000136d0: 2020 7063 203d 2063 6f6c 6c65 6374 696f    pc = collectio
-000136e0: 6e73 2e50 6174 6368 436f 6c6c 6563 7469  ns.PatchCollecti
-000136f0: 6f6e 2872 2c20 6661 6365 636f 6c6f 723d  on(r, facecolor=
-00013700: 4e6f 6e65 2c20 616c 7068 613d 2e35 2c0d  None, alpha=.5,.
-00013710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013730: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-00013740: 6e65 7769 6474 683d 322e 2c0d 0a20 2020  newidth=2.,..   
-00013750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013770: 2020 2020 2020 2020 2020 6564 6765 636f            edgeco
-00013780: 6c6f 723d 2774 6162 3a6f 7261 6e67 6527  lor='tab:orange'
-00013790: 290d 0a20 2020 2020 2020 2020 2020 2061  )..            a
-000137a0: 785b 302c 2031 5d2e 6164 645f 636f 6c6c  x[0, 1].add_coll
-000137b0: 6563 7469 6f6e 2870 6329 0d0a 0d0a 2020  ection(pc)....  
-000137c0: 2020 2020 2020 2020 2020 6178 5b30 2c20            ax[0, 
-000137d0: 315d 2e73 6574 5f74 6974 6c65 2822 5061  1].set_title("Pa
-000137e0: 7474 6572 6e20 7765 6967 6874 7322 290d  ttern weights").
-000137f0: 0a20 2020 2020 2020 2020 2020 2061 785b  .            ax[
-00013800: 302c 2031 5d2e 7365 745f 796c 6162 656c  0, 1].set_ylabel
-00013810: 2822 436f 6d70 6f6e 656e 7420 696e 6465  ("Component inde
-00013820: 7822 290d 0a20 2020 2020 2020 2020 2020  x")..           
-00013830: 2061 785b 302c 2031 5d2e 7365 745f 7874   ax[0, 1].set_xt
-00013840: 6963 6b73 286e 702e 6172 616e 6765 2830  icks(np.arange(0
-00013850: 2e35 2c20 302e 352b 6c65 6e28 636c 6173  .5, 0.5+len(clas
-00013860: 735f 6e61 6d65 7329 2c20 3129 290d 0a20  s_names), 1)).. 
-00013870: 2020 2020 2020 2020 2020 2061 785b 302c             ax[0,
-00013880: 2031 5d2e 7365 745f 7874 6963 6b6c 6162   1].set_xticklab
-00013890: 656c 7328 636c 6173 735f 6e61 6d65 7329  els(class_names)
-000138a0: 0d0a 2020 2020 2020 2020 2020 2020 7270  ..            rp
-000138b0: 7373 203d 205b 5d0d 0a20 2020 2020 2020  ss = []..       
-000138c0: 2020 2020 2066 6f72 2069 2c20 666c 7420       for i, flt 
-000138d0: 696e 2065 6e75 6d65 7261 7465 2873 656c  in enumerate(sel
-000138e0: 662e 6669 6c74 6572 732e 5429 3a0d 0a0d  f.filters.T):...
-000138f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013900: 2066 6c74 202d 3d20 666c 742e 6d65 616e   flt -= flt.mean
-00013910: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00013920: 2020 2020 6820 3d20 7365 6c66 2e66 7265      h = self.fre
-00013930: 715f 7265 7370 6f6e 7365 735b 692c 203a  q_responses[i, :
-00013940: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00013950: 2020 2070 7364 203d 2073 656c 662e 7073     psd = self.ps
-00013960: 6473 5b69 2c20 3a5d 0d0a 0d0a 2020 2020  ds[i, :]....    
-00013970: 2020 2020 2020 2020 2020 2020 2372 7073              #rps
-00013980: 732e 6170 7065 6e64 2868 2f6e 702e 7375  s.append(h/np.su
-00013990: 6d28 6829 290d 0a20 2020 2020 2020 2020  m(h))..         
-000139a0: 2020 2020 2020 2072 7073 732e 6170 7065         rpss.appe
-000139b0: 6e64 2828 7073 642a 6829 2920 2325 292f  nd((psd*h)) #%)/
-000139c0: 6e70 2e73 756d 2870 7364 2a68 290d 0a0d  np.sum(psd*h)...
-000139d0: 0a20 2020 2020 2020 2020 2020 205b 6178  .            [ax
-000139e0: 5b31 2c20 315d 2e70 6c6f 7428 7365 6c66  [1, 1].plot(self
-000139f0: 2e66 7265 7173 2c20 7270 7373 5b75 6f5d  .freqs, rpss[uo]
-00013a00: 2c20 6c69 6e65 7769 6474 683d 322e 352c  , linewidth=2.5,
-00013a10: 206c 6162 656c 3d63 6c61 7373 5f6e 616d   label=class_nam
-00013a20: 6573 5b69 5d29 0d0a 2020 2020 2020 2020  es[i])..        
-00013a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a40: 2020 2020 2066 6f72 2069 2c20 756f 2069       for i, uo i
-00013a50: 6e20 656e 756d 6572 6174 6528 7365 6c66  n enumerate(self
-00013a60: 2e75 6f72 6465 7229 5d0d 0a20 2020 2020  .uorder)]..     
-00013a70: 2020 2020 2020 2061 785b 312c 2031 5d2e         ax[1, 1].
-00013a80: 7365 745f 786c 696d 2830 2c39 302e 290d  set_xlim(0,90.).
-00013a90: 0a20 2020 2020 2020 2020 2020 2061 785b  .            ax[
-00013aa0: 312c 2031 5d2e 7365 745f 7469 746c 6528  1, 1].set_title(
-00013ab0: 2252 656c 6174 6976 6520 706f 7765 722c  "Relative power,
-00013ac0: 2025 2229 0d0a 2020 2020 2020 2020 2020   %")..          
-00013ad0: 2020 6178 5b31 2c20 315d 2e73 6574 5f78    ax[1, 1].set_x
-00013ae0: 6c61 6265 6c28 2246 7265 7175 656e 6379  label("Frequency
-00013af0: 2c20 487a 2229 0d0a 2020 2020 2020 2020  , Hz")..        
-00013b00: 2020 2020 6178 5b31 2c20 315d 2e6c 6567      ax[1, 1].leg
-00013b10: 656e 6428 290d 0a20 2020 2020 2020 2020  end()..         
-00013b20: 2020 2070 6c74 2e73 686f 7728 290d 0a20     plt.show().. 
-00013b30: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00013b40: 6e0d 0a0d 0a0d 0a0d 0a20 2020 2064 6566  n........    def
-00013b50: 205f 736f 7274 696e 6728 7365 6c66 2c20   _sorting(self, 
-00013b60: 7061 7474 6572 6e73 5f73 7472 7563 742c  patterns_struct,
-00013b70: 2073 6f72 7469 6e67 3d27 636f 6d70 7769   sorting='compwi
-00013b80: 7365 5f6c 6f73 7327 2c20 6e5f 636f 6d70  se_loss', n_comp
-00013b90: 3d31 293a 0d0a 2020 2020 2020 2020 2222  =1):..        ""
-00013ba0: 2253 7065 6369 6679 2077 6869 6368 2063  "Specify which c
-00013bb0: 6f6d 706f 6e65 6e74 7320 746f 2070 6c6f  omponents to plo
-00013bc0: 742e 0d0a 0d0a 2020 2020 2020 2020 5061  t.....        Pa
-00013bd0: 7261 6d65 7465 7273 0d0a 2020 2020 2020  rameters..      
-00013be0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
-00013bf0: 2020 2020 2020 736f 7274 696e 6720 3a20        sorting : 
-00013c00: 7374 720d 0a20 2020 2020 2020 2020 2020  str..           
-00013c10: 2053 6f72 7469 6e67 2068 6575 7269 7374   Sorting heurist
-00013c20: 6963 732e 0d0a 0d0a 2020 2020 2020 2020  ics.....        
-00013c30: 2020 2020 276c 3227 202d 2070 6c6f 7473      'l2' - plots
-00013c40: 2061 6c6c 2063 6f6d 706f 6e65 6e74 7320   all components 
-00013c50: 736f 7274 6564 2062 7920 6c32 206e 6f72  sorted by l2 nor
-00013c60: 6d20 6f66 2061 6374 6976 6174 696f 6e73  m of activations
-00013c70: 2069 6e20 7468 650d 0a20 2020 2020 2020   in the..       
-00013c80: 2020 2020 206f 7574 7075 7420 6c61 7965       output laye
-00013c90: 7220 696e 2064 6573 6365 6e64 696e 6720  r in descending 
-00013ca0: 6f72 6465 722e 0d0a 0d0a 2020 2020 2020  order.....      
-00013cb0: 2020 2020 2020 2763 6f6d 6d70 7769 7365        'commpwise
-00013cc0: 5f6c 6f73 7327 202d 2063 6f6d 7075 7465  _loss' - compute
-00013cd0: 2074 6865 2065 6666 6563 7420 6f66 2065   the effect of e
-00013ce0: 6c69 6d69 6e61 7469 6e67 2074 6865 206c  liminating the l
-00013cf0: 6174 656e 740d 0a20 2020 2020 2020 2020  atent..         
-00013d00: 2020 2063 6f6d 706f 6e65 6e74 206f 6e20     component on 
-00013d10: 7468 6520 7661 6c69 6461 7469 6f6e 206c  the validation l
-00013d20: 6f73 732e 2050 6572 6f66 726d 6564 2066  oss. Perofrmed f
-00013d30: 6f72 2065 6163 6820 636c 6173 730d 0a20  or each class.. 
-00013d40: 2020 2020 2020 2020 2020 2073 6570 6172             separ
-00013d50: 6174 656c 792e 0d0a 0d0a 2020 2020 2020  ately.....      
-00013d60: 2020 2020 2020 2777 6569 6768 7427 202d        'weight' -
-00013d70: 2070 6c6f 7473 2061 2073 696e 676c 6520   plots a single 
-00013d80: 636f 6d70 6f6e 656e 7420 7468 6174 2068  component that h
-00013d90: 6173 2061 206d 6178 696d 756d 0d0a 2020  as a maximum..  
-00013da0: 2020 2020 2020 2020 2020 7765 6967 6874            weight
-00013db0: 2066 6f72 2065 6163 6820 636c 6173 7320   for each class 
-00013dc0: 696e 2074 6865 206f 7574 7075 7420 6c61  in the output la
-00013dd0: 7965 722e 0d0a 0d0a 2020 2020 2020 2020  yer.....        
-00013de0: 2020 2020 276f 7574 7075 745f 636f 7272      'output_corr
-00013df0: 2720 2d20 706c 6f74 7320 6120 7369 6e67  ' - plots a sing
-00013e00: 6c65 2063 6f6d 706f 6e65 6e74 2c20 7768  le component, wh
-00013e10: 6963 6820 7072 6f64 7563 6573 2061 0d0a  ich produces a..
-00013e20: 2020 2020 2020 2020 2020 2020 6665 6174              feat
-00013e30: 7572 6520 696e 2074 6865 206f 7574 7075  ure in the outpu
-00013e40: 7420 6c61 7965 7220 7468 6174 2068 6173  t layer that has
-00013e50: 206d 6178 696d 756d 2063 6f72 7265 6c61   maximum correla
-00013e60: 7469 6f6e 0d0a 2020 2020 2020 2020 2020  tion..          
-00013e70: 2020 7769 7468 2065 6163 6820 7461 7267    with each targ
-00013e80: 6574 2076 6172 6961 626c 652e 0d0a 0d0a  et variable.....
-00013e90: 2020 2020 2020 2020 2020 2020 2777 6569              'wei
-00013ea0: 6768 745f 636f 7272 2720 2d20 706c 6f74  ght_corr' - plot
-00013eb0: 7320 6120 7369 6e67 6c65 2063 6f6d 706f  s a single compo
-00013ec0: 6e65 6e74 2c20 6861 7320 6d61 7869 6d75  nent, has maximu
-00013ed0: 6d20 7265 6c65 7661 6e63 650d 0a20 2020  m relevance..   
-00013ee0: 2020 2020 2020 2020 2076 616c 7565 2064           value d
-00013ef0: 6566 696e 6564 2061 7320 6f75 7470 7574  efined as output
-00013f00: 5f6c 6179 6572 5f77 6575 6768 742a 636f  _layer_weught*co
-00013f10: 7272 656c 6174 696f 6e2e 0d0a 0d0a 2020  rrelation.....  
-00013f20: 2020 2020 2020 5265 7475 726e 733a 0d0a        Returns:..
-00013f30: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00013f40: 0d0a 2020 2020 2020 2020 6f72 6465 7220  ..        order 
-00013f50: 3a20 6c69 7374 206f 6620 696e 740d 0a20  : list of int.. 
-00013f60: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
-00013f70: 6573 206f 6620 7265 6c65 7661 6e74 2063  es of relevant c
-00013f80: 6f6d 706f 6e65 6e74 730d 0a0d 0a20 2020  omponents....   
-00013f90: 2020 2020 2074 7320 3a20 6c69 7374 206f       ts : list o
-00013fa0: 6620 696e 7474 6f70 6f2c 2066 7265 715f  f inttopo, freq_
-00013fb0: 7265 7370 6f6e 7365 2c20 7073 640d 0a20  response, psd.. 
-00013fc0: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
-00013fd0: 6573 206f 6620 7265 6c65 7661 6e74 2074  es of relevant t
-00013fe0: 696d 6570 6f69 6e74 730d 0a20 2020 2020  imepoints..     
-00013ff0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00014000: 6f72 6465 7220 3d20 5b5d 0d0a 2020 2020  order = []..    
-00014010: 2020 2020 7473 203d 205b 5d0d 0a20 2020      ts = []..   
-00014020: 2020 2020 206f 7574 5f77 6569 6768 7473       out_weights
-00014030: 203d 2070 6174 7465 726e 735f 7374 7275   = patterns_stru
-00014040: 6374 5b27 7765 6967 6874 7327 5d5b 276f  ct['weights']['o
-00014050: 7574 5f77 6569 6768 7473 275d 0d0a 2020  ut_weights']..  
-00014060: 2020 2020 2020 6966 2073 6f72 7469 6e67        if sorting
-00014070: 203d 3d20 276c 3227 3a0d 0a20 2020 2020   == 'l2':..     
-00014080: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00014090: 7261 6e67 6528 7365 6c66 2e6f 7574 5f64  range(self.out_d
-000140a0: 696d 293a 0d0a 0d0a 2020 2020 2020 2020  im):....        
-000140b0: 2020 2020 2020 2020 7365 6c66 2e46 203d          self.F =
-000140c0: 206f 7574 5f77 6569 6768 7473 5b2e 2e2e   out_weights[...
-000140d0: 2c20 695d 2e54 0d0a 0d0a 2020 2020 2020  , i].T....      
-000140e0: 2020 2020 2020 2020 2020 6e6f 726d 7320            norms 
-000140f0: 3d20 6e70 2e6c 696e 616c 672e 6e6f 726d  = np.linalg.norm
-00014100: 2873 656c 662e 462c 2061 7869 733d 312c  (self.F, axis=1,
-00014110: 206f 7264 3d32 290d 0a20 2020 2020 2020   ord=2)..       
-00014120: 2020 2020 2020 2020 2070 6174 203d 206e           pat = n
-00014130: 702e 6172 6773 6f72 7428 6e6f 726d 7329  p.argsort(norms)
-00014140: 5b2d 6e5f 636f 6d70 3a5d 0d0a 2020 2020  [-n_comp:]..    
-00014150: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-00014160: 722e 6170 7065 6e64 2870 6174 290d 0a20  r.append(pat).. 
-00014170: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00014180: 732e 6170 7065 6e64 286e 702e 6172 616e  s.append(np.aran
-00014190: 6765 2873 656c 662e 462e 7368 6170 655b  ge(self.F.shape[
-000141a0: 2d31 5d29 290d 0a20 2020 2020 2020 2020  -1]))..         
-000141b0: 2020 2020 2020 2023 7473 2e61 7070 656e         #ts.appen
-000141c0: 6428 4e6f 6e65 290d 0a0d 0a20 2020 2020  d(None)....     
-000141d0: 2020 2065 6c69 6620 736f 7274 696e 6720     elif sorting 
-000141e0: 3d3d 2027 636f 6d70 7769 7365 5f6c 6f73  == 'compwise_los
-000141f0: 7327 3a0d 0a20 2020 2020 2020 2020 2020  s':..           
-00014200: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00014210: 7365 6c66 2e6f 7574 5f64 696d 293a 0d0a  self.out_dim):..
-00014220: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00014230: 2020 7365 6c66 2e46 203d 206f 7574 5f77    self.F = out_w
-00014240: 6569 6768 7473 5b2e 2e2e 2c20 695d 2e54  eights[..., i].T
-00014250: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00014260: 2020 7061 7420 3d20 6e70 2e61 7267 736f    pat = np.argso
-00014270: 7274 2870 6174 7465 726e 735f 7374 7275  rt(patterns_stru
-00014280: 6374 5b27 636f 6d70 7769 7365 5f6c 6f73  ct['compwise_los
-00014290: 7327 5d5b 3a2c 2069 5d29 0d0a 2020 2020  s'][:, i])..    
-000142a0: 2020 2020 2020 2020 2020 2020 2374 616b              #tak
-000142b0: 6520 6e20 736d 616c 6c65 7374 2028 6c61  e n smallest (la
-000142c0: 7267 6573 7420 696e 6372 6561 7365 2069  rgest increase i
-000142d0: 6e20 636f 7374 2066 756e 6374 696f 6e29  n cost function)
-000142e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000142f0: 2020 6f72 6465 722e 6170 7065 6e64 2870    order.append(p
-00014300: 6174 5b3a 6e5f 636f 6d70 5d29 0d0a 2020  at[:n_comp])..  
-00014310: 2020 2020 2020 2020 2020 2020 2020 7473                ts
-00014320: 2e61 7070 656e 6428 6e70 2e61 7261 6e67  .append(np.arang
-00014330: 6528 7365 6c66 2e46 2e73 6861 7065 5b2d  e(self.F.shape[-
-00014340: 315d 2929 0d0a 0d0a 2020 2020 2020 2020  1]))....        
-00014350: 656c 6966 2073 6f72 7469 6e67 203d 3d20  elif sorting == 
-00014360: 2761 6273 5f77 6569 6768 7427 3a0d 0a20  'abs_weight':.. 
-00014370: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00014380: 2069 6e20 7261 6e67 6528 7365 6c66 2e6f   in range(self.o
-00014390: 7574 5f64 696d 293a 0d0a 0d0a 2020 2020  ut_dim):....    
-000143a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000143b0: 2e46 203d 206e 702e 6162 7328 6f75 745f  .F = np.abs(out_
-000143c0: 7765 6967 6874 735b 2e2e 2e2c 2069 5d2e  weights[..., i].
-000143d0: 5429 0d0a 2020 2020 2020 2020 2020 2020  T)..            
-000143e0: 2020 2020 7061 742c 2074 203d 206e 702e      pat, t = np.
-000143f0: 7768 6572 6528 7365 6c66 2e46 203d 3d20  where(self.F == 
-00014400: 6e70 2e6d 6178 2873 656c 662e 4629 290d  np.max(self.F)).
-00014410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014420: 2023 7072 696e 7428 274d 6178 696d 756d   #print('Maximum
-00014430: 2073 7065 6172 6d61 6e20 723a 272c 206e   spearman r:', n
-00014440: 702e 6d61 7828 7365 6c66 2e63 6f72 725f  p.max(self.corr_
-00014450: 746f 5f6f 7574 7075 745b 2e2e 2e2c 2069  to_output[..., i
-00014460: 5d2e 5429 290d 0a20 2020 2020 2020 2020  ].T))..         
-00014470: 2020 2020 2020 206f 7264 6572 2e61 7070         order.app
-00014480: 656e 6428 7061 7429 0d0a 2020 2020 2020  end(pat)..      
-00014490: 2020 2020 2020 2020 2020 7473 2e61 7070            ts.app
-000144a0: 656e 6428 7429 0d0a 0d0a 2020 2020 2020  end(t)....      
-000144b0: 2020 656c 6966 2073 6f72 7469 6e67 203d    elif sorting =
-000144c0: 3d20 2777 6569 6768 7427 3a0d 0a20 2020  = 'weight':..   
-000144d0: 2020 2020 2020 2020 206e 5f63 6f6d 7020           n_comp 
-000144e0: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-000144f0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00014500: 7365 6c66 2e6f 7574 5f64 696d 293a 0d0a  self.out_dim):..
-00014510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014520: 7365 6c66 2e46 203d 206f 7574 5f77 6569  self.F = out_wei
-00014530: 6768 7473 5b2e 2e2e 2c20 695d 2e54 0d0a  ghts[..., i].T..
-00014540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014550: 7061 742c 2074 203d 206e 702e 7768 6572  pat, t = np.wher
-00014560: 6528 7365 6c66 2e46 203d 3d20 6e70 2e6d  e(self.F == np.m
-00014570: 6178 2873 656c 662e 4629 290d 0a20 2020  ax(self.F))..   
-00014580: 2020 2020 2020 2020 2020 2020 2023 7072               #pr
-00014590: 696e 7428 274d 6178 696d 756d 2077 6569  int('Maximum wei
-000145a0: 6768 743a 272c 206e 702e 6d61 7828 7365  ght:', np.max(se
-000145b0: 6c66 2e46 2929 0d0a 2020 2020 2020 2020  lf.F))..        
-000145c0: 2020 2020 2020 2020 6f72 6465 722e 6170          order.ap
-000145d0: 7065 6e64 2870 6174 290d 0a20 2020 2020  pend(pat)..     
-000145e0: 2020 2020 2020 2020 2020 2074 732e 6170             ts.ap
-000145f0: 7065 6e64 2874 290d 0a0d 0a20 2020 2020  pend(t)....     
-00014600: 2020 2065 6c69 6620 736f 7274 696e 6720     elif sorting 
-00014610: 3d3d 2027 6f75 7470 7574 5f63 6f72 7227  == 'output_corr'
-00014620: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
-00014630: 2073 656c 662e 4620 3d20 7061 7474 6572   self.F = patter
-00014640: 6e73 5f73 7472 7563 745b 2763 6f72 725f  ns_struct['corr_
-00014650: 746f 5f6f 7574 7075 7427 5d0d 0a20 2020  to_output']..   
-00014660: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-00014670: 6e20 7261 6e67 6528 7365 6c66 2e6f 7574  n range(self.out
-00014680: 5f64 696d 293a 0d0a 0d0a 2020 2020 2020  _dim):....      
-00014690: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000146a0: 274d 6178 696d 756d 2072 5f73 7065 6172  'Maximum r_spear
-000146b0: 3a27 2c20 6e70 2e6d 6178 2873 656c 662e  :', np.max(self.
-000146c0: 465b 2e2e 2e2c 2069 5d29 290d 0a20 2020  F[..., i]))..   
-000146d0: 2020 2020 2020 2020 2020 2020 2070 6174               pat
-000146e0: 203d 206e 702e 7768 6572 6528 7365 6c66   = np.where(self
-000146f0: 2e46 5b2e 2e2e 2c20 695d 203d 3d20 6e70  .F[..., i] == np
-00014700: 2e6d 6178 2873 656c 662e 465b 2e2e 2e2c  .max(self.F[...,
-00014710: 2069 5d29 295b 305d 0d0a 2020 2020 2020   i]))[0]..      
-00014720: 2020 2020 2020 2020 2020 6f72 6465 722e            order.
-00014730: 6170 7065 6e64 2870 6174 290d 0a20 2020  append(pat)..   
-00014740: 2020 2020 2020 2020 2020 2020 2074 732e               ts.
-00014750: 6170 7065 6e64 286e 702e 6172 616e 6765  append(np.arange
-00014760: 2873 656c 662e 462e 7368 6170 655b 2d31  (self.F.shape[-1
-00014770: 5d29 290d 0a20 2020 2020 2020 2065 6c73  ]))..        els
-00014780: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00014790: 7072 696e 7428 2253 6f72 7469 6e67 207b  print("Sorting {
-000147a0: 3a73 7d20 6e6f 7420 696d 706c 656d 656e  :s} not implemen
-000147b0: 7465 6422 2e66 6f72 6d61 7428 736f 7274  ted".format(sort
-000147c0: 696e 6729 290d 0a20 2020 2020 2020 2020  ing))..         
-000147d0: 2020 2072 6574 7572 6e20 4e6f 6e65 2c20     return None, 
-000147e0: 4e6f 6e65 0d0a 0d0a 2020 2020 2020 2020  None....        
-000147f0: 6f72 6465 7220 3d20 6e70 2e61 7272 6179  order = np.array
-00014800: 286f 7264 6572 290d 0a20 2020 2020 2020  (order)..       
-00014810: 2074 7320 3d20 6e70 2e61 7272 6179 2874   ts = np.array(t
-00014820: 7329 0d0a 2020 2020 2020 2020 7265 7475  s)..        retu
-00014830: 726e 206f 7264 6572 2c20 7473 0d0a 0d0a  rn order, ts....
-00014840: 0d0a 2020 2020 6465 6620 7369 6e67 6c65  ..    def single
-00014850: 5f63 6f6d 706f 6e65 6e74 5f70 6174 7465  _component_patte
-00014860: 726e 2873 656c 662c 2070 6174 7465 726e  rn(self, pattern
-00014870: 735f 7374 7275 6374 2c20 736f 7274 696e  s_struct, sortin
-00014880: 673d 2763 6f6d 7077 6973 655f 6c6f 7373  g='compwise_loss
-00014890: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-000148a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148b0: 2020 2020 206e 5f63 6f6d 703d 3129 3a0d       n_comp=1):.
-000148c0: 0a20 2020 2020 2020 206f 7264 6572 2c20  .        order, 
-000148d0: 7473 203d 2073 656c 662e 5f73 6f72 7469  ts = self._sorti
-000148e0: 6e67 2820 7061 7474 6572 6e73 5f73 7472  ng( patterns_str
-000148f0: 7563 742c 2073 6f72 7469 6e67 2c20 6e5f  uct, sorting, n_
-00014900: 636f 6d70 3d6e 5f63 6f6d 7029 0d0a 2020  comp=n_comp)..  
-00014910: 2020 2020 2020 635f 746f 706f 7320 3d20        c_topos = 
-00014920: 5b5d 0d0a 2020 2020 2020 2020 635f 7073  []..        c_ps
-00014930: 6473 203d 205b 5d0d 0a20 2020 2020 2020  ds = []..       
-00014940: 2063 5f66 7273 203d 205b 5d0d 0a20 2020   c_frs = []..   
-00014950: 2020 2020 2023 7072 696e 7428 736f 7274       #print(sort
-00014960: 696e 672c 206f 7264 6572 290d 0a20 2020  ing, order)..   
-00014970: 2020 2020 2077 203d 2070 6174 7465 726e       w = pattern
-00014980: 735f 7374 7275 6374 5b27 7765 6967 6874  s_struct['weight
-00014990: 7327 5d5b 2764 6d78 275d 0d0a 2020 2020  s']['dmx']..    
-000149a0: 2020 2020 2361 203d 206e 702e 646f 7428      #a = np.dot(
-000149b0: 7061 7474 6572 6e73 5f73 7472 7563 745b  patterns_struct[
-000149c0: 2764 636f 7627 5d5b 2769 6e70 7574 5f73  'dcov']['input_s
-000149d0: 7061 7469 616c 275d 2c20 7729 0d0a 2020  patial'], w)..  
-000149e0: 2020 2020 2020 666f 7220 692c 2063 6f6d        for i, com
-000149f0: 7073 2069 6e20 656e 756d 6572 6174 6528  ps in enumerate(
-00014a00: 6f72 6465 7229 3a0d 0a20 2020 2020 2020  order):..       
-00014a10: 2020 2020 2061 203d 206e 702e 646f 7428       a = np.dot(
-00014a20: 7061 7474 6572 6e73 5f73 7472 7563 745b  patterns_struct[
-00014a30: 2764 636f 7627 5d5b 2763 6c61 7373 5f63  'dcov']['class_c
-00014a40: 6f6e 6469 7469 6f6e 616c 275d 5b69 5d2c  onditional'][i],
-00014a50: 2077 290d 0a0d 0a20 2020 2020 2020 2020   w)....         
-00014a60: 2020 2063 5f74 6f70 6f73 2e61 7070 656e     c_topos.appen
-00014a70: 6428 615b 3a2c 2063 6f6d 7073 5d29 0d0a  d(a[:, comps])..
-00014a80: 2020 2020 2020 2020 2020 2020 635f 7073              c_ps
-00014a90: 6473 2e61 7070 656e 6428 7061 7474 6572  ds.append(patter
-00014aa0: 6e73 5f73 7472 7563 745b 2773 7065 6374  ns_struct['spect
-00014ab0: 7261 275d 5b27 7073 6473 275d 5b63 6f6d  ra']['psds'][com
-00014ac0: 7073 2c20 3a5d 2e54 2c29 0d0a 2020 2020  ps, :].T,)..    
-00014ad0: 2020 2020 2020 2020 635f 6672 732e 6170          c_frs.ap
-00014ae0: 7065 6e64 2870 6174 7465 726e 735f 7374  pend(patterns_st
-00014af0: 7275 6374 5b27 7370 6563 7472 6127 5d5b  ruct['spectra'][
-00014b00: 2766 7265 715f 7265 7370 6f6e 7365 7327  'freq_responses'
-00014b10: 5d5b 636f 6d70 732c 203a 5d2e 5429 0d0a  ][comps, :].T)..
-00014b20: 2020 2020 2020 2020 746f 706f 203d 206e          topo = n
-00014b30: 702e 636f 6e63 6174 656e 6174 6528 635f  p.concatenate(c_
-00014b40: 746f 706f 732c 2061 7869 733d 2d31 290d  topos, axis=-1).
-00014b50: 0a20 2020 2020 2020 2066 7265 715f 7265  .        freq_re
-00014b60: 7370 6f6e 7365 203d 206e 702e 636f 6e63  sponse = np.conc
-00014b70: 6174 656e 6174 6528 635f 6672 732c 2061  atenate(c_frs, a
-00014b80: 7869 733d 2d31 290d 0a20 2020 2020 2020  xis=-1)..       
-00014b90: 2070 7364 203d 206e 702e 636f 6e63 6174   psd = np.concat
-00014ba0: 656e 6174 6528 635f 7073 6473 2c20 6178  enate(c_psds, ax
-00014bb0: 6973 3d2d 3129 0d0a 2020 2020 2020 2020  is=-1)..        
-00014bc0: 7265 7475 726e 2074 6f70 6f2c 2066 7265  return topo, fre
-00014bd0: 715f 7265 7370 6f6e 7365 2c20 7073 640d  q_response, psd.
-00014be0: 0a0d 0a20 2020 2064 6566 2070 6c6f 745f  ...    def plot_
-00014bf0: 636f 6d62 696e 6564 5f70 6174 7465 726e  combined_pattern
-00014c00: 2873 656c 662c 206d 6574 686f 643d 2763  (self, method='c
-00014c10: 6f6d 6269 6e65 6427 2c20 7365 6e73 6f72  ombined', sensor
-00014c20: 5f6c 6179 6f75 743d 4e6f 6e65 2c0d 0a20  _layout=None,.. 
-00014c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c40: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-00014c50: 6573 3d4e 6f6e 652c 206e 5f63 6f6d 703d  es=None, n_comp=
-00014c60: 312c 2070 6c6f 745f 7472 7565 5f65 766f  1, plot_true_evo
-00014c70: 6b65 643d 4661 6c73 6529 3a0d 0a20 2020  ked=False):..   
-00014c80: 2020 2020 2069 6620 6e6f 7420 6e61 6d65       if not name
-00014c90: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00014ca0: 6e61 6d65 7320 3d20 5b27 436c 6173 7320  names = ['Class 
-00014cb0: 7b7d 272e 666f 726d 6174 2869 2920 666f  {}'.format(i) fo
-00014cc0: 7220 6920 696e 2072 616e 6765 2873 656c  r i in range(sel
-00014cd0: 662e 795f 7368 6170 655b 2d31 5d29 5d0d  f.y_shape[-1])].
-00014ce0: 0a0d 0a0d 0a23 2020 2020 2020 2020 6363  .....#        cc
-00014cf0: 203d 206e 702e 6172 7261 7928 5b6e 702e   = np.array([np.
-00014d00: 636f 7272 636f 6566 2873 656c 662e 6376  corrcoef(self.cv
-00014d10: 5f70 6174 7465 726e 735b 3a2c 2069 2c20  _patterns[:, i, 
-00014d20: 3a5d 2e54 295b 692c 3a5d 0d0a 2320 2020  :].T)[i,:]..#   
-00014d30: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00014d40: 6920 696e 2072 616e 6765 2873 656c 662e  i in range(self.
-00014d50: 6376 5f70 6174 7465 726e 732e 7368 6170  cv_patterns.shap
-00014d60: 655b 315d 295d 290d 0a20 2020 2020 2020  e[1])])..       
-00014d70: 2069 6620 6c65 6e28 7365 6c66 2e63 765f   if len(self.cv_
-00014d80: 7061 7474 6572 6e73 2e69 7465 6d73 2829  patterns.items()
-00014d90: 203e 2030 293a 0d0a 2020 2020 2020 2020   > 0):..        
-00014da0: 2020 2020 7072 696e 7428 2252 6573 746f      print("Resto
-00014db0: 7269 6e67 2066 726f 6d3a 222c 206d 6574  ring from:", met
-00014dc0: 686f 6420 290d 0a20 2020 2020 2020 2020  hod )..         
-00014dd0: 2020 2074 6f70 6f73 203d 206e 702e 6d65     topos = np.me
-00014de0: 616e 2873 656c 662e 6376 5f70 6174 7465  an(self.cv_patte
-00014df0: 726e 735b 6d65 7468 6f64 5d5b 2773 7061  rns[method]['spa
-00014e00: 7469 616c 275d 2c0d 0a20 2020 2020 2020  tial'],..       
-00014e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e20: 2020 2020 2020 2020 2020 2020 2020 2d31                -1
-00014e30: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
-00014e40: 696c 7465 7273 203d 206e 702e 6d65 616e  ilters = np.mean
-00014e50: 2873 656c 662e 6376 5f70 6174 7465 726e  (self.cv_pattern
-00014e60: 735b 6d65 7468 6f64 5d5b 2774 656d 706f  s[method]['tempo
-00014e70: 7261 6c27 5d2c 0d0a 2020 2020 2020 2020  ral'],..        
-00014e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e90: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-00014ea0: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-00014eb0: 7073 6473 203d 206e 702e 6d65 616e 2873  psds = np.mean(s
-00014ec0: 656c 662e 6376 5f70 6174 7465 726e 735b  elf.cv_patterns[
-00014ed0: 6d65 7468 6f64 5d5b 2770 7364 7327 5d2c  method]['psds'],
-00014ee0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00014ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f00: 2020 2020 2020 2d31 290d 0a20 2020 2020        -1)..     
-00014f10: 2020 2020 2020 2023 6672 6571 7320 3d20         #freqs = 
-00014f20: 7365 6c66 2e66 7265 7173 0d0a 0d0a 2020  self.freqs....  
-00014f30: 2020 2020 2020 656c 6966 206d 6574 686f        elif metho
-00014f40: 6420 3d3d 2027 636f 6d62 696e 6564 273a  d == 'combined':
-00014f50: 0d0a 2020 2020 2020 2020 2020 2020 746f  ..            to
-00014f60: 706f 732c 2066 696c 7465 7273 2c20 7073  pos, filters, ps
-00014f70: 6473 203d 2073 656c 662e 636f 6d62 696e  ds = self.combin
-00014f80: 6564 5f70 6174 7465 726e 2829 0d0a 0d0a  ed_pattern()....
-00014f90: 2020 2020 2020 2020 656c 6966 206d 6574          elif met
-00014fa0: 686f 6420 696e 205b 2777 6569 6768 7427  hod in ['weight'
-00014fb0: 2c20 2763 6f6d 7077 6973 655f 6c6f 7373  , 'compwise_loss
-00014fc0: 275d 3a0d 0a20 2020 2020 2020 2020 2020  ']:..           
-00014fd0: 2074 6f70 6f73 2c20 6669 6c74 6572 732c   topos, filters,
-00014fe0: 2070 7364 7320 3d20 7365 6c66 2e73 696e   psds = self.sin
-00014ff0: 676c 655f 7061 7474 6572 6e28 736f 7274  gle_pattern(sort
-00015000: 696e 673d 6d65 7468 6f64 2c0d 0a20 2020  ing=method,..   
-00015010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015040: 2020 2020 6e5f 636f 6d70 3d6e 5f63 6f6d      n_comp=n_com
-00015050: 7029 0d0a 0d0a 0d0a 2020 2020 2020 2020  p)......        
-00015060: 6672 6571 7320 3d20 7365 6c66 2e66 7265  freqs = self.fre
-00015070: 7173 0d0a 0d0a 2020 2020 2020 2020 746f  qs....        to
-00015080: 706f 7320 2f3d 206e 702e 6d61 7869 6d75  pos /= np.maximu
-00015090: 6d28 746f 706f 732e 7374 6428 6178 6973  m(topos.std(axis
-000150a0: 3d30 2c20 6b65 6570 6469 6d73 3d54 7275  =0, keepdims=Tru
-000150b0: 6529 2c0d 0a20 2020 2020 2020 2020 2020  e),..           
+00013480: 2020 7073 6420 3d20 7365 6c66 2e70 7364    psd = self.psd
+00013490: 735b 692c 203a 5d0d 0a0d 0a20 2020 2020  s[i, :]....     
+000134a0: 2020 2020 2020 2020 2020 2023 7270 7373             #rpss
+000134b0: 2e61 7070 656e 6428 682f 6e70 2e73 756d  .append(h/np.sum
+000134c0: 2868 2929 0d0a 2020 2020 2020 2020 2020  (h))..          
+000134d0: 2020 2020 2020 7270 7373 2e61 7070 656e        rpss.appen
+000134e0: 6428 2870 7364 2a68 2929 2023 2529 2f6e  d((psd*h)) #%)/n
+000134f0: 702e 7375 6d28 7073 642a 6829 0d0a 0d0a  p.sum(psd*h)....
+00013500: 2020 2020 2020 2020 2020 2020 5b61 785b              [ax[
+00013510: 312c 2031 5d2e 706c 6f74 2873 656c 662e  1, 1].plot(self.
+00013520: 6672 6571 732c 2072 7073 735b 756f 5d2c  freqs, rpss[uo],
+00013530: 206c 696e 6577 6964 7468 3d32 2e35 2c20   linewidth=2.5, 
+00013540: 6c61 6265 6c3d 636c 6173 735f 6e61 6d65  label=class_name
+00013550: 735b 695d 290d 0a20 2020 2020 2020 2020  s[i])..         
+00013560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013570: 2020 2020 666f 7220 692c 2075 6f20 696e      for i, uo in
+00013580: 2065 6e75 6d65 7261 7465 2873 656c 662e   enumerate(self.
+00013590: 756f 7264 6572 295d 0d0a 2020 2020 2020  uorder)]..      
+000135a0: 2020 2020 2020 6178 5b31 2c20 315d 2e73        ax[1, 1].s
+000135b0: 6574 5f78 6c69 6d28 302c 3930 2e29 0d0a  et_xlim(0,90.)..
+000135c0: 2020 2020 2020 2020 2020 2020 6178 5b31              ax[1
+000135d0: 2c20 315d 2e73 6574 5f74 6974 6c65 2822  , 1].set_title("
+000135e0: 5265 6c61 7469 7665 2070 6f77 6572 2c20  Relative power, 
+000135f0: 2522 290d 0a20 2020 2020 2020 2020 2020  %")..           
+00013600: 2061 785b 312c 2031 5d2e 7365 745f 786c   ax[1, 1].set_xl
+00013610: 6162 656c 2822 4672 6571 7565 6e63 792c  abel("Frequency,
+00013620: 2048 7a22 290d 0a20 2020 2020 2020 2020   Hz")..         
+00013630: 2020 2061 785b 312c 2031 5d2e 6c65 6765     ax[1, 1].lege
+00013640: 6e64 2829 0d0a 2020 2020 2020 2020 2020  nd()..          
+00013650: 2020 706c 742e 7368 6f77 2829 0d0a 2020    plt.show()..  
+00013660: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00013670: 0d0a 0d0a 0d0a 0d0a 2020 2020 6465 6620  ........    def 
+00013680: 5f73 6f72 7469 6e67 2873 656c 662c 2070  _sorting(self, p
+00013690: 6174 7465 726e 735f 7374 7275 6374 2c20  atterns_struct, 
+000136a0: 736f 7274 696e 673d 2763 6f6d 7077 6973  sorting='compwis
+000136b0: 655f 6c6f 7373 272c 206e 5f63 6f6d 703d  e_loss', n_comp=
+000136c0: 3129 3a0d 0a20 2020 2020 2020 2022 2222  1):..        """
+000136d0: 5370 6563 6966 7920 7768 6963 6820 636f  Specify which co
+000136e0: 6d70 6f6e 656e 7473 2074 6f20 706c 6f74  mponents to plot
+000136f0: 2e0d 0a0d 0a20 2020 2020 2020 2050 6172  .....        Par
+00013700: 616d 6574 6572 730d 0a20 2020 2020 2020  ameters..       
+00013710: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
+00013720: 2020 2020 2073 6f72 7469 6e67 203a 2073       sorting : s
+00013730: 7472 0d0a 2020 2020 2020 2020 2020 2020  tr..            
+00013740: 536f 7274 696e 6720 6865 7572 6973 7469  Sorting heuristi
+00013750: 6373 2e0d 0a0d 0a20 2020 2020 2020 2020  cs.....         
+00013760: 2020 2027 7765 6967 6874 5f6e 6f72 6d27     'weight_norm'
+00013770: 202d 2070 6c6f 7473 2061 6c6c 2063 6f6d   - plots all com
+00013780: 706f 6e65 6e74 7320 736f 7274 6564 2062  ponents sorted b
+00013790: 7920 6c32 206e 6f72 6d20 6f66 2061 6374  y l2 norm of act
+000137a0: 6976 6174 696f 6e73 2069 6e20 7468 650d  ivations in the.
+000137b0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+000137c0: 7075 7420 6c61 7965 7220 696e 2064 6573  put layer in des
+000137d0: 6365 6e64 696e 6720 6f72 6465 722e 0d0a  cending order...
+000137e0: 0d0a 2020 2020 2020 2020 2020 2020 2763  ..            'c
+000137f0: 6f6d 6d70 7769 7365 5f6c 6f73 7327 202d  ommpwise_loss' -
+00013800: 2063 6f6d 7075 7465 2074 6865 2065 6666   compute the eff
+00013810: 6563 7420 6f66 2065 6c69 6d69 6e61 7469  ect of eliminati
+00013820: 6e67 2074 6865 206c 6174 656e 740d 0a20  ng the latent.. 
+00013830: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
+00013840: 6e65 6e74 206f 6e20 7468 6520 7661 6c69  nent on the vali
+00013850: 6461 7469 6f6e 206c 6f73 732e 2050 6572  dation loss. Per
+00013860: 6f66 726d 6564 2066 6f72 2065 6163 6820  ofrmed for each 
+00013870: 636c 6173 730d 0a20 2020 2020 2020 2020  class..         
+00013880: 2020 2073 6570 6172 6174 656c 792e 0d0a     separately...
+00013890: 0d0a 2020 2020 2020 2020 2020 2020 2777  ..            'w
+000138a0: 6569 6768 7427 202d 2070 6c6f 7473 2061  eight' - plots a
+000138b0: 2073 696e 676c 6520 636f 6d70 6f6e 656e   single componen
+000138c0: 7420 7468 6174 2068 6173 2061 206d 6178  t that has a max
+000138d0: 696d 756d 0d0a 2020 2020 2020 2020 2020  imum..          
+000138e0: 2020 7765 6967 6874 2066 6f72 2065 6163    weight for eac
+000138f0: 6820 636c 6173 7320 696e 2074 6865 206f  h class in the o
+00013900: 7574 7075 7420 6c61 7965 722e 0d0a 0d0a  utput layer.....
+00013910: 2020 2020 2020 2020 2020 2020 276f 7574              'out
+00013920: 7075 745f 636f 7272 2720 2d20 706c 6f74  put_corr' - plot
+00013930: 7320 6120 7369 6e67 6c65 2063 6f6d 706f  s a single compo
+00013940: 6e65 6e74 2c20 7768 6963 6820 7072 6f64  nent, which prod
+00013950: 7563 6573 2061 0d0a 2020 2020 2020 2020  uces a..        
+00013960: 2020 2020 6665 6174 7572 6520 696e 2074      feature in t
+00013970: 6865 206f 7574 7075 7420 6c61 7965 7220  he output layer 
+00013980: 7468 6174 2068 6173 206d 6178 696d 756d  that has maximum
+00013990: 2063 6f72 7265 6c61 7469 6f6e 0d0a 2020   correlation..  
+000139a0: 2020 2020 2020 2020 2020 7769 7468 2065            with e
+000139b0: 6163 6820 7461 7267 6574 2076 6172 6961  ach target varia
+000139c0: 626c 652e 0d0a 0d0a 2020 2020 2020 2020  ble.....        
+000139d0: 2020 2020 2777 6569 6768 745f 636f 7272      'weight_corr
+000139e0: 2720 2d20 706c 6f74 7320 6120 7369 6e67  ' - plots a sing
+000139f0: 6c65 2063 6f6d 706f 6e65 6e74 2c20 6861  le component, ha
+00013a00: 7320 6d61 7869 6d75 6d20 7265 6c65 7661  s maximum releva
+00013a10: 6e63 650d 0a20 2020 2020 2020 2020 2020  nce..           
+00013a20: 2076 616c 7565 2064 6566 696e 6564 2061   value defined a
+00013a30: 7320 6f75 7470 7574 5f6c 6179 6572 5f77  s output_layer_w
+00013a40: 6575 6768 742a 636f 7272 656c 6174 696f  eught*correlatio
+00013a50: 6e2e 0d0a 0d0a 2020 2020 2020 2020 5265  n.....        Re
+00013a60: 7475 726e 733a 0d0a 2020 2020 2020 2020  turns:..        
+00013a70: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
+00013a80: 2020 6f72 6465 7220 3a20 6c69 7374 206f    order : list o
+00013a90: 6620 696e 740d 0a20 2020 2020 2020 2020  f int..         
+00013aa0: 2020 2069 6e64 6963 6573 206f 6620 7265     indices of re
+00013ab0: 6c65 7661 6e74 2063 6f6d 706f 6e65 6e74  levant component
+00013ac0: 730d 0a0d 0a20 2020 2020 2020 2074 7320  s....        ts 
+00013ad0: 3a20 6c69 7374 206f 6620 696e 7474 6f70  : list of inttop
+00013ae0: 6f2c 2066 7265 715f 7265 7370 6f6e 7365  o, freq_response
+00013af0: 2c20 7073 640d 0a20 2020 2020 2020 2020  , psd..         
+00013b00: 2020 2069 6e64 6963 6573 206f 6620 7265     indices of re
+00013b10: 6c65 7661 6e74 2074 696d 6570 6f69 6e74  levant timepoint
+00013b20: 730d 0a20 2020 2020 2020 2022 2222 0d0a  s..        """..
+00013b30: 2020 2020 2020 2020 6f72 6465 7220 3d20          order = 
+00013b40: 5b5d 0d0a 2020 2020 2020 2020 7473 203d  []..        ts =
+00013b50: 205b 5d0d 0a20 2020 2020 2020 206f 7574   []..        out
+00013b60: 5f77 6569 6768 7473 203d 2070 6174 7465  _weights = patte
+00013b70: 726e 735f 7374 7275 6374 5b27 7765 6967  rns_struct['weig
+00013b80: 6874 7327 5d5b 276f 7574 5f77 6569 6768  hts']['out_weigh
+00013b90: 7473 275d 0d0a 2020 2020 2020 2020 6966  ts']..        if
+00013ba0: 2073 6f72 7469 6e67 203d 3d20 2777 6569   sorting == 'wei
+00013bb0: 6768 745f 6e6f 726d 273a 0d0a 2020 2020  ght_norm':..    
+00013bc0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+00013bd0: 2072 616e 6765 2873 656c 662e 6f75 745f   range(self.out_
+00013be0: 6469 6d29 3a0d 0a0d 0a20 2020 2020 2020  dim):....       
+00013bf0: 2020 2020 2020 2020 2073 656c 662e 4620           self.F 
+00013c00: 3d20 6f75 745f 7765 6967 6874 735b 2e2e  = out_weights[..
+00013c10: 2e2c 2069 5d2e 540d 0a0d 0a20 2020 2020  ., i].T....     
+00013c20: 2020 2020 2020 2020 2020 206e 6f72 6d73             norms
+00013c30: 203d 206e 702e 6c69 6e61 6c67 2e6e 6f72   = np.linalg.nor
+00013c40: 6d28 7365 6c66 2e46 2c20 6178 6973 3d31  m(self.F, axis=1
+00013c50: 2c20 6f72 643d 3229 0d0a 2020 2020 2020  , ord=2)..      
+00013c60: 2020 2020 2020 2020 2020 7061 7420 3d20            pat = 
+00013c70: 6e70 2e61 7267 736f 7274 286e 6f72 6d73  np.argsort(norms
+00013c80: 295b 2d6e 5f63 6f6d 703a 5d0d 0a20 2020  )[-n_comp:]..   
+00013c90: 2020 2020 2020 2020 2020 2020 206f 7264               ord
+00013ca0: 6572 2e61 7070 656e 6428 7061 7429 0d0a  er.append(pat)..
+00013cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013cc0: 7473 2e61 7070 656e 6428 6e70 2e61 7261  ts.append(np.ara
+00013cd0: 6e67 6528 7365 6c66 2e46 2e73 6861 7065  nge(self.F.shape
+00013ce0: 5b2d 315d 2929 0d0a 2020 2020 2020 2020  [-1]))..        
+00013cf0: 2020 2020 2020 2020 2374 732e 6170 7065          #ts.appe
+00013d00: 6e64 284e 6f6e 6529 0d0a 0d0a 2020 2020  nd(None)....    
+00013d10: 2020 2020 656c 6966 2073 6f72 7469 6e67      elif sorting
+00013d20: 203d 3d20 2763 6f6d 7077 6973 655f 6c6f   == 'compwise_lo
+00013d30: 7373 273a 0d0a 2020 2020 2020 2020 2020  ss':..          
+00013d40: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+00013d50: 2873 656c 662e 6f75 745f 6469 6d29 3a0d  (self.out_dim):.
+00013d60: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00013d70: 2020 2073 656c 662e 4620 3d20 6f75 745f     self.F = out_
+00013d80: 7765 6967 6874 735b 2e2e 2e2c 2069 5d2e  weights[..., i].
+00013d90: 540d 0a20 2020 2020 2020 2020 2020 2020  T..             
+00013da0: 2020 2070 6174 203d 206e 702e 6172 676d     pat = np.argm
+00013db0: 696e 2870 6174 7465 726e 735f 7374 7275  in(patterns_stru
+00013dc0: 6374 5b27 636f 6d70 7769 7365 5f6c 6f73  ct['compwise_los
+00013dd0: 7327 5d5b 3a2c 203a 2c20 695d 2e73 756d  s'][:, :, i].sum
+00013de0: 2830 2929 0d0a 2020 2020 2020 2020 2020  (0))..          
+00013df0: 2020 2020 2020 2374 616b 6520 6e20 736d        #take n sm
+00013e00: 616c 6c65 7374 2028 6c61 7267 6573 7420  allest (largest 
+00013e10: 696e 6372 6561 7365 2069 6e20 636f 7374  increase in cost
+00013e20: 2066 756e 6374 696f 6e29 0d0a 2020 2020   function)..    
+00013e30: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+00013e40: 722e 6170 7065 6e64 285b 7061 745d 290d  r.append([pat]).
+00013e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013e60: 2074 732e 6170 7065 6e64 286e 702e 6172   ts.append(np.ar
+00013e70: 616e 6765 2873 656c 662e 462e 7368 6170  ange(self.F.shap
+00013e80: 655b 2d31 5d29 290d 0a0d 0a20 2020 2020  e[-1]))....     
+00013e90: 2020 2065 6c69 6620 736f 7274 696e 6720     elif sorting 
+00013ea0: 3d3d 2027 6162 735f 7765 6967 6874 273a  == 'abs_weight':
+00013eb0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00013ec0: 7220 6920 696e 2072 616e 6765 2873 656c  r i in range(sel
+00013ed0: 662e 6f75 745f 6469 6d29 3a0d 0a0d 0a20  f.out_dim):.... 
+00013ee0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00013ef0: 656c 662e 4620 3d20 6e70 2e61 6273 286f  elf.F = np.abs(o
+00013f00: 7574 5f77 6569 6768 7473 5b2e 2e2e 2c20  ut_weights[..., 
+00013f10: 695d 2e54 290d 0a20 2020 2020 2020 2020  i].T)..         
+00013f20: 2020 2020 2020 2070 6174 2c20 7420 3d20         pat, t = 
+00013f30: 6e70 2e77 6865 7265 2873 656c 662e 4620  np.where(self.F 
+00013f40: 3d3d 206e 702e 6d61 7828 7365 6c66 2e46  == np.max(self.F
+00013f50: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00013f60: 2020 2020 2370 7269 6e74 2827 4d61 7869      #print('Maxi
+00013f70: 6d75 6d20 7370 6561 726d 616e 2072 3a27  mum spearman r:'
+00013f80: 2c20 6e70 2e6d 6178 2873 656c 662e 636f  , np.max(self.co
+00013f90: 7272 5f74 6f5f 6f75 7470 7574 5b2e 2e2e  rr_to_output[...
+00013fa0: 2c20 695d 2e54 2929 0d0a 2020 2020 2020  , i].T))..      
+00013fb0: 2020 2020 2020 2020 2020 6f72 6465 722e            order.
+00013fc0: 6170 7065 6e64 2870 6174 290d 0a20 2020  append(pat)..   
+00013fd0: 2020 2020 2020 2020 2020 2020 2074 732e               ts.
+00013fe0: 6170 7065 6e64 2874 290d 0a0d 0a20 2020  append(t)....   
+00013ff0: 2020 2020 2065 6c69 6620 736f 7274 696e       elif sortin
+00014000: 6720 3d3d 2027 7765 6967 6874 273a 0d0a  g == 'weight':..
+00014010: 2020 2020 2020 2020 2020 2020 6e5f 636f              n_co
+00014020: 6d70 203d 2031 0d0a 2020 2020 2020 2020  mp = 1..        
+00014030: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+00014040: 6765 2873 656c 662e 6f75 745f 6469 6d29  ge(self.out_dim)
+00014050: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00014060: 2020 2073 656c 662e 4620 3d20 6f75 745f     self.F = out_
+00014070: 7765 6967 6874 735b 2e2e 2e2c 2069 5d2e  weights[..., i].
+00014080: 540d 0a20 2020 2020 2020 2020 2020 2020  T..             
+00014090: 2020 2070 6174 2c20 7420 3d20 6e70 2e77     pat, t = np.w
+000140a0: 6865 7265 2873 656c 662e 4620 3d3d 206e  here(self.F == n
+000140b0: 702e 6d61 7828 7365 6c66 2e46 2929 0d0a  p.max(self.F))..
+000140c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140d0: 2370 7269 6e74 2827 4d61 7869 6d75 6d20  #print('Maximum 
+000140e0: 7765 6967 6874 3a27 2c20 6e70 2e6d 6178  weight:', np.max
+000140f0: 2873 656c 662e 4629 290d 0a20 2020 2020  (self.F))..     
+00014100: 2020 2020 2020 2020 2020 206f 7264 6572             order
+00014110: 2e61 7070 656e 6428 7061 7429 0d0a 2020  .append(pat)..  
+00014120: 2020 2020 2020 2020 2020 2020 2020 7473                ts
+00014130: 2e61 7070 656e 6428 7429 0d0a 0d0a 2020  .append(t)....  
+00014140: 2020 2020 2020 656c 6966 2073 6f72 7469        elif sorti
+00014150: 6e67 203d 3d20 276f 7574 7075 745f 636f  ng == 'output_co
+00014160: 7272 273a 0d0a 0d0a 2020 2020 2020 2020  rr':....        
+00014170: 2020 2020 7365 6c66 2e46 203d 2070 6174      self.F = pat
+00014180: 7465 726e 735f 7374 7275 6374 5b27 636f  terns_struct['co
+00014190: 7272 5f74 6f5f 6f75 7470 7574 275d 232e  rr_to_output']#.
+000141a0: 6d65 616e 2830 290d 0a20 2020 2020 2020  mean(0)..       
+000141b0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+000141c0: 6e67 6528 7365 6c66 2e6f 7574 5f64 696d  nge(self.out_dim
+000141d0: 293a 0d0a 0d0a 2020 2020 2020 2020 2020  ):....          
+000141e0: 2020 2020 2020 2370 7269 6e74 2827 4d61        #print('Ma
+000141f0: 7869 6d75 6d20 725f 7370 6561 723a 272c  ximum r_spear:',
+00014200: 206e 702e 6d61 7828 7365 6c66 2e46 5b2e   np.max(self.F[.
+00014210: 2e2e 2c20 695d 2929 0d0a 2020 2020 2020  .., i]))..      
+00014220: 2020 2020 2020 2020 2020 7061 7420 3d20            pat = 
+00014230: 6e70 2e77 6865 7265 2873 656c 662e 465b  np.where(self.F[
+00014240: 2e2e 2e2c 2069 5d20 3d3d 206e 702e 6d61  ..., i] == np.ma
+00014250: 7828 7365 6c66 2e46 5b2e 2e2e 2c20 695d  x(self.F[..., i]
+00014260: 2929 5b31 5d0d 0a20 2020 2020 2020 2020  ))[1]..         
+00014270: 2020 2020 2020 206f 7264 6572 2e61 7070         order.app
+00014280: 656e 6428 7061 7429 0d0a 2020 2020 2020  end(pat)..      
+00014290: 2020 2020 2020 2020 2020 7473 2e61 7070            ts.app
+000142a0: 656e 6428 6e70 2e61 7261 6e67 6528 7365  end(np.arange(se
+000142b0: 6c66 2e46 2e73 6861 7065 5b2d 315d 2929  lf.F.shape[-1]))
+000142c0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+000142d0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+000142e0: 6e74 2822 536f 7274 696e 6720 7b3a 737d  nt("Sorting {:s}
+000142f0: 206e 6f74 2069 6d70 6c65 6d65 6e74 6564   not implemented
+00014300: 222e 666f 726d 6174 2873 6f72 7469 6e67  ".format(sorting
+00014310: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00014320: 7265 7475 726e 204e 6f6e 652c 204e 6f6e  return None, Non
+00014330: 650d 0a0d 0a20 2020 2020 2020 206f 7264  e....        ord
+00014340: 6572 203d 206e 702e 6172 7261 7928 6f72  er = np.array(or
+00014350: 6465 7229 0d0a 2020 2020 2020 2020 7473  der)..        ts
+00014360: 203d 206e 702e 6172 7261 7928 7473 290d   = np.array(ts).
+00014370: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00014380: 6f72 6465 722c 2074 730d 0a0d 0a0d 0a20  order, ts...... 
+00014390: 2020 2064 6566 2073 696e 676c 655f 636f     def single_co
+000143a0: 6d70 6f6e 656e 745f 7061 7474 6572 6e28  mponent_pattern(
+000143b0: 7365 6c66 2c20 7061 7474 6572 6e73 5f73  self, patterns_s
+000143c0: 7472 7563 742c 2073 6f72 7469 6e67 3d27  truct, sorting='
+000143d0: 636f 6d70 7769 7365 5f6c 6f73 7327 2c0d  compwise_loss',.
+000143e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000143f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014400: 2020 6e5f 636f 6d70 3d31 293a 0d0a 2020    n_comp=1):..  
+00014410: 2020 2020 2020 2222 2250 6963 6b20 7369        """Pick si
+00014420: 6e67 6c65 2063 6f6d 706f 6e65 6e74 2061  ngle component a
+00014430: 6363 6f72 6469 6e67 2074 6f20 736f 7274  ccording to sort
+00014440: 696e 6720 6d65 7468 6f64 2e0d 0a20 2020  ing method...   
+00014450: 2020 2020 204d 756c 7469 706c 7920 7370       Multiply sp
+00014460: 6174 6961 6c20 6669 6c74 6572 2062 7920  atial filter by 
+00014470: 6461 7461 2063 6f76 6172 6961 6e63 6522  data covariance"
+00014480: 2222 0d0a 2020 2020 2020 2020 6f72 6465  ""..        orde
+00014490: 722c 2074 7320 3d20 7365 6c66 2e5f 736f  r, ts = self._so
+000144a0: 7274 696e 6728 2070 6174 7465 726e 735f  rting( patterns_
+000144b0: 7374 7275 6374 2c20 736f 7274 696e 672c  struct, sorting,
+000144c0: 206e 5f63 6f6d 703d 6e5f 636f 6d70 290d   n_comp=n_comp).
+000144d0: 0a20 2020 2020 2020 2063 5f74 6f70 6f73  .        c_topos
+000144e0: 203d 205b 5d0d 0a20 2020 2020 2020 2063   = []..        c
+000144f0: 5f70 7364 7320 3d20 5b5d 0d0a 2020 2020  _psds = []..    
+00014500: 2020 2020 635f 6672 7320 3d20 5b5d 0d0a      c_frs = []..
+00014510: 2020 2020 2020 2020 2370 7269 6e74 2873          #print(s
+00014520: 6f72 7469 6e67 2c20 6f72 6465 7229 0d0a  orting, order)..
+00014530: 2020 2020 2020 2020 7720 3d20 7061 7474          w = patt
+00014540: 6572 6e73 5f73 7472 7563 745b 2777 6569  erns_struct['wei
+00014550: 6768 7473 275d 5b27 646d 7827 5d0d 0a20  ghts']['dmx'].. 
+00014560: 2020 2020 2020 2023 6120 3d20 6e70 2e64         #a = np.d
+00014570: 6f74 2870 6174 7465 726e 735f 7374 7275  ot(patterns_stru
+00014580: 6374 5b27 6463 6f76 275d 5b27 696e 7075  ct['dcov']['inpu
+00014590: 745f 7370 6174 6961 6c27 5d2c 2077 290d  t_spatial'], w).
+000145a0: 0a20 2020 2020 2020 2070 7269 6e74 2873  .        print(s
+000145b0: 6f72 7469 6e67 2c20 273a 2063 6f6d 706f  orting, ': compo
+000145c0: 6e65 6e74 2023 7b7d 272c 206f 7264 6572  nent #{}', order
+000145d0: 5b30 5d5b 305d 290d 0a20 2020 2020 2020  [0][0])..       
+000145e0: 2066 6f72 2069 2c20 636f 6d70 7320 696e   for i, comps in
+000145f0: 2065 6e75 6d65 7261 7465 286f 7264 6572   enumerate(order
+00014600: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00014610: 6120 3d20 6e70 2e64 6f74 2870 6174 7465  a = np.dot(patte
+00014620: 726e 735f 7374 7275 6374 5b27 6463 6f76  rns_struct['dcov
+00014630: 275d 5b27 696e 7075 745f 7370 6174 6961  ']['input_spatia
+00014640: 6c27 5d2c 2077 290d 0a20 2020 2020 2020  l'], w)..       
+00014650: 2020 2020 2023 6120 3d20 6e70 2e64 6f74       #a = np.dot
+00014660: 2870 6174 7465 726e 735f 7374 7275 6374  (patterns_struct
+00014670: 5b27 6463 6f76 275d 5b27 636c 6173 735f  ['dcov']['class_
+00014680: 636f 6e64 6974 696f 6e61 6c27 5d5b 695d  conditional'][i]
+00014690: 2c20 7729 0d0a 0d0a 2020 2020 2020 2020  , w)....        
+000146a0: 2020 2020 635f 746f 706f 732e 6170 7065      c_topos.appe
+000146b0: 6e64 2861 5b3a 2c20 636f 6d70 735d 290d  nd(a[:, comps]).
+000146c0: 0a20 2020 2020 2020 2020 2020 2063 5f70  .            c_p
+000146d0: 7364 732e 6170 7065 6e64 2870 6174 7465  sds.append(patte
+000146e0: 726e 735f 7374 7275 6374 5b27 7370 6563  rns_struct['spec
+000146f0: 7472 6127 5d5b 2770 7364 7327 5d5b 636f  tra']['psds'][co
+00014700: 6d70 732c 203a 5d2e 542c 290d 0a20 2020  mps, :].T,)..   
+00014710: 2020 2020 2020 2020 2063 5f66 7273 2e61           c_frs.a
+00014720: 7070 656e 6428 7061 7474 6572 6e73 5f73  ppend(patterns_s
+00014730: 7472 7563 745b 2773 7065 6374 7261 275d  truct['spectra']
+00014740: 5b27 6672 6571 5f72 6573 706f 6e73 6573  ['freq_responses
+00014750: 275d 5b63 6f6d 7073 2c20 3a5d 2e54 290d  '][comps, :].T).
+00014760: 0a20 2020 2020 2020 2074 6f70 6f20 3d20  .        topo = 
+00014770: 6e70 2e63 6f6e 6361 7465 6e61 7465 2863  np.concatenate(c
+00014780: 5f74 6f70 6f73 2c20 6178 6973 3d2d 3129  _topos, axis=-1)
+00014790: 0d0a 2020 2020 2020 2020 6672 6571 5f72  ..        freq_r
+000147a0: 6573 706f 6e73 6520 3d20 6e70 2e63 6f6e  esponse = np.con
+000147b0: 6361 7465 6e61 7465 2863 5f66 7273 2c20  catenate(c_frs, 
+000147c0: 6178 6973 3d2d 3129 0d0a 2020 2020 2020  axis=-1)..      
+000147d0: 2020 7073 6420 3d20 6e70 2e63 6f6e 6361    psd = np.conca
+000147e0: 7465 6e61 7465 2863 5f70 7364 732c 2061  tenate(c_psds, a
+000147f0: 7869 733d 2d31 290d 0a20 2020 2020 2020  xis=-1)..       
+00014800: 2023 6672 6571 7320 3d20 7061 7474 6572   #freqs = patter
+00014810: 6e73 5f73 7472 7563 745b 2766 7265 7173  ns_struct['freqs
+00014820: 275d 0d0a 2020 2020 2020 2020 7265 7475  ']..        retu
+00014830: 726e 2074 6f70 6f2c 2066 7265 715f 7265  rn topo, freq_re
+00014840: 7370 6f6e 7365 2c20 7073 6423 2c20 6672  sponse, psd#, fr
+00014850: 6571 730d 0a0d 0a20 2020 2064 6566 2070  eqs....    def p
+00014860: 6c6f 745f 636f 6d62 696e 6564 5f70 6174  lot_combined_pat
+00014870: 7465 726e 2873 656c 662c 206d 6574 686f  tern(self, metho
+00014880: 643d 2763 6f6d 6269 6e65 6427 2c20 7365  d='combined', se
+00014890: 6e73 6f72 5f6c 6179 6f75 743d 4e6f 6e65  nsor_layout=None
+000148a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000148b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148c0: 206e 616d 6573 3d4e 6f6e 652c 206e 5f63   names=None, n_c
+000148d0: 6f6d 703d 312c 2070 6c6f 745f 7472 7565  omp=1, plot_true
+000148e0: 5f65 766f 6b65 643d 4661 6c73 652c 0d0a  _evoked=False,..
+000148f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014900: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00014910: 7665 6669 673d 4e6f 6e65 293a 0d0a 2020  vefig=None):..  
+00014920: 2020 2020 2020 6966 206e 6f74 206e 616d        if not nam
+00014930: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
+00014940: 206e 616d 6573 203d 205b 2743 6c61 7373   names = ['Class
+00014950: 207b 7d27 2e66 6f72 6d61 7428 6929 2066   {}'.format(i) f
+00014960: 6f72 2069 2069 6e20 7261 6e67 6528 7365  or i in range(se
+00014970: 6c66 2e79 5f73 6861 7065 5b2d 315d 295d  lf.y_shape[-1])]
+00014980: 0d0a 0d0a 0d0a 2320 2020 2020 2020 2063  ......#        c
+00014990: 6320 3d20 6e70 2e61 7272 6179 285b 6e70  c = np.array([np
+000149a0: 2e63 6f72 7263 6f65 6628 7365 6c66 2e63  .corrcoef(self.c
+000149b0: 765f 7061 7474 6572 6e73 5b3a 2c20 692c  v_patterns[:, i,
+000149c0: 203a 5d2e 5429 5b69 2c3a 5d0d 0a23 2020   :].T)[i,:]..#  
+000149d0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000149e0: 2069 2069 6e20 7261 6e67 6528 7365 6c66   i in range(self
+000149f0: 2e63 765f 7061 7474 6572 6e73 2e73 6861  .cv_patterns.sha
+00014a00: 7065 5b31 5d29 5d29 0d0a 2020 2020 2020  pe[1])])..      
+00014a10: 2020 6966 206c 656e 2873 656c 662e 6376    if len(self.cv
+00014a20: 5f70 6174 7465 726e 732e 6974 656d 7328  _patterns.items(
+00014a30: 2929 203e 2030 3a0d 0a20 2020 2020 2020  )) > 0:..       
+00014a40: 2020 2020 2070 7269 6e74 2822 5265 7374       print("Rest
+00014a50: 6f72 696e 6720 6672 6f6d 3a22 2c20 6d65  oring from:", me
+00014a60: 7468 6f64 2029 0d0a 2020 2020 2020 2020  thod )..        
+00014a70: 2020 2020 746f 706f 7320 3d20 6e70 2e6d      topos = np.m
+00014a80: 6561 6e28 7365 6c66 2e63 765f 7061 7474  ean(self.cv_patt
+00014a90: 6572 6e73 5b6d 6574 686f 645d 5b27 7370  erns[method]['sp
+00014aa0: 6174 6961 6c27 5d2c 0d0a 2020 2020 2020  atial'],..      
+00014ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ac0: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+00014ad0: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+00014ae0: 6669 6c74 6572 7320 3d20 6e70 2e6d 6561  filters = np.mea
+00014af0: 6e28 7365 6c66 2e63 765f 7061 7474 6572  n(self.cv_patter
+00014b00: 6e73 5b6d 6574 686f 645d 5b27 7465 6d70  ns[method]['temp
+00014b10: 6f72 616c 275d 2c0d 0a20 2020 2020 2020  oral'],..       
+00014b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b40: 2d31 290d 0a20 2020 2020 2020 2020 2020  -1)..           
+00014b50: 2070 7364 7320 3d20 6e70 2e6d 6561 6e28   psds = np.mean(
+00014b60: 7365 6c66 2e63 765f 7061 7474 6572 6e73  self.cv_patterns
+00014b70: 5b6d 6574 686f 645d 5b27 7073 6473 275d  [method]['psds']
+00014b80: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00014b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ba0: 2020 2020 2020 202d 3129 0d0a 2020 2020         -1)..    
+00014bb0: 2020 2020 2020 2020 2366 7265 7173 203d          #freqs =
+00014bc0: 2073 656c 662e 6672 6571 730d 0a0d 0a20   self.freqs.... 
+00014bd0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00014be0: 2065 6c69 6620 6d65 7468 6f64 2069 6e20   elif method in 
+00014bf0: 5b27 7765 6967 6874 272c 2027 636f 6d70  ['weight', 'comp
+00014c00: 7769 7365 5f6c 6f73 7327 5d3a 0d0a 2020  wise_loss']:..  
+00014c10: 2020 2020 2020 2020 2020 746f 706f 732c            topos,
+00014c20: 2066 696c 7465 7273 2c20 7073 6473 203d   filters, psds =
+00014c30: 2073 656c 662e 7369 6e67 6c65 5f70 6174   self.single_pat
+00014c40: 7465 726e 2873 6f72 7469 6e67 3d6d 6574  tern(sorting=met
+00014c50: 686f 642c 0d0a 2020 2020 2020 2020 2020  hod,..          
+00014c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c80: 2020 2020 2020 2020 2020 2020 206e 5f63               n_c
+00014c90: 6f6d 703d 6e5f 636f 6d70 290d 0a0d 0a0d  omp=n_comp).....
+00014ca0: 0a20 2020 2020 2020 2066 7265 7173 203d  .        freqs =
+00014cb0: 2073 656c 662e 6376 5f70 6174 7465 726e   self.cv_pattern
+00014cc0: 735b 2766 7265 7173 275d 0d0a 0d0a 2020  s['freqs']....  
+00014cd0: 2020 2020 2020 746f 706f 7320 2f3d 206e        topos /= n
+00014ce0: 702e 6d61 7869 6d75 6d28 746f 706f 732e  p.maximum(topos.
+00014cf0: 7374 6428 6178 6973 3d30 2c20 6b65 6570  std(axis=0, keep
+00014d00: 6469 6d73 3d54 7275 6529 2c0d 0a20 2020  dims=True),..   
+00014d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d30: 2020 3165 2d33 290d 0a20 2020 2020 2020    1e-3)..       
+00014d40: 206e 203d 2073 656c 662e 795f 7368 6170   n = self.y_shap
+00014d50: 655b 305d 0d0a 2020 2020 2020 2020 6e63  e[0]..        nc
+00014d60: 6f6c 7320 3d20 6e0d 0a20 2020 2020 2020  ols = n..       
+00014d70: 206c 6f20 3d20 6368 616e 6e65 6c73 2e72   lo = channels.r
+00014d80: 6561 645f 6c61 796f 7574 2873 656e 736f  ead_layout(senso
+00014d90: 725f 6c61 796f 7574 290d 0a20 2020 2020  r_layout)..     
+00014da0: 2020 2023 6c6f 203d 2063 6861 6e6e 656c     #lo = channel
+00014db0: 732e 6765 6e65 7261 7465 5f32 645f 6c61  s.generate_2d_la
+00014dc0: 796f 7574 286c 6f2e 706f 7329 0d0a 2020  yout(lo.pos)..  
+00014dd0: 2020 2020 2020 696e 666f 203d 2063 7265        info = cre
+00014de0: 6174 655f 696e 666f 286c 6f2e 6e61 6d65  ate_info(lo.name
+00014df0: 732c 2031 2e2c 2073 656e 736f 725f 6c61  s, 1., sensor_la
+00014e00: 796f 7574 2e73 706c 6974 2827 2d27 295b  yout.split('-')[
+00014e10: 2d31 5d29 0d0a 2020 2020 2020 2020 6f72  -1])..        or
+00014e20: 6967 5f78 7920 3d20 6e70 2e6d 6561 6e28  ig_xy = np.mean(
+00014e30: 6c6f 2e70 6f73 5b3a 2c20 3a32 5d2c 2030  lo.pos[:, :2], 0
+00014e40: 290d 0a20 2020 2020 2020 2066 6f72 2069  )..        for i
+00014e50: 2c20 6368 2069 6e20 656e 756d 6572 6174  , ch in enumerat
+00014e60: 6528 6c6f 2e6e 616d 6573 293a 0d0a 2020  e(lo.names):..  
+00014e70: 2020 2020 2020 2020 2020 6966 2069 6e66            if inf
+00014e80: 6f5b 2763 6873 275d 5b69 5d5b 2763 685f  o['chs'][i]['ch_
+00014e90: 6e61 6d65 275d 203d 3d20 6368 3a0d 0a20  name'] == ch:.. 
+00014ea0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00014eb0: 6e66 6f5b 2763 6873 275d 5b69 5d5b 276c  nfo['chs'][i]['l
+00014ec0: 6f63 275d 5b3a 325d 203d 2028 6c6f 2e70  oc'][:2] = (lo.p
+00014ed0: 6f73 5b69 2c20 3a32 5d20 2d20 6f72 6967  os[i, :2] - orig
+00014ee0: 5f78 7929 2f34 2e35 0d0a 2020 2020 2020  _xy)/4.5..      
+00014ef0: 2020 2020 2020 2020 2020 2369 6e66 6f5b            #info[
+00014f00: 2763 6873 275d 5b69 5d5b 276c 6f63 275d  'chs'][i]['loc']
+00014f10: 5b34 3a5d 203d 2030 0d0a 2020 2020 2020  [4:] = 0..      
+00014f20: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00014f30: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00014f40: 6e74 2822 4368 616e 6e65 6c20 6e61 6d65  nt("Channel name
+00014f50: 206d 6973 6d61 7463 682e 2069 6e66 6f3a   mismatch. info:
+00014f60: 207b 7d20 7673 206c 6f3a 207b 7d22 2e66   {} vs lo: {}".f
+00014f70: 6f72 6d61 7428 0d0a 2020 2020 2020 2020  ormat(..        
+00014f80: 2020 2020 2020 2020 2020 2020 696e 666f              info
+00014f90: 5b27 6368 7327 5d5b 695d 5b27 6368 5f6e  ['chs'][i]['ch_n
+00014fa0: 616d 6527 5d2c 2063 6829 290d 0a0d 0a20  ame'], ch)).... 
+00014fb0: 2020 2020 2020 2073 656c 662e 6661 6b65         self.fake
+00014fc0: 5f65 766f 6b65 6420 3d20 6576 6f6b 6564  _evoked = evoked
+00014fd0: 2e45 766f 6b65 6441 7272 6179 2874 6f70  .EvokedArray(top
+00014fe0: 6f73 2c20 696e 666f 290d 0a20 2020 2020  os, info)..     
+00014ff0: 2020 2073 656c 662e 6661 6b65 5f65 766f     self.fake_evo
+00015000: 6b65 642e 6461 7461 5b3a 2c20 3a6e 5d20  ked.data[:, :n] 
+00015010: 3d20 746f 706f 730d 0a0d 0a20 2020 2020  = topos....     
+00015020: 2020 2066 616b 655f 7469 6d65 7320 3d20     fake_times = 
+00015030: 6e70 2e61 7261 6e67 6528 302c 2020 6e2c  np.arange(0,  n,
+00015040: 2031 2e29 0d0a 2020 2020 2020 2020 6674   1.)..        ft
+00015050: 203d 2073 656c 662e 6661 6b65 5f65 766f   = self.fake_evo
+00015060: 6b65 642e 706c 6f74 5f74 6f70 6f6d 6170  ked.plot_topomap
+00015070: 2874 696d 6573 3d66 616b 655f 7469 6d65  (times=fake_time
+00015080: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+00015090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150a0: 2020 2020 2020 2020 2020 2020 2020 2361                #a
+000150b0: 7865 733d 6178 5b30 2c20 305d 2c0d 0a20  xes=ax[0, 0],.. 
 000150c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150d0: 2020 2020 2020 2020 2020 3165 2d33 290d            1e-3).
-000150e0: 0a20 2020 2020 2020 206e 203d 2073 656c  .        n = sel
-000150f0: 662e 795f 7368 6170 655b 305d 0d0a 2020  f.y_shape[0]..  
-00015100: 2020 2020 2020 6e63 6f6c 7320 3d20 6e0d        ncols = n.
-00015110: 0a20 2020 2020 2020 206c 6f20 3d20 6368  .        lo = ch
-00015120: 616e 6e65 6c73 2e72 6561 645f 6c61 796f  annels.read_layo
-00015130: 7574 2873 656e 736f 725f 6c61 796f 7574  ut(sensor_layout
-00015140: 290d 0a20 2020 2020 2020 2023 6c6f 203d  )..        #lo =
-00015150: 2063 6861 6e6e 656c 732e 6765 6e65 7261   channels.genera
-00015160: 7465 5f32 645f 6c61 796f 7574 286c 6f2e  te_2d_layout(lo.
-00015170: 706f 7329 0d0a 2020 2020 2020 2020 696e  pos)..        in
-00015180: 666f 203d 2063 7265 6174 655f 696e 666f  fo = create_info
-00015190: 286c 6f2e 6e61 6d65 732c 2031 2e2c 2073  (lo.names, 1., s
-000151a0: 656e 736f 725f 6c61 796f 7574 2e73 706c  ensor_layout.spl
-000151b0: 6974 2827 2d27 295b 2d31 5d29 0d0a 2020  it('-')[-1])..  
-000151c0: 2020 2020 2020 6f72 6967 5f78 7920 3d20        orig_xy = 
-000151d0: 6e70 2e6d 6561 6e28 6c6f 2e70 6f73 5b3a  np.mean(lo.pos[:
-000151e0: 2c20 3a32 5d2c 2030 290d 0a20 2020 2020  , :2], 0)..     
-000151f0: 2020 2066 6f72 2069 2c20 6368 2069 6e20     for i, ch in 
-00015200: 656e 756d 6572 6174 6528 6c6f 2e6e 616d  enumerate(lo.nam
-00015210: 6573 293a 0d0a 2020 2020 2020 2020 2020  es):..          
-00015220: 2020 6966 2069 6e66 6f5b 2763 6873 275d    if info['chs']
-00015230: 5b69 5d5b 2763 685f 6e61 6d65 275d 203d  [i]['ch_name'] =
-00015240: 3d20 6368 3a0d 0a20 2020 2020 2020 2020  = ch:..         
-00015250: 2020 2020 2020 2069 6e66 6f5b 2763 6873         info['chs
-00015260: 275d 5b69 5d5b 276c 6f63 275d 5b3a 325d  '][i]['loc'][:2]
-00015270: 203d 2028 6c6f 2e70 6f73 5b69 2c20 3a32   = (lo.pos[i, :2
-00015280: 5d20 2d20 6f72 6967 5f78 7929 2f34 2e35  ] - orig_xy)/4.5
-00015290: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000152a0: 2020 2369 6e66 6f5b 2763 6873 275d 5b69    #info['chs'][i
-000152b0: 5d5b 276c 6f63 275d 5b34 3a5d 203d 2030  ]['loc'][4:] = 0
-000152c0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-000152d0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-000152e0: 2020 2020 2070 7269 6e74 2822 4368 616e       print("Chan
-000152f0: 6e65 6c20 6e61 6d65 206d 6973 6d61 7463  nel name mismatc
-00015300: 682e 2069 6e66 6f3a 207b 7d20 7673 206c  h. info: {} vs l
-00015310: 6f3a 207b 7d22 2e66 6f72 6d61 7428 0d0a  o: {}".format(..
-00015320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015330: 2020 2020 696e 666f 5b27 6368 7327 5d5b      info['chs'][
-00015340: 695d 5b27 6368 5f6e 616d 6527 5d2c 2063  i]['ch_name'], c
-00015350: 6829 290d 0a0d 0a20 2020 2020 2020 2073  h))....        s
-00015360: 656c 662e 6661 6b65 5f65 766f 6b65 6420  elf.fake_evoked 
-00015370: 3d20 6576 6f6b 6564 2e45 766f 6b65 6441  = evoked.EvokedA
-00015380: 7272 6179 2874 6f70 6f73 2c20 696e 666f  rray(topos, info
-00015390: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000153a0: 6661 6b65 5f65 766f 6b65 642e 6461 7461  fake_evoked.data
-000153b0: 5b3a 2c20 3a6e 5d20 3d20 746f 706f 730d  [:, :n] = topos.
-000153c0: 0a0d 0a20 2020 2020 2020 2066 616b 655f  ...        fake_
-000153d0: 7469 6d65 7320 3d20 6e70 2e61 7261 6e67  times = np.arang
-000153e0: 6528 302c 2020 6e2c 2031 2e29 0d0a 2020  e(0,  n, 1.)..  
-000153f0: 2020 2020 2020 6674 203d 2073 656c 662e        ft = self.
-00015400: 6661 6b65 5f65 766f 6b65 642e 706c 6f74  fake_evoked.plot
-00015410: 5f74 6f70 6f6d 6170 2874 696d 6573 3d66  _topomap(times=f
-00015420: 616b 655f 7469 6d65 732c 0d0a 2020 2020  ake_times,..    
-00015430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015450: 2020 2020 2020 2361 7865 733d 6178 5b30        #axes=ax[0
-00015460: 2c20 305d 2c0d 0a20 2020 2020 2020 2020  , 0],..         
-00015470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015490: 2063 6f6c 6f72 6261 723d 5472 7565 2c0d   colorbar=True,.
-000154a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000150d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150e0: 2020 2020 2020 2020 2063 6f6c 6f72 6261           colorba
+000150f0: 723d 5472 7565 2c0d 0a20 2020 2020 2020  r=True,..       
+00015100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015120: 2020 2023 766d 6178 3d76 6d61 782c 0d0a     #vmax=vmax,..
+00015130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015150: 2020 2020 2020 2020 2020 7363 616c 696e            scalin
+00015160: 6773 3d31 2c0d 0a20 2020 2020 2020 2020  gs=1,..         
+00015170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015190: 2074 696d 655f 666f 726d 6174 3d6d 6574   time_format=met
+000151a0: 686f 642c 0d0a 2020 2020 2020 2020 2020  hod,..          
+000151b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151d0: 2374 6974 6c65 3d27 272c 0d0a 2020 2020  #title='',..    
+000151e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015200: 2020 2020 2020 2373 697a 653d 312c 0d0a        #size=1,..
+00015210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015230: 2020 2020 2020 2020 2020 6f75 746c 696e            outlin
+00015240: 6573 3d27 6865 6164 272c 0d0a 2020 2020  es='head',..    
+00015250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015270: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00015280: 2023 6d65 7468 6f64 203d 2022 7061 7465   #method = "pate
+00015290: 726e 6e65 745f 7265 6374 5f63 635f 636f  rnnet_rect_cc_co
+000152a0: 7664 6966 5f63 635f 6663 6163 7464 6966  vdif_cc_fcactdif
+000152b0: 220d 0a20 2020 2020 2020 2023 6674 2e73  "..        #ft.s
+000152c0: 6574 5f73 697a 655f 696e 6368 6573 285b  et_size_inches([
+000152d0: 3135 2c33 2e35 5d29 0d0a 2020 2020 2020  15,3.5])..      
+000152e0: 2020 6966 2073 6176 6566 6967 3a0d 0a20    if savefig:.. 
+000152f0: 2020 2020 2020 2020 2020 2066 6967 6e61             figna
+00015300: 6d65 203d 2027 2d27 2e6a 6f69 6e28 5b73  me = '-'.join([s
+00015310: 656c 662e 6d65 7461 2e64 6174 615b 2770  elf.meta.data['p
+00015320: 6174 6827 5d20 2b20 6d65 7468 6f64 2c20  ath'] + method, 
+00015330: 2274 6f70 6f73 2e73 7667 225d 290d 0a20  "topos.svg"]).. 
+00015340: 2020 2020 2020 2020 2020 2066 742e 7361             ft.sa
+00015350: 7665 6669 6728 6669 676e 616d 652c 2066  vefig(figname, f
+00015360: 6f72 6d61 743d 2773 7667 272c 2074 7261  ormat='svg', tra
+00015370: 6e73 7061 7265 6e74 3d54 7275 6529 0d0a  nsparent=True)..
+00015380: 2020 2020 2020 2020 6966 2070 6c6f 745f          if plot_
+00015390: 7472 7565 5f65 766f 6b65 643a 0d0a 2020  true_evoked:..  
+000153a0: 2020 2020 2020 2020 2020 2374 7275 655f            #true_
+000153b0: 7469 6d65 7320 3d20 6e70 2e61 7267 6d61  times = np.argma
+000153c0: 7828 6e70 2e6d 6561 6e28 7365 6c66 2e74  x(np.mean(self.t
+000153d0: 7275 655f 6576 6f6b 6564 5f64 6174 612a  rue_evoked_data*
+000153e0: 2a32 2c20 2d31 292c 3129 0d0a 2020 2020  *2, -1),1)..    
+000153f0: 2020 2020 2020 2020 2365 6420 3d20 6e70          #ed = np
+00015400: 2e73 7461 636b 285b 7365 6c66 2e74 7275  .stack([self.tru
+00015410: 655f 6576 6f6b 6564 5f64 6174 615b 692c  e_evoked_data[i,
+00015420: 2074 742c 203a 5d20 666f 7220 692c 2074   tt, :] for i, t
+00015430: 7420 696e 2065 6e75 6d65 7261 7465 2874  t in enumerate(t
+00015440: 7275 655f 7469 6d65 7329 5d29 0d0a 2020  rue_times)])..  
+00015450: 2020 2020 2020 2020 2020 7420 3d20 7365            t = se
+00015460: 6c66 2e70 6c6f 745f 6576 6f6b 6564 5f70  lf.plot_evoked_p
+00015470: 6561 6b73 284e 6f6e 652c 2073 656e 736f  eaks(None, senso
+00015480: 725f 6c61 796f 7574 3d73 656e 736f 725f  r_layout=sensor_
+00015490: 6c61 796f 7574 2c0d 0a20 2020 2020 2020  layout,..       
+000154a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000154b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154c0: 2020 2020 2020 2020 2020 2023 766d 6178             #vmax
-000154d0: 3d76 6d61 782c 0d0a 2020 2020 2020 2020  =vmax,..        
-000154e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015500: 2020 7363 616c 696e 6773 3d31 2c0d 0a20    scalings=1,.. 
-00015510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015530: 2020 2020 2020 2020 2074 696d 655f 666f           time_fo
-00015540: 726d 6174 3d22 436c 6173 7320 2567 222c  rmat="Class %g",
-00015550: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00015560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015570: 2020 2020 2020 2020 2020 2020 2374 6974              #tit
-00015580: 6c65 3d27 272c 0d0a 2020 2020 2020 2020  le='',..        
-00015590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155b0: 2020 2373 697a 653d 312c 0d0a 2020 2020    #size=1,..    
-000155c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155e0: 2020 2020 2020 6f75 746c 696e 6573 3d27        outlines='
-000155f0: 6865 6164 272c 0d0a 2020 2020 2020 2020  head',..        
-00015600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015620: 2020 290d 0a20 2020 2020 2020 206d 6574    )..        met
-00015630: 686f 6420 3d20 2270 6174 6572 6e6e 6574  hod = "paternnet
-00015640: 5f72 6563 745f 6363 5f63 6f76 6469 665f  _rect_cc_covdif_
-00015650: 6363 5f66 6361 6374 6469 6622 0d0a 2020  cc_fcactdif"..  
-00015660: 2020 2020 2020 2366 742e 7365 745f 7369        #ft.set_si
-00015670: 7a65 5f69 6e63 6865 7328 5b31 352c 332e  ze_inches([15,3.
-00015680: 355d 290d 0a20 2020 2020 2020 2023 6669  5])..        #fi
-00015690: 676e 616d 6520 3d20 272d 272e 6a6f 696e  gname = '-'.join
-000156a0: 285b 7365 6c66 2e6d 6f64 656c 5f70 6174  ([self.model_pat
-000156b0: 6820 2b20 7365 6c66 2e73 636f 7065 2c20  h + self.scope, 
-000156c0: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
-000156d0: 6172 616d 735b 2764 6174 615f 6964 275d  arams['data_id']
-000156e0: 2c20 6d65 7468 6f64 2c20 2274 6f70 6f73  , method, "topos
-000156f0: 2e73 7667 225d 290d 0a20 2020 2020 2020  .svg"])..       
-00015700: 2023 6674 2e73 6176 6566 6967 2866 6967   #ft.savefig(fig
-00015710: 6e61 6d65 2c20 666f 726d 6174 3d27 7376  name, format='sv
-00015720: 6727 2c20 7472 616e 7370 6172 656e 743d  g', transparent=
-00015730: 5472 7565 290d 0a20 2020 2020 2020 2069  True)..        i
-00015740: 6620 706c 6f74 5f74 7275 655f 6576 6f6b  f plot_true_evok
-00015750: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-00015760: 2023 7472 7565 5f74 696d 6573 203d 206e   #true_times = n
-00015770: 702e 6172 676d 6178 286e 702e 6d65 616e  p.argmax(np.mean
-00015780: 2873 656c 662e 7472 7565 5f65 766f 6b65  (self.true_evoke
-00015790: 645f 6461 7461 2a2a 322c 202d 3129 2c31  d_data**2, -1),1
-000157a0: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
-000157b0: 6564 203d 206e 702e 7374 6163 6b28 5b73  ed = np.stack([s
-000157c0: 656c 662e 7472 7565 5f65 766f 6b65 645f  elf.true_evoked_
-000157d0: 6461 7461 5b69 2c20 7474 2c20 3a5d 2066  data[i, tt, :] f
-000157e0: 6f72 2069 2c20 7474 2069 6e20 656e 756d  or i, tt in enum
-000157f0: 6572 6174 6528 7472 7565 5f74 696d 6573  erate(true_times
-00015800: 295d 290d 0a20 2020 2020 2020 2020 2020  )])..           
-00015810: 2073 656c 662e 706c 6f74 5f74 7275 655f   self.plot_true_
-00015820: 6576 6f6b 6564 2873 656c 662e 7472 7565  evoked(self.true
-00015830: 5f65 766f 6b65 645f 6461 7461 2c20 7365  _evoked_data, se
-00015840: 6e73 6f72 5f6c 6179 6f75 743d 7365 6e73  nsor_layout=sens
-00015850: 6f72 5f6c 6179 6f75 7429 0d0a 0d0a 2320  or_layout)....# 
-00015860: 2020 2020 2020 2020 6966 206e 636f 6c73          if ncols
-00015870: 203d 3d20 313a 0d0a 2320 2020 2020 2020   == 1:..#       
-00015880: 2020 2020 2020 706c 742e 6669 6775 7265        plt.figure
-00015890: 2829 0d0a 2320 2020 2020 2020 2020 2020  ()..#           
-000158a0: 2020 6178 203d 2070 6c74 2e67 6361 2829    ax = plt.gca()
-000158b0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-000158c0: 6e6f 726d 616c 697a 6564 5f69 6e70 7574  normalized_input
-000158d0: 5f72 7073 203d 2070 7364 732f 6e70 2e6d  _rps = psds/np.m
-000158e0: 6178 696d 756d 286e 702e 7375 6d28 7073  aximum(np.sum(ps
-000158f0: 6473 292c 2031 652d 3629 0d0a 2320 2020  ds), 1e-6)..#   
-00015900: 2020 2020 2020 2020 2020 6e6f 726d 616c            normal
-00015910: 697a 6564 5f6f 7574 7075 745f 7270 7320  ized_output_rps 
-00015920: 3d20 6669 6c74 6572 732a 7073 6473 0d0a  = filters*psds..
-00015930: 2320 2020 2020 2020 2020 2020 2020 6e6f  #             no
-00015940: 726d 616c 697a 6564 5f6f 7574 7075 745f  rmalized_output_
-00015950: 7270 7320 2f3d 206e 702e 6d61 7869 6d75  rps /= np.maximu
-00015960: 6d28 6e70 2e73 756d 2866 696c 7465 7273  m(np.sum(filters
-00015970: 2a70 7364 7329 2c20 3165 2d36 290d 0a23  *psds), 1e-6)..#
-00015980: 2020 2020 2020 2020 2020 2020 2061 782e               ax.
-00015990: 706c 6f74 2866 7265 7173 2c20 6e6f 726d  plot(freqs, norm
-000159a0: 616c 697a 6564 5f69 6e70 7574 5f72 7073  alized_input_rps
-000159b0: 2c20 6c61 6265 6c3d 2749 6e70 7574 2052  , label='Input R
-000159c0: 5053 2729 0d0a 2320 2020 2020 2020 2020  PS')..#         
-000159d0: 2020 2020 6178 2e70 6c6f 7428 6672 6571      ax.plot(freq
-000159e0: 732c 206e 6f72 6d61 6c69 7a65 645f 6f75  s, normalized_ou
-000159f0: 7470 7574 5f72 7073 2c20 6c61 6265 6c3d  tput_rps, label=
-00015a00: 274f 7574 7075 7420 5250 5327 290d 0a23  'Output RPS')..#
-00015a10: 2023 2020 2020 2020 2020 2020 2020 6178   #            ax
-00015a20: 2e70 6c6f 7428 6672 6571 732c 2066 696c  .plot(freqs, fil
-00015a30: 7465 7273 2f6e 702e 6d61 7869 6d75 6d28  ters/np.maximum(
-00015a40: 6e70 2e73 756d 2866 696c 7465 7273 292c  np.sum(filters),
-00015a50: 2031 652d 3629 2c0d 0a23 2023 2020 2020   1e-6),..# #    
-00015a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a70: 6c61 6265 6c3d 2746 7265 7120 7265 7370  label='Freq resp
-00015a80: 6f6e 7365 2729 0d0a 2320 2020 2020 2020  onse')..#       
-00015a90: 2020 2020 2020 6178 2e6c 6567 656e 6428        ax.legend(
-00015aa0: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
-00015ab0: 2061 782e 7365 745f 786c 696d 2830 2c20   ax.set_xlim(0, 
-00015ac0: 3930 290d 0a23 2020 2020 2020 2020 2020  90)..#          
-00015ad0: 2020 2023 706c 742e 7368 6f77 2829 0d0a     #plt.show()..
-00015ae0: 2320 2020 2020 2020 2020 656c 7365 3a0d  #         else:.
-00015af0: 0a23 2020 2020 2020 2020 2020 2020 2066  .#             f
-00015b00: 2c20 6178 203d 2070 6c74 2e73 7562 706c  , ax = plt.subpl
-00015b10: 6f74 7328 312c 206e 636f 6c73 2c20 7368  ots(1, ncols, sh
-00015b20: 6172 6579 3d54 7275 652c 2063 6f6e 7374  arey=True, const
-00015b30: 7261 696e 6564 5f6c 6179 6f75 743d 5472  rained_layout=Tr
-00015b40: 7565 290d 0a23 2020 2020 2020 2020 2020  ue)..#          
-00015b50: 2020 2023 662e 636f 6e73 7472 6169 6e65     #f.constraine
-00015b60: 645f 6c61 796f 7574 2829 0d0a 2320 2020  d_layout()..#   
-00015b70: 2020 2020 2020 2020 2020 662e 7365 745f            f.set_
-00015b80: 7369 7a65 5f69 6e63 6865 7328 5b31 342c  size_inches([14,
-00015b90: 2033 2e5d 290d 0a23 2020 2020 2020 2020   3.])..#        
-00015ba0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-00015bb0: 6e67 6528 6e63 6f6c 7329 3a0d 0a23 2020  nge(ncols):..#  
-00015bc0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00015bd0: 6178 5b69 5d2e 7365 6d69 6c6f 6779 2866  ax[i].semilogy(f
-00015be0: 7265 7173 5b3a 2d31 5d2c 2063 6f6d 6269  reqs[:-1], combi
-00015bf0: 6e65 645f 6669 6c74 6572 735b 3a2c 695d  ned_filters[:,i]
-00015c00: 2c20 6c61 6265 6c3d 2749 6d70 756c 7365  , label='Impulse
-00015c10: 2072 6573 706f 6e73 6527 290d 0a23 2020   response')..#  
-00015c20: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00015c30: 6f72 6d61 6c69 7a65 645f 6f75 7470 7574  ormalized_output
-00015c40: 5f72 7073 203d 2066 696c 7465 7273 5b3a  _rps = filters[:
-00015c50: 2c69 5d2a 7073 6473 5b3a 2c69 5d0d 0a23  ,i]*psds[:,i]..#
-00015c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c70: 206e 6f72 6d61 6c69 7a65 645f 6f75 7470   normalized_outp
-00015c80: 7574 5f72 7073 202f 3d20 6e70 2e6d 6178  ut_rps /= np.max
-00015c90: 696d 756d 286e 702e 7375 6d28 6669 6c74  imum(np.sum(filt
-00015ca0: 6572 735b 3a2c 695d 2a70 7364 735b 3a2c  ers[:,i]*psds[:,
-00015cb0: 695d 292c 2031 652d 3629 0d0a 2320 2020  i]), 1e-6)..#   
-00015cc0: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-00015cd0: 726d 616c 697a 6564 5f69 6e70 7574 5f72  rmalized_input_r
-00015ce0: 7073 203d 2070 7364 735b 3a2c 695d 202f  ps = psds[:,i] /
-00015cf0: 206e 702e 6d61 7869 6d75 6d28 6e70 2e73   np.maximum(np.s
-00015d00: 756d 2870 7364 735b 3a2c 695d 292c 2031  um(psds[:,i]), 1
-00015d10: 652d 3629 0d0a 0d0a 0d0a 0d0a 2320 2020  e-6)........#   
-00015d20: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-00015d30: 5b69 5d2e 706c 6f74 2866 7265 7173 2c20  [i].plot(freqs, 
-00015d40: 6e6f 726d 616c 697a 6564 5f69 6e70 7574  normalized_input
-00015d50: 5f72 7073 2c20 6c61 6265 6c3d 274c 6179  _rps, label='Lay
-00015d60: 6572 2049 6e70 7574 2729 0d0a 2320 2020  er Input')..#   
-00015d70: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-00015d80: 5b69 5d2e 7365 745f 7469 746c 6528 6e61  [i].set_title(na
-00015d90: 6d65 735b 695d 290d 0a23 2020 2020 2020  mes[i])..#      
-00015da0: 2020 2020 2020 2020 2020 2061 785b 695d             ax[i]
-00015db0: 2e70 6c6f 7428 6672 6571 732c 206e 6f72  .plot(freqs, nor
-00015dc0: 6d61 6c69 7a65 645f 6f75 7470 7574 5f72  malized_output_r
-00015dd0: 7073 2c20 6c61 6265 6c3d 2745 7874 7261  ps, label='Extra
-00015de0: 6374 6564 2043 6f6d 706f 6e65 6e74 2729  cted Component')
-00015df0: 0d0a 2320 2320 2020 2020 2020 2020 2020  ..# #           
-00015e00: 2020 2020 2061 785b 695d 2e70 6c6f 7428       ax[i].plot(
-00015e10: 6672 6571 732c 2066 696c 7465 7273 5b3a  freqs, filters[:
-00015e20: 2c20 695d 2f6e 702e 6d61 7869 6d75 6d28  , i]/np.maximum(
-00015e30: 6e70 2e73 756d 2866 696c 7465 7273 5b3a  np.sum(filters[:
-00015e40: 2c20 695d 292c 2031 652d 3629 2c0d 0a23  , i]), 1e-6),..#
-00015e50: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00015e60: 2020 2020 2020 6c61 6265 6c3d 2746 7265        label='Fre
-00015e70: 7120 7265 7370 6f6e 7365 2729 0d0a 2320  q response')..# 
-00015e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e90: 2361 785b 695d 2e70 6c6f 7428 6672 6571  #ax[i].plot(freq
-00015ea0: 735b 3a2d 315d 2c20 636f 6d62 696e 6564  s[:-1], combined
-00015eb0: 5f66 696c 7465 7273 5b3a 2c69 5d2c 206c  _filters[:,i], l
-00015ec0: 6162 656c 3d27 4f75 7470 7574 2052 5053  abel='Output RPS
-00015ed0: 2729 0d0a 2320 2020 2020 2020 2020 2020  ')..#           
-00015ee0: 2020 2020 2020 2361 785b 695d 2e70 6c6f        #ax[i].plo
-00015ef0: 7428 6672 6571 735b 3a2d 315d 2c20 636f  t(freqs[:-1], co
-00015f00: 6d62 696e 6564 5f70 7364 735b 3a2c 695d  mbined_psds[:,i]
-00015f10: 2c20 6c61 6265 6c3d 2749 6e70 7574 2052  , label='Input R
-00015f20: 5053 2729 0d0a 2320 2020 2020 2020 2020  PS')..#         
-00015f30: 2020 2020 2020 2020 6178 5b69 5d2e 7365          ax[i].se
-00015f40: 745f 786c 696d 2830 2c20 3730 290d 0a0d  t_xlim(0, 70)...
-00015f50: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
-00015f60: 2020 2061 785b 695d 2e73 6574 5f78 7469     ax[i].set_xti
-00015f70: 636b 6c61 6265 6c73 2861 785b 695d 2e67  cklabels(ax[i].g
-00015f80: 6574 5f78 6d61 6a6f 7274 6963 6b6c 6162  et_xmajorticklab
-00015f90: 656c 7328 292c 0d0a 2320 2020 2020 2020  els(),..#       
-00015fa0: 2020 2020 2020 2020 2020 2020 666f 6e74              font
-00015fb0: 6469 6374 3d7b 2766 6f6e 7473 697a 6527  dict={'fontsize'
-00015fc0: 3a31 347d 290d 0a23 2020 2020 2020 2020  :14})..#        
-00015fd0: 2020 2020 2020 2020 2066 6f72 2073 7069           for spi
-00015fe0: 6e65 2069 6e20 5b27 746f 7027 2c20 2772  ne in ['top', 'r
-00015ff0: 6967 6874 275d 3a0d 0a23 2020 2020 2020  ight']:..#      
-00016000: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00016010: 785b 695d 2e73 7069 6e65 735b 7370 696e  x[i].spines[spin
-00016020: 655d 2e73 6574 5f76 6973 6962 6c65 2846  e].set_visible(F
-00016030: 616c 7365 290d 0a23 2020 2020 2020 2020  alse)..#        
-00016040: 2020 2020 2020 2020 2023 6178 5b69 5d2e           #ax[i].
-00016050: 7365 745f 6672 616d 655f 6f6e 2846 616c  set_frame_on(Fal
-00016060: 7365 290d 0a23 2020 2020 2020 2020 2020  se)..#          
-00016070: 2020 2020 2020 2023 6178 5b69 5d2e 7365         #ax[i].se
-00016080: 745f 796c 696d 2831 652d 352c 2031 2e29  t_ylim(1e-5, 1.)
-00016090: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-000160a0: 2020 2020 6966 2069 203d 3d20 6e63 6f6c      if i == ncol
-000160b0: 732d 313a 0d0a 2320 2020 2020 2020 2020  s-1:..#         
-000160c0: 2020 2020 2020 2020 2020 2020 6178 5b69              ax[i
-000160d0: 5d2e 6c65 6765 6e64 2829 0d0a 2320 2020  ].legend()..#   
-000160e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000160f0: 2069 203d 3d20 303a 0d0a 2320 2020 2020   i == 0:..#     
-00016100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016110: 7469 636b 7320 3d20 6178 5b69 5d2e 6765  ticks = ax[i].ge
-00016120: 745f 7974 6963 6b73 2829 0d0a 2320 2020  t_yticks()..#   
-00016130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016140: 2020 6966 2074 6963 6b73 5b30 5d20 3c20    if ticks[0] < 
-00016150: 3020 616e 6420 7469 636b 735b 315d 203d  0 and ticks[1] =
-00016160: 3d20 303a 0d0a 2320 2020 2020 2020 2020  = 0:..#         
-00016170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016180: 696e 6420 3d20 6e70 2e61 7261 6e67 6528  ind = np.arange(
-00016190: 312c 206c 656e 2874 6963 6b73 292c 2032  1, len(ticks), 2
-000161a0: 2c20 6474 7970 653d 696e 7429 0d0a 2320  , dtype=int)..# 
-000161b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161c0: 2020 2020 656c 7365 3a0d 0a23 2020 2020      else:..#    
-000161d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161e0: 2020 2020 2069 6e64 203d 206e 702e 6172       ind = np.ar
-000161f0: 616e 6765 2830 2c20 6c65 6e28 7469 636b  ange(0, len(tick
-00016200: 7329 2c20 322c 2064 7479 7065 3d69 6e74  s), 2, dtype=int
-00016210: 290d 0a0d 0a23 2020 2020 2020 2020 2020  )....#          
-00016220: 2020 2020 2020 2020 2020 2061 785b 695d             ax[i]
-00016230: 2e73 6574 5f79 7469 636b 7328 7469 636b  .set_yticks(tick
-00016240: 735b 696e 645d 290d 0a23 2020 2020 2020  s[ind])..#      
-00016250: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00016260: 785b 695d 2e73 6574 5f79 7469 636b 6c61  x[i].set_ytickla
-00016270: 6265 6c73 2861 785b 695d 2e67 6574 5f79  bels(ax[i].get_y
-00016280: 6d61 6a6f 7274 6963 6b6c 6162 656c 7328  majorticklabels(
-00016290: 292c 0d0a 2320 2020 2020 2020 2020 2020  ),..#           
-000162a0: 2020 2020 2020 2020 2020 2020 666f 6e74              font
-000162b0: 6469 6374 3d7b 2766 6f6e 7473 697a 6527  dict={'fontsize'
-000162c0: 3a31 347d 290d 0a23 2020 2020 2020 2020  :14})..#        
-000162d0: 2020 2020 2020 2020 2020 2020 2061 785b               ax[
-000162e0: 695d 2e73 6574 5f79 6c61 6265 6c28 2752  i].set_ylabel('R
-000162f0: 656c 6174 6976 6520 706f 7765 722c 2025  elative power, %
-00016300: 272c 2066 6f6e 7473 697a 653d 3136 290d  ', fontsize=16).
-00016310: 0a23 2020 2020 2020 2020 2020 2020 2066  .#             f
-00016320: 2e73 7570 786c 6162 656c 2827 4672 6571  .supxlabel('Freq
-00016330: 7565 6e63 792c 2048 7a27 2c20 666f 6e74  uency, Hz', font
-00016340: 7369 7a65 3d31 3629 0d0a 2320 2020 2020  size=16)..#     
-00016350: 2020 2020 706c 742e 7368 6f77 2829 0d0a      plt.show()..
-00016360: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00016370: 2020 2361 785b 695d 2e73 686f 7728 290d    #ax[i].show().
-00016380: 0a0d 0a0d 0a0d 0a0d 0a0d 0a20 2020 2023  ...........    #
-00016390: 2064 6566 2070 6c6f 745f 7370 6563 7472   def plot_spectr
-000163a0: 6128 7365 6c66 2c20 7061 7474 6572 6e73  a(self, patterns
-000163b0: 5f73 7472 7563 742c 2063 6f6d 706f 6e65  _struct, compone
-000163c0: 6e74 5f69 6e64 2c20 6178 2c20 6673 3d4e  nt_ind, ax, fs=N
-000163d0: 6f6e 652c 206c 6f61 673d 4661 6c73 6529  one, loag=False)
-000163e0: 3a0d 0a20 2020 2023 2020 2020 2022 2222  :..    #     """
-000163f0: 5265 6c61 7469 7665 2070 6f77 6572 2073  Relative power s
-00016400: 7065 6374 7261 206f 6620 6120 6769 7665  pectra of a give
-00016410: 6e20 6c61 7465 6e74 2063 6f6d 706f 6e65  n latent compone
-00016420: 6e64 6520 6265 666f 7265 2061 6e64 2061  nde before and a
-00016430: 6674 6572 0d0a 2020 2020 2320 2020 2020  fter..    #     
-00016440: 2020 2061 7070 6c79 696e 6720 7468 6520     applying the 
-00016450: 636f 6e76 6f6c 7574 696f 6e2e 0d0a 0d0a  convolution.....
-00016460: 2020 2020 2320 2020 2020 5061 7261 6d65      #     Parame
-00016470: 7465 7273 0d0a 2020 2020 2320 2020 2020  ters..    #     
-00016480: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 0d0a 2020  ----------....  
-00016490: 2020 2320 2020 2020 7061 7474 6572 6e73    #     patterns
-000164a0: 5f73 7472 7563 7420 3a0d 0a20 2020 2023  _struct :..    #
-000164b0: 2020 2020 2020 2020 2069 6e73 7461 6e63           instanc
-000164c0: 6520 6f66 2070 6174 7465 726e 735f 7374  e of patterns_st
-000164d0: 7275 6374 2070 726f 6475 6365 6420 6279  ruct produced by
-000164e0: 206d 6f64 656c 2e63 6f6d 7075 7465 5f70   model.compute_p
-000164f0: 6174 7465 726e 730d 0a0d 0a20 2020 2023  atterns....    #
-00016500: 2020 2020 2061 7820 3a20 6178 6573 0d0a       ax : axes..
-00016510: 0d0a 2020 2020 2320 2020 2020 6673 203a  ..    #     fs :
-00016520: 2066 6c6f 6174 0d0a 2020 2020 2320 2020   float..    #   
-00016530: 2020 2020 2020 5361 6d70 6c69 6e67 2066        Sampling f
-00016540: 7265 7175 656e 6379 2e0d 0a0d 0a20 2020  requency.....   
-00016550: 2023 2020 2020 206c 6f67 203a 2062 6f6f   #     log : boo
-00016560: 6c0d 0a20 2020 2023 2020 2020 2020 2020  l..    #        
-00016570: 2041 7070 6c79 206c 6f67 2d74 7261 6e73   Apply log-trans
-00016580: 666f 726d 2074 6f20 7468 6520 7370 6563  form to the spec
-00016590: 7472 612e 0d0a 0d0a 0d0a 0d0a 2020 2020  tra.........    
-000165a0: 2320 2020 2020 2222 220d 0a0d 0a20 2020  #     """....   
-000165b0: 2023 2020 2020 2069 6620 6e6f 7420 6673   #     if not fs
-000165c0: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
-000165d0: 7072 696e 7428 2753 616d 706c 696e 6720  print('Sampling 
-000165e0: 6672 6571 7565 6e63 7920 6e6f 7420 7370  frequency not sp
-000165f0: 6563 6966 6965 642c 2073 6574 7469 6e67  ecified, setting
-00016600: 2074 6f20 312e 2729 0d0a 2020 2020 2320   to 1.')..    # 
-00016610: 2020 2020 2020 2073 656c 662e 6673 203d         self.fs =
-00016620: 2031 2e0d 0a0d 0a20 2020 2023 2020 2020   1.....    #    
-00016630: 2066 696c 7465 7273 203d 2070 6174 7465   filters = patte
-00016640: 726e 735f 7374 7275 6374 5b27 7765 6967  rns_struct['weig
-00016650: 6874 7327 5d5b 2774 636f 6e76 275d 5b3a  hts']['tconv'][:
-00016660: 2c20 636f 6d70 6f6e 656e 745f 696e 645d  , component_ind]
-00016670: 0d0a 2020 2020 2320 2020 2020 705f 696e  ..    #     p_in
-00016680: 7075 7420 3d20 7061 7474 6572 6e73 5f73  put = patterns_s
-00016690: 7472 7563 745b 2773 7065 6374 7261 275d  truct['spectra']
-000166a0: 5b27 7073 6473 275d 5b63 6f6d 706f 6e65  ['psds'][compone
-000166b0: 6e74 5f69 6e64 2c20 3a5d 0d0a 0d0a 2020  nt_ind, :]....  
-000166c0: 2020 2320 2020 2020 772c 2068 203d 2066    #     w, h = f
-000166d0: 7265 717a 2866 696c 7465 7273 2c20 312c  reqz(filters, 1,
-000166e0: 2077 6f72 4e3d 7365 6c66 2e6e 6666 7429   worN=self.nfft)
-000166f0: 0d0a 2020 2020 2320 2020 2020 6672 3120  ..    #     fr1 
-00016700: 3d20 772f 6e70 2e70 692a 7365 6c66 2e66  = w/np.pi*self.f
-00016710: 732f 320d 0a20 2020 2023 2020 2020 2068  s/2..    #     h
-00016720: 3020 3d20 705f 696e 7075 742a 6e70 2e61  0 = p_input*np.a
-00016730: 6273 2868 290d 0a0d 0a0d 0a20 2020 2023  bs(h)......    #
-00016740: 2020 2020 2069 6620 6c6f 673a 0d0a 2020       if log:..  
-00016750: 2020 2320 2020 2020 2020 2020 6178 5b69    #         ax[i
-00016760: 2c20 6a6a 5d2e 7365 6d69 6c6f 6779 2866  , jj].semilogy(f
-00016770: 7231 2c20 705f 696e 7075 742f 705f 696e  r1, p_input/p_in
-00016780: 7075 742e 7375 6d28 292c 0d0a 2020 2020  put.sum(),..    
-00016790: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000167a0: 2020 2020 2020 2020 2020 2020 206c 6162               lab
-000167b0: 656c 3d27 4669 6c74 6572 2069 6e70 7574  el='Filter input
-000167c0: 2052 5053 2729 0d0a 2020 2020 2320 2020   RPS')..    #   
-000167d0: 2020 2020 2020 6178 5b69 2c20 6a6a 5d2e        ax[i, jj].
-000167e0: 7365 6d69 6c6f 6779 2866 7231 2c20 6830  semilogy(fr1, h0
-000167f0: 2f68 302e 7375 6d28 292c 0d0a 2020 2020  /h0.sum(),..    
-00016800: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00016810: 2020 2020 2020 2020 2020 2020 206c 6162               lab
-00016820: 656c 3d27 4669 746c 6572 206f 7574 7075  el='Fitler outpu
-00016830: 7420 5250 5327 290d 0a20 2020 2023 2020  t RPS')..    #  
-00016840: 2020 2020 2020 2061 785b 692c 206a 6a5d         ax[i, jj]
-00016850: 2e73 656d 696c 6f67 7928 6672 312c 206e  .semilogy(fr1, n
-00016860: 702e 6162 7328 6829 2f6e 702e 6162 7328  p.abs(h)/np.abs(
-00016870: 6829 2e73 756d 2829 2c0d 0a20 2020 2023  h).sum(),..    #
-00016880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016890: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
-000168a0: 6c3d 2746 7265 7120 7265 7370 6f6e 7365  l='Freq response
-000168b0: 2052 5053 2729 0d0a 2020 2020 2320 2020   RPS')..    #   
-000168c0: 2020 656c 7365 3a0d 0a20 2020 2023 2020    else:..    #  
-000168d0: 2020 2020 2020 2061 785b 692c 206a 6a5d         ax[i, jj]
-000168e0: 2e70 6c6f 7428 6672 312c 2070 5f69 6e70  .plot(fr1, p_inp
-000168f0: 7574 2f70 5f69 6e70 7574 2e73 756d 2829  ut/p_input.sum()
-00016900: 2c0d 0a20 2020 2023 2020 2020 2020 2020  ,..    #        
-00016910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016920: 6c61 6265 6c3d 2746 696c 7465 7220 696e  label='Filter in
-00016930: 7075 7420 5250 5327 290d 0a20 2020 2023  put RPS')..    #
-00016940: 2020 2020 2020 2020 2061 785b 692c 206a           ax[i, j
-00016950: 6a5d 2e70 6c6f 7428 6672 312c 2068 302f  j].plot(fr1, h0/
-00016960: 6830 2e73 756d 2829 2c20 6c61 6265 6c3d  h0.sum(), label=
-00016970: 2746 6974 6c65 7220 6f75 7470 7574 2052  'Fitler output R
-00016980: 5053 2729 0d0a 2020 2020 2320 2020 2020  PS')..    #     
-00016990: 2020 2020 6178 5b69 2c20 6a6a 5d2e 706c      ax[i, jj].pl
-000169a0: 6f74 2866 7231 2c20 6e70 2e61 6273 2868  ot(fr1, np.abs(h
-000169b0: 292f 6e70 2e61 6273 2868 292e 7375 6d28  )/np.abs(h).sum(
-000169c0: 292c 0d0a 2020 2020 2320 2020 2020 2020  ),..    #       
-000169d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000169e0: 206c 6162 656c 3d27 4672 6571 2072 6573   label='Freq res
-000169f0: 706f 6e73 6527 290d 0a20 2020 2023 2020  ponse')..    #  
-00016a00: 2020 2023 7072 696e 7428 6e70 2e61 6c6c     #print(np.all
-00016a10: 286e 702e 726f 756e 6428 6672 5b3a 2d31  (np.round(fr[:-1
-00016a20: 5d2c 202d 3429 203d 3d20 6e70 2e72 6f75  ], -4) == np.rou
-00016a30: 6e64 2866 7231 2c20 2d34 2929 290d 0a0d  nd(fr1, -4)))...
-00016a40: 0a0d 0a20 2020 2023 2061 785b 692c 206a  ...    # ax[i, j
-00016a50: 6a5d 2e73 6574 5f78 6c69 6d28 302c 2037  j].set_xlim(0, 7
-00016a60: 352e 290d 0a20 2020 2023 2023 6178 5b69  5.)..    # #ax[i
-00016a70: 2c20 6a6a 5d2e 7365 745f 786c 696d 2830  , jj].set_xlim(0
-00016a80: 2c20 3735 2e29 0d0a 2020 2020 2320 6966  , 75.)..    # if
-00016a90: 2069 203d 3d20 3020 616e 6420 6a6a 203d   i == 0 and jj =
-00016aa0: 3d20 6e63 6f6c 732d 313a 0d0a 2020 2020  = ncols-1:..    
-00016ab0: 2320 2020 2020 6178 5b69 2c20 6a6a 5d2e  #     ax[i, jj].
-00016ac0: 6c65 6765 6e64 2866 7261 6d65 6f6e 3d46  legend(frameon=F
-00016ad0: 616c 7365 290d 0a20 2020 2023 2072 6574  alse)..    # ret
-00016ae0: 7572 6e20 660d 0a0d 0a0d 0a63 6c61 7373  urn f......class
-00016af0: 2056 4152 434e 4e28 4261 7365 4d6f 6465   VARCNN(BaseMode
-00016b00: 6c29 3a0d 0a20 2020 2022 2222 5641 522d  l):..    """VAR-
-00016b10: 434e 4e2e 0d0a 0d0a 2020 2020 466f 7220  CNN.....    For 
-00016b20: 6465 7461 696c 7320 7365 6520 5b31 5d2e  details see [1].
-00016b30: 0d0a 0d0a 2020 2020 5265 6665 7265 6e63  ....    Referenc
-00016b40: 6573 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d  es..    --------
-00016b50: 2d2d 0d0a 2020 2020 2020 2020 5b31 5d20  --..        [1] 
-00016b60: 492e 205a 7562 6172 6576 2c20 6574 2061  I. Zubarev, et a
-00016b70: 6c2e 2c20 4164 6170 7469 7665 206e 6575  l., Adaptive neu
-00016b80: 7261 6c20 6e65 7477 6f72 6b20 636c 6173  ral network clas
-00016b90: 7369 6669 6572 2066 6f72 0d0a 2020 2020  sifier for..    
-00016ba0: 2020 2020 6465 636f 6469 6e67 204d 4547      decoding MEG
-00016bb0: 2073 6967 6e61 6c73 2e20 4e65 7572 6f69   signals. Neuroi
-00016bc0: 6d61 6765 2e20 2832 3031 3929 204d 6179  mage. (2019) May
-00016bd0: 2034 3b31 3937 3a34 3235 2d34 3334 0d0a   4;197:425-434..
-00016be0: 2020 2020 2222 220d 0a20 2020 2064 6566      """..    def
-00016bf0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-00016c00: 6d65 7461 2c20 6461 7461 7365 743d 4e6f  meta, dataset=No
-00016c10: 6e65 293a 0d0a 2020 2020 2020 2020 2222  ne):..        ""
-00016c20: 220d 0a20 2020 2020 2020 2050 6172 616d  "..        Param
-00016c30: 6574 6572 730d 0a20 2020 2020 2020 202d  eters..        -
-00016c40: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020  ---------..     
-00016c50: 2020 2044 6174 6173 6574 203a 206d 6e65     Dataset : mne
-00016c60: 666c 6f77 2e44 6174 6173 6574 0d0a 0d0a  flow.Dataset....
-00016c70: 2020 2020 2020 2020 7370 6563 7320 3a20          specs : 
-00016c80: 6469 6374 0d0a 2020 2020 2020 2020 2020  dict..          
-00016c90: 2020 2020 2020 6469 6374 696f 6e61 7279        dictionary
-00016ca0: 206f 6620 6d6f 6465 6c20 6879 7065 7270   of model hyperp
-00016cb0: 6172 616d 6574 6572 7320 7b0d 0a0d 0a20  arameters {.... 
-00016cc0: 2020 2020 2020 206e 5f6c 6174 656e 7420         n_latent 
-00016cd0: 3a20 696e 740d 0a20 2020 2020 2020 2020  : int..         
-00016ce0: 2020 204e 756d 6265 7220 6f66 206c 6174     Number of lat
-00016cf0: 656e 7420 636f 6d70 6f6e 656e 7473 2e0d  ent components..
-00016d00: 0a20 2020 2020 2020 2020 2020 2044 6566  .            Def
-00016d10: 6175 6c74 7320 746f 2033 322e 0d0a 0d0a  aults to 32.....
-00016d20: 2020 2020 2020 2020 6e6f 6e6c 696e 203a          nonlin :
-00016d30: 2063 616c 6c61 626c 650d 0a20 2020 2020   callable..     
-00016d40: 2020 2020 2020 2041 6374 6976 6174 696f         Activatio
-00016d50: 6e20 6675 6e63 7469 6f6e 206f 6620 7468  n function of th
-00016d60: 6520 7465 6d70 6f72 616c 2063 6f6e 766f  e temporal convo
-00016d70: 6c75 7469 6f6e 206c 6179 6572 2e0d 0a20  lution layer... 
-00016d80: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
-00016d90: 6c74 7320 746f 2074 662e 6e6e 2e72 656c  lts to tf.nn.rel
-00016da0: 750d 0a0d 0a20 2020 2020 2020 2066 696c  u....        fil
-00016db0: 7465 725f 6c65 6e67 7468 203a 2069 6e74  ter_length : int
-00016dc0: 0d0a 2020 2020 2020 2020 2020 2020 4c65  ..            Le
-00016dd0: 6e67 7468 206f 6620 7370 6174 696f 2d74  ngth of spatio-t
-00016de0: 656d 706f 7261 6c20 6b65 726e 656c 7320  emporal kernels 
-00016df0: 696e 2074 6865 2074 656d 706f 7261 6c0d  in the temporal.
-00016e00: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00016e10: 766f 6c75 7469 6f6e 206c 6179 6572 2e20  volution layer. 
-00016e20: 4465 6661 756c 7473 2074 6f20 372e 0d0a  Defaults to 7...
-00016e30: 0d0a 2020 2020 2020 2020 706f 6f6c 696e  ..        poolin
-00016e40: 6720 3a20 696e 740d 0a20 2020 2020 2020  g : int..       
-00016e50: 2020 2020 2050 6f6f 6c69 6e67 2066 6163       Pooling fac
-00016e60: 746f 7220 6f66 2074 6865 206d 6178 2070  tor of the max p
-00016e70: 6f6f 6c69 6e67 206c 6179 6572 2e20 4465  ooling layer. De
-00016e80: 6661 756c 7473 2074 6f20 320d 0a0d 0a20  faults to 2.... 
-00016e90: 2020 2020 2020 2070 6f6f 6c5f 7479 7065         pool_type
-00016ea0: 203a 2073 7472 207b 2761 7667 272c 2027   : str {'avg', '
-00016eb0: 6d61 7827 7d0d 0a20 2020 2020 2020 2020  max'}..         
-00016ec0: 2020 2054 7970 6520 6f66 2070 6f6f 6c69     Type of pooli
-00016ed0: 6e67 206f 7065 7261 7469 6f6e 2e20 4465  ng operation. De
-00016ee0: 6661 756c 7473 2074 6f20 276d 6178 272e  faults to 'max'.
-00016ef0: 0d0a 0d0a 2020 2020 2020 2020 7061 6464  ....        padd
-00016f00: 696e 6720 3a20 7374 7220 7b27 5341 4d45  ing : str {'SAME
-00016f10: 272c 2027 4655 4c4c 272c 2027 5641 4c49  ', 'FULL', 'VALI
-00016f20: 4427 7d0d 0a20 2020 2020 2020 2020 2020  D'}..           
-00016f30: 2043 6f6e 766f 6c75 7469 6f6e 2070 6164   Convolution pad
-00016f40: 6469 6e67 2e20 4465 6661 756c 7473 2074  ding. Defaults t
-00016f50: 6f20 2753 414d 4527 2e7d 2222 220d 0a20  o 'SAME'.}""".. 
-00016f60: 2020 2020 2020 2073 656c 662e 7363 6f70         self.scop
-00016f70: 6520 3d20 2776 6172 636e 6e27 0d0a 2020  e = 'varcnn'..  
-00016f80: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
-00016f90: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
-00016fa0: 7428 2766 696c 7465 725f 6c65 6e67 7468  t('filter_length
-00016fb0: 272c 2037 290d 0a20 2020 2020 2020 206d  ', 7)..        m
-00016fc0: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
-00016fd0: 7365 7464 6566 6175 6c74 2827 6e5f 6c61  setdefault('n_la
-00016fe0: 7465 6e74 272c 2033 3229 0d0a 2020 2020  tent', 32)..    
-00016ff0: 2020 2020 6d65 7461 2e6d 6f64 656c 5f73      meta.model_s
-00017000: 7065 6373 2e73 6574 6465 6661 756c 7428  pecs.setdefault(
-00017010: 2770 6f6f 6c69 6e67 272c 2032 290d 0a20  'pooling', 2).. 
-00017020: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
-00017030: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
-00017040: 6c74 2827 7374 7269 6465 272c 2032 290d  lt('stride', 2).
-00017050: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
-00017060: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
-00017070: 6175 6c74 2827 7061 6464 696e 6727 2c20  ault('padding', 
-00017080: 2753 414d 4527 290d 0a20 2020 2020 2020  'SAME')..       
-00017090: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
-000170a0: 732e 7365 7464 6566 6175 6c74 2827 706f  s.setdefault('po
-000170b0: 6f6c 5f74 7970 6527 2c20 276d 6178 2729  ol_type', 'max')
-000170c0: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
-000170d0: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
-000170e0: 6661 756c 7428 276e 6f6e 6c69 6e27 2c20  fault('nonlin', 
-000170f0: 7466 2e6e 6e2e 7265 6c75 290d 0a20 2020  tf.nn.relu)..   
-00017100: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
-00017110: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
-00017120: 2827 6c31 5f6c 616d 6264 6127 2c20 3365  ('l1_lambda', 3e
-00017130: 2d34 290d 0a20 2020 2020 2020 206d 6574  -4)..        met
-00017140: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
-00017150: 7464 6566 6175 6c74 2827 6c32 5f6c 616d  tdefault('l2_lam
-00017160: 6264 6127 2c20 3029 0d0a 2020 2020 2020  bda', 0)..      
-00017170: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
-00017180: 6373 2e73 6574 6465 6661 756c 7428 276c  cs.setdefault('l
-00017190: 315f 7363 6f70 6527 2c20 5b27 6663 272c  1_scope', ['fc',
-000171a0: 2027 6465 6d69 7827 2c20 276c 665f 636f   'demix', 'lf_co
-000171b0: 6e76 275d 290d 0a20 2020 2020 2020 206d  nv'])..        m
-000171c0: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
-000171d0: 7365 7464 6566 6175 6c74 2827 6c32 5f73  setdefault('l2_s
-000171e0: 636f 7065 272c 205b 5d29 0d0a 2020 2020  cope', [])..    
-000171f0: 2020 2020 6d65 7461 2e6d 6f64 656c 5f73      meta.model_s
-00017200: 7065 6373 2e73 6574 6465 6661 756c 7428  pecs.setdefault(
-00017210: 2775 6e69 746e 6f72 6d5f 7363 6f70 6527  'unitnorm_scope'
-00017220: 2c20 5b5d 290d 0a20 2020 2020 2020 206d  , [])..        m
-00017230: 6574 612e 6d6f 6465 6c5f 7370 6563 735b  eta.model_specs[
-00017240: 2773 636f 7065 275d 203d 2073 656c 662e  'scope'] = self.
-00017250: 7363 6f70 650d 0a20 2020 2020 2020 2073  scope..        s
-00017260: 7570 6572 2856 4152 434e 4e2c 2073 656c  uper(VARCNN, sel
-00017270: 6629 2e5f 5f69 6e69 745f 5f28 6d65 7461  f).__init__(meta
-00017280: 2c20 6461 7461 7365 7429 0d0a 0d0a 2020  , dataset)....  
-00017290: 2020 6465 6620 6275 696c 645f 6772 6170    def build_grap
-000172a0: 6828 7365 6c66 293a 0d0a 2020 2020 2020  h(self):..      
-000172b0: 2020 2222 2242 7569 6c64 2063 6f6d 7075    """Build compu
-000172c0: 7461 7469 6f6e 616c 2067 7261 7068 2075  tational graph u
-000172d0: 7369 6e67 2064 6566 696e 6564 2070 6c61  sing defined pla
-000172e0: 6365 686f 6c64 6572 2060 7365 6c66 2e58  ceholder `self.X
-000172f0: 600d 0a20 2020 2020 2020 2061 7320 696e  `..        as in
-00017300: 7075 742e 0d0a 0d0a 2020 2020 2020 2020  put.....        
-00017310: 5265 7475 726e 730d 0a20 2020 2020 2020  Returns..       
-00017320: 202d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020   --------..     
-00017330: 2020 2079 5f70 7265 6420 3a20 7466 2e54     y_pred : tf.T
-00017340: 656e 736f 720d 0a20 2020 2020 2020 2020  ensor..         
-00017350: 2020 204f 7574 7075 7420 6f66 2074 6865     Output of the
-00017360: 2066 6f72 7761 7264 2070 6173 7320 6f66   forward pass of
-00017370: 2074 6865 2063 6f6d 7075 7461 7469 6f6e   the computation
-00017380: 616c 2067 7261 7068 2e0d 0a20 2020 2020  al graph...     
-00017390: 2020 2020 2020 2050 7265 6469 6374 696f         Predictio
-000173a0: 6e20 6f66 2074 6865 2074 6172 6765 7420  n of the target 
-000173b0: 7661 7269 6162 6c65 2e0d 0a20 2020 2020  variable...     
-000173c0: 2020 2022 2222 0d0a 0d0a 2020 2020 2020     """....      
-000173d0: 2020 7365 6c66 2e64 6d78 203d 2044 654d    self.dmx = DeM
-000173e0: 6978 696e 6728 7369 7a65 3d73 656c 662e  ixing(size=self.
-000173f0: 7370 6563 735b 276e 5f6c 6174 656e 7427  specs['n_latent'
-00017400: 5d2c 206e 6f6e 6c69 6e3d 7466 2e69 6465  ], nonlin=tf.ide
-00017410: 6e74 6974 792c 0d0a 2020 2020 2020 2020  ntity,..        
-00017420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017430: 2020 2020 6178 6973 3d33 2c20 7370 6563      axis=3, spec
-00017440: 733d 7365 6c66 2e73 7065 6373 2928 7365  s=self.specs)(se
-00017450: 6c66 2e69 6e70 7574 7329 0d0a 0d0a 0d0a  lf.inputs)......
-00017460: 2020 2020 2020 2020 7365 6c66 2e74 636f          self.tco
-00017470: 6e76 203d 2056 4152 436f 6e76 2873 697a  nv = VARConv(siz
-00017480: 653d 7365 6c66 2e73 7065 6373 5b27 6e5f  e=self.specs['n_
-00017490: 6c61 7465 6e74 275d 2c0d 0a20 2020 2020  latent'],..     
-000174a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174b0: 2020 2020 2020 2020 6e6f 6e6c 696e 3d73          nonlin=s
-000174c0: 656c 662e 7370 6563 735b 276e 6f6e 6c69  elf.specs['nonli
-000174d0: 6e27 5d2c 0d0a 2020 2020 2020 2020 2020  n'],..          
-000174e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174f0: 2020 2066 696c 7465 725f 6c65 6e67 7468     filter_length
-00017500: 3d73 656c 662e 7370 6563 735b 2766 696c  =self.specs['fil
-00017510: 7465 725f 6c65 6e67 7468 275d 2c0d 0a20  ter_length'],.. 
-00017520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017530: 2020 2020 2020 2020 2020 2020 7061 6464              padd
-00017540: 696e 673d 7365 6c66 2e73 7065 6373 5b27  ing=self.specs['
-00017550: 7061 6464 696e 6727 5d2c 0d0a 2020 2020  padding'],..    
+000154c0: 7469 746c 653d 2754 7275 6520 6576 6f6b  title='True evok
+000154d0: 6564 2729 0d0a 2020 2020 2020 2020 2020  ed')..          
+000154e0: 2020 6669 676e 616d 6520 3d20 272d 272e    figname = '-'.
+000154f0: 6a6f 696e 285b 7365 6c66 2e6d 6574 612e  join([self.meta.
+00015500: 6461 7461 5b27 7061 7468 275d 202b 2073  data['path'] + s
+00015510: 656c 662e 7363 6f70 652c 2073 656c 662e  elf.scope, self.
+00015520: 6d65 7461 2e64 6174 615b 2764 6174 615f  meta.data['data_
+00015530: 6964 275d 2c20 2774 7275 6527 2c20 2274  id'], 'true', "t
+00015540: 6f70 6f73 2e73 7667 225d 290d 0a20 2020  opos.svg"])..   
+00015550: 2020 2020 2020 2020 2074 2e73 6176 6566           t.savef
+00015560: 6967 2866 6967 6e61 6d65 2c20 666f 726d  ig(figname, form
+00015570: 6174 3d27 7376 6727 2c20 7472 616e 7370  at='svg', transp
+00015580: 6172 656e 743d 5472 7565 290d 0a0d 0a23  arent=True)....#
+00015590: 2020 2020 2020 2020 2069 6620 6e63 6f6c           if ncol
+000155a0: 7320 3d3d 2031 3a0d 0a23 2020 2020 2020  s == 1:..#      
+000155b0: 2020 2020 2020 2070 6c74 2e66 6967 7572         plt.figur
+000155c0: 6528 290d 0a23 2020 2020 2020 2020 2020  e()..#          
+000155d0: 2020 2061 7820 3d20 706c 742e 6763 6128     ax = plt.gca(
+000155e0: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
+000155f0: 206e 6f72 6d61 6c69 7a65 645f 696e 7075   normalized_inpu
+00015600: 745f 7270 7320 3d20 7073 6473 2f6e 702e  t_rps = psds/np.
+00015610: 6d61 7869 6d75 6d28 6e70 2e73 756d 2870  maximum(np.sum(p
+00015620: 7364 7329 2c20 3165 2d36 290d 0a23 2020  sds), 1e-6)..#  
+00015630: 2020 2020 2020 2020 2020 206e 6f72 6d61             norma
+00015640: 6c69 7a65 645f 6f75 7470 7574 5f72 7073  lized_output_rps
+00015650: 203d 2066 696c 7465 7273 2a70 7364 730d   = filters*psds.
+00015660: 0a23 2020 2020 2020 2020 2020 2020 206e  .#             n
+00015670: 6f72 6d61 6c69 7a65 645f 6f75 7470 7574  ormalized_output
+00015680: 5f72 7073 202f 3d20 6e70 2e6d 6178 696d  _rps /= np.maxim
+00015690: 756d 286e 702e 7375 6d28 6669 6c74 6572  um(np.sum(filter
+000156a0: 732a 7073 6473 292c 2031 652d 3629 0d0a  s*psds), 1e-6)..
+000156b0: 2320 2020 2020 2020 2020 2020 2020 6178  #             ax
+000156c0: 2e70 6c6f 7428 6672 6571 732c 206e 6f72  .plot(freqs, nor
+000156d0: 6d61 6c69 7a65 645f 696e 7075 745f 7270  malized_input_rp
+000156e0: 732c 206c 6162 656c 3d27 496e 7075 7420  s, label='Input 
+000156f0: 5250 5327 290d 0a23 2020 2020 2020 2020  RPS')..#        
+00015700: 2020 2020 2061 782e 706c 6f74 2866 7265       ax.plot(fre
+00015710: 7173 2c20 6e6f 726d 616c 697a 6564 5f6f  qs, normalized_o
+00015720: 7574 7075 745f 7270 732c 206c 6162 656c  utput_rps, label
+00015730: 3d27 4f75 7470 7574 2052 5053 2729 0d0a  ='Output RPS')..
+00015740: 2320 2320 2020 2020 2020 2020 2020 2061  # #            a
+00015750: 782e 706c 6f74 2866 7265 7173 2c20 6669  x.plot(freqs, fi
+00015760: 6c74 6572 732f 6e70 2e6d 6178 696d 756d  lters/np.maximum
+00015770: 286e 702e 7375 6d28 6669 6c74 6572 7329  (np.sum(filters)
+00015780: 2c20 3165 2d36 292c 0d0a 2320 2320 2020  , 1e-6),..# #   
+00015790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000157a0: 206c 6162 656c 3d27 4672 6571 2072 6573   label='Freq res
+000157b0: 706f 6e73 6527 290d 0a23 2020 2020 2020  ponse')..#      
+000157c0: 2020 2020 2020 2061 782e 6c65 6765 6e64         ax.legend
+000157d0: 2829 0d0a 2320 2020 2020 2020 2020 2020  ()..#           
+000157e0: 2020 6178 2e73 6574 5f78 6c69 6d28 302c    ax.set_xlim(0,
+000157f0: 2039 3029 0d0a 2320 2020 2020 2020 2020   90)..#         
+00015800: 2020 2020 2370 6c74 2e73 686f 7728 290d      #plt.show().
+00015810: 0a23 2020 2020 2020 2020 2065 6c73 653a  .#         else:
+00015820: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+00015830: 662c 2061 7820 3d20 706c 742e 7375 6270  f, ax = plt.subp
+00015840: 6c6f 7473 2831 2c20 6e63 6f6c 732c 2073  lots(1, ncols, s
+00015850: 6861 7265 793d 5472 7565 2c20 636f 6e73  harey=True, cons
+00015860: 7472 6169 6e65 645f 6c61 796f 7574 3d54  trained_layout=T
+00015870: 7275 6529 0d0a 2320 2020 2020 2020 2020  rue)..#         
+00015880: 2020 2020 2366 2e63 6f6e 7374 7261 696e      #f.constrain
+00015890: 6564 5f6c 6179 6f75 7428 290d 0a23 2020  ed_layout()..#  
+000158a0: 2020 2020 2020 2020 2020 2066 2e73 6574             f.set
+000158b0: 5f73 697a 655f 696e 6368 6573 285b 3134  _size_inches([14
+000158c0: 2c20 332e 5d29 0d0a 2320 2020 2020 2020  , 3.])..#       
+000158d0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+000158e0: 616e 6765 286e 636f 6c73 293a 0d0a 2320  ange(ncols):..# 
+000158f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015900: 2361 785b 695d 2e73 656d 696c 6f67 7928  #ax[i].semilogy(
+00015910: 6672 6571 735b 3a2d 315d 2c20 636f 6d62  freqs[:-1], comb
+00015920: 696e 6564 5f66 696c 7465 7273 5b3a 2c69  ined_filters[:,i
+00015930: 5d2c 206c 6162 656c 3d27 496d 7075 6c73  ], label='Impuls
+00015940: 6520 7265 7370 6f6e 7365 2729 0d0a 2320  e response')..# 
+00015950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015960: 6e6f 726d 616c 697a 6564 5f6f 7574 7075  normalized_outpu
+00015970: 745f 7270 7320 3d20 6669 6c74 6572 735b  t_rps = filters[
+00015980: 3a2c 695d 2a70 7364 735b 3a2c 695d 0d0a  :,i]*psds[:,i]..
+00015990: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+000159a0: 2020 6e6f 726d 616c 697a 6564 5f6f 7574    normalized_out
+000159b0: 7075 745f 7270 7320 2f3d 206e 702e 6d61  put_rps /= np.ma
+000159c0: 7869 6d75 6d28 6e70 2e73 756d 2866 696c  ximum(np.sum(fil
+000159d0: 7465 7273 5b3a 2c69 5d2a 7073 6473 5b3a  ters[:,i]*psds[:
+000159e0: 2c69 5d29 2c20 3165 2d36 290d 0a23 2020  ,i]), 1e-6)..#  
+000159f0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00015a00: 6f72 6d61 6c69 7a65 645f 696e 7075 745f  ormalized_input_
+00015a10: 7270 7320 3d20 7073 6473 5b3a 2c69 5d20  rps = psds[:,i] 
+00015a20: 2f20 6e70 2e6d 6178 696d 756d 286e 702e  / np.maximum(np.
+00015a30: 7375 6d28 7073 6473 5b3a 2c69 5d29 2c20  sum(psds[:,i]), 
+00015a40: 3165 2d36 290d 0a0d 0a0d 0a0d 0a23 2020  1e-6)........#  
+00015a50: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00015a60: 785b 695d 2e70 6c6f 7428 6672 6571 732c  x[i].plot(freqs,
+00015a70: 206e 6f72 6d61 6c69 7a65 645f 696e 7075   normalized_inpu
+00015a80: 745f 7270 732c 206c 6162 656c 3d27 4c61  t_rps, label='La
+00015a90: 7965 7220 496e 7075 7427 290d 0a23 2020  yer Input')..#  
+00015aa0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00015ab0: 785b 695d 2e73 6574 5f74 6974 6c65 286e  x[i].set_title(n
+00015ac0: 616d 6573 5b69 5d29 0d0a 2320 2020 2020  ames[i])..#     
+00015ad0: 2020 2020 2020 2020 2020 2020 6178 5b69              ax[i
+00015ae0: 5d2e 706c 6f74 2866 7265 7173 2c20 6e6f  ].plot(freqs, no
+00015af0: 726d 616c 697a 6564 5f6f 7574 7075 745f  rmalized_output_
+00015b00: 7270 732c 206c 6162 656c 3d27 4578 7472  rps, label='Extr
+00015b10: 6163 7465 6420 436f 6d70 6f6e 656e 7427  acted Component'
+00015b20: 290d 0a23 2023 2020 2020 2020 2020 2020  )..# #          
+00015b30: 2020 2020 2020 6178 5b69 5d2e 706c 6f74        ax[i].plot
+00015b40: 2866 7265 7173 2c20 6669 6c74 6572 735b  (freqs, filters[
+00015b50: 3a2c 2069 5d2f 6e70 2e6d 6178 696d 756d  :, i]/np.maximum
+00015b60: 286e 702e 7375 6d28 6669 6c74 6572 735b  (np.sum(filters[
+00015b70: 3a2c 2069 5d29 2c20 3165 2d36 292c 0d0a  :, i]), 1e-6),..
+00015b80: 2320 2320 2020 2020 2020 2020 2020 2020  # #             
+00015b90: 2020 2020 2020 206c 6162 656c 3d27 4672         label='Fr
+00015ba0: 6571 2072 6573 706f 6e73 6527 290d 0a23  eq response')..#
+00015bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015bc0: 2023 6178 5b69 5d2e 706c 6f74 2866 7265   #ax[i].plot(fre
+00015bd0: 7173 5b3a 2d31 5d2c 2063 6f6d 6269 6e65  qs[:-1], combine
+00015be0: 645f 6669 6c74 6572 735b 3a2c 695d 2c20  d_filters[:,i], 
+00015bf0: 6c61 6265 6c3d 274f 7574 7075 7420 5250  label='Output RP
+00015c00: 5327 290d 0a23 2020 2020 2020 2020 2020  S')..#          
+00015c10: 2020 2020 2020 2023 6178 5b69 5d2e 706c         #ax[i].pl
+00015c20: 6f74 2866 7265 7173 5b3a 2d31 5d2c 2063  ot(freqs[:-1], c
+00015c30: 6f6d 6269 6e65 645f 7073 6473 5b3a 2c69  ombined_psds[:,i
+00015c40: 5d2c 206c 6162 656c 3d27 496e 7075 7420  ], label='Input 
+00015c50: 5250 5327 290d 0a23 2020 2020 2020 2020  RPS')..#        
+00015c60: 2020 2020 2020 2020 2061 785b 695d 2e73           ax[i].s
+00015c70: 6574 5f78 6c69 6d28 302c 2037 3029 0d0a  et_xlim(0, 70)..
+00015c80: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+00015c90: 2020 2020 6178 5b69 5d2e 7365 745f 7874      ax[i].set_xt
+00015ca0: 6963 6b6c 6162 656c 7328 6178 5b69 5d2e  icklabels(ax[i].
+00015cb0: 6765 745f 786d 616a 6f72 7469 636b 6c61  get_xmajortickla
+00015cc0: 6265 6c73 2829 2c0d 0a23 2020 2020 2020  bels(),..#      
+00015cd0: 2020 2020 2020 2020 2020 2020 2066 6f6e               fon
+00015ce0: 7464 6963 743d 7b27 666f 6e74 7369 7a65  tdict={'fontsize
+00015cf0: 273a 3134 7d29 0d0a 2320 2020 2020 2020  ':14})..#       
+00015d00: 2020 2020 2020 2020 2020 666f 7220 7370            for sp
+00015d10: 696e 6520 696e 205b 2774 6f70 272c 2027  ine in ['top', '
+00015d20: 7269 6768 7427 5d3a 0d0a 2320 2020 2020  right']:..#     
+00015d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d40: 6178 5b69 5d2e 7370 696e 6573 5b73 7069  ax[i].spines[spi
+00015d50: 6e65 5d2e 7365 745f 7669 7369 626c 6528  ne].set_visible(
+00015d60: 4661 6c73 6529 0d0a 2320 2020 2020 2020  False)..#       
+00015d70: 2020 2020 2020 2020 2020 2361 785b 695d            #ax[i]
+00015d80: 2e73 6574 5f66 7261 6d65 5f6f 6e28 4661  .set_frame_on(Fa
+00015d90: 6c73 6529 0d0a 2320 2020 2020 2020 2020  lse)..#         
+00015da0: 2020 2020 2020 2020 2361 785b 695d 2e73          #ax[i].s
+00015db0: 6574 5f79 6c69 6d28 3165 2d35 2c20 312e  et_ylim(1e-5, 1.
+00015dc0: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
+00015dd0: 2020 2020 2069 6620 6920 3d3d 206e 636f       if i == nco
+00015de0: 6c73 2d31 3a0d 0a23 2020 2020 2020 2020  ls-1:..#        
+00015df0: 2020 2020 2020 2020 2020 2020 2061 785b               ax[
+00015e00: 695d 2e6c 6567 656e 6428 290d 0a23 2020  i].legend()..#  
+00015e10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00015e20: 6620 6920 3d3d 2030 3a0d 0a23 2020 2020  f i == 0:..#    
+00015e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e40: 2074 6963 6b73 203d 2061 785b 695d 2e67   ticks = ax[i].g
+00015e50: 6574 5f79 7469 636b 7328 290d 0a23 2020  et_yticks()..#  
+00015e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e70: 2020 2069 6620 7469 636b 735b 305d 203c     if ticks[0] <
+00015e80: 2030 2061 6e64 2074 6963 6b73 5b31 5d20   0 and ticks[1] 
+00015e90: 3d3d 2030 3a0d 0a23 2020 2020 2020 2020  == 0:..#        
+00015ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015eb0: 2069 6e64 203d 206e 702e 6172 616e 6765   ind = np.arange
+00015ec0: 2831 2c20 6c65 6e28 7469 636b 7329 2c20  (1, len(ticks), 
+00015ed0: 322c 2064 7479 7065 3d69 6e74 290d 0a23  2, dtype=int)..#
+00015ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015ef0: 2020 2020 2065 6c73 653a 0d0a 2320 2020       else:..#   
+00015f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f10: 2020 2020 2020 696e 6420 3d20 6e70 2e61        ind = np.a
+00015f20: 7261 6e67 6528 302c 206c 656e 2874 6963  range(0, len(tic
+00015f30: 6b73 292c 2032 2c20 6474 7970 653d 696e  ks), 2, dtype=in
+00015f40: 7429 0d0a 0d0a 2320 2020 2020 2020 2020  t)....#         
+00015f50: 2020 2020 2020 2020 2020 2020 6178 5b69              ax[i
+00015f60: 5d2e 7365 745f 7974 6963 6b73 2874 6963  ].set_yticks(tic
+00015f70: 6b73 5b69 6e64 5d29 0d0a 2320 2020 2020  ks[ind])..#     
+00015f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f90: 6178 5b69 5d2e 7365 745f 7974 6963 6b6c  ax[i].set_ytickl
+00015fa0: 6162 656c 7328 6178 5b69 5d2e 6765 745f  abels(ax[i].get_
+00015fb0: 796d 616a 6f72 7469 636b 6c61 6265 6c73  ymajorticklabels
+00015fc0: 2829 2c0d 0a23 2020 2020 2020 2020 2020  (),..#          
+00015fd0: 2020 2020 2020 2020 2020 2020 2066 6f6e               fon
+00015fe0: 7464 6963 743d 7b27 666f 6e74 7369 7a65  tdict={'fontsize
+00015ff0: 273a 3134 7d29 0d0a 2320 2020 2020 2020  ':14})..#       
+00016000: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+00016010: 5b69 5d2e 7365 745f 796c 6162 656c 2827  [i].set_ylabel('
+00016020: 5265 6c61 7469 7665 2070 6f77 6572 2c20  Relative power, 
+00016030: 2527 2c20 666f 6e74 7369 7a65 3d31 3629  %', fontsize=16)
+00016040: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+00016050: 662e 7375 7078 6c61 6265 6c28 2746 7265  f.supxlabel('Fre
+00016060: 7175 656e 6379 2c20 487a 272c 2066 6f6e  quency, Hz', fon
+00016070: 7473 697a 653d 3136 290d 0a23 2020 2020  tsize=16)..#    
+00016080: 2020 2020 2070 6c74 2e73 686f 7728 290d       plt.show().
+00016090: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
+000160a0: 2020 2023 6178 5b69 5d2e 7368 6f77 2829     #ax[i].show()
+000160b0: 0d0a 0d0a 0d0a 0d0a 0d0a 0d0a 2020 2020  ............    
+000160c0: 2320 6465 6620 706c 6f74 5f73 7065 6374  # def plot_spect
+000160d0: 7261 2873 656c 662c 2070 6174 7465 726e  ra(self, pattern
+000160e0: 735f 7374 7275 6374 2c20 636f 6d70 6f6e  s_struct, compon
+000160f0: 656e 745f 696e 642c 2061 782c 2066 733d  ent_ind, ax, fs=
+00016100: 4e6f 6e65 2c20 6c6f 6167 3d46 616c 7365  None, loag=False
+00016110: 293a 0d0a 2020 2020 2320 2020 2020 2222  ):..    #     ""
+00016120: 2252 656c 6174 6976 6520 706f 7765 7220  "Relative power 
+00016130: 7370 6563 7472 6120 6f66 2061 2067 6976  spectra of a giv
+00016140: 656e 206c 6174 656e 7420 636f 6d70 6f6e  en latent compon
+00016150: 656e 6465 2062 6566 6f72 6520 616e 6420  ende before and 
+00016160: 6166 7465 720d 0a20 2020 2023 2020 2020  after..    #    
+00016170: 2020 2020 6170 706c 7969 6e67 2074 6865      applying the
+00016180: 2063 6f6e 766f 6c75 7469 6f6e 2e0d 0a0d   convolution....
+00016190: 0a20 2020 2023 2020 2020 2050 6172 616d  .    #     Param
+000161a0: 6574 6572 730d 0a20 2020 2023 2020 2020  eters..    #    
+000161b0: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a0d 0a20   ----------.... 
+000161c0: 2020 2023 2020 2020 2070 6174 7465 726e     #     pattern
+000161d0: 735f 7374 7275 6374 203a 0d0a 2020 2020  s_struct :..    
+000161e0: 2320 2020 2020 2020 2020 696e 7374 616e  #         instan
+000161f0: 6365 206f 6620 7061 7474 6572 6e73 5f73  ce of patterns_s
+00016200: 7472 7563 7420 7072 6f64 7563 6564 2062  truct produced b
+00016210: 7920 6d6f 6465 6c2e 636f 6d70 7574 655f  y model.compute_
+00016220: 7061 7474 6572 6e73 0d0a 0d0a 2020 2020  patterns....    
+00016230: 2320 2020 2020 6178 203a 2061 7865 730d  #     ax : axes.
+00016240: 0a0d 0a20 2020 2023 2020 2020 2066 7320  ...    #     fs 
+00016250: 3a20 666c 6f61 740d 0a20 2020 2023 2020  : float..    #  
+00016260: 2020 2020 2020 2053 616d 706c 696e 6720         Sampling 
+00016270: 6672 6571 7565 6e63 792e 0d0a 0d0a 2020  frequency.....  
+00016280: 2020 2320 2020 2020 6c6f 6720 3a20 626f    #     log : bo
+00016290: 6f6c 0d0a 2020 2020 2320 2020 2020 2020  ol..    #       
+000162a0: 2020 4170 706c 7920 6c6f 672d 7472 616e    Apply log-tran
+000162b0: 7366 6f72 6d20 746f 2074 6865 2073 7065  sform to the spe
+000162c0: 6374 7261 2e0d 0a0d 0a0d 0a0d 0a20 2020  ctra.........   
+000162d0: 2023 2020 2020 2022 2222 0d0a 0d0a 2020   #     """....  
+000162e0: 2020 2320 2020 2020 6966 206e 6f74 2066    #     if not f
+000162f0: 733a 0d0a 2020 2020 2320 2020 2020 2020  s:..    #       
+00016300: 2070 7269 6e74 2827 5361 6d70 6c69 6e67   print('Sampling
+00016310: 2066 7265 7175 656e 6379 206e 6f74 2073   frequency not s
+00016320: 7065 6369 6669 6564 2c20 7365 7474 696e  pecified, settin
+00016330: 6720 746f 2031 2e27 290d 0a20 2020 2023  g to 1.')..    #
+00016340: 2020 2020 2020 2020 7365 6c66 2e66 7320          self.fs 
+00016350: 3d20 312e 0d0a 0d0a 2020 2020 2320 2020  = 1.....    #   
+00016360: 2020 6669 6c74 6572 7320 3d20 7061 7474    filters = patt
+00016370: 6572 6e73 5f73 7472 7563 745b 2777 6569  erns_struct['wei
+00016380: 6768 7473 275d 5b27 7463 6f6e 7627 5d5b  ghts']['tconv'][
+00016390: 3a2c 2063 6f6d 706f 6e65 6e74 5f69 6e64  :, component_ind
+000163a0: 5d0d 0a20 2020 2023 2020 2020 2070 5f69  ]..    #     p_i
+000163b0: 6e70 7574 203d 2070 6174 7465 726e 735f  nput = patterns_
+000163c0: 7374 7275 6374 5b27 7370 6563 7472 6127  struct['spectra'
+000163d0: 5d5b 2770 7364 7327 5d5b 636f 6d70 6f6e  ]['psds'][compon
+000163e0: 656e 745f 696e 642c 203a 5d0d 0a0d 0a20  ent_ind, :].... 
+000163f0: 2020 2023 2020 2020 2077 2c20 6820 3d20     #     w, h = 
+00016400: 6672 6571 7a28 6669 6c74 6572 732c 2031  freqz(filters, 1
+00016410: 2c20 776f 724e 3d73 656c 662e 6e66 6674  , worN=self.nfft
+00016420: 290d 0a20 2020 2023 2020 2020 2066 7231  )..    #     fr1
+00016430: 203d 2077 2f6e 702e 7069 2a73 656c 662e   = w/np.pi*self.
+00016440: 6673 2f32 0d0a 2020 2020 2320 2020 2020  fs/2..    #     
+00016450: 6830 203d 2070 5f69 6e70 7574 2a6e 702e  h0 = p_input*np.
+00016460: 6162 7328 6829 0d0a 0d0a 0d0a 2020 2020  abs(h)......    
+00016470: 2320 2020 2020 6966 206c 6f67 3a0d 0a20  #     if log:.. 
+00016480: 2020 2023 2020 2020 2020 2020 2061 785b     #         ax[
+00016490: 692c 206a 6a5d 2e73 656d 696c 6f67 7928  i, jj].semilogy(
+000164a0: 6672 312c 2070 5f69 6e70 7574 2f70 5f69  fr1, p_input/p_i
+000164b0: 6e70 7574 2e73 756d 2829 2c0d 0a20 2020  nput.sum(),..   
+000164c0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+000164d0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+000164e0: 6265 6c3d 2746 696c 7465 7220 696e 7075  bel='Filter inpu
+000164f0: 7420 5250 5327 290d 0a20 2020 2023 2020  t RPS')..    #  
+00016500: 2020 2020 2020 2061 785b 692c 206a 6a5d         ax[i, jj]
+00016510: 2e73 656d 696c 6f67 7928 6672 312c 2068  .semilogy(fr1, h
+00016520: 302f 6830 2e73 756d 2829 2c0d 0a20 2020  0/h0.sum(),..   
+00016530: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00016540: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00016550: 6265 6c3d 2746 6974 6c65 7220 6f75 7470  bel='Fitler outp
+00016560: 7574 2052 5053 2729 0d0a 2020 2020 2320  ut RPS')..    # 
+00016570: 2020 2020 2020 2020 6178 5b69 2c20 6a6a          ax[i, jj
+00016580: 5d2e 7365 6d69 6c6f 6779 2866 7231 2c20  ].semilogy(fr1, 
+00016590: 6e70 2e61 6273 2868 292f 6e70 2e61 6273  np.abs(h)/np.abs
+000165a0: 2868 292e 7375 6d28 292c 0d0a 2020 2020  (h).sum(),..    
+000165b0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+000165c0: 2020 2020 2020 2020 2020 2020 206c 6162               lab
+000165d0: 656c 3d27 4672 6571 2072 6573 706f 6e73  el='Freq respons
+000165e0: 6520 5250 5327 290d 0a20 2020 2023 2020  e RPS')..    #  
+000165f0: 2020 2065 6c73 653a 0d0a 2020 2020 2320     else:..    # 
+00016600: 2020 2020 2020 2020 6178 5b69 2c20 6a6a          ax[i, jj
+00016610: 5d2e 706c 6f74 2866 7231 2c20 705f 696e  ].plot(fr1, p_in
+00016620: 7075 742f 705f 696e 7075 742e 7375 6d28  put/p_input.sum(
+00016630: 292c 0d0a 2020 2020 2320 2020 2020 2020  ),..    #       
+00016640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016650: 206c 6162 656c 3d27 4669 6c74 6572 2069   label='Filter i
+00016660: 6e70 7574 2052 5053 2729 0d0a 2020 2020  nput RPS')..    
+00016670: 2320 2020 2020 2020 2020 6178 5b69 2c20  #         ax[i, 
+00016680: 6a6a 5d2e 706c 6f74 2866 7231 2c20 6830  jj].plot(fr1, h0
+00016690: 2f68 302e 7375 6d28 292c 206c 6162 656c  /h0.sum(), label
+000166a0: 3d27 4669 746c 6572 206f 7574 7075 7420  ='Fitler output 
+000166b0: 5250 5327 290d 0a20 2020 2023 2020 2020  RPS')..    #    
+000166c0: 2020 2020 2061 785b 692c 206a 6a5d 2e70       ax[i, jj].p
+000166d0: 6c6f 7428 6672 312c 206e 702e 6162 7328  lot(fr1, np.abs(
+000166e0: 6829 2f6e 702e 6162 7328 6829 2e73 756d  h)/np.abs(h).sum
+000166f0: 2829 2c0d 0a20 2020 2023 2020 2020 2020  (),..    #      
+00016700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016710: 2020 6c61 6265 6c3d 2746 7265 7120 7265    label='Freq re
+00016720: 7370 6f6e 7365 2729 0d0a 2020 2020 2320  sponse')..    # 
+00016730: 2020 2020 2370 7269 6e74 286e 702e 616c      #print(np.al
+00016740: 6c28 6e70 2e72 6f75 6e64 2866 725b 3a2d  l(np.round(fr[:-
+00016750: 315d 2c20 2d34 2920 3d3d 206e 702e 726f  1], -4) == np.ro
+00016760: 756e 6428 6672 312c 202d 3429 2929 0d0a  und(fr1, -4)))..
+00016770: 0d0a 0d0a 2020 2020 2320 6178 5b69 2c20  ....    # ax[i, 
+00016780: 6a6a 5d2e 7365 745f 786c 696d 2830 2c20  jj].set_xlim(0, 
+00016790: 3735 2e29 0d0a 2020 2020 2320 2361 785b  75.)..    # #ax[
+000167a0: 692c 206a 6a5d 2e73 6574 5f78 6c69 6d28  i, jj].set_xlim(
+000167b0: 302c 2037 352e 290d 0a20 2020 2023 2069  0, 75.)..    # i
+000167c0: 6620 6920 3d3d 2030 2061 6e64 206a 6a20  f i == 0 and jj 
+000167d0: 3d3d 206e 636f 6c73 2d31 3a0d 0a20 2020  == ncols-1:..   
+000167e0: 2023 2020 2020 2061 785b 692c 206a 6a5d   #     ax[i, jj]
+000167f0: 2e6c 6567 656e 6428 6672 616d 656f 6e3d  .legend(frameon=
+00016800: 4661 6c73 6529 0d0a 2020 2020 2320 7265  False)..    # re
+00016810: 7475 726e 2066 0d0a 0d0a 0d0a 636c 6173  turn f......clas
+00016820: 7320 5641 5243 4e4e 2842 6173 654d 6f64  s VARCNN(BaseMod
+00016830: 656c 293a 0d0a 2020 2020 2222 2256 4152  el):..    """VAR
+00016840: 2d43 4e4e 2e0d 0a0d 0a20 2020 2046 6f72  -CNN.....    For
+00016850: 2064 6574 6169 6c73 2073 6565 205b 315d   details see [1]
+00016860: 2e0d 0a0d 0a20 2020 2052 6566 6572 656e  .....    Referen
+00016870: 6365 730d 0a20 2020 202d 2d2d 2d2d 2d2d  ces..    -------
+00016880: 2d2d 2d0d 0a20 2020 2020 2020 205b 315d  ---..        [1]
+00016890: 2049 2e20 5a75 6261 7265 762c 2065 7420   I. Zubarev, et 
+000168a0: 616c 2e2c 2041 6461 7074 6976 6520 6e65  al., Adaptive ne
+000168b0: 7572 616c 206e 6574 776f 726b 2063 6c61  ural network cla
+000168c0: 7373 6966 6965 7220 666f 720d 0a20 2020  ssifier for..   
+000168d0: 2020 2020 2064 6563 6f64 696e 6720 4d45       decoding ME
+000168e0: 4720 7369 676e 616c 732e 204e 6575 726f  G signals. Neuro
+000168f0: 696d 6167 652e 2028 3230 3139 2920 4d61  image. (2019) Ma
+00016900: 7920 343b 3139 373a 3432 352d 3433 340d  y 4;197:425-434.
+00016910: 0a20 2020 2022 2222 0d0a 2020 2020 6465  .    """..    de
+00016920: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00016930: 206d 6574 612c 2064 6174 6173 6574 3d4e   meta, dataset=N
+00016940: 6f6e 6529 3a0d 0a20 2020 2020 2020 2022  one):..        "
+00016950: 2222 0d0a 2020 2020 2020 2020 5061 7261  ""..        Para
+00016960: 6d65 7465 7273 0d0a 2020 2020 2020 2020  meters..        
+00016970: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
+00016980: 2020 2020 4461 7461 7365 7420 3a20 6d6e      Dataset : mn
+00016990: 6566 6c6f 772e 4461 7461 7365 740d 0a0d  eflow.Dataset...
+000169a0: 0a20 2020 2020 2020 2073 7065 6373 203a  .        specs :
+000169b0: 2064 6963 740d 0a20 2020 2020 2020 2020   dict..         
+000169c0: 2020 2020 2020 2064 6963 7469 6f6e 6172         dictionar
+000169d0: 7920 6f66 206d 6f64 656c 2068 7970 6572  y of model hyper
+000169e0: 7061 7261 6d65 7465 7273 207b 0d0a 0d0a  parameters {....
+000169f0: 2020 2020 2020 2020 6e5f 6c61 7465 6e74          n_latent
+00016a00: 203a 2069 6e74 0d0a 2020 2020 2020 2020   : int..        
+00016a10: 2020 2020 4e75 6d62 6572 206f 6620 6c61      Number of la
+00016a20: 7465 6e74 2063 6f6d 706f 6e65 6e74 732e  tent components.
+00016a30: 0d0a 2020 2020 2020 2020 2020 2020 4465  ..            De
+00016a40: 6661 756c 7473 2074 6f20 3332 2e0d 0a0d  faults to 32....
+00016a50: 0a20 2020 2020 2020 206e 6f6e 6c69 6e20  .        nonlin 
+00016a60: 3a20 6361 6c6c 6162 6c65 0d0a 2020 2020  : callable..    
+00016a70: 2020 2020 2020 2020 4163 7469 7661 7469          Activati
+00016a80: 6f6e 2066 756e 6374 696f 6e20 6f66 2074  on function of t
+00016a90: 6865 2074 656d 706f 7261 6c20 636f 6e76  he temporal conv
+00016aa0: 6f6c 7574 696f 6e20 6c61 7965 722e 0d0a  olution layer...
+00016ab0: 2020 2020 2020 2020 2020 2020 4465 6661              Defa
+00016ac0: 756c 7473 2074 6f20 7466 2e6e 6e2e 7265  ults to tf.nn.re
+00016ad0: 6c75 0d0a 0d0a 2020 2020 2020 2020 6669  lu....        fi
+00016ae0: 6c74 6572 5f6c 656e 6774 6820 3a20 696e  lter_length : in
+00016af0: 740d 0a20 2020 2020 2020 2020 2020 204c  t..            L
+00016b00: 656e 6774 6820 6f66 2073 7061 7469 6f2d  ength of spatio-
+00016b10: 7465 6d70 6f72 616c 206b 6572 6e65 6c73  temporal kernels
+00016b20: 2069 6e20 7468 6520 7465 6d70 6f72 616c   in the temporal
+00016b30: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+00016b40: 6e76 6f6c 7574 696f 6e20 6c61 7965 722e  nvolution layer.
+00016b50: 2044 6566 6175 6c74 7320 746f 2037 2e0d   Defaults to 7..
+00016b60: 0a0d 0a20 2020 2020 2020 2070 6f6f 6c69  ...        pooli
+00016b70: 6e67 203a 2069 6e74 0d0a 2020 2020 2020  ng : int..      
+00016b80: 2020 2020 2020 506f 6f6c 696e 6720 6661        Pooling fa
+00016b90: 6374 6f72 206f 6620 7468 6520 6d61 7820  ctor of the max 
+00016ba0: 706f 6f6c 696e 6720 6c61 7965 722e 2044  pooling layer. D
+00016bb0: 6566 6175 6c74 7320 746f 2032 0d0a 0d0a  efaults to 2....
+00016bc0: 2020 2020 2020 2020 706f 6f6c 5f74 7970          pool_typ
+00016bd0: 6520 3a20 7374 7220 7b27 6176 6727 2c20  e : str {'avg', 
+00016be0: 276d 6178 277d 0d0a 2020 2020 2020 2020  'max'}..        
+00016bf0: 2020 2020 5479 7065 206f 6620 706f 6f6c      Type of pool
+00016c00: 696e 6720 6f70 6572 6174 696f 6e2e 2044  ing operation. D
+00016c10: 6566 6175 6c74 7320 746f 2027 6d61 7827  efaults to 'max'
+00016c20: 2e0d 0a0d 0a20 2020 2020 2020 2070 6164  .....        pad
+00016c30: 6469 6e67 203a 2073 7472 207b 2753 414d  ding : str {'SAM
+00016c40: 4527 2c20 2746 554c 4c27 2c20 2756 414c  E', 'FULL', 'VAL
+00016c50: 4944 277d 0d0a 2020 2020 2020 2020 2020  ID'}..          
+00016c60: 2020 436f 6e76 6f6c 7574 696f 6e20 7061    Convolution pa
+00016c70: 6464 696e 672e 2044 6566 6175 6c74 7320  dding. Defaults 
+00016c80: 746f 2027 5341 4d45 272e 7d22 2222 0d0a  to 'SAME'.}"""..
+00016c90: 2020 2020 2020 2020 7365 6c66 2e73 636f          self.sco
+00016ca0: 7065 203d 2027 7661 7263 6e6e 270d 0a20  pe = 'varcnn'.. 
+00016cb0: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
+00016cc0: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
+00016cd0: 6c74 2827 6669 6c74 6572 5f6c 656e 6774  lt('filter_lengt
+00016ce0: 6827 2c20 3729 0d0a 2020 2020 2020 2020  h', 7)..        
+00016cf0: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
+00016d00: 2e73 6574 6465 6661 756c 7428 276e 5f6c  .setdefault('n_l
+00016d10: 6174 656e 7427 2c20 3332 290d 0a20 2020  atent', 32)..   
+00016d20: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
+00016d30: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
+00016d40: 2827 706f 6f6c 696e 6727 2c20 3229 0d0a  ('pooling', 2)..
+00016d50: 2020 2020 2020 2020 6d65 7461 2e6d 6f64          meta.mod
+00016d60: 656c 5f73 7065 6373 2e73 6574 6465 6661  el_specs.setdefa
+00016d70: 756c 7428 2773 7472 6964 6527 2c20 3229  ult('stride', 2)
+00016d80: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
+00016d90: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
+00016da0: 6661 756c 7428 2770 6164 6469 6e67 272c  fault('padding',
+00016db0: 2027 5341 4d45 2729 0d0a 2020 2020 2020   'SAME')..      
+00016dc0: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
+00016dd0: 6373 2e73 6574 6465 6661 756c 7428 2770  cs.setdefault('p
+00016de0: 6f6f 6c5f 7479 7065 272c 2027 6d61 7827  ool_type', 'max'
+00016df0: 290d 0a20 2020 2020 2020 206d 6574 612e  )..        meta.
+00016e00: 6d6f 6465 6c5f 7370 6563 732e 7365 7464  model_specs.setd
+00016e10: 6566 6175 6c74 2827 6e6f 6e6c 696e 272c  efault('nonlin',
+00016e20: 2074 662e 6e6e 2e72 656c 7529 0d0a 2020   tf.nn.relu)..  
+00016e30: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
+00016e40: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
+00016e50: 7428 276c 315f 6c61 6d62 6461 272c 2033  t('l1_lambda', 3
+00016e60: 652d 3429 0d0a 2020 2020 2020 2020 6d65  e-4)..        me
+00016e70: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
+00016e80: 6574 6465 6661 756c 7428 276c 325f 6c61  etdefault('l2_la
+00016e90: 6d62 6461 272c 2030 290d 0a20 2020 2020  mbda', 0)..     
+00016ea0: 2020 206d 6574 612e 6d6f 6465 6c5f 7370     meta.model_sp
+00016eb0: 6563 732e 7365 7464 6566 6175 6c74 2827  ecs.setdefault('
+00016ec0: 6c31 5f73 636f 7065 272c 205b 2766 6327  l1_scope', ['fc'
+00016ed0: 2c20 2764 656d 6978 272c 2027 6c66 5f63  , 'demix', 'lf_c
+00016ee0: 6f6e 7627 5d29 0d0a 2020 2020 2020 2020  onv'])..        
+00016ef0: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
+00016f00: 2e73 6574 6465 6661 756c 7428 276c 325f  .setdefault('l2_
+00016f10: 7363 6f70 6527 2c20 5b5d 290d 0a20 2020  scope', [])..   
+00016f20: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
+00016f30: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
+00016f40: 2827 756e 6974 6e6f 726d 5f73 636f 7065  ('unitnorm_scope
+00016f50: 272c 205b 5d29 0d0a 2020 2020 2020 2020  ', [])..        
+00016f60: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
+00016f70: 5b27 7363 6f70 6527 5d20 3d20 7365 6c66  ['scope'] = self
+00016f80: 2e73 636f 7065 0d0a 2020 2020 2020 2020  .scope..        
+00016f90: 7375 7065 7228 5641 5243 4e4e 2c20 7365  super(VARCNN, se
+00016fa0: 6c66 292e 5f5f 696e 6974 5f5f 286d 6574  lf).__init__(met
+00016fb0: 612c 2064 6174 6173 6574 290d 0a0d 0a20  a, dataset).... 
+00016fc0: 2020 2064 6566 2062 7569 6c64 5f67 7261     def build_gra
+00016fd0: 7068 2873 656c 6629 3a0d 0a20 2020 2020  ph(self):..     
+00016fe0: 2020 2022 2222 4275 696c 6420 636f 6d70     """Build comp
+00016ff0: 7574 6174 696f 6e61 6c20 6772 6170 6820  utational graph 
+00017000: 7573 696e 6720 6465 6669 6e65 6420 706c  using defined pl
+00017010: 6163 6568 6f6c 6465 7220 6073 656c 662e  aceholder `self.
+00017020: 5860 0d0a 2020 2020 2020 2020 6173 2069  X`..        as i
+00017030: 6e70 7574 2e0d 0a0d 0a20 2020 2020 2020  nput.....       
+00017040: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
+00017050: 2020 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020    --------..    
+00017060: 2020 2020 795f 7072 6564 203a 2074 662e      y_pred : tf.
+00017070: 5465 6e73 6f72 0d0a 2020 2020 2020 2020  Tensor..        
+00017080: 2020 2020 4f75 7470 7574 206f 6620 7468      Output of th
+00017090: 6520 666f 7277 6172 6420 7061 7373 206f  e forward pass o
+000170a0: 6620 7468 6520 636f 6d70 7574 6174 696f  f the computatio
+000170b0: 6e61 6c20 6772 6170 682e 0d0a 2020 2020  nal graph...    
+000170c0: 2020 2020 2020 2020 5072 6564 6963 7469          Predicti
+000170d0: 6f6e 206f 6620 7468 6520 7461 7267 6574  on of the target
+000170e0: 2076 6172 6961 626c 652e 0d0a 2020 2020   variable...    
+000170f0: 2020 2020 2222 220d 0a0d 0a20 2020 2020      """....     
+00017100: 2020 2073 656c 662e 646d 7820 3d20 4465     self.dmx = De
+00017110: 4d69 7869 6e67 2873 697a 653d 7365 6c66  Mixing(size=self
+00017120: 2e73 7065 6373 5b27 6e5f 6c61 7465 6e74  .specs['n_latent
+00017130: 275d 2c20 6e6f 6e6c 696e 3d74 662e 6964  '], nonlin=tf.id
+00017140: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
+00017150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017160: 2020 2020 2061 7869 733d 332c 2073 7065       axis=3, spe
+00017170: 6373 3d73 656c 662e 7370 6563 7329 2873  cs=self.specs)(s
+00017180: 656c 662e 696e 7075 7473 290d 0a0d 0a0d  elf.inputs).....
+00017190: 0a20 2020 2020 2020 2073 656c 662e 7463  .        self.tc
+000171a0: 6f6e 7620 3d20 5641 5243 6f6e 7628 7369  onv = VARConv(si
+000171b0: 7a65 3d73 656c 662e 7370 6563 735b 276e  ze=self.specs['n
+000171c0: 5f6c 6174 656e 7427 5d2c 0d0a 2020 2020  _latent'],..    
+000171d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171e0: 2020 2020 2020 2020 206e 6f6e 6c69 6e3d           nonlin=
+000171f0: 7365 6c66 2e73 7065 6373 5b27 6e6f 6e6c  self.specs['nonl
+00017200: 696e 275d 2c0d 0a20 2020 2020 2020 2020  in'],..         
+00017210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017220: 2020 2020 6669 6c74 6572 5f6c 656e 6774      filter_lengt
+00017230: 683d 7365 6c66 2e73 7065 6373 5b27 6669  h=self.specs['fi
+00017240: 6c74 6572 5f6c 656e 6774 6827 5d2c 0d0a  lter_length'],..
+00017250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017260: 2020 2020 2020 2020 2020 2020 2070 6164               pad
+00017270: 6469 6e67 3d73 656c 662e 7370 6563 735b  ding=self.specs[
+00017280: 2770 6164 6469 6e67 275d 2c0d 0a20 2020  'padding'],..   
+00017290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172a0: 2020 2020 2020 2020 2020 7370 6563 733d            specs=
+000172b0: 7365 6c66 2e73 7065 6373 0d0a 2020 2020  self.specs..    
+000172c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172d0: 2020 2020 2020 2020 2029 2873 656c 662e           )(self.
+000172e0: 646d 7829 0d0a 0d0a 2020 2020 2020 2020  dmx)....        
+000172f0: 7365 6c66 2e70 6f6f 6c65 6420 3d20 5465  self.pooled = Te
+00017300: 6d70 506f 6f6c 696e 6728 706f 6f6c 696e  mpPooling(poolin
+00017310: 673d 7365 6c66 2e73 7065 6373 5b27 706f  g=self.specs['po
+00017320: 6f6c 696e 6727 5d2c 0d0a 2020 2020 2020  oling'],..      
+00017330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017340: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+00017350: 5f74 7970 653d 7365 6c66 2e73 7065 6373  _type=self.specs
+00017360: 5b27 706f 6f6c 5f74 7970 6527 5d2c 0d0a  ['pool_type'],..
+00017370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017390: 2020 7374 7269 6465 3d73 656c 662e 7370    stride=self.sp
+000173a0: 6563 735b 2773 7472 6964 6527 5d2c 0d0a  ecs['stride'],..
+000173b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000173c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000173d0: 2020 7061 6464 696e 673d 7365 6c66 2e73    padding=self.s
+000173e0: 7065 6373 5b27 7061 6464 696e 6727 5d2c  pecs['padding'],
+000173f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017410: 2020 2020 2928 7365 6c66 2e74 636f 6e76      )(self.tconv
+00017420: 290d 0a0d 0a20 2020 2020 2020 2064 726f  )....        dro
+00017430: 706f 7574 203d 2044 726f 706f 7574 2873  pout = Dropout(s
+00017440: 656c 662e 7370 6563 735b 2764 726f 706f  elf.specs['dropo
+00017450: 7574 275d 2c0d 0a20 2020 2020 2020 2020  ut'],..         
+00017460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017470: 206e 6f69 7365 5f73 6861 7065 3d4e 6f6e   noise_shape=Non
+00017480: 6529 2873 656c 662e 706f 6f6c 6564 290d  e)(self.pooled).
+00017490: 0a0d 0a20 2020 2020 2020 2023 6663 3120  ...        #fc1 
+000174a0: 3d20 4675 6c6c 7943 6f6e 6e65 6374 6564  = FullyConnected
+000174b0: 2873 697a 653d 3132 382c 206e 6f6e 6c69  (size=128, nonli
+000174c0: 6e3d 7466 2e6e 6e2e 656c 752c 0d0a 2020  n=tf.nn.elu,..  
+000174d0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+000174e0: 2020 2020 2020 2020 2020 2073 7065 6373             specs
+000174f0: 3d73 656c 662e 7370 6563 7329 2864 726f  =self.specs)(dro
+00017500: 706f 7574 290d 0a0d 0a20 2020 2020 2020  pout)....       
+00017510: 2073 656c 662e 6669 6e5f 6663 203d 2046   self.fin_fc = F
+00017520: 756c 6c79 436f 6e6e 6563 7465 6428 7369  ullyConnected(si
+00017530: 7a65 3d73 656c 662e 6f75 745f 6469 6d2c  ze=self.out_dim,
+00017540: 206e 6f6e 6c69 6e3d 7466 2e69 6465 6e74   nonlin=tf.ident
+00017550: 6974 792c 0d0a 2020 2020 2020 2020 2020  ity,..          
 00017560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017570: 2020 2020 2020 2020 2073 7065 6373 3d73           specs=s
-00017580: 656c 662e 7370 6563 730d 0a20 2020 2020  elf.specs..     
-00017590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000175a0: 2020 2020 2020 2020 2928 7365 6c66 2e64          )(self.d
-000175b0: 6d78 290d 0a0d 0a20 2020 2020 2020 2073  mx)....        s
-000175c0: 656c 662e 706f 6f6c 6564 203d 2054 656d  elf.pooled = Tem
-000175d0: 7050 6f6f 6c69 6e67 2870 6f6f 6c69 6e67  pPooling(pooling
-000175e0: 3d73 656c 662e 7370 6563 735b 2770 6f6f  =self.specs['poo
-000175f0: 6c69 6e67 275d 2c0d 0a20 2020 2020 2020  ling'],..       
-00017600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017610: 2020 2020 2020 2020 2020 2070 6f6f 6c5f             pool_
-00017620: 7479 7065 3d73 656c 662e 7370 6563 735b  type=self.specs[
-00017630: 2770 6f6f 6c5f 7479 7065 275d 2c0d 0a20  'pool_type'],.. 
-00017640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017660: 2073 7472 6964 653d 7365 6c66 2e73 7065   stride=self.spe
-00017670: 6373 5b27 7374 7269 6465 275d 2c0d 0a20  cs['stride'],.. 
-00017680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176a0: 2070 6164 6469 6e67 3d73 656c 662e 7370   padding=self.sp
-000176b0: 6563 735b 2770 6164 6469 6e67 275d 2c0d  ecs['padding'],.
-000176c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000176d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176e0: 2020 2029 2873 656c 662e 7463 6f6e 7629     )(self.tconv)
-000176f0: 0d0a 0d0a 2020 2020 2020 2020 6472 6f70  ....        drop
-00017700: 6f75 7420 3d20 4472 6f70 6f75 7428 7365  out = Dropout(se
-00017710: 6c66 2e73 7065 6373 5b27 6472 6f70 6f75  lf.specs['dropou
-00017720: 7427 5d2c 0d0a 2020 2020 2020 2020 2020  t'],..          
-00017730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017740: 6e6f 6973 655f 7368 6170 653d 4e6f 6e65  noise_shape=None
-00017750: 2928 7365 6c66 2e70 6f6f 6c65 6429 0d0a  )(self.pooled)..
-00017760: 0d0a 2020 2020 2020 2020 2366 6331 203d  ..        #fc1 =
-00017770: 2046 756c 6c79 436f 6e6e 6563 7465 6428   FullyConnected(
-00017780: 7369 7a65 3d31 3238 2c20 6e6f 6e6c 696e  size=128, nonlin
-00017790: 3d74 662e 6e6e 2e65 6c75 2c0d 0a20 2020  =tf.nn.elu,..   
-000177a0: 2020 2020 2023 2020 2020 2020 2020 2020       #          
-000177b0: 2020 2020 2020 2020 2020 7370 6563 733d            specs=
-000177c0: 7365 6c66 2e73 7065 6373 2928 6472 6f70  self.specs)(drop
-000177d0: 6f75 7429 0d0a 0d0a 2020 2020 2020 2020  out)....        
-000177e0: 7365 6c66 2e66 696e 5f66 6320 3d20 4675  self.fin_fc = Fu
-000177f0: 6c6c 7943 6f6e 6e65 6374 6564 2873 697a  llyConnected(siz
-00017800: 653d 7365 6c66 2e6f 7574 5f64 696d 2c20  e=self.out_dim, 
-00017810: 6e6f 6e6c 696e 3d74 662e 6964 656e 7469  nonlin=tf.identi
-00017820: 7479 2c0d 0a20 2020 2020 2020 2020 2020  ty,..           
-00017830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017840: 2073 7065 6373 3d73 656c 662e 7370 6563   specs=self.spec
-00017850: 7329 0d0a 0d0a 2020 2020 2020 2020 795f  s)....        y_
-00017860: 7072 6564 203d 2073 656c 662e 6669 6e5f  pred = self.fin_
-00017870: 6663 2864 726f 706f 7574 290d 0a0d 0a20  fc(dropout).... 
-00017880: 2020 2020 2020 2072 6574 7572 6e20 795f         return y_
-00017890: 7072 6564 0d0a 0d0a 0d0a 0d0a 636c 6173  pred........clas
-000178a0: 7320 4642 4353 505f 5368 616c 6c6f 774e  s FBCSP_ShallowN
-000178b0: 6574 2842 6173 654d 6f64 656c 293a 0d0a  et(BaseModel):..
-000178c0: 2020 2020 2222 220d 0a20 2020 2053 6861      """..    Sha
-000178d0: 6c6c 6f77 2043 6f6e 764e 6574 206d 6f64  llow ConvNet mod
-000178e0: 656c 2066 726f 6d20 5b32 615d 5f2e 0d0a  el from [2a]_...
-000178f0: 2020 2020 5265 6665 7265 6e63 6573 0d0a      References..
-00017900: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a      ----------..
-00017910: 2020 2020 2e2e 205b 3261 5d20 5363 6869      .. [2a] Schi
-00017920: 7272 6d65 6973 7465 722c 2052 2e20 542e  rrmeister, R. T.
-00017930: 2c20 5370 7269 6e67 656e 6265 7267 2c20  , Springenberg, 
-00017940: 4a2e 2054 2e2c 2046 6965 6465 7265 722c  J. T., Fiederer,
-00017950: 204c 2e20 442e 204a 2e2c 0d0a 2020 2020   L. D. J.,..    
-00017960: 2020 2047 6c61 7373 7465 7474 6572 2c20     Glasstetter, 
-00017970: 4d2e 2c20 4567 6765 6e73 7065 7267 6572  M., Eggensperger
-00017980: 2c20 4b2e 2c20 5461 6e67 6572 6d61 6e6e  , K., Tangermann
-00017990: 2c20 4d2e 2c20 4875 7474 6572 2c20 462e  , M., Hutter, F.
-000179a0: 2026 2042 616c 6c2c 2054 2e20 2832 3031   & Ball, T. (201
-000179b0: 3729 2e0d 0a20 2020 2020 2020 4465 6570  7)...       Deep
-000179c0: 206c 6561 726e 696e 6720 7769 7468 2063   learning with c
-000179d0: 6f6e 766f 6c75 7469 6f6e 616c 206e 6575  onvolutional neu
-000179e0: 7261 6c20 6e65 7477 6f72 6b73 2066 6f72  ral networks for
-000179f0: 2045 4547 2064 6563 6f64 696e 6720 616e   EEG decoding an
-00017a00: 640d 0a20 2020 2020 2020 7669 7375 616c  d..       visual
-00017a10: 697a 6174 696f 6e2e 0d0a 2020 2020 2020  ization...      
-00017a20: 2048 756d 616e 2042 7261 696e 204d 6170   Human Brain Map
-00017a30: 7069 6e67 202c 2041 7567 2e20 3230 3137  ping , Aug. 2017
-00017a40: 2e20 4f6e 6c69 6e65 3a20 6874 7470 3a2f  . Online: http:/
-00017a50: 2f64 782e 646f 692e 6f72 672f 3130 2e31  /dx.doi.org/10.1
-00017a60: 3030 322f 6862 6d2e 3233 3733 300d 0a20  002/hbm.23730.. 
-00017a70: 2020 2022 2222 0d0a 2020 2020 6465 6620     """..    def 
-00017a80: 5f5f 696e 6974 5f5f 2873 656c 662c 206d  __init__(self, m
-00017a90: 6574 612c 2064 6174 6173 6574 3d4e 6f6e  eta, dataset=Non
-00017aa0: 6529 3a0d 0a20 2020 2020 2020 2073 656c  e):..        sel
-00017ab0: 662e 7363 6f70 6520 3d20 2766 6263 7370  f.scope = 'fbcsp
-00017ac0: 2d53 6861 6c6c 6f77 4e65 7427 0d0a 2020  -ShallowNet'..  
-00017ad0: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
-00017ae0: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
-00017af0: 7428 2766 696c 7465 725f 6c65 6e67 7468  t('filter_length
-00017b00: 272c 2032 3529 0d0a 2020 2020 2020 2020  ', 25)..        
-00017b10: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
-00017b20: 2e73 6574 6465 6661 756c 7428 276e 5f6c  .setdefault('n_l
-00017b30: 6174 656e 7427 2c20 3430 290d 0a20 2020  atent', 40)..   
-00017b40: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
-00017b50: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
-00017b60: 2827 706f 6f6c 696e 6727 2c20 3735 290d  ('pooling', 75).
-00017b70: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
-00017b80: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
-00017b90: 6175 6c74 2827 7374 7269 6465 272c 2031  ault('stride', 1
-00017ba0: 3529 0d0a 2020 2020 2020 2020 6d65 7461  5)..        meta
-00017bb0: 2e6d 6f64 656c 5f73 7065 6373 2e73 6574  .model_specs.set
-00017bc0: 6465 6661 756c 7428 2770 6f6f 6c5f 7479  default('pool_ty
-00017bd0: 7065 272c 2027 6176 6727 290d 0a20 2020  pe', 'avg')..   
-00017be0: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
-00017bf0: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
-00017c00: 2827 7061 6464 696e 6727 2c20 2753 414d  ('padding', 'SAM
-00017c10: 4527 290d 0a20 2020 2020 2020 206d 6574  E')..        met
-00017c20: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
-00017c30: 7464 6566 6175 6c74 2827 6e6f 6e6c 696e  tdefault('nonlin
-00017c40: 272c 2074 662e 6e6e 2e72 656c 7529 0d0a  ', tf.nn.relu)..
-00017c50: 2020 2020 2020 2020 6d65 7461 2e6d 6f64          meta.mod
-00017c60: 656c 5f73 7065 6373 2e73 6574 6465 6661  el_specs.setdefa
-00017c70: 756c 7428 276c 315f 6c61 6d62 6461 272c  ult('l1_lambda',
-00017c80: 2033 652d 3429 0d0a 2020 2020 2020 2020   3e-4)..        
-00017c90: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
-00017ca0: 2e73 6574 6465 6661 756c 7428 276c 325f  .setdefault('l2_
-00017cb0: 6c61 6d62 6461 272c 2033 652d 3229 0d0a  lambda', 3e-2)..
-00017cc0: 2020 2020 2020 2020 6d65 7461 2e6d 6f64          meta.mod
-00017cd0: 656c 5f73 7065 6373 2e73 6574 6465 6661  el_specs.setdefa
-00017ce0: 756c 7428 276c 315f 7363 6f70 6527 2c20  ult('l1_scope', 
-00017cf0: 5b5d 290d 0a20 2020 2020 2020 206d 6574  [])..        met
-00017d00: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
-00017d10: 7464 6566 6175 6c74 2827 6c32 5f73 636f  tdefault('l2_sco
-00017d20: 7065 272c 205b 2763 6f6e 7627 2c20 2766  pe', ['conv', 'f
-00017d30: 6327 5d29 0d0a 0d0a 2020 2020 2020 2020  c'])....        
-00017d40: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
-00017d50: 2e73 6574 6465 6661 756c 7428 2775 6e69  .setdefault('uni
-00017d60: 746e 6f72 6d5f 7363 6f70 6527 2c20 5b5d  tnorm_scope', []
-00017d70: 290d 0a20 2020 2020 2020 2023 7370 6563  )..        #spec
-00017d80: 732e 7365 7464 6566 6175 6c74 2827 6d6f  s.setdefault('mo
-00017d90: 6465 6c5f 7061 7468 272c 206f 732e 7061  del_path', os.pa
-00017da0: 7468 2e6a 6f69 6e28 7365 6c66 2e64 6174  th.join(self.dat
-00017db0: 6173 6574 2e68 5f70 6172 616d 735b 2770  aset.h_params['p
-00017dc0: 6174 6827 5d2c 2027 6d6f 6465 6c73 2729  ath'], 'models')
-00017dd0: 290d 0a20 2020 2020 2020 2073 7570 6572  )..        super
-00017de0: 2846 4243 5350 5f53 6861 6c6c 6f77 4e65  (FBCSP_ShallowNe
-00017df0: 742c 2073 656c 6629 2e5f 5f69 6e69 745f  t, self).__init_
-00017e00: 5f28 6d65 7461 2c20 6461 7461 7365 7429  _(meta, dataset)
-00017e10: 0d0a 0d0a 2020 2020 6465 6620 6275 696c  ....    def buil
-00017e20: 645f 6772 6170 6828 7365 6c66 293a 0d0a  d_graph(self):..
-00017e30: 0d0a 2020 2020 2020 2020 2222 2254 656d  ..        """Tem
-00017e40: 706f 7261 6c20 636f 6e76 5f31 2032 3520  poral conv_1 25 
-00017e50: 3130 7831 206b 6572 6e65 6c73 2222 220d  10x1 kernels""".
-00017e60: 0a20 2020 2020 2020 2023 2873 656c 662e  .        #(self.
-00017e70: 696e 7075 7473 290d 0a20 2020 2020 2020  inputs)..       
-00017e80: 2069 6e70 7574 7320 3d20 7466 2e74 7261   inputs = tf.tra
-00017e90: 6e73 706f 7365 2873 656c 662e 696e 7075  nspose(self.inpu
-00017ea0: 7473 2c5b 302c 332c 322c 315d 290d 0a20  ts,[0,3,2,1]).. 
-00017eb0: 2020 2020 2020 2023 7072 696e 7428 696e         #print(in
-00017ec0: 7075 7473 2e73 6861 7065 290d 0a20 2020  puts.shape)..   
-00017ed0: 2020 2020 2023 6466 203d 2022 6368 616e       #df = "chan
-00017ee0: 6e65 6c73 5f66 6972 7374 220d 0a20 2020  nels_first"..   
-00017ef0: 2020 2020 2074 636f 6e76 3120 3d20 4465       tconv1 = De
-00017f00: 7074 6877 6973 6543 6f6e 7632 4428 0d0a  pthwiseConv2D(..
-00017f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f20: 2020 2020 2020 2020 6b65 726e 656c 5f73          kernel_s
-00017f30: 697a 653d 2831 2c20 7365 6c66 2e73 7065  ize=(1, self.spe
-00017f40: 6373 5b27 6669 6c74 6572 5f6c 656e 6774  cs['filter_lengt
-00017f50: 6827 5d29 2c0d 0a20 2020 2020 2020 2020  h']),..         
-00017f60: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00017f70: 6570 7468 5f6d 756c 7469 706c 6965 7220  epth_multiplier 
-00017f80: 3d20 7365 6c66 2e73 7065 6373 5b27 6e5f  = self.specs['n_
-00017f90: 6c61 7465 6e74 275d 2c0d 0a20 2020 2020  latent'],..     
+00017570: 2020 7370 6563 733d 7365 6c66 2e73 7065    specs=self.spe
+00017580: 6373 290d 0a0d 0a20 2020 2020 2020 2079  cs)....        y
+00017590: 5f70 7265 6420 3d20 7365 6c66 2e66 696e  _pred = self.fin
+000175a0: 5f66 6328 6472 6f70 6f75 7429 0d0a 0d0a  _fc(dropout)....
+000175b0: 2020 2020 2020 2020 7265 7475 726e 2079          return y
+000175c0: 5f70 7265 640d 0a0d 0a0d 0a0d 0a63 6c61  _pred........cla
+000175d0: 7373 2046 4243 5350 5f53 6861 6c6c 6f77  ss FBCSP_Shallow
+000175e0: 4e65 7428 4261 7365 4d6f 6465 6c29 3a0d  Net(BaseModel):.
+000175f0: 0a20 2020 2022 2222 0d0a 2020 2020 5368  .    """..    Sh
+00017600: 616c 6c6f 7720 436f 6e76 4e65 7420 6d6f  allow ConvNet mo
+00017610: 6465 6c20 6672 6f6d 205b 3261 5d5f 2e0d  del from [2a]_..
+00017620: 0a20 2020 2052 6566 6572 656e 6365 730d  .    References.
+00017630: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d  .    ----------.
+00017640: 0a20 2020 202e 2e20 5b32 615d 2053 6368  .    .. [2a] Sch
+00017650: 6972 726d 6569 7374 6572 2c20 522e 2054  irrmeister, R. T
+00017660: 2e2c 2053 7072 696e 6765 6e62 6572 672c  ., Springenberg,
+00017670: 204a 2e20 542e 2c20 4669 6564 6572 6572   J. T., Fiederer
+00017680: 2c20 4c2e 2044 2e20 4a2e 2c0d 0a20 2020  , L. D. J.,..   
+00017690: 2020 2020 476c 6173 7374 6574 7465 722c      Glasstetter,
+000176a0: 204d 2e2c 2045 6767 656e 7370 6572 6765   M., Eggensperge
+000176b0: 722c 204b 2e2c 2054 616e 6765 726d 616e  r, K., Tangerman
+000176c0: 6e2c 204d 2e2c 2048 7574 7465 722c 2046  n, M., Hutter, F
+000176d0: 2e20 2620 4261 6c6c 2c20 542e 2028 3230  . & Ball, T. (20
+000176e0: 3137 292e 0d0a 2020 2020 2020 2044 6565  17)...       Dee
+000176f0: 7020 6c65 6172 6e69 6e67 2077 6974 6820  p learning with 
+00017700: 636f 6e76 6f6c 7574 696f 6e61 6c20 6e65  convolutional ne
+00017710: 7572 616c 206e 6574 776f 726b 7320 666f  ural networks fo
+00017720: 7220 4545 4720 6465 636f 6469 6e67 2061  r EEG decoding a
+00017730: 6e64 0d0a 2020 2020 2020 2076 6973 7561  nd..       visua
+00017740: 6c69 7a61 7469 6f6e 2e0d 0a20 2020 2020  lization...     
+00017750: 2020 4875 6d61 6e20 4272 6169 6e20 4d61    Human Brain Ma
+00017760: 7070 696e 6720 2c20 4175 672e 2032 3031  pping , Aug. 201
+00017770: 372e 204f 6e6c 696e 653a 2068 7474 703a  7. Online: http:
+00017780: 2f2f 6478 2e64 6f69 2e6f 7267 2f31 302e  //dx.doi.org/10.
+00017790: 3130 3032 2f68 626d 2e32 3337 3330 0d0a  1002/hbm.23730..
+000177a0: 2020 2020 2222 220d 0a20 2020 2064 6566      """..    def
+000177b0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+000177c0: 6d65 7461 2c20 6461 7461 7365 743d 4e6f  meta, dataset=No
+000177d0: 6e65 293a 0d0a 2020 2020 2020 2020 7365  ne):..        se
+000177e0: 6c66 2e73 636f 7065 203d 2027 6662 6373  lf.scope = 'fbcs
+000177f0: 702d 5368 616c 6c6f 774e 6574 270d 0a20  p-ShallowNet'.. 
+00017800: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
+00017810: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
+00017820: 6c74 2827 6669 6c74 6572 5f6c 656e 6774  lt('filter_lengt
+00017830: 6827 2c20 3235 290d 0a20 2020 2020 2020  h', 25)..       
+00017840: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
+00017850: 732e 7365 7464 6566 6175 6c74 2827 6e5f  s.setdefault('n_
+00017860: 6c61 7465 6e74 272c 2034 3029 0d0a 2020  latent', 40)..  
+00017870: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
+00017880: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
+00017890: 7428 2770 6f6f 6c69 6e67 272c 2037 3529  t('pooling', 75)
+000178a0: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
+000178b0: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
+000178c0: 6661 756c 7428 2773 7472 6964 6527 2c20  fault('stride', 
+000178d0: 3135 290d 0a20 2020 2020 2020 206d 6574  15)..        met
+000178e0: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
+000178f0: 7464 6566 6175 6c74 2827 706f 6f6c 5f74  tdefault('pool_t
+00017900: 7970 6527 2c20 2761 7667 2729 0d0a 2020  ype', 'avg')..  
+00017910: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
+00017920: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
+00017930: 7428 2770 6164 6469 6e67 272c 2027 5341  t('padding', 'SA
+00017940: 4d45 2729 0d0a 2020 2020 2020 2020 6d65  ME')..        me
+00017950: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
+00017960: 6574 6465 6661 756c 7428 276e 6f6e 6c69  etdefault('nonli
+00017970: 6e27 2c20 7466 2e6e 6e2e 7265 6c75 290d  n', tf.nn.relu).
+00017980: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
+00017990: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
+000179a0: 6175 6c74 2827 6c31 5f6c 616d 6264 6127  ault('l1_lambda'
+000179b0: 2c20 3365 2d34 290d 0a20 2020 2020 2020  , 3e-4)..       
+000179c0: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
+000179d0: 732e 7365 7464 6566 6175 6c74 2827 6c32  s.setdefault('l2
+000179e0: 5f6c 616d 6264 6127 2c20 3365 2d32 290d  _lambda', 3e-2).
+000179f0: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
+00017a00: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
+00017a10: 6175 6c74 2827 6c31 5f73 636f 7065 272c  ault('l1_scope',
+00017a20: 205b 5d29 0d0a 2020 2020 2020 2020 6d65   [])..        me
+00017a30: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
+00017a40: 6574 6465 6661 756c 7428 276c 325f 7363  etdefault('l2_sc
+00017a50: 6f70 6527 2c20 5b27 636f 6e76 272c 2027  ope', ['conv', '
+00017a60: 6663 275d 290d 0a0d 0a20 2020 2020 2020  fc'])....       
+00017a70: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
+00017a80: 732e 7365 7464 6566 6175 6c74 2827 756e  s.setdefault('un
+00017a90: 6974 6e6f 726d 5f73 636f 7065 272c 205b  itnorm_scope', [
+00017aa0: 5d29 0d0a 2020 2020 2020 2020 2373 7065  ])..        #spe
+00017ab0: 6373 2e73 6574 6465 6661 756c 7428 276d  cs.setdefault('m
+00017ac0: 6f64 656c 5f70 6174 6827 2c20 6f73 2e70  odel_path', os.p
+00017ad0: 6174 682e 6a6f 696e 2873 656c 662e 6461  ath.join(self.da
+00017ae0: 7461 7365 742e 685f 7061 7261 6d73 5b27  taset.h_params['
+00017af0: 7061 7468 275d 2c20 276d 6f64 656c 7327  path'], 'models'
+00017b00: 2929 0d0a 2020 2020 2020 2020 7375 7065  ))..        supe
+00017b10: 7228 4642 4353 505f 5368 616c 6c6f 774e  r(FBCSP_ShallowN
+00017b20: 6574 2c20 7365 6c66 292e 5f5f 696e 6974  et, self).__init
+00017b30: 5f5f 286d 6574 612c 2064 6174 6173 6574  __(meta, dataset
+00017b40: 290d 0a0d 0a20 2020 2064 6566 2062 7569  )....    def bui
+00017b50: 6c64 5f67 7261 7068 2873 656c 6629 3a0d  ld_graph(self):.
+00017b60: 0a0d 0a20 2020 2020 2020 2022 2222 5465  ...        """Te
+00017b70: 6d70 6f72 616c 2063 6f6e 765f 3120 3235  mporal conv_1 25
+00017b80: 2031 3078 3120 6b65 726e 656c 7322 2222   10x1 kernels"""
+00017b90: 0d0a 2020 2020 2020 2020 2328 7365 6c66  ..        #(self
+00017ba0: 2e69 6e70 7574 7329 0d0a 2020 2020 2020  .inputs)..      
+00017bb0: 2020 696e 7075 7473 203d 2074 662e 7472    inputs = tf.tr
+00017bc0: 616e 7370 6f73 6528 7365 6c66 2e69 6e70  anspose(self.inp
+00017bd0: 7574 732c 5b30 2c33 2c32 2c31 5d29 0d0a  uts,[0,3,2,1])..
+00017be0: 2020 2020 2020 2020 2370 7269 6e74 2869          #print(i
+00017bf0: 6e70 7574 732e 7368 6170 6529 0d0a 2020  nputs.shape)..  
+00017c00: 2020 2020 2020 2364 6620 3d20 2263 6861        #df = "cha
+00017c10: 6e6e 656c 735f 6669 7273 7422 0d0a 2020  nnels_first"..  
+00017c20: 2020 2020 2020 7463 6f6e 7631 203d 2044        tconv1 = D
+00017c30: 6570 7468 7769 7365 436f 6e76 3244 280d  epthwiseConv2D(.
+00017c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017c50: 2020 2020 2020 2020 206b 6572 6e65 6c5f           kernel_
+00017c60: 7369 7a65 3d28 312c 2073 656c 662e 7370  size=(1, self.sp
+00017c70: 6563 735b 2766 696c 7465 725f 6c65 6e67  ecs['filter_leng
+00017c80: 7468 275d 292c 0d0a 2020 2020 2020 2020  th']),..        
+00017c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ca0: 6465 7074 685f 6d75 6c74 6970 6c69 6572  depth_multiplier
+00017cb0: 203d 2073 656c 662e 7370 6563 735b 276e   = self.specs['n
+00017cc0: 5f6c 6174 656e 7427 5d2c 0d0a 2020 2020  _latent'],..    
+00017cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ce0: 2020 2020 7374 7269 6465 733d 312c 0d0a      strides=1,..
+00017cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d00: 2020 2020 2020 2020 7061 6464 696e 673d          padding=
+00017d10: 2256 414c 4944 222c 0d0a 2020 2020 2020  "VALID",..      
+00017d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d30: 2020 6163 7469 7661 7469 6f6e 203d 2074    activation = t
+00017d40: 662e 6964 656e 7469 7479 2c0d 0a20 2020  f.identity,..   
+00017d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d60: 2020 2020 206b 6572 6e65 6c5f 696e 6974       kernel_init
+00017d70: 6961 6c69 7a65 723d 2268 655f 756e 6966  ializer="he_unif
+00017d80: 6f72 6d22 2c0d 0a20 2020 2020 2020 2020  orm",..         
+00017d90: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00017da0: 6961 735f 696e 6974 6961 6c69 7a65 723d  ias_initializer=
+00017db0: 436f 6e73 7461 6e74 2830 2e31 292c 0d0a  Constant(0.1),..
+00017dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017dd0: 2020 2020 2020 2020 6461 7461 5f66 6f72          data_for
+00017de0: 6d61 743d 2263 6861 6e6e 656c 735f 6c61  mat="channels_la
+00017df0: 7374 222c 0d0a 2020 2020 2020 2020 2020  st",..          
+00017e00: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+00017e10: 726e 656c 5f72 6567 756c 6172 697a 6572  rnel_regularizer
+00017e20: 3d6b 5f72 6567 2e6c 3228 7365 6c66 2e73  =k_reg.l2(self.s
+00017e30: 7065 6373 5b27 6c32 5f6c 616d 6264 6127  pecs['l2_lambda'
+00017e40: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00017e50: 2020 2020 2020 2020 2020 2020 236b 6572              #ker
+00017e60: 6e65 6c5f 636f 6e73 7472 6169 6e74 3d22  nel_constraint="
+00017e70: 6d61 786e 6f72 6d22 0d0a 2020 2020 2020  maxnorm"..      
+00017e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e90: 2020 290d 0a0d 0a20 2020 2020 2020 2074    )....        t
+00017ea0: 636f 6e76 315f 6f75 7420 3d20 7463 6f6e  conv1_out = tcon
+00017eb0: 7631 2869 6e70 7574 7329 0d0a 2020 2020  v1(inputs)..    
+00017ec0: 2020 2020 7072 696e 7428 2774 636f 6e76      print('tconv
+00017ed0: 313a 2027 2c20 7463 6f6e 7631 5f6f 7574  1: ', tconv1_out
+00017ee0: 2e73 6861 7065 2920 2373 686f 756c 6420  .shape) #should 
+00017ef0: 6265 206e 5f62 6174 6368 2c20 7365 6e73  be n_batch, sens
+00017f00: 6f72 732c 2074 696d 6573 2c20 6b65 726e  ors, times, kern
+00017f10: 656c 730d 0a0d 0a20 2020 2020 2020 2073  els....        s
+00017f20: 636f 6e76 3120 3d20 436f 6e76 3244 2866  conv1 = Conv2D(f
+00017f30: 696c 7465 7273 3d73 656c 662e 7370 6563  ilters=self.spec
+00017f40: 735b 276e 5f6c 6174 656e 7427 5d2c 0d0a  s['n_latent'],..
+00017f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f60: 2020 2020 2020 2020 6b65 726e 656c 5f73          kernel_s
+00017f70: 697a 653d 2873 656c 662e 6461 7461 7365  ize=(self.datase
+00017f80: 742e 685f 7061 7261 6d73 5b27 6e5f 6368  t.h_params['n_ch
+00017f90: 275d 2c20 3129 2c0d 0a20 2020 2020 2020  '], 1),..       
 00017fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fb0: 2020 2073 7472 6964 6573 3d31 2c0d 0a20     strides=1,.. 
+00017fb0: 2073 7472 6964 6573 3d31 2c0d 0a20 2020   strides=1,..   
 00017fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fd0: 2020 2020 2020 2070 6164 6469 6e67 3d22         padding="
-00017fe0: 5641 4c49 4422 2c0d 0a20 2020 2020 2020  VALID",..       
-00017ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018000: 2061 6374 6976 6174 696f 6e20 3d20 7466   activation = tf
-00018010: 2e69 6465 6e74 6974 792c 0d0a 2020 2020  .identity,..    
+00017fd0: 2020 2020 2070 6164 6469 6e67 3d22 5641       padding="VA
+00017fe0: 4c49 4422 2c0d 0a20 2020 2020 2020 2020  LID",..         
+00017ff0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00018000: 6374 6976 6174 696f 6e20 3d20 7466 2e73  ctivation = tf.s
+00018010: 7175 6172 652c 0d0a 2020 2020 2020 2020  quare,..        
 00018020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018030: 2020 2020 6b65 726e 656c 5f69 6e69 7469      kernel_initi
-00018040: 616c 697a 6572 3d22 6865 5f75 6e69 666f  alizer="he_unifo
-00018050: 726d 222c 0d0a 2020 2020 2020 2020 2020  rm",..          
-00018060: 2020 2020 2020 2020 2020 2020 2020 6269                bi
-00018070: 6173 5f69 6e69 7469 616c 697a 6572 3d43  as_initializer=C
-00018080: 6f6e 7374 616e 7428 302e 3129 2c0d 0a20  onstant(0.1),.. 
+00018030: 6b65 726e 656c 5f69 6e69 7469 616c 697a  kernel_initializ
+00018040: 6572 3d22 6865 5f75 6e69 666f 726d 222c  er="he_uniform",
+00018050: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018060: 2020 2020 2020 2020 2020 6269 6173 5f69            bias_i
+00018070: 6e69 7469 616c 697a 6572 3d43 6f6e 7374  nitializer=Const
+00018080: 616e 7428 302e 3129 2c0d 0a20 2020 2020  ant(0.1),..     
 00018090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000180a0: 2020 2020 2020 2064 6174 615f 666f 726d         data_form
-000180b0: 6174 3d22 6368 616e 6e65 6c73 5f6c 6173  at="channels_las
-000180c0: 7422 2c0d 0a20 2020 2020 2020 2020 2020  t",..           
-000180d0: 2020 2020 2020 2020 2020 2020 206b 6572               ker
-000180e0: 6e65 6c5f 7265 6775 6c61 7269 7a65 723d  nel_regularizer=
-000180f0: 6b5f 7265 672e 6c32 2873 656c 662e 7370  k_reg.l2(self.sp
-00018100: 6563 735b 276c 325f 6c61 6d62 6461 275d  ecs['l2_lambda']
-00018110: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00018120: 2020 2020 2020 2020 2020 2023 6b65 726e             #kern
-00018130: 656c 5f63 6f6e 7374 7261 696e 743d 226d  el_constraint="m
-00018140: 6178 6e6f 726d 220d 0a20 2020 2020 2020  axnorm"..       
-00018150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018160: 2029 0d0a 0d0a 2020 2020 2020 2020 7463   )....        tc
-00018170: 6f6e 7631 5f6f 7574 203d 2074 636f 6e76  onv1_out = tconv
-00018180: 3128 696e 7075 7473 290d 0a20 2020 2020  1(inputs)..     
-00018190: 2020 2070 7269 6e74 2827 7463 6f6e 7631     print('tconv1
-000181a0: 3a20 272c 2074 636f 6e76 315f 6f75 742e  : ', tconv1_out.
-000181b0: 7368 6170 6529 2023 7368 6f75 6c64 2062  shape) #should b
-000181c0: 6520 6e5f 6261 7463 682c 2073 656e 736f  e n_batch, senso
-000181d0: 7273 2c20 7469 6d65 732c 206b 6572 6e65  rs, times, kerne
-000181e0: 6c73 0d0a 0d0a 2020 2020 2020 2020 7363  ls....        sc
-000181f0: 6f6e 7631 203d 2043 6f6e 7632 4428 6669  onv1 = Conv2D(fi
-00018200: 6c74 6572 733d 7365 6c66 2e73 7065 6373  lters=self.specs
-00018210: 5b27 6e5f 6c61 7465 6e74 275d 2c0d 0a20  ['n_latent'],.. 
+000180a0: 2020 2064 6174 615f 666f 726d 6174 3d22     data_format="
+000180b0: 6368 616e 6e65 6c73 5f6c 6173 7422 2c0d  channels_last",.
+000180c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000180d0: 2020 2020 2020 2020 2023 6461 7461 5f66           #data_f
+000180e0: 6f72 6d61 743d 2263 6861 6e6e 656c 735f  ormat="channels_
+000180f0: 6669 7273 7422 2c0d 0a20 2020 2020 2020  first",..       
+00018100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018110: 206b 6572 6e65 6c5f 7265 6775 6c61 7269   kernel_regulari
+00018120: 7a65 723d 6b5f 7265 672e 6c32 2873 656c  zer=k_reg.l2(sel
+00018130: 662e 7370 6563 735b 276c 325f 6c61 6d62  f.specs['l2_lamb
+00018140: 6461 275d 2929 0d0a 0d0a 0d0a 2020 2020  da']))......    
+00018150: 2020 2020 7363 6f6e 7631 5f6f 7574 203d      sconv1_out =
+00018160: 2073 636f 6e76 3128 7463 6f6e 7631 5f6f   sconv1(tconv1_o
+00018170: 7574 290d 0a20 2020 2020 2020 2070 7269  ut)..        pri
+00018180: 6e74 2827 7363 6f6e 7631 3a27 2c20 2073  nt('sconv1:',  s
+00018190: 636f 6e76 315f 6f75 742e 7368 6170 6529  conv1_out.shape)
+000181a0: 0d0a 0d0a 2020 2020 2020 2020 706f 6f6c  ....        pool
+000181b0: 3120 3d20 5465 6d70 506f 6f6c 696e 6728  1 = TempPooling(
+000181c0: 706f 6f6c 696e 673d 7365 6c66 2e73 7065  pooling=self.spe
+000181d0: 6373 5b27 706f 6f6c 696e 6727 5d2c 0d0a  cs['pooling'],..
+000181e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018200: 2020 706f 6f6c 5f74 7970 653d 2261 7667    pool_type="avg
+00018210: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
 00018220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018230: 2020 2020 2020 206b 6572 6e65 6c5f 7369         kernel_si
-00018240: 7a65 3d28 7365 6c66 2e64 6174 6173 6574  ze=(self.dataset
-00018250: 2e68 5f70 6172 616d 735b 276e 5f63 6827  .h_params['n_ch'
-00018260: 5d2c 2031 292c 0d0a 2020 2020 2020 2020  ], 1),..        
-00018270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018280: 7374 7269 6465 733d 312c 0d0a 2020 2020  strides=1,..    
+00018230: 2020 2020 2020 7374 7269 6465 3d73 656c        stride=sel
+00018240: 662e 7370 6563 735b 2773 7472 6964 6527  f.specs['stride'
+00018250: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00018260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018270: 2020 2020 2020 7061 6464 696e 673d 2753        padding='S
+00018280: 414d 4527 2c0d 0a20 2020 2020 2020 2020  AME',..         
 00018290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000182a0: 2020 2020 7061 6464 696e 673d 2256 414c      padding="VAL
-000182b0: 4944 222c 0d0a 2020 2020 2020 2020 2020  ID",..          
-000182c0: 2020 2020 2020 2020 2020 2020 2020 6163                ac
-000182d0: 7469 7661 7469 6f6e 203d 2074 662e 7371  tivation = tf.sq
-000182e0: 7561 7265 2c0d 0a20 2020 2020 2020 2020  uare,..         
-000182f0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00018300: 6572 6e65 6c5f 696e 6974 6961 6c69 7a65  ernel_initialize
-00018310: 723d 2268 655f 756e 6966 6f72 6d22 2c0d  r="he_uniform",.
-00018320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018330: 2020 2020 2020 2020 2062 6961 735f 696e           bias_in
-00018340: 6974 6961 6c69 7a65 723d 436f 6e73 7461  itializer=Consta
-00018350: 6e74 2830 2e31 292c 0d0a 2020 2020 2020  nt(0.1),..      
-00018360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018370: 2020 6461 7461 5f66 6f72 6d61 743d 2263    data_format="c
-00018380: 6861 6e6e 656c 735f 6c61 7374 222c 0d0a  hannels_last",..
-00018390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183a0: 2020 2020 2020 2020 2364 6174 615f 666f          #data_fo
-000183b0: 726d 6174 3d22 6368 616e 6e65 6c73 5f66  rmat="channels_f
-000183c0: 6972 7374 222c 0d0a 2020 2020 2020 2020  irst",..        
-000183d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183e0: 6b65 726e 656c 5f72 6567 756c 6172 697a  kernel_regulariz
-000183f0: 6572 3d6b 5f72 6567 2e6c 3228 7365 6c66  er=k_reg.l2(self
-00018400: 2e73 7065 6373 5b27 6c32 5f6c 616d 6264  .specs['l2_lambd
-00018410: 6127 5d29 290d 0a0d 0a0d 0a20 2020 2020  a']))......     
-00018420: 2020 2073 636f 6e76 315f 6f75 7420 3d20     sconv1_out = 
-00018430: 7363 6f6e 7631 2874 636f 6e76 315f 6f75  sconv1(tconv1_ou
-00018440: 7429 0d0a 2020 2020 2020 2020 7072 696e  t)..        prin
-00018450: 7428 2773 636f 6e76 313a 272c 2020 7363  t('sconv1:',  sc
-00018460: 6f6e 7631 5f6f 7574 2e73 6861 7065 290d  onv1_out.shape).
-00018470: 0a0d 0a20 2020 2020 2020 2070 6f6f 6c31  ...        pool1
-00018480: 203d 2054 656d 7050 6f6f 6c69 6e67 2870   = TempPooling(p
-00018490: 6f6f 6c69 6e67 3d73 656c 662e 7370 6563  ooling=self.spec
-000184a0: 735b 2770 6f6f 6c69 6e67 275d 2c0d 0a20  s['pooling'],.. 
-000184b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184d0: 2070 6f6f 6c5f 7479 7065 3d22 6176 6722   pool_type="avg"
-000184e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000184f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018500: 2020 2020 2073 7472 6964 653d 7365 6c66       stride=self
-00018510: 2e73 7065 6373 5b27 7374 7269 6465 275d  .specs['stride']
-00018520: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00018530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018540: 2020 2020 2070 6164 6469 6e67 3d27 5341       padding='SA
-00018550: 4d45 272c 0d0a 2020 2020 2020 2020 2020  ME',..          
-00018560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018570: 2020 2020 2020 2020 2928 7363 6f6e 7631          )(sconv1
-00018580: 5f6f 7574 290d 0a0d 0a20 2020 2020 2020  _out)....       
-00018590: 2070 7269 6e74 2827 706f 6f6c 313a 2027   print('pool1: '
-000185a0: 2c20 706f 6f6c 312e 7368 6170 6529 0d0a  , pool1.shape)..
-000185b0: 2020 2020 2020 2020 6663 5f6f 7574 203d          fc_out =
-000185c0: 2046 756c 6c79 436f 6e6e 6563 7465 6428   FullyConnected(
-000185d0: 7369 7a65 3d73 656c 662e 6f75 745f 6469  size=self.out_di
-000185e0: 6d2c 206e 6f6e 6c69 6e3d 7466 2e69 6465  m, nonlin=tf.ide
-000185f0: 6e74 6974 792c 0d0a 2020 2020 2020 2020  ntity,..        
-00018600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018610: 2020 2020 7370 6563 733d 7365 6c66 2e73      specs=self.s
-00018620: 7065 6373 290d 0a20 2020 2020 2020 2079  pecs)..        y
-00018630: 5f70 7265 6420 3d20 6663 5f6f 7574 2874  _pred = fc_out(t
-00018640: 662e 6b65 7261 732e 6261 636b 656e 642e  f.keras.backend.
-00018650: 6c6f 6728 706f 6f6c 3129 290d 0a20 2020  log(pool1))..   
-00018660: 2020 2020 2072 6574 7572 6e20 795f 7072       return y_pr
-00018670: 6564 0d0a 230d 0a23 0d0a 636c 6173 7320  ed..#..#..class 
-00018680: 4c46 4c53 544d 2842 6173 654d 6f64 656c  LFLSTM(BaseModel
-00018690: 293a 0d0a 2020 2020 2320 544f 444f 2120  ):..    # TODO! 
-000186a0: 4761 6269 3a20 6368 6563 6b20 7468 6174  Gabi: check that
-000186b0: 2074 6865 2064 6573 6372 6970 7469 6f6e   the description
-000186c0: 2064 6573 6372 6962 6573 2074 6865 206d   describes the m
-000186d0: 6f64 656c 0d0a 2020 2020 2222 224c 462d  odel..    """LF-
-000186e0: 434e 4e2d 4c53 544d 0d0a 0d0a 2020 2020  CNN-LSTM....    
-000186f0: 466f 7220 6465 7461 696c 7320 7365 6520  For details see 
-00018700: 5b31 5d2e 0d0a 0d0a 2020 2020 5061 7261  [1].....    Para
-00018710: 6d65 7465 7273 0d0a 2020 2020 2d2d 2d2d  meters..    ----
-00018720: 2d2d 2d2d 2d2d 0d0a 2020 2020 6e5f 6c61  ------..    n_la
-00018730: 7465 6e74 203a 2069 6e74 0d0a 2020 2020  tent : int..    
-00018740: 2020 2020 6e75 6d62 6572 206f 6620 6c61      number of la
-00018750: 7465 6e74 2063 6f6d 706f 6e65 6e74 730d  tent components.
-00018760: 0a20 2020 2020 2020 2044 6566 6175 6c74  .        Default
-00018770: 7320 746f 2033 320d 0a0d 0a20 2020 2066  s to 32....    f
-00018780: 696c 7465 725f 6c65 6e67 7468 203a 2069  ilter_length : i
-00018790: 6e74 0d0a 2020 2020 2020 2020 6c65 6e67  nt..        leng
-000187a0: 7468 206f 6620 7370 6174 696f 2d74 656d  th of spatio-tem
-000187b0: 706f 7261 6c20 6b65 726e 656c 7320 696e  poral kernels in
-000187c0: 2074 6865 2074 656d 706f 7261 6c0d 0a20   the temporal.. 
-000187d0: 2020 2020 2020 2063 6f6e 766f 6c75 7469         convoluti
-000187e0: 6f6e 206c 6179 6572 2e20 4465 6661 756c  on layer. Defaul
-000187f0: 7473 2074 6f20 370d 0a0d 0a20 2020 2073  ts to 7....    s
-00018800: 7472 6964 6520 3a20 696e 740d 0a20 2020  tride : int..   
-00018810: 2020 2020 2073 7472 6964 6520 6f66 2074       stride of t
-00018820: 6865 206d 6178 2070 6f6f 6c69 6e67 206c  he max pooling l
-00018830: 6179 6572 2e20 4465 6661 756c 7473 2074  ayer. Defaults t
-00018840: 6f20 310d 0a0d 0a20 2020 2070 6f6f 6c69  o 1....    pooli
-00018850: 6e67 203a 2069 6e74 0d0a 2020 2020 2020  ng : int..      
-00018860: 2020 706f 6f6c 696e 6720 6661 6374 6f72    pooling factor
-00018870: 206f 6620 7468 6520 6d61 7820 706f 6f6c   of the max pool
-00018880: 696e 6720 6c61 7965 722e 2044 6566 6175  ing layer. Defau
-00018890: 6c74 7320 746f 2032 0d0a 0d0a 2020 2020  lts to 2....    
-000188a0: 5265 6665 7265 6e63 6573 0d0a 2020 2020  References..    
-000188b0: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
-000188c0: 2020 2020 5b31 5d20 2049 2e20 5a75 6261      [1]  I. Zuba
-000188d0: 7265 762c 2065 7420 616c 2e2c 2041 6461  rev, et al., Ada
-000188e0: 7074 6976 6520 6e65 7572 616c 206e 6574  ptive neural net
-000188f0: 776f 726b 2063 6c61 7373 6966 6965 7220  work classifier 
-00018900: 666f 720d 0a20 2020 2020 2020 2064 6563  for..        dec
-00018910: 6f64 696e 6720 4d45 4720 7369 676e 616c  oding MEG signal
-00018920: 732e 204e 6575 726f 696d 6167 652e 2028  s. Neuroimage. (
-00018930: 3230 3139 2920 4d61 7920 343b 3139 373a  2019) May 4;197:
-00018940: 3432 352d 3433 340d 0a20 2020 2022 2222  425-434..    """
-00018950: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-00018960: 5f5f 2873 656c 662c 206d 6574 612c 2064  __(self, meta, d
-00018970: 6174 6173 6574 3d4e 6f6e 6529 3a0d 0a20  ataset=None):.. 
-00018980: 2020 2020 2020 2022 2222 0d0a 0d0a 2020         """....  
-00018990: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-000189a0: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-000189b0: 2d2d 2d2d 0d0a 2020 2020 2020 2020 4461  ----..        Da
-000189c0: 7461 7365 7420 3a20 6d6e 6566 6c6f 772e  taset : mneflow.
-000189d0: 4461 7461 7365 740d 0a0d 0a20 2020 2020  Dataset....     
-000189e0: 2020 2073 7065 6373 203a 2064 6963 740d     specs : dict.
-000189f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018a00: 2064 6963 7469 6f6e 6172 7920 6f66 206d   dictionary of m
-00018a10: 6f64 656c 2068 7970 6572 7061 7261 6d65  odel hyperparame
-00018a20: 7465 7273 207b 0d0a 0d0a 2020 2020 2020  ters {....      
-00018a30: 2020 6e5f 6c61 7465 6e74 203a 2069 6e74    n_latent : int
-00018a40: 0d0a 2020 2020 2020 2020 2020 2020 4e75  ..            Nu
-00018a50: 6d62 6572 206f 6620 6c61 7465 6e74 2063  mber of latent c
-00018a60: 6f6d 706f 6e65 6e74 732e 0d0a 2020 2020  omponents...    
-00018a70: 2020 2020 2020 2020 4465 6661 756c 7473          Defaults
-00018a80: 2074 6f20 3332 2e0d 0a0d 0a20 2020 2020   to 32.....     
-00018a90: 2020 206e 6f6e 6c69 6e20 3a20 6361 6c6c     nonlin : call
-00018aa0: 6162 6c65 0d0a 2020 2020 2020 2020 2020  able..          
-00018ab0: 2020 4163 7469 7661 7469 6f6e 2066 756e    Activation fun
-00018ac0: 6374 696f 6e20 6f66 2074 6865 2074 656d  ction of the tem
-00018ad0: 706f 7261 6c20 636f 6e76 6f6c 7574 696f  poral convolutio
-00018ae0: 6e20 6c61 7965 722e 0d0a 2020 2020 2020  n layer...      
-00018af0: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
-00018b00: 6f20 7466 2e6e 6e2e 7265 6c75 0d0a 0d0a  o tf.nn.relu....
-00018b10: 2020 2020 2020 2020 6669 6c74 6572 5f6c          filter_l
-00018b20: 656e 6774 6820 3a20 696e 740d 0a20 2020  ength : int..   
-00018b30: 2020 2020 2020 2020 204c 656e 6774 6820           Length 
-00018b40: 6f66 2073 7061 7469 6f2d 7465 6d70 6f72  of spatio-tempor
-00018b50: 616c 206b 6572 6e65 6c73 2069 6e20 7468  al kernels in th
-00018b60: 6520 7465 6d70 6f72 616c 0d0a 2020 2020  e temporal..    
-00018b70: 2020 2020 2020 2020 636f 6e76 6f6c 7574          convolut
-00018b80: 696f 6e20 6c61 7965 722e 2044 6566 6175  ion layer. Defau
-00018b90: 6c74 7320 746f 2037 2e0d 0a0d 0a20 2020  lts to 7.....   
-00018ba0: 2020 2020 2070 6f6f 6c69 6e67 203a 2069       pooling : i
-00018bb0: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
-00018bc0: 506f 6f6c 696e 6720 6661 6374 6f72 206f  Pooling factor o
-00018bd0: 6620 7468 6520 6d61 7820 706f 6f6c 696e  f the max poolin
-00018be0: 6720 6c61 7965 722e 2044 6566 6175 6c74  g layer. Default
-00018bf0: 7320 746f 2032 0d0a 0d0a 2020 2020 2020  s to 2....      
-00018c00: 2020 706f 6f6c 5f74 7970 6520 3a20 7374    pool_type : st
-00018c10: 7220 7b27 6176 6727 2c20 276d 6178 277d  r {'avg', 'max'}
-00018c20: 0d0a 2020 2020 2020 2020 2020 2020 5479  ..            Ty
-00018c30: 7065 206f 6620 706f 6f6c 696e 6720 6f70  pe of pooling op
-00018c40: 6572 6174 696f 6e2e 2044 6566 6175 6c74  eration. Default
-00018c50: 7320 746f 2027 6d61 7827 2e0d 0a0d 0a20  s to 'max'..... 
-00018c60: 2020 2020 2020 2070 6164 6469 6e67 203a         padding :
-00018c70: 2073 7472 207b 2753 414d 4527 2c20 2746   str {'SAME', 'F
-00018c80: 554c 4c27 2c20 2756 414c 4944 277d 0d0a  ULL', 'VALID'}..
-00018c90: 2020 2020 2020 2020 2020 2020 436f 6e76              Conv
-00018ca0: 6f6c 7574 696f 6e20 7061 6464 696e 672e  olution padding.
-00018cb0: 2044 6566 6175 6c74 7320 746f 2027 5341   Defaults to 'SA
-00018cc0: 4d45 272e 7d0d 0a0d 0a20 2020 2020 2020  ME'.}....       
-00018cd0: 2073 7472 6964 6520 3a20 696e 740d 0a20   stride : int.. 
-00018ce0: 2020 2020 2020 2053 7472 6964 6520 6f66         Stride of
-00018cf0: 2074 6865 206d 6178 2070 6f6f 6c69 6e67   the max pooling
-00018d00: 206c 6179 6572 2e20 4465 6661 756c 7473   layer. Defaults
-00018d10: 2074 6f20 312e 0d0a 2020 2020 2020 2020   to 1...        
-00018d20: 2222 220d 0a20 2020 2020 2020 2023 7365  """..        #se
-00018d30: 6c66 2e73 636f 7065 203d 2027 6c66 6c73  lf.scope = 'lfls
-00018d40: 746d 270d 0a20 2020 2020 2020 2073 656c  tm'..        sel
-00018d50: 662e 7363 6f70 6520 3d20 276c 662d 636e  f.scope = 'lf-cn
-00018d60: 6e2d 6c73 746d 270d 0a20 2020 2020 2020  n-lstm'..       
-00018d70: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
-00018d80: 732e 7365 7464 6566 6175 6c74 2827 6669  s.setdefault('fi
-00018d90: 6c74 6572 5f6c 656e 6774 6827 2c20 3729  lter_length', 7)
-00018da0: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
-00018db0: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
-00018dc0: 6661 756c 7428 276e 5f6c 6174 656e 7427  fault('n_latent'
-00018dd0: 2c20 3332 290d 0a20 2020 2020 2020 206d  , 32)..        m
-00018de0: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
-00018df0: 7365 7464 6566 6175 6c74 2827 706f 6f6c  setdefault('pool
-00018e00: 696e 6727 2c20 3229 0d0a 2020 2020 2020  ing', 2)..      
-00018e10: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
-00018e20: 6373 2e73 6574 6465 6661 756c 7428 2773  cs.setdefault('s
-00018e30: 7472 6964 6527 2c20 3229 0d0a 2020 2020  tride', 2)..    
-00018e40: 2020 2020 6d65 7461 2e6d 6f64 656c 5f73      meta.model_s
-00018e50: 7065 6373 2e73 6574 6465 6661 756c 7428  pecs.setdefault(
-00018e60: 2770 6164 6469 6e67 272c 2027 5341 4d45  'padding', 'SAME
-00018e70: 2729 0d0a 2020 2020 2020 2020 6d65 7461  ')..        meta
-00018e80: 2e6d 6f64 656c 5f73 7065 6373 2e73 6574  .model_specs.set
-00018e90: 6465 6661 756c 7428 2770 6f6f 6c5f 7479  default('pool_ty
-00018ea0: 7065 272c 2027 6d61 7827 290d 0a20 2020  pe', 'max')..   
-00018eb0: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
-00018ec0: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
-00018ed0: 2827 6e6f 6e6c 696e 272c 2074 662e 6e6e  ('nonlin', tf.nn
-00018ee0: 2e72 656c 7529 0d0a 2020 2020 2020 2020  .relu)..        
-00018ef0: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
-00018f00: 2e73 6574 6465 6661 756c 7428 276c 315f  .setdefault('l1_
-00018f10: 6c61 6d62 6461 272c 2030 2e29 0d0a 2020  lambda', 0.)..  
-00018f20: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
-00018f30: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
-00018f40: 7428 276c 325f 6c61 6d62 6461 272c 2030  t('l2_lambda', 0
-00018f50: 2e29 0d0a 2020 2020 2020 2020 6d65 7461  .)..        meta
-00018f60: 2e6d 6f64 656c 5f73 7065 6373 2e73 6574  .model_specs.set
-00018f70: 6465 6661 756c 7428 276c 315f 7363 6f70  default('l1_scop
-00018f80: 6527 2c20 5b5d 290d 0a20 2020 2020 2020  e', [])..       
-00018f90: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
-00018fa0: 732e 7365 7464 6566 6175 6c74 2827 6c32  s.setdefault('l2
-00018fb0: 5f73 636f 7065 272c 205b 5d29 0d0a 2020  _scope', [])..  
-00018fc0: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
-00018fd0: 5f73 7065 6373 5b27 7363 6f70 6527 5d20  _specs['scope'] 
-00018fe0: 3d20 7365 6c66 2e73 636f 7065 0d0a 2020  = self.scope..  
-00018ff0: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
-00019000: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
-00019010: 7428 2775 6e69 746e 6f72 6d5f 7363 6f70  t('unitnorm_scop
-00019020: 6527 2c20 5b5d 290d 0a20 2020 2020 2020  e', [])..       
-00019030: 2023 7370 6563 732e 7365 7464 6566 6175   #specs.setdefau
-00019040: 6c74 2827 6d6f 6465 6c5f 7061 7468 272c  lt('model_path',
-00019050: 2020 7365 6c66 2e64 6174 6173 6574 2e68    self.dataset.h
-00019060: 5f70 6172 616d 735b 2773 6176 655f 7061  _params['save_pa
-00019070: 7468 275d 290d 0a20 2020 2020 2020 2073  th'])..        s
-00019080: 7570 6572 284c 464c 5354 4d2c 2073 656c  uper(LFLSTM, sel
-00019090: 6629 2e5f 5f69 6e69 745f 5f28 6d65 7461  f).__init__(meta
-000190a0: 2c20 6461 7461 7365 7429 0d0a 0d0a 0d0a  , dataset)......
-000190b0: 2020 2020 6465 6620 6275 696c 645f 6772      def build_gr
-000190c0: 6170 6828 7365 6c66 293a 0d0a 2020 2020  aph(self):..    
-000190d0: 2020 2020 0d0a 2020 2020 2020 2020 7365      ..        se
-000190e0: 6c66 2e72 6574 7572 6e5f 7365 7175 656e  lf.return_sequen
-000190f0: 6365 203d 2054 7275 650d 0a20 2020 2020  ce = True..     
-00019100: 2020 2073 656c 662e 646d 7820 3d20 4465     self.dmx = De
-00019110: 4d69 7869 6e67 2873 697a 653d 7365 6c66  Mixing(size=self
-00019120: 2e73 7065 6373 5b27 6e5f 6c61 7465 6e74  .specs['n_latent
-00019130: 275d 2c20 6e6f 6e6c 696e 3d74 662e 6964  '], nonlin=tf.id
-00019140: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
-00019150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019160: 2020 2020 2061 7869 733d 332c 2073 7065       axis=3, spe
-00019170: 6373 3d73 656c 662e 7370 6563 7329 0d0a  cs=self.specs)..
-00019180: 2020 2020 2020 2020 646d 7820 3d20 7365          dmx = se
-00019190: 6c66 2e64 6d78 2873 656c 662e 696e 7075  lf.dmx(self.inpu
-000191a0: 7473 290d 0a20 2020 2020 2020 2023 646d  ts)..        #dm
-000191b0: 7820 3d20 7466 2e72 6573 6861 7065 2864  x = tf.reshape(d
-000191c0: 6d78 2c20 5b2d 312c 2073 656c 662e 6461  mx, [-1, self.da
-000191d0: 7461 7365 742e 685f 7061 7261 6d73 5b27  taset.h_params['
-000191e0: 6e5f 7427 5d2c 0d0a 2020 2020 2020 2020  n_t'],..        
-000191f0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00019200: 2020 2020 2020 2020 7365 6c66 2e73 7065          self.spe
-00019210: 6373 5b27 6e5f 6c61 7465 6e74 275d 5d29  cs['n_latent']])
-00019220: 0d0a 2020 2020 2020 2020 2364 6d78 203d  ..        #dmx =
-00019230: 2074 662e 6578 7061 6e64 5f64 696d 7328   tf.expand_dims(
-00019240: 646d 782c 202d 3129 0d0a 2020 2020 2020  dmx, -1)..      
-00019250: 2020 7072 696e 7428 2764 6d78 2d73 716f    print('dmx-sqo
-00019260: 7574 3a27 2c20 646d 782e 7368 6170 6529  ut:', dmx.shape)
-00019270: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00019280: 2e74 636f 6e76 3120 3d20 4c46 5443 6f6e  .tconv1 = LFTCon
-00019290: 7628 7363 6f70 653d 2263 6f6e 7622 2c0d  v(scope="conv",.
-000192a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000192b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000192c0: 697a 653d 7365 6c66 2e73 7065 6373 5b27  ize=self.specs['
-000192d0: 6e5f 6c61 7465 6e74 275d 2c0d 0a20 2020  n_latent'],..   
-000192e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192f0: 2020 2020 2020 2020 2020 206e 6f6e 6c69             nonli
-00019300: 6e3d 7466 2e6e 6e2e 7265 6c75 2c0d 0a20  n=tf.nn.relu,.. 
-00019310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019320: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00019330: 7465 725f 6c65 6e67 7468 3d73 656c 662e  ter_length=self.
-00019340: 7370 6563 735b 2766 696c 7465 725f 6c65  specs['filter_le
-00019350: 6e67 7468 275d 2c0d 0a23 2020 2020 2020  ngth'],..#      
-00019360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019370: 2020 2020 2020 2020 7374 7269 6465 3d73          stride=s
-00019380: 656c 662e 7370 6563 735b 2773 7472 6964  elf.specs['strid
-00019390: 6527 5d2c 0d0a 2320 2020 2020 2020 2020  e'],..#         
-000193a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193b0: 2020 2020 2070 6f6f 6c69 6e67 3d73 656c       pooling=sel
-000193c0: 662e 7370 6563 735b 2770 6f6f 6c69 6e67  f.specs['pooling
-000193d0: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
-000193e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193f0: 2020 2070 6164 6469 6e67 3d73 656c 662e     padding=self.
-00019400: 7370 6563 735b 2770 6164 6469 6e67 275d  specs['padding']
-00019410: 290d 0a0d 0a20 2020 2020 2020 2066 6561  )....        fea
-00019420: 7475 7265 7320 3d20 7365 6c66 2e74 636f  tures = self.tco
-00019430: 6e76 3128 646d 7829 0d0a 2020 2020 2020  nv1(dmx)..      
-00019440: 2020 706f 6f6c 3120 3d20 5465 6d70 506f    pool1 = TempPo
-00019450: 6f6c 696e 6728 7374 7269 6465 3d73 656c  oling(stride=sel
-00019460: 662e 7370 6563 735b 2773 7472 6964 6527  f.specs['stride'
-00019470: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00019480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019490: 706f 6f6c 696e 673d 7365 6c66 2e73 7065  pooling=self.spe
-000194a0: 6373 5b27 706f 6f6c 696e 6727 5d2c 0d0a  cs['pooling'],..
-000194b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194c0: 2020 2020 2020 2020 2020 2020 7061 6464              padd
-000194d0: 696e 673d 2753 414d 4527 2c0d 0a20 2020  ing='SAME',..   
-000194e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194f0: 2020 2020 2020 2020 2070 6f6f 6c5f 7479           pool_ty
-00019500: 7065 3d27 6d61 7827 290d 0a0d 0a0d 0a20  pe='max')...... 
-00019510: 2020 2020 2020 2070 6f6f 6c65 6420 3d20         pooled = 
-00019520: 706f 6f6c 3128 6665 6174 7572 6573 290d  pool1(features).
-00019530: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00019540: 6665 6174 7572 6573 3a27 2c20 706f 6f6c  features:', pool
-00019550: 6564 2e73 6861 7065 290d 0a0d 0a20 2020  ed.shape)....   
-00019560: 2020 2020 2066 7368 6170 6520 3d20 7466       fshape = tf
-00019570: 2e6d 756c 7469 706c 7928 706f 6f6c 6564  .multiply(pooled
-00019580: 2e73 6861 7065 5b32 5d2c 2070 6f6f 6c65  .shape[2], poole
-00019590: 642e 7368 6170 655b 335d 290d 0a0d 0a20  d.shape[3]).... 
-000195a0: 2020 2020 2020 2066 6665 6174 7572 6573         ffeatures
-000195b0: 203d 2074 662e 7265 7368 6170 6528 706f   = tf.reshape(po
-000195c0: 6f6c 6564 2c0d 0a20 2020 2020 2020 2020  oled,..         
-000195d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195e0: 2020 2020 205b 2d31 2c20 7365 6c66 2e64       [-1, self.d
-000195f0: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
-00019600: 276e 5f73 6571 275d 2c20 6673 6861 7065  'n_seq'], fshape
-00019610: 5d29 0d0a 2020 2020 2020 2020 2320 2066  ])..        #  f
-00019620: 6561 7475 7265 7320 3d20 7466 2e65 7870  eatures = tf.exp
-00019630: 616e 645f 6469 6d73 2866 6561 7475 7265  and_dims(feature
-00019640: 732c 2030 290d 0a20 2020 2020 2020 2023  s, 0)..        #
-00019650: 6c31 5f6c 616d 6264 6120 3d20 7365 6c66  l1_lambda = self
-00019660: 2e6f 7074 696d 697a 6572 2e70 6172 616d  .optimizer.param
-00019670: 735b 276c 315f 6c61 6d62 6461 275d 0d0a  s['l1_lambda']..
-00019680: 2020 2020 2020 2020 7072 696e 7428 2766          print('f
-00019690: 6c61 7420 6665 6174 7572 6573 3a27 2c20  lat features:', 
-000196a0: 6666 6561 7475 7265 732e 7368 6170 6529  ffeatures.shape)
-000196b0: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
-000196c0: 7374 6d20 3d20 4c53 544d 2873 636f 7065  stm = LSTM(scope
-000196d0: 3d22 6c73 746d 222c 0d0a 2020 2020 2020  ="lstm",..      
-000196e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196f0: 2020 2020 2073 697a 653d 7365 6c66 2e73       size=self.s
-00019700: 7065 6373 5b27 6e5f 6c61 7465 6e74 275d  pecs['n_latent']
-00019710: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00019720: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-00019730: 726e 656c 5f69 6e69 7469 616c 697a 6572  rnel_initializer
-00019740: 3d27 676c 6f72 6f74 5f75 6e69 666f 726d  ='glorot_uniform
-00019750: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-00019760: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00019770: 6563 7572 7265 6e74 5f69 6e69 7469 616c  ecurrent_initial
-00019780: 697a 6572 3d27 6f72 7468 6f67 6f6e 616c  izer='orthogonal
-00019790: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-000197a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000197b0: 6563 7572 7265 6e74 5f72 6567 756c 6172  ecurrent_regular
-000197c0: 697a 6572 3d6b 5f72 6567 2e6c 3128 7365  izer=k_reg.l1(se
-000197d0: 6c66 2e73 7065 6373 5b27 6c31 5f6c 616d  lf.specs['l1_lam
-000197e0: 6264 6127 5d29 2c0d 0a20 2020 2020 2020  bda']),..       
-000197f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019800: 2020 2020 6b65 726e 656c 5f72 6567 756c      kernel_regul
-00019810: 6172 697a 6572 3d6b 5f72 6567 2e6c 3228  arizer=k_reg.l2(
-00019820: 7365 6c66 2e73 7065 6373 5b27 6c32 5f6c  self.specs['l2_l
-00019830: 616d 6264 6127 5d29 2c0d 0a20 2020 2020  ambda']),..     
-00019840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019850: 2020 2020 2020 6269 6173 5f72 6567 756c        bias_regul
-00019860: 6172 697a 6572 3d4e 6f6e 652c 0d0a 2020  arizer=None,..  
-00019870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019880: 2020 2020 2020 2020 2023 2061 6374 6976           # activ
-00019890: 6974 795f 7265 6775 6c61 7269 7a65 723d  ity_regularizer=
-000198a0: 2072 6567 756c 6172 697a 6572 732e 6c31   regularizers.l1
-000198b0: 2830 2e30 3129 2c0d 0a20 2020 2020 2020  (0.01),..       
-000198c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198d0: 2020 2020 2320 6b65 726e 656c 5f63 6f6e      # kernel_con
-000198e0: 7374 7261 696e 743d 2063 6f6e 7374 7261  straint= constra
-000198f0: 696e 7473 2e55 6e69 744e 6f72 6d28 6178  ints.UnitNorm(ax
-00019900: 6973 3d30 292c 0d0a 2020 2020 2020 2020  is=0),..        
-00019910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019920: 2020 2023 2072 6563 7572 7265 6e74 5f63     # recurrent_c
-00019930: 6f6e 7374 7261 696e 743d 2063 6f6e 7374  onstraint= const
-00019940: 7261 696e 7473 2e4e 6f6e 4e65 6728 292c  raints.NonNeg(),
-00019950: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00019960: 2020 2020 2020 2020 2020 2020 2023 2062               # b
-00019970: 6961 735f 636f 6e73 7472 6169 6e74 3d4e  ias_constraint=N
-00019980: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
-00019990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000199a0: 2064 726f 706f 7574 3d30 2e31 2c20 7265   dropout=0.1, re
-000199b0: 6375 7272 656e 745f 6472 6f70 6f75 743d  current_dropout=
-000199c0: 302e 312c 0d0a 2020 2020 2020 2020 2020  0.1,..          
-000199d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000199e0: 206e 6f6e 6c69 6e3d 7466 2e69 6465 6e74   nonlin=tf.ident
-000199f0: 6974 792c 0d0a 2020 2020 2020 2020 2020  ity,..          
-00019a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019a10: 2075 6e69 745f 666f 7267 6574 5f62 6961   unit_forget_bia
-00019a20: 733d 4661 6c73 652c 0d0a 2020 2020 2020  s=False,..      
-00019a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019a40: 2020 2020 2072 6574 7572 6e5f 7365 7175       return_sequ
-00019a50: 656e 6365 733d 7365 6c66 2e72 6574 7572  ences=self.retur
-00019a60: 6e5f 7365 7175 656e 6365 2c0d 0a20 2020  n_sequence,..   
-00019a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019a80: 2020 2020 2020 2020 756e 726f 6c6c 3d46          unroll=F
-00019a90: 616c 7365 290d 0a0d 0a20 2020 2020 2020  alse)....       
-00019aa0: 2073 656c 662e 6c73 746d 5f6f 7574 203d   self.lstm_out =
-00019ab0: 2073 656c 662e 6c73 746d 2866 6665 6174   self.lstm(ffeat
-00019ac0: 7572 6573 290d 0a20 2020 2020 2020 2070  ures)..        p
-00019ad0: 7269 6e74 2827 6c73 746d 5f6f 7574 3a27  rint('lstm_out:'
-00019ae0: 2c20 7365 6c66 2e6c 7374 6d5f 6f75 742e  , self.lstm_out.
-00019af0: 7368 6170 6529 0d0a 0d0a 2020 2020 2020  shape)....      
-00019b00: 2020 6966 2073 656c 662e 7265 7475 726e    if self.return
-00019b10: 5f73 6571 7565 6e63 6520 3d3d 2054 7275  _sequence == Tru
-00019b20: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00019b30: 7365 6c66 2e66 696e 5f66 6320 3d20 4465  self.fin_fc = De
-00019b40: 4d69 7869 6e67 2873 697a 653d 7365 6c66  Mixing(size=self
-00019b50: 2e6f 7574 5f64 696d 2c0d 0a20 2020 2020  .out_dim,..     
-00019b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019b70: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-00019b80: 6e6c 696e 3d74 662e 6964 656e 7469 7479  nlin=tf.identity
-00019b90: 2c20 6178 6973 3d32 290d 0a20 2020 2020  , axis=2)..     
-00019ba0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00019bb0: 2020 2020 2020 7365 6c66 2e66 696e 5f66        self.fin_f
-00019bc0: 6320 3d20 4675 6c6c 7943 6f6e 6e65 6374  c = FullyConnect
-00019bd0: 6564 2873 697a 653d 7365 6c66 2e6f 7574  ed(size=self.out
-00019be0: 5f64 696d 2c20 6e6f 6e6c 696e 3d74 662e  _dim, nonlin=tf.
-00019bf0: 6964 656e 7469 7479 2c0d 0a20 2020 2020  identity,..     
-00019c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c10: 2020 2020 2020 2020 2020 2073 7065 6373             specs
-00019c20: 3d73 656c 662e 7370 6563 7329 0d0a 2020  =self.specs)..  
-00019c30: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-00019c40: 2020 2020 795f 7072 6564 203d 2073 656c      y_pred = sel
-00019c50: 662e 6669 6e5f 6663 2873 656c 662e 6c73  f.fin_fc(self.ls
-00019c60: 746d 5f6f 7574 290d 0a20 2020 2020 2020  tm_out)..       
-00019c70: 2070 7269 6e74 2822 6669 6e20 6663 206f   print("fin fc o
-00019c80: 7574 3a22 2c20 795f 7072 6564 2e73 6861  ut:", y_pred.sha
-00019c90: 7065 290d 0a20 2020 2020 2020 2072 6574  pe)..        ret
-00019ca0: 7572 6e20 795f 7072 6564 0d0a 230d 0a23  urn y_pred..#..#
-00019cb0: 0d0a 0d0a 0d0a 636c 6173 7320 4465 6570  ......class Deep
-00019cc0: 3428 4261 7365 4d6f 6465 6c29 3a0d 0a20  4(BaseModel):.. 
-00019cd0: 2020 2022 2222 0d0a 2020 2020 4465 6570     """..    Deep
-00019ce0: 2043 6f6e 764e 6574 206d 6f64 656c 2066   ConvNet model f
-00019cf0: 726f 6d20 5b32 625d 5f2e 0d0a 2020 2020  rom [2b]_...    
-00019d00: 5265 6665 7265 6e63 6573 0d0a 2020 2020  References..    
-00019d10: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
-00019d20: 2e2e 205b 3262 5d20 5363 6869 7272 6d65  .. [2b] Schirrme
-00019d30: 6973 7465 722c 2052 2e20 542e 2c20 5370  ister, R. T., Sp
-00019d40: 7269 6e67 656e 6265 7267 2c20 4a2e 2054  ringenberg, J. T
-00019d50: 2e2c 2046 6965 6465 7265 722c 204c 2e20  ., Fiederer, L. 
-00019d60: 442e 204a 2e2c 0d0a 2020 2020 2020 2047  D. J.,..       G
-00019d70: 6c61 7373 7465 7474 6572 2c20 4d2e 2c20  lasstetter, M., 
-00019d80: 4567 6765 6e73 7065 7267 6572 2c20 4b2e  Eggensperger, K.
-00019d90: 2c20 5461 6e67 6572 6d61 6e6e 2c20 4d2e  , Tangermann, M.
-00019da0: 2c20 4875 7474 6572 2c20 462e 2026 2042  , Hutter, F. & B
-00019db0: 616c 6c2c 2054 2e20 2832 3031 3729 2e0d  all, T. (2017)..
-00019dc0: 0a20 2020 2020 2020 4465 6570 206c 6561  .       Deep lea
-00019dd0: 726e 696e 6720 7769 7468 2063 6f6e 766f  rning with convo
-00019de0: 6c75 7469 6f6e 616c 206e 6575 7261 6c20  lutional neural 
-00019df0: 6e65 7477 6f72 6b73 2066 6f72 2045 4547  networks for EEG
-00019e00: 2064 6563 6f64 696e 6720 616e 640d 0a20   decoding and.. 
-00019e10: 2020 2020 2020 7669 7375 616c 697a 6174        visualizat
-00019e20: 696f 6e2e 0d0a 2020 2020 2020 2048 756d  ion...       Hum
-00019e30: 616e 2042 7261 696e 204d 6170 7069 6e67  an Brain Mapping
-00019e40: 202c 2041 7567 2e20 3230 3137 2e20 4f6e   , Aug. 2017. On
-00019e50: 6c69 6e65 3a20 6874 7470 3a2f 2f64 782e  line: http://dx.
-00019e60: 646f 692e 6f72 672f 3130 2e31 3030 322f  doi.org/10.1002/
-00019e70: 6862 6d2e 3233 3733 300d 0a20 2020 2022  hbm.23730..    "
-00019e80: 2222 0d0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
-00019e90: 6974 5f5f 2873 656c 662c 206d 6574 612c  it__(self, meta,
-00019ea0: 2064 6174 6173 6574 3d4e 6f6e 6529 3a0d   dataset=None):.
-00019eb0: 0a20 2020 2020 2020 2073 656c 662e 7363  .        self.sc
-00019ec0: 6f70 6520 3d20 2764 6565 7034 270d 0a20  ope = 'deep4'.. 
-00019ed0: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
-00019ee0: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
-00019ef0: 6c74 2827 6669 6c74 6572 5f6c 656e 6774  lt('filter_lengt
-00019f00: 6827 2c20 3130 290d 0a20 2020 2020 2020  h', 10)..       
-00019f10: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
-00019f20: 732e 7365 7464 6566 6175 6c74 2827 6e5f  s.setdefault('n_
-00019f30: 6c61 7465 6e74 272c 2032 3529 0d0a 2020  latent', 25)..  
-00019f40: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
-00019f50: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
-00019f60: 7428 2770 6f6f 6c69 6e67 272c 2033 290d  t('pooling', 3).
-00019f70: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
-00019f80: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
-00019f90: 6175 6c74 2827 7374 7269 6465 272c 2033  ault('stride', 3
-00019fa0: 290d 0a20 2020 2020 2020 206d 6574 612e  )..        meta.
-00019fb0: 6d6f 6465 6c5f 7370 6563 732e 7365 7464  model_specs.setd
-00019fc0: 6566 6175 6c74 2827 706f 6f6c 5f74 7970  efault('pool_typ
-00019fd0: 6527 2c20 276d 6178 2729 0d0a 2020 2020  e', 'max')..    
-00019fe0: 2020 2020 6d65 7461 2e6d 6f64 656c 5f73      meta.model_s
-00019ff0: 7065 6373 2e73 6574 6465 6661 756c 7428  pecs.setdefault(
-0001a000: 2770 6164 6469 6e67 272c 2027 5341 4d45  'padding', 'SAME
-0001a010: 2729 0d0a 2020 2020 2020 2020 6d65 7461  ')..        meta
-0001a020: 2e6d 6f64 656c 5f73 7065 6373 2e73 6574  .model_specs.set
-0001a030: 6465 6661 756c 7428 276e 6f6e 6c69 6e27  default('nonlin'
-0001a040: 2c20 7466 2e6e 6e2e 656c 7529 0d0a 2020  , tf.nn.elu)..  
-0001a050: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
-0001a060: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
-0001a070: 7428 276c 315f 6c61 6d62 6461 272c 2030  t('l1_lambda', 0
-0001a080: 290d 0a20 2020 2020 2020 206d 6574 612e  )..        meta.
-0001a090: 6d6f 6465 6c5f 7370 6563 732e 7365 7464  model_specs.setd
-0001a0a0: 6566 6175 6c74 2827 6c32 5f6c 616d 6264  efault('l2_lambd
-0001a0b0: 6127 2c20 3029 0d0a 2020 2020 2020 2020  a', 0)..        
-0001a0c0: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
-0001a0d0: 2e73 6574 6465 6661 756c 7428 276c 315f  .setdefault('l1_
-0001a0e0: 7363 6f70 6527 2c20 5b5d 290d 0a20 2020  scope', [])..   
-0001a0f0: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
-0001a100: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
-0001a110: 2827 6c32 5f73 636f 7065 272c 205b 5d29  ('l2_scope', [])
-0001a120: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
-0001a130: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
-0001a140: 6661 756c 7428 2775 6e69 746e 6f72 6d5f  fault('unitnorm_
-0001a150: 7363 6f70 6527 2c20 5b5d 290d 0a20 2020  scope', [])..   
-0001a160: 2020 2020 2023 7370 6563 732e 7365 7464       #specs.setd
-0001a170: 6566 6175 6c74 2827 6d6f 6465 6c5f 7061  efault('model_pa
-0001a180: 7468 272c 206f 732e 7061 7468 2e6a 6f69  th', os.path.joi
-0001a190: 6e28 7365 6c66 2e64 6174 6173 6574 2e68  n(self.dataset.h
-0001a1a0: 5f70 6172 616d 735b 2770 6174 6827 5d2c  _params['path'],
-0001a1b0: 2027 6d6f 6465 6c73 2729 290d 0a20 2020   'models'))..   
-0001a1c0: 2020 2020 2073 7570 6572 2844 6565 7034       super(Deep4
-0001a1d0: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
-0001a1e0: 286d 6574 612c 2064 6174 6173 6574 290d  (meta, dataset).
-0001a1f0: 0a0d 0a20 2020 2064 6566 2062 7569 6c64  ...    def build
-0001a200: 5f67 7261 7068 2873 656c 6629 3a0d 0a20  _graph(self):.. 
-0001a210: 2020 2020 2020 2073 656c 662e 7363 6f70         self.scop
-0001a220: 6520 3d20 2764 6565 7034 270d 0a0d 0a20  e = 'deep4'.... 
-0001a230: 2020 2020 2020 2069 6e70 7574 7320 3d20         inputs = 
-0001a240: 7466 2e74 7261 6e73 706f 7365 2873 656c  tf.transpose(sel
-0001a250: 662e 696e 7075 7473 2c5b 302c 332c 322c  f.inputs,[0,3,2,
-0001a260: 315d 290d 0a0d 0a20 2020 2020 2020 2074  1])....        t
-0001a270: 636f 6e76 3120 3d20 4465 7074 6877 6973  conv1 = Depthwis
-0001a280: 6543 6f6e 7632 4428 0d0a 2020 2020 2020  eConv2D(..      
-0001a290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a2a0: 2020 6b65 726e 656c 5f73 697a 653d 2831    kernel_size=(1
-0001a2b0: 2c20 7365 6c66 2e73 7065 6373 5b27 6669  , self.specs['fi
-0001a2c0: 6c74 6572 5f6c 656e 6774 6827 5d29 2c0d  lter_length']),.
-0001a2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a2e0: 2020 2020 2020 2020 2064 6570 7468 5f6d           depth_m
-0001a2f0: 756c 7469 706c 6965 7220 3d20 7365 6c66  ultiplier = self
-0001a300: 2e73 7065 6373 5b27 6e5f 6c61 7465 6e74  .specs['n_latent
-0001a310: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
-0001a320: 2020 2020 2020 2020 2020 2020 2073 7472               str
-0001a330: 6964 6573 3d31 2c0d 0a20 2020 2020 2020  ides=1,..       
-0001a340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a350: 2070 6164 6469 6e67 3d73 656c 662e 7370   padding=self.sp
-0001a360: 6563 735b 2770 6164 6469 6e67 275d 2c0d  ecs['padding'],.
-0001a370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a380: 2020 2020 2020 2020 2061 6374 6976 6174           activat
-0001a390: 696f 6e20 3d20 7466 2e69 6465 6e74 6974  ion = tf.identit
-0001a3a0: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
-0001a3b0: 2020 2020 2020 2020 2020 2020 6b65 726e              kern
-0001a3c0: 656c 5f69 6e69 7469 616c 697a 6572 3d22  el_initializer="
-0001a3d0: 6865 5f75 6e69 666f 726d 222c 0d0a 2020  he_uniform",..  
-0001a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a3f0: 2020 2020 2020 6269 6173 5f69 6e69 7469        bias_initi
-0001a400: 616c 697a 6572 3d43 6f6e 7374 616e 7428  alizer=Constant(
-0001a410: 302e 3129 2c0d 0a20 2020 2020 2020 2020  0.1),..         
-0001a420: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001a430: 6174 615f 666f 726d 6174 3d22 6368 616e  ata_format="chan
-0001a440: 6e65 6c73 5f6c 6173 7422 2c0d 0a20 2020  nels_last",..   
-0001a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a460: 2020 2020 206b 6572 6e65 6c5f 7265 6775       kernel_regu
-0001a470: 6c61 7269 7a65 723d 6b5f 7265 672e 6c32  larizer=k_reg.l2
-0001a480: 2873 656c 662e 7370 6563 735b 276c 325f  (self.specs['l2_
-0001a490: 6c61 6d62 6461 275d 290d 0a20 2020 2020  lambda'])..     
-0001a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a4b0: 2020 2023 6b65 726e 656c 5f63 6f6e 7374     #kernel_const
-0001a4c0: 7261 696e 743d 226d 6178 6e6f 726d 220d  raint="maxnorm".
-0001a4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a4e0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-0001a4f0: 2020 2020 7463 6f6e 7631 5f6f 7574 203d      tconv1_out =
-0001a500: 2074 636f 6e76 3128 696e 7075 7473 290d   tconv1(inputs).
-0001a510: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-0001a520: 7463 6f6e 7631 3a20 272c 2074 636f 6e76  tconv1: ', tconv
-0001a530: 315f 6f75 742e 7368 6170 6529 2023 7368  1_out.shape) #sh
-0001a540: 6f75 6c64 2062 6520 6e5f 6261 7463 682c  ould be n_batch,
-0001a550: 2073 656e 736f 7273 2c20 7469 6d65 732c   sensors, times,
-0001a560: 206b 6572 6e65 6c73 0d0a 0d0a 2020 2020   kernels....    
-0001a570: 2020 2020 7363 6f6e 7631 203d 2043 6f6e      sconv1 = Con
-0001a580: 7632 4428 6669 6c74 6572 733d 7365 6c66  v2D(filters=self
-0001a590: 2e73 7065 6373 5b27 6e5f 6c61 7465 6e74  .specs['n_latent
-0001a5a0: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
-0001a5b0: 2020 2020 2020 2020 2020 2020 206b 6572               ker
-0001a5c0: 6e65 6c5f 7369 7a65 3d28 7365 6c66 2e64  nel_size=(self.d
-0001a5d0: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
-0001a5e0: 276e 5f63 6827 5d2c 2031 292c 0d0a 2020  'n_ch'], 1),..  
+000182a0: 2020 2020 2020 2020 2029 2873 636f 6e76           )(sconv
+000182b0: 315f 6f75 7429 0d0a 0d0a 2020 2020 2020  1_out)....      
+000182c0: 2020 7072 696e 7428 2770 6f6f 6c31 3a20    print('pool1: 
+000182d0: 272c 2070 6f6f 6c31 2e73 6861 7065 290d  ', pool1.shape).
+000182e0: 0a20 2020 2020 2020 2066 635f 6f75 7420  .        fc_out 
+000182f0: 3d20 4675 6c6c 7943 6f6e 6e65 6374 6564  = FullyConnected
+00018300: 2873 697a 653d 7365 6c66 2e6f 7574 5f64  (size=self.out_d
+00018310: 696d 2c20 6e6f 6e6c 696e 3d74 662e 6964  im, nonlin=tf.id
+00018320: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
+00018330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018340: 2020 2020 2073 7065 6373 3d73 656c 662e       specs=self.
+00018350: 7370 6563 7329 0d0a 2020 2020 2020 2020  specs)..        
+00018360: 795f 7072 6564 203d 2066 635f 6f75 7428  y_pred = fc_out(
+00018370: 7466 2e6b 6572 6173 2e62 6163 6b65 6e64  tf.keras.backend
+00018380: 2e6c 6f67 2870 6f6f 6c31 2929 0d0a 2020  .log(pool1))..  
+00018390: 2020 2020 2020 7265 7475 726e 2079 5f70        return y_p
+000183a0: 7265 640d 0a23 0d0a 230d 0a63 6c61 7373  red..#..#..class
+000183b0: 204c 464c 5354 4d28 4261 7365 4d6f 6465   LFLSTM(BaseMode
+000183c0: 6c29 3a0d 0a20 2020 2023 2054 4f44 4f21  l):..    # TODO!
+000183d0: 2047 6162 693a 2063 6865 636b 2074 6861   Gabi: check tha
+000183e0: 7420 7468 6520 6465 7363 7269 7074 696f  t the descriptio
+000183f0: 6e20 6465 7363 7269 6265 7320 7468 6520  n describes the 
+00018400: 6d6f 6465 6c0d 0a20 2020 2022 2222 4c46  model..    """LF
+00018410: 2d43 4e4e 2d4c 5354 4d0d 0a0d 0a20 2020  -CNN-LSTM....   
+00018420: 2046 6f72 2064 6574 6169 6c73 2073 6565   For details see
+00018430: 205b 315d 2e0d 0a0d 0a20 2020 2050 6172   [1].....    Par
+00018440: 616d 6574 6572 730d 0a20 2020 202d 2d2d  ameters..    ---
+00018450: 2d2d 2d2d 2d2d 2d0d 0a20 2020 206e 5f6c  -------..    n_l
+00018460: 6174 656e 7420 3a20 696e 740d 0a20 2020  atent : int..   
+00018470: 2020 2020 206e 756d 6265 7220 6f66 206c       number of l
+00018480: 6174 656e 7420 636f 6d70 6f6e 656e 7473  atent components
+00018490: 0d0a 2020 2020 2020 2020 4465 6661 756c  ..        Defaul
+000184a0: 7473 2074 6f20 3332 0d0a 0d0a 2020 2020  ts to 32....    
+000184b0: 6669 6c74 6572 5f6c 656e 6774 6820 3a20  filter_length : 
+000184c0: 696e 740d 0a20 2020 2020 2020 206c 656e  int..        len
+000184d0: 6774 6820 6f66 2073 7061 7469 6f2d 7465  gth of spatio-te
+000184e0: 6d70 6f72 616c 206b 6572 6e65 6c73 2069  mporal kernels i
+000184f0: 6e20 7468 6520 7465 6d70 6f72 616c 0d0a  n the temporal..
+00018500: 2020 2020 2020 2020 636f 6e76 6f6c 7574          convolut
+00018510: 696f 6e20 6c61 7965 722e 2044 6566 6175  ion layer. Defau
+00018520: 6c74 7320 746f 2037 0d0a 0d0a 2020 2020  lts to 7....    
+00018530: 7374 7269 6465 203a 2069 6e74 0d0a 2020  stride : int..  
+00018540: 2020 2020 2020 7374 7269 6465 206f 6620        stride of 
+00018550: 7468 6520 6d61 7820 706f 6f6c 696e 6720  the max pooling 
+00018560: 6c61 7965 722e 2044 6566 6175 6c74 7320  layer. Defaults 
+00018570: 746f 2031 0d0a 0d0a 2020 2020 706f 6f6c  to 1....    pool
+00018580: 696e 6720 3a20 696e 740d 0a20 2020 2020  ing : int..     
+00018590: 2020 2070 6f6f 6c69 6e67 2066 6163 746f     pooling facto
+000185a0: 7220 6f66 2074 6865 206d 6178 2070 6f6f  r of the max poo
+000185b0: 6c69 6e67 206c 6179 6572 2e20 4465 6661  ling layer. Defa
+000185c0: 756c 7473 2074 6f20 320d 0a0d 0a20 2020  ults to 2....   
+000185d0: 2052 6566 6572 656e 6365 730d 0a20 2020   References..   
+000185e0: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
+000185f0: 2020 2020 205b 315d 2020 492e 205a 7562       [1]  I. Zub
+00018600: 6172 6576 2c20 6574 2061 6c2e 2c20 4164  arev, et al., Ad
+00018610: 6170 7469 7665 206e 6575 7261 6c20 6e65  aptive neural ne
+00018620: 7477 6f72 6b20 636c 6173 7369 6669 6572  twork classifier
+00018630: 2066 6f72 0d0a 2020 2020 2020 2020 6465   for..        de
+00018640: 636f 6469 6e67 204d 4547 2073 6967 6e61  coding MEG signa
+00018650: 6c73 2e20 4e65 7572 6f69 6d61 6765 2e20  ls. Neuroimage. 
+00018660: 2832 3031 3929 204d 6179 2034 3b31 3937  (2019) May 4;197
+00018670: 3a34 3235 2d34 3334 0d0a 2020 2020 2222  :425-434..    ""
+00018680: 220d 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+00018690: 745f 5f28 7365 6c66 2c20 6d65 7461 2c20  t__(self, meta, 
+000186a0: 6461 7461 7365 743d 4e6f 6e65 293a 0d0a  dataset=None):..
+000186b0: 2020 2020 2020 2020 2222 220d 0a0d 0a20          """.... 
+000186c0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+000186d0: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+000186e0: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2044  -----..        D
+000186f0: 6174 6173 6574 203a 206d 6e65 666c 6f77  ataset : mneflow
+00018700: 2e44 6174 6173 6574 0d0a 0d0a 2020 2020  .Dataset....    
+00018710: 2020 2020 7370 6563 7320 3a20 6469 6374      specs : dict
+00018720: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018730: 2020 6469 6374 696f 6e61 7279 206f 6620    dictionary of 
+00018740: 6d6f 6465 6c20 6879 7065 7270 6172 616d  model hyperparam
+00018750: 6574 6572 7320 7b0d 0a0d 0a20 2020 2020  eters {....     
+00018760: 2020 206e 5f6c 6174 656e 7420 3a20 696e     n_latent : in
+00018770: 740d 0a20 2020 2020 2020 2020 2020 204e  t..            N
+00018780: 756d 6265 7220 6f66 206c 6174 656e 7420  umber of latent 
+00018790: 636f 6d70 6f6e 656e 7473 2e0d 0a20 2020  components...   
+000187a0: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
+000187b0: 7320 746f 2033 322e 0d0a 0d0a 2020 2020  s to 32.....    
+000187c0: 2020 2020 6e6f 6e6c 696e 203a 2063 616c      nonlin : cal
+000187d0: 6c61 626c 650d 0a20 2020 2020 2020 2020  lable..         
+000187e0: 2020 2041 6374 6976 6174 696f 6e20 6675     Activation fu
+000187f0: 6e63 7469 6f6e 206f 6620 7468 6520 7465  nction of the te
+00018800: 6d70 6f72 616c 2063 6f6e 766f 6c75 7469  mporal convoluti
+00018810: 6f6e 206c 6179 6572 2e0d 0a20 2020 2020  on layer...     
+00018820: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
+00018830: 746f 2074 662e 6e6e 2e72 656c 750d 0a0d  to tf.nn.relu...
+00018840: 0a20 2020 2020 2020 2066 696c 7465 725f  .        filter_
+00018850: 6c65 6e67 7468 203a 2069 6e74 0d0a 2020  length : int..  
+00018860: 2020 2020 2020 2020 2020 4c65 6e67 7468            Length
+00018870: 206f 6620 7370 6174 696f 2d74 656d 706f   of spatio-tempo
+00018880: 7261 6c20 6b65 726e 656c 7320 696e 2074  ral kernels in t
+00018890: 6865 2074 656d 706f 7261 6c0d 0a20 2020  he temporal..   
+000188a0: 2020 2020 2020 2020 2063 6f6e 766f 6c75           convolu
+000188b0: 7469 6f6e 206c 6179 6572 2e20 4465 6661  tion layer. Defa
+000188c0: 756c 7473 2074 6f20 372e 0d0a 0d0a 2020  ults to 7.....  
+000188d0: 2020 2020 2020 706f 6f6c 696e 6720 3a20        pooling : 
+000188e0: 696e 740d 0a20 2020 2020 2020 2020 2020  int..           
+000188f0: 2050 6f6f 6c69 6e67 2066 6163 746f 7220   Pooling factor 
+00018900: 6f66 2074 6865 206d 6178 2070 6f6f 6c69  of the max pooli
+00018910: 6e67 206c 6179 6572 2e20 4465 6661 756c  ng layer. Defaul
+00018920: 7473 2074 6f20 320d 0a0d 0a20 2020 2020  ts to 2....     
+00018930: 2020 2070 6f6f 6c5f 7479 7065 203a 2073     pool_type : s
+00018940: 7472 207b 2761 7667 272c 2027 6d61 7827  tr {'avg', 'max'
+00018950: 7d0d 0a20 2020 2020 2020 2020 2020 2054  }..            T
+00018960: 7970 6520 6f66 2070 6f6f 6c69 6e67 206f  ype of pooling o
+00018970: 7065 7261 7469 6f6e 2e20 4465 6661 756c  peration. Defaul
+00018980: 7473 2074 6f20 276d 6178 272e 0d0a 0d0a  ts to 'max'.....
+00018990: 2020 2020 2020 2020 7061 6464 696e 6720          padding 
+000189a0: 3a20 7374 7220 7b27 5341 4d45 272c 2027  : str {'SAME', '
+000189b0: 4655 4c4c 272c 2027 5641 4c49 4427 7d0d  FULL', 'VALID'}.
+000189c0: 0a20 2020 2020 2020 2020 2020 2043 6f6e  .            Con
+000189d0: 766f 6c75 7469 6f6e 2070 6164 6469 6e67  volution padding
+000189e0: 2e20 4465 6661 756c 7473 2074 6f20 2753  . Defaults to 'S
+000189f0: 414d 4527 2e7d 0d0a 0d0a 2020 2020 2020  AME'.}....      
+00018a00: 2020 7374 7269 6465 203a 2069 6e74 0d0a    stride : int..
+00018a10: 2020 2020 2020 2020 5374 7269 6465 206f          Stride o
+00018a20: 6620 7468 6520 6d61 7820 706f 6f6c 696e  f the max poolin
+00018a30: 6720 6c61 7965 722e 2044 6566 6175 6c74  g layer. Default
+00018a40: 7320 746f 2031 2e0d 0a20 2020 2020 2020  s to 1...       
+00018a50: 2022 2222 0d0a 2020 2020 2020 2020 2373   """..        #s
+00018a60: 656c 662e 7363 6f70 6520 3d20 276c 666c  elf.scope = 'lfl
+00018a70: 7374 6d27 0d0a 2020 2020 2020 2020 7365  stm'..        se
+00018a80: 6c66 2e73 636f 7065 203d 2027 6c66 2d63  lf.scope = 'lf-c
+00018a90: 6e6e 2d6c 7374 6d27 0d0a 2020 2020 2020  nn-lstm'..      
+00018aa0: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
+00018ab0: 6373 2e73 6574 6465 6661 756c 7428 2766  cs.setdefault('f
+00018ac0: 696c 7465 725f 6c65 6e67 7468 272c 2037  ilter_length', 7
+00018ad0: 290d 0a20 2020 2020 2020 206d 6574 612e  )..        meta.
+00018ae0: 6d6f 6465 6c5f 7370 6563 732e 7365 7464  model_specs.setd
+00018af0: 6566 6175 6c74 2827 6e5f 6c61 7465 6e74  efault('n_latent
+00018b00: 272c 2033 3229 0d0a 2020 2020 2020 2020  ', 32)..        
+00018b10: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
+00018b20: 2e73 6574 6465 6661 756c 7428 2770 6f6f  .setdefault('poo
+00018b30: 6c69 6e67 272c 2032 290d 0a20 2020 2020  ling', 2)..     
+00018b40: 2020 206d 6574 612e 6d6f 6465 6c5f 7370     meta.model_sp
+00018b50: 6563 732e 7365 7464 6566 6175 6c74 2827  ecs.setdefault('
+00018b60: 7374 7269 6465 272c 2032 290d 0a20 2020  stride', 2)..   
+00018b70: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
+00018b80: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
+00018b90: 2827 7061 6464 696e 6727 2c20 2753 414d  ('padding', 'SAM
+00018ba0: 4527 290d 0a20 2020 2020 2020 206d 6574  E')..        met
+00018bb0: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
+00018bc0: 7464 6566 6175 6c74 2827 706f 6f6c 5f74  tdefault('pool_t
+00018bd0: 7970 6527 2c20 276d 6178 2729 0d0a 2020  ype', 'max')..  
+00018be0: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
+00018bf0: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
+00018c00: 7428 276e 6f6e 6c69 6e27 2c20 7466 2e6e  t('nonlin', tf.n
+00018c10: 6e2e 7265 6c75 290d 0a20 2020 2020 2020  n.relu)..       
+00018c20: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
+00018c30: 732e 7365 7464 6566 6175 6c74 2827 6c31  s.setdefault('l1
+00018c40: 5f6c 616d 6264 6127 2c20 302e 290d 0a20  _lambda', 0.).. 
+00018c50: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
+00018c60: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
+00018c70: 6c74 2827 6c32 5f6c 616d 6264 6127 2c20  lt('l2_lambda', 
+00018c80: 302e 290d 0a20 2020 2020 2020 206d 6574  0.)..        met
+00018c90: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
+00018ca0: 7464 6566 6175 6c74 2827 6c31 5f73 636f  tdefault('l1_sco
+00018cb0: 7065 272c 205b 5d29 0d0a 2020 2020 2020  pe', [])..      
+00018cc0: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
+00018cd0: 6373 2e73 6574 6465 6661 756c 7428 276c  cs.setdefault('l
+00018ce0: 325f 7363 6f70 6527 2c20 5b5d 290d 0a20  2_scope', []).. 
+00018cf0: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
+00018d00: 6c5f 7370 6563 735b 2773 636f 7065 275d  l_specs['scope']
+00018d10: 203d 2073 656c 662e 7363 6f70 650d 0a20   = self.scope.. 
+00018d20: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
+00018d30: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
+00018d40: 6c74 2827 756e 6974 6e6f 726d 5f73 636f  lt('unitnorm_sco
+00018d50: 7065 272c 205b 5d29 0d0a 2020 2020 2020  pe', [])..      
+00018d60: 2020 2373 7065 6373 2e73 6574 6465 6661    #specs.setdefa
+00018d70: 756c 7428 276d 6f64 656c 5f70 6174 6827  ult('model_path'
+00018d80: 2c20 2073 656c 662e 6461 7461 7365 742e  ,  self.dataset.
+00018d90: 685f 7061 7261 6d73 5b27 7361 7665 5f70  h_params['save_p
+00018da0: 6174 6827 5d29 0d0a 2020 2020 2020 2020  ath'])..        
+00018db0: 7375 7065 7228 4c46 4c53 544d 2c20 7365  super(LFLSTM, se
+00018dc0: 6c66 292e 5f5f 696e 6974 5f5f 286d 6574  lf).__init__(met
+00018dd0: 612c 2064 6174 6173 6574 290d 0a0d 0a0d  a, dataset).....
+00018de0: 0a20 2020 2064 6566 2062 7569 6c64 5f67  .    def build_g
+00018df0: 7261 7068 2873 656c 6629 3a0d 0a20 2020  raph(self):..   
+00018e00: 2020 2020 200d 0a20 2020 2020 2020 2073       ..        s
+00018e10: 656c 662e 7265 7475 726e 5f73 6571 7565  elf.return_seque
+00018e20: 6e63 6520 3d20 5472 7565 0d0a 2020 2020  nce = True..    
+00018e30: 2020 2020 7365 6c66 2e64 6d78 203d 2044      self.dmx = D
+00018e40: 654d 6978 696e 6728 7369 7a65 3d73 656c  eMixing(size=sel
+00018e50: 662e 7370 6563 735b 276e 5f6c 6174 656e  f.specs['n_laten
+00018e60: 7427 5d2c 206e 6f6e 6c69 6e3d 7466 2e69  t'], nonlin=tf.i
+00018e70: 6465 6e74 6974 792c 0d0a 2020 2020 2020  dentity,..      
+00018e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018e90: 2020 2020 2020 6178 6973 3d33 2c20 7370        axis=3, sp
+00018ea0: 6563 733d 7365 6c66 2e73 7065 6373 290d  ecs=self.specs).
+00018eb0: 0a20 2020 2020 2020 2064 6d78 203d 2073  .        dmx = s
+00018ec0: 656c 662e 646d 7828 7365 6c66 2e69 6e70  elf.dmx(self.inp
+00018ed0: 7574 7329 0d0a 2020 2020 2020 2020 2364  uts)..        #d
+00018ee0: 6d78 203d 2074 662e 7265 7368 6170 6528  mx = tf.reshape(
+00018ef0: 646d 782c 205b 2d31 2c20 7365 6c66 2e64  dmx, [-1, self.d
+00018f00: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
+00018f10: 276e 5f74 275d 2c0d 0a20 2020 2020 2020  'n_t'],..       
+00018f20: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00018f30: 2020 2020 2020 2020 2073 656c 662e 7370           self.sp
+00018f40: 6563 735b 276e 5f6c 6174 656e 7427 5d5d  ecs['n_latent']]
+00018f50: 290d 0a20 2020 2020 2020 2023 646d 7820  )..        #dmx 
+00018f60: 3d20 7466 2e65 7870 616e 645f 6469 6d73  = tf.expand_dims
+00018f70: 2864 6d78 2c20 2d31 290d 0a20 2020 2020  (dmx, -1)..     
+00018f80: 2020 2070 7269 6e74 2827 646d 782d 7371     print('dmx-sq
+00018f90: 6f75 743a 272c 2064 6d78 2e73 6861 7065  out:', dmx.shape
+00018fa0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00018fb0: 662e 7463 6f6e 7631 203d 204c 4654 436f  f.tconv1 = LFTCo
+00018fc0: 6e76 2873 636f 7065 3d22 636f 6e76 222c  nv(scope="conv",
+00018fd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ff0: 7369 7a65 3d73 656c 662e 7370 6563 735b  size=self.specs[
+00019000: 276e 5f6c 6174 656e 7427 5d2c 0d0a 2020  'n_latent'],..  
+00019010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019020: 2020 2020 2020 2020 2020 2020 6e6f 6e6c              nonl
+00019030: 696e 3d74 662e 6e6e 2e72 656c 752c 0d0a  in=tf.nn.relu,..
+00019040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019050: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00019060: 6c74 6572 5f6c 656e 6774 683d 7365 6c66  lter_length=self
+00019070: 2e73 7065 6373 5b27 6669 6c74 6572 5f6c  .specs['filter_l
+00019080: 656e 6774 6827 5d2c 0d0a 2320 2020 2020  ength'],..#     
+00019090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190a0: 2020 2020 2020 2020 2073 7472 6964 653d           stride=
+000190b0: 7365 6c66 2e73 7065 6373 5b27 7374 7269  self.specs['stri
+000190c0: 6465 275d 2c0d 0a23 2020 2020 2020 2020  de'],..#        
+000190d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190e0: 2020 2020 2020 706f 6f6c 696e 673d 7365        pooling=se
+000190f0: 6c66 2e73 7065 6373 5b27 706f 6f6c 696e  lf.specs['poolin
+00019100: 6727 5d2c 0d0a 2020 2020 2020 2020 2020  g'],..          
+00019110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019120: 2020 2020 7061 6464 696e 673d 7365 6c66      padding=self
+00019130: 2e73 7065 6373 5b27 7061 6464 696e 6727  .specs['padding'
+00019140: 5d29 0d0a 0d0a 2020 2020 2020 2020 6665  ])....        fe
+00019150: 6174 7572 6573 203d 2073 656c 662e 7463  atures = self.tc
+00019160: 6f6e 7631 2864 6d78 290d 0a20 2020 2020  onv1(dmx)..     
+00019170: 2020 2070 6f6f 6c31 203d 2054 656d 7050     pool1 = TempP
+00019180: 6f6f 6c69 6e67 2873 7472 6964 653d 7365  ooling(stride=se
+00019190: 6c66 2e73 7065 6373 5b27 7374 7269 6465  lf.specs['stride
+000191a0: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
+000191b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191c0: 2070 6f6f 6c69 6e67 3d73 656c 662e 7370   pooling=self.sp
+000191d0: 6563 735b 2770 6f6f 6c69 6e67 275d 2c0d  ecs['pooling'],.
+000191e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000191f0: 2020 2020 2020 2020 2020 2020 2070 6164               pad
+00019200: 6469 6e67 3d27 5341 4d45 272c 0d0a 2020  ding='SAME',..  
+00019210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019220: 2020 2020 2020 2020 2020 706f 6f6c 5f74            pool_t
+00019230: 7970 653d 276d 6178 2729 0d0a 0d0a 0d0a  ype='max')......
+00019240: 2020 2020 2020 2020 706f 6f6c 6564 203d          pooled =
+00019250: 2070 6f6f 6c31 2866 6561 7475 7265 7329   pool1(features)
+00019260: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+00019270: 2766 6561 7475 7265 733a 272c 2070 6f6f  'features:', poo
+00019280: 6c65 642e 7368 6170 6529 0d0a 0d0a 2020  led.shape)....  
+00019290: 2020 2020 2020 6673 6861 7065 203d 2074        fshape = t
+000192a0: 662e 6d75 6c74 6970 6c79 2870 6f6f 6c65  f.multiply(poole
+000192b0: 642e 7368 6170 655b 325d 2c20 706f 6f6c  d.shape[2], pool
+000192c0: 6564 2e73 6861 7065 5b33 5d29 0d0a 0d0a  ed.shape[3])....
+000192d0: 2020 2020 2020 2020 6666 6561 7475 7265          ffeature
+000192e0: 7320 3d20 7466 2e72 6573 6861 7065 2870  s = tf.reshape(p
+000192f0: 6f6f 6c65 642c 0d0a 2020 2020 2020 2020  ooled,..        
+00019300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019310: 2020 2020 2020 5b2d 312c 2073 656c 662e        [-1, self.
+00019320: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
+00019330: 5b27 6e5f 7365 7127 5d2c 2066 7368 6170  ['n_seq'], fshap
+00019340: 655d 290d 0a20 2020 2020 2020 2023 2020  e])..        #  
+00019350: 6665 6174 7572 6573 203d 2074 662e 6578  features = tf.ex
+00019360: 7061 6e64 5f64 696d 7328 6665 6174 7572  pand_dims(featur
+00019370: 6573 2c20 3029 0d0a 2020 2020 2020 2020  es, 0)..        
+00019380: 236c 315f 6c61 6d62 6461 203d 2073 656c  #l1_lambda = sel
+00019390: 662e 6f70 7469 6d69 7a65 722e 7061 7261  f.optimizer.para
+000193a0: 6d73 5b27 6c31 5f6c 616d 6264 6127 5d0d  ms['l1_lambda'].
+000193b0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+000193c0: 666c 6174 2066 6561 7475 7265 733a 272c  flat features:',
+000193d0: 2066 6665 6174 7572 6573 2e73 6861 7065   ffeatures.shape
+000193e0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000193f0: 6c73 746d 203d 204c 5354 4d28 7363 6f70  lstm = LSTM(scop
+00019400: 653d 226c 7374 6d22 2c0d 0a20 2020 2020  e="lstm",..     
+00019410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019420: 2020 2020 2020 7369 7a65 3d73 656c 662e        size=self.
+00019430: 7370 6563 735b 276e 5f6c 6174 656e 7427  specs['n_latent'
+00019440: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00019450: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00019460: 6572 6e65 6c5f 696e 6974 6961 6c69 7a65  ernel_initialize
+00019470: 723d 2767 6c6f 726f 745f 756e 6966 6f72  r='glorot_unifor
+00019480: 6d27 2c0d 0a20 2020 2020 2020 2020 2020  m',..           
+00019490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194a0: 7265 6375 7272 656e 745f 696e 6974 6961  recurrent_initia
+000194b0: 6c69 7a65 723d 276f 7274 686f 676f 6e61  lizer='orthogona
+000194c0: 6c27 2c0d 0a20 2020 2020 2020 2020 2020  l',..           
+000194d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194e0: 7265 6375 7272 656e 745f 7265 6775 6c61  recurrent_regula
+000194f0: 7269 7a65 723d 6b5f 7265 672e 6c31 2873  rizer=k_reg.l1(s
+00019500: 656c 662e 7370 6563 735b 276c 315f 6c61  elf.specs['l1_la
+00019510: 6d62 6461 275d 292c 0d0a 2020 2020 2020  mbda']),..      
+00019520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019530: 2020 2020 206b 6572 6e65 6c5f 7265 6775       kernel_regu
+00019540: 6c61 7269 7a65 723d 6b5f 7265 672e 6c32  larizer=k_reg.l2
+00019550: 2873 656c 662e 7370 6563 735b 276c 325f  (self.specs['l2_
+00019560: 6c61 6d62 6461 275d 292c 0d0a 2020 2020  lambda']),..    
+00019570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019580: 2020 2020 2020 2062 6961 735f 7265 6775         bias_regu
+00019590: 6c61 7269 7a65 723d 4e6f 6e65 2c0d 0a20  larizer=None,.. 
+000195a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195b0: 2020 2020 2020 2020 2020 2320 6163 7469            # acti
+000195c0: 7669 7479 5f72 6567 756c 6172 697a 6572  vity_regularizer
+000195d0: 3d20 7265 6775 6c61 7269 7a65 7273 2e6c  = regularizers.l
+000195e0: 3128 302e 3031 292c 0d0a 2020 2020 2020  1(0.01),..      
+000195f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019600: 2020 2020 2023 206b 6572 6e65 6c5f 636f       # kernel_co
+00019610: 6e73 7472 6169 6e74 3d20 636f 6e73 7472  nstraint= constr
+00019620: 6169 6e74 732e 556e 6974 4e6f 726d 2861  aints.UnitNorm(a
+00019630: 7869 733d 3029 2c0d 0a20 2020 2020 2020  xis=0),..       
+00019640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019650: 2020 2020 2320 7265 6375 7272 656e 745f      # recurrent_
+00019660: 636f 6e73 7472 6169 6e74 3d20 636f 6e73  constraint= cons
+00019670: 7472 6169 6e74 732e 4e6f 6e4e 6567 2829  traints.NonNeg()
+00019680: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00019690: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000196a0: 6269 6173 5f63 6f6e 7374 7261 696e 743d  bias_constraint=
+000196b0: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
+000196c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196d0: 2020 6472 6f70 6f75 743d 302e 312c 2072    dropout=0.1, r
+000196e0: 6563 7572 7265 6e74 5f64 726f 706f 7574  ecurrent_dropout
+000196f0: 3d30 2e31 2c0d 0a20 2020 2020 2020 2020  =0.1,..         
+00019700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019710: 2020 6e6f 6e6c 696e 3d74 662e 6964 656e    nonlin=tf.iden
+00019720: 7469 7479 2c0d 0a20 2020 2020 2020 2020  tity,..         
+00019730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019740: 2020 756e 6974 5f66 6f72 6765 745f 6269    unit_forget_bi
+00019750: 6173 3d46 616c 7365 2c0d 0a20 2020 2020  as=False,..     
+00019760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019770: 2020 2020 2020 7265 7475 726e 5f73 6571        return_seq
+00019780: 7565 6e63 6573 3d73 656c 662e 7265 7475  uences=self.retu
+00019790: 726e 5f73 6571 7565 6e63 652c 0d0a 2020  rn_sequence,..  
+000197a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000197b0: 2020 2020 2020 2020 2075 6e72 6f6c 6c3d           unroll=
+000197c0: 4661 6c73 6529 0d0a 0d0a 2020 2020 2020  False)....      
+000197d0: 2020 7365 6c66 2e6c 7374 6d5f 6f75 7420    self.lstm_out 
+000197e0: 3d20 7365 6c66 2e6c 7374 6d28 6666 6561  = self.lstm(ffea
+000197f0: 7475 7265 7329 0d0a 2020 2020 2020 2020  tures)..        
+00019800: 7072 696e 7428 276c 7374 6d5f 6f75 743a  print('lstm_out:
+00019810: 272c 2073 656c 662e 6c73 746d 5f6f 7574  ', self.lstm_out
+00019820: 2e73 6861 7065 290d 0a0d 0a20 2020 2020  .shape)....     
+00019830: 2020 2069 6620 7365 6c66 2e72 6574 7572     if self.retur
+00019840: 6e5f 7365 7175 656e 6365 203d 3d20 5472  n_sequence == Tr
+00019850: 7565 3a0d 0a20 2020 2020 2020 2020 2020  ue:..           
+00019860: 2073 656c 662e 6669 6e5f 6663 203d 2044   self.fin_fc = D
+00019870: 654d 6978 696e 6728 7369 7a65 3d73 656c  eMixing(size=sel
+00019880: 662e 6f75 745f 6469 6d2c 0d0a 2020 2020  f.out_dim,..    
+00019890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000198a0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000198b0: 6f6e 6c69 6e3d 7466 2e69 6465 6e74 6974  onlin=tf.identit
+000198c0: 792c 2061 7869 733d 3229 0d0a 2020 2020  y, axis=2)..    
+000198d0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+000198e0: 2020 2020 2020 2073 656c 662e 6669 6e5f         self.fin_
+000198f0: 6663 203d 2046 756c 6c79 436f 6e6e 6563  fc = FullyConnec
+00019900: 7465 6428 7369 7a65 3d73 656c 662e 6f75  ted(size=self.ou
+00019910: 745f 6469 6d2c 206e 6f6e 6c69 6e3d 7466  t_dim, nonlin=tf
+00019920: 2e69 6465 6e74 6974 792c 0d0a 2020 2020  .identity,..    
+00019930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019940: 2020 2020 2020 2020 2020 2020 7370 6563              spec
+00019950: 733d 7365 6c66 2e73 7065 6373 290d 0a20  s=self.specs).. 
+00019960: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+00019970: 2020 2020 2079 5f70 7265 6420 3d20 7365       y_pred = se
+00019980: 6c66 2e66 696e 5f66 6328 7365 6c66 2e6c  lf.fin_fc(self.l
+00019990: 7374 6d5f 6f75 7429 0d0a 2020 2020 2020  stm_out)..      
+000199a0: 2020 7072 696e 7428 2266 696e 2066 6320    print("fin fc 
+000199b0: 6f75 743a 222c 2079 5f70 7265 642e 7368  out:", y_pred.sh
+000199c0: 6170 6529 0d0a 2020 2020 2020 2020 7265  ape)..        re
+000199d0: 7475 726e 2079 5f70 7265 640d 0a23 0d0a  turn y_pred..#..
+000199e0: 230d 0a0d 0a0d 0a63 6c61 7373 2044 6565  #......class Dee
+000199f0: 7034 2842 6173 654d 6f64 656c 293a 0d0a  p4(BaseModel):..
+00019a00: 2020 2020 2222 220d 0a20 2020 2044 6565      """..    Dee
+00019a10: 7020 436f 6e76 4e65 7420 6d6f 6465 6c20  p ConvNet model 
+00019a20: 6672 6f6d 205b 3262 5d5f 2e0d 0a20 2020  from [2b]_...   
+00019a30: 2052 6566 6572 656e 6365 730d 0a20 2020   References..   
+00019a40: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
+00019a50: 202e 2e20 5b32 625d 2053 6368 6972 726d   .. [2b] Schirrm
+00019a60: 6569 7374 6572 2c20 522e 2054 2e2c 2053  eister, R. T., S
+00019a70: 7072 696e 6765 6e62 6572 672c 204a 2e20  pringenberg, J. 
+00019a80: 542e 2c20 4669 6564 6572 6572 2c20 4c2e  T., Fiederer, L.
+00019a90: 2044 2e20 4a2e 2c0d 0a20 2020 2020 2020   D. J.,..       
+00019aa0: 476c 6173 7374 6574 7465 722c 204d 2e2c  Glasstetter, M.,
+00019ab0: 2045 6767 656e 7370 6572 6765 722c 204b   Eggensperger, K
+00019ac0: 2e2c 2054 616e 6765 726d 616e 6e2c 204d  ., Tangermann, M
+00019ad0: 2e2c 2048 7574 7465 722c 2046 2e20 2620  ., Hutter, F. & 
+00019ae0: 4261 6c6c 2c20 542e 2028 3230 3137 292e  Ball, T. (2017).
+00019af0: 0d0a 2020 2020 2020 2044 6565 7020 6c65  ..       Deep le
+00019b00: 6172 6e69 6e67 2077 6974 6820 636f 6e76  arning with conv
+00019b10: 6f6c 7574 696f 6e61 6c20 6e65 7572 616c  olutional neural
+00019b20: 206e 6574 776f 726b 7320 666f 7220 4545   networks for EE
+00019b30: 4720 6465 636f 6469 6e67 2061 6e64 0d0a  G decoding and..
+00019b40: 2020 2020 2020 2076 6973 7561 6c69 7a61         visualiza
+00019b50: 7469 6f6e 2e0d 0a20 2020 2020 2020 4875  tion...       Hu
+00019b60: 6d61 6e20 4272 6169 6e20 4d61 7070 696e  man Brain Mappin
+00019b70: 6720 2c20 4175 672e 2032 3031 372e 204f  g , Aug. 2017. O
+00019b80: 6e6c 696e 653a 2068 7474 703a 2f2f 6478  nline: http://dx
+00019b90: 2e64 6f69 2e6f 7267 2f31 302e 3130 3032  .doi.org/10.1002
+00019ba0: 2f68 626d 2e32 3337 3330 0d0a 2020 2020  /hbm.23730..    
+00019bb0: 2222 220d 0a20 2020 2064 6566 205f 5f69  """..    def __i
+00019bc0: 6e69 745f 5f28 7365 6c66 2c20 6d65 7461  nit__(self, meta
+00019bd0: 2c20 6461 7461 7365 743d 4e6f 6e65 293a  , dataset=None):
+00019be0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00019bf0: 636f 7065 203d 2027 6465 6570 3427 0d0a  cope = 'deep4'..
+00019c00: 2020 2020 2020 2020 6d65 7461 2e6d 6f64          meta.mod
+00019c10: 656c 5f73 7065 6373 2e73 6574 6465 6661  el_specs.setdefa
+00019c20: 756c 7428 2766 696c 7465 725f 6c65 6e67  ult('filter_leng
+00019c30: 7468 272c 2031 3029 0d0a 2020 2020 2020  th', 10)..      
+00019c40: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
+00019c50: 6373 2e73 6574 6465 6661 756c 7428 276e  cs.setdefault('n
+00019c60: 5f6c 6174 656e 7427 2c20 3235 290d 0a20  _latent', 25).. 
+00019c70: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
+00019c80: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
+00019c90: 6c74 2827 706f 6f6c 696e 6727 2c20 3329  lt('pooling', 3)
+00019ca0: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
+00019cb0: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
+00019cc0: 6661 756c 7428 2773 7472 6964 6527 2c20  fault('stride', 
+00019cd0: 3329 0d0a 2020 2020 2020 2020 6d65 7461  3)..        meta
+00019ce0: 2e6d 6f64 656c 5f73 7065 6373 2e73 6574  .model_specs.set
+00019cf0: 6465 6661 756c 7428 2770 6f6f 6c5f 7479  default('pool_ty
+00019d00: 7065 272c 2027 6d61 7827 290d 0a20 2020  pe', 'max')..   
+00019d10: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
+00019d20: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
+00019d30: 2827 7061 6464 696e 6727 2c20 2753 414d  ('padding', 'SAM
+00019d40: 4527 290d 0a20 2020 2020 2020 206d 6574  E')..        met
+00019d50: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
+00019d60: 7464 6566 6175 6c74 2827 6e6f 6e6c 696e  tdefault('nonlin
+00019d70: 272c 2074 662e 6e6e 2e65 6c75 290d 0a20  ', tf.nn.elu).. 
+00019d80: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
+00019d90: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
+00019da0: 6c74 2827 6c31 5f6c 616d 6264 6127 2c20  lt('l1_lambda', 
+00019db0: 3029 0d0a 2020 2020 2020 2020 6d65 7461  0)..        meta
+00019dc0: 2e6d 6f64 656c 5f73 7065 6373 2e73 6574  .model_specs.set
+00019dd0: 6465 6661 756c 7428 276c 325f 6c61 6d62  default('l2_lamb
+00019de0: 6461 272c 2030 290d 0a20 2020 2020 2020  da', 0)..       
+00019df0: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
+00019e00: 732e 7365 7464 6566 6175 6c74 2827 6c31  s.setdefault('l1
+00019e10: 5f73 636f 7065 272c 205b 5d29 0d0a 2020  _scope', [])..  
+00019e20: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
+00019e30: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
+00019e40: 7428 276c 325f 7363 6f70 6527 2c20 5b5d  t('l2_scope', []
+00019e50: 290d 0a20 2020 2020 2020 206d 6574 612e  )..        meta.
+00019e60: 6d6f 6465 6c5f 7370 6563 732e 7365 7464  model_specs.setd
+00019e70: 6566 6175 6c74 2827 756e 6974 6e6f 726d  efault('unitnorm
+00019e80: 5f73 636f 7065 272c 205b 5d29 0d0a 2020  _scope', [])..  
+00019e90: 2020 2020 2020 2373 7065 6373 2e73 6574        #specs.set
+00019ea0: 6465 6661 756c 7428 276d 6f64 656c 5f70  default('model_p
+00019eb0: 6174 6827 2c20 6f73 2e70 6174 682e 6a6f  ath', os.path.jo
+00019ec0: 696e 2873 656c 662e 6461 7461 7365 742e  in(self.dataset.
+00019ed0: 685f 7061 7261 6d73 5b27 7061 7468 275d  h_params['path']
+00019ee0: 2c20 276d 6f64 656c 7327 2929 0d0a 2020  , 'models'))..  
+00019ef0: 2020 2020 2020 7375 7065 7228 4465 6570        super(Deep
+00019f00: 342c 2073 656c 6629 2e5f 5f69 6e69 745f  4, self).__init_
+00019f10: 5f28 6d65 7461 2c20 6461 7461 7365 7429  _(meta, dataset)
+00019f20: 0d0a 0d0a 2020 2020 6465 6620 6275 696c  ....    def buil
+00019f30: 645f 6772 6170 6828 7365 6c66 293a 0d0a  d_graph(self):..
+00019f40: 2020 2020 2020 2020 7365 6c66 2e73 636f          self.sco
+00019f50: 7065 203d 2027 6465 6570 3427 0d0a 0d0a  pe = 'deep4'....
+00019f60: 2020 2020 2020 2020 696e 7075 7473 203d          inputs =
+00019f70: 2074 662e 7472 616e 7370 6f73 6528 7365   tf.transpose(se
+00019f80: 6c66 2e69 6e70 7574 732c 5b30 2c33 2c32  lf.inputs,[0,3,2
+00019f90: 2c31 5d29 0d0a 0d0a 2020 2020 2020 2020  ,1])....        
+00019fa0: 7463 6f6e 7631 203d 2044 6570 7468 7769  tconv1 = Depthwi
+00019fb0: 7365 436f 6e76 3244 280d 0a20 2020 2020  seConv2D(..     
+00019fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fd0: 2020 206b 6572 6e65 6c5f 7369 7a65 3d28     kernel_size=(
+00019fe0: 312c 2073 656c 662e 7370 6563 735b 2766  1, self.specs['f
+00019ff0: 696c 7465 725f 6c65 6e67 7468 275d 292c  ilter_length']),
+0001a000: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001a010: 2020 2020 2020 2020 2020 6465 7074 685f            depth_
+0001a020: 6d75 6c74 6970 6c69 6572 203d 2073 656c  multiplier = sel
+0001a030: 662e 7370 6563 735b 276e 5f6c 6174 656e  f.specs['n_laten
+0001a040: 7427 5d2c 0d0a 2020 2020 2020 2020 2020  t'],..          
+0001a050: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0001a060: 7269 6465 733d 312c 0d0a 2020 2020 2020  rides=1,..      
+0001a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a080: 2020 7061 6464 696e 673d 7365 6c66 2e73    padding=self.s
+0001a090: 7065 6373 5b27 7061 6464 696e 6727 5d2c  pecs['padding'],
+0001a0a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001a0b0: 2020 2020 2020 2020 2020 6163 7469 7661            activa
+0001a0c0: 7469 6f6e 203d 2074 662e 6964 656e 7469  tion = tf.identi
+0001a0d0: 7479 2c0d 0a20 2020 2020 2020 2020 2020  ty,..           
+0001a0e0: 2020 2020 2020 2020 2020 2020 206b 6572               ker
+0001a0f0: 6e65 6c5f 696e 6974 6961 6c69 7a65 723d  nel_initializer=
+0001a100: 2268 655f 756e 6966 6f72 6d22 2c0d 0a20  "he_uniform",.. 
+0001a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a120: 2020 2020 2020 2062 6961 735f 696e 6974         bias_init
+0001a130: 6961 6c69 7a65 723d 436f 6e73 7461 6e74  ializer=Constant
+0001a140: 2830 2e31 292c 0d0a 2020 2020 2020 2020  (0.1),..        
+0001a150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a160: 6461 7461 5f66 6f72 6d61 743d 2263 6861  data_format="cha
+0001a170: 6e6e 656c 735f 6c61 7374 222c 0d0a 2020  nnels_last",..  
+0001a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a190: 2020 2020 2020 6b65 726e 656c 5f72 6567        kernel_reg
+0001a1a0: 756c 6172 697a 6572 3d6b 5f72 6567 2e6c  ularizer=k_reg.l
+0001a1b0: 3228 7365 6c66 2e73 7065 6373 5b27 6c32  2(self.specs['l2
+0001a1c0: 5f6c 616d 6264 6127 5d29 0d0a 2020 2020  _lambda'])..    
+0001a1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a1e0: 2020 2020 236b 6572 6e65 6c5f 636f 6e73      #kernel_cons
+0001a1f0: 7472 6169 6e74 3d22 6d61 786e 6f72 6d22  traint="maxnorm"
+0001a200: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001a210: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+0001a220: 2020 2020 2074 636f 6e76 315f 6f75 7420       tconv1_out 
+0001a230: 3d20 7463 6f6e 7631 2869 6e70 7574 7329  = tconv1(inputs)
+0001a240: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+0001a250: 2774 636f 6e76 313a 2027 2c20 7463 6f6e  'tconv1: ', tcon
+0001a260: 7631 5f6f 7574 2e73 6861 7065 2920 2373  v1_out.shape) #s
+0001a270: 686f 756c 6420 6265 206e 5f62 6174 6368  hould be n_batch
+0001a280: 2c20 7365 6e73 6f72 732c 2074 696d 6573  , sensors, times
+0001a290: 2c20 6b65 726e 656c 730d 0a0d 0a20 2020  , kernels....   
+0001a2a0: 2020 2020 2073 636f 6e76 3120 3d20 436f       sconv1 = Co
+0001a2b0: 6e76 3244 2866 696c 7465 7273 3d73 656c  nv2D(filters=sel
+0001a2c0: 662e 7370 6563 735b 276e 5f6c 6174 656e  f.specs['n_laten
+0001a2d0: 7427 5d2c 0d0a 2020 2020 2020 2020 2020  t'],..          
+0001a2e0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+0001a2f0: 726e 656c 5f73 697a 653d 2873 656c 662e  rnel_size=(self.
+0001a300: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
+0001a310: 5b27 6e5f 6368 275d 2c20 3129 2c0d 0a20  ['n_ch'], 1),.. 
+0001a320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a330: 2020 2020 2020 2073 7472 6964 6573 3d31         strides=1
+0001a340: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001a350: 2020 2020 2020 2020 2020 2070 6164 6469             paddi
+0001a360: 6e67 3d73 656c 662e 7370 6563 735b 2770  ng=self.specs['p
+0001a370: 6164 6469 6e67 275d 2c0d 0a20 2020 2020  adding'],..     
+0001a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a390: 2020 2061 6374 6976 6174 696f 6e3d 7365     activation=se
+0001a3a0: 6c66 2e73 7065 6373 5b27 6e6f 6e6c 696e  lf.specs['nonlin
+0001a3b0: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
+0001a3c0: 2020 2020 2020 2020 2020 2020 206b 6572               ker
+0001a3d0: 6e65 6c5f 696e 6974 6961 6c69 7a65 723d  nel_initializer=
+0001a3e0: 2268 655f 756e 6966 6f72 6d22 2c0d 0a20  "he_uniform",.. 
+0001a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a400: 2020 2020 2020 2062 6961 735f 696e 6974         bias_init
+0001a410: 6961 6c69 7a65 723d 436f 6e73 7461 6e74  ializer=Constant
+0001a420: 2830 2e31 292c 0d0a 2020 2020 2020 2020  (0.1),..        
+0001a430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a440: 6461 7461 5f66 6f72 6d61 743d 2263 6861  data_format="cha
+0001a450: 6e6e 656c 735f 6c61 7374 222c 0d0a 2020  nnels_last",..  
+0001a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a470: 2020 2020 2020 2364 6174 615f 666f 726d        #data_form
+0001a480: 6174 3d22 6368 616e 6e65 6c73 5f66 6972  at="channels_fir
+0001a490: 7374 222c 0d0a 2020 2020 2020 2020 2020  st",..          
+0001a4a0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+0001a4b0: 726e 656c 5f72 6567 756c 6172 697a 6572  rnel_regularizer
+0001a4c0: 3d6b 5f72 6567 2e6c 3228 7365 6c66 2e73  =k_reg.l2(self.s
+0001a4d0: 7065 6373 5b27 6c32 5f6c 616d 6264 6127  pecs['l2_lambda'
+0001a4e0: 5d29 290d 0a20 2020 2020 2020 2073 636f  ]))..        sco
+0001a4f0: 6e76 315f 6f75 7420 3d20 7363 6f6e 7631  nv1_out = sconv1
+0001a500: 2874 636f 6e76 315f 6f75 7429 0d0a 2020  (tconv1_out)..  
+0001a510: 2020 2020 2020 7072 696e 7428 2773 636f        print('sco
+0001a520: 6e76 313a 272c 2020 7363 6f6e 7631 5f6f  nv1:',  sconv1_o
+0001a530: 7574 2e73 6861 7065 290d 0a0d 0a20 2020  ut.shape)....   
+0001a540: 2020 2020 2070 6f6f 6c31 203d 2054 656d       pool1 = Tem
+0001a550: 7050 6f6f 6c69 6e67 2870 6f6f 6c69 6e67  pPooling(pooling
+0001a560: 3d73 656c 662e 7370 6563 735b 2770 6f6f  =self.specs['poo
+0001a570: 6c69 6e67 275d 2c0d 0a20 2020 2020 2020  ling'],..       
+0001a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a590: 2020 2020 2020 2020 2020 2070 6f6f 6c5f             pool_
+0001a5a0: 7479 7065 3d22 6176 6722 2c0d 0a20 2020  type="avg",..   
+0001a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a5c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001a5d0: 7472 6964 653d 7365 6c66 2e73 7065 6373  tride=self.specs
+0001a5e0: 5b27 7374 7269 6465 275d 2c0d 0a20 2020  ['stride'],..   
 0001a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a600: 2020 2020 2020 7374 7269 6465 733d 312c        strides=1,
-0001a610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a620: 2020 2020 2020 2020 2020 7061 6464 696e            paddin
-0001a630: 673d 7365 6c66 2e73 7065 6373 5b27 7061  g=self.specs['pa
-0001a640: 6464 696e 6727 5d2c 0d0a 2020 2020 2020  dding'],..      
-0001a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a660: 2020 6163 7469 7661 7469 6f6e 3d73 656c    activation=sel
-0001a670: 662e 7370 6563 735b 276e 6f6e 6c69 6e27  f.specs['nonlin'
-0001a680: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-0001a690: 2020 2020 2020 2020 2020 2020 6b65 726e              kern
-0001a6a0: 656c 5f69 6e69 7469 616c 697a 6572 3d22  el_initializer="
-0001a6b0: 6865 5f75 6e69 666f 726d 222c 0d0a 2020  he_uniform",..  
-0001a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6d0: 2020 2020 2020 6269 6173 5f69 6e69 7469        bias_initi
-0001a6e0: 616c 697a 6572 3d43 6f6e 7374 616e 7428  alizer=Constant(
-0001a6f0: 302e 3129 2c0d 0a20 2020 2020 2020 2020  0.1),..         
-0001a700: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001a710: 6174 615f 666f 726d 6174 3d22 6368 616e  ata_format="chan
-0001a720: 6e65 6c73 5f6c 6173 7422 2c0d 0a20 2020  nels_last",..   
-0001a730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a740: 2020 2020 2023 6461 7461 5f66 6f72 6d61       #data_forma
-0001a750: 743d 2263 6861 6e6e 656c 735f 6669 7273  t="channels_firs
-0001a760: 7422 2c0d 0a20 2020 2020 2020 2020 2020  t",..           
-0001a770: 2020 2020 2020 2020 2020 2020 206b 6572               ker
-0001a780: 6e65 6c5f 7265 6775 6c61 7269 7a65 723d  nel_regularizer=
-0001a790: 6b5f 7265 672e 6c32 2873 656c 662e 7370  k_reg.l2(self.sp
-0001a7a0: 6563 735b 276c 325f 6c61 6d62 6461 275d  ecs['l2_lambda']
-0001a7b0: 2929 0d0a 2020 2020 2020 2020 7363 6f6e  ))..        scon
-0001a7c0: 7631 5f6f 7574 203d 2073 636f 6e76 3128  v1_out = sconv1(
-0001a7d0: 7463 6f6e 7631 5f6f 7574 290d 0a20 2020  tconv1_out)..   
-0001a7e0: 2020 2020 2070 7269 6e74 2827 7363 6f6e       print('scon
-0001a7f0: 7631 3a27 2c20 2073 636f 6e76 315f 6f75  v1:',  sconv1_ou
-0001a800: 742e 7368 6170 6529 0d0a 0d0a 2020 2020  t.shape)....    
-0001a810: 2020 2020 706f 6f6c 3120 3d20 5465 6d70      pool1 = Temp
-0001a820: 506f 6f6c 696e 6728 706f 6f6c 696e 673d  Pooling(pooling=
-0001a830: 7365 6c66 2e73 7065 6373 5b27 706f 6f6c  self.specs['pool
-0001a840: 696e 6727 5d2c 0d0a 2020 2020 2020 2020  ing'],..        
+0001a600: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001a610: 6164 6469 6e67 3d27 5341 4d45 272c 0d0a  adding='SAME',..
+0001a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a640: 2020 2928 7363 6f6e 7631 5f6f 7574 290d    )(sconv1_out).
+0001a650: 0a0d 0a20 2020 2020 2020 2070 7269 6e74  ...        print
+0001a660: 2827 706f 6f6c 313a 2027 2c20 706f 6f6c  ('pool1: ', pool
+0001a670: 312e 7368 6170 6529 0d0a 0d0a 2020 2020  1.shape)....    
+0001a680: 2020 2020 2323 2323 2323 2323 2323 2323      ############
+0001a690: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001a6a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001a6b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001a6c0: 0d0a 0d0a 2020 2020 2020 2020 7473 636f  ....        tsco
+0001a6d0: 6e76 3220 3d20 436f 6e76 3244 2866 696c  nv2 = Conv2D(fil
+0001a6e0: 7465 7273 3d73 656c 662e 7370 6563 735b  ters=self.specs[
+0001a6f0: 276e 5f6c 6174 656e 7427 5d2a 322c 0d0a  'n_latent']*2,..
+0001a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a710: 2020 2020 2020 2020 6b65 726e 656c 5f73          kernel_s
+0001a720: 697a 653d 2831 2c20 7365 6c66 2e73 7065  ize=(1, self.spe
+0001a730: 6373 5b27 6669 6c74 6572 5f6c 656e 6774  cs['filter_lengt
+0001a740: 6827 5d29 2c0d 0a20 2020 2020 2020 2020  h']),..         
+0001a750: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001a760: 7472 6964 6573 3d31 2c0d 0a20 2020 2020  trides=1,..     
+0001a770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a780: 2020 2070 6164 6469 6e67 3d73 656c 662e     padding=self.
+0001a790: 7370 6563 735b 2770 6164 6469 6e67 275d  specs['padding']
+0001a7a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001a7b0: 2020 2020 2020 2020 2020 2061 6374 6976             activ
+0001a7c0: 6174 696f 6e3d 7365 6c66 2e73 7065 6373  ation=self.specs
+0001a7d0: 5b27 6e6f 6e6c 696e 275d 2c0d 0a20 2020  ['nonlin'],..   
+0001a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7f0: 2020 2020 206b 6572 6e65 6c5f 696e 6974       kernel_init
+0001a800: 6961 6c69 7a65 723d 2268 655f 756e 6966  ializer="he_unif
+0001a810: 6f72 6d22 2c0d 0a20 2020 2020 2020 2020  orm",..         
+0001a820: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001a830: 6961 735f 696e 6974 6961 6c69 7a65 723d  ias_initializer=
+0001a840: 436f 6e73 7461 6e74 2830 2e31 292c 0d0a  Constant(0.1),..
 0001a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a860: 2020 2020 2020 2020 2020 706f 6f6c 5f74            pool_t
-0001a870: 7970 653d 2261 7667 222c 0d0a 2020 2020  ype="avg",..    
-0001a880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a890: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0001a8a0: 7269 6465 3d73 656c 662e 7370 6563 735b  ride=self.specs[
-0001a8b0: 2773 7472 6964 6527 5d2c 0d0a 2020 2020  'stride'],..    
+0001a860: 2020 2020 2020 2020 6461 7461 5f66 6f72          data_for
+0001a870: 6d61 743d 2263 6861 6e6e 656c 735f 6c61  mat="channels_la
+0001a880: 7374 222c 0d0a 2020 2020 2020 2020 2020  st",..          
+0001a890: 2020 2020 2020 2020 2020 2020 2020 2364                #d
+0001a8a0: 6174 615f 666f 726d 6174 3d22 6368 616e  ata_format="chan
+0001a8b0: 6e65 6c73 5f66 6972 7374 222c 0d0a 2020  nels_first",..  
 0001a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8d0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0001a8e0: 6464 696e 673d 2753 414d 4527 2c0d 0a20  dding='SAME',.. 
-0001a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a910: 2029 2873 636f 6e76 315f 6f75 7429 0d0a   )(sconv1_out)..
-0001a920: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
-0001a930: 2770 6f6f 6c31 3a20 272c 2070 6f6f 6c31  'pool1: ', pool1
-0001a940: 2e73 6861 7065 290d 0a0d 0a20 2020 2020  .shape)....     
-0001a950: 2020 2023 2323 2323 2323 2323 2323 2323     #############
-0001a960: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a970: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a980: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
-0001a990: 0a0d 0a20 2020 2020 2020 2074 7363 6f6e  ...        tscon
-0001a9a0: 7632 203d 2043 6f6e 7632 4428 6669 6c74  v2 = Conv2D(filt
-0001a9b0: 6572 733d 7365 6c66 2e73 7065 6373 5b27  ers=self.specs['
-0001a9c0: 6e5f 6c61 7465 6e74 275d 2a32 2c0d 0a20  n_latent']*2,.. 
-0001a9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9e0: 2020 2020 2020 206b 6572 6e65 6c5f 7369         kernel_si
-0001a9f0: 7a65 3d28 312c 2073 656c 662e 7370 6563  ze=(1, self.spec
-0001aa00: 735b 2766 696c 7465 725f 6c65 6e67 7468  s['filter_length
-0001aa10: 275d 292c 0d0a 2020 2020 2020 2020 2020  ']),..          
-0001aa20: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0001aa30: 7269 6465 733d 312c 0d0a 2020 2020 2020  rides=1,..      
-0001aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa50: 2020 7061 6464 696e 673d 7365 6c66 2e73    padding=self.s
-0001aa60: 7065 6373 5b27 7061 6464 696e 6727 5d2c  pecs['padding'],
-0001aa70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001aa80: 2020 2020 2020 2020 2020 6163 7469 7661            activa
-0001aa90: 7469 6f6e 3d73 656c 662e 7370 6563 735b  tion=self.specs[
-0001aaa0: 276e 6f6e 6c69 6e27 5d2c 0d0a 2020 2020  'nonlin'],..    
-0001aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aac0: 2020 2020 6b65 726e 656c 5f69 6e69 7469      kernel_initi
-0001aad0: 616c 697a 6572 3d22 6865 5f75 6e69 666f  alizer="he_unifo
-0001aae0: 726d 222c 0d0a 2020 2020 2020 2020 2020  rm",..          
-0001aaf0: 2020 2020 2020 2020 2020 2020 2020 6269                bi
-0001ab00: 6173 5f69 6e69 7469 616c 697a 6572 3d43  as_initializer=C
-0001ab10: 6f6e 7374 616e 7428 302e 3129 2c0d 0a20  onstant(0.1),.. 
-0001ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab30: 2020 2020 2020 2064 6174 615f 666f 726d         data_form
-0001ab40: 6174 3d22 6368 616e 6e65 6c73 5f6c 6173  at="channels_las
-0001ab50: 7422 2c0d 0a20 2020 2020 2020 2020 2020  t",..           
-0001ab60: 2020 2020 2020 2020 2020 2020 2023 6461               #da
-0001ab70: 7461 5f66 6f72 6d61 743d 2263 6861 6e6e  ta_format="chann
-0001ab80: 656c 735f 6669 7273 7422 2c0d 0a20 2020  els_first",..   
-0001ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aba0: 2020 2020 206b 6572 6e65 6c5f 7265 6775       kernel_regu
-0001abb0: 6c61 7269 7a65 723d 6b5f 7265 672e 6c32  larizer=k_reg.l2
-0001abc0: 2873 656c 662e 7370 6563 735b 276c 325f  (self.specs['l2_
-0001abd0: 6c61 6d62 6461 275d 2929 0d0a 0d0a 0d0a  lambda']))......
-0001abe0: 2020 2020 2020 2020 7473 636f 6e76 325f          tsconv2_
-0001abf0: 6f75 7420 3d20 7473 636f 6e76 3228 706f  out = tsconv2(po
-0001ac00: 6f6c 3129 0d0a 2020 2020 2020 2020 7072  ol1)..        pr
-0001ac10: 696e 7428 2774 7363 6f6e 7632 3a27 2c20  int('tsconv2:', 
-0001ac20: 2074 7363 6f6e 7632 5f6f 7574 2e73 6861   tsconv2_out.sha
-0001ac30: 7065 290d 0a0d 0a20 2020 2020 2020 2070  pe)....        p
-0001ac40: 6f6f 6c32 203d 2054 656d 7050 6f6f 6c69  ool2 = TempPooli
-0001ac50: 6e67 2870 6f6f 6c69 6e67 3d73 656c 662e  ng(pooling=self.
-0001ac60: 7370 6563 735b 2770 6f6f 6c69 6e67 275d  specs['pooling']
-0001ac70: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001a8d0: 2020 2020 2020 6b65 726e 656c 5f72 6567        kernel_reg
+0001a8e0: 756c 6172 697a 6572 3d6b 5f72 6567 2e6c  ularizer=k_reg.l
+0001a8f0: 3228 7365 6c66 2e73 7065 6373 5b27 6c32  2(self.specs['l2
+0001a900: 5f6c 616d 6264 6127 5d29 290d 0a0d 0a0d  _lambda'])).....
+0001a910: 0a20 2020 2020 2020 2074 7363 6f6e 7632  .        tsconv2
+0001a920: 5f6f 7574 203d 2074 7363 6f6e 7632 2870  _out = tsconv2(p
+0001a930: 6f6f 6c31 290d 0a20 2020 2020 2020 2070  ool1)..        p
+0001a940: 7269 6e74 2827 7473 636f 6e76 323a 272c  rint('tsconv2:',
+0001a950: 2020 7473 636f 6e76 325f 6f75 742e 7368    tsconv2_out.sh
+0001a960: 6170 6529 0d0a 0d0a 2020 2020 2020 2020  ape)....        
+0001a970: 706f 6f6c 3220 3d20 5465 6d70 506f 6f6c  pool2 = TempPool
+0001a980: 696e 6728 706f 6f6c 696e 673d 7365 6c66  ing(pooling=self
+0001a990: 2e73 7065 6373 5b27 706f 6f6c 696e 6727  .specs['pooling'
+0001a9a0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+0001a9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9c0: 2020 2020 2020 706f 6f6c 5f74 7970 653d        pool_type=
+0001a9d0: 2261 7667 222c 0d0a 2020 2020 2020 2020  "avg",..        
+0001a9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9f0: 2020 2020 2020 2020 2020 7374 7269 6465            stride
+0001aa00: 3d73 656c 662e 7370 6563 735b 2773 7472  =self.specs['str
+0001aa10: 6964 6527 5d2c 0d0a 2020 2020 2020 2020  ide'],..        
+0001aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa30: 2020 2020 2020 2020 2020 7061 6464 696e            paddin
+0001aa40: 673d 2753 414d 4527 2c0d 0a20 2020 2020  g='SAME',..     
+0001aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa60: 2020 2020 2020 2020 2020 2020 2029 2874               )(t
+0001aa70: 7363 6f6e 7632 5f6f 7574 290d 0a0d 0a20  sconv2_out).... 
+0001aa80: 2020 2020 2020 2070 7269 6e74 2827 706f         print('po
+0001aa90: 6f6c 323a 2027 2c20 706f 6f6c 322e 7368  ol2: ', pool2.sh
+0001aaa0: 6170 6529 0d0a 0d0a 0d0a 2020 2020 2020  ape)......      
+0001aab0: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+0001aac0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001aad0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001aae0: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
+0001aaf0: 0d0a 2020 2020 2020 2020 7473 636f 6e76  ..        tsconv
+0001ab00: 3320 3d20 436f 6e76 3244 2866 696c 7465  3 = Conv2D(filte
+0001ab10: 7273 3d73 656c 662e 7370 6563 735b 276e  rs=self.specs['n
+0001ab20: 5f6c 6174 656e 7427 5d2a 342c 0d0a 2020  _latent']*4,..  
+0001ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab40: 2020 2020 2020 6b65 726e 656c 5f73 697a        kernel_siz
+0001ab50: 653d 2831 2c20 7365 6c66 2e73 7065 6373  e=(1, self.specs
+0001ab60: 5b27 6669 6c74 6572 5f6c 656e 6774 6827  ['filter_length'
+0001ab70: 5d29 2c0d 0a20 2020 2020 2020 2020 2020  ]),..           
+0001ab80: 2020 2020 2020 2020 2020 2020 2073 7472               str
+0001ab90: 6964 6573 3d31 2c0d 0a20 2020 2020 2020  ides=1,..       
+0001aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abb0: 2070 6164 6469 6e67 3d73 656c 662e 7370   padding=self.sp
+0001abc0: 6563 735b 2770 6164 6469 6e67 275d 2c0d  ecs['padding'],.
+0001abd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001abe0: 2020 2020 2020 2020 2061 6374 6976 6174           activat
+0001abf0: 696f 6e3d 7365 6c66 2e73 7065 6373 5b27  ion=self.specs['
+0001ac00: 6e6f 6e6c 696e 275d 2c0d 0a20 2020 2020  nonlin'],..     
+0001ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac20: 2020 206b 6572 6e65 6c5f 696e 6974 6961     kernel_initia
+0001ac30: 6c69 7a65 723d 2268 655f 756e 6966 6f72  lizer="he_unifor
+0001ac40: 6d22 2c0d 0a20 2020 2020 2020 2020 2020  m",..           
+0001ac50: 2020 2020 2020 2020 2020 2020 2062 6961               bia
+0001ac60: 735f 696e 6974 6961 6c69 7a65 723d 436f  s_initializer=Co
+0001ac70: 6e73 7461 6e74 2830 2e31 292c 0d0a 2020  nstant(0.1),..  
 0001ac80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac90: 2020 2020 2070 6f6f 6c5f 7479 7065 3d22       pool_type="
-0001aca0: 6176 6722 2c0d 0a20 2020 2020 2020 2020  avg",..         
-0001acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001acc0: 2020 2020 2020 2020 2073 7472 6964 653d           stride=
-0001acd0: 7365 6c66 2e73 7065 6373 5b27 7374 7269  self.specs['stri
-0001ace0: 6465 275d 2c0d 0a20 2020 2020 2020 2020  de'],..         
+0001ac90: 2020 2020 2020 6461 7461 5f66 6f72 6d61        data_forma
+0001aca0: 743d 2263 6861 6e6e 656c 735f 6c61 7374  t="channels_last
+0001acb0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+0001acc0: 2020 2020 2020 2020 2020 2020 2364 6174              #dat
+0001acd0: 615f 666f 726d 6174 3d22 6368 616e 6e65  a_format="channe
+0001ace0: 6c73 5f66 6972 7374 222c 0d0a 2020 2020  ls_first",..    
 0001acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad00: 2020 2020 2020 2020 2070 6164 6469 6e67           padding
-0001ad10: 3d27 5341 4d45 272c 0d0a 2020 2020 2020  ='SAME',..      
-0001ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad30: 2020 2020 2020 2020 2020 2020 2928 7473              )(ts
-0001ad40: 636f 6e76 325f 6f75 7429 0d0a 0d0a 2020  conv2_out)....  
-0001ad50: 2020 2020 2020 7072 696e 7428 2770 6f6f        print('poo
-0001ad60: 6c32 3a20 272c 2070 6f6f 6c32 2e73 6861  l2: ', pool2.sha
-0001ad70: 7065 290d 0a0d 0a0d 0a20 2020 2020 2020  pe)......       
-0001ad80: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-0001ad90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001ada0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001adb0: 2323 2323 2323 2323 2323 2323 230d 0a0d  #############...
-0001adc0: 0a20 2020 2020 2020 2074 7363 6f6e 7633  .        tsconv3
-0001add0: 203d 2043 6f6e 7632 4428 6669 6c74 6572   = Conv2D(filter
-0001ade0: 733d 7365 6c66 2e73 7065 6373 5b27 6e5f  s=self.specs['n_
-0001adf0: 6c61 7465 6e74 275d 2a34 2c0d 0a20 2020  latent']*4,..   
-0001ae00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae10: 2020 2020 206b 6572 6e65 6c5f 7369 7a65       kernel_size
-0001ae20: 3d28 312c 2073 656c 662e 7370 6563 735b  =(1, self.specs[
-0001ae30: 2766 696c 7465 725f 6c65 6e67 7468 275d  'filter_length']
-0001ae40: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-0001ae50: 2020 2020 2020 2020 2020 2020 7374 7269              stri
-0001ae60: 6465 733d 312c 0d0a 2020 2020 2020 2020  des=1,..        
-0001ae70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae80: 7061 6464 696e 673d 7365 6c66 2e73 7065  padding=self.spe
-0001ae90: 6373 5b27 7061 6464 696e 6727 5d2c 0d0a  cs['padding'],..
-0001aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aeb0: 2020 2020 2020 2020 6163 7469 7661 7469          activati
-0001aec0: 6f6e 3d73 656c 662e 7370 6563 735b 276e  on=self.specs['n
-0001aed0: 6f6e 6c69 6e27 5d2c 0d0a 2020 2020 2020  onlin'],..      
-0001aee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aef0: 2020 6b65 726e 656c 5f69 6e69 7469 616c    kernel_initial
-0001af00: 697a 6572 3d22 6865 5f75 6e69 666f 726d  izer="he_uniform
-0001af10: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-0001af20: 2020 2020 2020 2020 2020 2020 6269 6173              bias
-0001af30: 5f69 6e69 7469 616c 697a 6572 3d43 6f6e  _initializer=Con
-0001af40: 7374 616e 7428 302e 3129 2c0d 0a20 2020  stant(0.1),..   
-0001af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af60: 2020 2020 2064 6174 615f 666f 726d 6174       data_format
-0001af70: 3d22 6368 616e 6e65 6c73 5f6c 6173 7422  ="channels_last"
-0001af80: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0001af90: 2020 2020 2020 2020 2020 2023 6461 7461             #data
-0001afa0: 5f66 6f72 6d61 743d 2263 6861 6e6e 656c  _format="channel
-0001afb0: 735f 6669 7273 7422 2c0d 0a20 2020 2020  s_first",..     
-0001afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afd0: 2020 206b 6572 6e65 6c5f 7265 6775 6c61     kernel_regula
-0001afe0: 7269 7a65 723d 6b5f 7265 672e 6c32 2873  rizer=k_reg.l2(s
-0001aff0: 656c 662e 7370 6563 735b 276c 325f 6c61  elf.specs['l2_la
-0001b000: 6d62 6461 275d 2929 0d0a 0d0a 0d0a 2020  mbda']))......  
-0001b010: 2020 2020 2020 7473 636f 6e76 335f 6f75        tsconv3_ou
-0001b020: 7420 3d20 7473 636f 6e76 3328 706f 6f6c  t = tsconv3(pool
-0001b030: 3229 0d0a 2020 2020 2020 2020 7072 696e  2)..        prin
-0001b040: 7428 2774 7363 6f6e 7633 3a27 2c20 2074  t('tsconv3:',  t
-0001b050: 7363 6f6e 7633 5f6f 7574 2e73 6861 7065  sconv3_out.shape
-0001b060: 290d 0a0d 0a20 2020 2020 2020 2070 6f6f  )....        poo
-0001b070: 6c33 203d 2054 656d 7050 6f6f 6c69 6e67  l3 = TempPooling
-0001b080: 2870 6f6f 6c69 6e67 3d73 656c 662e 7370  (pooling=self.sp
-0001b090: 6563 735b 2770 6f6f 6c69 6e67 275d 2c0d  ecs['pooling'],.
-0001b0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ad00: 2020 2020 6b65 726e 656c 5f72 6567 756c      kernel_regul
+0001ad10: 6172 697a 6572 3d6b 5f72 6567 2e6c 3228  arizer=k_reg.l2(
+0001ad20: 7365 6c66 2e73 7065 6373 5b27 6c32 5f6c  self.specs['l2_l
+0001ad30: 616d 6264 6127 5d29 290d 0a0d 0a0d 0a20  ambda']))...... 
+0001ad40: 2020 2020 2020 2074 7363 6f6e 7633 5f6f         tsconv3_o
+0001ad50: 7574 203d 2074 7363 6f6e 7633 2870 6f6f  ut = tsconv3(poo
+0001ad60: 6c32 290d 0a20 2020 2020 2020 2070 7269  l2)..        pri
+0001ad70: 6e74 2827 7473 636f 6e76 333a 272c 2020  nt('tsconv3:',  
+0001ad80: 7473 636f 6e76 335f 6f75 742e 7368 6170  tsconv3_out.shap
+0001ad90: 6529 0d0a 0d0a 2020 2020 2020 2020 706f  e)....        po
+0001ada0: 6f6c 3320 3d20 5465 6d70 506f 6f6c 696e  ol3 = TempPoolin
+0001adb0: 6728 706f 6f6c 696e 673d 7365 6c66 2e73  g(pooling=self.s
+0001adc0: 7065 6373 5b27 706f 6f6c 696e 6727 5d2c  pecs['pooling'],
+0001add0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001adf0: 2020 2020 706f 6f6c 5f74 7970 653d 2261      pool_type="a
+0001ae00: 7667 222c 0d0a 2020 2020 2020 2020 2020  vg",..          
+0001ae10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae20: 2020 2020 2020 2020 7374 7269 6465 3d73          stride=s
+0001ae30: 656c 662e 7370 6563 735b 2773 7472 6964  elf.specs['strid
+0001ae40: 6527 5d2c 0d0a 2020 2020 2020 2020 2020  e'],..          
+0001ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae60: 2020 2020 2020 2020 7061 6464 696e 673d          padding=
+0001ae70: 2753 414d 4527 2c0d 0a20 2020 2020 2020  'SAME',..       
+0001ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae90: 2020 2020 2020 2020 2020 2029 2874 7363             )(tsc
+0001aea0: 6f6e 7633 5f6f 7574 290d 0a0d 0a20 2020  onv3_out)....   
+0001aeb0: 2020 2020 2070 7269 6e74 2827 706f 6f6c       print('pool
+0001aec0: 333a 2027 2c20 706f 6f6c 332e 7368 6170  3: ', pool3.shap
+0001aed0: 6529 0d0a 0d0a 2020 2020 2020 2020 2323  e)....        ##
+0001aee0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001aef0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001af00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001af10: 2323 2323 2323 2323 2323 0d0a 0d0a 2020  ##########....  
+0001af20: 2020 2020 2020 7473 636f 6e76 3420 3d20        tsconv4 = 
+0001af30: 436f 6e76 3244 2866 696c 7465 7273 3d73  Conv2D(filters=s
+0001af40: 656c 662e 7370 6563 735b 276e 5f6c 6174  elf.specs['n_lat
+0001af50: 656e 7427 5d2a 382c 0d0a 2020 2020 2020  ent']*8,..      
+0001af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af70: 2020 6b65 726e 656c 5f73 697a 653d 2831    kernel_size=(1
+0001af80: 2c20 7365 6c66 2e73 7065 6373 5b27 6669  , self.specs['fi
+0001af90: 6c74 6572 5f6c 656e 6774 6827 5d29 2c0d  lter_length']),.
+0001afa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001afb0: 2020 2020 2020 2020 2073 7472 6964 6573           strides
+0001afc0: 3d31 2c0d 0a20 2020 2020 2020 2020 2020  =1,..           
+0001afd0: 2020 2020 2020 2020 2020 2020 2070 6164               pad
+0001afe0: 6469 6e67 3d73 656c 662e 7370 6563 735b  ding=self.specs[
+0001aff0: 2770 6164 6469 6e67 275d 2c0d 0a20 2020  'padding'],..   
+0001b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b010: 2020 2020 2061 6374 6976 6174 696f 6e3d       activation=
+0001b020: 7365 6c66 2e73 7065 6373 5b27 6e6f 6e6c  self.specs['nonl
+0001b030: 696e 275d 2c0d 0a20 2020 2020 2020 2020  in'],..         
+0001b040: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0001b050: 6572 6e65 6c5f 696e 6974 6961 6c69 7a65  ernel_initialize
+0001b060: 723d 2268 655f 756e 6966 6f72 6d22 2c0d  r="he_uniform",.
+0001b070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b080: 2020 2020 2020 2020 2062 6961 735f 696e           bias_in
+0001b090: 6974 6961 6c69 7a65 723d 436f 6e73 7461  itializer=Consta
+0001b0a0: 6e74 2830 2e31 292c 0d0a 2020 2020 2020  nt(0.1),..      
 0001b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0c0: 2020 2070 6f6f 6c5f 7479 7065 3d22 6176     pool_type="av
-0001b0d0: 6722 2c0d 0a20 2020 2020 2020 2020 2020  g",..           
+0001b0c0: 2020 6461 7461 5f66 6f72 6d61 743d 2263    data_format="c
+0001b0d0: 6861 6e6e 656c 735f 6c61 7374 222c 0d0a  hannels_last",..
 0001b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0f0: 2020 2020 2020 2073 7472 6964 653d 7365         stride=se
-0001b100: 6c66 2e73 7065 6373 5b27 7374 7269 6465  lf.specs['stride
-0001b110: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
+0001b0f0: 2020 2020 2020 2020 2364 6174 615f 666f          #data_fo
+0001b100: 726d 6174 3d22 6368 616e 6e65 6c73 5f66  rmat="channels_f
+0001b110: 6972 7374 222c 0d0a 2020 2020 2020 2020  irst",..        
 0001b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b130: 2020 2020 2020 2070 6164 6469 6e67 3d27         padding='
-0001b140: 5341 4d45 272c 0d0a 2020 2020 2020 2020  SAME',..        
-0001b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b160: 2020 2020 2020 2020 2020 2928 7473 636f            )(tsco
-0001b170: 6e76 335f 6f75 7429 0d0a 0d0a 2020 2020  nv3_out)....    
-0001b180: 2020 2020 7072 696e 7428 2770 6f6f 6c33      print('pool3
-0001b190: 3a20 272c 2070 6f6f 6c33 2e73 6861 7065  : ', pool3.shape
-0001b1a0: 290d 0a0d 0a20 2020 2020 2020 2023 2323  )....        ###
-0001b1b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001b1c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001b1d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001b1e0: 2323 2323 2323 2323 230d 0a0d 0a20 2020  #########....   
-0001b1f0: 2020 2020 2074 7363 6f6e 7634 203d 2043       tsconv4 = C
-0001b200: 6f6e 7632 4428 6669 6c74 6572 733d 7365  onv2D(filters=se
-0001b210: 6c66 2e73 7065 6373 5b27 6e5f 6c61 7465  lf.specs['n_late
-0001b220: 6e74 275d 2a38 2c0d 0a20 2020 2020 2020  nt']*8,..       
-0001b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b240: 206b 6572 6e65 6c5f 7369 7a65 3d28 312c   kernel_size=(1,
-0001b250: 2073 656c 662e 7370 6563 735b 2766 696c   self.specs['fil
-0001b260: 7465 725f 6c65 6e67 7468 275d 292c 0d0a  ter_length']),..
-0001b270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b280: 2020 2020 2020 2020 7374 7269 6465 733d          strides=
-0001b290: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
-0001b2a0: 2020 2020 2020 2020 2020 2020 7061 6464              padd
-0001b2b0: 696e 673d 7365 6c66 2e73 7065 6373 5b27  ing=self.specs['
-0001b2c0: 7061 6464 696e 6727 5d2c 0d0a 2020 2020  padding'],..    
-0001b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b2e0: 2020 2020 6163 7469 7661 7469 6f6e 3d73      activation=s
-0001b2f0: 656c 662e 7370 6563 735b 276e 6f6e 6c69  elf.specs['nonli
-0001b300: 6e27 5d2c 0d0a 2020 2020 2020 2020 2020  n'],..          
-0001b310: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-0001b320: 726e 656c 5f69 6e69 7469 616c 697a 6572  rnel_initializer
-0001b330: 3d22 6865 5f75 6e69 666f 726d 222c 0d0a  ="he_uniform",..
-0001b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b350: 2020 2020 2020 2020 6269 6173 5f69 6e69          bias_ini
-0001b360: 7469 616c 697a 6572 3d43 6f6e 7374 616e  tializer=Constan
-0001b370: 7428 302e 3129 2c0d 0a20 2020 2020 2020  t(0.1),..       
-0001b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b390: 2064 6174 615f 666f 726d 6174 3d22 6368   data_format="ch
-0001b3a0: 616e 6e65 6c73 5f6c 6173 7422 2c0d 0a20  annels_last",.. 
-0001b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3c0: 2020 2020 2020 2023 6461 7461 5f66 6f72         #data_for
-0001b3d0: 6d61 743d 2263 6861 6e6e 656c 735f 6669  mat="channels_fi
-0001b3e0: 7273 7422 2c0d 0a20 2020 2020 2020 2020  rst",..         
-0001b3f0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-0001b400: 6572 6e65 6c5f 7265 6775 6c61 7269 7a65  ernel_regularize
-0001b410: 723d 6b5f 7265 672e 6c32 2873 656c 662e  r=k_reg.l2(self.
-0001b420: 7370 6563 735b 276c 325f 6c61 6d62 6461  specs['l2_lambda
-0001b430: 275d 2929 0d0a 0d0a 0d0a 2020 2020 2020  ']))......      
-0001b440: 2020 7473 636f 6e76 345f 6f75 7420 3d20    tsconv4_out = 
-0001b450: 7473 636f 6e76 3428 706f 6f6c 3329 0d0a  tsconv4(pool3)..
-0001b460: 2020 2020 2020 2020 7072 696e 7428 2774          print('t
-0001b470: 7363 6f6e 7634 3a27 2c20 2074 7363 6f6e  sconv4:',  tscon
-0001b480: 7634 5f6f 7574 2e73 6861 7065 290d 0a0d  v4_out.shape)...
-0001b490: 0a20 2020 2020 2020 2070 6f6f 6c34 203d  .        pool4 =
-0001b4a0: 2054 656d 7050 6f6f 6c69 6e67 2870 6f6f   TempPooling(poo
-0001b4b0: 6c69 6e67 3d73 656c 662e 7370 6563 735b  ling=self.specs[
-0001b4c0: 2770 6f6f 6c69 6e67 275d 2c0d 0a20 2020  'pooling'],..   
-0001b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001b4f0: 6f6f 6c5f 7479 7065 3d22 6176 6722 2c0d  ool_type="avg",.
-0001b500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b520: 2020 2073 7472 6964 653d 7365 6c66 2e73     stride=self.s
-0001b530: 7065 6373 5b27 7374 7269 6465 275d 2c0d  pecs['stride'],.
-0001b540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b560: 2020 2070 6164 6469 6e67 3d27 5341 4d45     padding='SAME
-0001b570: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-0001b580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b590: 2020 2020 2020 2928 7473 636f 6e76 345f        )(tsconv4_
-0001b5a0: 6f75 7429 0d0a 0d0a 2020 2020 2020 2020  out)....        
-0001b5b0: 7072 696e 7428 2770 6f6f 6c34 3a20 272c  print('pool4: ',
-0001b5c0: 2070 6f6f 6c34 2e73 6861 7065 290d 0a0d   pool4.shape)...
-0001b5d0: 0a0d 0a20 2020 2020 2020 2066 635f 6f75  ...        fc_ou
-0001b5e0: 7420 3d20 4675 6c6c 7943 6f6e 6e65 6374  t = FullyConnect
-0001b5f0: 6564 2873 697a 653d 7365 6c66 2e6f 7574  ed(size=self.out
-0001b600: 5f64 696d 2c20 6e6f 6e6c 696e 3d74 662e  _dim, nonlin=tf.
-0001b610: 6964 656e 7469 7479 2c0d 0a20 2020 2020  identity,..     
-0001b620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b630: 2020 2020 2020 2073 7065 6373 3d73 656c         specs=sel
-0001b640: 662e 7370 6563 7329 0d0a 2020 2020 2020  f.specs)..      
-0001b650: 2020 795f 7072 6564 203d 2066 635f 6f75    y_pred = fc_ou
-0001b660: 7428 706f 6f6c 3429 0d0a 2020 2020 2020  t(pool4)..      
-0001b670: 2020 7265 7475 726e 2079 5f70 7265 640d    return y_pred.
-0001b680: 0a23 0d0a 230d 0a0d 0a63 6c61 7373 2045  .#..#....class E
-0001b690: 4547 4e65 7428 4261 7365 4d6f 6465 6c29  EGNet(BaseModel)
-0001b6a0: 3a0d 0a20 2020 2022 2222 4545 474e 6574  :..    """EEGNet
-0001b6b0: 2e0d 0a0d 0a20 2020 2050 6172 616d 6574  .....    Paramet
-0001b6c0: 6572 730d 0a20 2020 202d 2d2d 2d2d 2d2d  ers..    -------
-0001b6d0: 2d2d 2d0d 0a20 2020 2073 7065 6373 203a  ---..    specs :
-0001b6e0: 2064 6963 740d 0a0d 0a20 2020 2020 2020   dict....       
-0001b6f0: 206e 5f6c 6174 656e 7420 3a20 696e 740d   n_latent : int.
-0001b700: 0a20 2020 2020 2020 2020 2020 204e 756d  .            Num
-0001b710: 6265 7220 6f66 2028 7465 6d70 6f72 616c  ber of (temporal
-0001b720: 2920 636f 6e76 6f6c 7574 696f 6e20 6b65  ) convolution ke
-0001b730: 726e 7265 6c73 2069 6e20 7468 6520 6669  rnrels in the fi
-0001b740: 7273 7420 6c61 7965 722e 0d0a 2020 2020  rst layer...    
-0001b750: 2020 2020 2020 2020 4465 6661 756c 7473          Defaults
-0001b760: 2074 6f20 380d 0a0d 0a20 2020 2020 2020   to 8....       
-0001b770: 2066 696c 7465 725f 6c65 6e67 7468 203a   filter_length :
-0001b780: 2069 6e74 0d0a 2020 2020 2020 2020 2020   int..          
-0001b790: 2020 4c65 6e67 7468 206f 6620 7465 6d70    Length of temp
-0001b7a0: 6f72 616c 2066 696c 7465 7273 2069 6e20  oral filters in 
-0001b7b0: 7468 6520 6669 7273 7420 6c61 7965 722e  the first layer.
-0001b7c0: 0d0a 2020 2020 2020 2020 2020 2020 4465  ..            De
-0001b7d0: 6661 756c 7473 2074 6f20 3332 0d0a 0d0a  faults to 32....
-0001b7e0: 2020 2020 2020 2020 7374 7269 6465 203a          stride :
-0001b7f0: 2069 6e74 0d0a 2020 2020 2020 2020 2020   int..          
-0001b800: 2020 5374 7269 6465 206f 6620 7468 6520    Stride of the 
-0001b810: 6176 6572 6167 6520 706f 6c6c 696e 6720  average polling 
-0001b820: 6c61 7965 7273 2e20 4465 6661 756c 7473  layers. Defaults
-0001b830: 2074 6f20 342e 0d0a 0d0a 2020 2020 2020   to 4.....      
-0001b840: 2020 706f 6f6c 696e 6720 3a20 696e 740d    pooling : int.
-0001b850: 0a20 2020 2020 2020 2020 2020 2050 6f6f  .            Poo
-0001b860: 6c69 6e67 2066 6163 746f 7220 6f66 2074  ling factor of t
-0001b870: 6865 2061 7665 7261 6765 2070 6f6c 6c69  he average polli
-0001b880: 6e67 206c 6179 6572 732e 2044 6566 6175  ng layers. Defau
-0001b890: 6c74 7320 746f 2034 2e0d 0a0d 0a20 2020  lts to 4.....   
-0001b8a0: 2020 2020 2064 726f 706f 7574 203a 2066       dropout : f
-0001b8b0: 6c6f 6174 0d0a 2020 2020 2020 2020 2020  loat..          
-0001b8c0: 2020 4472 6f70 6f75 7420 636f 6566 6669    Dropout coeffi
-0001b8d0: 6369 656e 742e 0d0a 0d0a 2020 2020 5265  cient.....    Re
-0001b8e0: 6665 7265 6e63 6573 0d0a 2020 2020 2d2d  ferences..    --
-0001b8f0: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 5b33  --------..    [3
-0001b900: 5d20 562e 4a2e 204c 6177 6865 726e 2c20  ] V.J. Lawhern, 
-0001b910: 6574 2061 6c2e 2c20 4545 474e 6574 3a20  et al., EEGNet: 
-0001b920: 4120 636f 6d70 6163 7420 636f 6e76 6f6c  A compact convol
-0001b930: 7574 696f 6e61 6c20 6e65 7572 616c 0d0a  utional neural..
-0001b940: 2020 2020 6e65 7477 6f72 6b20 666f 7220      network for 
-0001b950: 4545 472d 6261 7365 6420 6272 6169 6ee2  EEG-based brain.
-0001b960: 8093 636f 6d70 7574 6572 2069 6e74 6572  ..computer inter
-0001b970: 6661 6365 7320 3130 204a 2e20 4e65 7572  faces 10 J. Neur
-0001b980: 616c 2045 6e67 2e2c 0d0a 2020 2020 3135  al Eng.,..    15
-0001b990: 2028 3529 2028 3230 3138 292c 2070 2e20   (5) (2018), p. 
-0001b9a0: 3035 3630 3133 0d0a 0d0a 2020 2020 5b34  056013....    [4
-0001b9b0: 5d20 4f72 6967 696e 616c 2045 4547 4e65  ] Original EEGNe
-0001b9c0: 7420 696d 706c 656d 656e 7461 7469 6f6e  t implementation
-0001b9d0: 2062 7920 7468 6520 6175 7468 6f72 7320   by the authors 
-0001b9e0: 6361 6e20 6265 2066 6f75 6e64 2061 740d  can be found at.
-0001b9f0: 0a20 2020 2068 7474 7073 3a2f 2f67 6974  .    https://git
-0001ba00: 6875 622e 636f 6d2f 766c 6177 6865 726e  hub.com/vlawhern
-0001ba10: 2f61 726c 2d65 6567 6d6f 6465 6c73 0d0a  /arl-eegmodels..
-0001ba20: 2020 2020 2222 220d 0a20 2020 2064 6566      """..    def
-0001ba30: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-0001ba40: 6d65 7461 2c20 6461 7461 7365 743d 4e6f  meta, dataset=No
-0001ba50: 6e65 293a 0d0a 2020 2020 2020 2020 7365  ne):..        se
-0001ba60: 6c66 2e73 636f 7065 203d 2027 6565 676e  lf.scope = 'eegn
-0001ba70: 6574 3827 0d0a 2020 2020 2020 2020 6d65  et8'..        me
-0001ba80: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
-0001ba90: 6574 6465 6661 756c 7428 2775 6e69 746e  etdefault('unitn
-0001baa0: 6f72 6d5f 7363 6f70 6527 2c20 5b5d 290d  orm_scope', []).
-0001bab0: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
-0001bac0: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
-0001bad0: 6175 6c74 2827 6669 6c74 6572 5f6c 656e  ault('filter_len
-0001bae0: 6774 6827 2c20 3634 290d 0a20 2020 2020  gth', 64)..     
-0001baf0: 2020 206d 6574 612e 6d6f 6465 6c5f 7370     meta.model_sp
-0001bb00: 6563 732e 7365 7464 6566 6175 6c74 2827  ecs.setdefault('
-0001bb10: 6465 7074 685f 6d75 6c74 6970 6c69 6572  depth_multiplier
-0001bb20: 272c 2032 290d 0a20 2020 2020 2020 206d  ', 2)..        m
-0001bb30: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
-0001bb40: 7365 7464 6566 6175 6c74 2827 6e5f 6c61  setdefault('n_la
-0001bb50: 7465 6e74 272c 2038 290d 0a20 2020 2020  tent', 8)..     
-0001bb60: 2020 206d 6574 612e 6d6f 6465 6c5f 7370     meta.model_sp
-0001bb70: 6563 732e 7365 7464 6566 6175 6c74 2827  ecs.setdefault('
-0001bb80: 706f 6f6c 696e 6727 2c20 3429 0d0a 2020  pooling', 4)..  
-0001bb90: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
-0001bba0: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
-0001bbb0: 7428 2773 7472 6964 6527 2c20 3429 0d0a  t('stride', 4)..
-0001bbc0: 2020 2020 2020 2020 6d65 7461 2e6d 6f64          meta.mod
-0001bbd0: 656c 5f73 7065 6373 2e73 6574 6465 6661  el_specs.setdefa
-0001bbe0: 756c 7428 2764 726f 706f 7574 272c 2030  ult('dropout', 0
-0001bbf0: 2e31 290d 0a20 2020 2020 2020 206d 6574  .1)..        met
-0001bc00: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
-0001bc10: 7464 6566 6175 6c74 2827 7061 6464 696e  tdefault('paddin
-0001bc20: 6727 2c20 2773 616d 6527 290d 0a20 2020  g', 'same')..   
-0001bc30: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
-0001bc40: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
-0001bc50: 2827 6e6f 6e6c 696e 272c 2027 656c 7527  ('nonlin', 'elu'
-0001bc60: 290d 0a20 2020 2020 2020 206d 6574 612e  )..        meta.
-0001bc70: 6d6f 6465 6c5f 7370 6563 735b 2773 636f  model_specs['sco
-0001bc80: 7065 275d 203d 2073 656c 662e 7363 6f70  pe'] = self.scop
-0001bc90: 650d 0a20 2020 2020 2020 2073 7570 6572  e..        super
-0001bca0: 2845 4547 4e65 742c 2073 656c 6629 2e5f  (EEGNet, self)._
-0001bcb0: 5f69 6e69 745f 5f28 6d65 7461 2c20 6461  _init__(meta, da
-0001bcc0: 7461 7365 7429 0d0a 2020 2020 2020 2020  taset)..        
-0001bcd0: 0d0a 0d0a 2020 2020 6465 6620 6275 696c  ....    def buil
-0001bce0: 645f 6772 6170 6828 7365 6c66 293a 0d0a  d_graph(self):..
-0001bcf0: 0d0a 0d0a 2020 2020 2020 2020 696e 7075  ....        inpu
-0001bd00: 7473 203d 2074 662e 7472 616e 7370 6f73  ts = tf.transpos
-0001bd10: 6528 7365 6c66 2e69 6e70 7574 732c 5b30  e(self.inputs,[0
-0001bd20: 2c33 2c32 2c31 5d29 0d0a 0d0a 2020 2020  ,3,2,1])....    
-0001bd30: 2020 2020 6472 6f70 6f75 7454 7970 6520      dropoutType 
-0001bd40: 3d20 4472 6f70 6f75 740d 0a0d 0a20 2020  = Dropout....   
-0001bd50: 2020 2020 2062 6c6f 636b 3120 2020 2020       block1     
-0001bd60: 2020 3d20 436f 6e76 3244 2873 656c 662e    = Conv2D(self.
-0001bd70: 7370 6563 735b 276e 5f6c 6174 656e 7427  specs['n_latent'
-0001bd80: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-0001bd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bda0: 2020 2831 2c20 7365 6c66 2e73 7065 6373    (1, self.specs
-0001bdb0: 5b27 6669 6c74 6572 5f6c 656e 6774 6827  ['filter_length'
-0001bdc0: 5d29 2c0d 0a20 2020 2020 2020 2020 2020  ]),..           
-0001bdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bde0: 2020 2070 6164 6469 6e67 203d 2073 656c     padding = sel
-0001bdf0: 662e 7370 6563 735b 2770 6164 6469 6e67  f.specs['padding
-0001be00: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
-0001be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be20: 2020 2069 6e70 7574 5f73 6861 7065 203d     input_shape =
-0001be30: 2028 312c 2073 656c 662e 6461 7461 7365   (1, self.datase
-0001be40: 742e 685f 7061 7261 6d73 5b27 6e5f 6368  t.h_params['n_ch
-0001be50: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
-0001be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be80: 2020 7365 6c66 2e64 6174 6173 6574 2e68    self.dataset.h
-0001be90: 5f70 6172 616d 735b 276e 5f74 275d 292c  _params['n_t']),
-0001bea0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bec0: 7573 655f 6269 6173 203d 2046 616c 7365  use_bias = False
-0001bed0: 2928 696e 7075 7473 290d 0a20 2020 2020  )(inputs)..     
-0001bee0: 2020 2062 6c6f 636b 3120 2020 2020 2020     block1       
-0001bef0: 3d20 4261 7463 684e 6f72 6d61 6c69 7a61  = BatchNormaliza
-0001bf00: 7469 6f6e 2861 7869 7320 3d20 3129 2862  tion(axis = 1)(b
-0001bf10: 6c6f 636b 3129 0d0a 2020 2020 2020 2020  lock1)..        
-0001bf20: 2370 7269 6e74 2822 4261 7463 686e 6f72  #print("Batchnor
-0001bf30: 6d3a 222c 2062 6c6f 636b 312e 7368 6170  m:", block1.shap
-0001bf40: 6529 0d0a 2020 2020 2020 2020 626c 6f63  e)..        bloc
-0001bf50: 6b31 2020 2020 2020 203d 2044 6570 7468  k1       = Depth
-0001bf60: 7769 7365 436f 6e76 3244 2828 7365 6c66  wiseConv2D((self
-0001bf70: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
-0001bf80: 735b 276e 5f63 6827 5d2c 2031 292c 0d0a  s['n_ch'], 1),..
-0001bf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b130: 6b65 726e 656c 5f72 6567 756c 6172 697a  kernel_regulariz
+0001b140: 6572 3d6b 5f72 6567 2e6c 3228 7365 6c66  er=k_reg.l2(self
+0001b150: 2e73 7065 6373 5b27 6c32 5f6c 616d 6264  .specs['l2_lambd
+0001b160: 6127 5d29 290d 0a0d 0a0d 0a20 2020 2020  a']))......     
+0001b170: 2020 2074 7363 6f6e 7634 5f6f 7574 203d     tsconv4_out =
+0001b180: 2074 7363 6f6e 7634 2870 6f6f 6c33 290d   tsconv4(pool3).
+0001b190: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+0001b1a0: 7473 636f 6e76 343a 272c 2020 7473 636f  tsconv4:',  tsco
+0001b1b0: 6e76 345f 6f75 742e 7368 6170 6529 0d0a  nv4_out.shape)..
+0001b1c0: 0d0a 2020 2020 2020 2020 706f 6f6c 3420  ..        pool4 
+0001b1d0: 3d20 5465 6d70 506f 6f6c 696e 6728 706f  = TempPooling(po
+0001b1e0: 6f6c 696e 673d 7365 6c66 2e73 7065 6373  oling=self.specs
+0001b1f0: 5b27 706f 6f6c 696e 6727 5d2c 0d0a 2020  ['pooling'],..  
+0001b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b220: 706f 6f6c 5f74 7970 653d 2261 7667 222c  pool_type="avg",
+0001b230: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b250: 2020 2020 7374 7269 6465 3d73 656c 662e      stride=self.
+0001b260: 7370 6563 735b 2773 7472 6964 6527 5d2c  specs['stride'],
+0001b270: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b290: 2020 2020 7061 6464 696e 673d 2753 414d      padding='SAM
+0001b2a0: 4527 2c0d 0a20 2020 2020 2020 2020 2020  E',..           
+0001b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b2c0: 2020 2020 2020 2029 2874 7363 6f6e 7634         )(tsconv4
+0001b2d0: 5f6f 7574 290d 0a0d 0a20 2020 2020 2020  _out)....       
+0001b2e0: 2070 7269 6e74 2827 706f 6f6c 343a 2027   print('pool4: '
+0001b2f0: 2c20 706f 6f6c 342e 7368 6170 6529 0d0a  , pool4.shape)..
+0001b300: 0d0a 0d0a 2020 2020 2020 2020 6663 5f6f  ....        fc_o
+0001b310: 7574 203d 2046 756c 6c79 436f 6e6e 6563  ut = FullyConnec
+0001b320: 7465 6428 7369 7a65 3d73 656c 662e 6f75  ted(size=self.ou
+0001b330: 745f 6469 6d2c 206e 6f6e 6c69 6e3d 7466  t_dim, nonlin=tf
+0001b340: 2e69 6465 6e74 6974 792c 0d0a 2020 2020  .identity,..    
+0001b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b360: 2020 2020 2020 2020 7370 6563 733d 7365          specs=se
+0001b370: 6c66 2e73 7065 6373 290d 0a20 2020 2020  lf.specs)..     
+0001b380: 2020 2079 5f70 7265 6420 3d20 6663 5f6f     y_pred = fc_o
+0001b390: 7574 2870 6f6f 6c34 290d 0a20 2020 2020  ut(pool4)..     
+0001b3a0: 2020 2072 6574 7572 6e20 795f 7072 6564     return y_pred
+0001b3b0: 0d0a 230d 0a23 0d0a 0d0a 636c 6173 7320  ..#..#....class 
+0001b3c0: 4545 474e 6574 2842 6173 654d 6f64 656c  EEGNet(BaseModel
+0001b3d0: 293a 0d0a 2020 2020 2222 2245 4547 4e65  ):..    """EEGNe
+0001b3e0: 742e 0d0a 0d0a 2020 2020 5061 7261 6d65  t.....    Parame
+0001b3f0: 7465 7273 0d0a 2020 2020 2d2d 2d2d 2d2d  ters..    ------
+0001b400: 2d2d 2d2d 0d0a 2020 2020 7370 6563 7320  ----..    specs 
+0001b410: 3a20 6469 6374 0d0a 0d0a 2020 2020 2020  : dict....      
+0001b420: 2020 6e5f 6c61 7465 6e74 203a 2069 6e74    n_latent : int
+0001b430: 0d0a 2020 2020 2020 2020 2020 2020 4e75  ..            Nu
+0001b440: 6d62 6572 206f 6620 2874 656d 706f 7261  mber of (tempora
+0001b450: 6c29 2063 6f6e 766f 6c75 7469 6f6e 206b  l) convolution k
+0001b460: 6572 6e72 656c 7320 696e 2074 6865 2066  ernrels in the f
+0001b470: 6972 7374 206c 6179 6572 2e0d 0a20 2020  irst layer...   
+0001b480: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
+0001b490: 7320 746f 2038 0d0a 0d0a 2020 2020 2020  s to 8....      
+0001b4a0: 2020 6669 6c74 6572 5f6c 656e 6774 6820    filter_length 
+0001b4b0: 3a20 696e 740d 0a20 2020 2020 2020 2020  : int..         
+0001b4c0: 2020 204c 656e 6774 6820 6f66 2074 656d     Length of tem
+0001b4d0: 706f 7261 6c20 6669 6c74 6572 7320 696e  poral filters in
+0001b4e0: 2074 6865 2066 6972 7374 206c 6179 6572   the first layer
+0001b4f0: 2e0d 0a20 2020 2020 2020 2020 2020 2044  ...            D
+0001b500: 6566 6175 6c74 7320 746f 2033 320d 0a0d  efaults to 32...
+0001b510: 0a20 2020 2020 2020 2073 7472 6964 6520  .        stride 
+0001b520: 3a20 696e 740d 0a20 2020 2020 2020 2020  : int..         
+0001b530: 2020 2053 7472 6964 6520 6f66 2074 6865     Stride of the
+0001b540: 2061 7665 7261 6765 2070 6f6c 6c69 6e67   average polling
+0001b550: 206c 6179 6572 732e 2044 6566 6175 6c74   layers. Default
+0001b560: 7320 746f 2034 2e0d 0a0d 0a20 2020 2020  s to 4.....     
+0001b570: 2020 2070 6f6f 6c69 6e67 203a 2069 6e74     pooling : int
+0001b580: 0d0a 2020 2020 2020 2020 2020 2020 506f  ..            Po
+0001b590: 6f6c 696e 6720 6661 6374 6f72 206f 6620  oling factor of 
+0001b5a0: 7468 6520 6176 6572 6167 6520 706f 6c6c  the average poll
+0001b5b0: 696e 6720 6c61 7965 7273 2e20 4465 6661  ing layers. Defa
+0001b5c0: 756c 7473 2074 6f20 342e 0d0a 0d0a 2020  ults to 4.....  
+0001b5d0: 2020 2020 2020 6472 6f70 6f75 7420 3a20        dropout : 
+0001b5e0: 666c 6f61 740d 0a20 2020 2020 2020 2020  float..         
+0001b5f0: 2020 2044 726f 706f 7574 2063 6f65 6666     Dropout coeff
+0001b600: 6963 6965 6e74 2e0d 0a0d 0a20 2020 2052  icient.....    R
+0001b610: 6566 6572 656e 6365 730d 0a20 2020 202d  eferences..    -
+0001b620: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 205b  ---------..    [
+0001b630: 335d 2056 2e4a 2e20 4c61 7768 6572 6e2c  3] V.J. Lawhern,
+0001b640: 2065 7420 616c 2e2c 2045 4547 4e65 743a   et al., EEGNet:
+0001b650: 2041 2063 6f6d 7061 6374 2063 6f6e 766f   A compact convo
+0001b660: 6c75 7469 6f6e 616c 206e 6575 7261 6c0d  lutional neural.
+0001b670: 0a20 2020 206e 6574 776f 726b 2066 6f72  .    network for
+0001b680: 2045 4547 2d62 6173 6564 2062 7261 696e   EEG-based brain
+0001b690: e280 9363 6f6d 7075 7465 7220 696e 7465  ...computer inte
+0001b6a0: 7266 6163 6573 2031 3020 4a2e 204e 6575  rfaces 10 J. Neu
+0001b6b0: 7261 6c20 456e 672e 2c0d 0a20 2020 2031  ral Eng.,..    1
+0001b6c0: 3520 2835 2920 2832 3031 3829 2c20 702e  5 (5) (2018), p.
+0001b6d0: 2030 3536 3031 330d 0a0d 0a20 2020 205b   056013....    [
+0001b6e0: 345d 204f 7269 6769 6e61 6c20 4545 474e  4] Original EEGN
+0001b6f0: 6574 2069 6d70 6c65 6d65 6e74 6174 696f  et implementatio
+0001b700: 6e20 6279 2074 6865 2061 7574 686f 7273  n by the authors
+0001b710: 2063 616e 2062 6520 666f 756e 6420 6174   can be found at
+0001b720: 0d0a 2020 2020 6874 7470 733a 2f2f 6769  ..    https://gi
+0001b730: 7468 7562 2e63 6f6d 2f76 6c61 7768 6572  thub.com/vlawher
+0001b740: 6e2f 6172 6c2d 6565 676d 6f64 656c 730d  n/arl-eegmodels.
+0001b750: 0a20 2020 2022 2222 0d0a 2020 2020 6465  .    """..    de
+0001b760: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+0001b770: 206d 6574 612c 2064 6174 6173 6574 3d4e   meta, dataset=N
+0001b780: 6f6e 6529 3a0d 0a20 2020 2020 2020 2073  one):..        s
+0001b790: 656c 662e 7363 6f70 6520 3d20 2765 6567  elf.scope = 'eeg
+0001b7a0: 6e65 7438 270d 0a20 2020 2020 2020 206d  net8'..        m
+0001b7b0: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
+0001b7c0: 7365 7464 6566 6175 6c74 2827 756e 6974  setdefault('unit
+0001b7d0: 6e6f 726d 5f73 636f 7065 272c 205b 5d29  norm_scope', [])
+0001b7e0: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
+0001b7f0: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
+0001b800: 6661 756c 7428 2766 696c 7465 725f 6c65  fault('filter_le
+0001b810: 6e67 7468 272c 2036 3429 0d0a 2020 2020  ngth', 64)..    
+0001b820: 2020 2020 6d65 7461 2e6d 6f64 656c 5f73      meta.model_s
+0001b830: 7065 6373 2e73 6574 6465 6661 756c 7428  pecs.setdefault(
+0001b840: 2764 6570 7468 5f6d 756c 7469 706c 6965  'depth_multiplie
+0001b850: 7227 2c20 3229 0d0a 2020 2020 2020 2020  r', 2)..        
+0001b860: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
+0001b870: 2e73 6574 6465 6661 756c 7428 276e 5f6c  .setdefault('n_l
+0001b880: 6174 656e 7427 2c20 3829 0d0a 2020 2020  atent', 8)..    
+0001b890: 2020 2020 6d65 7461 2e6d 6f64 656c 5f73      meta.model_s
+0001b8a0: 7065 6373 2e73 6574 6465 6661 756c 7428  pecs.setdefault(
+0001b8b0: 2770 6f6f 6c69 6e67 272c 2034 290d 0a20  'pooling', 4).. 
+0001b8c0: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
+0001b8d0: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
+0001b8e0: 6c74 2827 7374 7269 6465 272c 2034 290d  lt('stride', 4).
+0001b8f0: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
+0001b900: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
+0001b910: 6175 6c74 2827 6472 6f70 6f75 7427 2c20  ault('dropout', 
+0001b920: 302e 3129 0d0a 2020 2020 2020 2020 6d65  0.1)..        me
+0001b930: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
+0001b940: 6574 6465 6661 756c 7428 2770 6164 6469  etdefault('paddi
+0001b950: 6e67 272c 2027 7361 6d65 2729 0d0a 2020  ng', 'same')..  
+0001b960: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
+0001b970: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
+0001b980: 7428 276e 6f6e 6c69 6e27 2c20 2765 6c75  t('nonlin', 'elu
+0001b990: 2729 0d0a 2020 2020 2020 2020 6d65 7461  ')..        meta
+0001b9a0: 2e6d 6f64 656c 5f73 7065 6373 5b27 7363  .model_specs['sc
+0001b9b0: 6f70 6527 5d20 3d20 7365 6c66 2e73 636f  ope'] = self.sco
+0001b9c0: 7065 0d0a 2020 2020 2020 2020 7375 7065  pe..        supe
+0001b9d0: 7228 4545 474e 6574 2c20 7365 6c66 292e  r(EEGNet, self).
+0001b9e0: 5f5f 696e 6974 5f5f 286d 6574 612c 2064  __init__(meta, d
+0001b9f0: 6174 6173 6574 290d 0a20 2020 2020 2020  ataset)..       
+0001ba00: 200d 0a0d 0a20 2020 2064 6566 2062 7569   ....    def bui
+0001ba10: 6c64 5f67 7261 7068 2873 656c 6629 3a0d  ld_graph(self):.
+0001ba20: 0a0d 0a0d 0a20 2020 2020 2020 2069 6e70  .....        inp
+0001ba30: 7574 7320 3d20 7466 2e74 7261 6e73 706f  uts = tf.transpo
+0001ba40: 7365 2873 656c 662e 696e 7075 7473 2c5b  se(self.inputs,[
+0001ba50: 302c 332c 322c 315d 290d 0a0d 0a20 2020  0,3,2,1])....   
+0001ba60: 2020 2020 2064 726f 706f 7574 5479 7065       dropoutType
+0001ba70: 203d 2044 726f 706f 7574 0d0a 0d0a 2020   = Dropout....  
+0001ba80: 2020 2020 2020 626c 6f63 6b31 2020 2020        block1    
+0001ba90: 2020 203d 2043 6f6e 7632 4428 7365 6c66     = Conv2D(self
+0001baa0: 2e73 7065 6373 5b27 6e5f 6c61 7465 6e74  .specs['n_latent
+0001bab0: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
+0001bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bad0: 2020 2028 312c 2073 656c 662e 7370 6563     (1, self.spec
+0001bae0: 735b 2766 696c 7465 725f 6c65 6e67 7468  s['filter_length
+0001baf0: 275d 292c 0d0a 2020 2020 2020 2020 2020  ']),..          
+0001bb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb10: 2020 2020 7061 6464 696e 6720 3d20 7365      padding = se
+0001bb20: 6c66 2e73 7065 6373 5b27 7061 6464 696e  lf.specs['paddin
+0001bb30: 6727 5d2c 0d0a 2020 2020 2020 2020 2020  g'],..          
+0001bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb50: 2020 2020 696e 7075 745f 7368 6170 6520      input_shape 
+0001bb60: 3d20 2831 2c20 7365 6c66 2e64 6174 6173  = (1, self.datas
+0001bb70: 6574 2e68 5f70 6172 616d 735b 276e 5f63  et.h_params['n_c
+0001bb80: 6827 5d2c 0d0a 2020 2020 2020 2020 2020  h'],..          
+0001bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bbb0: 2020 2073 656c 662e 6461 7461 7365 742e     self.dataset.
+0001bbc0: 685f 7061 7261 6d73 5b27 6e5f 7427 5d29  h_params['n_t'])
+0001bbd0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bbf0: 2075 7365 5f62 6961 7320 3d20 4661 6c73   use_bias = Fals
+0001bc00: 6529 2869 6e70 7574 7329 0d0a 2020 2020  e)(inputs)..    
+0001bc10: 2020 2020 626c 6f63 6b31 2020 2020 2020      block1      
+0001bc20: 203d 2042 6174 6368 4e6f 726d 616c 697a   = BatchNormaliz
+0001bc30: 6174 696f 6e28 6178 6973 203d 2031 2928  ation(axis = 1)(
+0001bc40: 626c 6f63 6b31 290d 0a20 2020 2020 2020  block1)..       
+0001bc50: 2023 7072 696e 7428 2242 6174 6368 6e6f   #print("Batchno
+0001bc60: 726d 3a22 2c20 626c 6f63 6b31 2e73 6861  rm:", block1.sha
+0001bc70: 7065 290d 0a20 2020 2020 2020 2062 6c6f  pe)..        blo
+0001bc80: 636b 3120 2020 2020 2020 3d20 4465 7074  ck1       = Dept
+0001bc90: 6877 6973 6543 6f6e 7632 4428 2873 656c  hwiseConv2D((sel
+0001bca0: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
+0001bcb0: 6d73 5b27 6e5f 6368 275d 2c20 3129 2c0d  ms['n_ch'], 1),.
+0001bcc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bce0: 2020 2020 2020 2020 7573 655f 6269 6173          use_bias
+0001bcf0: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
+0001bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd20: 2020 6465 7074 685f 6d75 6c74 6970 6c69    depth_multipli
+0001bd30: 6572 203d 2073 656c 662e 7370 6563 735b  er = self.specs[
+0001bd40: 2764 6570 7468 5f6d 756c 7469 706c 6965  'depth_multiplie
+0001bd50: 7227 5d2c 0d0a 2020 2020 2020 2020 2020  r'],..          
+0001bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd70: 2020 2020 2020 2020 2020 2020 2064 6570               dep
+0001bd80: 7468 7769 7365 5f63 6f6e 7374 7261 696e  thwise_constrain
+0001bd90: 7420 3d20 636f 6e73 7472 6169 6e74 732e  t = constraints.
+0001bda0: 4d61 784e 6f72 6d28 312e 2929 2862 6c6f  MaxNorm(1.))(blo
+0001bdb0: 636b 3129 0d0a 2020 2020 2020 2020 2362  ck1)..        #b
+0001bdc0: 6c6f 636b 3120 2020 2020 2020 3d20 4261  lock1       = Ba
+0001bdd0: 7463 684e 6f72 6d61 6c69 7a61 7469 6f6e  tchNormalization
+0001bde0: 2861 7869 7320 3d20 3129 2862 6c6f 636b  (axis = 1)(block
+0001bdf0: 3129 0d0a 2020 2020 2020 2020 626c 6f63  1)..        bloc
+0001be00: 6b31 2020 2020 2020 203d 206c 6179 6572  k1       = layer
+0001be10: 732e 4163 7469 7661 7469 6f6e 2873 656c  s.Activation(sel
+0001be20: 662e 7370 6563 735b 276e 6f6e 6c69 6e27  f.specs['nonlin'
+0001be30: 5d29 2862 6c6f 636b 3129 0d0a 2020 2020  ])(block1)..    
+0001be40: 2020 2020 626c 6f63 6b31 2020 2020 2020      block1      
+0001be50: 203d 206c 6179 6572 732e 4176 6572 6167   = layers.Averag
+0001be60: 6550 6f6f 6c69 6e67 3244 2828 312c 2073  ePooling2D((1, s
+0001be70: 656c 662e 7370 6563 735b 2770 6f6f 6c69  elf.specs['pooli
+0001be80: 6e67 275d 2929 2862 6c6f 636b 3129 0d0a  ng']))(block1)..
+0001be90: 2020 2020 2020 2020 7072 696e 7428 2242          print("B
+0001bea0: 6c6f 636b 2031 3a22 2c20 626c 6f63 6b31  lock 1:", block1
+0001beb0: 2e73 6861 7065 290d 0a20 2020 2020 2020  .shape)..       
+0001bec0: 2062 6c6f 636b 3120 2020 2020 2020 3d20   block1       = 
+0001bed0: 6472 6f70 6f75 7454 7970 6528 7365 6c66  dropoutType(self
+0001bee0: 2e73 7065 6373 5b27 6472 6f70 6f75 7427  .specs['dropout'
+0001bef0: 5d29 2862 6c6f 636b 3129 0d0a 0d0a 2020  ])(block1)....  
+0001bf00: 2020 2020 2020 626c 6f63 6b32 2020 2020        block2    
+0001bf10: 2020 203d 2053 6570 6172 6162 6c65 436f     = SeparableCo
+0001bf20: 6e76 3244 2873 656c 662e 7370 6563 735b  nv2D(self.specs[
+0001bf30: 276e 5f6c 6174 656e 7427 5d2a 7365 6c66  'n_latent']*self
+0001bf40: 2e73 7065 6373 5b27 6465 7074 685f 6d75  .specs['depth_mu
+0001bf50: 6c74 6970 6c69 6572 275d 2c20 2831 2c20  ltiplier'], (1, 
+0001bf60: 7365 6c66 2e73 7065 6373 5b27 6669 6c74  self.specs['filt
+0001bf70: 6572 5f6c 656e 6774 6827 5d2f 2f73 656c  er_length']//sel
+0001bf80: 662e 7370 6563 735b 2270 6f6f 6c69 6e67  f.specs["pooling
+0001bf90: 225d 292c 0d0a 2020 2020 2020 2020 2020  "]),..          
 0001bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfb0: 2020 2020 2020 2075 7365 5f62 6961 7320         use_bias 
-0001bfc0: 3d20 4661 6c73 652c 0d0a 2020 2020 2020  = False,..      
-0001bfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bff0: 2064 6570 7468 5f6d 756c 7469 706c 6965   depth_multiplie
-0001c000: 7220 3d20 7365 6c66 2e73 7065 6373 5b27  r = self.specs['
-0001c010: 6465 7074 685f 6d75 6c74 6970 6c69 6572  depth_multiplier
-0001c020: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
-0001c030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c040: 2020 2020 2020 2020 2020 2020 6465 7074              dept
-0001c050: 6877 6973 655f 636f 6e73 7472 6169 6e74  hwise_constraint
-0001c060: 203d 2063 6f6e 7374 7261 696e 7473 2e4d   = constraints.M
-0001c070: 6178 4e6f 726d 2831 2e29 2928 626c 6f63  axNorm(1.))(bloc
-0001c080: 6b31 290d 0a20 2020 2020 2020 2023 626c  k1)..        #bl
-0001c090: 6f63 6b31 2020 2020 2020 203d 2042 6174  ock1       = Bat
-0001c0a0: 6368 4e6f 726d 616c 697a 6174 696f 6e28  chNormalization(
-0001c0b0: 6178 6973 203d 2031 2928 626c 6f63 6b31  axis = 1)(block1
-0001c0c0: 290d 0a20 2020 2020 2020 2062 6c6f 636b  )..        block
-0001c0d0: 3120 2020 2020 2020 3d20 6c61 7965 7273  1       = layers
-0001c0e0: 2e41 6374 6976 6174 696f 6e28 7365 6c66  .Activation(self
-0001c0f0: 2e73 7065 6373 5b27 6e6f 6e6c 696e 275d  .specs['nonlin']
-0001c100: 2928 626c 6f63 6b31 290d 0a20 2020 2020  )(block1)..     
-0001c110: 2020 2062 6c6f 636b 3120 2020 2020 2020     block1       
-0001c120: 3d20 6c61 7965 7273 2e41 7665 7261 6765  = layers.Average
-0001c130: 506f 6f6c 696e 6732 4428 2831 2c20 7365  Pooling2D((1, se
-0001c140: 6c66 2e73 7065 6373 5b27 706f 6f6c 696e  lf.specs['poolin
-0001c150: 6727 5d29 2928 626c 6f63 6b31 290d 0a20  g']))(block1).. 
-0001c160: 2020 2020 2020 2070 7269 6e74 2822 426c         print("Bl
-0001c170: 6f63 6b20 313a 222c 2062 6c6f 636b 312e  ock 1:", block1.
-0001c180: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
-0001c190: 626c 6f63 6b31 2020 2020 2020 203d 2064  block1       = d
-0001c1a0: 726f 706f 7574 5479 7065 2873 656c 662e  ropoutType(self.
-0001c1b0: 7370 6563 735b 2764 726f 706f 7574 275d  specs['dropout']
-0001c1c0: 2928 626c 6f63 6b31 290d 0a0d 0a20 2020  )(block1)....   
-0001c1d0: 2020 2020 2062 6c6f 636b 3220 2020 2020       block2     
-0001c1e0: 2020 3d20 5365 7061 7261 626c 6543 6f6e    = SeparableCon
-0001c1f0: 7632 4428 7365 6c66 2e73 7065 6373 5b27  v2D(self.specs['
-0001c200: 6e5f 6c61 7465 6e74 275d 2a73 656c 662e  n_latent']*self.
-0001c210: 7370 6563 735b 2764 6570 7468 5f6d 756c  specs['depth_mul
-0001c220: 7469 706c 6965 7227 5d2c 2028 312c 2073  tiplier'], (1, s
-0001c230: 656c 662e 7370 6563 735b 2766 696c 7465  elf.specs['filte
-0001c240: 725f 6c65 6e67 7468 275d 2f2f 7365 6c66  r_length']//self
-0001c250: 2e73 7065 6373 5b22 706f 6f6c 696e 6722  .specs["pooling"
-0001c260: 5d29 2c0d 0a20 2020 2020 2020 2020 2020  ]),..           
-0001c270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c280: 2020 2020 2020 2020 2020 2020 7573 655f              use_
-0001c290: 6269 6173 203d 2046 616c 7365 2c20 7061  bias = False, pa
-0001c2a0: 6464 696e 6720 3d20 7365 6c66 2e73 7065  dding = self.spe
-0001c2b0: 6373 5b27 7061 6464 696e 6727 5d29 2862  cs['padding'])(b
-0001c2c0: 6c6f 636b 3129 0d0a 2020 2020 2020 2020  lock1)..        
-0001c2d0: 2362 6c6f 636b 3220 2020 2020 2020 3d20  #block2       = 
-0001c2e0: 4261 7463 684e 6f72 6d61 6c69 7a61 7469  BatchNormalizati
-0001c2f0: 6f6e 2861 7869 7320 3d20 3129 2862 6c6f  on(axis = 1)(blo
-0001c300: 636b 3229 0d0a 0d0a 2020 2020 2020 2020  ck2)....        
-0001c310: 2370 7269 6e74 2822 4261 7463 686e 6f72  #print("Batchnor
-0001c320: 6d20 323a 222c 2062 6c6f 636b 322e 7368  m 2:", block2.sh
-0001c330: 6170 6529 0d0a 0d0a 2020 2020 2020 2020  ape)....        
-0001c340: 626c 6f63 6b32 2020 2020 2020 203d 206c  block2       = l
-0001c350: 6179 6572 732e 4163 7469 7661 7469 6f6e  ayers.Activation
-0001c360: 2873 656c 662e 7370 6563 735b 276e 6f6e  (self.specs['non
-0001c370: 6c69 6e27 5d29 2862 6c6f 636b 3229 0d0a  lin'])(block2)..
-0001c380: 2020 2020 2020 2020 626c 6f63 6b32 2020          block2  
-0001c390: 2020 2020 203d 206c 6179 6572 732e 4176       = layers.Av
-0001c3a0: 6572 6167 6550 6f6f 6c69 6e67 3244 2828  eragePooling2D((
-0001c3b0: 312c 2073 656c 662e 7370 6563 735b 2770  1, self.specs['p
-0001c3c0: 6f6f 6c69 6e67 275d 2a32 2929 2862 6c6f  ooling']*2))(blo
-0001c3d0: 636b 3229 0d0a 2020 2020 2020 2020 626c  ck2)..        bl
-0001c3e0: 6f63 6b32 2020 2020 2020 203d 2064 726f  ock2       = dro
-0001c3f0: 706f 7574 5479 7065 2873 656c 662e 7370  poutType(self.sp
-0001c400: 6563 735b 2764 726f 706f 7574 275d 2928  ecs['dropout'])(
-0001c410: 626c 6f63 6b32 290d 0a20 2020 2020 2020  block2)..       
-0001c420: 2070 7269 6e74 2822 426c 6f63 6b20 323a   print("Block 2:
-0001c430: 222c 2062 6c6f 636b 322e 7368 6170 6529  ", block2.shape)
-0001c440: 0d0a 0d0a 2020 2020 2020 2020 6669 6e5f  ....        fin_
-0001c450: 6663 203d 2046 756c 6c79 436f 6e6e 6563  fc = FullyConnec
-0001c460: 7465 6428 7369 7a65 3d73 656c 662e 6f75  ted(size=self.ou
-0001c470: 745f 6469 6d2c 206e 6f6e 6c69 6e3d 7466  t_dim, nonlin=tf
-0001c480: 2e69 6465 6e74 6974 792c 0d0a 2020 2020  .identity,..    
-0001c490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4a0: 2020 2020 2020 2020 7370 6563 733d 7365          specs=se
-0001c4b0: 6c66 2e73 7065 6373 290d 0a20 2020 2020  lf.specs)..     
-0001c4c0: 2020 2079 5f70 7265 6420 3d20 6669 6e5f     y_pred = fin_
-0001c4d0: 6663 2862 6c6f 636b 3229 0d0a 0d0a 2020  fc(block2)....  
-0001c4e0: 2020 2020 2020 7265 7475 726e 2079 5f70        return y_p
-0001c4f0: 7265 640d 0a0d 0a23 2063 6c61 7373 2053  red....# class S
-0001c500: 696d 706c 654e 6574 284c 4643 4e4e 293a  impleNet(LFCNN):
-0001c510: 0d0a 2320 2020 2020 2222 220d 0a23 2020  ..#     """..#  
-0001c520: 2020 2020 2020 2050 6574 726f 7379 616e         Petrosyan
-0001c530: 2c20 412e 2c20 5369 6e6b 696e 2c20 4d2e  , A., Sinkin, M.
-0001c540: 2c20 4c65 6265 6465 762c 204d 2e20 412e  , Lebedev, M. A.
-0001c550: 2c20 2620 4f73 7361 6474 6368 692c 2041  , & Ossadtchi, A
-0001c560: 2e20 2044 6563 6f64 696e 6720 616e 6420  .  Decoding and 
-0001c570: 696e 7465 7270 7265 7469 6e67 2063 6f72  interpreting cor
-0001c580: 7469 6361 6c20 7369 676e 616c 7320 7769  tical signals wi
-0001c590: 7468 0d0a 2320 2020 2020 2020 2020 6120  th..#         a 
-0001c5a0: 636f 6d70 6163 7420 636f 6e76 6f6c 7574  compact convolut
-0001c5b0: 696f 6e61 6c20 6e65 7572 616c 206e 6574  ional neural net
-0001c5c0: 776f 726b 2c20 3230 3231 2c20 4a6f 7572  work, 2021, Jour
-0001c5d0: 6e61 6c20 6f66 204e 6575 7261 6c20 456e  nal of Neural En
-0001c5e0: 6769 6e65 6572 696e 672c 2032 3032 312c  gineering, 2021,
-0001c5f0: 0d0a 2320 2020 2020 2020 2020 6874 7470  ..#         http
-0001c600: 733a 2f2f 646f 692e 6f72 672f 3130 2e31  s://doi.org/10.1
-0001c610: 3038 382f 3137 3431 2d32 3535 322f 6162  088/1741-2552/ab
-0001c620: 6532 3065 0d0a 2320 2020 2020 2222 220d  e20e..#     """.
-0001c630: 0a23 2020 2020 2064 6566 205f 5f69 6e69  .#     def __ini
-0001c640: 745f 5f28 7365 6c66 2c20 4461 7461 7365  t__(self, Datase
-0001c650: 742c 2073 7065 6373 3d4e 6f6e 6529 3a0d  t, specs=None):.
-0001c660: 0a23 2020 2020 2020 2020 2069 6620 7370  .#         if sp
-0001c670: 6563 7320 6973 204e 6f6e 653a 0d0a 2320  ecs is None:..# 
-0001c680: 2020 2020 2020 2020 2020 2020 7370 6563              spec
-0001c690: 733d 6469 6374 2829 0d0a 2320 2020 2020  s=dict()..#     
-0001c6a0: 2020 2020 7375 7065 7228 292e 5f5f 696e      super().__in
-0001c6b0: 6974 5f5f 2844 6174 6173 6574 2c20 7370  it__(Dataset, sp
-0001c6c0: 6563 7329 0d0a 0d0a 2320 2020 2020 6465  ecs)....#     de
-0001c6d0: 6620 6275 696c 645f 6772 6170 6828 7365  f build_graph(se
-0001c6e0: 6c66 293a 0d0a 2320 2020 2020 2020 2020  lf):..#         
-0001c6f0: 7365 6c66 2e64 6d78 203d 2044 654d 6978  self.dmx = DeMix
-0001c700: 696e 6728 7369 7a65 3d73 656c 662e 7370  ing(size=self.sp
-0001c710: 6563 735b 276e 5f6c 6174 656e 7427 5d2c  ecs['n_latent'],
-0001c720: 206e 6f6e 6c69 6e3d 7466 2e69 6465 6e74   nonlin=tf.ident
-0001c730: 6974 792c 0d0a 2320 2020 2020 2020 2020  ity,..#         
-0001c740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c750: 2020 2020 6178 6973 3d33 2c20 7370 6563      axis=3, spec
-0001c760: 733d 7365 6c66 2e73 7065 6373 290d 0a23  s=self.specs)..#
-0001c770: 2020 2020 2020 2020 2073 656c 662e 646d           self.dm
-0001c780: 785f 6f75 7420 3d20 7365 6c66 2e64 6d78  x_out = self.dmx
-0001c790: 2873 656c 662e 696e 7075 7473 290d 0a0d  (self.inputs)...
-0001c7a0: 0a23 2020 2020 2020 2020 2073 656c 662e  .#         self.
-0001c7b0: 7463 6f6e 7620 3d20 4c46 5443 6f6e 7628  tconv = LFTConv(
-0001c7c0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001c7d0: 7369 7a65 3d73 656c 662e 7370 6563 735b  size=self.specs[
-0001c7e0: 276e 5f6c 6174 656e 7427 5d2c 0d0a 2320  'n_latent'],..# 
-0001c7f0: 2020 2020 2020 2020 2020 2020 6e6f 6e6c              nonl
-0001c800: 696e 3d73 656c 662e 7370 6563 735b 276e  in=self.specs['n
-0001c810: 6f6e 6c69 6e27 5d2c 0d0a 2320 2020 2020  onlin'],..#     
-0001c820: 2020 2020 2020 2020 6669 6c74 6572 5f6c          filter_l
-0001c830: 656e 6774 683d 7365 6c66 2e73 7065 6373  ength=self.specs
-0001c840: 5b27 6669 6c74 6572 5f6c 656e 6774 6827  ['filter_length'
-0001c850: 5d2c 0d0a 2320 2020 2020 2020 2020 2020  ],..#           
-0001c860: 2020 7061 6464 696e 673d 7365 6c66 2e73    padding=self.s
-0001c870: 7065 6373 5b27 7061 6464 696e 6727 5d2c  pecs['padding'],
-0001c880: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001c890: 7370 6563 733d 7365 6c66 2e73 7065 6373  specs=self.specs
-0001c8a0: 0d0a 2320 2020 2020 2020 2020 290d 0a23  ..#         )..#
-0001c8b0: 2020 2020 2020 2020 2073 656c 662e 7463           self.tc
-0001c8c0: 6f6e 765f 6f75 7420 3d20 7365 6c66 2e74  onv_out = self.t
-0001c8d0: 636f 6e76 2873 656c 662e 646d 785f 6f75  conv(self.dmx_ou
-0001c8e0: 7429 0d0a 0d0a 2320 2020 2020 2020 2020  t)....#         
-0001c8f0: 7365 6c66 2e65 6e76 636f 6e76 203d 204c  self.envconv = L
-0001c900: 4654 436f 6e76 280d 0a23 2020 2020 2020  FTConv(..#      
-0001c910: 2020 2020 2020 2073 697a 653d 7365 6c66         size=self
-0001c920: 2e73 7065 6373 5b27 6e5f 6c61 7465 6e74  .specs['n_latent
-0001c930: 275d 2c0d 0a23 2020 2020 2020 2020 2020  '],..#          
-0001c940: 2020 206e 6f6e 6c69 6e3d 7365 6c66 2e73     nonlin=self.s
-0001c950: 7065 6373 5b27 6e6f 6e6c 696e 275d 2c0d  pecs['nonlin'],.
-0001c960: 0a23 2020 2020 2020 2020 2020 2020 2066  .#             f
-0001c970: 696c 7465 725f 6c65 6e67 7468 3d73 656c  ilter_length=sel
-0001c980: 662e 7370 6563 735b 2766 696c 7465 725f  f.specs['filter_
-0001c990: 6c65 6e67 7468 275d 2c0d 0a23 2020 2020  length'],..#    
-0001c9a0: 2020 2020 2020 2020 2070 6164 6469 6e67           padding
-0001c9b0: 3d73 656c 662e 7370 6563 735b 2770 6164  =self.specs['pad
-0001c9c0: 6469 6e67 275d 2c0d 0a23 2020 2020 2020  ding'],..#      
-0001c9d0: 2020 2020 2020 2073 7065 6373 3d73 656c         specs=sel
-0001c9e0: 662e 7370 6563 730d 0a23 2020 2020 2020  f.specs..#      
-0001c9f0: 2020 2029 0d0a 0d0a 2320 2020 2020 2020     )....#       
-0001ca00: 2020 7365 6c66 2e65 6e76 636f 6e76 5f6f    self.envconv_o
-0001ca10: 7574 203d 2073 656c 662e 656e 7663 6f6e  ut = self.envcon
-0001ca20: 7628 7365 6c66 2e74 636f 6e76 5f6f 7574  v(self.tconv_out
-0001ca30: 290d 0a23 2020 2020 2020 2020 2073 656c  )..#         sel
-0001ca40: 662e 706f 6f6c 203d 206c 616d 6264 6120  f.pool = lambda 
-0001ca50: 583a 2058 5b3a 2c20 3a2c 203a 3a73 656c  X: X[:, :, ::sel
-0001ca60: 662e 7370 6563 735b 2770 6f6f 6c69 6e67  f.specs['pooling
-0001ca70: 275d 2c20 3a5d 0d0a 0d0a 2320 2020 2020  '], :]....#     
-0001ca80: 2020 2020 7365 6c66 2e70 6f6f 6c65 6420      self.pooled 
-0001ca90: 3d20 7365 6c66 2e70 6f6f 6c28 7365 6c66  = self.pool(self
-0001caa0: 2e65 6e76 636f 6e76 5f6f 7574 290d 0a0d  .envconv_out)...
-0001cab0: 0a23 2020 2020 2020 2020 2064 726f 706f  .#         dropo
-0001cac0: 7574 203d 2044 726f 706f 7574 280d 0a23  ut = Dropout(..#
-0001cad0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001cae0: 662e 7370 6563 735b 2764 726f 706f 7574  f.specs['dropout
-0001caf0: 275d 2c0d 0a23 2020 2020 2020 2020 2020  '],..#          
-0001cb00: 2020 206e 6f69 7365 5f73 6861 7065 3d4e     noise_shape=N
-0001cb10: 6f6e 650d 0a23 2020 2020 2020 2020 2029  one..#         )
-0001cb20: 2873 656c 662e 706f 6f6c 6564 290d 0a0d  (self.pooled)...
-0001cb30: 0a23 2020 2020 2020 2020 2073 656c 662e  .#         self.
-0001cb40: 6669 6e5f 6663 203d 2046 756c 6c79 436f  fin_fc = FullyCo
-0001cb50: 6e6e 6563 7465 6428 7369 7a65 3d73 656c  nnected(size=sel
-0001cb60: 662e 6f75 745f 6469 6d2c 206e 6f6e 6c69  f.out_dim, nonli
-0001cb70: 6e3d 7466 2e69 6465 6e74 6974 792c 0d0a  n=tf.identity,..
-0001cb80: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0001cb90: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-0001cba0: 6563 733d 7365 6c66 2e73 7065 6373 290d  ecs=self.specs).
-0001cbb0: 0a0d 0a23 2020 2020 2020 2020 2079 5f70  ...#         y_p
-0001cbc0: 7265 6420 3d20 7365 6c66 2e66 696e 5f66  red = self.fin_f
-0001cbd0: 6328 6472 6f70 6f75 7429 0d0a 0d0a 2320  c(dropout)....# 
-0001cbe0: 2020 2020 2020 2020 7265 7475 726e 2079          return y
-0001cbf0: 5f70 7265 640d 0a0d 0a23 2020 2020 2064  _pred....#     d
-0001cc00: 6566 2063 6f6d 7075 7465 5f70 6174 7465  ef compute_patte
-0001cc10: 726e 7328 7365 6c66 2c20 6461 7461 5f70  rns(self, data_p
-0001cc20: 6174 683d 4e6f 6e65 2c20 2a2c 206f 7574  ath=None, *, out
-0001cc30: 7075 743d 2770 6174 7465 726e 7327 293a  put='patterns'):
-0001cc40: 0d0a 0d0a 2320 2020 2020 2020 2020 6966  ....#         if
-0001cc50: 206e 6f74 2064 6174 615f 7061 7468 3a0d   not data_path:.
-0001cc60: 0a23 2020 2020 2020 2020 2020 2020 2070  .#             p
-0001cc70: 7269 6e74 2822 436f 6d70 7574 696e 6720  rint("Computing 
-0001cc80: 7061 7474 6572 6e73 3a20 4e6f 2070 6174  patterns: No pat
-0001cc90: 6820 7370 6563 6966 6965 642c 2075 7369  h specified, usi
-0001cca0: 6e67 2076 616c 6964 6174 696f 6e20 6461  ng validation da
-0001ccb0: 7461 7365 7420 2844 6566 6175 6c74 2922  taset (Default)"
-0001ccc0: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
-0001ccd0: 2064 7320 3d20 7365 6c66 2e64 6174 6173   ds = self.datas
-0001cce0: 6574 2e76 616c 0d0a 2320 2020 2020 2020  et.val..#       
-0001ccf0: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-0001cd00: 6528 6461 7461 5f70 6174 682c 2073 7472  e(data_path, str
-0001cd10: 2920 6f72 2069 7369 6e73 7461 6e63 6528  ) or isinstance(
-0001cd20: 6461 7461 5f70 6174 682c 2028 6c69 7374  data_path, (list
-0001cd30: 2c20 7475 706c 6529 293a 0d0a 2320 2020  , tuple)):..#   
-0001cd40: 2020 2020 2020 2020 2020 6473 203d 2073            ds = s
-0001cd50: 656c 662e 6461 7461 7365 742e 5f62 7569  elf.dataset._bui
-0001cd60: 6c64 5f64 6174 6173 6574 280d 0a23 2020  ld_dataset(..#  
-0001cd70: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001cd80: 6174 615f 7061 7468 2c0d 0a23 2020 2020  ata_path,..#    
-0001cd90: 2020 2020 2020 2020 2020 2020 2073 706c               spl
-0001cda0: 6974 3d46 616c 7365 2c0d 0a23 2020 2020  it=False,..#    
-0001cdb0: 2020 2020 2020 2020 2020 2020 2074 6573               tes
-0001cdc0: 745f 6261 7463 683d 4e6f 6e65 2c0d 0a23  t_batch=None,..#
-0001cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cde0: 2072 6570 6561 743d 5472 7565 0d0a 2320   repeat=True..# 
-0001cdf0: 2020 2020 2020 2020 2020 2020 290d 0a23              )..#
-0001ce00: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
-0001ce10: 696e 7374 616e 6365 2864 6174 615f 7061  instance(data_pa
-0001ce20: 7468 2c20 4461 7461 7365 7429 3a0d 0a23  th, Dataset):..#
-0001ce30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001ce40: 6861 7361 7474 7228 6461 7461 5f70 6174  hasattr(data_pat
-0001ce50: 682c 2027 7465 7374 2729 3a0d 0a23 2020  h, 'test'):..#  
-0001ce60: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001ce70: 7320 3d20 6461 7461 5f70 6174 682e 7465  s = data_path.te
-0001ce80: 7374 0d0a 2320 2020 2020 2020 2020 2020  st..#           
-0001ce90: 2020 656c 7365 3a0d 0a23 2020 2020 2020    else:..#      
-0001cea0: 2020 2020 2020 2020 2020 2064 7320 3d20             ds = 
-0001ceb0: 6461 7461 5f70 6174 682e 7661 6c0d 0a23  data_path.val..#
-0001cec0: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
-0001ced0: 696e 7374 616e 6365 2864 6174 615f 7061  instance(data_pa
-0001cee0: 7468 2c20 7466 2e64 6174 612e 4461 7461  th, tf.data.Data
-0001cef0: 7365 7429 3a0d 0a23 2020 2020 2020 2020  set):..#        
-0001cf00: 2020 2020 2064 7320 3d20 6461 7461 5f70       ds = data_p
-0001cf10: 6174 680d 0a23 2020 2020 2020 2020 2065  ath..#         e
-0001cf20: 6c73 653a 0d0a 2320 2020 2020 2020 2020  lse:..#         
-0001cf30: 2020 2020 7261 6973 6520 4174 7472 6962      raise Attrib
-0001cf40: 7574 6545 7272 6f72 2827 5370 6563 6966  uteError('Specif
-0001cf50: 7920 6461 7461 7365 7420 6f72 2064 6174  y dataset or dat
-0001cf60: 6120 7061 7468 2e27 290d 0a0d 0a23 2020  a path.')....#  
-0001cf70: 2020 2020 2020 2058 2c20 7920 3d20 5b72         X, y = [r
-0001cf80: 6f77 2066 6f72 2072 6f77 2069 6e20 6473  ow for row in ds
-0001cf90: 2e74 616b 6528 3129 5d5b 305d 0d0a 0d0a  .take(1)][0]....
-0001cfa0: 2320 2020 2020 2020 2020 7365 6c66 2e6f  #         self.o
-0001cfb0: 7574 5f77 5f66 6c61 7420 3d20 7365 6c66  ut_w_flat = self
-0001cfc0: 2e66 696e 5f66 632e 772e 6e75 6d70 7928  .fin_fc.w.numpy(
-0001cfd0: 290d 0a23 2020 2020 2020 2020 2073 656c  )..#         sel
-0001cfe0: 662e 6f75 745f 7765 6967 6874 7320 3d20  f.out_weights = 
-0001cff0: 6e70 2e72 6573 6861 7065 280d 0a23 2020  np.reshape(..#  
-0001d000: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001d010: 6f75 745f 775f 666c 6174 2c0d 0a23 2020  out_w_flat,..#  
-0001d020: 2020 2020 2020 2020 2020 205b 2d31 2c20             [-1, 
-0001d030: 7365 6c66 2e64 6d78 2e73 697a 652c 2073  self.dmx.size, s
-0001d040: 656c 662e 6f75 745f 6469 6d5d 0d0a 2320  elf.out_dim]..# 
-0001d050: 2020 2020 2020 2020 290d 0a23 2020 2020          )..#    
-0001d060: 2020 2020 2073 656c 662e 6f75 745f 6269       self.out_bi
-0001d070: 6173 6573 203d 2073 656c 662e 6669 6e5f  ases = self.fin_
-0001d080: 6663 2e62 2e6e 756d 7079 2829 0d0a 2320  fc.b.numpy()..# 
-0001d090: 2020 2020 2020 2020 7365 6c66 2e66 6561          self.fea
-0001d0a0: 7475 7265 5f72 656c 6576 616e 6365 7320  ture_relevances 
-0001d0b0: 3d20 7365 6c66 2e63 6f6d 706f 6e65 6e74  = self.component
-0001d0c0: 7769 7365 5f6c 6f73 7328 582c 2079 290d  wise_loss(X, y).
-0001d0d0: 0a23 2020 2020 2020 2020 2073 656c 662e  .#         self.
-0001d0e0: 6272 616e 6368 7769 7365 5f6c 6f73 7328  branchwise_loss(
-0001d0f0: 582c 2079 290d 0a0d 0a23 2020 2020 2020  X, y)....#      
-0001d100: 2020 2023 2063 6f6d 7075 7465 2074 656d     # compute tem
-0001d110: 706f 7261 6c20 636f 6e76 6f6c 7574 696f  poral convolutio
-0001d120: 6e20 6c61 7965 7220 6f75 7470 7574 7320  n layer outputs 
-0001d130: 666f 7220 7669 735f 6469 6373 0d0a 2320  for vis_dics..# 
-0001d140: 2020 2020 2020 2020 7463 5f6f 7574 203d          tc_out =
-0001d150: 2073 656c 662e 706f 6f6c 2873 656c 662e   self.pool(self.
-0001d160: 7463 6f6e 7628 7365 6c66 2e64 6d78 2858  tconv(self.dmx(X
-0001d170: 2929 2e6e 756d 7079 2829 290d 0a0d 0a23  )).numpy())....#
-0001d180: 2020 2020 2020 2020 2023 2063 6f6d 7075           # compu
-0001d190: 7465 2064 6174 6120 636f 7661 7269 616e  te data covarian
-0001d1a0: 6365 0d0a 2320 2020 2020 2020 2020 5820  ce..#         X 
-0001d1b0: 3d20 5820 2d20 7466 2e72 6564 7563 655f  = X - tf.reduce_
-0001d1c0: 6d65 616e 2858 2c20 6178 6973 3d2d 322c  mean(X, axis=-2,
-0001d1d0: 206b 6565 7064 696d 733d 5472 7565 290d   keepdims=True).
-0001d1e0: 0a23 2020 2020 2020 2020 2058 203d 2074  .#         X = t
-0001d1f0: 662e 7472 616e 7370 6f73 6528 582c 205b  f.transpose(X, [
-0001d200: 332c 2030 2c20 312c 2032 5d29 0d0a 2320  3, 0, 1, 2])..# 
-0001d210: 2020 2020 2020 2020 5820 3d20 7466 2e72          X = tf.r
-0001d220: 6573 6861 7065 2858 2c20 5b58 2e73 6861  eshape(X, [X.sha
-0001d230: 7065 5b30 5d2c 202d 315d 290d 0a23 2020  pe[0], -1])..#  
-0001d240: 2020 2020 2020 2073 656c 662e 6463 6f76         self.dcov
-0001d250: 203d 2074 662e 6d61 746d 756c 2858 2c20   = tf.matmul(X, 
-0001d260: 7466 2e74 7261 6e73 706f 7365 2858 2929  tf.transpose(X))
-0001d270: 0d0a 0d0a 2320 2020 2020 2020 2020 2320  ....#         # 
-0001d280: 6765 7420 7370 6174 6961 6c20 6578 7472  get spatial extr
-0001d290: 6163 7469 6f6e 2066 6974 6572 2077 6569  action fiter wei
-0001d2a0: 6768 7473 0d0a 2320 2020 2020 2020 2020  ghts..#         
-0001d2b0: 6465 6d78 203d 2073 656c 662e 646d 782e  demx = self.dmx.
-0001d2c0: 772e 6e75 6d70 7928 290d 0a0d 0a23 2020  w.numpy()....#  
-0001d2d0: 2020 2020 2020 206b 6572 6e20 3d20 6e70         kern = np
-0001d2e0: 2e73 7175 6565 7a65 2873 656c 662e 7463  .squeeze(self.tc
-0001d2f0: 6f6e 762e 6669 6c74 6572 732e 6e75 6d70  onv.filters.nump
-0001d300: 7928 2929 2e54 0d0a 0d0a 2320 2020 2020  y()).T....#     
-0001d310: 2020 2020 5820 3d20 582e 6e75 6d70 7928      X = X.numpy(
-0001d320: 292e 540d 0a0d 0a23 2020 2020 2020 2020  ).T....#        
-0001d330: 2070 6174 7465 726e 7320 3d20 5b5d 0d0a   patterns = []..
-0001d340: 2320 2020 2020 2020 2020 585f 6669 6c74  #         X_filt
-0001d350: 203d 206e 702e 7a65 726f 735f 6c69 6b65   = np.zeros_like
-0001d360: 2858 290d 0a23 2020 2020 2020 2020 2066  (X)..#         f
-0001d370: 6f72 2069 5f63 6f6d 7020 696e 2072 616e  or i_comp in ran
-0001d380: 6765 286b 6572 6e2e 7368 6170 655b 305d  ge(kern.shape[0]
-0001d390: 293a 0d0a 2320 2020 2020 2020 2020 2020  ):..#           
-0001d3a0: 2020 666f 7220 695f 6368 2069 6e20 7261    for i_ch in ra
-0001d3b0: 6e67 6528 582e 7368 6170 655b 315d 293a  nge(X.shape[1]):
-0001d3c0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001d3d0: 2020 2020 7820 3d20 585b 3a2c 2069 5f63      x = X[:, i_c
-0001d3e0: 685d 0d0a 2320 2020 2020 2020 2020 2020  h]..#           
-0001d3f0: 2020 2020 2020 585f 6669 6c74 5b3a 2c20        X_filt[:, 
-0001d400: 695f 6368 5d20 3d20 6e70 2e63 6f6e 766f  i_ch] = np.convo
-0001d410: 6c76 6528 782c 206b 6572 6e5b 695f 636f  lve(x, kern[i_co
-0001d420: 6d70 2c20 3a5d 2c20 6d6f 6465 3d22 7361  mp, :], mode="sa
-0001d430: 6d65 2229 0d0a 2320 2020 2020 2020 2020  me")..#         
-0001d440: 2020 2020 7061 7474 6572 6e73 2e61 7070      patterns.app
-0001d450: 656e 6428 6e70 2e63 6f76 2858 5f66 696c  end(np.cov(X_fil
-0001d460: 742e 5429 2040 2064 656d 785b 3a2c 2069  t.T) @ demx[:, i
-0001d470: 5f63 6f6d 705d 290d 0a23 2020 2020 2020  _comp])..#      
-0001d480: 2020 2073 656c 662e 7061 7474 6572 6e73     self.patterns
-0001d490: 203d 206e 702e 6172 7261 7928 7061 7474   = np.array(patt
-0001d4a0: 6572 6e73 292e 540d 0a0d 0a0d 0a23 2020  erns).T......#  
-0001d4b0: 2020 2020 2020 2069 6620 2770 6174 7465         if 'patte
-0001d4c0: 726e 7327 2069 6e20 6f75 7470 7574 3a0d  rns' in output:.
-0001d4d0: 0a23 2020 2020 2020 2020 2020 2020 2069  .#             i
-0001d4e0: 6620 276f 6c64 2720 696e 206f 7574 7075  f 'old' in outpu
-0001d4f0: 743a 0d0a 2320 2020 2020 2020 2020 2020  t:..#           
-0001d500: 2020 2020 2020 7365 6c66 2e70 6174 7465        self.patte
-0001d510: 726e 7320 3d20 6e70 2e64 6f74 2873 656c  rns = np.dot(sel
-0001d520: 662e 6463 6f76 2c20 6465 6d78 290d 0a23  f.dcov, demx)..#
-0001d530: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0001d540: 653a 0d0a 2320 2020 2020 2020 2020 2020  e:..#           
-0001d550: 2020 2020 2020 7061 7474 6572 6e73 203d        patterns =
-0001d560: 205b 5d0d 0a23 2020 2020 2020 2020 2020   []..#          
-0001d570: 2020 2020 2020 2058 5f66 696c 7420 3d20         X_filt = 
-0001d580: 6e70 2e7a 6572 6f73 5f6c 696b 6528 5829  np.zeros_like(X)
-0001d590: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001d5a0: 2020 2020 666f 7220 695f 636f 6d70 2069      for i_comp i
-0001d5b0: 6e20 7261 6e67 6528 6b65 726e 2e73 6861  n range(kern.sha
-0001d5c0: 7065 5b30 5d29 3a0d 0a23 2020 2020 2020  pe[0]):..#      
-0001d5d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001d5e0: 6f72 2069 5f63 6820 696e 2072 616e 6765  or i_ch in range
-0001d5f0: 2858 2e73 6861 7065 5b31 5d29 3a0d 0a23  (X.shape[1]):..#
-0001d600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d610: 2020 2020 2020 2020 2078 203d 2058 5b3a           x = X[:
-0001d620: 2c20 695f 6368 5d0d 0a23 2020 2020 2020  , i_ch]..#      
-0001d630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d640: 2020 2058 5f66 696c 745b 3a2c 2069 5f63     X_filt[:, i_c
-0001d650: 685d 203d 206e 702e 636f 6e76 6f6c 7665  h] = np.convolve
-0001d660: 2878 2c20 6b65 726e 5b69 5f63 6f6d 702c  (x, kern[i_comp,
-0001d670: 203a 5d2c 206d 6f64 653d 2273 616d 6522   :], mode="same"
-0001d680: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
-0001d690: 2020 2020 2020 2020 2070 6174 7465 726e           pattern
-0001d6a0: 732e 6170 7065 6e64 286e 702e 636f 7628  s.append(np.cov(
-0001d6b0: 585f 6669 6c74 2e54 2920 4020 6465 6d78  X_filt.T) @ demx
-0001d6c0: 5b3a 2c20 695f 636f 6d70 5d29 0d0a 2320  [:, i_comp])..# 
-0001d6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d6e0: 7365 6c66 2e70 6174 7465 726e 7320 3d20  self.patterns = 
-0001d6f0: 6e70 2e61 7272 6179 2870 6174 7465 726e  np.array(pattern
-0001d700: 7329 2e54 0d0a 2320 2020 2020 2020 2020  s).T..#         
-0001d710: 656c 7365 3a0d 0a23 2020 2020 2020 2020  else:..#        
-0001d720: 2020 2020 2073 656c 662e 7061 7474 6572       self.patter
-0001d730: 6e73 203d 2064 656d 780d 0a0d 0a23 2020  ns = demx....#  
-0001d740: 2020 2020 2020 2073 656c 662e 6c61 745f         self.lat_
-0001d750: 7463 7320 3d20 6e70 2e64 6f74 2864 656d  tcs = np.dot(dem
-0001d760: 782e 542c 2058 2e54 290d 0a0d 0a23 2020  x.T, X.T)....#  
-0001d770: 2020 2020 2020 2064 656c 2058 0d0a 0d0a         del X....
-0001d780: 2320 2020 2020 2020 2020 2320 2054 656d  #         #  Tem
-0001d790: 706f 7261 6c20 636f 6e76 2073 7475 6666  poral conv stuff
-0001d7a0: 0d0a 2320 2020 2020 2020 2020 7365 6c66  ..#         self
-0001d7b0: 2e66 696c 7465 7273 203d 206b 6572 6e2e  .filters = kern.
-0001d7c0: 540d 0a23 2020 2020 2020 2020 2073 656c  T..#         sel
-0001d7d0: 662e 7463 5f6f 7574 203d 206e 702e 7371  f.tc_out = np.sq
-0001d7e0: 7565 657a 6528 7463 5f6f 7574 290d 0a23  ueeze(tc_out)..#
-0001d7f0: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
-0001d800: 7272 5f74 6f5f 6f75 7470 7574 203d 2073  rr_to_output = s
-0001d810: 656c 662e 6765 745f 6f75 7470 7574 5f63  elf.get_output_c
-0001d820: 6f72 7265 6c61 7469 6f6e 7328 7929 0d0a  orrelations(y)..
-0001d830: 0d0a 2320 2020 2020 6465 6620 706c 6f74  ..#     def plot
-0001d840: 5f70 6174 7465 726e 7328 0d0a 2320 2020  _patterns(..#   
-0001d850: 2020 2020 2020 7365 6c66 2c20 7365 6e73        self, sens
-0001d860: 6f72 5f6c 6179 6f75 743d 4e6f 6e65 2c20  or_layout=None, 
-0001d870: 736f 7274 696e 673d 276c 3227 2c20 7065  sorting='l2', pe
-0001d880: 7263 656e 7469 6c65 3d39 302c 0d0a 2320  rcentile=90,..# 
-0001d890: 2020 2020 2020 2020 7363 616c 653d 4661          scale=Fa
-0001d8a0: 6c73 652c 2063 6c61 7373 5f6e 616d 6573  lse, class_names
-0001d8b0: 3d4e 6f6e 652c 2069 6e66 6f3d 4e6f 6e65  =None, info=None
-0001d8c0: 0d0a 2320 2020 2020 293a 0d0a 2320 2020  ..#     ):..#   
-0001d8d0: 2020 2020 2020 6f72 6465 722c 2074 7320        order, ts 
-0001d8e0: 3d20 7365 6c66 2e5f 736f 7274 696e 6728  = self._sorting(
-0001d8f0: 736f 7274 696e 6729 0d0a 2320 2020 2020  sorting)..#     
-0001d900: 2020 2020 7365 6c66 2e75 6f72 6465 7220      self.uorder 
-0001d910: 3d20 6f72 6465 722e 7261 7665 6c28 290d  = order.ravel().
-0001d920: 0a23 2020 2020 2020 2020 206c 5f75 203d  .#         l_u =
-0001d930: 206c 656e 2873 656c 662e 756f 7264 6572   len(self.uorder
-0001d940: 290d 0a23 2020 2020 2020 2020 2069 6620  )..#         if 
-0001d950: 696e 666f 3a0d 0a23 2020 2020 2020 2020  info:..#        
-0001d960: 2020 2020 2069 6e66 6f2e 5f5f 7365 7473       info.__sets
-0001d970: 7461 7465 5f5f 2864 6963 7428 5f75 6e6c  tate__(dict(_unl
-0001d980: 6f63 6b65 643d 5472 7565 2929 0d0a 2320  ocked=True))..# 
-0001d990: 2020 2020 2020 2020 2020 2020 696e 666f              info
-0001d9a0: 5b27 7366 7265 7127 5d20 3d20 312e 0d0a  ['sfreq'] = 1...
-0001d9b0: 2320 2020 2020 2020 2020 2020 2020 7365  #             se
-0001d9c0: 6c66 2e66 616b 655f 6576 6f6b 6564 203d  lf.fake_evoked =
-0001d9d0: 2065 766f 6b65 642e 4576 6f6b 6564 4172   evoked.EvokedAr
-0001d9e0: 7261 7928 7365 6c66 2e70 6174 7465 726e  ray(self.pattern
-0001d9f0: 732c 2069 6e66 6f2c 2074 6d69 6e3d 3029  s, info, tmin=0)
-0001da00: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001da10: 6966 206c 5f75 203e 2031 3a0d 0a23 2020  if l_u > 1:..#  
-0001da20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001da30: 656c 662e 6661 6b65 5f65 766f 6b65 642e  elf.fake_evoked.
-0001da40: 6461 7461 5b3a 2c20 3a6c 5f75 5d20 3d20  data[:, :l_u] = 
-0001da50: 7365 6c66 2e66 616b 655f 6576 6f6b 6564  self.fake_evoked
-0001da60: 2e64 6174 615b 3a2c 2073 656c 662e 756f  .data[:, self.uo
-0001da70: 7264 6572 5d0d 0a23 2020 2020 2020 2020  rder]..#        
-0001da80: 2020 2020 2065 6c69 6620 6c5f 7520 3d3d       elif l_u ==
-0001da90: 2031 3a0d 0a23 2020 2020 2020 2020 2020   1:..#          
-0001daa0: 2020 2020 2020 2073 656c 662e 6661 6b65         self.fake
-0001dab0: 5f65 766f 6b65 642e 6461 7461 5b3a 2c20  _evoked.data[:, 
-0001dac0: 6c5f 755d 203d 2073 656c 662e 6661 6b65  l_u] = self.fake
-0001dad0: 5f65 766f 6b65 642e 6461 7461 5b3a 2c20  _evoked.data[:, 
-0001dae0: 7365 6c66 2e75 6f72 6465 725b 305d 5d0d  self.uorder[0]].
-0001daf0: 0a23 2020 2020 2020 2020 2020 2020 2073  .#             s
-0001db00: 656c 662e 6661 6b65 5f65 766f 6b65 642e  elf.fake_evoked.
-0001db10: 6372 6f70 2874 6d61 783d 666c 6f61 7428  crop(tmax=float(
-0001db20: 6c5f 7529 290d 0a23 2020 2020 2020 2020  l_u))..#        
-0001db30: 2020 2020 2069 6620 7363 616c 653a 0d0a       if scale:..
-0001db40: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0001db50: 2020 5f73 7464 203d 2073 656c 662e 6661    _std = self.fa
-0001db60: 6b65 5f65 766f 6b65 642e 6461 7461 5b3a  ke_evoked.data[:
-0001db70: 2c20 3a6c 5f75 5d2e 7374 6428 3029 0d0a  , :l_u].std(0)..
-0001db80: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0001db90: 2020 7365 6c66 2e66 616b 655f 6576 6f6b    self.fake_evok
-0001dba0: 6564 2e64 6174 615b 3a2c 203a 6c5f 755d  ed.data[:, :l_u]
-0001dbb0: 202f 3d20 5f73 7464 0d0a 2320 2020 2020   /= _std..#     
-0001dbc0: 2020 2020 656c 6966 2073 656e 736f 725f      elif sensor_
-0001dbd0: 6c61 796f 7574 3a0d 0a23 2020 2020 2020  layout:..#      
-0001dbe0: 2020 2020 2020 206c 6f20 3d20 6368 616e         lo = chan
-0001dbf0: 6e65 6c73 2e72 6561 645f 6c61 796f 7574  nels.read_layout
-0001dc00: 2873 656e 736f 725f 6c61 796f 7574 290d  (sensor_layout).
-0001dc10: 0a23 2020 2020 2020 2020 2020 2020 2069  .#             i
-0001dc20: 6e66 6f20 3d20 6372 6561 7465 5f69 6e66  nfo = create_inf
-0001dc30: 6f28 6c6f 2e6e 616d 6573 2c20 312e 2c20  o(lo.names, 1., 
-0001dc40: 7365 6e73 6f72 5f6c 6179 6f75 742e 7370  sensor_layout.sp
-0001dc50: 6c69 7428 272d 2729 5b2d 315d 290d 0a23  lit('-')[-1])..#
-0001dc60: 2020 2020 2020 2020 2020 2020 206f 7269               ori
-0001dc70: 675f 7879 203d 206e 702e 6d65 616e 286c  g_xy = np.mean(l
-0001dc80: 6f2e 706f 735b 3a2c 203a 325d 2c20 3029  o.pos[:, :2], 0)
-0001dc90: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001dca0: 666f 7220 692c 2063 6820 696e 2065 6e75  for i, ch in enu
-0001dcb0: 6d65 7261 7465 286c 6f2e 6e61 6d65 7329  merate(lo.names)
-0001dcc0: 3a0d 0a23 2020 2020 2020 2020 2020 2020  :..#            
-0001dcd0: 2020 2020 2069 6620 696e 666f 5b27 6368       if info['ch
-0001dce0: 7327 5d5b 695d 5b27 6368 5f6e 616d 6527  s'][i]['ch_name'
-0001dcf0: 5d20 3d3d 2063 683a 0d0a 2320 2020 2020  ] == ch:..#     
-0001dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd10: 696e 666f 5b27 6368 7327 5d5b 695d 5b27  info['chs'][i]['
-0001dd20: 6c6f 6327 5d5b 3a32 5d20 3d20 286c 6f2e  loc'][:2] = (lo.
-0001dd30: 706f 735b 692c 203a 325d 202d 206f 7269  pos[i, :2] - ori
-0001dd40: 675f 7879 292f 332e 0d0a 2320 2020 2020  g_xy)/3...#     
-0001dd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd60: 2369 6e66 6f5b 2763 6873 275d 5b69 5d5b  #info['chs'][i][
-0001dd70: 276c 6f63 275d 5b34 3a5d 203d 2030 0d0a  'loc'][4:] = 0..
-0001dd80: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0001dd90: 2020 656c 7365 3a0d 0a23 2020 2020 2020    else:..#      
-0001dda0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001ddb0: 7269 6e74 2822 4368 616e 6e65 6c20 6e61  rint("Channel na
-0001ddc0: 6d65 206d 6973 6d61 7463 682e 2069 6e66  me mismatch. inf
-0001ddd0: 6f3a 207b 7d20 7673 206c 6f3a 207b 7d22  o: {} vs lo: {}"
-0001dde0: 2e66 6f72 6d61 7428 0d0a 2320 2020 2020  .format(..#     
-0001ddf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de00: 2020 2020 696e 666f 5b27 6368 7327 5d5b      info['chs'][
-0001de10: 695d 5b27 6368 5f6e 616d 6527 5d2c 2063  i]['ch_name'], c
-0001de20: 6829 290d 0a0d 0a23 2020 2020 2020 2020  h))....#        
-0001de30: 2020 2020 2073 656c 662e 6661 6b65 5f65       self.fake_e
-0001de40: 766f 6b65 6420 3d20 6576 6f6b 6564 2e45  voked = evoked.E
-0001de50: 766f 6b65 6441 7272 6179 2873 656c 662e  vokedArray(self.
-0001de60: 7061 7474 6572 6e73 2c20 696e 666f 290d  patterns, info).
-0001de70: 0a0d 0a23 2020 2020 2020 2020 2020 2020  ...#            
-0001de80: 2069 6620 6c5f 7520 3e20 313a 0d0a 2320   if l_u > 1:..# 
-0001de90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dea0: 7365 6c66 2e66 616b 655f 6576 6f6b 6564  self.fake_evoked
-0001deb0: 2e64 6174 615b 3a2c 203a 6c5f 755d 203d  .data[:, :l_u] =
-0001dec0: 2073 656c 662e 6661 6b65 5f65 766f 6b65   self.fake_evoke
-0001ded0: 642e 6461 7461 5b3a 2c20 7365 6c66 2e75  d.data[:, self.u
-0001dee0: 6f72 6465 725d 0d0a 2320 2020 2020 2020  order]..#       
-0001def0: 2020 2020 2020 656c 6966 206c 5f75 203d        elif l_u =
-0001df00: 3d20 313a 0d0a 2320 2020 2020 2020 2020  = 1:..#         
-0001df10: 2020 2020 2020 2020 7365 6c66 2e66 616b          self.fak
-0001df20: 655f 6576 6f6b 6564 2e64 6174 615b 3a2c  e_evoked.data[:,
-0001df30: 206c 5f75 5d20 3d20 7365 6c66 2e66 616b   l_u] = self.fak
-0001df40: 655f 6576 6f6b 6564 2e64 6174 615b 3a2c  e_evoked.data[:,
-0001df50: 2073 656c 662e 756f 7264 6572 5b30 5d5d   self.uorder[0]]
-0001df60: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001df70: 7365 6c66 2e66 616b 655f 6576 6f6b 6564  self.fake_evoked
-0001df80: 2e63 726f 7028 746d 6178 3d66 6c6f 6174  .crop(tmax=float
-0001df90: 286c 5f75 2929 0d0a 2320 2020 2020 2020  (l_u))..#       
-0001dfa0: 2020 2020 2020 6966 2073 6361 6c65 3a0d        if scale:.
-0001dfb0: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
-0001dfc0: 2020 205f 7374 6420 3d20 7365 6c66 2e66     _std = self.f
-0001dfd0: 616b 655f 6576 6f6b 6564 2e64 6174 615b  ake_evoked.data[
-0001dfe0: 3a2c 203a 6c5f 755d 2e73 7464 2830 290d  :, :l_u].std(0).
-0001dff0: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
-0001e000: 2020 2073 656c 662e 6661 6b65 5f65 766f     self.fake_evo
-0001e010: 6b65 642e 6461 7461 5b3a 2c20 3a6c 5f75  ked.data[:, :l_u
-0001e020: 5d20 2f3d 205f 7374 640d 0a23 2020 2020  ] /= _std..#    
-0001e030: 2020 2020 2065 6c73 653a 0d0a 2320 2020       else:..#   
-0001e040: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001e050: 5661 6c75 6545 7272 6f72 2822 5370 6563  ValueError("Spec
-0001e060: 6966 7920 7365 6e73 6f72 206c 6179 6f75  ify sensor layou
-0001e070: 7422 290d 0a0d 0a0d 0a23 2020 2020 2020  t")......#      
-0001e080: 2020 2069 6620 6e70 2e61 6e79 2873 656c     if np.any(sel
-0001e090: 662e 756f 7264 6572 293a 0d0a 2320 2020  f.uorder):..#   
-0001e0a0: 2020 2020 2020 2020 2020 6e66 696c 7420            nfilt 
-0001e0b0: 3d20 6d61 7828 7365 6c66 2e6f 7574 5f64  = max(self.out_d
-0001e0c0: 696d 2c20 3829 0d0a 2320 2020 2020 2020  im, 8)..#       
-0001e0d0: 2020 2020 2020 6e72 6f77 7320 3d20 6d61        nrows = ma
-0001e0e0: 7828 312c 206c 5f75 2f2f 6e66 696c 7429  x(1, l_u//nfilt)
-0001e0f0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001e100: 6e63 6f6c 7320 3d20 6d69 6e28 6e66 696c  ncols = min(nfil
-0001e110: 742c 206c 5f75 290d 0a23 2020 2020 2020  t, l_u)..#      
-0001e120: 2020 2020 2020 2066 2c20 6178 203d 2070         f, ax = p
-0001e130: 6c74 2e73 7562 706c 6f74 7328 6e72 6f77  lt.subplots(nrow
-0001e140: 732c 206e 636f 6c73 2c20 7368 6172 6579  s, ncols, sharey
-0001e150: 3d54 7275 6529 0d0a 2320 2020 2020 2020  =True)..#       
-0001e160: 2020 2020 2020 706c 742e 7469 6768 745f        plt.tight_
-0001e170: 6c61 796f 7574 2829 0d0a 2320 2020 2020  layout()..#     
-0001e180: 2020 2020 2020 2020 662e 7365 745f 7369          f.set_si
-0001e190: 7a65 5f69 6e63 6865 7328 5b31 362c 2033  ze_inches([16, 3
-0001e1a0: 5d29 0d0a 2320 2020 2020 2020 2020 2020  ])..#           
-0001e1b0: 2020 6178 203d 206e 702e 6174 6c65 6173    ax = np.atleas
-0001e1c0: 745f 3264 2861 7829 0d0a 0d0a 2320 2020  t_2d(ax)....#   
-0001e1d0: 2020 2020 2020 2020 2020 666f 7220 6969            for ii
-0001e1e0: 2069 6e20 7261 6e67 6528 6e72 6f77 7329   in range(nrows)
-0001e1f0: 3a0d 0a23 2020 2020 2020 2020 2020 2020  :..#            
-0001e200: 2020 2020 2066 616b 655f 7469 6d65 7320       fake_times 
-0001e210: 3d20 6e70 2e61 7261 6e67 6528 6969 202a  = np.arange(ii *
-0001e220: 206e 636f 6c73 2c20 2028 6969 202b 2031   ncols,  (ii + 1
-0001e230: 2920 2a20 6e63 6f6c 732c 2031 2e29 0d0a  ) * ncols, 1.)..
-0001e240: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0001e250: 2020 766d 6178 203d 206e 702e 7065 7263    vmax = np.perc
-0001e260: 656e 7469 6c65 2873 656c 662e 6661 6b65  entile(self.fake
-0001e270: 5f65 766f 6b65 642e 6461 7461 5b3a 2c20  _evoked.data[:, 
-0001e280: 3a6c 5f75 5d2c 2039 3529 0d0a 2320 2020  :l_u], 95)..#   
-0001e290: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0001e2a0: 6c66 2e66 616b 655f 6576 6f6b 6564 2e70  lf.fake_evoked.p
-0001e2b0: 6c6f 745f 746f 706f 6d61 7028 0d0a 2320  lot_topomap(..# 
-0001e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2d0: 2020 2020 7469 6d65 733d 6661 6b65 5f74      times=fake_t
-0001e2e0: 696d 6573 2c0d 0a23 2020 2020 2020 2020  imes,..#        
-0001e2f0: 2020 2020 2020 2020 2020 2020 2061 7865               axe
-0001e300: 733d 6178 5b69 695d 2c0d 0a23 2020 2020  s=ax[ii],..#    
-0001e310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e320: 2063 6f6c 6f72 6261 723d 4661 6c73 652c   colorbar=False,
-0001e330: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001e340: 2020 2020 2020 2020 766d 6178 3d76 6d61          vmax=vma
-0001e350: 782c 0d0a 2320 2020 2020 2020 2020 2020  x,..#           
-0001e360: 2020 2020 2020 2020 2020 7363 616c 696e            scalin
-0001e370: 6773 3d31 2c0d 0a23 2020 2020 2020 2020  gs=1,..#        
-0001e380: 2020 2020 2020 2020 2020 2020 2074 696d               tim
-0001e390: 655f 666f 726d 6174 3d22 4272 616e 6368  e_format="Branch
-0001e3a0: 2023 2567 222c 0d0a 2320 2020 2020 2020   #%g",..#       
-0001e3b0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-0001e3c0: 746c 653d 2750 6174 7465 726e 7320 2827  tle='Patterns ('
-0001e3d0: 2b73 7472 2873 6f72 7469 6e67 292b 2729  +str(sorting)+')
-0001e3e0: 272c 0d0a 2320 2020 2020 2020 2020 2020  ',..#           
-0001e3f0: 2020 2020 2020 2020 2020 6f75 746c 696e            outlin
-0001e400: 6573 3d27 6865 6164 272c 0d0a 2320 2020  es='head',..#   
-0001e410: 2020 2020 2020 2020 2020 2020 2020 290d                ).
-0001e420: 0a0d 0a23 2020 2020 2064 6566 2062 7261  ...#     def bra
-0001e430: 6e63 6877 6973 655f 6c6f 7373 2873 656c  nchwise_loss(sel
-0001e440: 662c 2058 2c20 7929 3a0d 0a23 2020 2020  f, X, y):..#    
-0001e450: 2020 2020 206d 6f64 656c 5f77 6569 6768       model_weigh
-0001e460: 7473 5f6f 7269 6769 6e61 6c20 3d20 7365  ts_original = se
-0001e470: 6c66 2e6b 6d2e 6765 745f 7765 6967 6874  lf.km.get_weight
-0001e480: 7328 292e 636f 7079 2829 0d0a 2320 2020  s().copy()..#   
-0001e490: 2020 2020 2020 6261 7365 5f6c 6f73 732c        base_loss,
-0001e4a0: 205f 203d 2073 656c 662e 6b6d 2e65 7661   _ = self.km.eva
-0001e4b0: 6c75 6174 6528 582c 2079 2c20 7665 7262  luate(X, y, verb
-0001e4c0: 6f73 653d 3029 0d0a 0d0a 2320 2020 2020  ose=0)....#     
-0001e4d0: 2020 2020 6c6f 7373 6573 203d 205b 5d0d      losses = [].
-0001e4e0: 0a23 2020 2020 2020 2020 2066 6f72 2069  .#         for i
-0001e4f0: 2069 6e20 7261 6e67 6528 7365 6c66 2e73   in range(self.s
-0001e500: 7065 6373 5b22 6e5f 6c61 7465 6e74 225d  pecs["n_latent"]
-0001e510: 293a 0d0a 2320 2020 2020 2020 2020 2020  ):..#           
-0001e520: 2020 6d6f 6465 6c5f 7765 6967 6874 7320    model_weights 
-0001e530: 3d20 6d6f 6465 6c5f 7765 6967 6874 735f  = model_weights_
-0001e540: 6f72 6967 696e 616c 2e63 6f70 7928 290d  original.copy().
-0001e550: 0a23 2020 2020 2020 2020 2020 2020 2073  .#             s
-0001e560: 7061 7469 616c 5f77 6569 6768 7473 203d  patial_weights =
-0001e570: 206d 6f64 656c 5f77 6569 6768 7473 5b30   model_weights[0
-0001e580: 5d2e 636f 7079 2829 0d0a 2320 2020 2020  ].copy()..#     
-0001e590: 2020 2020 2020 2020 7370 6174 6961 6c5f          spatial_
-0001e5a0: 6269 6173 6573 203d 206d 6f64 656c 5f77  biases = model_w
-0001e5b0: 6569 6768 7473 5b31 5d2e 636f 7079 2829  eights[1].copy()
-0001e5c0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001e5d0: 7465 6d70 6f72 616c 5f62 6961 7365 7320  temporal_biases 
-0001e5e0: 3d20 6d6f 6465 6c5f 7765 6967 6874 735b  = model_weights[
-0001e5f0: 335d 2e63 6f70 7928 290d 0a23 2020 2020  3].copy()..#    
-0001e600: 2020 2020 2020 2020 2065 6e76 5f62 6961           env_bia
-0001e610: 7365 7320 3d20 6d6f 6465 6c5f 7765 6967  ses = model_weig
-0001e620: 6874 735b 355d 2e63 6f70 7928 290d 0a23  hts[5].copy()..#
-0001e630: 2020 2020 2020 2020 2020 2020 2073 7061               spa
-0001e640: 7469 616c 5f77 6569 6768 7473 5b3a 2c20  tial_weights[:, 
-0001e650: 695d 203d 2030 0d0a 2320 2020 2020 2020  i] = 0..#       
-0001e660: 2020 2020 2020 7370 6174 6961 6c5f 6269        spatial_bi
-0001e670: 6173 6573 5b69 5d20 3d20 300d 0a23 2020  ases[i] = 0..#  
-0001e680: 2020 2020 2020 2020 2020 2074 656d 706f             tempo
-0001e690: 7261 6c5f 6269 6173 6573 5b69 5d20 3d20  ral_biases[i] = 
-0001e6a0: 300d 0a23 2020 2020 2020 2020 2020 2020  0..#            
-0001e6b0: 2065 6e76 5f62 6961 7365 735b 695d 203d   env_biases[i] =
-0001e6c0: 2030 0d0a 2320 2020 2020 2020 2020 2020   0..#           
-0001e6d0: 2020 6d6f 6465 6c5f 7765 6967 6874 735b    model_weights[
-0001e6e0: 305d 203d 2073 7061 7469 616c 5f77 6569  0] = spatial_wei
-0001e6f0: 6768 7473 0d0a 2320 2020 2020 2020 2020  ghts..#         
-0001e700: 2020 2020 6d6f 6465 6c5f 7765 6967 6874      model_weight
-0001e710: 735b 315d 203d 2073 7061 7469 616c 5f62  s[1] = spatial_b
-0001e720: 6961 7365 730d 0a23 2020 2020 2020 2020  iases..#        
-0001e730: 2020 2020 206d 6f64 656c 5f77 6569 6768       model_weigh
-0001e740: 7473 5b33 5d20 3d20 7465 6d70 6f72 616c  ts[3] = temporal
-0001e750: 5f62 6961 7365 730d 0a23 2020 2020 2020  _biases..#      
-0001e760: 2020 2020 2020 206d 6f64 656c 5f77 6569         model_wei
-0001e770: 6768 7473 5b35 5d20 3d20 656e 765f 6269  ghts[5] = env_bi
-0001e780: 6173 6573 0d0a 2320 2020 2020 2020 2020  ases..#         
-0001e790: 2020 2020 7365 6c66 2e6b 6d2e 7365 745f      self.km.set_
-0001e7a0: 7765 6967 6874 7328 6d6f 6465 6c5f 7765  weights(model_we
-0001e7b0: 6967 6874 7329 0d0a 2320 2020 2020 2020  ights)..#       
-0001e7c0: 2020 2020 2020 6c6f 7373 6573 2e61 7070        losses.app
-0001e7d0: 656e 6428 7365 6c66 2e6b 6d2e 6576 616c  end(self.km.eval
-0001e7e0: 7561 7465 2858 2c20 792c 2076 6572 626f  uate(X, y, verbo
-0001e7f0: 7365 3d30 295b 305d 290d 0a23 2020 2020  se=0)[0])..#    
-0001e800: 2020 2020 2073 656c 662e 6b6d 2e73 6574       self.km.set
-0001e810: 5f77 6569 6768 7473 286d 6f64 656c 5f77  _weights(model_w
-0001e820: 6569 6768 7473 5f6f 7269 6769 6e61 6c29  eights_original)
-0001e830: 0d0a 2320 2020 2020 2020 2020 7365 6c66  ..#         self
-0001e840: 2e62 7261 6e63 685f 7265 6c65 7661 6e63  .branch_relevanc
-0001e850: 655f 6c6f 7373 203d 2062 6173 655f 6c6f  e_loss = base_lo
-0001e860: 7373 202d 206e 702e 6172 7261 7928 6c6f  ss - np.array(lo
-0001e870: 7373 6573 290d 0a0d 0a23 2020 2020 2064  sses)....#     d
-0001e880: 6566 2070 6c6f 745f 6272 616e 6368 280d  ef plot_branch(.
-0001e890: 0a23 2020 2020 2020 2020 2073 656c 662c  .#         self,
-0001e8a0: 0d0a 2320 2020 2020 2020 2020 6272 616e  ..#         bran
-0001e8b0: 6368 5f6e 756d 3a20 696e 742c 0d0a 2320  ch_num: int,..# 
-0001e8c0: 2020 2020 2020 2020 696e 666f 3a20 496e          info: In
-0001e8d0: 666f 2c0d 0a23 2020 2020 2020 2020 2070  fo,..#         p
-0001e8e0: 6172 616d 733a 204f 7074 696f 6e61 6c5b  arams: Optional[
-0001e8f0: 6c69 7374 5b73 7472 5d5d 203d 205b 2769  list[str]] = ['i
-0001e900: 6e70 7574 272c 2027 6f75 7470 7574 272c  nput', 'output',
-0001e910: 2027 7265 7370 6f6e 7365 275d 0d0a 2320   'response']..# 
-0001e920: 2020 2020 293a 0d0a 2320 2020 2020 2020      ):..#       
-0001e930: 2020 696e 666f 2e5f 5f73 6574 7374 6174    info.__setstat
-0001e940: 655f 5f28 6469 6374 285f 756e 6c6f 636b  e__(dict(_unlock
-0001e950: 6564 3d54 7275 6529 290d 0a23 2020 2020  ed=True))..#    
-0001e960: 2020 2020 2069 6e66 6f5b 2773 6672 6571       info['sfreq
-0001e970: 275d 203d 2031 2e0d 0a23 2020 2020 2020  '] = 1...#      
-0001e980: 2020 2073 6f72 7469 6e67 203d 206e 702e     sorting = np.
-0001e990: 6172 6773 6f72 7428 7365 6c66 2e62 7261  argsort(self.bra
-0001e9a0: 6e63 685f 7265 6c65 7661 6e63 655f 6c6f  nch_relevance_lo
-0001e9b0: 7373 295b 3a3a 2d31 5d0d 0a23 2020 2020  ss)[::-1]..#    
-0001e9c0: 2020 2020 2064 6174 6120 3d20 7365 6c66       data = self
-0001e9d0: 2e70 6174 7465 726e 735b 3a2c 2073 6f72  .patterns[:, sor
-0001e9e0: 7469 6e67 5d0d 0a23 2020 2020 2020 2020  ting]..#        
-0001e9f0: 2066 696c 7465 7273 203d 2073 656c 662e   filters = self.
-0001ea00: 6669 6c74 6572 735b 3a2c 2073 6f72 7469  filters[:, sorti
-0001ea10: 6e67 5d0d 0a23 2020 2020 2020 2020 2072  ng]..#         r
-0001ea20: 656c 6576 616e 6365 7320 3d20 7365 6c66  elevances = self
-0001ea30: 2e62 7261 6e63 685f 7265 6c65 7661 6e63  .branch_relevanc
-0001ea40: 655f 6c6f 7373 202d 2073 656c 662e 6272  e_loss - self.br
-0001ea50: 616e 6368 5f72 656c 6576 616e 6365 5f6c  anch_relevance_l
-0001ea60: 6f73 732e 6d69 6e28 290d 0a23 2020 2020  oss.min()..#    
-0001ea70: 2020 2020 2072 656c 6576 616e 6365 203d       relevance =
-0001ea80: 2073 6f72 7465 6428 5b6e 702e 726f 756e   sorted([np.roun
-0001ea90: 6428 7265 6c2f 7265 6c65 7661 6e63 6573  d(rel/relevances
-0001eaa0: 2e73 756d 2829 2c20 3229 2066 6f72 2072  .sum(), 2) for r
-0001eab0: 656c 2069 6e20 7265 6c65 7661 6e63 6573  el in relevances
-0001eac0: 5d2c 2072 6576 6572 7365 3d54 7275 6529  ], reverse=True)
-0001ead0: 5b62 7261 6e63 685f 6e75 6d5d 0d0a 2320  [branch_num]..# 
-0001eae0: 2020 2020 2020 2020 7365 6c66 2e66 616b          self.fak
-0001eaf0: 655f 6576 6f6b 6564 203d 2065 766f 6b65  e_evoked = evoke
-0001eb00: 642e 4576 6f6b 6564 4172 7261 7928 6461  d.EvokedArray(da
-0001eb10: 7461 2c20 696e 666f 2c20 746d 696e 3d30  ta, info, tmin=0
-0001eb20: 290d 0a23 2020 2020 2020 2020 2066 6967  )..#         fig
-0001eb30: 2c20 2861 7831 2c20 6178 3229 203d 2070  , (ax1, ax2) = p
-0001eb40: 6c74 2e73 7562 706c 6f74 7328 6e63 6f6c  lt.subplots(ncol
-0001eb50: 733d 322c 206e 726f 7773 3d31 290d 0a23  s=2, nrows=1)..#
-0001eb60: 2020 2020 2020 2020 2066 6967 2e74 6967           fig.tig
-0001eb70: 6874 5f6c 6179 6f75 7428 290d 0a0d 0a23  ht_layout()....#
-0001eb80: 2020 2020 2020 2020 2073 656c 662e 6673           self.fs
-0001eb90: 203d 2073 656c 662e 6461 7461 7365 742e   = self.dataset.
-0001eba0: 685f 7061 7261 6d73 5b27 6673 275d 0d0a  h_params['fs']..
-0001ebb0: 0d0a 2320 2020 2020 2020 2020 6f75 745f  ..#         out_
-0001ebc0: 6669 6c74 6572 203d 2066 696c 7465 7273  filter = filters
-0001ebd0: 5b3a 2c20 6272 616e 6368 5f6e 756d 5d0d  [:, branch_num].
-0001ebe0: 0a23 2020 2020 2020 2020 205f 2c20 7073  .#         _, ps
-0001ebf0: 6420 3d20 7765 6c63 6828 7365 6c66 2e6c  d = welch(self.l
-0001ec00: 6174 5f74 6373 5b62 7261 6e63 685f 6e75  at_tcs[branch_nu
-0001ec10: 6d5d 2c20 6673 3d73 656c 662e 6673 2c20  m], fs=self.fs, 
-0001ec20: 6e70 6572 7365 673d 7365 6c66 2e66 7320  nperseg=self.fs 
-0001ec30: 2a20 3229 0d0a 2320 2020 2020 2020 2020  * 2)..#         
-0001ec40: 772c 2068 203d 2028 6c61 6d62 6461 2077  w, h = (lambda w
-0001ec50: 2c20 683a 2028 772c 2068 2929 282a 6672  , h: (w, h))(*fr
-0001ec60: 6571 7a28 6f75 745f 6669 6c74 6572 2c20  eqz(out_filter, 
-0001ec70: 312c 2077 6f72 4e3d 7365 6c66 2e66 7329  1, worN=self.fs)
-0001ec80: 290d 0a23 2020 2020 2020 2020 2066 7261  )..#         fra
-0001ec90: 6e67 6520 3d20 7720 2f20 6e70 2e70 6920  nge = w / np.pi 
-0001eca0: 2a20 7365 6c66 2e66 7320 2f20 320d 0a23  * self.fs / 2..#
-0001ecb0: 2020 2020 2020 2020 207a 203d 206c 616d           z = lam
-0001ecc0: 6264 6120 783a 2028 7820 2d20 782e 6d65  bda x: (x - x.me
-0001ecd0: 616e 2829 292f 782e 7374 6428 290d 0a0d  an())/x.std()...
-0001ece0: 0a23 2020 2020 2020 2020 2066 6f72 2070  .#         for p
-0001ecf0: 6172 616d 2069 6e20 7061 7261 6d73 3a0d  aram in params:.
-0001ed00: 0a23 2020 2020 2020 2020 2020 2020 2069  .#             i
-0001ed10: 6620 7061 7261 6d20 3d3d 2027 696e 7075  f param == 'inpu
-0001ed20: 7427 3a0d 0a23 2020 2020 2020 2020 2020  t':..#          
-0001ed30: 2020 2020 2020 2066 696e 7075 7420 3d20         finput = 
-0001ed40: 7073 645b 3a2d 315d 0d0a 2320 2020 2020  psd[:-1]..#     
-0001ed50: 2020 2020 2020 2020 2020 2020 6669 6e70              finp
-0001ed60: 7574 203d 207a 2866 696e 7075 7429 0d0a  ut = z(finput)..
-0001ed70: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0001ed80: 2020 6178 322e 706c 6f74 2866 7261 6e67    ax2.plot(frang
-0001ed90: 652c 2066 696e 7075 7420 2d20 6669 6e70  e, finput - finp
-0001eda0: 7574 2e6d 696e 2829 2c20 636f 6c6f 723d  ut.min(), color=
-0001edb0: 2774 6162 3a62 6c75 6527 290d 0a23 2020  'tab:blue')..#  
-0001edc0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0001edd0: 7061 7261 6d20 3d3d 2027 6f75 7470 7574  param == 'output
-0001ede0: 273a 0d0a 2320 2020 2020 2020 2020 2020  ':..#           
-0001edf0: 2020 2020 2020 666f 7574 7075 7420 3d20        foutput = 
-0001ee00: 6e70 2e72 6561 6c28 6669 6e70 7574 202a  np.real(finput *
-0001ee10: 2068 202a 206e 702e 636f 6e6a 2868 2929   h * np.conj(h))
-0001ee20: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001ee30: 2020 2020 666f 7574 7075 7420 3d20 7a28      foutput = z(
-0001ee40: 666f 7574 7075 7429 0d0a 2320 2020 2020  foutput)..#     
-0001ee50: 2020 2020 2020 2020 2020 2020 6178 322e              ax2.
-0001ee60: 706c 6f74 2866 7261 6e67 652c 2066 6f75  plot(frange, fou
-0001ee70: 7470 7574 202d 2066 6f75 7470 7574 2e6d  tput - foutput.m
-0001ee80: 696e 2829 2c20 636f 6c6f 723d 2774 6162  in(), color='tab
-0001ee90: 3a6f 7261 6e67 6527 290d 0a23 2020 2020  :orange')..#    
-0001eea0: 2020 2020 2020 2020 2065 6c69 6620 7061           elif pa
-0001eeb0: 7261 6d20 3d3d 2027 7265 7370 6f6e 7365  ram == 'response
-0001eec0: 273a 0d0a 2320 2020 2020 2020 2020 2020  ':..#           
-0001eed0: 2020 2020 2020 6672 6573 706f 6e63 6520        fresponce 
-0001eee0: 3d20 6e70 2e61 6273 2868 290d 0a23 2020  = np.abs(h)..#  
-0001eef0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001ef00: 7265 7370 6f6e 6365 203d 207a 2866 7265  responce = z(fre
-0001ef10: 7370 6f6e 6365 290d 0a23 2020 2020 2020  sponce)..#      
-0001ef20: 2020 2020 2020 2020 2020 2061 7832 2e70             ax2.p
-0001ef30: 6c6f 7428 6672 616e 6765 2c20 6672 6573  lot(frange, fres
-0001ef40: 706f 6e63 6520 2d20 6672 6573 706f 6e63  ponce - fresponc
-0001ef50: 652e 6d69 6e28 292c 2063 6f6c 6f72 3d27  e.min(), color='
-0001ef60: 7461 623a 6772 6565 6e27 290d 0a23 2020  tab:green')..#  
-0001ef70: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0001ef80: 7061 7261 6d20 3d3d 2027 7061 7474 6572  param == 'patter
-0001ef90: 6e27 3a0d 0a23 2020 2020 2020 2020 2020  n':..#          
-0001efa0: 2020 2020 2020 2066 7061 7474 6572 6e20         fpattern 
-0001efb0: 3d20 6669 6e70 7574 202a 206e 702e 6162  = finput * np.ab
-0001efc0: 7328 6829 0d0a 2320 2020 2020 2020 2020  s(h)..#         
-0001efd0: 2020 2020 2020 2020 6670 6174 7465 726e          fpattern
-0001efe0: 203d 207a 2866 7061 7474 6572 6e29 0d0a   = z(fpattern)..
-0001eff0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0001f000: 2020 6178 322e 706c 6f74 2866 7261 6e67    ax2.plot(frang
-0001f010: 652c 2066 7061 7474 6572 6e20 2d20 6670  e, fpattern - fp
-0001f020: 6174 7465 726e 2e6d 696e 2829 2c20 636f  attern.min(), co
-0001f030: 6c6f 723d 2774 6162 3a70 696e 6b27 290d  lor='tab:pink').
-0001f040: 0a0d 0a23 2020 2020 2020 2020 2061 7832  ...#         ax2
-0001f050: 2e6c 6567 656e 6428 5b70 6172 616d 2e63  .legend([param.c
-0001f060: 6170 6974 616c 697a 6528 2920 666f 7220  apitalize() for 
-0001f070: 7061 7261 6d20 696e 2070 6172 616d 735d  param in params]
-0001f080: 290d 0a23 2020 2020 2020 2020 2061 7832  )..#         ax2
-0001f090: 2e73 6574 5f78 6c69 6d28 302c 2031 3030  .set_xlim(0, 100
-0001f0a0: 290d 0a0d 0a23 2020 2020 2020 2020 2066  )....#         f
-0001f0b0: 6967 2e73 7570 7469 746c 6528 6627 4272  ig.suptitle(f'Br
-0001f0c0: 616e 6368 207b 6272 616e 6368 5f6e 756d  anch {branch_num
-0001f0d0: 7d27 2c20 793d 302e 3935 2c20 783d 302e  }', y=0.95, x=0.
-0001f0e0: 322c 2066 6f6e 7473 697a 653d 3330 290d  2, fontsize=30).
-0001f0f0: 0a23 2020 2020 2020 2020 2066 6967 2e73  .#         fig.s
-0001f100: 6574 5f73 697a 655f 696e 6368 6573 2831  et_size_inches(1
-0001f110: 302c 2035 290d 0a23 2020 2020 2020 2020  0, 5)..#        
-0001f120: 2073 656c 662e 6661 6b65 5f65 766f 6b65   self.fake_evoke
-0001f130: 642e 706c 6f74 5f74 6f70 6f6d 6170 280d  d.plot_topomap(.
-0001f140: 0a23 2020 2020 2020 2020 2020 2020 2074  .#             t
-0001f150: 696d 6573 3d62 7261 6e63 685f 6e75 6d2c  imes=branch_num,
-0001f160: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001f170: 6178 6573 3d61 7831 2c0d 0a23 2020 2020  axes=ax1,..#    
-0001f180: 2020 2020 2020 2020 2063 6f6c 6f72 6261           colorba
-0001f190: 723d 4661 6c73 652c 0d0a 2320 2020 2020  r=False,..#     
-0001f1a0: 2020 2020 2020 2020 7363 616c 696e 6773          scalings
-0001f1b0: 3d31 2c0d 0a23 2020 2020 2020 2020 2020  =1,..#          
-0001f1c0: 2020 2074 696d 655f 666f 726d 6174 3d22     time_format="
-0001f1d0: 222c 0d0a 2320 2020 2020 2020 2020 2020  ",..#           
-0001f1e0: 2020 6f75 746c 696e 6573 3d27 6865 6164    outlines='head
-0001f1f0: 272c 0d0a 2320 2020 2020 2020 2020 290d  ',..#         ).
-0001f200: 0a0d 0a23 2020 2020 2020 2020 2072 6574  ...#         ret
-0001f210: 7572 6e20 6669 670d 0a0d 0a0d 0a         urn fig......
+0001bfb0: 2020 2020 2020 2020 2020 2020 2075 7365               use
+0001bfc0: 5f62 6961 7320 3d20 4661 6c73 652c 2070  _bias = False, p
+0001bfd0: 6164 6469 6e67 203d 2073 656c 662e 7370  adding = self.sp
+0001bfe0: 6563 735b 2770 6164 6469 6e67 275d 2928  ecs['padding'])(
+0001bff0: 626c 6f63 6b31 290d 0a20 2020 2020 2020  block1)..       
+0001c000: 2023 626c 6f63 6b32 2020 2020 2020 203d   #block2       =
+0001c010: 2042 6174 6368 4e6f 726d 616c 697a 6174   BatchNormalizat
+0001c020: 696f 6e28 6178 6973 203d 2031 2928 626c  ion(axis = 1)(bl
+0001c030: 6f63 6b32 290d 0a0d 0a20 2020 2020 2020  ock2)....       
+0001c040: 2023 7072 696e 7428 2242 6174 6368 6e6f   #print("Batchno
+0001c050: 726d 2032 3a22 2c20 626c 6f63 6b32 2e73  rm 2:", block2.s
+0001c060: 6861 7065 290d 0a0d 0a20 2020 2020 2020  hape)....       
+0001c070: 2062 6c6f 636b 3220 2020 2020 2020 3d20   block2       = 
+0001c080: 6c61 7965 7273 2e41 6374 6976 6174 696f  layers.Activatio
+0001c090: 6e28 7365 6c66 2e73 7065 6373 5b27 6e6f  n(self.specs['no
+0001c0a0: 6e6c 696e 275d 2928 626c 6f63 6b32 290d  nlin'])(block2).
+0001c0b0: 0a20 2020 2020 2020 2062 6c6f 636b 3220  .        block2 
+0001c0c0: 2020 2020 2020 3d20 6c61 7965 7273 2e41        = layers.A
+0001c0d0: 7665 7261 6765 506f 6f6c 696e 6732 4428  veragePooling2D(
+0001c0e0: 2831 2c20 7365 6c66 2e73 7065 6373 5b27  (1, self.specs['
+0001c0f0: 706f 6f6c 696e 6727 5d2a 3229 2928 626c  pooling']*2))(bl
+0001c100: 6f63 6b32 290d 0a20 2020 2020 2020 2062  ock2)..        b
+0001c110: 6c6f 636b 3220 2020 2020 2020 3d20 6472  lock2       = dr
+0001c120: 6f70 6f75 7454 7970 6528 7365 6c66 2e73  opoutType(self.s
+0001c130: 7065 6373 5b27 6472 6f70 6f75 7427 5d29  pecs['dropout'])
+0001c140: 2862 6c6f 636b 3229 0d0a 2020 2020 2020  (block2)..      
+0001c150: 2020 7072 696e 7428 2242 6c6f 636b 2032    print("Block 2
+0001c160: 3a22 2c20 626c 6f63 6b32 2e73 6861 7065  :", block2.shape
+0001c170: 290d 0a0d 0a20 2020 2020 2020 2066 696e  )....        fin
+0001c180: 5f66 6320 3d20 4675 6c6c 7943 6f6e 6e65  _fc = FullyConne
+0001c190: 6374 6564 2873 697a 653d 7365 6c66 2e6f  cted(size=self.o
+0001c1a0: 7574 5f64 696d 2c20 6e6f 6e6c 696e 3d74  ut_dim, nonlin=t
+0001c1b0: 662e 6964 656e 7469 7479 2c0d 0a20 2020  f.identity,..   
+0001c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c1d0: 2020 2020 2020 2020 2073 7065 6373 3d73           specs=s
+0001c1e0: 656c 662e 7370 6563 7329 0d0a 2020 2020  elf.specs)..    
+0001c1f0: 2020 2020 795f 7072 6564 203d 2066 696e      y_pred = fin
+0001c200: 5f66 6328 626c 6f63 6b32 290d 0a0d 0a20  _fc(block2).... 
+0001c210: 2020 2020 2020 2072 6574 7572 6e20 795f         return y_
+0001c220: 7072 6564 0d0a 0d0a 2320 636c 6173 7320  pred....# class 
+0001c230: 5369 6d70 6c65 4e65 7428 4c46 434e 4e29  SimpleNet(LFCNN)
+0001c240: 3a0d 0a23 2020 2020 2022 2222 0d0a 2320  :..#     """..# 
+0001c250: 2020 2020 2020 2020 5065 7472 6f73 7961          Petrosya
+0001c260: 6e2c 2041 2e2c 2053 696e 6b69 6e2c 204d  n, A., Sinkin, M
+0001c270: 2e2c 204c 6562 6564 6576 2c20 4d2e 2041  ., Lebedev, M. A
+0001c280: 2e2c 2026 204f 7373 6164 7463 6869 2c20  ., & Ossadtchi, 
+0001c290: 412e 2020 4465 636f 6469 6e67 2061 6e64  A.  Decoding and
+0001c2a0: 2069 6e74 6572 7072 6574 696e 6720 636f   interpreting co
+0001c2b0: 7274 6963 616c 2073 6967 6e61 6c73 2077  rtical signals w
+0001c2c0: 6974 680d 0a23 2020 2020 2020 2020 2061  ith..#         a
+0001c2d0: 2063 6f6d 7061 6374 2063 6f6e 766f 6c75   compact convolu
+0001c2e0: 7469 6f6e 616c 206e 6575 7261 6c20 6e65  tional neural ne
+0001c2f0: 7477 6f72 6b2c 2032 3032 312c 204a 6f75  twork, 2021, Jou
+0001c300: 726e 616c 206f 6620 4e65 7572 616c 2045  rnal of Neural E
+0001c310: 6e67 696e 6565 7269 6e67 2c20 3230 3231  ngineering, 2021
+0001c320: 2c0d 0a23 2020 2020 2020 2020 2068 7474  ,..#         htt
+0001c330: 7073 3a2f 2f64 6f69 2e6f 7267 2f31 302e  ps://doi.org/10.
+0001c340: 3130 3838 2f31 3734 312d 3235 3532 2f61  1088/1741-2552/a
+0001c350: 6265 3230 650d 0a23 2020 2020 2022 2222  be20e..#     """
+0001c360: 0d0a 2320 2020 2020 6465 6620 5f5f 696e  ..#     def __in
+0001c370: 6974 5f5f 2873 656c 662c 2044 6174 6173  it__(self, Datas
+0001c380: 6574 2c20 7370 6563 733d 4e6f 6e65 293a  et, specs=None):
+0001c390: 0d0a 2320 2020 2020 2020 2020 6966 2073  ..#         if s
+0001c3a0: 7065 6373 2069 7320 4e6f 6e65 3a0d 0a23  pecs is None:..#
+0001c3b0: 2020 2020 2020 2020 2020 2020 2073 7065               spe
+0001c3c0: 6373 3d64 6963 7428 290d 0a23 2020 2020  cs=dict()..#    
+0001c3d0: 2020 2020 2073 7570 6572 2829 2e5f 5f69       super().__i
+0001c3e0: 6e69 745f 5f28 4461 7461 7365 742c 2073  nit__(Dataset, s
+0001c3f0: 7065 6373 290d 0a0d 0a23 2020 2020 2064  pecs)....#     d
+0001c400: 6566 2062 7569 6c64 5f67 7261 7068 2873  ef build_graph(s
+0001c410: 656c 6629 3a0d 0a23 2020 2020 2020 2020  elf):..#        
+0001c420: 2073 656c 662e 646d 7820 3d20 4465 4d69   self.dmx = DeMi
+0001c430: 7869 6e67 2873 697a 653d 7365 6c66 2e73  xing(size=self.s
+0001c440: 7065 6373 5b27 6e5f 6c61 7465 6e74 275d  pecs['n_latent']
+0001c450: 2c20 6e6f 6e6c 696e 3d74 662e 6964 656e  , nonlin=tf.iden
+0001c460: 7469 7479 2c0d 0a23 2020 2020 2020 2020  tity,..#        
+0001c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c480: 2020 2020 2061 7869 733d 332c 2073 7065       axis=3, spe
+0001c490: 6373 3d73 656c 662e 7370 6563 7329 0d0a  cs=self.specs)..
+0001c4a0: 2320 2020 2020 2020 2020 7365 6c66 2e64  #         self.d
+0001c4b0: 6d78 5f6f 7574 203d 2073 656c 662e 646d  mx_out = self.dm
+0001c4c0: 7828 7365 6c66 2e69 6e70 7574 7329 0d0a  x(self.inputs)..
+0001c4d0: 0d0a 2320 2020 2020 2020 2020 7365 6c66  ..#         self
+0001c4e0: 2e74 636f 6e76 203d 204c 4654 436f 6e76  .tconv = LFTConv
+0001c4f0: 280d 0a23 2020 2020 2020 2020 2020 2020  (..#            
+0001c500: 2073 697a 653d 7365 6c66 2e73 7065 6373   size=self.specs
+0001c510: 5b27 6e5f 6c61 7465 6e74 275d 2c0d 0a23  ['n_latent'],..#
+0001c520: 2020 2020 2020 2020 2020 2020 206e 6f6e               non
+0001c530: 6c69 6e3d 7365 6c66 2e73 7065 6373 5b27  lin=self.specs['
+0001c540: 6e6f 6e6c 696e 275d 2c0d 0a23 2020 2020  nonlin'],..#    
+0001c550: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
+0001c560: 6c65 6e67 7468 3d73 656c 662e 7370 6563  length=self.spec
+0001c570: 735b 2766 696c 7465 725f 6c65 6e67 7468  s['filter_length
+0001c580: 275d 2c0d 0a23 2020 2020 2020 2020 2020  '],..#          
+0001c590: 2020 2070 6164 6469 6e67 3d73 656c 662e     padding=self.
+0001c5a0: 7370 6563 735b 2770 6164 6469 6e67 275d  specs['padding']
+0001c5b0: 2c0d 0a23 2020 2020 2020 2020 2020 2020  ,..#            
+0001c5c0: 2073 7065 6373 3d73 656c 662e 7370 6563   specs=self.spec
+0001c5d0: 730d 0a23 2020 2020 2020 2020 2029 0d0a  s..#         )..
+0001c5e0: 2320 2020 2020 2020 2020 7365 6c66 2e74  #         self.t
+0001c5f0: 636f 6e76 5f6f 7574 203d 2073 656c 662e  conv_out = self.
+0001c600: 7463 6f6e 7628 7365 6c66 2e64 6d78 5f6f  tconv(self.dmx_o
+0001c610: 7574 290d 0a0d 0a23 2020 2020 2020 2020  ut)....#        
+0001c620: 2073 656c 662e 656e 7663 6f6e 7620 3d20   self.envconv = 
+0001c630: 4c46 5443 6f6e 7628 0d0a 2320 2020 2020  LFTConv(..#     
+0001c640: 2020 2020 2020 2020 7369 7a65 3d73 656c          size=sel
+0001c650: 662e 7370 6563 735b 276e 5f6c 6174 656e  f.specs['n_laten
+0001c660: 7427 5d2c 0d0a 2320 2020 2020 2020 2020  t'],..#         
+0001c670: 2020 2020 6e6f 6e6c 696e 3d73 656c 662e      nonlin=self.
+0001c680: 7370 6563 735b 276e 6f6e 6c69 6e27 5d2c  specs['nonlin'],
+0001c690: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001c6a0: 6669 6c74 6572 5f6c 656e 6774 683d 7365  filter_length=se
+0001c6b0: 6c66 2e73 7065 6373 5b27 6669 6c74 6572  lf.specs['filter
+0001c6c0: 5f6c 656e 6774 6827 5d2c 0d0a 2320 2020  _length'],..#   
+0001c6d0: 2020 2020 2020 2020 2020 7061 6464 696e            paddin
+0001c6e0: 673d 7365 6c66 2e73 7065 6373 5b27 7061  g=self.specs['pa
+0001c6f0: 6464 696e 6727 5d2c 0d0a 2320 2020 2020  dding'],..#     
+0001c700: 2020 2020 2020 2020 7370 6563 733d 7365          specs=se
+0001c710: 6c66 2e73 7065 6373 0d0a 2320 2020 2020  lf.specs..#     
+0001c720: 2020 2020 290d 0a0d 0a23 2020 2020 2020      )....#      
+0001c730: 2020 2073 656c 662e 656e 7663 6f6e 765f     self.envconv_
+0001c740: 6f75 7420 3d20 7365 6c66 2e65 6e76 636f  out = self.envco
+0001c750: 6e76 2873 656c 662e 7463 6f6e 765f 6f75  nv(self.tconv_ou
+0001c760: 7429 0d0a 2320 2020 2020 2020 2020 7365  t)..#         se
+0001c770: 6c66 2e70 6f6f 6c20 3d20 6c61 6d62 6461  lf.pool = lambda
+0001c780: 2058 3a20 585b 3a2c 203a 2c20 3a3a 7365   X: X[:, :, ::se
+0001c790: 6c66 2e73 7065 6373 5b27 706f 6f6c 696e  lf.specs['poolin
+0001c7a0: 6727 5d2c 203a 5d0d 0a0d 0a23 2020 2020  g'], :]....#    
+0001c7b0: 2020 2020 2073 656c 662e 706f 6f6c 6564       self.pooled
+0001c7c0: 203d 2073 656c 662e 706f 6f6c 2873 656c   = self.pool(sel
+0001c7d0: 662e 656e 7663 6f6e 765f 6f75 7429 0d0a  f.envconv_out)..
+0001c7e0: 0d0a 2320 2020 2020 2020 2020 6472 6f70  ..#         drop
+0001c7f0: 6f75 7420 3d20 4472 6f70 6f75 7428 0d0a  out = Dropout(..
+0001c800: 2320 2020 2020 2020 2020 2020 2020 7365  #             se
+0001c810: 6c66 2e73 7065 6373 5b27 6472 6f70 6f75  lf.specs['dropou
+0001c820: 7427 5d2c 0d0a 2320 2020 2020 2020 2020  t'],..#         
+0001c830: 2020 2020 6e6f 6973 655f 7368 6170 653d      noise_shape=
+0001c840: 4e6f 6e65 0d0a 2320 2020 2020 2020 2020  None..#         
+0001c850: 2928 7365 6c66 2e70 6f6f 6c65 6429 0d0a  )(self.pooled)..
+0001c860: 0d0a 2320 2020 2020 2020 2020 7365 6c66  ..#         self
+0001c870: 2e66 696e 5f66 6320 3d20 4675 6c6c 7943  .fin_fc = FullyC
+0001c880: 6f6e 6e65 6374 6564 2873 697a 653d 7365  onnected(size=se
+0001c890: 6c66 2e6f 7574 5f64 696d 2c20 6e6f 6e6c  lf.out_dim, nonl
+0001c8a0: 696e 3d74 662e 6964 656e 7469 7479 2c0d  in=tf.identity,.
+0001c8b0: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
+0001c8c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001c8d0: 7065 6373 3d73 656c 662e 7370 6563 7329  pecs=self.specs)
+0001c8e0: 0d0a 0d0a 2320 2020 2020 2020 2020 795f  ....#         y_
+0001c8f0: 7072 6564 203d 2073 656c 662e 6669 6e5f  pred = self.fin_
+0001c900: 6663 2864 726f 706f 7574 290d 0a0d 0a23  fc(dropout)....#
+0001c910: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001c920: 795f 7072 6564 0d0a 0d0a 2320 2020 2020  y_pred....#     
+0001c930: 6465 6620 636f 6d70 7574 655f 7061 7474  def compute_patt
+0001c940: 6572 6e73 2873 656c 662c 2064 6174 615f  erns(self, data_
+0001c950: 7061 7468 3d4e 6f6e 652c 202a 2c20 6f75  path=None, *, ou
+0001c960: 7470 7574 3d27 7061 7474 6572 6e73 2729  tput='patterns')
+0001c970: 3a0d 0a0d 0a23 2020 2020 2020 2020 2069  :....#         i
+0001c980: 6620 6e6f 7420 6461 7461 5f70 6174 683a  f not data_path:
+0001c990: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001c9a0: 7072 696e 7428 2243 6f6d 7075 7469 6e67  print("Computing
+0001c9b0: 2070 6174 7465 726e 733a 204e 6f20 7061   patterns: No pa
+0001c9c0: 7468 2073 7065 6369 6669 6564 2c20 7573  th specified, us
+0001c9d0: 696e 6720 7661 6c69 6461 7469 6f6e 2064  ing validation d
+0001c9e0: 6174 6173 6574 2028 4465 6661 756c 7429  ataset (Default)
+0001c9f0: 2229 0d0a 2320 2020 2020 2020 2020 2020  ")..#           
+0001ca00: 2020 6473 203d 2073 656c 662e 6461 7461    ds = self.data
+0001ca10: 7365 742e 7661 6c0d 0a23 2020 2020 2020  set.val..#      
+0001ca20: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+0001ca30: 6365 2864 6174 615f 7061 7468 2c20 7374  ce(data_path, st
+0001ca40: 7229 206f 7220 6973 696e 7374 616e 6365  r) or isinstance
+0001ca50: 2864 6174 615f 7061 7468 2c20 286c 6973  (data_path, (lis
+0001ca60: 742c 2074 7570 6c65 2929 3a0d 0a23 2020  t, tuple)):..#  
+0001ca70: 2020 2020 2020 2020 2020 2064 7320 3d20             ds = 
+0001ca80: 7365 6c66 2e64 6174 6173 6574 2e5f 6275  self.dataset._bu
+0001ca90: 696c 645f 6461 7461 7365 7428 0d0a 2320  ild_dataset(..# 
+0001caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cab0: 6461 7461 5f70 6174 682c 0d0a 2320 2020  data_path,..#   
+0001cac0: 2020 2020 2020 2020 2020 2020 2020 7370                sp
+0001cad0: 6c69 743d 4661 6c73 652c 0d0a 2320 2020  lit=False,..#   
+0001cae0: 2020 2020 2020 2020 2020 2020 2020 7465                te
+0001caf0: 7374 5f62 6174 6368 3d4e 6f6e 652c 0d0a  st_batch=None,..
+0001cb00: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0001cb10: 2020 7265 7065 6174 3d54 7275 650d 0a23    repeat=True..#
+0001cb20: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+0001cb30: 2320 2020 2020 2020 2020 656c 6966 2069  #         elif i
+0001cb40: 7369 6e73 7461 6e63 6528 6461 7461 5f70  sinstance(data_p
+0001cb50: 6174 682c 2044 6174 6173 6574 293a 0d0a  ath, Dataset):..
+0001cb60: 2320 2020 2020 2020 2020 2020 2020 6966  #             if
+0001cb70: 2068 6173 6174 7472 2864 6174 615f 7061   hasattr(data_pa
+0001cb80: 7468 2c20 2774 6573 7427 293a 0d0a 2320  th, 'test'):..# 
+0001cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cba0: 6473 203d 2064 6174 615f 7061 7468 2e74  ds = data_path.t
+0001cbb0: 6573 740d 0a23 2020 2020 2020 2020 2020  est..#          
+0001cbc0: 2020 2065 6c73 653a 0d0a 2320 2020 2020     else:..#     
+0001cbd0: 2020 2020 2020 2020 2020 2020 6473 203d              ds =
+0001cbe0: 2064 6174 615f 7061 7468 2e76 616c 0d0a   data_path.val..
+0001cbf0: 2320 2020 2020 2020 2020 656c 6966 2069  #         elif i
+0001cc00: 7369 6e73 7461 6e63 6528 6461 7461 5f70  sinstance(data_p
+0001cc10: 6174 682c 2074 662e 6461 7461 2e44 6174  ath, tf.data.Dat
+0001cc20: 6173 6574 293a 0d0a 2320 2020 2020 2020  aset):..#       
+0001cc30: 2020 2020 2020 6473 203d 2064 6174 615f        ds = data_
+0001cc40: 7061 7468 0d0a 2320 2020 2020 2020 2020  path..#         
+0001cc50: 656c 7365 3a0d 0a23 2020 2020 2020 2020  else:..#        
+0001cc60: 2020 2020 2072 6169 7365 2041 7474 7269       raise Attri
+0001cc70: 6275 7465 4572 726f 7228 2753 7065 6369  buteError('Speci
+0001cc80: 6679 2064 6174 6173 6574 206f 7220 6461  fy dataset or da
+0001cc90: 7461 2070 6174 682e 2729 0d0a 0d0a 2320  ta path.')....# 
+0001cca0: 2020 2020 2020 2020 582c 2079 203d 205b          X, y = [
+0001ccb0: 726f 7720 666f 7220 726f 7720 696e 2064  row for row in d
+0001ccc0: 732e 7461 6b65 2831 295d 5b30 5d0d 0a0d  s.take(1)][0]...
+0001ccd0: 0a23 2020 2020 2020 2020 2073 656c 662e  .#         self.
+0001cce0: 6f75 745f 775f 666c 6174 203d 2073 656c  out_w_flat = sel
+0001ccf0: 662e 6669 6e5f 6663 2e77 2e6e 756d 7079  f.fin_fc.w.numpy
+0001cd00: 2829 0d0a 2320 2020 2020 2020 2020 7365  ()..#         se
+0001cd10: 6c66 2e6f 7574 5f77 6569 6768 7473 203d  lf.out_weights =
+0001cd20: 206e 702e 7265 7368 6170 6528 0d0a 2320   np.reshape(..# 
+0001cd30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001cd40: 2e6f 7574 5f77 5f66 6c61 742c 0d0a 2320  .out_w_flat,..# 
+0001cd50: 2020 2020 2020 2020 2020 2020 5b2d 312c              [-1,
+0001cd60: 2073 656c 662e 646d 782e 7369 7a65 2c20   self.dmx.size, 
+0001cd70: 7365 6c66 2e6f 7574 5f64 696d 5d0d 0a23  self.out_dim]..#
+0001cd80: 2020 2020 2020 2020 2029 0d0a 2320 2020           )..#   
+0001cd90: 2020 2020 2020 7365 6c66 2e6f 7574 5f62        self.out_b
+0001cda0: 6961 7365 7320 3d20 7365 6c66 2e66 696e  iases = self.fin
+0001cdb0: 5f66 632e 622e 6e75 6d70 7928 290d 0a23  _fc.b.numpy()..#
+0001cdc0: 2020 2020 2020 2020 2073 656c 662e 6665           self.fe
+0001cdd0: 6174 7572 655f 7265 6c65 7661 6e63 6573  ature_relevances
+0001cde0: 203d 2073 656c 662e 636f 6d70 6f6e 656e   = self.componen
+0001cdf0: 7477 6973 655f 6c6f 7373 2858 2c20 7929  twise_loss(X, y)
+0001ce00: 0d0a 2320 2020 2020 2020 2020 7365 6c66  ..#         self
+0001ce10: 2e62 7261 6e63 6877 6973 655f 6c6f 7373  .branchwise_loss
+0001ce20: 2858 2c20 7929 0d0a 0d0a 2320 2020 2020  (X, y)....#     
+0001ce30: 2020 2020 2320 636f 6d70 7574 6520 7465      # compute te
+0001ce40: 6d70 6f72 616c 2063 6f6e 766f 6c75 7469  mporal convoluti
+0001ce50: 6f6e 206c 6179 6572 206f 7574 7075 7473  on layer outputs
+0001ce60: 2066 6f72 2076 6973 5f64 6963 730d 0a23   for vis_dics..#
+0001ce70: 2020 2020 2020 2020 2074 635f 6f75 7420           tc_out 
+0001ce80: 3d20 7365 6c66 2e70 6f6f 6c28 7365 6c66  = self.pool(self
+0001ce90: 2e74 636f 6e76 2873 656c 662e 646d 7828  .tconv(self.dmx(
+0001cea0: 5829 292e 6e75 6d70 7928 2929 0d0a 0d0a  X)).numpy())....
+0001ceb0: 2320 2020 2020 2020 2020 2320 636f 6d70  #         # comp
+0001cec0: 7574 6520 6461 7461 2063 6f76 6172 6961  ute data covaria
+0001ced0: 6e63 650d 0a23 2020 2020 2020 2020 2058  nce..#         X
+0001cee0: 203d 2058 202d 2074 662e 7265 6475 6365   = X - tf.reduce
+0001cef0: 5f6d 6561 6e28 582c 2061 7869 733d 2d32  _mean(X, axis=-2
+0001cf00: 2c20 6b65 6570 6469 6d73 3d54 7275 6529  , keepdims=True)
+0001cf10: 0d0a 2320 2020 2020 2020 2020 5820 3d20  ..#         X = 
+0001cf20: 7466 2e74 7261 6e73 706f 7365 2858 2c20  tf.transpose(X, 
+0001cf30: 5b33 2c20 302c 2031 2c20 325d 290d 0a23  [3, 0, 1, 2])..#
+0001cf40: 2020 2020 2020 2020 2058 203d 2074 662e           X = tf.
+0001cf50: 7265 7368 6170 6528 582c 205b 582e 7368  reshape(X, [X.sh
+0001cf60: 6170 655b 305d 2c20 2d31 5d29 0d0a 2320  ape[0], -1])..# 
+0001cf70: 2020 2020 2020 2020 7365 6c66 2e64 636f          self.dco
+0001cf80: 7620 3d20 7466 2e6d 6174 6d75 6c28 582c  v = tf.matmul(X,
+0001cf90: 2074 662e 7472 616e 7370 6f73 6528 5829   tf.transpose(X)
+0001cfa0: 290d 0a0d 0a23 2020 2020 2020 2020 2023  )....#         #
+0001cfb0: 2067 6574 2073 7061 7469 616c 2065 7874   get spatial ext
+0001cfc0: 7261 6374 696f 6e20 6669 7465 7220 7765  raction fiter we
+0001cfd0: 6967 6874 730d 0a23 2020 2020 2020 2020  ights..#        
+0001cfe0: 2064 656d 7820 3d20 7365 6c66 2e64 6d78   demx = self.dmx
+0001cff0: 2e77 2e6e 756d 7079 2829 0d0a 0d0a 2320  .w.numpy()....# 
+0001d000: 2020 2020 2020 2020 6b65 726e 203d 206e          kern = n
+0001d010: 702e 7371 7565 657a 6528 7365 6c66 2e74  p.squeeze(self.t
+0001d020: 636f 6e76 2e66 696c 7465 7273 2e6e 756d  conv.filters.num
+0001d030: 7079 2829 292e 540d 0a0d 0a23 2020 2020  py()).T....#    
+0001d040: 2020 2020 2058 203d 2058 2e6e 756d 7079       X = X.numpy
+0001d050: 2829 2e54 0d0a 0d0a 2320 2020 2020 2020  ().T....#       
+0001d060: 2020 7061 7474 6572 6e73 203d 205b 5d0d    patterns = [].
+0001d070: 0a23 2020 2020 2020 2020 2058 5f66 696c  .#         X_fil
+0001d080: 7420 3d20 6e70 2e7a 6572 6f73 5f6c 696b  t = np.zeros_lik
+0001d090: 6528 5829 0d0a 2320 2020 2020 2020 2020  e(X)..#         
+0001d0a0: 666f 7220 695f 636f 6d70 2069 6e20 7261  for i_comp in ra
+0001d0b0: 6e67 6528 6b65 726e 2e73 6861 7065 5b30  nge(kern.shape[0
+0001d0c0: 5d29 3a0d 0a23 2020 2020 2020 2020 2020  ]):..#          
+0001d0d0: 2020 2066 6f72 2069 5f63 6820 696e 2072     for i_ch in r
+0001d0e0: 616e 6765 2858 2e73 6861 7065 5b31 5d29  ange(X.shape[1])
+0001d0f0: 3a0d 0a23 2020 2020 2020 2020 2020 2020  :..#            
+0001d100: 2020 2020 2078 203d 2058 5b3a 2c20 695f       x = X[:, i_
+0001d110: 6368 5d0d 0a23 2020 2020 2020 2020 2020  ch]..#          
+0001d120: 2020 2020 2020 2058 5f66 696c 745b 3a2c         X_filt[:,
+0001d130: 2069 5f63 685d 203d 206e 702e 636f 6e76   i_ch] = np.conv
+0001d140: 6f6c 7665 2878 2c20 6b65 726e 5b69 5f63  olve(x, kern[i_c
+0001d150: 6f6d 702c 203a 5d2c 206d 6f64 653d 2273  omp, :], mode="s
+0001d160: 616d 6522 290d 0a23 2020 2020 2020 2020  ame")..#        
+0001d170: 2020 2020 2070 6174 7465 726e 732e 6170       patterns.ap
+0001d180: 7065 6e64 286e 702e 636f 7628 585f 6669  pend(np.cov(X_fi
+0001d190: 6c74 2e54 2920 4020 6465 6d78 5b3a 2c20  lt.T) @ demx[:, 
+0001d1a0: 695f 636f 6d70 5d29 0d0a 2320 2020 2020  i_comp])..#     
+0001d1b0: 2020 2020 7365 6c66 2e70 6174 7465 726e      self.pattern
+0001d1c0: 7320 3d20 6e70 2e61 7272 6179 2870 6174  s = np.array(pat
+0001d1d0: 7465 726e 7329 2e54 0d0a 0d0a 0d0a 2320  terns).T......# 
+0001d1e0: 2020 2020 2020 2020 6966 2027 7061 7474          if 'patt
+0001d1f0: 6572 6e73 2720 696e 206f 7574 7075 743a  erns' in output:
+0001d200: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001d210: 6966 2027 6f6c 6427 2069 6e20 6f75 7470  if 'old' in outp
+0001d220: 7574 3a0d 0a23 2020 2020 2020 2020 2020  ut:..#          
+0001d230: 2020 2020 2020 2073 656c 662e 7061 7474         self.patt
+0001d240: 6572 6e73 203d 206e 702e 646f 7428 7365  erns = np.dot(se
+0001d250: 6c66 2e64 636f 762c 2064 656d 7829 0d0a  lf.dcov, demx)..
+0001d260: 2320 2020 2020 2020 2020 2020 2020 656c  #             el
+0001d270: 7365 3a0d 0a23 2020 2020 2020 2020 2020  se:..#          
+0001d280: 2020 2020 2020 2070 6174 7465 726e 7320         patterns 
+0001d290: 3d20 5b5d 0d0a 2320 2020 2020 2020 2020  = []..#         
+0001d2a0: 2020 2020 2020 2020 585f 6669 6c74 203d          X_filt =
+0001d2b0: 206e 702e 7a65 726f 735f 6c69 6b65 2858   np.zeros_like(X
+0001d2c0: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
+0001d2d0: 2020 2020 2066 6f72 2069 5f63 6f6d 7020       for i_comp 
+0001d2e0: 696e 2072 616e 6765 286b 6572 6e2e 7368  in range(kern.sh
+0001d2f0: 6170 655b 305d 293a 0d0a 2320 2020 2020  ape[0]):..#     
+0001d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d310: 666f 7220 695f 6368 2069 6e20 7261 6e67  for i_ch in rang
+0001d320: 6528 582e 7368 6170 655b 315d 293a 0d0a  e(X.shape[1]):..
+0001d330: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0001d340: 2020 2020 2020 2020 2020 7820 3d20 585b            x = X[
+0001d350: 3a2c 2069 5f63 685d 0d0a 2320 2020 2020  :, i_ch]..#     
+0001d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d370: 2020 2020 585f 6669 6c74 5b3a 2c20 695f      X_filt[:, i_
+0001d380: 6368 5d20 3d20 6e70 2e63 6f6e 766f 6c76  ch] = np.convolv
+0001d390: 6528 782c 206b 6572 6e5b 695f 636f 6d70  e(x, kern[i_comp
+0001d3a0: 2c20 3a5d 2c20 6d6f 6465 3d22 7361 6d65  , :], mode="same
+0001d3b0: 2229 0d0a 2320 2020 2020 2020 2020 2020  ")..#           
+0001d3c0: 2020 2020 2020 2020 2020 7061 7474 6572            patter
+0001d3d0: 6e73 2e61 7070 656e 6428 6e70 2e63 6f76  ns.append(np.cov
+0001d3e0: 2858 5f66 696c 742e 5429 2040 2064 656d  (X_filt.T) @ dem
+0001d3f0: 785b 3a2c 2069 5f63 6f6d 705d 290d 0a23  x[:, i_comp])..#
+0001d400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d410: 2073 656c 662e 7061 7474 6572 6e73 203d   self.patterns =
+0001d420: 206e 702e 6172 7261 7928 7061 7474 6572   np.array(patter
+0001d430: 6e73 292e 540d 0a23 2020 2020 2020 2020  ns).T..#        
+0001d440: 2065 6c73 653a 0d0a 2320 2020 2020 2020   else:..#       
+0001d450: 2020 2020 2020 7365 6c66 2e70 6174 7465        self.patte
+0001d460: 726e 7320 3d20 6465 6d78 0d0a 0d0a 2320  rns = demx....# 
+0001d470: 2020 2020 2020 2020 7365 6c66 2e6c 6174          self.lat
+0001d480: 5f74 6373 203d 206e 702e 646f 7428 6465  _tcs = np.dot(de
+0001d490: 6d78 2e54 2c20 582e 5429 0d0a 0d0a 2320  mx.T, X.T)....# 
+0001d4a0: 2020 2020 2020 2020 6465 6c20 580d 0a0d          del X...
+0001d4b0: 0a23 2020 2020 2020 2020 2023 2020 5465  .#         #  Te
+0001d4c0: 6d70 6f72 616c 2063 6f6e 7620 7374 7566  mporal conv stuf
+0001d4d0: 660d 0a23 2020 2020 2020 2020 2073 656c  f..#         sel
+0001d4e0: 662e 6669 6c74 6572 7320 3d20 6b65 726e  f.filters = kern
+0001d4f0: 2e54 0d0a 2320 2020 2020 2020 2020 7365  .T..#         se
+0001d500: 6c66 2e74 635f 6f75 7420 3d20 6e70 2e73  lf.tc_out = np.s
+0001d510: 7175 6565 7a65 2874 635f 6f75 7429 0d0a  queeze(tc_out)..
+0001d520: 2320 2020 2020 2020 2020 7365 6c66 2e63  #         self.c
+0001d530: 6f72 725f 746f 5f6f 7574 7075 7420 3d20  orr_to_output = 
+0001d540: 7365 6c66 2e67 6574 5f6f 7574 7075 745f  self.get_output_
+0001d550: 636f 7272 656c 6174 696f 6e73 2879 290d  correlations(y).
+0001d560: 0a0d 0a23 2020 2020 2064 6566 2070 6c6f  ...#     def plo
+0001d570: 745f 7061 7474 6572 6e73 280d 0a23 2020  t_patterns(..#  
+0001d580: 2020 2020 2020 2073 656c 662c 2073 656e         self, sen
+0001d590: 736f 725f 6c61 796f 7574 3d4e 6f6e 652c  sor_layout=None,
+0001d5a0: 2073 6f72 7469 6e67 3d27 6c32 272c 2070   sorting='l2', p
+0001d5b0: 6572 6365 6e74 696c 653d 3930 2c0d 0a23  ercentile=90,..#
+0001d5c0: 2020 2020 2020 2020 2073 6361 6c65 3d46           scale=F
+0001d5d0: 616c 7365 2c20 636c 6173 735f 6e61 6d65  alse, class_name
+0001d5e0: 733d 4e6f 6e65 2c20 696e 666f 3d4e 6f6e  s=None, info=Non
+0001d5f0: 650d 0a23 2020 2020 2029 3a0d 0a23 2020  e..#     ):..#  
+0001d600: 2020 2020 2020 206f 7264 6572 2c20 7473         order, ts
+0001d610: 203d 2073 656c 662e 5f73 6f72 7469 6e67   = self._sorting
+0001d620: 2873 6f72 7469 6e67 290d 0a23 2020 2020  (sorting)..#    
+0001d630: 2020 2020 2073 656c 662e 756f 7264 6572       self.uorder
+0001d640: 203d 206f 7264 6572 2e72 6176 656c 2829   = order.ravel()
+0001d650: 0d0a 2320 2020 2020 2020 2020 6c5f 7520  ..#         l_u 
+0001d660: 3d20 6c65 6e28 7365 6c66 2e75 6f72 6465  = len(self.uorde
+0001d670: 7229 0d0a 2320 2020 2020 2020 2020 6966  r)..#         if
+0001d680: 2069 6e66 6f3a 0d0a 2320 2020 2020 2020   info:..#       
+0001d690: 2020 2020 2020 696e 666f 2e5f 5f73 6574        info.__set
+0001d6a0: 7374 6174 655f 5f28 6469 6374 285f 756e  state__(dict(_un
+0001d6b0: 6c6f 636b 6564 3d54 7275 6529 290d 0a23  locked=True))..#
+0001d6c0: 2020 2020 2020 2020 2020 2020 2069 6e66               inf
+0001d6d0: 6f5b 2773 6672 6571 275d 203d 2031 2e0d  o['sfreq'] = 1..
+0001d6e0: 0a23 2020 2020 2020 2020 2020 2020 2073  .#             s
+0001d6f0: 656c 662e 6661 6b65 5f65 766f 6b65 6420  elf.fake_evoked 
+0001d700: 3d20 6576 6f6b 6564 2e45 766f 6b65 6441  = evoked.EvokedA
+0001d710: 7272 6179 2873 656c 662e 7061 7474 6572  rray(self.patter
+0001d720: 6e73 2c20 696e 666f 2c20 746d 696e 3d30  ns, info, tmin=0
+0001d730: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
+0001d740: 2069 6620 6c5f 7520 3e20 313a 0d0a 2320   if l_u > 1:..# 
+0001d750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d760: 7365 6c66 2e66 616b 655f 6576 6f6b 6564  self.fake_evoked
+0001d770: 2e64 6174 615b 3a2c 203a 6c5f 755d 203d  .data[:, :l_u] =
+0001d780: 2073 656c 662e 6661 6b65 5f65 766f 6b65   self.fake_evoke
+0001d790: 642e 6461 7461 5b3a 2c20 7365 6c66 2e75  d.data[:, self.u
+0001d7a0: 6f72 6465 725d 0d0a 2320 2020 2020 2020  order]..#       
+0001d7b0: 2020 2020 2020 656c 6966 206c 5f75 203d        elif l_u =
+0001d7c0: 3d20 313a 0d0a 2320 2020 2020 2020 2020  = 1:..#         
+0001d7d0: 2020 2020 2020 2020 7365 6c66 2e66 616b          self.fak
+0001d7e0: 655f 6576 6f6b 6564 2e64 6174 615b 3a2c  e_evoked.data[:,
+0001d7f0: 206c 5f75 5d20 3d20 7365 6c66 2e66 616b   l_u] = self.fak
+0001d800: 655f 6576 6f6b 6564 2e64 6174 615b 3a2c  e_evoked.data[:,
+0001d810: 2073 656c 662e 756f 7264 6572 5b30 5d5d   self.uorder[0]]
+0001d820: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001d830: 7365 6c66 2e66 616b 655f 6576 6f6b 6564  self.fake_evoked
+0001d840: 2e63 726f 7028 746d 6178 3d66 6c6f 6174  .crop(tmax=float
+0001d850: 286c 5f75 2929 0d0a 2320 2020 2020 2020  (l_u))..#       
+0001d860: 2020 2020 2020 6966 2073 6361 6c65 3a0d        if scale:.
+0001d870: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
+0001d880: 2020 205f 7374 6420 3d20 7365 6c66 2e66     _std = self.f
+0001d890: 616b 655f 6576 6f6b 6564 2e64 6174 615b  ake_evoked.data[
+0001d8a0: 3a2c 203a 6c5f 755d 2e73 7464 2830 290d  :, :l_u].std(0).
+0001d8b0: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
+0001d8c0: 2020 2073 656c 662e 6661 6b65 5f65 766f     self.fake_evo
+0001d8d0: 6b65 642e 6461 7461 5b3a 2c20 3a6c 5f75  ked.data[:, :l_u
+0001d8e0: 5d20 2f3d 205f 7374 640d 0a23 2020 2020  ] /= _std..#    
+0001d8f0: 2020 2020 2065 6c69 6620 7365 6e73 6f72       elif sensor
+0001d900: 5f6c 6179 6f75 743a 0d0a 2320 2020 2020  _layout:..#     
+0001d910: 2020 2020 2020 2020 6c6f 203d 2063 6861          lo = cha
+0001d920: 6e6e 656c 732e 7265 6164 5f6c 6179 6f75  nnels.read_layou
+0001d930: 7428 7365 6e73 6f72 5f6c 6179 6f75 7429  t(sensor_layout)
+0001d940: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001d950: 696e 666f 203d 2063 7265 6174 655f 696e  info = create_in
+0001d960: 666f 286c 6f2e 6e61 6d65 732c 2031 2e2c  fo(lo.names, 1.,
+0001d970: 2073 656e 736f 725f 6c61 796f 7574 2e73   sensor_layout.s
+0001d980: 706c 6974 2827 2d27 295b 2d31 5d29 0d0a  plit('-')[-1])..
+0001d990: 2320 2020 2020 2020 2020 2020 2020 6f72  #             or
+0001d9a0: 6967 5f78 7920 3d20 6e70 2e6d 6561 6e28  ig_xy = np.mean(
+0001d9b0: 6c6f 2e70 6f73 5b3a 2c20 3a32 5d2c 2030  lo.pos[:, :2], 0
+0001d9c0: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
+0001d9d0: 2066 6f72 2069 2c20 6368 2069 6e20 656e   for i, ch in en
+0001d9e0: 756d 6572 6174 6528 6c6f 2e6e 616d 6573  umerate(lo.names
+0001d9f0: 293a 0d0a 2320 2020 2020 2020 2020 2020  ):..#           
+0001da00: 2020 2020 2020 6966 2069 6e66 6f5b 2763        if info['c
+0001da10: 6873 275d 5b69 5d5b 2763 685f 6e61 6d65  hs'][i]['ch_name
+0001da20: 275d 203d 3d20 6368 3a0d 0a23 2020 2020  '] == ch:..#    
+0001da30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da40: 2069 6e66 6f5b 2763 6873 275d 5b69 5d5b   info['chs'][i][
+0001da50: 276c 6f63 275d 5b3a 325d 203d 2028 6c6f  'loc'][:2] = (lo
+0001da60: 2e70 6f73 5b69 2c20 3a32 5d20 2d20 6f72  .pos[i, :2] - or
+0001da70: 6967 5f78 7929 2f33 2e0d 0a23 2020 2020  ig_xy)/3...#    
+0001da80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da90: 2023 696e 666f 5b27 6368 7327 5d5b 695d   #info['chs'][i]
+0001daa0: 5b27 6c6f 6327 5d5b 343a 5d20 3d20 300d  ['loc'][4:] = 0.
+0001dab0: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
+0001dac0: 2020 2065 6c73 653a 0d0a 2320 2020 2020     else:..#     
+0001dad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dae0: 7072 696e 7428 2243 6861 6e6e 656c 206e  print("Channel n
+0001daf0: 616d 6520 6d69 736d 6174 6368 2e20 696e  ame mismatch. in
+0001db00: 666f 3a20 7b7d 2076 7320 6c6f 3a20 7b7d  fo: {} vs lo: {}
+0001db10: 222e 666f 726d 6174 280d 0a23 2020 2020  ".format(..#    
+0001db20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db30: 2020 2020 2069 6e66 6f5b 2763 6873 275d       info['chs']
+0001db40: 5b69 5d5b 2763 685f 6e61 6d65 275d 2c20  [i]['ch_name'], 
+0001db50: 6368 2929 0d0a 0d0a 2320 2020 2020 2020  ch))....#       
+0001db60: 2020 2020 2020 7365 6c66 2e66 616b 655f        self.fake_
+0001db70: 6576 6f6b 6564 203d 2065 766f 6b65 642e  evoked = evoked.
+0001db80: 4576 6f6b 6564 4172 7261 7928 7365 6c66  EvokedArray(self
+0001db90: 2e70 6174 7465 726e 732c 2069 6e66 6f29  .patterns, info)
+0001dba0: 0d0a 0d0a 2320 2020 2020 2020 2020 2020  ....#           
+0001dbb0: 2020 6966 206c 5f75 203e 2031 3a0d 0a23    if l_u > 1:..#
+0001dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dbd0: 2073 656c 662e 6661 6b65 5f65 766f 6b65   self.fake_evoke
+0001dbe0: 642e 6461 7461 5b3a 2c20 3a6c 5f75 5d20  d.data[:, :l_u] 
+0001dbf0: 3d20 7365 6c66 2e66 616b 655f 6576 6f6b  = self.fake_evok
+0001dc00: 6564 2e64 6174 615b 3a2c 2073 656c 662e  ed.data[:, self.
+0001dc10: 756f 7264 6572 5d0d 0a23 2020 2020 2020  uorder]..#      
+0001dc20: 2020 2020 2020 2065 6c69 6620 6c5f 7520         elif l_u 
+0001dc30: 3d3d 2031 3a0d 0a23 2020 2020 2020 2020  == 1:..#        
+0001dc40: 2020 2020 2020 2020 2073 656c 662e 6661           self.fa
+0001dc50: 6b65 5f65 766f 6b65 642e 6461 7461 5b3a  ke_evoked.data[:
+0001dc60: 2c20 6c5f 755d 203d 2073 656c 662e 6661  , l_u] = self.fa
+0001dc70: 6b65 5f65 766f 6b65 642e 6461 7461 5b3a  ke_evoked.data[:
+0001dc80: 2c20 7365 6c66 2e75 6f72 6465 725b 305d  , self.uorder[0]
+0001dc90: 5d0d 0a23 2020 2020 2020 2020 2020 2020  ]..#            
+0001dca0: 2073 656c 662e 6661 6b65 5f65 766f 6b65   self.fake_evoke
+0001dcb0: 642e 6372 6f70 2874 6d61 783d 666c 6f61  d.crop(tmax=floa
+0001dcc0: 7428 6c5f 7529 290d 0a23 2020 2020 2020  t(l_u))..#      
+0001dcd0: 2020 2020 2020 2069 6620 7363 616c 653a         if scale:
+0001dce0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001dcf0: 2020 2020 5f73 7464 203d 2073 656c 662e      _std = self.
+0001dd00: 6661 6b65 5f65 766f 6b65 642e 6461 7461  fake_evoked.data
+0001dd10: 5b3a 2c20 3a6c 5f75 5d2e 7374 6428 3029  [:, :l_u].std(0)
+0001dd20: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001dd30: 2020 2020 7365 6c66 2e66 616b 655f 6576      self.fake_ev
+0001dd40: 6f6b 6564 2e64 6174 615b 3a2c 203a 6c5f  oked.data[:, :l_
+0001dd50: 755d 202f 3d20 5f73 7464 0d0a 2320 2020  u] /= _std..#   
+0001dd60: 2020 2020 2020 656c 7365 3a0d 0a23 2020        else:..#  
+0001dd70: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001dd80: 2056 616c 7565 4572 726f 7228 2253 7065   ValueError("Spe
+0001dd90: 6369 6679 2073 656e 736f 7220 6c61 796f  cify sensor layo
+0001dda0: 7574 2229 0d0a 0d0a 0d0a 2320 2020 2020  ut")......#     
+0001ddb0: 2020 2020 6966 206e 702e 616e 7928 7365      if np.any(se
+0001ddc0: 6c66 2e75 6f72 6465 7229 3a0d 0a23 2020  lf.uorder):..#  
+0001ddd0: 2020 2020 2020 2020 2020 206e 6669 6c74             nfilt
+0001dde0: 203d 206d 6178 2873 656c 662e 6f75 745f   = max(self.out_
+0001ddf0: 6469 6d2c 2038 290d 0a23 2020 2020 2020  dim, 8)..#      
+0001de00: 2020 2020 2020 206e 726f 7773 203d 206d         nrows = m
+0001de10: 6178 2831 2c20 6c5f 752f 2f6e 6669 6c74  ax(1, l_u//nfilt
+0001de20: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
+0001de30: 206e 636f 6c73 203d 206d 696e 286e 6669   ncols = min(nfi
+0001de40: 6c74 2c20 6c5f 7529 0d0a 2320 2020 2020  lt, l_u)..#     
+0001de50: 2020 2020 2020 2020 662c 2061 7820 3d20          f, ax = 
+0001de60: 706c 742e 7375 6270 6c6f 7473 286e 726f  plt.subplots(nro
+0001de70: 7773 2c20 6e63 6f6c 732c 2073 6861 7265  ws, ncols, share
+0001de80: 793d 5472 7565 290d 0a23 2020 2020 2020  y=True)..#      
+0001de90: 2020 2020 2020 2070 6c74 2e74 6967 6874         plt.tight
+0001dea0: 5f6c 6179 6f75 7428 290d 0a23 2020 2020  _layout()..#    
+0001deb0: 2020 2020 2020 2020 2066 2e73 6574 5f73           f.set_s
+0001dec0: 697a 655f 696e 6368 6573 285b 3136 2c20  ize_inches([16, 
+0001ded0: 335d 290d 0a23 2020 2020 2020 2020 2020  3])..#          
+0001dee0: 2020 2061 7820 3d20 6e70 2e61 746c 6561     ax = np.atlea
+0001def0: 7374 5f32 6428 6178 290d 0a0d 0a23 2020  st_2d(ax)....#  
+0001df00: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+0001df10: 6920 696e 2072 616e 6765 286e 726f 7773  i in range(nrows
+0001df20: 293a 0d0a 2320 2020 2020 2020 2020 2020  ):..#           
+0001df30: 2020 2020 2020 6661 6b65 5f74 696d 6573        fake_times
+0001df40: 203d 206e 702e 6172 616e 6765 2869 6920   = np.arange(ii 
+0001df50: 2a20 6e63 6f6c 732c 2020 2869 6920 2b20  * ncols,  (ii + 
+0001df60: 3129 202a 206e 636f 6c73 2c20 312e 290d  1) * ncols, 1.).
+0001df70: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
+0001df80: 2020 2076 6d61 7820 3d20 6e70 2e70 6572     vmax = np.per
+0001df90: 6365 6e74 696c 6528 7365 6c66 2e66 616b  centile(self.fak
+0001dfa0: 655f 6576 6f6b 6564 2e64 6174 615b 3a2c  e_evoked.data[:,
+0001dfb0: 203a 6c5f 755d 2c20 3935 290d 0a23 2020   :l_u], 95)..#  
+0001dfc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001dfd0: 656c 662e 6661 6b65 5f65 766f 6b65 642e  elf.fake_evoked.
+0001dfe0: 706c 6f74 5f74 6f70 6f6d 6170 280d 0a23  plot_topomap(..#
+0001dff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e000: 2020 2020 2074 696d 6573 3d66 616b 655f       times=fake_
+0001e010: 7469 6d65 732c 0d0a 2320 2020 2020 2020  times,..#       
+0001e020: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+0001e030: 6573 3d61 785b 6969 5d2c 0d0a 2320 2020  es=ax[ii],..#   
+0001e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e050: 2020 636f 6c6f 7262 6172 3d46 616c 7365    colorbar=False
+0001e060: 2c0d 0a23 2020 2020 2020 2020 2020 2020  ,..#            
+0001e070: 2020 2020 2020 2020 2076 6d61 783d 766d           vmax=vm
+0001e080: 6178 2c0d 0a23 2020 2020 2020 2020 2020  ax,..#          
+0001e090: 2020 2020 2020 2020 2020 2073 6361 6c69             scali
+0001e0a0: 6e67 733d 312c 0d0a 2320 2020 2020 2020  ngs=1,..#       
+0001e0b0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+0001e0c0: 6d65 5f66 6f72 6d61 743d 2242 7261 6e63  me_format="Branc
+0001e0d0: 6820 2325 6722 2c0d 0a23 2020 2020 2020  h #%g",..#      
+0001e0e0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001e0f0: 6974 6c65 3d27 5061 7474 6572 6e73 2028  itle='Patterns (
+0001e100: 272b 7374 7228 736f 7274 696e 6729 2b27  '+str(sorting)+'
+0001e110: 2927 2c0d 0a23 2020 2020 2020 2020 2020  )',..#          
+0001e120: 2020 2020 2020 2020 2020 206f 7574 6c69             outli
+0001e130: 6e65 733d 2768 6561 6427 2c0d 0a23 2020  nes='head',..#  
+0001e140: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0001e150: 0d0a 0d0a 2320 2020 2020 6465 6620 6272  ....#     def br
+0001e160: 616e 6368 7769 7365 5f6c 6f73 7328 7365  anchwise_loss(se
+0001e170: 6c66 2c20 582c 2079 293a 0d0a 2320 2020  lf, X, y):..#   
+0001e180: 2020 2020 2020 6d6f 6465 6c5f 7765 6967        model_weig
+0001e190: 6874 735f 6f72 6967 696e 616c 203d 2073  hts_original = s
+0001e1a0: 656c 662e 6b6d 2e67 6574 5f77 6569 6768  elf.km.get_weigh
+0001e1b0: 7473 2829 2e63 6f70 7928 290d 0a23 2020  ts().copy()..#  
+0001e1c0: 2020 2020 2020 2062 6173 655f 6c6f 7373         base_loss
+0001e1d0: 2c20 5f20 3d20 7365 6c66 2e6b 6d2e 6576  , _ = self.km.ev
+0001e1e0: 616c 7561 7465 2858 2c20 792c 2076 6572  aluate(X, y, ver
+0001e1f0: 626f 7365 3d30 290d 0a0d 0a23 2020 2020  bose=0)....#    
+0001e200: 2020 2020 206c 6f73 7365 7320 3d20 5b5d       losses = []
+0001e210: 0d0a 2320 2020 2020 2020 2020 666f 7220  ..#         for 
+0001e220: 6920 696e 2072 616e 6765 2873 656c 662e  i in range(self.
+0001e230: 7370 6563 735b 226e 5f6c 6174 656e 7422  specs["n_latent"
+0001e240: 5d29 3a0d 0a23 2020 2020 2020 2020 2020  ]):..#          
+0001e250: 2020 206d 6f64 656c 5f77 6569 6768 7473     model_weights
+0001e260: 203d 206d 6f64 656c 5f77 6569 6768 7473   = model_weights
+0001e270: 5f6f 7269 6769 6e61 6c2e 636f 7079 2829  _original.copy()
+0001e280: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001e290: 7370 6174 6961 6c5f 7765 6967 6874 7320  spatial_weights 
+0001e2a0: 3d20 6d6f 6465 6c5f 7765 6967 6874 735b  = model_weights[
+0001e2b0: 305d 2e63 6f70 7928 290d 0a23 2020 2020  0].copy()..#    
+0001e2c0: 2020 2020 2020 2020 2073 7061 7469 616c           spatial
+0001e2d0: 5f62 6961 7365 7320 3d20 6d6f 6465 6c5f  _biases = model_
+0001e2e0: 7765 6967 6874 735b 315d 2e63 6f70 7928  weights[1].copy(
+0001e2f0: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
+0001e300: 2074 656d 706f 7261 6c5f 6269 6173 6573   temporal_biases
+0001e310: 203d 206d 6f64 656c 5f77 6569 6768 7473   = model_weights
+0001e320: 5b33 5d2e 636f 7079 2829 0d0a 2320 2020  [3].copy()..#   
+0001e330: 2020 2020 2020 2020 2020 656e 765f 6269            env_bi
+0001e340: 6173 6573 203d 206d 6f64 656c 5f77 6569  ases = model_wei
+0001e350: 6768 7473 5b35 5d2e 636f 7079 2829 0d0a  ghts[5].copy()..
+0001e360: 2320 2020 2020 2020 2020 2020 2020 7370  #             sp
+0001e370: 6174 6961 6c5f 7765 6967 6874 735b 3a2c  atial_weights[:,
+0001e380: 2069 5d20 3d20 300d 0a23 2020 2020 2020   i] = 0..#      
+0001e390: 2020 2020 2020 2073 7061 7469 616c 5f62         spatial_b
+0001e3a0: 6961 7365 735b 695d 203d 2030 0d0a 2320  iases[i] = 0..# 
+0001e3b0: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
+0001e3c0: 6f72 616c 5f62 6961 7365 735b 695d 203d  oral_biases[i] =
+0001e3d0: 2030 0d0a 2320 2020 2020 2020 2020 2020   0..#           
+0001e3e0: 2020 656e 765f 6269 6173 6573 5b69 5d20    env_biases[i] 
+0001e3f0: 3d20 300d 0a23 2020 2020 2020 2020 2020  = 0..#          
+0001e400: 2020 206d 6f64 656c 5f77 6569 6768 7473     model_weights
+0001e410: 5b30 5d20 3d20 7370 6174 6961 6c5f 7765  [0] = spatial_we
+0001e420: 6967 6874 730d 0a23 2020 2020 2020 2020  ights..#        
+0001e430: 2020 2020 206d 6f64 656c 5f77 6569 6768       model_weigh
+0001e440: 7473 5b31 5d20 3d20 7370 6174 6961 6c5f  ts[1] = spatial_
+0001e450: 6269 6173 6573 0d0a 2320 2020 2020 2020  biases..#       
+0001e460: 2020 2020 2020 6d6f 6465 6c5f 7765 6967        model_weig
+0001e470: 6874 735b 335d 203d 2074 656d 706f 7261  hts[3] = tempora
+0001e480: 6c5f 6269 6173 6573 0d0a 2320 2020 2020  l_biases..#     
+0001e490: 2020 2020 2020 2020 6d6f 6465 6c5f 7765          model_we
+0001e4a0: 6967 6874 735b 355d 203d 2065 6e76 5f62  ights[5] = env_b
+0001e4b0: 6961 7365 730d 0a23 2020 2020 2020 2020  iases..#        
+0001e4c0: 2020 2020 2073 656c 662e 6b6d 2e73 6574       self.km.set
+0001e4d0: 5f77 6569 6768 7473 286d 6f64 656c 5f77  _weights(model_w
+0001e4e0: 6569 6768 7473 290d 0a23 2020 2020 2020  eights)..#      
+0001e4f0: 2020 2020 2020 206c 6f73 7365 732e 6170         losses.ap
+0001e500: 7065 6e64 2873 656c 662e 6b6d 2e65 7661  pend(self.km.eva
+0001e510: 6c75 6174 6528 582c 2079 2c20 7665 7262  luate(X, y, verb
+0001e520: 6f73 653d 3029 5b30 5d29 0d0a 2320 2020  ose=0)[0])..#   
+0001e530: 2020 2020 2020 7365 6c66 2e6b 6d2e 7365        self.km.se
+0001e540: 745f 7765 6967 6874 7328 6d6f 6465 6c5f  t_weights(model_
+0001e550: 7765 6967 6874 735f 6f72 6967 696e 616c  weights_original
+0001e560: 290d 0a23 2020 2020 2020 2020 2073 656c  )..#         sel
+0001e570: 662e 6272 616e 6368 5f72 656c 6576 616e  f.branch_relevan
+0001e580: 6365 5f6c 6f73 7320 3d20 6261 7365 5f6c  ce_loss = base_l
+0001e590: 6f73 7320 2d20 6e70 2e61 7272 6179 286c  oss - np.array(l
+0001e5a0: 6f73 7365 7329 0d0a 0d0a 2320 2020 2020  osses)....#     
+0001e5b0: 6465 6620 706c 6f74 5f62 7261 6e63 6828  def plot_branch(
+0001e5c0: 0d0a 2320 2020 2020 2020 2020 7365 6c66  ..#         self
+0001e5d0: 2c0d 0a23 2020 2020 2020 2020 2062 7261  ,..#         bra
+0001e5e0: 6e63 685f 6e75 6d3a 2069 6e74 2c0d 0a23  nch_num: int,..#
+0001e5f0: 2020 2020 2020 2020 2069 6e66 6f3a 2049           info: I
+0001e600: 6e66 6f2c 0d0a 2320 2020 2020 2020 2020  nfo,..#         
+0001e610: 7061 7261 6d73 3a20 4f70 7469 6f6e 616c  params: Optional
+0001e620: 5b6c 6973 745b 7374 725d 5d20 3d20 5b27  [list[str]] = ['
+0001e630: 696e 7075 7427 2c20 276f 7574 7075 7427  input', 'output'
+0001e640: 2c20 2772 6573 706f 6e73 6527 5d0d 0a23  , 'response']..#
+0001e650: 2020 2020 2029 3a0d 0a23 2020 2020 2020       ):..#      
+0001e660: 2020 2069 6e66 6f2e 5f5f 7365 7473 7461     info.__setsta
+0001e670: 7465 5f5f 2864 6963 7428 5f75 6e6c 6f63  te__(dict(_unloc
+0001e680: 6b65 643d 5472 7565 2929 0d0a 2320 2020  ked=True))..#   
+0001e690: 2020 2020 2020 696e 666f 5b27 7366 7265        info['sfre
+0001e6a0: 7127 5d20 3d20 312e 0d0a 2320 2020 2020  q'] = 1...#     
+0001e6b0: 2020 2020 736f 7274 696e 6720 3d20 6e70      sorting = np
+0001e6c0: 2e61 7267 736f 7274 2873 656c 662e 6272  .argsort(self.br
+0001e6d0: 616e 6368 5f72 656c 6576 616e 6365 5f6c  anch_relevance_l
+0001e6e0: 6f73 7329 5b3a 3a2d 315d 0d0a 2320 2020  oss)[::-1]..#   
+0001e6f0: 2020 2020 2020 6461 7461 203d 2073 656c        data = sel
+0001e700: 662e 7061 7474 6572 6e73 5b3a 2c20 736f  f.patterns[:, so
+0001e710: 7274 696e 675d 0d0a 2320 2020 2020 2020  rting]..#       
+0001e720: 2020 6669 6c74 6572 7320 3d20 7365 6c66    filters = self
+0001e730: 2e66 696c 7465 7273 5b3a 2c20 736f 7274  .filters[:, sort
+0001e740: 696e 675d 0d0a 2320 2020 2020 2020 2020  ing]..#         
+0001e750: 7265 6c65 7661 6e63 6573 203d 2073 656c  relevances = sel
+0001e760: 662e 6272 616e 6368 5f72 656c 6576 616e  f.branch_relevan
+0001e770: 6365 5f6c 6f73 7320 2d20 7365 6c66 2e62  ce_loss - self.b
+0001e780: 7261 6e63 685f 7265 6c65 7661 6e63 655f  ranch_relevance_
+0001e790: 6c6f 7373 2e6d 696e 2829 0d0a 2320 2020  loss.min()..#   
+0001e7a0: 2020 2020 2020 7265 6c65 7661 6e63 6520        relevance 
+0001e7b0: 3d20 736f 7274 6564 285b 6e70 2e72 6f75  = sorted([np.rou
+0001e7c0: 6e64 2872 656c 2f72 656c 6576 616e 6365  nd(rel/relevance
+0001e7d0: 732e 7375 6d28 292c 2032 2920 666f 7220  s.sum(), 2) for 
+0001e7e0: 7265 6c20 696e 2072 656c 6576 616e 6365  rel in relevance
+0001e7f0: 735d 2c20 7265 7665 7273 653d 5472 7565  s], reverse=True
+0001e800: 295b 6272 616e 6368 5f6e 756d 5d0d 0a23  )[branch_num]..#
+0001e810: 2020 2020 2020 2020 2073 656c 662e 6661           self.fa
+0001e820: 6b65 5f65 766f 6b65 6420 3d20 6576 6f6b  ke_evoked = evok
+0001e830: 6564 2e45 766f 6b65 6441 7272 6179 2864  ed.EvokedArray(d
+0001e840: 6174 612c 2069 6e66 6f2c 2074 6d69 6e3d  ata, info, tmin=
+0001e850: 3029 0d0a 2320 2020 2020 2020 2020 6669  0)..#         fi
+0001e860: 672c 2028 6178 312c 2061 7832 2920 3d20  g, (ax1, ax2) = 
+0001e870: 706c 742e 7375 6270 6c6f 7473 286e 636f  plt.subplots(nco
+0001e880: 6c73 3d32 2c20 6e72 6f77 733d 3129 0d0a  ls=2, nrows=1)..
+0001e890: 2320 2020 2020 2020 2020 6669 672e 7469  #         fig.ti
+0001e8a0: 6768 745f 6c61 796f 7574 2829 0d0a 0d0a  ght_layout()....
+0001e8b0: 2320 2020 2020 2020 2020 7365 6c66 2e66  #         self.f
+0001e8c0: 7320 3d20 7365 6c66 2e64 6174 6173 6574  s = self.dataset
+0001e8d0: 2e68 5f70 6172 616d 735b 2766 7327 5d0d  .h_params['fs'].
+0001e8e0: 0a0d 0a23 2020 2020 2020 2020 206f 7574  ...#         out
+0001e8f0: 5f66 696c 7465 7220 3d20 6669 6c74 6572  _filter = filter
+0001e900: 735b 3a2c 2062 7261 6e63 685f 6e75 6d5d  s[:, branch_num]
+0001e910: 0d0a 2320 2020 2020 2020 2020 5f2c 2070  ..#         _, p
+0001e920: 7364 203d 2077 656c 6368 2873 656c 662e  sd = welch(self.
+0001e930: 6c61 745f 7463 735b 6272 616e 6368 5f6e  lat_tcs[branch_n
+0001e940: 756d 5d2c 2066 733d 7365 6c66 2e66 732c  um], fs=self.fs,
+0001e950: 206e 7065 7273 6567 3d73 656c 662e 6673   nperseg=self.fs
+0001e960: 202a 2032 290d 0a23 2020 2020 2020 2020   * 2)..#        
+0001e970: 2077 2c20 6820 3d20 286c 616d 6264 6120   w, h = (lambda 
+0001e980: 772c 2068 3a20 2877 2c20 6829 2928 2a66  w, h: (w, h))(*f
+0001e990: 7265 717a 286f 7574 5f66 696c 7465 722c  reqz(out_filter,
+0001e9a0: 2031 2c20 776f 724e 3d73 656c 662e 6673   1, worN=self.fs
+0001e9b0: 2929 0d0a 2320 2020 2020 2020 2020 6672  ))..#         fr
+0001e9c0: 616e 6765 203d 2077 202f 206e 702e 7069  ange = w / np.pi
+0001e9d0: 202a 2073 656c 662e 6673 202f 2032 0d0a   * self.fs / 2..
+0001e9e0: 2320 2020 2020 2020 2020 7a20 3d20 6c61  #         z = la
+0001e9f0: 6d62 6461 2078 3a20 2878 202d 2078 2e6d  mbda x: (x - x.m
+0001ea00: 6561 6e28 2929 2f78 2e73 7464 2829 0d0a  ean())/x.std()..
+0001ea10: 0d0a 2320 2020 2020 2020 2020 666f 7220  ..#         for 
+0001ea20: 7061 7261 6d20 696e 2070 6172 616d 733a  param in params:
+0001ea30: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001ea40: 6966 2070 6172 616d 203d 3d20 2769 6e70  if param == 'inp
+0001ea50: 7574 273a 0d0a 2320 2020 2020 2020 2020  ut':..#         
+0001ea60: 2020 2020 2020 2020 6669 6e70 7574 203d          finput =
+0001ea70: 2070 7364 5b3a 2d31 5d0d 0a23 2020 2020   psd[:-1]..#    
+0001ea80: 2020 2020 2020 2020 2020 2020 2066 696e               fin
+0001ea90: 7075 7420 3d20 7a28 6669 6e70 7574 290d  put = z(finput).
+0001eaa0: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
+0001eab0: 2020 2061 7832 2e70 6c6f 7428 6672 616e     ax2.plot(fran
+0001eac0: 6765 2c20 6669 6e70 7574 202d 2066 696e  ge, finput - fin
+0001ead0: 7075 742e 6d69 6e28 292c 2063 6f6c 6f72  put.min(), color
+0001eae0: 3d27 7461 623a 626c 7565 2729 0d0a 2320  ='tab:blue')..# 
+0001eaf0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0001eb00: 2070 6172 616d 203d 3d20 276f 7574 7075   param == 'outpu
+0001eb10: 7427 3a0d 0a23 2020 2020 2020 2020 2020  t':..#          
+0001eb20: 2020 2020 2020 2066 6f75 7470 7574 203d         foutput =
+0001eb30: 206e 702e 7265 616c 2866 696e 7075 7420   np.real(finput 
+0001eb40: 2a20 6820 2a20 6e70 2e63 6f6e 6a28 6829  * h * np.conj(h)
+0001eb50: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
+0001eb60: 2020 2020 2066 6f75 7470 7574 203d 207a       foutput = z
+0001eb70: 2866 6f75 7470 7574 290d 0a23 2020 2020  (foutput)..#    
+0001eb80: 2020 2020 2020 2020 2020 2020 2061 7832               ax2
+0001eb90: 2e70 6c6f 7428 6672 616e 6765 2c20 666f  .plot(frange, fo
+0001eba0: 7574 7075 7420 2d20 666f 7574 7075 742e  utput - foutput.
+0001ebb0: 6d69 6e28 292c 2063 6f6c 6f72 3d27 7461  min(), color='ta
+0001ebc0: 623a 6f72 616e 6765 2729 0d0a 2320 2020  b:orange')..#   
+0001ebd0: 2020 2020 2020 2020 2020 656c 6966 2070            elif p
+0001ebe0: 6172 616d 203d 3d20 2772 6573 706f 6e73  aram == 'respons
+0001ebf0: 6527 3a0d 0a23 2020 2020 2020 2020 2020  e':..#          
+0001ec00: 2020 2020 2020 2066 7265 7370 6f6e 6365         fresponce
+0001ec10: 203d 206e 702e 6162 7328 6829 0d0a 2320   = np.abs(h)..# 
+0001ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec30: 6672 6573 706f 6e63 6520 3d20 7a28 6672  fresponce = z(fr
+0001ec40: 6573 706f 6e63 6529 0d0a 2320 2020 2020  esponce)..#     
+0001ec50: 2020 2020 2020 2020 2020 2020 6178 322e              ax2.
+0001ec60: 706c 6f74 2866 7261 6e67 652c 2066 7265  plot(frange, fre
+0001ec70: 7370 6f6e 6365 202d 2066 7265 7370 6f6e  sponce - frespon
+0001ec80: 6365 2e6d 696e 2829 2c20 636f 6c6f 723d  ce.min(), color=
+0001ec90: 2774 6162 3a67 7265 656e 2729 0d0a 2320  'tab:green')..# 
+0001eca0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0001ecb0: 2070 6172 616d 203d 3d20 2770 6174 7465   param == 'patte
+0001ecc0: 726e 273a 0d0a 2320 2020 2020 2020 2020  rn':..#         
+0001ecd0: 2020 2020 2020 2020 6670 6174 7465 726e          fpattern
+0001ece0: 203d 2066 696e 7075 7420 2a20 6e70 2e61   = finput * np.a
+0001ecf0: 6273 2868 290d 0a23 2020 2020 2020 2020  bs(h)..#        
+0001ed00: 2020 2020 2020 2020 2066 7061 7474 6572           fpatter
+0001ed10: 6e20 3d20 7a28 6670 6174 7465 726e 290d  n = z(fpattern).
+0001ed20: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
+0001ed30: 2020 2061 7832 2e70 6c6f 7428 6672 616e     ax2.plot(fran
+0001ed40: 6765 2c20 6670 6174 7465 726e 202d 2066  ge, fpattern - f
+0001ed50: 7061 7474 6572 6e2e 6d69 6e28 292c 2063  pattern.min(), c
+0001ed60: 6f6c 6f72 3d27 7461 623a 7069 6e6b 2729  olor='tab:pink')
+0001ed70: 0d0a 0d0a 2320 2020 2020 2020 2020 6178  ....#         ax
+0001ed80: 322e 6c65 6765 6e64 285b 7061 7261 6d2e  2.legend([param.
+0001ed90: 6361 7069 7461 6c69 7a65 2829 2066 6f72  capitalize() for
+0001eda0: 2070 6172 616d 2069 6e20 7061 7261 6d73   param in params
+0001edb0: 5d29 0d0a 2320 2020 2020 2020 2020 6178  ])..#         ax
+0001edc0: 322e 7365 745f 786c 696d 2830 2c20 3130  2.set_xlim(0, 10
+0001edd0: 3029 0d0a 0d0a 2320 2020 2020 2020 2020  0)....#         
+0001ede0: 6669 672e 7375 7074 6974 6c65 2866 2742  fig.suptitle(f'B
+0001edf0: 7261 6e63 6820 7b62 7261 6e63 685f 6e75  ranch {branch_nu
+0001ee00: 6d7d 272c 2079 3d30 2e39 352c 2078 3d30  m}', y=0.95, x=0
+0001ee10: 2e32 2c20 666f 6e74 7369 7a65 3d33 3029  .2, fontsize=30)
+0001ee20: 0d0a 2320 2020 2020 2020 2020 6669 672e  ..#         fig.
+0001ee30: 7365 745f 7369 7a65 5f69 6e63 6865 7328  set_size_inches(
+0001ee40: 3130 2c20 3529 0d0a 2320 2020 2020 2020  10, 5)..#       
+0001ee50: 2020 7365 6c66 2e66 616b 655f 6576 6f6b    self.fake_evok
+0001ee60: 6564 2e70 6c6f 745f 746f 706f 6d61 7028  ed.plot_topomap(
+0001ee70: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001ee80: 7469 6d65 733d 6272 616e 6368 5f6e 756d  times=branch_num
+0001ee90: 2c0d 0a23 2020 2020 2020 2020 2020 2020  ,..#            
+0001eea0: 2061 7865 733d 6178 312c 0d0a 2320 2020   axes=ax1,..#   
+0001eeb0: 2020 2020 2020 2020 2020 636f 6c6f 7262            colorb
+0001eec0: 6172 3d46 616c 7365 2c0d 0a23 2020 2020  ar=False,..#    
+0001eed0: 2020 2020 2020 2020 2073 6361 6c69 6e67           scaling
+0001eee0: 733d 312c 0d0a 2320 2020 2020 2020 2020  s=1,..#         
+0001eef0: 2020 2020 7469 6d65 5f66 6f72 6d61 743d      time_format=
+0001ef00: 2222 2c0d 0a23 2020 2020 2020 2020 2020  "",..#          
+0001ef10: 2020 206f 7574 6c69 6e65 733d 2768 6561     outlines='hea
+0001ef20: 6427 2c0d 0a23 2020 2020 2020 2020 2029  d',..#         )
+0001ef30: 0d0a 0d0a 2320 2020 2020 2020 2020 7265  ....#         re
+0001ef40: 7475 726e 2066 6967 0d0a 0d0a 0d0a       turn fig......
```

### Comparing `mneflow-0.5.6/mneflow/utils.py` & `mneflow-0.5.7/mneflow/utils.py`

 * *Files 14% similar despite different names*

```diff
@@ -8,16 +8,18 @@
 import pickle
 import warnings
 import numpy as np
 import tensorflow as tf
 import scipy.io as sio
 import mne
 from mneflow import models
-
-   
+from matplotlib import pyplot as plt
+from matplotlib import patches as ptch
+from matplotlib import collections
+from mpl_toolkits.axes_grid1 import make_axes_locatable   
 
 class MetaData():
     """
     Class containing all metadata required to run model training, prediction, 
     and evaluation. Produced by mneflow.produce_tfrecords, saved to "path" and 
     can be restored if you need to rerun training on existing tfrecords.
     
@@ -79,23 +81,26 @@
     
     def __init__(self):
         self.data = dict()
         self.preprocessing = dict()
         self.model_specs = dict()
         self.train_params = dict()
         self.patterns = dict()
+        self.results = dict()
+        self.weights = dict()
         
-    def save(self):
+    def save(self, verbose=True):
         """Saves the metadata to self.data['path'] + self.data['data_id']"""
         if 'path' in self.data.keys() and 'data_id' in self.data.keys():
             fname = self.data['data_id'] + '_meta.pkl'
             with open(os.path.join(self.data['path'], fname), 'wb') as f:
                 pickle.dump(self, f)
-            print("""Saving MetaData as {} \n
-                  to {}""".format(fname, self.data['path']))
+            if verbose:
+                print("""Saving MetaData as {} \n
+                      to {}""".format(fname, self.data['path']))
         else:
             print("""Cannot save MetaData! \n
                   Please specify meta.data['path'] and meta.data['data_id'']""")
         
         
     def restore_model(self):
         """Restored previously saved model from metadata."""
@@ -108,32 +113,32 @@
             model = models.FBCSP_ShallowNet(meta=self)
         elif self.model_specs['scope'] == 'deep4':
             model = models.Deep4(meta=self)
         elif self.model_specs['scope'] == 'eegnet8':
             model = models.EEGNet(meta=self)
         
         model.build()
-        model_name = "_".join([self.model_specs['scope'],
+        model.model_name = "_".join([self.model_specs['scope'],
                                self.data['data_id'] + '.h5'])
         model.km.load_weights(os.path.join(self.model_specs['model_path'],
-                                           model_name))
+                                           model.model_name))
         
         
         #model.km = tf.keras.models.load_model(os.path.join(self.model_specs['model_path'],
         #                                      model_name))
         
         
         #model.build()
         model.cv_patterns = self.patterns
         #TODO: set weights from self.km.weights
         #TODO: set val loss, patterns, etc, specs
         return model
     
     def update(self, data=None, preprocessing=None, train_params=None, 
-               model_specs=None, patterns=None):
+               model_specs=None, patterns=None, results=None, weights=None):
         """Updates metadata file"""
         if isinstance(data, dict):
             self.data.update(data)
             print("Updating: meta.data")
         if isinstance(preprocessing, dict):
             self.preprocessing.update(preprocessing)
             print("Updating: meta.preprocessing")
@@ -142,17 +147,255 @@
              print("Updating: meta.train_params")
         if isinstance(model_specs, dict):
              self.model_specs.update(model_specs)
              print("Updating: meta.model_specs")
         if isinstance(patterns, dict):
             self.patterns.update(patterns)
             print("Updating: meta.patterns")
-        #self.save()
+        if isinstance(results, dict):
+            self.results.update(results)
+            print("Updating: meta.results")
+        if isinstance(weights, dict):
+            self.weights.update(weights)
+            print("Updating: meta.weights")
+        self.save(verbose=False)
         return
+    
+    def make_fake_evoked(self, topos, sensor_layout):
+        if 'info' not in self.data.keys():
+            lo = mne.channels.read_layout(sensor_layout)
+            #lo = channels.generate_2d_layout(lo.pos)
+            info = mne.create_info(lo.names, 1., sensor_layout.split('-')[-1])
+            orig_xy = np.mean(lo.pos[:, :2], 0)
+            for i, ch in enumerate(lo.names):
+                if info['chs'][i]['ch_name'] == ch:
+                    info['chs'][i]['loc'][:2] = (lo.pos[i, :2] - orig_xy)/4.5
+                    #info['chs'][i]['loc'][4:] = 0
+                else:
+                    print("Channel name mismatch. info: {} vs lo: {}".format(
+                        info['chs'][i]['ch_name'], ch))
+        #info['sfreq'] = 1
+        fake_evoked = mne.evoked.EvokedArray(topos, info)
+        return fake_evoked
+    
+    def explore_components(self, sorting='output_corr',
+                         integrate=['vars', 'folds'], info=None, 
+                         sensor_layout='Vectorview-grad',
+                         class_names=None):
+        """Plots the weights of the output layer.
+
+        Parameters
+        ----------
+
+        pat : int [0, self.specs['n_latent'])
+            Index of the latent component to higlight
+
+        t : int [0, self.h_params['n_t'])
+            Index of timepoint to highlight
+
+        Returns
+        -------
+        figure :
+            Imshow [n_latent, y_shape]
+
+        """
+
+        def _onclick_component(event):
+            
+            x_ind = np.maximum(np.round(event.xdata, 0).astype(int), 0)
+            y_ind = np.maximum(np.round(event.ydata).astype(int), 0)
+            
+
+
+            f1, ax = plt.subplots(2,2, tight_layout=True)
+            #f1.set_layout_engine('constrained')
+            f1.suptitle("{}: {}  {}: {}"
+                  .format(names[0][:-1], x_ind, names[1][:-1], y_ind))
+
+            # a = np.dot(self.patterns['dcov']['class_conditional'][x_ind].mean(-1),
+            #            self.patterns['weights']['dmx'])
+
+            self.fake_evoked_interactive.data[:, y_ind] = topos[:, y_ind]
+            self.fake_evoked_interactive.plot_topomap(times=[y_ind],
+                                                      axes=ax[0, 0],
+                                                      colorbar=False,
+                                                      time_format='Spatial activation pattern, [au]'
+                                                      )
+            psd = psds[:, y_ind].T
+            freq_response = freq_responses[:, y_ind].T
+            out_psd = psd*freq_response
+            psd /= np.maximum(np.sum(psd), 1e-9)
+            out_psd /= np.maximum(np.sum(out_psd), 1e-9)
+            #freq /= np.maximum(np.sum(out_psd), 1e-9)
+            #ax[1,].clear()
+            ax[0,1].semilogy(self.patterns['freqs'], psd,
+                         label='Input RPS')
+            ax[0,1].semilogy(self.patterns['freqs'], out_psd,
+                         label='Output RPS')
+            #ax[0,1].semilogy(patterns_struct['spectra']['freqs'], freq_response,
+            #             label='Freq_response')
+            ax[0,1].set_xlim(1, 125.)
+            ax[0,1].set_ylim(1e-6, 1.)
+            ax[0,1].legend(frameon=False)
+            ax[0,1].set_title('Relative power spectra')
+
+
+            #ax[1,0].stem(tconv_kernels[:, y_ind])
+            ax[1,0].set_title('Temporal convolution kernel coefficients')
+            if trans:
+                ax[1,1].plot(F[y_ind, :], 'ks')
+                ax[1,1].plot(y_ind, F[y_ind, x_ind], 'rs')
+            else:                    
+                ax[1,1].plot(F[y_ind, :], 'ks')
+                ax[1,1].plot(x_ind, F[y_ind, x_ind], 'rs')
+            ax[1,1].set_title('{} per {}. Red={}'.format(sorting, names[0][:-1], x_ind))
+            ax[1,1].set_xlabel(names[0])
+
+
+
+        # get feature relevance
+        F = self.patterns[sorting]['feature_relevance']
+        ax = 1
+        names = ['Time Points', 'Components', 'Classes', 'Folds']
+        if 'folds' in integrate:
+            F = F.mean(3, keepdims=True)
+            names.pop(names.index('Folds'))
+        if 'timepoints' in integrate:
+            F = F.max(0, keepdims=True)
+            ax = 0
+            names.pop(names.index('Time Points'))
+        if 'vars' in integrate:
+            F = F.sum(2, keepdims=True)
+            names.pop(names.index('Classes'))
+        if 'components' in integrate:
+            F = F.sum(1, keepdims=True)
+            names.pop(names.index('Components'))
+        
+        #print(names)
+        
+        F = np.squeeze(F)
+        while F.ndim < 2:
+            F = np.expand_dims(F, -1)
+            ax = 0
+            
+        if F.ndim > 2:
+            print("""Integrate: {} returned shape {}. \n
+                  Can only plot 2 dimensions!""".format(integrate, F.shape))
+            return
+        if 'timepoints' in integrate:
+            F = F.T
+            trans = False
+            ax = 1 - ax
+            print(names)
+        else:
+            trans = False
+            names = names[::-1]
         
+        # if F.shape[1] < F.shape[0]:
+        #     F = F.T
+        #     
+                    
+        inds = np.argmax(F, ax)
+        
+        print(inds)
+        # new_topos = [np.dot(self.patterns['dcov']['input_spatial'][:, :, i], 
+        #                     self.weights['dmx'][:, ind, i])
+        #               for i, ind in enumerate(inds)]
+        #new_topos = np.concatenate(new_topos, axis=0).T
+        
+
+        #print(new_topos.shape)
+        
+
+        #psds = patterns_struct['spectra']['psds']
+        topos =  np.squeeze(self.patterns[sorting]['spatial'])#.mean(-1)
+        #print(topos.shape)
+        psds = np.squeeze(self.patterns[sorting]['psds'])#.mean(-1)
+        freq_responses = np.squeeze(self.patterns[sorting]['temporal'])#.mean(-1)
+        #tconv_kernels = self.patterns['weights']['tconv']
+        self.fake_evoked_interactive = self.make_fake_evoked(topos, sensor_layout)
+
+        vmin = np.min(F)
+        vmax = np.max(F)
+
+        f = plt.figure()
+        ax = f.gca()
+        
+        im = ax.imshow(F, cmap='bone_r', vmin=vmin, vmax=vmax)
+        if trans:
+            r = [ptch.Rectangle((i - .5, ind - .5), width=1,
+                                height=1, angle=0.0, facecolor='none') for i, ind in enumerate(inds)]
+        else:
+            r = [ptch.Rectangle((ind - .5, i - .5), width=1,
+                                height=1, angle=0.0, facecolor='none') for i, ind in enumerate(inds)]
+
+        pc = collections.PatchCollection(r, facecolor='none', alpha=.5,
+                                          edgecolor='red')
+        #ax = f.gca()
+        ax.add_collection(pc)
+        ax.set_ylabel(names[1])
+        ax.set_xlabel(names[0])
+        ax.set_title('Component relevance map: {} (Clickable)'.format(sorting))
+
+        f.colorbar(im)
+        f.canvas.mpl_connect('button_press_event', _onclick_component)
+        f.show()
+        return f
+    
+    def plot_topos(self, topos, sensor_layout='Vectorview-mag', class_subset=None):
+        """
+        Plot any spatial distribution in the sensor space.
+        TODO: Interpolation??
+
+
+        Parameters
+        ----------
+        topos : np.array
+            [n_ch, n_classes, ...]
+        sensor_layout : TYPE, optional
+            DESCRIPTION. The default is 'Vectorview-mag'.
+        class_subset  : np.array, optional
+
+        Returns
+        -------
+        None.
+
+        """
+ 
+        if topos.ndim > 2:
+            topos = topos.mean(-1)
+        topos_new = topos / topos.std(0, keepdims=True)
+
+        n = topos.shape[1]
+
+        if class_subset is None:
+            class_subset = np.arange(0,  n, 1.)
+
+        fake_evoked = self.make_fake_evoked(topos_new, sensor_layout)
+
+        ft = fake_evoked.plot_topomap(times=class_subset,
+                                    colorbar=True,
+                                    scalings=1,
+                                    time_format="Class %g",
+                                    outlines='head',
+                                    #vlim= np.percentile(topos, [5, 95])
+                                    )
+        #ft.show()
+        return ft
+    
+    def plot_combined_pattern(self):
+        return
+    
+    def plot_sepctra(self):
+        return
+    
+    def plot_waveforms(self):
+        return
+    
+    
 
 def _onehot(y, n_classes=False):
     """
     Transforms n-by-1 vector of class labels into n-by-n_classes array of
     one-hot encoded labels
 
     Parameters
@@ -736,17 +979,16 @@
 
                 print('Prepocessed sample shape:', X[0].shape)
                 print('Target shape actual/metadata: ', Y[0].shape, y_shape)
 
                 print('Saving TFRecord# {}'.format(jj))
 
                 folds.append(fold_split)
-                train_filename = ''.join([data_path, data_id, '_train_', 
-                                          str(jj),
-                                          '.tfrecord'])
+                trname = ''.join([data_id, '_train_', str(jj), '.tfrecord'])
+                train_filename = os.path.join(data_path, trname)
                 train_paths.append(train_filename)
 
                 _write_tfrecords(X, Y, n, train_filename, 
                                  target_type=target_type)
 
                 if test_set == 'loso':
                     test_size = len(Y)
@@ -1228,7 +1470,62 @@
     return np.dot(y_pred.T, y_true) / np.sum(y_pred**2, axis=0)
 
 def r2_score(y_true, y_pred):
     res = np.sum((y_true - y_pred)**2, axis=0)
     tot = np.sum((y_true - np.mean(y_true, axis=0, keepdims=True))**2, axis=0)
     return 1 - res/tot
 
+def plot_confusion_matrix(cm,
+                          classes=None,
+                          normalize=True,
+                          title=None,
+                          cmap=plt.cm.Blues,
+                          vmax=None):
+    """
+    This function prints and plots the confusion matrix.
+    Normalization can be applied by setting `normalize=True`.
+    """
+    if not title:
+        if normalize:
+            title = 'Normalized confusion matrix'
+        else:
+            title = 'Confusion matrix, without normalization'
+
+    # Compute confusion matrix
+    # Only use the labels that appear in the data
+    #classes = classes[unique_labels(y_true, y_pred)]
+    if not classes:
+        classes = [' '.join(["Class", str(i)]) for i in range(cm.shape[0])]
+    if normalize:
+        cm = cm.astype('float') / cm.sum(axis=1)[:, np.newaxis]
+    #if not vmax:
+    #    vmax = np.max(cm)
+    #print(cm)
+    fig, ax = plt.subplots()
+    im = ax.imshow(cm, interpolation='nearest', cmap=cmap, vmax=vmax)
+    ax.figure.colorbar(im, ax=ax)
+    # We want to show all ticks...
+    ax.set(xticks=np.arange(cm.shape[1]),
+           yticks=np.arange(cm.shape[0]),
+           # ... and label them with the respective list entries
+           xticklabels=classes, yticklabels=classes,
+           title=title,
+           ylabel='Predicted label',
+           xlabel='True label')
+
+    # Rotate the tick labels and set their alignment.
+    plt.setp(ax.get_xticklabels(), rotation=45, ha="right",
+             rotation_mode="anchor")
+
+    # Loop over data dimensions and create text annotations.
+    fmt = '.2f' if normalize else '.0f'
+    thresh = cm.max() / 2.
+    for i in range(cm.shape[0]):
+        for j in range(cm.shape[1]):
+            #if i == j:
+            ax.text(j, i, format(cm[i, j], fmt),
+                        ha="center", va="center",
+                        color="white" if cm[i, j] > thresh else "black")
+    fig.tight_layout()
+    #fig.show()
+    return fig
+
```

### Comparing `mneflow-0.5.6/mneflow.egg-info/PKG-INFO` & `mneflow-0.5.7/mneflow.egg-info/PKG-INFO`

 * *Files 7% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mneflow
-Version: 0.5.6
+Version: 0.5.7
 Summary: Neural networks for MEG and EEG data
 Home-page: https://github.com/zubara/mneflow
 Download-URL: https://github.com/zubara/mneflow/archive/master.zip
 Maintainer: Ivan Zubarev
 Maintainer-email: ivan.zubarev@aalto.fi
 License: BSD-3
 Platform: any
@@ -18,10 +18,10 @@
 Classifier: Operating System :: POSIX
 Classifier: Operating System :: Unix
 Classifier: Operating System :: MacOS
 Description-Content-Type: text/x-rst
 License-File: LICENSE.md
 Requires-Dist: numpy
 Requires-Dist: scipy
-Requires-Dist: mne
-Requires-Dist: tensorflow
+Requires-Dist: mne<=1.1.1,>=0.24.0
+Requires-Dist: tensorflow<=2.16rc,>=2.12.0
 Requires-Dist: matplotlib
```

### Comparing `mneflow-0.5.6/setup.py` & `mneflow-0.5.7/setup.py`

 * *Files 9% similar despite different names*

```diff
@@ -9,15 +9,15 @@
 
     setup(name='mneflow',
         maintainer='Ivan Zubarev',
         maintainer_email='ivan.zubarev@aalto.fi',
         description='Neural networks for MEG and EEG data',
         license='BSD-3',
         url='https://github.com/zubara/mneflow',
-        version='0.5.6',
+        version='0.5.7',
         download_url='https://github.com/zubara/mneflow/archive/master.zip',
         #long_description=codecs.open('./docs/intro.rst', encoding='utf8').read(),
         long_description_content_type="text/x-rst",
         classifiers=['Intended Audience :: Science/Research',
                      'Intended Audience :: Developers',
                      'License :: OSI Approved',
                      'Programming Language :: Python',
@@ -25,8 +25,12 @@
                      'Topic :: Scientific/Engineering',
                      'Operating System :: Microsoft :: Windows',
                      'Operating System :: POSIX',
                      'Operating System :: Unix',
                      'Operating System :: MacOS'],
         platforms='any',
         packages=['mneflow'],
-        install_requires=['numpy', 'scipy', 'mne', 'tensorflow', 'matplotlib'])
+        install_requires=['numpy', 
+                          'scipy', 
+                          'mne >= 0.24.0, <=1.1.1', 
+                          'tensorflow >= 2.12.0, <=2.16rc', 
+                          'matplotlib'])
```

