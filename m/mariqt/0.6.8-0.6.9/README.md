# Comparing `tmp/mariqt-0.6.8-py2.py3-none-any.whl.zip` & `tmp/mariqt-0.6.9-py2.py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,34 +1,34 @@
-Zip file size: 219424 bytes, number of entries: 32
--rw-r--r--  2.0 unx     5876 b- defN 24-Apr-10 09:51 mariqt/converters.py
--rw-r--r--  2.0 unx    15508 b- defN 24-Apr-10 09:51 mariqt/core.py
--rw-r--r--  2.0 unx     8485 b- defN 24-Apr-10 09:51 mariqt/directories.py
--rw-r--r--  2.0 unx      853 b- defN 24-Apr-10 09:51 mariqt/equipment.py
--rw-r--r--  2.0 unx    16621 b- defN 24-Apr-10 09:51 mariqt/files.py
--rw-r--r--  2.0 unx    28764 b- defN 24-Apr-10 09:51 mariqt/geo.py
--rw-r--r--  2.0 unx    24086 b- defN 24-Apr-10 09:51 mariqt/image.py
--rw-r--r--  2.0 unx     3090 b- defN 24-Apr-10 09:51 mariqt/misc.py
--rw-r--r--  2.0 unx    40982 b- defN 24-Apr-10 09:51 mariqt/navigation.py
--rw-r--r--  2.0 unx     7345 b- defN 24-Apr-10 09:51 mariqt/provenance.py
--rw-r--r--  2.0 unx    22316 b- defN 24-Apr-10 09:51 mariqt/reports.py
--rw-r--r--  2.0 unx     4376 b- defN 24-Apr-10 09:51 mariqt/settings.py
--rw-r--r--  2.0 unx     9514 b- defN 24-Apr-10 09:51 mariqt/tests.py
--rw-r--r--  2.0 unx     9614 b- defN 24-Apr-10 09:51 mariqt/variables.py
--rw-r--r--  2.0 unx       21 b- defN 24-Apr-10 09:51 mariqt/version.py
--rw-r--r--  2.0 unx     6175 b- defN 24-Apr-10 09:51 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
--rw-r--r--  2.0 unx    42625 b- defN 24-Apr-10 09:51 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.1.json
--rw-r--r--  2.0 unx     3218 b- defN 24-Apr-10 09:51 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
--rw-r--r--  2.0 unx    12135 b- defN 24-Apr-10 09:51 mariqt/sources/dship.py
--rw-r--r--  2.0 unx     4684 b- defN 24-Apr-10 09:51 mariqt/sources/dship_settings.py
--rw-r--r--  2.0 unx     2177 b- defN 24-Apr-10 09:51 mariqt/sources/elements.py
--rw-r--r--  2.0 unx   131555 b- defN 24-Apr-10 09:51 mariqt/sources/ifdo.py
--rw-r--r--  2.0 unx     5533 b- defN 24-Apr-10 09:51 mariqt/sources/ofop.py
--rw-r--r--  2.0 unx     2961 b- defN 24-Apr-10 09:51 mariqt/sources/osis.py
--rw-r--r--  2.0 unx   650149 b- defN 24-Apr-10 09:51 mariqt/sources/svgs.py
--rw-r--r--  2.0 unx     3728 b- defN 24-Apr-10 09:51 mariqt/sources/underway.py
--rw-r--r--  2.0 unx      162 b- defN 24-Apr-10 09:52 mariqt-0.6.8.dist-info/AUTHORS.md
--rw-r--r--  2.0 unx    35140 b- defN 24-Apr-10 09:52 mariqt-0.6.8.dist-info/LICENSE
--rw-r--r--  2.0 unx     1168 b- defN 24-Apr-10 09:52 mariqt-0.6.8.dist-info/METADATA
--rw-r--r--  2.0 unx      110 b- defN 24-Apr-10 09:52 mariqt-0.6.8.dist-info/WHEEL
--rw-r--r--  2.0 unx        7 b- defN 24-Apr-10 09:52 mariqt-0.6.8.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2621 b- defN 24-Apr-10 09:52 mariqt-0.6.8.dist-info/RECORD
-32 files, 1101599 bytes uncompressed, 215278 bytes compressed:  80.5%
+Zip file size: 219741 bytes, number of entries: 32
+-rw-r--r--  2.0 unx     5876 b- defN 24-Apr-16 08:54 mariqt/converters.py
+-rw-r--r--  2.0 unx    15508 b- defN 24-Apr-16 08:54 mariqt/core.py
+-rw-r--r--  2.0 unx     8485 b- defN 24-Apr-16 08:54 mariqt/directories.py
+-rw-r--r--  2.0 unx      853 b- defN 24-Apr-16 08:54 mariqt/equipment.py
+-rw-r--r--  2.0 unx    16621 b- defN 24-Apr-16 08:54 mariqt/files.py
+-rw-r--r--  2.0 unx    28764 b- defN 24-Apr-16 08:54 mariqt/geo.py
+-rw-r--r--  2.0 unx    24086 b- defN 24-Apr-16 08:54 mariqt/image.py
+-rw-r--r--  2.0 unx     3090 b- defN 24-Apr-16 08:54 mariqt/misc.py
+-rw-r--r--  2.0 unx    40982 b- defN 24-Apr-16 08:54 mariqt/navigation.py
+-rw-r--r--  2.0 unx     7345 b- defN 24-Apr-16 08:54 mariqt/provenance.py
+-rw-r--r--  2.0 unx    22316 b- defN 24-Apr-16 08:54 mariqt/reports.py
+-rw-r--r--  2.0 unx     4376 b- defN 24-Apr-16 08:54 mariqt/settings.py
+-rw-r--r--  2.0 unx     9514 b- defN 24-Apr-16 08:54 mariqt/tests.py
+-rw-r--r--  2.0 unx     9614 b- defN 24-Apr-16 08:54 mariqt/variables.py
+-rw-r--r--  2.0 unx       21 b- defN 24-Apr-16 08:54 mariqt/version.py
+-rw-r--r--  2.0 unx     6175 b- defN 24-Apr-16 08:54 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
+-rw-r--r--  2.0 unx    42625 b- defN 24-Apr-16 08:54 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.1.json
+-rw-r--r--  2.0 unx     3218 b- defN 24-Apr-16 08:54 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
+-rw-r--r--  2.0 unx    12135 b- defN 24-Apr-16 08:54 mariqt/sources/dship.py
+-rw-r--r--  2.0 unx     4684 b- defN 24-Apr-16 08:54 mariqt/sources/dship_settings.py
+-rw-r--r--  2.0 unx     2177 b- defN 24-Apr-16 08:54 mariqt/sources/elements.py
+-rw-r--r--  2.0 unx   134255 b- defN 24-Apr-16 08:54 mariqt/sources/ifdo.py
+-rw-r--r--  2.0 unx     5533 b- defN 24-Apr-16 08:54 mariqt/sources/ofop.py
+-rw-r--r--  2.0 unx     2961 b- defN 24-Apr-16 08:54 mariqt/sources/osis.py
+-rw-r--r--  2.0 unx   650149 b- defN 24-Apr-16 08:54 mariqt/sources/svgs.py
+-rw-r--r--  2.0 unx     3728 b- defN 24-Apr-16 08:54 mariqt/sources/underway.py
+-rw-r--r--  2.0 unx      162 b- defN 24-Apr-16 08:55 mariqt-0.6.9.dist-info/AUTHORS.md
+-rw-r--r--  2.0 unx    35140 b- defN 24-Apr-16 08:55 mariqt-0.6.9.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1168 b- defN 24-Apr-16 08:55 mariqt-0.6.9.dist-info/METADATA
+-rw-r--r--  2.0 unx      110 b- defN 24-Apr-16 08:55 mariqt-0.6.9.dist-info/WHEEL
+-rw-r--r--  2.0 unx        7 b- defN 24-Apr-16 08:55 mariqt-0.6.9.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2621 b- defN 24-Apr-16 08:55 mariqt-0.6.9.dist-info/RECORD
+32 files, 1104299 bytes uncompressed, 215595 bytes compressed:  80.5%
```

## zipnote {}

```diff
@@ -72,26 +72,26 @@
 
 Filename: mariqt/sources/svgs.py
 Comment: 
 
 Filename: mariqt/sources/underway.py
 Comment: 
 
-Filename: mariqt-0.6.8.dist-info/AUTHORS.md
+Filename: mariqt-0.6.9.dist-info/AUTHORS.md
 Comment: 
 
-Filename: mariqt-0.6.8.dist-info/LICENSE
+Filename: mariqt-0.6.9.dist-info/LICENSE
 Comment: 
 
-Filename: mariqt-0.6.8.dist-info/METADATA
+Filename: mariqt-0.6.9.dist-info/METADATA
 Comment: 
 
-Filename: mariqt-0.6.8.dist-info/WHEEL
+Filename: mariqt-0.6.9.dist-info/WHEEL
 Comment: 
 
-Filename: mariqt-0.6.8.dist-info/top_level.txt
+Filename: mariqt-0.6.9.dist-info/top_level.txt
 Comment: 
 
-Filename: mariqt-0.6.8.dist-info/RECORD
+Filename: mariqt-0.6.9.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## mariqt/version.py

```diff
@@ -1 +1 @@
-__version__ = '0.6.8'
+__version__ = '0.6.9'
```

## mariqt/sources/ifdo.py

```diff
@@ -16,8208 +16,8376 @@
 000000f0: 6469 6666 2069 6d70 6f72 7420 4465 6570  diff import Deep
 00000100: 4469 6666 0a66 726f 6d20 7061 636b 6167  Diff.from packag
 00000110: 696e 672e 7665 7273 696f 6e20 696d 706f  ing.version impo
 00000120: 7274 2056 6572 7369 6f6e 0a69 6d70 6f72  rt Version.impor
 00000130: 7420 7374 6174 6973 7469 6373 0a69 6d70  t statistics.imp
 00000140: 6f72 7420 7265 7175 6573 7473 0a69 6d70  ort requests.imp
 00000150: 6f72 7420 7a69 7066 696c 650a 696d 706f  ort zipfile.impo
-00000160: 7274 2069 6f0a 0a69 6d70 6f72 7420 6d61  rt io..import ma
-00000170: 7269 7174 2e63 6f72 6520 6173 206d 6971  riqt.core as miq
-00000180: 7463 0a69 6d70 6f72 7420 6d61 7269 7174  tc.import mariqt
-00000190: 2e64 6972 6563 746f 7269 6573 2061 7320  .directories as 
-000001a0: 6d69 7174 640a 696d 706f 7274 206d 6172  miqtd.import mar
-000001b0: 6971 742e 6669 6c65 7320 6173 206d 6971  iqt.files as miq
-000001c0: 7466 0a69 6d70 6f72 7420 6d61 7269 7174  tf.import mariqt
-000001d0: 2e76 6172 6961 626c 6573 2061 7320 6d69  .variables as mi
-000001e0: 7174 760a 696d 706f 7274 206d 6172 6971  qtv.import mariq
-000001f0: 742e 696d 6167 6520 6173 206d 6971 7469  t.image as miqti
-00000200: 0a69 6d70 6f72 7420 6d61 7269 7174 2e74  .import mariqt.t
-00000210: 6573 7473 2061 7320 6d69 7174 740a 696d  ests as miqtt.im
-00000220: 706f 7274 206d 6172 6971 742e 6e61 7669  port mariqt.navi
-00000230: 6761 7469 6f6e 2061 7320 6d69 7174 6e0a  gation as miqtn.
-00000240: 696d 706f 7274 206d 6172 6971 742e 7365  import mariqt.se
-00000250: 7474 696e 6773 2061 7320 6d69 7174 730a  ttings as miqts.
-00000260: 696d 706f 7274 206d 6172 6971 742e 7072  import mariqt.pr
-00000270: 6f76 656e 616e 6365 2061 7320 6d69 7174  ovenance as miqt
-00000280: 700a 696d 706f 7274 206d 6172 6971 742e  p.import mariqt.
-00000290: 6765 6f20 6173 206d 6971 7467 0a69 6d70  geo as miqtg.imp
-000002a0: 6f72 7420 6d61 7269 7174 2e73 6f75 7263  ort mariqt.sourc
-000002b0: 6573 2e6f 7369 7320 6173 206d 6971 746f  es.osis as miqto
-000002c0: 7369 730a 696d 706f 7274 206d 6172 6971  sis.import mariq
-000002d0: 742e 6571 7569 706d 656e 7420 6173 206d  t.equipment as m
-000002e0: 6971 7465 7175 6970 0a0a 0a63 6c61 7373  iqtequip...class
-000002f0: 206e 6f6e 436f 7265 4669 656c 6449 6e74   nonCoreFieldInt
-00000300: 6572 6d65 6469 6174 6549 7465 6d49 6e66  ermediateItemInf
-00000310: 6f46 696c 653a 0a20 2020 2064 6566 205f  oFile:.    def _
-00000320: 5f69 6e69 745f 5f28 7365 6c66 2c20 6669  _init__(self, fi
-00000330: 6c65 4e61 6d65 3a73 7472 2c20 7365 7061  leName:str, sepa
-00000340: 7261 746f 723a 7374 722c 2068 6561 6465  rator:str, heade
-00000350: 723a 6469 6374 2c20 6461 7465 7469 6d65  r:dict, datetime
-00000360: 5f66 6f72 6d61 743a 7374 723d 6d69 7174  _format:str=miqt
-00000370: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-00000380: 6d61 7269 7174 275d 293a 0a20 2020 2020  mariqt']):.     
-00000390: 2020 2073 656c 662e 6669 6c65 4e61 6d65     self.fileName
-000003a0: 203d 2066 696c 654e 616d 650a 2020 2020   = fileName.    
-000003b0: 2020 2020 7365 6c66 2e73 6570 6172 6174      self.separat
-000003c0: 6f72 203d 2073 6570 6172 6174 6f72 0a20  or = separator. 
-000003d0: 2020 2020 2020 2073 656c 662e 6865 6164         self.head
-000003e0: 6572 203d 2068 6561 6465 720a 2020 2020  er = header.    
-000003f0: 2020 2020 7365 6c66 2e64 6174 6574 696d      self.datetim
-00000400: 655f 666f 726d 6174 203d 2064 6174 6574  e_format = datet
-00000410: 696d 655f 666f 726d 6174 0a0a 2020 2020  ime_format..    
-00000420: 6465 6620 5f5f 6571 5f5f 2873 656c 662c  def __eq__(self,
-00000430: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
-00000440: 2069 6620 7365 6c66 2e66 696c 654e 616d   if self.fileNam
-00000450: 653d 3d6f 7468 6572 2e66 696c 654e 616d  e==other.fileNam
-00000460: 6520 616e 6420 7365 6c66 2e73 6570 6172  e and self.separ
-00000470: 6174 6f72 203d 3d20 6f74 6865 722e 7365  ator == other.se
-00000480: 7061 7261 746f 7220 616e 6420 7365 6c66  parator and self
-00000490: 2e68 6561 6465 723d 3d6f 7468 6572 2e68  .header==other.h
-000004a0: 6561 6465 7220 616e 6420 7365 6c66 2e64  eader and self.d
-000004b0: 6174 6574 696d 655f 666f 726d 6174 3d3d  atetime_format==
-000004c0: 6f74 6865 722e 6461 7465 7469 6d65 5f66  other.datetime_f
-000004d0: 6f72 6d61 743a 0a20 2020 2020 2020 2020  ormat:.         
-000004e0: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
-000004f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00000500: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00000510: 4661 6c73 650a 0a64 6566 2066 696e 6446  False..def findF
-00000520: 6965 6c64 2869 6664 6f5f 6469 6374 2c6b  ield(ifdo_dict,k
-00000530: 6579 7329 3a0a 2020 2020 2020 2020 2222  eys):.        ""
-00000540: 2220 4c6f 6f6b 7320 666f 7220 206b 6579  " Looks for  key
-00000550: 7320 2822 6b65 7922 206f 7220 5b6b 6579  s ("key" or [key
-00000560: 312c 6b65 7932 5d29 2069 6e20 6966 646f  1,key2]) in ifdo
-00000570: 5f64 6963 7420 616e 6420 7265 7475 726e  _dict and return
-00000580: 7320 6974 7320 7661 6c75 6520 6f72 2061  s its value or a
-00000590: 6e20 656d 7074 7920 7374 7269 6e67 2069  n empty string i
-000005a0: 6620 6b65 7920 6e6f 7420 666f 756e 6422  f key not found"
-000005b0: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
-000005c0: 7420 6973 696e 7374 616e 6365 286b 6579  t isinstance(key
-000005d0: 732c 206c 6973 7429 3a0a 2020 2020 2020  s, list):.      
-000005e0: 2020 2020 2020 6b65 7973 203d 205b 6b65        keys = [ke
-000005f0: 7973 5d0a 0a20 2020 2020 2020 2061 7220  ys]..        ar 
-00000600: 3d20 6966 646f 5f64 6963 740a 2020 2020  = ifdo_dict.    
-00000610: 2020 2020 666f 7220 6b20 696e 206b 6579      for k in key
-00000620: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-00000630: 6620 6b20 696e 2061 723a 0a20 2020 2020  f k in ar:.     
-00000640: 2020 2020 2020 2020 2020 2061 7220 3d20             ar = 
-00000650: 6172 5b6b 5d0a 2020 2020 2020 2020 2020  ar[k].          
-00000660: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00000670: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00000680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000690: 206b 203d 2069 6e74 286b 290a 2020 2020   k = int(k).    
-000006a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000006b0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-000006c0: 6528 6172 2c6c 6973 7429 206f 7220 6c65  e(ar,list) or le
-000006d0: 6e28 6172 2920 3c20 6b3a 0a20 2020 2020  n(ar) < k:.     
-000006e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000006f0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00000700: 726f 7228 2249 6e64 6578 222c 6b2c 226f  ror("Index",k,"o
-00000710: 7574 206f 6620 626f 756e 6473 222c 6c65  ut of bounds",le
-00000720: 6e28 6172 2929 0a20 2020 2020 2020 2020  n(ar)).         
-00000730: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
-00000740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000750: 2020 2072 6574 7572 6e20 2222 0a20 2020     return "".   
-00000760: 2020 2020 2020 2020 2020 2020 2061 7220               ar 
-00000770: 3d20 6172 5b6b 5d0a 2020 2020 2020 2020  = ar[k].        
-00000780: 7265 7475 726e 2061 720a 0a0a 636c 6173  return ar...clas
-00000790: 7320 6946 444f 5f52 6561 6465 723a 0a20  s iFDO_Reader:. 
-000007a0: 2020 2022 2050 726f 7669 6465 7320 636f     " Provides co
-000007b0: 6e76 656e 6965 6e74 2066 756e 6374 696f  nvenient functio
-000007c0: 6e73 2066 6f72 2072 6561 6469 6e67 2064  ns for reading d
-000007d0: 6174 6120 6672 6f6d 2069 4644 4f20 6669  ata from iFDO fi
-000007e0: 6c65 7320 220a 0a20 2020 2064 6566 205f  les "..    def _
-000007f0: 5f69 6e69 745f 5f28 7365 6c66 2c20 6946  _init__(self, iF
-00000800: 444f 6669 6c65 3a73 7472 293a 0a20 2020  DOfile:str):.   
-00000810: 2020 2020 2022 2050 726f 7669 6465 7320       " Provides 
-00000820: 636f 6e76 656e 6965 6e74 2066 756e 6374  convenient funct
-00000830: 696f 6e73 2066 6f72 2072 6561 6469 6e67  ions for reading
-00000840: 2064 6174 6120 6672 6f6d 2069 4644 4f20   data from iFDO 
-00000850: 6669 6c65 7320 220a 2020 2020 2020 2020  files ".        
-00000860: 0a20 2020 2020 2020 2073 656c 662e 6946  .        self.iF
-00000870: 444f 6669 6c65 203d 2069 4644 4f66 696c  DOfile = iFDOfil
-00000880: 650a 2020 2020 2020 2020 7365 6c66 2e69  e.        self.i
-00000890: 6664 6f20 3d20 6946 444f 2e6f 7065 6e5f  fdo = iFDO.open_
-000008a0: 6966 646f 5f66 696c 6528 7365 6c66 2e69  ifdo_file(self.i
-000008b0: 4644 4f66 696c 6529 0a0a 0a20 2020 2064  FDOfile)...    d
-000008c0: 6566 205f 5f67 6574 6974 656d 5f5f 2873  ef __getitem__(s
-000008d0: 656c 662c 206b 6579 7329 3a0a 2020 2020  elf, keys):.    
-000008e0: 2020 2020 2222 2220 5265 7475 726e 7320      """ Returns 
-000008f0: 636f 7079 206f 6620 6368 6563 6b65 6420  copy of checked 
-00000900: 6966 646f 2073 6574 206f 7220 6974 656d  ifdo set or item
-00000910: 2066 6965 6c64 2076 616c 7565 2c20 616c   field value, al
-00000920: 736f 2063 6f6e 7369 6465 726e 6720 6465  so considerng de
-00000930: 6661 756c 7420 7661 6c75 6573 2066 726f  fault values fro
-00000940: 6d20 6865 6164 6572 2e0a 2020 2020 2020  m header..      
-00000950: 2020 2020 2020 5573 6520 6b65 7973 2061        Use keys a
-00000960: 7320 652e 672e 2027 3c69 7465 6d3e 3a3c  s e.g. '<item>:<
-00000970: 6b65 793e 3a2e 2e2e 272e 2043 616e 2062  key>:...'. Can b
-00000980: 6520 7573 6564 2066 6f72 2068 6561 6465  e used for heade
-00000990: 7220 6669 656c 6473 2061 7320 7765 6c6c  r fields as well
-000009a0: 2061 7320 6974 656d 2066 6965 6c64 732e   as item fields.
-000009b0: 0a20 2020 2020 2020 2020 2020 2049 7465  .            Ite
-000009c0: 6d20 696e 6465 7820 6361 6e20 6265 206c  m index can be l
-000009d0: 6567 6c65 6374 6564 2c20 696e 2063 6173  eglected, in cas
-000009e0: 6520 6f66 2076 6964 656f 2061 2064 6963  e of video a dic
-000009f0: 7420 7b3c 696d 6167 652d 6461 7461 7469  t {<image-datati
-00000a00: 6d65 3e3a 3c76 616c 7565 3e2c 2e2e 2e7d  me>:<value>,...}
-00000a10: 2069 7320 7265 7475 726e 6564 2e0a 2020   is returned..  
-00000a20: 2020 2020 2020 2020 2020 5261 6973 6573            Raises
-00000a30: 2049 6664 6f45 7863 6570 7469 6f6e 2069   IfdoException i
-00000a40: 6620 6974 656d 2064 6f65 7320 6e6f 7420  f item does not 
-00000a50: 6578 6973 742e 2022 2222 0a20 2020 2020  exist. """.     
-00000a60: 2020 206b 6579 7320 3d20 6b65 7973 2e73     keys = keys.s
-00000a70: 706c 6974 2827 3a27 290a 2020 2020 2020  plit(':').      
-00000a80: 2020 7265 7475 726e 2069 4644 4f2e 5f69    return iFDO._i
-00000a90: 4644 4f5f 5f67 6574 4669 656c 6456 616c  FDO__getFieldVal
-00000aa0: 7565 2873 656c 662e 6966 646f 2c6b 6579  ue(self.ifdo,key
-00000ab0: 7329 0a0a 0a20 2020 2064 6566 2067 6574  s)...    def get
-00000ac0: 496d 6167 6573 506f 7369 7469 6f6e 7328  ImagesPositions(
-00000ad0: 7365 6c66 2c69 6d61 6765 5f74 7970 6573  self,image_types
-00000ae0: 3d6d 6971 7476 2e69 6d61 6765 5f74 7970  =miqtv.image_typ
-00000af0: 6573 293a 0a20 2020 2020 2020 2022 2222  es):.        """
-00000b00: 2052 6574 7572 6e73 2069 6d61 6765 7320   Returns images 
-00000b10: 6669 7273 7420 706f 7369 7469 6f6e 2873  first position(s
-00000b20: 2920 0a20 2020 2020 2020 2020 2020 2040  ) .            @
-00000b30: 7265 7475 726e 3a20 7b27 696d 6167 654e  return: {'imageN
-00000b40: 616d 6527 3a20 5b7b 276c 6174 273a 2076  ame': [{'lat': v
-00000b50: 616c 7565 2c20 276c 6f6e 273a 2076 616c  alue, 'lon': val
-00000b60: 7565 2c20 2764 6174 6574 696d 6527 3a20  ue, 'datetime': 
-00000b70: 7661 6c75 657d 5d7d 2c20 696d 6167 652d  value}]}, image-
-00000b80: 636f 6f72 6469 6e61 7465 2d72 6566 6572  coordinate-refer
-00000b90: 656e 6365 2d73 7973 7465 6d20 2222 220a  ence-system """.
-00000ba0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00000bb0: 2072 6574 4469 6374 203d 207b 7d0a 2020   retDict = {}.  
-00000bc0: 2020 2020 2020 7265 7452 6566 7379 7320        retRefsys 
-00000bd0: 3d20 7365 6c66 2e69 6664 6f5b 6d69 7174  = self.ifdo[miqt
-00000be0: 762e 696d 6167 655f 7365 745f 6865 6164  v.image_set_head
-00000bf0: 6572 5f6b 6579 5d5b 2769 6d61 6765 2d63  er_key]['image-c
-00000c00: 6f6f 7264 696e 6174 652d 7265 6665 7265  oordinate-refere
-00000c10: 6e63 652d 7379 7374 656d 275d 0a0a 2020  nce-system']..  
-00000c20: 2020 2020 2020 6865 6164 6572 5661 6c4c        headerValL
-00000c30: 6174 203d 204e 6f6e 650a 2020 2020 2020  at = None.      
-00000c40: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00000c50: 2020 2068 6561 6465 7256 616c 4c61 7420     headerValLat 
-00000c60: 3d20 7365 6c66 2e69 6664 6f5b 6d69 7174  = self.ifdo[miqt
-00000c70: 762e 696d 6167 655f 7365 745f 6865 6164  v.image_set_head
-00000c80: 6572 5f6b 6579 5d5b 2769 6d61 6765 2d6c  er_key]['image-l
-00000c90: 6174 6974 7564 6527 5d0a 2020 2020 2020  atitude'].      
-00000ca0: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-00000cb0: 723a 0a20 2020 2020 2020 2020 2020 2070  r:.            p
-00000cc0: 6173 730a 0a20 2020 2020 2020 2068 6561  ass..        hea
-00000cd0: 6465 7256 616c 4c6f 6e20 3d20 4e6f 6e65  derValLon = None
-00000ce0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00000cf0: 2020 2020 2020 2020 2020 6865 6164 6572            header
-00000d00: 5661 6c4c 6f6e 203d 2073 656c 662e 6966  ValLon = self.if
-00000d10: 646f 5b6d 6971 7476 2e69 6d61 6765 5f73  do[miqtv.image_s
-00000d20: 6574 5f68 6561 6465 725f 6b65 795d 5b27  et_header_key]['
-00000d30: 696d 6167 652d 6c6f 6e67 6974 7564 6527  image-longitude'
-00000d40: 5d0a 2020 2020 2020 2020 6578 6365 7074  ].        except
-00000d50: 204b 6579 4572 726f 723a 0a20 2020 2020   KeyError:.     
-00000d60: 2020 2020 2020 2070 6173 730a 0a0a 2020         pass...  
-00000d70: 2020 2020 2020 666f 7220 6669 6c65 4e61        for fileNa
-00000d80: 6d65 2069 6e20 7365 6c66 2e69 6664 6f5b  me in self.ifdo[
-00000d90: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
-00000da0: 6974 656d 735f 6b65 795d 3a0a 2020 2020  items_key]:.    
-00000db0: 2020 2020 2020 2020 6966 2066 696c 654e          if fileN
-00000dc0: 616d 652e 7370 6c69 7428 272e 2729 5b2d  ame.split('.')[-
-00000dd0: 315d 2e6c 6f77 6572 2829 2069 6e20 696d  1].lower() in im
-00000de0: 6167 655f 7479 7065 733a 0a20 2020 2020  age_types:.     
-00000df0: 2020 2020 2020 2020 2020 2072 6574 4469             retDi
-00000e00: 6374 5b66 696c 654e 616d 655d 203d 2073  ct[fileName] = s
-00000e10: 656c 662e 5f5f 6765 7449 7465 6d4c 6174  elf.__getItemLat
-00000e20: 4c6f 6e28 6669 6c65 4e61 6d65 2c68 6561  Lon(fileName,hea
-00000e30: 6465 7256 616c 4c61 742c 6865 6164 6572  derValLat,header
-00000e40: 5661 6c4c 6f6e 290a 0a20 2020 2020 2020  ValLon)..       
-00000e50: 2072 6574 7572 6e20 7265 7444 6963 742c   return retDict,
-00000e60: 2072 6574 5265 6673 7973 0a0a 0a20 2020   retRefsys...   
-00000e70: 2064 6566 2077 7269 7465 576f 726c 6446   def writeWorldF
-00000e80: 696c 6573 466f 7250 686f 746f 7328 7365  ilesForPhotos(se
-00000e90: 6c66 2c64 6573 7444 6972 3a73 7472 2c69  lf,destDir:str,i
-00000ea0: 6d61 6765 536f 7572 6365 4469 723a 7374  mageSourceDir:st
-00000eb0: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
-00000ec0: 5772 6974 6573 2077 6f72 6c64 2066 696c  Writes world fil
-00000ed0: 6573 2066 6f72 2070 686f 746f 7320 6966  es for photos if
-00000ee0: 2061 6c6c 2072 6571 7569 7265 6420 6669   all required fi
-00000ef0: 656c 6473 2061 7265 2074 6865 7265 2075  elds are there u
-00000f00: 6e64 6572 2074 6865 2061 7373 756d 7074  nder the assumpt
-00000f10: 696f 6e20 7468 6174 2074 6865 2063 616d  ion that the cam
-00000f20: 6572 6120 7761 7320 6c6f 6f6b 696e 6720  era was looking 
-00000f30: 7374 7261 6967 6874 2064 6f77 6e20 2870  straight down (p
-00000f40: 6974 6368 2061 6e64 2072 6f6c 6c20 6172  itch and roll ar
-00000f50: 6520 6967 6e6f 7265 6421 292e 200a 2020  e ignored!). .  
-00000f60: 2020 2020 2020 2020 2020 5265 7475 726e            Return
-00000f70: 7320 6120 6c69 7374 206f 6620 6974 656d  s a list of item
-00000f80: 7320 666f 7220 7768 6963 6820 6372 6561  s for which crea
-00000f90: 7469 6f6e 2066 6169 6c65 643a 205b 5b69  tion failed: [[i
-00000fa0: 7465 6d2c 6d73 675d 2c2e 2e2e 5d22 2222  tem,msg],...]"""
-00000fb0: 0a0a 2020 2020 2020 2020 2320 544f 444f  ..        # TODO
-00000fc0: 2067 6574 2069 6d61 6765 7320 6f6e 6c69   get images onli
-00000fd0: 6e65 2066 726f 6d20 6272 6f6b 6572 0a0a  ne from broker..
-00000fe0: 2020 2020 2020 2020 6946 444f 6578 6365          iFDOexce
-00000ff0: 7074 696f 6e73 203d 205b 5d0a 0a20 2020  ptions = []..   
-00001000: 2020 2020 2023 2067 6574 2069 6d61 6765       # get image
-00001010: 7320 706f 7369 7469 6f6e 0a20 2020 2020  s position.     
-00001020: 2020 2070 6f73 6974 696f 6e73 4c61 744c     positionsLatL
-00001030: 6f6e 2c20 7265 6673 7973 203d 2073 656c  on, refsys = sel
-00001040: 662e 6765 7449 6d61 6765 7350 6f73 6974  f.getImagesPosit
-00001050: 696f 6e73 2869 6d61 6765 5f74 7970 6573  ions(image_types
-00001060: 3d6d 6971 7476 2e70 686f 746f 5f74 7970  =miqtv.photo_typ
-00001070: 6573 290a 2020 2020 2020 2020 6372 7346  es).        crsF
-00001080: 6965 6c64 546d 7020 3d20 2727 2e6a 6f69  ieldTmp = ''.joi
-00001090: 6e28 6520 666f 7220 6520 696e 2072 6566  n(e for e in ref
-000010a0: 7379 7320 6966 2065 2e69 7361 6c6e 756d  sys if e.isalnum
-000010b0: 2829 292e 6c6f 7765 7228 290a 2020 2020  ()).lower().    
-000010c0: 2020 2020 6966 2063 7273 4669 656c 6454      if crsFieldT
-000010d0: 6d70 203d 3d20 2777 6773 3834 2720 6f72  mp == 'wgs84' or
-000010e0: 2063 7273 4669 656c 6454 6d70 203d 3d20   crsFieldTmp == 
-000010f0: 2765 7073 6734 3332 3627 3a0a 2020 2020  'epsg4326':.    
-00001100: 2020 2020 2020 2020 7265 6673 7973 203d          refsys =
-00001110: 2022 5747 5338 3422 0a20 2020 2020 2020   "WGS84".       
-00001120: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00001130: 2020 2069 4644 4f65 7863 6570 7469 6f6e     iFDOexception
-00001140: 732e 6170 7065 6e64 285b 2222 2c22 436f  s.append(["","Co
-00001150: 6f72 6469 6e61 7465 7320 7265 6665 7265  ordinates refere
-00001160: 6e63 6520 7379 7374 656d 205c 2222 202b  nce system \"" +
-00001170: 2072 6566 7379 7320 2b20 225c 2220 6361   refsys + "\" ca
-00001180: 6e20 6e6f 7420 6265 2068 616e 646c 6564  n not be handled
-00001190: 2e20 5573 6520 7072 6566 6572 6162 6c79  . Use preferably
-000011a0: 2045 5053 473a 3433 3236 206f 7220 5747   EPSG:4326 or WG
-000011b0: 5338 3422 5d29 0a20 2020 2020 2020 2020  S84"]).         
-000011c0: 2020 2072 6574 7572 6e20 6946 444f 6578     return iFDOex
-000011d0: 6365 7074 696f 6e73 0a0a 0a20 2020 2020  ceptions...     
-000011e0: 2020 2066 6f72 2070 686f 746f 2069 6e20     for photo in 
-000011f0: 706f 7369 7469 6f6e 734c 6174 4c6f 6e3a  positionsLatLon:
-00001200: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-00001210: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00001220: 2020 7365 6c66 2e63 6865 636b 4974 656d    self.checkItem
-00001230: 4861 7368 2870 686f 746f 2c69 6d61 6765  Hash(photo,image
-00001240: 536f 7572 6365 4469 7229 2023 2054 4f44  SourceDir) # TOD
-00001250: 4f20 636f 756c 6420 6265 2069 6e20 6469  O could be in di
-00001260: 6666 6572 656e 7420 7375 6266 6f6c 6465  fferent subfolde
-00001270: 7220 6f72 2066 726f 6d20 6f6e 6c69 6e65  r or from online
-00001280: 2062 726f 6b65 720a 0a20 2020 2020 2020   broker..       
-00001290: 2020 2020 2020 2020 2023 2063 6f6e 7665           # conve
-000012a0: 7274 2074 6f20 7574 6d20 746f 2061 766f  rt to utm to avo
-000012b0: 6964 2070 7265 6369 7369 6f6e 2069 7373  id precision iss
-000012c0: 7565 2077 6974 6820 6c61 742f 6c6f 6e20  ue with lat/lon 
-000012d0: 7661 6c75 6573 2069 6e20 776f 726c 6420  values in world 
-000012e0: 6669 6c65 730a 2020 2020 2020 2020 2020  files.          
-000012f0: 2020 2020 2020 6c61 7420 3d20 706f 7369        lat = posi
-00001300: 7469 6f6e 734c 6174 4c6f 6e5b 7068 6f74  tionsLatLon[phot
-00001310: 6f5d 5b30 5d5b 276c 6174 275d 0a20 2020  o][0]['lat'].   
-00001320: 2020 2020 2020 2020 2020 2020 206c 6f6e               lon
-00001330: 203d 2070 6f73 6974 696f 6e73 4c61 744c   = positionsLatL
-00001340: 6f6e 5b70 686f 746f 5d5b 305d 5b27 6c6f  on[photo][0]['lo
-00001350: 6e27 5d0a 2020 2020 2020 2020 2020 2020  n'].            
-00001360: 2020 2020 6561 7374 696e 672c 6e6f 7274      easting,nort
-00001370: 6869 6e67 2c7a 6f6e 652c 6973 4e6f 7274  hing,zone,isNort
-00001380: 6820 3d20 6d69 7174 672e 6c61 744c 6f6e  h = miqtg.latLon
-00001390: 3275 746d 286c 6174 2c6c 6f6e 2c72 6566  2utm(lat,lon,ref
-000013a0: 7379 7329 0a20 2020 2020 2020 2020 2020  sys).           
-000013b0: 2020 2020 2065 7869 6620 3d20 7365 6c66       exif = self
-000013c0: 2e5f 5f67 6574 4974 656d 4465 6661 756c  .__getItemDefaul
-000013d0: 7456 616c 7565 2870 686f 746f 2c27 696d  tValue(photo,'im
-000013e0: 6167 652d 6163 7175 6973 6974 696f 6e2d  age-acquisition-
-000013f0: 7365 7474 696e 6773 2729 2023 2054 4f44  settings') # TOD
-00001400: 4f20 7768 6174 2069 6620 6e6f 7420 7468  O what if not th
-00001410: 6572 653f 2072 6561 6420 6672 6f6d 2069  ere? read from i
-00001420: 6d61 6765 2064 6972 6563 746c 793f 2053  mage directly? S
-00001430: 686f 756c 6420 6265 2063 6865 636b 6564  hould be checked
-00001440: 2069 6620 6861 7368 206d 6174 6368 6573   if hash matches
-00001450: 3f20 496d 6167 6520 636f 756c 6420 6861  ? Image could ha
-00001460: 7665 2062 6565 6e20 6372 6f70 7065 6420  ve been cropped 
-00001470: 6166 7465 7220 6946 444f 2063 7265 6174  after iFDO creat
-00001480: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-00001490: 2020 2020 696d 6167 6557 6964 7468 203d      imageWidth =
-000014a0: 2069 6e74 2873 7472 2865 7869 665b 2749   int(str(exif['I
-000014b0: 6d61 6765 2057 6964 7468 275d 292e 7374  mage Width']).st
-000014c0: 7269 7028 275c 2727 2929 0a20 2020 2020  rip('\'')).     
-000014d0: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-000014e0: 4865 6967 6874 203d 2069 6e74 2873 7472  Height = int(str
-000014f0: 2865 7869 665b 2749 6d61 6765 2048 6569  (exif['Image Hei
-00001500: 6768 7427 5d29 2e73 7472 6970 2827 5c27  ght']).strip('\'
-00001510: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
-00001520: 2020 2020 6865 6164 696e 6720 3d20 7365      heading = se
-00001530: 6c66 2e5f 5f67 6574 4974 656d 4465 6661  lf.__getItemDefa
-00001540: 756c 7456 616c 7565 2870 686f 746f 2c27  ultValue(photo,'
-00001550: 696d 6167 652d 6361 6d65 7261 2d79 6177  image-camera-yaw
-00001560: 2d64 6567 7265 6573 2729 0a20 2020 2020  -degrees').     
-00001570: 2020 2020 2020 2020 2020 2061 6c74 6974             altit
-00001580: 7564 6520 3d20 7365 6c66 2e5f 5f67 6574  ude = self.__get
-00001590: 4974 656d 4465 6661 756c 7456 616c 7565  ItemDefaultValue
-000015a0: 2870 686f 746f 2c27 696d 6167 652d 6d65  (photo,'image-me
-000015b0: 7465 7273 2d61 626f 7665 2d67 726f 756e  ters-above-groun
-000015c0: 6427 290a 0a20 2020 2020 2020 2020 2020  d')..           
-000015d0: 2020 2020 2064 6f6d 6550 6f72 742c 6d73       domePort,ms
-000015e0: 6720 3d20 7365 6c66 2e5f 5f74 7279 4765  g = self.__tryGe
-000015f0: 7449 7344 6f6d 6550 6f72 7428 7068 6f74  tIsDomePort(phot
-00001600: 6f29 0a20 2020 2020 2020 2020 2020 2020  o).             
-00001610: 2020 2066 6f63 616c 4c65 6e67 6850 6978     focalLenghPix
-00001620: 656c 732c 206d 7367 203d 2073 656c 662e  els, msg = self.
-00001630: 5f5f 7472 7947 6574 466f 6361 6c4c 656e  __tryGetFocalLen
-00001640: 6774 6849 6e50 6978 656c 7328 7068 6f74  gthInPixels(phot
-00001650: 6f2c 2064 6f6d 6550 6f72 7429 0a20 2020  o, domePort).   
-00001660: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00001670: 666f 6361 6c4c 656e 6768 5069 7865 6c73  focalLenghPixels
-00001680: 203d 3d20 5b2d 312c 2d31 5d20 6f72 2066   == [-1,-1] or f
-00001690: 6f63 616c 4c65 6e67 6850 6978 656c 7320  ocalLenghPixels 
-000016a0: 3d3d 202d 313a 0a20 2020 2020 2020 2020  == -1:.         
-000016b0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000016c0: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
-000016d0: 7469 6f6e 286d 7367 290a 2020 2020 2020  tion(msg).      
-000016e0: 2020 2020 2020 2020 2020 6d69 7174 672e            miqtg.
-000016f0: 7772 6974 6553 696d 706c 6555 746d 576f  writeSimpleUtmWo
-00001700: 726c 6446 696c 6528 6f73 2e70 6174 682e  rldFile(os.path.
-00001710: 6a6f 696e 2864 6573 7444 6972 2c6d 6971  join(destDir,miq
-00001720: 7467 2e63 6f6e 7665 7274 496d 6167 654e  tg.convertImageN
-00001730: 616d 6554 6f57 6f72 6c64 4669 6c65 4e61  ameToWorldFileNa
-00001740: 6d65 2870 686f 746f 2929 2c65 6173 7469  me(photo)),easti
-00001750: 6e67 2c6e 6f72 7468 696e 672c 7a6f 6e65  ng,northing,zone
-00001760: 2c69 734e 6f72 7468 2c69 6d61 6765 5769  ,isNorth,imageWi
-00001770: 6474 682c 696d 6167 6548 6569 6768 742c  dth,imageHeight,
-00001780: 6865 6164 696e 672c 616c 7469 7475 6465  heading,altitude
-00001790: 2c66 6f63 616c 4c65 6e67 6850 6978 656c  ,focalLenghPixel
-000017a0: 735b 305d 2c66 6f63 616c 4c65 6e67 6850  s[0],focalLenghP
-000017b0: 6978 656c 735b 315d 290a 2020 2020 2020  ixels[1]).      
-000017c0: 2020 2020 2020 6578 6365 7074 206d 6971        except miq
-000017d0: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-000017e0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-000017f0: 2020 2020 2020 2069 4644 4f65 7863 6570         iFDOexcep
-00001800: 7469 6f6e 732e 6170 7065 6e64 285b 7068  tions.append([ph
-00001810: 6f74 6f2c 7374 7228 652e 6172 6773 295d  oto,str(e.args)]
-00001820: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00001830: 6e20 6946 444f 6578 6365 7074 696f 6e73  n iFDOexceptions
-00001840: 0a0a 0a20 2020 2064 6566 2063 6865 636b  ...    def check
-00001850: 4974 656d 4861 7368 2873 656c 662c 6974  ItemHash(self,it
-00001860: 656d 3a73 7472 2c66 696c 6544 6972 3a73  em:str,fileDir:s
-00001870: 7472 293a 0a20 2020 2020 2020 2022 2222  tr):.        """
-00001880: 2063 6f6d 7061 7265 7320 6669 6c65 2773   compares file's
-00001890: 2068 6173 6820 7769 7468 2068 6173 6820   hash with hash 
-000018a0: 696e 2069 4644 4f20 616e 6420 7468 726f  in iFDO and thro
-000018b0: 7773 2065 7863 6570 7469 6f6e 2069 6620  ws exception if 
-000018c0: 7468 6579 2064 6f6e 2774 206d 6174 6368  they don't match
-000018d0: 2022 2222 0a0a 2020 2020 2020 2020 6669   """..        fi
-000018e0: 6c65 203d 206f 732e 7061 7468 2e6a 6f69  le = os.path.joi
-000018f0: 6e28 6669 6c65 4469 722c 6974 656d 290a  n(fileDir,item).
-00001900: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-00001910: 732e 7061 7468 2e69 7366 696c 6528 6669  s.path.isfile(fi
-00001920: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
-00001930: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
-00001940: 6f45 7863 6570 7469 6f6e 2822 4669 6c65  oException("File
-00001950: 205c 2222 202b 2069 7465 6d20 2b20 225c   \"" + item + "\
-00001960: 2220 6e6f 7420 666f 756e 6420 696e 2064  " not found in d
-00001970: 6972 205c 2222 202b 2066 696c 6544 6972  ir \"" + fileDir
-00001980: 202b 2022 5c22 2229 0a0a 2020 2020 2020   + "\"")..      
-00001990: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-000019a0: 7365 6c66 2e69 6664 6f5b 6d69 7174 762e  self.ifdo[miqtv.
-000019b0: 696d 6167 655f 7365 745f 6974 656d 735f  image_set_items_
-000019c0: 6b65 795d 5b69 7465 6d5d 2c6c 6973 7429  key][item],list)
-000019d0: 3a20 2320 696e 2063 6173 6520 6f66 2076  : # in case of v
-000019e0: 6964 656f 2077 6974 6820 6974 656d 2061  ideo with item a
-000019f0: 7320 6c69 7374 2074 6865 2066 6972 7374  s list the first
-00001a00: 2065 6e74 7279 2068 6f6c 6473 2074 6865   entry holds the
-00001a10: 2064 6566 6175 6c74 2061 6e64 2074 6865   default and the
-00001a20: 2068 6173 6820 6361 6e6e 6f74 2076 6172   hash cannot var
-00001a30: 7920 666f 7220 7468 6520 7361 6d65 2069  y for the same i
-00001a40: 6d61 6765 0a20 2020 2020 2020 2020 2020  mage.           
-00001a50: 2069 7465 6d45 6e74 7279 203d 2073 656c   itemEntry = sel
-00001a60: 662e 6966 646f 5b6d 6971 7476 2e69 6d61  f.ifdo[miqtv.ima
-00001a70: 6765 5f73 6574 5f69 7465 6d73 5f6b 6579  ge_set_items_key
-00001a80: 5d5b 6974 656d 5d5b 305d 200a 2020 2020  ][item][0] .    
-00001a90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00001aa0: 2020 2020 2020 6974 656d 456e 7472 7920        itemEntry 
-00001ab0: 3d20 7365 6c66 2e69 6664 6f5b 6d69 7174  = self.ifdo[miqt
-00001ac0: 762e 696d 6167 655f 7365 745f 6974 656d  v.image_set_item
-00001ad0: 735f 6b65 795d 5b69 7465 6d5d 0a20 2020  s_key][item].   
-00001ae0: 2020 2020 2069 6620 6e6f 7420 6974 656d       if not item
-00001af0: 456e 7472 795b 2769 6d61 6765 2d68 6173  Entry['image-has
-00001b00: 682d 7368 6132 3536 275d 203d 3d20 6d69  h-sha256'] == mi
-00001b10: 7174 632e 7368 6132 3536 4861 7368 4669  qtc.sha256HashFi
-00001b20: 6c65 2866 696c 6529 3a0a 2020 2020 2020  le(file):.      
-00001b30: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
-00001b40: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
-00001b50: 6974 656d 2c20 2269 4644 4f20 656e 7472  item, "iFDO entr
-00001b60: 7920 6973 206e 6f74 2075 7020 746f 2064  y is not up to d
-00001b70: 6174 652c 2069 6d61 6765 2068 6173 6820  ate, image hash 
-00001b80: 646f 6573 206e 6f74 206d 6174 6368 2e22  does not match."
-00001b90: 290a 0a20 2020 2064 6566 2067 6574 496d  )..    def getIm
-00001ba0: 6167 6544 6972 6563 746f 7279 2873 656c  ageDirectory(sel
-00001bb0: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
-00001bc0: 5265 7475 726e 7320 7468 6520 6c6f 7765  Returns the lowe
-00001bd0: 726d 6f73 7420 6c6f 6361 6c20 6469 7265  rmost local dire
-00001be0: 6374 6f72 7920 636f 6e74 6169 6e69 6e67  ctory containing
-00001bf0: 2074 6865 2069 6d61 6765 2066 696c 6573   the image files
-00001c00: 2069 6e66 6572 7265 6420 6672 6f6d 2027   inferred from '
-00001c10: 696d 6167 652d 7365 742d 6c6f 6361 6c2d  image-set-local-
-00001c20: 7061 7468 272e 2049 6620 2769 6d61 6765  path'. If 'image
-00001c30: 2d73 6574 2d6c 6f63 616c 2d70 6174 6827  -set-local-path'
-00001c40: 206e 6f74 2070 726f 7669 6465 6420 666f   not provided fo
-00001c50: 7220 616c 6c20 696d 6167 6520 6974 656d  r all image item
-00001c60: 7320 7468 6520 6946 444f 2773 2070 6172  s the iFDO's par
-00001c70: 656e 7420 6469 7265 6374 6f72 7920 6973  ent directory is
-00001c80: 2072 6574 7572 6e65 642e 2022 2222 0a20   returned. """. 
-00001c90: 2020 2020 2020 206c 6f63 616c 5061 7468         localPath
-00001ca0: 7320 3d20 5b5d 0a20 2020 2020 2020 2069  s = [].        i
-00001cb0: 4644 4f46 696c 6550 6172 656e 7444 6972  FDOFileParentDir
-00001cc0: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
-00001cd0: 6d65 286f 732e 7061 7468 2e64 6972 6e61  me(os.path.dirna
-00001ce0: 6d65 2873 656c 662e 6946 444f 6669 6c65  me(self.iFDOfile
-00001cf0: 2929 0a20 2020 2020 2020 2066 6f72 2069  )).        for i
-00001d00: 7465 6d20 696e 2073 656c 662e 6966 646f  tem in self.ifdo
-00001d10: 5b6d 6971 7476 2e69 6d61 6765 5f73 6574  [miqtv.image_set
-00001d20: 5f69 7465 6d73 5f6b 6579 5d3a 0a20 2020  _items_key]:.   
-00001d30: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00001d40: 2020 2020 2020 2020 2020 2020 2020 6974                it
-00001d50: 656d 4c6f 6361 6c50 6174 6820 3d20 7365  emLocalPath = se
-00001d60: 6c66 2e5f 5f67 6574 4974 656d 4465 6661  lf.__getItemDefa
-00001d70: 756c 7456 616c 7565 2869 7465 6d2c 2769  ultValue(item,'i
-00001d80: 6d61 6765 2d73 6574 2d6c 6f63 616c 2d70  mage-set-local-p
-00001d90: 6174 6827 290a 2020 2020 2020 2020 2020  ath').          
-00001da0: 2020 6578 6365 7074 206d 6971 7463 2e49    except miqtc.I
-00001db0: 6664 6f45 7863 6570 7469 6f6e 3a0a 2020  fdoException:.  
-00001dc0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00001dd0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00001de0: 2020 2020 2020 2069 7465 6d4c 6f63 616c         itemLocal
-00001df0: 5061 7468 203d 2073 656c 662e 5f5f 6765  Path = self.__ge
-00001e00: 7449 7465 6d44 6566 6175 6c74 5661 6c75  tItemDefaultValu
-00001e10: 6528 6974 656d 2c27 696d 6167 652d 6c6f  e(item,'image-lo
-00001e20: 6361 6c2d 7061 7468 2729 2023 2062 6163  cal-path') # bac
-00001e30: 6b77 6172 6473 2063 6f6d 7061 7469 6269  kwards compatibi
-00001e40: 6c69 7479 0a20 2020 2020 2020 2020 2020  lity.           
-00001e50: 2020 2020 2065 7863 6570 7420 6d69 7174       except miqt
-00001e60: 632e 4966 646f 4578 6365 7074 696f 6e3a  c.IfdoException:
-00001e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001e80: 2020 2020 2069 7465 6d4c 6f63 616c 5061       itemLocalPa
-00001e90: 7468 203d 2069 4644 4f46 696c 6550 6172  th = iFDOFilePar
-00001ea0: 656e 7444 6972 0a20 2020 2020 2020 2020  entDir.         
-00001eb0: 2020 2069 6620 6974 656d 4c6f 6361 6c50     if itemLocalP
-00001ec0: 6174 6820 6e6f 7420 696e 206c 6f63 616c  ath not in local
-00001ed0: 5061 7468 733a 0a20 2020 2020 2020 2020  Paths:.         
-00001ee0: 2020 2020 2020 206c 6f63 616c 5061 7468         localPath
-00001ef0: 732e 6170 7065 6e64 2869 7465 6d4c 6f63  s.append(itemLoc
-00001f00: 616c 5061 7468 290a 2020 2020 2020 2020  alPath).        
-00001f10: 636f 6d6d 6f6e 5061 7468 203d 206f 732e  commonPath = os.
-00001f20: 7061 7468 2e63 6f6d 6d6f 6e70 6174 6828  path.commonpath(
-00001f30: 6c6f 6361 6c50 6174 6873 290a 2020 2020  localPaths).    
-00001f40: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-00001f50: 7468 2e69 7361 6273 2863 6f6d 6d6f 6e50  th.isabs(commonP
-00001f60: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
-00001f70: 2020 636f 6d6d 6f6e 5061 7468 203d 206f    commonPath = o
-00001f80: 732e 7061 7468 2e6e 6f72 6d70 6174 6828  s.path.normpath(
-00001f90: 6f73 2e70 6174 682e 6a6f 696e 286f 732e  os.path.join(os.
-00001fa0: 7061 7468 2e64 6972 6e61 6d65 2873 656c  path.dirname(sel
-00001fb0: 662e 6946 444f 6669 6c65 292c 2063 6f6d  f.iFDOfile), com
-00001fc0: 6d6f 6e50 6174 6829 290a 2020 2020 2020  monPath)).      
-00001fd0: 2020 7265 7475 726e 2063 6f6d 6d6f 6e50    return commonP
-00001fe0: 6174 680a 0a0a 2020 2020 6465 6620 5f5f  ath...    def __
-00001ff0: 7472 7947 6574 4973 446f 6d65 506f 7274  tryGetIsDomePort
-00002000: 2873 656c 662c 6974 656d 293a 0a20 2020  (self,item):.   
-00002010: 2020 2020 2022 2222 2054 7269 6573 2074       """ Tries t
-00002020: 6f20 7265 6164 2070 6f72 7420 7479 7065  o read port type
-00002030: 2066 726f 6d20 2769 6d61 6765 2d63 616d   from 'image-cam
-00002040: 6572 612d 686f 7573 696e 672d 7669 6577  era-housing-view
-00002050: 706f 7274 275b 7669 6577 706f 7274 2d74  port'[viewport-t
-00002060: 7970 655d 206f 7220 2769 6d61 6765 2d66  ype] or 'image-f
-00002070: 6c61 7470 6f72 742d 7061 7261 6d65 7465  latport-paramete
-00002080: 7273 272f 2769 6d61 6765 2d64 6f6d 6570  rs'/'image-domep
-00002090: 6f72 742d 7061 7261 6d65 7465 7273 2720  ort-parameters' 
-000020a0: 0a20 2020 2020 2020 2020 2020 2052 6574  .            Ret
-000020b0: 7572 6e73 2054 7275 652c 6d73 6720 6966  urns True,msg if
-000020c0: 2064 6f6d 6520 706f 7274 2c20 4661 6c73   dome port, Fals
-000020d0: 652c 6d73 6720 6966 2066 6c61 7420 706f  e,msg if flat po
-000020e0: 7274 2c20 4e6f 6e65 2c6d 7367 206f 7468  rt, None,msg oth
-000020f0: 6572 7769 7365 2022 2222 0a0a 2020 2020  erwise """..    
-00002100: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00002110: 2020 2020 2070 6f72 7454 7970 6553 7472       portTypeStr
-00002120: 203d 2073 656c 662e 5f5f 6765 7449 7465   = self.__getIte
-00002130: 6d44 6566 6175 6c74 5661 6c75 6528 6974  mDefaultValue(it
-00002140: 656d 2c27 696d 6167 652d 6361 6d65 7261  em,'image-camera
-00002150: 2d68 6f75 7369 6e67 2d76 6965 7770 6f72  -housing-viewpor
-00002160: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
-00002170: 706f 7274 5479 7065 5374 7220 3d20 706f  portTypeStr = po
-00002180: 7274 5479 7065 5374 725b 2776 6965 7770  rtTypeStr['viewp
-00002190: 6f72 742d 7479 7065 275d 0a20 2020 2020  ort-type'].     
-000021a0: 2020 2020 2020 2069 6620 2764 6f6d 6527         if 'dome'
-000021b0: 2069 6e20 706f 7274 5479 7065 5374 722e   in portTypeStr.
-000021c0: 6c6f 7765 7228 2920 616e 6420 6e6f 7420  lower() and not 
-000021d0: 2766 6c61 7427 2069 6e20 706f 7274 5479  'flat' in portTy
-000021e0: 7065 5374 722e 6c6f 7765 7228 293a 0a20  peStr.lower():. 
-000021f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00002200: 6574 7572 6e20 5472 7565 2c22 5061 7273  eturn True,"Pars
-00002210: 6564 2066 726f 6d20 2769 6d61 6765 2d63  ed from 'image-c
-00002220: 616d 6572 612d 686f 7573 696e 672d 7669  amera-housing-vi
-00002230: 6577 706f 7274 275b 2776 6965 7770 6f72  ewport'['viewpor
-00002240: 742d 7479 7065 275d 220a 2020 2020 2020  t-type']".      
-00002250: 2020 2020 2020 656c 6966 206e 6f74 2027        elif not '
-00002260: 646f 6d65 2720 696e 2070 6f72 7454 7970  dome' in portTyp
-00002270: 6553 7472 2e6c 6f77 6572 2829 2061 6e64  eStr.lower() and
-00002280: 2027 666c 6174 2720 696e 2070 6f72 7454   'flat' in portT
-00002290: 7970 6553 7472 2e6c 6f77 6572 2829 3a0a  ypeStr.lower():.
-000022a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000022b0: 7265 7475 726e 2046 616c 7365 2c22 5061  return False,"Pa
-000022c0: 7273 6564 2066 726f 6d20 2769 6d61 6765  rsed from 'image
-000022d0: 2d63 616d 6572 612d 686f 7573 696e 672d  -camera-housing-
-000022e0: 7669 6577 706f 7274 275b 2776 6965 7770  viewport'['viewp
-000022f0: 6f72 742d 7479 7065 275d 220a 2020 2020  ort-type']".    
-00002300: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00002310: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00002320: 7475 726e 204e 6f6e 652c 2243 6f75 6c64  turn None,"Could
-00002330: 206e 6f74 2072 6561 6420 706f 7274 2074   not read port t
-00002340: 7970 6520 6672 6f6d 2027 696d 6167 652d  ype from 'image-
-00002350: 6361 6d65 7261 2d68 6f75 7369 6e67 2d76  camera-housing-v
-00002360: 6965 7770 6f72 7427 5b27 7669 6577 706f  iewport'['viewpo
-00002370: 7274 2d74 7970 6527 5d20 696e 2069 7465  rt-type'] in ite
-00002380: 6d3a 2022 202b 2069 7465 6d0a 2020 2020  m: " + item.    
-00002390: 2020 2020 6578 6365 7074 2028 6d69 7174      except (miqt
-000023a0: 632e 4966 646f 4578 6365 7074 696f 6e2c  c.IfdoException,
-000023b0: 204b 6579 4572 726f 7229 3a0a 2020 2020   KeyError):.    
-000023c0: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
-000023d0: 2020 2020 2020 666c 6174 506f 7274 5061        flatPortPa
-000023e0: 7261 6d73 466f 756e 6420 3d20 4661 6c73  ramsFound = Fals
-000023f0: 650a 2020 2020 2020 2020 7472 793a 200a  e.        try: .
-00002400: 2020 2020 2020 2020 2020 2020 666c 6174              flat
-00002410: 506f 7274 5061 7261 6d73 203d 2073 656c  PortParams = sel
-00002420: 662e 5f5f 6765 7449 7465 6d44 6566 6175  f.__getItemDefau
-00002430: 6c74 5661 6c75 6528 6974 656d 2c27 696d  ltValue(item,'im
-00002440: 6167 652d 666c 6174 706f 7274 2d70 6172  age-flatport-par
-00002450: 616d 6574 6572 7327 290a 2020 2020 2020  ameters').      
-00002460: 2020 2020 2020 666c 6174 506f 7274 5061        flatPortPa
-00002470: 7261 6d73 466f 756e 6420 3d20 5472 7565  ramsFound = True
-00002480: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00002490: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-000024a0: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-000024b0: 2070 6173 730a 2020 2020 2020 2020 646f   pass.        do
-000024c0: 6d65 506f 7274 5061 7261 6d73 466f 756e  mePortParamsFoun
-000024d0: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
-000024e0: 2020 7472 793a 200a 2020 2020 2020 2020    try: .        
-000024f0: 2020 2020 646f 6d65 506f 7274 5061 7261      domePortPara
-00002500: 6d73 203d 2073 656c 662e 5f5f 6765 7449  ms = self.__getI
-00002510: 7465 6d44 6566 6175 6c74 5661 6c75 6528  temDefaultValue(
-00002520: 6974 656d 2c27 696d 6167 652d 646f 6d65  item,'image-dome
-00002530: 706f 7274 2d70 6172 616d 6574 6572 7327  port-parameters'
-00002540: 290a 2020 2020 2020 2020 2020 2020 646f  ).            do
-00002550: 6d65 506f 7274 5061 7261 6d73 466f 756e  mePortParamsFoun
-00002560: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
-00002570: 2065 7863 6570 7420 6d69 7174 632e 4966   except miqtc.If
-00002580: 646f 4578 6365 7074 696f 6e3a 0a20 2020  doException:.   
-00002590: 2020 2020 2020 2020 2070 6173 730a 0a20           pass.. 
-000025a0: 2020 2020 2020 2069 6620 666c 6174 506f         if flatPo
-000025b0: 7274 5061 7261 6d73 466f 756e 6420 616e  rtParamsFound an
-000025c0: 6420 646f 6d65 506f 7274 5061 7261 6d73  d domePortParams
-000025d0: 466f 756e 643a 0a20 2020 2020 2020 2020  Found:.         
-000025e0: 2020 2072 6574 7572 6e20 4e6f 6e65 2c22     return None,"
-000025f0: 436f 756c 6420 6e6f 7420 7265 6164 2070  Could not read p
-00002600: 6f72 7420 7479 7065 2066 726f 6d20 6974  ort type from it
-00002610: 656d 2061 7320 6974 2063 6f6e 7461 696e  em as it contain
-00002620: 7320 696e 666f 206f 6e20 626f 7468 2066  s info on both f
-00002630: 6c61 7420 616e 6420 646f 6d65 2070 6f72  lat and dome por
-00002640: 743a 2022 202b 2069 7465 6d0a 2020 2020  t: " + item.    
-00002650: 2020 2020 6966 2066 6c61 7450 6f72 7450      if flatPortP
-00002660: 6172 616d 7346 6f75 6e64 3a0a 2020 2020  aramsFound:.    
-00002670: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00002680: 616c 7365 2c22 4173 7375 6d65 6420 6173  alse,"Assumed as
-00002690: 2066 6c61 7420 706f 7274 2061 7320 2769   flat port as 'i
-000026a0: 6d61 6765 2d66 6c61 7470 6f72 742d 7061  mage-flatport-pa
-000026b0: 7261 6d65 7465 7273 2720 666f 756e 6420  rameters' found 
-000026c0: 696e 2069 7465 6d3a 2022 202b 2069 7465  in item: " + ite
-000026d0: 6d0a 2020 2020 2020 2020 6966 2064 6f6d  m.        if dom
-000026e0: 6550 6f72 7450 6172 616d 7346 6f75 6e64  ePortParamsFound
-000026f0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00002700: 7475 726e 2054 7275 652c 2241 7373 756d  turn True,"Assum
-00002710: 6564 2061 7320 646f 6d65 2070 6f72 7420  ed as dome port 
-00002720: 6173 2027 696d 6167 652d 646f 6d65 706f  as 'image-domepo
-00002730: 7274 2d70 6172 616d 6574 6572 7327 2066  rt-parameters' f
-00002740: 6f75 6e64 2069 6e20 6974 656d 3a20 2220  ound in item: " 
-00002750: 2b20 6974 656d 0a20 2020 2020 2020 2072  + item.        r
-00002760: 6574 7572 6e20 4e6f 6e65 2c22 436f 756c  eturn None,"Coul
-00002770: 6420 6e6f 7420 7265 6164 2070 6f72 7420  d not read port 
-00002780: 7479 7065 2066 726f 6d20 6974 656d 3a20  type from item: 
-00002790: 2220 2b20 6974 656d 0a0a 0a20 2020 2064  " + item...    d
-000027a0: 6566 205f 5f74 7279 4765 7446 6f63 616c  ef __tryGetFocal
-000027b0: 4c65 6e67 7468 496e 5069 7865 6c73 2873  LengthInPixels(s
-000027c0: 656c 662c 6974 656d 3a73 7472 2c64 6f6d  elf,item:str,dom
-000027d0: 6550 6f72 743d 4e6f 6e65 293a 0a20 2020  ePort=None):.   
-000027e0: 2020 2020 2022 2222 200a 2020 2020 2020       """ .      
-000027f0: 2020 5472 6965 7320 746f 2072 6561 642f    Tries to read/
-00002800: 6465 7465 726d 696e 6520 666f 6361 6c20  determine focal 
-00002810: 6c65 6e67 7468 2069 6e20 7069 7865 6c73  length in pixels
-00002820: 2065 6974 6865 7220 6672 6f6d 2027 696d   either from 'im
-00002830: 6167 652d 6361 6d65 7261 2d63 616c 6962  age-camera-calib
-00002840: 7261 7469 6f6e 2d6d 6f64 656c 275b 2763  ration-model'['c
-00002850: 616c 6962 7261 7469 6f6e 2d66 6f63 616c  alibration-focal
-00002860: 2d6c 656e 6774 682d 7879 2d70 6978 656c  -length-xy-pixel
-00002870: 275d 206f 7220 6672 6f6d 2065 7869 6620  '] or from exif 
-00002880: 7661 6c75 6573 2e0a 2020 2020 2020 2020  values..        
-00002890: 6966 2064 6f6d 6550 6f72 7420 3d20 4661  if domePort = Fa
-000028a0: 6c73 652c 2066 6c61 7420 706f 7274 2069  lse, flat port i
-000028b0: 7320 6173 7375 6d65 6420 616e 6420 6120  s assumed and a 
-000028c0: 636f 7272 6563 7469 6f6e 2066 6163 746f  correction facto
-000028d0: 7220 6f66 2031 2e33 3320 6973 2061 7070  r of 1.33 is app
-000028e0: 6c69 6564 2066 6f72 2066 6f63 616c 206c  lied for focal l
-000028f0: 656e 6774 6820 6465 7465 726d 696e 6564  ength determined
-00002900: 2066 726f 6d20 6578 6966 2076 616c 7565   from exif value
-00002910: 730a 2020 2020 2020 2020 5265 7475 726e  s.        Return
-00002920: 7320 6569 7468 6572 2066 6f63 616c 4c65  s either focalLe
-00002930: 6e67 7468 2c20 6d65 7373 6167 6520 6f72  ngth, message or
-00002940: 205b 666f 6361 6c4c 656e 6774 6858 2c66   [focalLengthX,f
-00002950: 6f63 616c 4c65 6e67 7468 595d 2c20 6d65  ocalLengthY], me
-00002960: 7373 6167 652e 2049 6620 756e 7375 6363  ssage. If unsucc
-00002970: 6573 7366 756c 2066 6f63 616c 4c65 6e67  essful focalLeng
-00002980: 7468 203d 202d 310a 2020 2020 2020 2020  th = -1.        
-00002990: 2222 220a 0a20 2020 2020 2020 2023 2074  """..        # t
-000029a0: 7279 2072 6561 6420 6672 6f6d 2027 696d  ry read from 'im
-000029b0: 6167 652d 6361 6d65 7261 2d63 616c 6962  age-camera-calib
-000029c0: 7261 7469 6f6e 2d6d 6f64 656c 275b 2763  ration-model'['c
-000029d0: 616c 6962 7261 7469 6f6e 2d66 6f63 616c  alibration-focal
-000029e0: 2d6c 656e 6774 682d 7879 2d70 6978 656c  -length-xy-pixel
-000029f0: 275d 0a20 2020 2020 2020 2074 7279 3a0a  '].        try:.
-00002a00: 2020 2020 2020 2020 2020 2020 666f 6361              foca
-00002a10: 6c4c 656e 6774 6858 5920 3d20 7365 6c66  lLengthXY = self
-00002a20: 2e5f 5f67 6574 4974 656d 4465 6661 756c  .__getItemDefaul
-00002a30: 7456 616c 7565 2869 7465 6d2c 2769 6d61  tValue(item,'ima
-00002a40: 6765 2d63 616d 6572 612d 6361 6c69 6272  ge-camera-calibr
-00002a50: 6174 696f 6e2d 6d6f 6465 6c27 290a 2020  ation-model').  
-00002a60: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00002a70: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00002a80: 6f63 616c 4c65 6e67 7468 5859 203d 2066  ocalLengthXY = f
-00002a90: 6f63 616c 4c65 6e67 7468 5859 5b27 6361  ocalLengthXY['ca
-00002aa0: 6c69 6272 6174 696f 6e2d 666f 6361 6c2d  libration-focal-
-00002ab0: 6c65 6e67 7468 2d78 792d 7069 7865 6c27  length-xy-pixel'
-00002ac0: 5d0a 2020 2020 2020 2020 2020 2020 6578  ].            ex
-00002ad0: 6365 7074 204b 6579 4572 726f 723a 0a20  cept KeyError:. 
-00002ae0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00002af0: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
-00002b00: 7863 6570 7469 6f6e 2869 7465 6d2c 2264  xception(item,"d
-00002b10: 6f65 7320 6e6f 7420 636f 6e74 6169 6e20  oes not contain 
-00002b20: 2769 6d61 6765 2d63 616d 6572 612d 6361  'image-camera-ca
-00002b30: 6c69 6272 6174 696f 6e2d 6d6f 6465 6c27  libration-model'
-00002b40: 5b27 6361 6c69 6272 6174 696f 6e2d 666f  ['calibration-fo
-00002b50: 6361 6c2d 6c65 6e67 7468 2d78 792d 7069  cal-length-xy-pi
-00002b60: 7865 6c27 5d22 290a 0a20 2020 2020 2020  xel']")..       
-00002b70: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-00002b80: 7374 616e 6365 2866 6f63 616c 4c65 6e67  stance(focalLeng
-00002b90: 7468 5859 2c6c 6973 7429 3a20 2320 7820  thXY,list): # x 
-00002ba0: 616e 6420 7920 7661 6c75 6520 6172 6520  and y value are 
-00002bb0: 6964 656e 7469 6361 6c0a 2020 2020 2020  identical.      
-00002bc0: 2020 2020 2020 2020 2020 666f 6361 6c4c            focalL
-00002bd0: 656e 6774 6858 5920 3d20 5b66 6f63 616c  engthXY = [focal
-00002be0: 4c65 6e67 7468 5859 2c66 6f63 616c 4c65  LengthXY,focalLe
-00002bf0: 6e67 7468 5859 5d0a 2020 2020 2020 2020  ngthXY].        
-00002c00: 2020 2020 6966 206c 656e 2866 6f63 616c      if len(focal
-00002c10: 4c65 6e67 7468 5859 2920 213d 2032 3a0a  LengthXY) != 2:.
-00002c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002c30: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
-00002c40: 4578 6365 7074 696f 6e28 6974 656d 2c22  Exception(item,"
-00002c50: 496e 7661 6c69 6420 656e 7472 7920 666f  Invalid entry fo
-00002c60: 7220 2769 6d61 6765 2d63 616d 6572 612d  r 'image-camera-
-00002c70: 6361 6c69 6272 6174 696f 6e2d 6d6f 6465  calibration-mode
-00002c80: 6c27 5b27 6361 6c69 6272 6174 696f 6e2d  l'['calibration-
-00002c90: 666f 6361 6c2d 6c65 6e67 7468 2d78 792d  focal-length-xy-
-00002ca0: 7069 7865 6c27 5d20 3a20 2220 2b20 7374  pixel'] : " + st
-00002cb0: 7228 666f 6361 6c4c 656e 6774 6858 5929  r(focalLengthXY)
-00002cc0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-00002cd0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-00002ce0: 6528 666f 6361 6c4c 656e 6774 6858 595b  e(focalLengthXY[
-00002cf0: 305d 2c66 6c6f 6174 2920 6f72 206e 6f74  0],float) or not
-00002d00: 2069 7369 6e73 7461 6e63 6528 666f 6361   isinstance(foca
-00002d10: 6c4c 656e 6774 6858 595b 305d 2c69 6e74  lLengthXY[0],int
-00002d20: 2920 6f72 206e 6f74 2069 7369 6e73 7461  ) or not isinsta
-00002d30: 6e63 6528 666f 6361 6c4c 656e 6774 6858  nce(focalLengthX
-00002d40: 595b 315d 2c66 6c6f 6174 2920 6f72 206e  Y[1],float) or n
-00002d50: 6f74 2069 7369 6e73 7461 6e63 6528 666f  ot isinstance(fo
-00002d60: 6361 6c4c 656e 6774 6858 595b 315d 2c69  calLengthXY[1],i
-00002d70: 6e74 293a 0a20 2020 2020 2020 2020 2020  nt):.           
-00002d80: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00002d90: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00002da0: 6361 6c4c 656e 6774 6858 5920 3d20 5b66  calLengthXY = [f
-00002db0: 6c6f 6174 2866 6f63 616c 4c65 6e67 7468  loat(focalLength
-00002dc0: 5859 5b30 5d29 2c66 6c6f 6174 2866 6f63  XY[0]),float(foc
-00002dd0: 616c 4c65 6e67 7468 5859 5b31 5d29 5d0a  alLengthXY[1])].
-00002de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002df0: 6578 6365 7074 2056 616c 7565 4572 726f  except ValueErro
-00002e00: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00002e10: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-00002e20: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-00002e30: 2869 7465 6d2c 2249 6e76 616c 6964 2065  (item,"Invalid e
-00002e40: 6e74 7279 2066 6f72 2027 696d 6167 652d  ntry for 'image-
-00002e50: 6361 6d65 7261 2d63 616c 6962 7261 7469  camera-calibrati
-00002e60: 6f6e 2d6d 6f64 656c 275b 2763 616c 6962  on-model'['calib
-00002e70: 7261 7469 6f6e 2d66 6f63 616c 2d6c 656e  ration-focal-len
-00002e80: 6774 682d 7879 2d70 6978 656c 275d 203a  gth-xy-pixel'] :
-00002e90: 2022 202b 2073 7472 2866 6f63 616c 4c65   " + str(focalLe
-00002ea0: 6e67 7468 5859 2920 290a 2020 2020 2020  ngthXY) ).      
-00002eb0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00002ec0: 2020 2072 6574 7572 6e20 666f 6361 6c4c     return focalL
-00002ed0: 656e 6774 6858 592c 2022 5061 7273 6564  engthXY, "Parsed
-00002ee0: 2066 726f 6d20 2769 6d61 6765 2d63 616d   from 'image-cam
-00002ef0: 6572 612d 6361 6c69 6272 6174 696f 6e2d  era-calibration-
-00002f00: 6d6f 6465 6c27 5b27 6361 6c69 6272 6174  model'['calibrat
-00002f10: 696f 6e2d 666f 6361 6c2d 6c65 6e67 7468  ion-focal-length
-00002f20: 2d78 792d 7069 7865 6c27 5d22 0a20 2020  -xy-pixel']".   
-00002f30: 2020 2020 2065 7863 6570 7420 6d69 7174       except miqt
-00002f40: 632e 4966 646f 4578 6365 7074 696f 6e3a  c.IfdoException:
-00002f50: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-00002f60: 730a 0a20 2020 2020 2020 2075 6e64 6572  s..        under
-00002f70: 7761 7465 7249 6d61 6765 203d 2054 7275  waterImage = Tru
-00002f80: 650a 2020 2020 2020 2020 7472 793a 0a20  e.        try:. 
-00002f90: 2020 2020 2020 2020 2020 2061 6c74 3020             alt0 
-00002fa0: 3d20 7365 6c66 5b69 7465 6d2b 2730 3a69  = self[item+'0:i
-00002fb0: 6d61 6765 2d61 6c74 6974 7564 652d 6d65  mage-altitude-me
-00002fc0: 7465 7273 275d 2023 7365 6c66 2e5f 5f67  ters'] #self.__g
-00002fd0: 6574 4974 656d 4465 6661 756c 7456 616c  etItemDefaultVal
-00002fe0: 7565 2869 7465 6d2c 2027 696d 6167 652d  ue(item, 'image-
-00002ff0: 616c 7469 7475 6465 2d6d 6574 6572 7327  altitude-meters'
-00003000: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00003010: 2061 6c74 3020 3e20 303a 0a20 2020 2020   alt0 > 0:.     
-00003020: 2020 2020 2020 2020 2020 2075 6e64 6572             under
-00003030: 7761 7465 7249 6d61 6765 203d 2046 616c  waterImage = Fal
-00003040: 7365 0a20 2020 2020 2020 2065 7863 6570  se.        excep
-00003050: 7420 6d69 7174 632e 4966 646f 4578 6365  t miqtc.IfdoExce
-00003060: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
-00003070: 2020 2070 6173 730a 0a20 2020 2020 2020     pass..       
-00003080: 2023 2061 6464 2063 6f72 7265 6374 696f   # add correctio
-00003090: 6e20 6661 6374 6f72 2066 6f72 2066 6c61  n factor for fla
-000030a0: 7420 706f 7274 0a20 2020 2020 2020 2069  t port.        i
-000030b0: 6620 646f 6d65 506f 7274 2069 7320 4e6f  f domePort is No
-000030c0: 6e65 2061 6e64 2075 6e64 6572 7761 7465  ne and underwate
-000030d0: 7249 6d61 6765 3a0a 2020 2020 2020 2020  rImage:.        
-000030e0: 2020 2020 7265 7475 726e 205b 2d31 2c2d      return [-1,-
-000030f0: 315d 2c20 2243 6f75 6c64 206e 6f74 2064  1], "Could not d
-00003100: 6574 6572 6d69 6e65 2066 6f63 616c 206c  etermine focal l
-00003110: 656e 6774 6820 6672 6f6d 2027 696d 6167  ength from 'imag
-00003120: 652d 6361 6d65 7261 2d63 616c 6962 7261  e-camera-calibra
-00003130: 7469 6f6e 2d6d 6f64 656c 275b 2763 616c  tion-model'['cal
-00003140: 6962 7261 7469 6f6e 2d66 6f63 616c 2d6c  ibration-focal-l
-00003150: 656e 6774 682d 7879 2d70 6978 656c 275d  ength-xy-pixel']
-00003160: 2061 6e64 2070 6f72 7420 7479 7065 2c20   and port type, 
-00003170: 7768 6963 6820 6973 2072 6571 7569 7265  which is require
-00003180: 6420 666f 7220 636f 7272 6563 7420 6576  d for correct ev
-00003190: 616c 7561 7469 6f6e 206f 6620 6578 6966  aluation of exif
-000031a0: 2076 616c 7565 732c 2069 7320 6e6f 7420   values, is not 
-000031b0: 7072 6f76 6964 6564 2122 0a20 2020 2020  provided!".     
-000031c0: 2020 2063 6f72 7265 6374 696f 6e46 6b74     correctionFkt
-000031d0: 203d 2031 2e30 0a20 2020 2020 2020 2069   = 1.0.        i
-000031e0: 6620 646f 6d65 506f 7274 203d 3d20 4661  f domePort == Fa
-000031f0: 6c73 6520 616e 6420 756e 6465 7277 6174  lse and underwat
-00003200: 6572 496d 6167 653a 0a20 2020 2020 2020  erImage:.       
-00003210: 2020 2020 2063 6f72 7265 6374 696f 6e46       correctionF
-00003220: 6b74 203d 2031 2e33 330a 0a20 2020 2020  kt = 1.33..     
-00003230: 2020 2023 206f 7468 6572 7769 7365 2074     # otherwise t
-00003240: 7279 2064 6572 6976 6520 6672 6f6d 2065  ry derive from e
-00003250: 7869 6620 7461 6773 0a20 2020 2020 2020  xif tags.       
-00003260: 2065 7869 6620 3d20 7365 6c66 2e5f 5f67   exif = self.__g
-00003270: 6574 4974 656d 4465 6661 756c 7456 616c  etItemDefaultVal
-00003280: 7565 2869 7465 6d2c 2769 6d61 6765 2d61  ue(item,'image-a
-00003290: 6371 7569 7369 7469 6f6e 2d73 6574 7469  cquisition-setti
-000032a0: 6e67 7327 290a 2020 2020 2020 2020 2323  ngs').        ##
-000032b0: 2066 726f 6d20 466f 6361 6c20 4c65 6e67   from Focal Leng
-000032c0: 7468 2c20 466f 6361 6c20 506c 616e 6520  th, Focal Plane 
-000032d0: 5820 5265 736f 6c75 7469 6f6e 2c20 466f  X Resolution, Fo
-000032e0: 6361 6c20 506c 616e 6520 5920 5265 736f  cal Plane Y Reso
-000032f0: 6c75 7469 6f6e 2c20 466f 6361 6c20 506c  lution, Focal Pl
-00003300: 616e 6520 5265 736f 6c75 7469 6f6e 2055  ane Resolution U
-00003310: 6e69 740a 2020 2020 2020 2020 666f 6361  nit.        foca
-00003320: 6c4c 656e 6774 6858 592c 206d 7367 203d  lLengthXY, msg =
-00003330: 2073 656c 662e 5f5f 7472 7944 6574 6572   self.__tryDeter
-00003340: 6d69 6e65 466f 6361 6c4c 656e 6768 7449  mineFocalLenghtI
-00003350: 6e50 6978 656c 7346 726f 6d45 7869 665f  nPixelsFromExif_
-00003360: 3128 6578 6966 290a 2020 2020 2020 2020  1(exif).        
-00003370: 6966 2066 6f63 616c 4c65 6e67 7468 5859  if focalLengthXY
-00003380: 2021 3d20 5b2d 312c 2d31 5d3a 0a20 2020   != [-1,-1]:.   
-00003390: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000033a0: 5b65 2a63 6f72 7265 6374 696f 6e46 6b74  [e*correctionFkt
-000033b0: 2066 6f72 2065 2069 6e20 666f 6361 6c4c   for e in focalL
-000033c0: 656e 6774 6858 595d 2c20 2744 6572 6976  engthXY], 'Deriv
-000033d0: 6564 2066 726f 6d20 6578 6966 2074 6167  ed from exif tag
-000033e0: 7320 466f 6361 6c20 4c65 6e67 7468 2c20  s Focal Length, 
-000033f0: 466f 6361 6c20 506c 616e 6520 5820 5265  Focal Plane X Re
-00003400: 736f 6c75 7469 6f6e 2c20 466f 6361 6c20  solution, Focal 
-00003410: 506c 616e 6520 5920 5265 736f 6c75 7469  Plane Y Resoluti
-00003420: 6f6e 2c20 466f 6361 6c20 506c 616e 6520  on, Focal Plane 
-00003430: 5265 736f 6c75 7469 6f6e 2055 6e69 7427  Resolution Unit'
-00003440: 0a20 2020 2020 2020 2023 2320 6672 6f6d  .        ## from
-00003450: 2066 726f 6d20 3335 206d 6d20 6571 7569   from 35 mm equi
-00003460: 7661 6c65 6e74 2066 6f63 616c 206c 656e  valent focal len
-00003470: 6774 680a 2020 2020 2020 2020 666f 6361  gth.        foca
-00003480: 6c4c 656e 6774 6858 592c 206d 7367 203d  lLengthXY, msg =
-00003490: 2073 656c 662e 5f5f 7472 7944 6574 6572   self.__tryDeter
-000034a0: 6d69 6e65 466f 6361 6c4c 656e 6768 7449  mineFocalLenghtI
-000034b0: 6e50 6978 656c 7346 726f 6d45 7869 665f  nPixelsFromExif_
-000034c0: 3228 6578 6966 290a 2020 2020 2020 2020  2(exif).        
-000034d0: 6966 2066 6f63 616c 4c65 6e67 7468 5859  if focalLengthXY
-000034e0: 2021 3d20 5b2d 312c 2d31 5d3a 0a20 2020   != [-1,-1]:.   
-000034f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00003500: 5b65 2a63 6f72 7265 6374 696f 6e46 6b74  [e*correctionFkt
-00003510: 2066 6f72 2065 2069 6e20 666f 6361 6c4c   for e in focalL
-00003520: 656e 6774 6858 595d 2c20 2744 6572 6976  engthXY], 'Deriv
-00003530: 6564 2066 726f 6d20 6578 6966 2074 6167  ed from exif tag
-00003540: 2046 6f63 616c 204c 656e 6774 6820 7769   Focal Length wi
-00003550: 7468 2033 3520 6d6d 2065 7175 6976 616c  th 35 mm equival
-00003560: 656e 7427 0a20 0a20 2020 2020 2020 2072  ent'. .        r
-00003570: 6574 7572 6e20 5b2d 312c 2d31 5d2c 2022  eturn [-1,-1], "
-00003580: 436f 756c 6420 6e6f 7420 6465 7465 726d  Could not determ
-00003590: 696e 6520 6672 6f6d 2066 6f63 616c 206c  ine from focal l
-000035a0: 656e 6774 6820 696e 2070 6978 656c 7320  ength in pixels 
-000035b0: 6672 6f6d 206e 6569 7468 6572 2027 696d  from neither 'im
-000035c0: 6167 652d 6361 6d65 7261 2d63 616c 6962  age-camera-calib
-000035d0: 7261 7469 6f6e 2d6d 6f64 656c 275b 2763  ration-model'['c
-000035e0: 616c 6962 7261 7469 6f6e 2d66 6f63 616c  alibration-focal
-000035f0: 2d6c 656e 6774 682d 7879 2d70 6978 656c  -length-xy-pixel
-00003600: 275d 206e 6f72 2065 7869 6620 7461 6773  '] nor exif tags
-00003610: 2046 6f63 616c 204c 656e 6774 682c 2046   Focal Length, F
-00003620: 6f63 616c 2050 6c61 6e65 2058 2052 6573  ocal Plane X Res
-00003630: 6f6c 7574 696f 6e2c 2046 6f63 616c 2050  olution, Focal P
-00003640: 6c61 6e65 2059 2052 6573 6f6c 7574 696f  lane Y Resolutio
-00003650: 6e2c 2046 6f63 616c 2050 6c61 6e65 2052  n, Focal Plane R
-00003660: 6573 6f6c 7574 696f 6e20 556e 6974 220a  esolution Unit".
-00003670: 0a0a 2020 2020 6465 6620 5f5f 7472 7944  ..    def __tryD
-00003680: 6574 6572 6d69 6e65 466f 6361 6c4c 656e  etermineFocalLen
-00003690: 6768 7449 6e50 6978 656c 7346 726f 6d45  ghtInPixelsFromE
-000036a0: 7869 665f 3128 7365 6c66 2c65 7869 6644  xif_1(self,exifD
-000036b0: 6963 743a 6469 6374 293a 0a20 2020 2020  ict:dict):.     
-000036c0: 2020 2022 2222 2074 7279 2074 6f20 6465     """ try to de
-000036d0: 7465 726d 696e 6520 666f 6361 6c20 6c65  termine focal le
-000036e0: 6e67 7468 2069 6e20 7069 7865 6c73 2066  ngth in pixels f
-000036f0: 726f 6d20 6578 6966 2074 6167 7320 466f  rom exif tags Fo
-00003700: 6361 6c20 4c65 6e67 7468 2c20 466f 6361  cal Length, Foca
-00003710: 6c20 506c 616e 6520 5820 5265 736f 6c75  l Plane X Resolu
-00003720: 7469 6f6e 2c20 466f 6361 6c20 506c 616e  tion, Focal Plan
-00003730: 6520 5920 5265 736f 6c75 7469 6f6e 2c20  e Y Resolution, 
-00003740: 466f 6361 6c20 506c 616e 6520 5265 736f  Focal Plane Reso
-00003750: 6c75 7469 6f6e 2055 6e69 742e 0a20 2020  lution Unit..   
-00003760: 2020 2020 2020 2020 2052 6574 7275 6e73           Retruns
-00003770: 205b 666f 6361 6c4c 656e 6774 6850 6978   [focalLengthPix
-00003780: 656c 735f 782c 666f 6361 6c4c 656e 6774  els_x,focalLengt
-00003790: 6850 6978 656c 735f 795d 2c20 6d65 7373  hPixels_y], mess
-000037a0: 6167 650a 2020 2020 2020 2020 2020 2020  age.            
-000037b0: 5265 7472 756e 7320 666f 6361 6c4c 656e  Retruns focalLen
-000037c0: 6774 6850 6978 656c 7320 3d20 2d31 2069  gthPixels = -1 i
-000037d0: 6620 6e6f 7420 7375 6363 6573 7366 756c  f not successful
-000037e0: 6c20 2222 220a 0a20 2020 2020 2020 2074  l """..        t
-000037f0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00003800: 666f 6361 6c4c 656e 6774 6820 3d20 7374  focalLength = st
-00003810: 7228 6578 6966 4469 6374 5b27 466f 6361  r(exifDict['Foca
-00003820: 6c20 4c65 6e67 7468 275d 290a 2020 2020  l Length']).    
-00003830: 2020 2020 2020 2020 666f 6361 6c50 6c61          focalPla
-00003840: 6e65 5265 735f 7820 3d20 666c 6f61 7428  neRes_x = float(
-00003850: 7374 7228 6578 6966 4469 6374 5b27 466f  str(exifDict['Fo
-00003860: 6361 6c20 506c 616e 6520 5820 5265 736f  cal Plane X Reso
-00003870: 6c75 7469 6f6e 275d 292e 7374 7269 7028  lution']).strip(
-00003880: 275c 2727 2929 0a20 2020 2020 2020 2020  '\'')).         
-00003890: 2020 2066 6f63 616c 506c 616e 6552 6573     focalPlaneRes
-000038a0: 5f79 203d 2066 6c6f 6174 2873 7472 2865  _y = float(str(e
-000038b0: 7869 6644 6963 745b 2746 6f63 616c 2050  xifDict['Focal P
-000038c0: 6c61 6e65 2059 2052 6573 6f6c 7574 696f  lane Y Resolutio
-000038d0: 6e27 5d29 2e73 7472 6970 2827 5c27 2729  n']).strip('\'')
-000038e0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-000038f0: 6361 6c50 6c61 6e65 5265 735f 756e 6974  calPlaneRes_unit
-00003900: 203d 2073 7472 2865 7869 6644 6963 745b   = str(exifDict[
-00003910: 2746 6f63 616c 2050 6c61 6e65 2052 6573  'Focal Plane Res
-00003920: 6f6c 7574 696f 6e20 556e 6974 275d 292e  olution Unit']).
-00003930: 7374 7269 7028 275c 2727 290a 2020 2020  strip('\'').    
-00003940: 2020 2020 6578 6365 7074 2028 4b65 7945      except (KeyE
-00003950: 7272 6f72 2c20 5661 6c75 6545 7272 6f72  rror, ValueError
-00003960: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00003970: 6574 7572 6e20 5b2d 312c 2d31 5d2c 2022  eturn [-1,-1], "
-00003980: 436f 756c 6420 6e6f 7420 6669 6e64 2061  Could not find a
-00003990: 6c6c 2072 6571 7569 7265 6420 6669 656c  ll required fiel
-000039a0: 6473 2046 6f63 616c 204c 656e 6774 682c  ds Focal Length,
-000039b0: 2046 6f63 616c 2050 6c61 6e65 2058 2052   Focal Plane X R
-000039c0: 6573 6f6c 7574 696f 6e2c 2046 6f63 616c  esolution, Focal
-000039d0: 2050 6c61 6e65 2059 2052 6573 6f6c 7574   Plane Y Resolut
-000039e0: 696f 6e2c 2046 6f63 616c 2050 6c61 6e65  ion, Focal Plane
-000039f0: 2052 6573 6f6c 7574 696f 6e20 556e 6974   Resolution Unit
-00003a00: 220a 2020 2020 2020 2020 0a20 2020 2020  ".        .     
-00003a10: 2020 2023 2070 6172 7365 2066 6f63 616c     # parse focal
-00003a20: 206c 656e 6774 6820 6672 6f6d 206c 6566   length from lef
-00003a30: 7420 286d 6179 2062 6520 2737 2e35 206d  t (may be '7.5 m
-00003a40: 6d20 282e 2e2e 2927 290a 2020 2020 2020  m (...)').      
-00003a50: 2020 666f 6361 6c4c 656e 6774 6853 7472    focalLengthStr
-00003a60: 6970 7065 6420 3d20 666f 6361 6c4c 656e  ipped = focalLen
-00003a70: 6774 682e 7374 7269 7028 290a 2020 2020  gth.strip().    
-00003a80: 2020 2020 666f 6361 6c4c 656e 6774 6846      focalLengthF
-00003a90: 6c6f 6174 203d 204e 6f6e 650a 2020 2020  loat = None.    
-00003aa0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-00003ab0: 6765 286c 656e 2866 6f63 616c 4c65 6e67  ge(len(focalLeng
-00003ac0: 7468 5374 7269 7070 6564 2929 3a0a 2020  thStripped)):.  
-00003ad0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00003ae0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00003af0: 6f63 616c 4c65 6e67 7468 466c 6f61 7420  ocalLengthFloat 
-00003b00: 3d20 666c 6f61 7428 666f 6361 6c4c 656e  = float(focalLen
-00003b10: 6774 6853 7472 6970 7065 645b 303a 692b  gthStripped[0:i+
-00003b20: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
-00003b30: 6578 6365 7074 2056 616c 7565 4572 726f  except ValueErro
-00003b40: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00003b50: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-00003b60: 6966 2066 6f63 616c 4c65 6e67 7468 466c  if focalLengthFl
-00003b70: 6f61 7420 6973 204e 6f6e 653a 0a20 2020  oat is None:.   
-00003b80: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00003b90: 5b2d 312c 2d31 5d2c 2022 436f 756c 6420  [-1,-1], "Could 
-00003ba0: 6e6f 7420 7061 7273 6520 666f 7263 616c  not parse forcal
-00003bb0: 206c 656e 6774 6820 6672 6f6d 2027 466f   length from 'Fo
-00003bc0: 6361 6c20 4c65 6e67 7468 273a 2022 202b  cal Length': " +
-00003bd0: 2066 6f63 616c 4c65 6e67 7468 0a20 2020   focalLength.   
-00003be0: 2020 2020 2073 6361 6c65 466b 745f 666f       scaleFkt_fo
-00003bf0: 6361 6c20 3d20 7365 6c66 2e5f 5f75 6e69  cal = self.__uni
-00003c00: 7443 6f6e 7665 7273 696f 6e46 6163 7432  tConversionFact2
-00003c10: 6d6d 2866 6f63 616c 4c65 6e67 7468 290a  mm(focalLength).
-00003c20: 2020 2020 2020 2020 6966 2073 6361 6c65          if scale
-00003c30: 466b 745f 666f 6361 6c20 3d3d 202d 313a  Fkt_focal == -1:
-00003c40: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00003c50: 7572 6e20 5b2d 312c 2d31 5d2c 2022 436f  urn [-1,-1], "Co
-00003c60: 756c 6420 6e6f 7420 7061 7273 6520 666f  uld not parse fo
-00003c70: 7263 616c 206c 656e 6774 6820 756e 6974  rcal length unit
-00003c80: 2066 726f 6d20 2746 6f63 616c 204c 656e   from 'Focal Len
-00003c90: 6774 6827 3a20 2220 2b20 666f 6361 6c4c  gth': " + focalL
-00003ca0: 656e 6774 680a 2020 2020 2020 2020 666f  ength.        fo
-00003cb0: 6361 6c4c 656e 6774 685f 6d6d 203d 2066  calLength_mm = f
-00003cc0: 6f63 616c 4c65 6e67 7468 466c 6f61 7420  ocalLengthFloat 
-00003cd0: 2a20 7363 616c 6546 6b74 5f66 6f63 616c  * scaleFkt_focal
-00003ce0: 0a0a 2020 2020 2020 2020 7363 616c 6546  ..        scaleF
-00003cf0: 6b74 5f72 6573 203d 2073 656c 662e 5f5f  kt_res = self.__
-00003d00: 756e 6974 436f 6e76 6572 7369 6f6e 4661  unitConversionFa
-00003d10: 6374 326d 6d28 666f 6361 6c50 6c61 6e65  ct2mm(focalPlane
-00003d20: 5265 735f 756e 6974 290a 2020 2020 2020  Res_unit).      
-00003d30: 2020 6966 2073 6361 6c65 466b 745f 7265    if scaleFkt_re
-00003d40: 7320 3d3d 202d 313a 0a20 2020 2020 2020  s == -1:.       
-00003d50: 2020 2020 2072 6574 7572 6e20 5b2d 312c       return [-1,
-00003d60: 2d31 5d2c 2022 436f 756c 6420 6e6f 7420  -1], "Could not 
-00003d70: 7061 7273 6520 466f 6361 6c20 506c 616e  parse Focal Plan
-00003d80: 6520 5265 736f 6c75 7469 6f6e 2055 6e69  e Resolution Uni
-00003d90: 7420 6672 6f6d 2027 466f 6361 6c20 506c  t from 'Focal Pl
-00003da0: 616e 6520 5265 736f 6c75 7469 6f6e 2055  ane Resolution U
-00003db0: 6e69 7427 3a20 2220 2b20 666f 6361 6c50  nit': " + focalP
-00003dc0: 6c61 6e65 5265 735f 756e 6974 0a0a 2020  laneRes_unit..  
-00003dd0: 2020 2020 2020 666f 6361 6c4c 656e 6774        focalLengt
-00003de0: 6850 6978 656c 735f 7820 3d20 666f 6361  hPixels_x = foca
-00003df0: 6c4c 656e 6774 685f 6d6d 202a 2066 6f63  lLength_mm * foc
-00003e00: 616c 506c 616e 6552 6573 5f78 202f 2073  alPlaneRes_x / s
-00003e10: 6361 6c65 466b 745f 7265 730a 2020 2020  caleFkt_res.    
-00003e20: 2020 2020 666f 6361 6c4c 656e 6774 6850      focalLengthP
-00003e30: 6978 656c 735f 7920 3d20 666f 6361 6c4c  ixels_y = focalL
-00003e40: 656e 6774 685f 6d6d 202a 2066 6f63 616c  ength_mm * focal
-00003e50: 506c 616e 6552 6573 5f79 202f 2073 6361  PlaneRes_y / sca
-00003e60: 6c65 466b 745f 7265 730a 0a20 2020 2020  leFkt_res..     
-00003e70: 2020 2072 6574 7572 6e20 5b66 6f63 616c     return [focal
-00003e80: 4c65 6e67 7468 5069 7865 6c73 5f78 2c66  LengthPixels_x,f
-00003e90: 6f63 616c 4c65 6e67 7468 5069 7865 6c73  ocalLengthPixels
-00003ea0: 5f79 5d2c 2022 220a 0a0a 2020 2020 6465  _y], ""...    de
-00003eb0: 6620 5f5f 7472 7944 6574 6572 6d69 6e65  f __tryDetermine
-00003ec0: 466f 6361 6c4c 656e 6768 7449 6e50 6978  FocalLenghtInPix
-00003ed0: 656c 7346 726f 6d45 7869 665f 3228 7365  elsFromExif_2(se
-00003ee0: 6c66 2c65 7869 6644 6963 743a 6469 6374  lf,exifDict:dict
-00003ef0: 293a 0a20 2020 2020 2020 2022 2222 2074  ):.        """ t
-00003f00: 7279 2074 6f20 6465 7465 726d 696e 6520  ry to determine 
-00003f10: 666f 6361 6c20 6c65 6e67 7468 2069 6e20  focal length in 
-00003f20: 7069 7865 6c73 2066 726f 6d20 3335 206d  pixels from 35 m
-00003f30: 6d20 6571 7569 7661 6c65 6e74 2066 6f63  m equivalent foc
-00003f40: 616c 206c 656e 6774 6820 696e 2065 7869  al length in exi
-00003f50: 6620 7461 6720 466f 6361 6c20 4c65 6e67  f tag Focal Leng
-00003f60: 7468 2773 2061 6464 206f 6e20 652e 672e  th's add on e.g.
-00003f70: 2027 372e 3020 6d6d 2028 3335 206d 6d20   '7.0 mm (35 mm 
-00003f80: 6571 7569 7661 6c65 6e74 3a20 3338 2e38  equivalent: 38.8
-00003f90: 206d 6d29 272e 0a20 2020 2020 2020 2020   mm)'..         
-00003fa0: 2020 2052 6574 7275 6e73 205b 666f 6361     Retruns [foca
-00003fb0: 6c4c 656e 6774 6850 6978 656c 735f 782c  lLengthPixels_x,
-00003fc0: 666f 6361 6c4c 656e 6774 6850 6978 656c  focalLengthPixel
-00003fd0: 735f 795d 2c20 6d65 7373 6167 650a 2020  s_y], message.  
-00003fe0: 2020 2020 2020 2020 2020 5265 7472 756e            Retrun
-00003ff0: 7320 666f 6361 6c4c 656e 6774 6850 6978  s focalLengthPix
-00004000: 656c 7320 3d20 2d31 2069 6620 6e6f 7420  els = -1 if not 
-00004010: 7375 6363 6573 7366 756c 6c20 2222 220a  successfull """.
-00004020: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00004030: 2020 2020 2020 2020 2020 666f 6361 6c4c            focalL
-00004040: 656e 6774 6820 3d20 7374 7228 6578 6966  ength = str(exif
-00004050: 4469 6374 5b27 466f 6361 6c20 4c65 6e67  Dict['Focal Leng
-00004060: 7468 275d 290a 2020 2020 2020 2020 2020  th']).          
-00004070: 2020 696d 6167 6557 6964 7468 203d 2069    imageWidth = i
-00004080: 6e74 2873 7472 2865 7869 6644 6963 745b  nt(str(exifDict[
-00004090: 2749 6d61 6765 2057 6964 7468 275d 292e  'Image Width']).
-000040a0: 7374 7269 7028 275c 2727 2929 0a20 2020  strip('\'')).   
-000040b0: 2020 2020 2065 7863 6570 7420 284b 6579       except (Key
-000040c0: 4572 726f 722c 2056 616c 7565 4572 726f  Error, ValueErro
-000040d0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-000040e0: 7265 7475 726e 205b 2d31 2c2d 315d 2c20  return [-1,-1], 
-000040f0: 2243 6f75 6c64 206e 6f74 2066 696e 6420  "Could not find 
-00004100: 616c 6c20 7265 7175 6972 6564 2066 6965  all required fie
-00004110: 6c64 7320 466f 6361 6c20 4c65 6e67 7468  lds Focal Length
-00004120: 2c20 496d 6167 6520 5769 6474 6822 0a0a  , Image Width"..
-00004130: 2020 2020 2020 2020 2320 7472 7920 7061          # try pa
-00004140: 7273 6520 3335 206d 6d20 6571 7569 7661  rse 35 mm equiva
-00004150: 6c65 6e74 2066 726f 6d20 652e 672e 3a20  lent from e.g.: 
-00004160: 2037 2e30 206d 6d20 2833 3520 6d6d 2065   7.0 mm (35 mm e
-00004170: 7175 6976 616c 656e 743a 2033 382e 3820  quivalent: 38.8 
-00004180: 6d6d 290a 2020 2020 2020 2020 636f 6c6f  mm).        colo
-00004190: 6e49 6e64 6578 203d 2066 6f63 616c 4c65  nIndex = focalLe
-000041a0: 6e67 7468 2e66 696e 6428 273a 2729 0a20  ngth.find(':'). 
-000041b0: 2020 2020 2020 2069 6620 636f 6c6f 6e49         if colonI
-000041c0: 6e64 6578 203d 3d20 2d31 3a0a 2020 2020  ndex == -1:.    
-000041d0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-000041e0: 2d31 2c2d 315d 2c20 2243 6f75 6c64 206e  -1,-1], "Could n
-000041f0: 6f74 2070 6172 7365 2033 3520 6d6d 2065  ot parse 35 mm e
-00004200: 7175 6976 616c 656e 7420 666f 6361 6c20  quivalent focal 
-00004210: 6c65 6e67 7468 2066 726f 6d20 2746 6f63  length from 'Foc
-00004220: 616c 204c 656e 6774 6827 3a20 2220 2b20  al Length': " + 
-00004230: 666f 6361 6c4c 656e 6774 680a 2020 2020  focalLength.    
-00004240: 2020 2020 666f 6361 6c4c 656e 6774 6845      focalLengthE
-00004250: 7133 356d 6d46 6c6f 6174 203d 204e 6f6e  q35mmFloat = Non
-00004260: 650a 2020 2020 2020 2020 6571 7561 6c33  e.        equal3
-00004270: 356d 6d50 6172 7420 3d20 666f 6361 6c4c  5mmPart = focalL
-00004280: 656e 6774 685b 636f 6c6f 6e49 6e64 6578  ength[colonIndex
-00004290: 2b31 3a3a 5d2e 7374 7269 7028 290a 2020  +1::].strip().  
-000042a0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-000042b0: 616e 6765 286c 656e 2865 7175 616c 3335  ange(len(equal35
-000042c0: 6d6d 5061 7274 2929 3a0a 2020 2020 2020  mmPart)):.      
-000042d0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000042e0: 2020 2020 2020 2020 2020 2066 6f63 616c             focal
-000042f0: 4c65 6e67 7468 4571 3335 6d6d 466c 6f61  LengthEq35mmFloa
-00004300: 7420 3d20 666c 6f61 7428 6571 7561 6c33  t = float(equal3
-00004310: 356d 6d50 6172 745b 303a 692b 315d 290a  5mmPart[0:i+1]).
-00004320: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00004330: 7074 2056 616c 7565 4572 726f 723a 0a20  pt ValueError:. 
-00004340: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00004350: 6173 730a 2020 2020 2020 2020 7363 616c  ass.        scal
-00004360: 6546 6b74 203d 2073 656c 662e 5f5f 756e  eFkt = self.__un
-00004370: 6974 436f 6e76 6572 7369 6f6e 4661 6374  itConversionFact
-00004380: 326d 6d28 666f 6361 6c4c 656e 6774 685b  2mm(focalLength[
-00004390: 636f 6c6f 6e49 6e64 6578 2b31 3a3a 5d29  colonIndex+1::])
-000043a0: 0a20 2020 2020 2020 2069 6620 666f 6361  .        if foca
-000043b0: 6c4c 656e 6774 6845 7133 356d 6d46 6c6f  lLengthEq35mmFlo
-000043c0: 6174 2069 7320 4e6f 6e65 206f 7220 7363  at is None or sc
-000043d0: 616c 6546 6b74 203d 3d20 2d31 3a0a 2020  aleFkt == -1:.  
-000043e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000043f0: 205b 2d31 2c2d 315d 2c20 2243 6f75 6c64   [-1,-1], "Could
-00004400: 206e 6f74 2070 6172 7365 2033 3520 6d6d   not parse 35 mm
-00004410: 2065 7175 6976 616c 656e 7420 666f 6361   equivalent foca
-00004420: 6c20 6c65 6e67 7468 2066 726f 6d20 2746  l length from 'F
-00004430: 6f63 616c 204c 656e 6774 6827 3a20 2220  ocal Length': " 
-00004440: 2b20 666f 6361 6c4c 656e 6774 680a 2020  + focalLength.  
-00004450: 2020 2020 2020 0a20 2020 2020 2020 2066        .        f
-00004460: 6f63 616c 4c65 6e67 7468 5069 7865 6c73  ocalLengthPixels
-00004470: 203d 2066 6f63 616c 4c65 6e67 7468 4571   = focalLengthEq
-00004480: 3335 6d6d 466c 6f61 7420 2a20 7363 616c  35mmFloat * scal
-00004490: 6546 6b74 202a 2069 6d61 6765 5769 6474  eFkt * imageWidt
-000044a0: 6820 2f20 3336 2e30 0a20 2020 2020 2020  h / 36.0.       
-000044b0: 2072 6574 7572 6e20 5b66 6f63 616c 4c65   return [focalLe
-000044c0: 6e67 7468 5069 7865 6c73 2c66 6f63 616c  ngthPixels,focal
-000044d0: 4c65 6e67 7468 5069 7865 6c73 5d2c 2022  LengthPixels], "
-000044e0: 220a 0a0a 2020 2020 6465 6620 5f5f 756e  "...    def __un
-000044f0: 6974 436f 6e76 6572 7369 6f6e 4661 6374  itConversionFact
-00004500: 326d 6d28 7365 6c66 2c75 6e69 743a 7374  2mm(self,unit:st
-00004510: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
-00004520: 6c6f 6f6b 7320 666f 7220 6c65 7474 6572  looks for letter
-00004530: 2073 6571 7565 6e63 6520 696e 2075 6e69   sequence in uni
-00004540: 7420 616e 6420 6368 6563 6b73 2069 6620  t and checks if 
-00004550: 6974 2773 2027 696e 6368 6573 272c 276d  it's 'inches','m
-00004560: 272c 2763 6d27 2c27 6d6d 272c 2775 6d27  ','cm','mm','um'
-00004570: 206f 7220 2727 2061 6e64 2072 6574 7572   or '' and retur
-00004580: 6e73 2072 6573 7065 6374 6976 6520 636f  ns respective co
-00004590: 6e76 6572 7369 6f6e 2066 6163 746f 7220  nversion factor 
-000045a0: 746f 206d 6d20 2869 6620 7468 6572 6520  to mm (if there 
-000045b0: 6172 6520 6e6f 206c 6574 7465 7273 2069  are no letters i
-000045c0: 7420 7265 7475 726e 7320 3129 2e20 4f74  t returns 1). Ot
-000045d0: 6865 7277 6973 6520 7265 7475 726e 202d  herwise return -
-000045e0: 3120 2222 220a 0a20 2020 2020 2020 2066  1 """..        f
-000045f0: 6972 7374 4c65 7474 6572 5365 7120 3d20  irstLetterSeq = 
-00004600: 2222 0a20 2020 2020 2020 2066 6972 7374  "".        first
-00004610: 466f 756e 6420 3d20 4661 6c73 650a 2020  Found = False.  
-00004620: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00004630: 616e 6765 286c 656e 2875 6e69 7429 293a  ange(len(unit)):
-00004640: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00004650: 756e 6974 5b69 5d2e 6973 616c 7068 6128  unit[i].isalpha(
-00004660: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00004670: 2020 2066 6972 7374 466f 756e 6420 3d20     firstFound = 
-00004680: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00004690: 2020 2020 2066 6972 7374 4c65 7474 6572       firstLetter
-000046a0: 5365 7120 2b3d 2075 6e69 745b 695d 0a20  Seq += unit[i]. 
-000046b0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-000046c0: 7420 756e 6974 5b69 5d2e 6973 616c 7068  t unit[i].isalph
-000046d0: 6128 2920 616e 6420 6669 7273 7446 6f75  a() and firstFou
-000046e0: 6e64 203d 3d20 5472 7565 3a0a 2020 2020  nd == True:.    
-000046f0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00004700: 6b0a 0a20 2020 2020 2020 2069 6620 6669  k..        if fi
-00004710: 7273 744c 6574 7465 7253 6571 2e6c 6f77  rstLetterSeq.low
-00004720: 6572 2829 203d 3d20 2269 6e63 6865 7322  er() == "inches"
-00004730: 3a0a 2020 2020 2020 2020 2020 2020 7363  :.            sc
-00004740: 616c 6546 6b74 203d 2032 352e 340a 2020  aleFkt = 25.4.  
-00004750: 2020 2020 2020 656c 6966 2066 6972 7374        elif first
-00004760: 4c65 7474 6572 5365 712e 6c6f 7765 7228  LetterSeq.lower(
-00004770: 2920 3d3d 2022 6d22 3a0a 2020 2020 2020  ) == "m":.      
-00004780: 2020 2020 2020 7363 616c 6546 6b74 203d        scaleFkt =
-00004790: 2031 3030 302e 303b 0a20 2020 2020 2020   1000.0;.       
-000047a0: 2065 6c69 6620 6669 7273 744c 6574 7465   elif firstLette
-000047b0: 7253 6571 2e6c 6f77 6572 2829 203d 3d20  rSeq.lower() == 
-000047c0: 2263 6d22 3a0a 2020 2020 2020 2020 2020  "cm":.          
-000047d0: 2020 7363 616c 6546 6b74 203d 2031 302e    scaleFkt = 10.
-000047e0: 303b 0a20 2020 2020 2020 2065 6c69 6620  0;.        elif 
-000047f0: 6669 7273 744c 6574 7465 7253 6571 2e6c  firstLetterSeq.l
-00004800: 6f77 6572 2829 203d 3d20 226d 6d22 3a0a  ower() == "mm":.
-00004810: 2020 2020 2020 2020 2020 2020 7363 616c              scal
-00004820: 6546 6b74 203d 2031 2e30 3b0a 2020 2020  eFkt = 1.0;.    
-00004830: 2020 2020 656c 6966 2066 6972 7374 4c65      elif firstLe
-00004840: 7474 6572 5365 712e 6c6f 7765 7228 2920  tterSeq.lower() 
-00004850: 3d3d 2022 756d 223a 0a20 2020 2020 2020  == "um":.       
-00004860: 2020 2020 2073 6361 6c65 466b 7420 3d20       scaleFkt = 
-00004870: 312f 3130 3030 3b0a 2020 2020 2020 2020  1/1000;.        
-00004880: 656c 6966 2066 6972 7374 4c65 7474 6572  elif firstLetter
-00004890: 5365 712e 6c6f 7765 7228 2920 3d3d 2022  Seq.lower() == "
-000048a0: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
-000048b0: 6361 6c65 466b 7420 3d20 313b 0a20 2020  caleFkt = 1;.   
-000048c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000048d0: 2020 2020 2020 2073 6361 6c65 466b 7420         scaleFkt 
-000048e0: 3d20 2d31 0a0a 2020 2020 2020 2020 7265  = -1..        re
-000048f0: 7475 726e 2073 6361 6c65 466b 740a 0a0a  turn scaleFkt...
-00004900: 2020 2020 6465 6620 5f5f 6765 7449 7465      def __getIte
-00004910: 6d44 6566 6175 6c74 5661 6c75 6528 7365  mDefaultValue(se
-00004920: 6c66 2c69 7465 6d3a 7374 722c 6669 656c  lf,item:str,fiel
-00004930: 644e 616d 653a 7374 7229 3a0a 2020 2020  dName:str):.    
-00004940: 2020 2020 2222 2220 7265 7475 726e 7320      """ returns 
-00004950: 6974 656d 2076 616c 7565 7320 2866 6972  item values (fir
-00004960: 7374 2065 6e74 7279 2069 6e20 6361 7365  st entry in case
-00004970: 206f 6620 7669 6465 6f73 292e 2054 6872   of videos). Thr
-00004980: 6f77 7320 6d61 7269 7174 2e63 6f72 652e  ows mariqt.core.
-00004990: 4966 646f 4578 6365 7074 696f 6e20 6966  IfdoException if
-000049a0: 2066 6965 6c64 206e 6f74 2066 6f75 6e64   field not found
-000049b0: 2e20 2222 220a 0a20 2020 2020 2020 2072  . """..        r
-000049c0: 6574 203d 2073 656c 665b 223a 222e 6a6f  et = self[":".jo
-000049d0: 696e 285b 6974 656d 2c27 3027 2c66 6965  in([item,'0',fie
-000049e0: 6c64 4e61 6d65 5d29 5d0a 2020 2020 2020  ldName])].      
-000049f0: 2020 6966 2072 6574 203d 3d20 2222 3a0a    if ret == "":.
-00004a00: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00004a10: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
-00004a20: 7469 6f6e 2822 4572 726f 723a 2046 6965  tion("Error: Fie
-00004a30: 6c64 207b 307d 206e 6569 7468 6572 2066  ld {0} neither f
-00004a40: 6f75 6e64 2069 6e20 6974 656d 207b 317d  ound in item {1}
-00004a50: 206e 6f72 2068 6561 6465 7222 2e66 6f72   nor header".for
-00004a60: 6d61 7428 6669 656c 644e 616d 652c 6974  mat(fieldName,it
-00004a70: 656d 2929 0a20 2020 2020 2020 2072 6574  em)).        ret
-00004a80: 7572 6e20 7265 740a 0a0a 2020 2020 6465  urn ret...    de
-00004a90: 6620 5f5f 6765 7449 7465 6d4c 6174 4c6f  f __getItemLatLo
-00004aa0: 6e28 7365 6c66 2c69 7465 6d3a 7374 722c  n(self,item:str,
-00004ab0: 6865 6164 6572 5661 6c4c 6174 2c68 6561  headerValLat,hea
-00004ac0: 6465 7256 616c 4c6f 6e29 3a0a 2020 2020  derValLon):.    
-00004ad0: 2020 2020 2222 2220 7265 7475 726e 7320      """ returns 
-00004ae0: 7b27 6c61 7427 3a20 7661 6c75 652c 2027  {'lat': value, '
-00004af0: 6c6f 6e27 3a20 7661 6c75 652c 2027 6461  lon': value, 'da
-00004b00: 7465 7469 6d65 273a 2076 616c 7565 7d20  tetime': value} 
-00004b10: 6f66 206c 6973 7420 6f66 2074 686f 7365  of list of those
-00004b20: 2022 2222 0a0a 2020 2020 2020 2020 6974   """..        it
-00004b30: 656d 5661 6c20 3d20 7365 6c66 2e69 6664  emVal = self.ifd
-00004b40: 6f5b 6d69 7174 762e 696d 6167 655f 7365  o[miqtv.image_se
-00004b50: 745f 6974 656d 735f 6b65 795d 5b69 7465  t_items_key][ite
-00004b60: 6d5d 0a20 2020 2020 2020 2069 6620 6e6f  m].        if no
-00004b70: 7420 6973 696e 7374 616e 6365 2869 7465  t isinstance(ite
-00004b80: 6d56 616c 2c6c 6973 7429 3a0a 2020 2020  mVal,list):.    
-00004b90: 2020 2020 2020 2020 7265 7420 3d20 7365          ret = se
-00004ba0: 6c66 2e5f 5f70 6172 7365 324c 6174 4c6f  lf.__parse2LatLo
-00004bb0: 6e44 6963 7428 6974 656d 5661 6c2c 6865  nDict(itemVal,he
-00004bc0: 6164 6572 5661 6c4c 6174 2c68 6561 6465  aderValLat,heade
-00004bd0: 7256 616c 4c6f 6e29 0a20 2020 2020 2020  rValLon).       
-00004be0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00004bf0: 2020 2072 6574 203d 205b 5d0a 2020 2020     ret = [].    
-00004c00: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00004c10: 2020 2020 2020 2020 2020 2020 2069 7465               ite
-00004c20: 6d4c 6174 4465 6661 756c 7420 3d20 6974  mLatDefault = it
-00004c30: 656d 5661 6c5b 305d 5b27 696d 6167 652d  emVal[0]['image-
-00004c40: 6c61 7469 7475 6465 275d 0a20 2020 2020  latitude'].     
-00004c50: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
-00004c60: 7945 7272 6f72 3a0a 2020 2020 2020 2020  yError:.        
-00004c70: 2020 2020 2020 2020 6974 656d 4c61 7444          itemLatD
-00004c80: 6566 6175 6c74 203d 2068 6561 6465 7256  efault = headerV
-00004c90: 616c 4c61 740a 2020 2020 2020 2020 2020  alLat.          
-00004ca0: 2020 2020 2020 2369 6620 6974 656d 4c61        #if itemLa
-00004cb0: 7444 6566 6175 6c74 2069 7320 4e6f 6e65  tDefault is None
-00004cc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004cd0: 2020 2320 2020 2072 6169 7365 2045 7863    #    raise Exc
-00004ce0: 6570 7469 6f6e 2822 4572 726f 723a 2046  eption("Error: F
-00004cf0: 6965 6c64 207b 307d 206e 6569 7468 6572  ield {0} neither
-00004d00: 2066 6f75 6e64 2069 6e20 6974 656d 207b   found in item {
-00004d10: 317d 206e 6f72 2068 6561 6465 7222 2e66  1} nor header".f
-00004d20: 6f72 6d61 7428 2769 6d61 6765 2d6c 6174  ormat('image-lat
-00004d30: 6974 7564 6527 2c69 7465 6d29 290a 0a20  itude',item)).. 
-00004d40: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-00004d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d60: 6974 656d 4c6f 6e44 6566 6175 6c74 203d  itemLonDefault =
-00004d70: 2069 7465 6d56 616c 5b30 5d5b 2769 6d61   itemVal[0]['ima
-00004d80: 6765 2d6c 6f6e 6769 7475 6465 275d 0a20  ge-longitude']. 
-00004d90: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00004da0: 7420 4b65 7945 7272 6f72 3a0a 2020 2020  t KeyError:.    
-00004db0: 2020 2020 2020 2020 2020 2020 6974 656d              item
-00004dc0: 4c6f 6e44 6566 6175 6c74 203d 2068 6561  LonDefault = hea
-00004dd0: 6465 7256 616c 4c6f 6e0a 2020 2020 2020  derValLon.      
-00004de0: 2020 2020 2020 2020 2020 2369 6620 6974            #if it
-00004df0: 656d 4c6f 6e44 6566 6175 6c74 2069 7320  emLonDefault is 
-00004e00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00004e10: 2020 2020 2020 2320 2020 2072 6169 7365        #    raise
-00004e20: 2045 7863 6570 7469 6f6e 2822 4572 726f   Exception("Erro
-00004e30: 723a 2046 6965 6c64 207b 307d 206e 6569  r: Field {0} nei
-00004e40: 7468 6572 2066 6f75 6e64 2069 6e20 6974  ther found in it
-00004e50: 656d 207b 317d 206e 6f72 2068 6561 6465  em {1} nor heade
-00004e60: 7222 2e66 6f72 6d61 7428 2769 6d61 6765  r".format('image
-00004e70: 2d6c 6174 6974 7564 6527 2c69 7465 6d29  -latitude',item)
-00004e80: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
-00004e90: 6f72 2073 7562 456e 7472 7920 696e 2069  or subEntry in i
-00004ea0: 7465 6d56 616c 3a0a 2020 2020 2020 2020  temVal:.        
-00004eb0: 2020 2020 2020 2020 7265 742e 6170 7065          ret.appe
-00004ec0: 6e64 2873 656c 662e 5f5f 7061 7273 6532  nd(self.__parse2
-00004ed0: 4c61 744c 6f6e 4469 6374 2873 7562 456e  LatLonDict(subEn
-00004ee0: 7472 792c 6974 656d 4c61 7444 6566 6175  try,itemLatDefau
-00004ef0: 6c74 2c69 7465 6d4c 6f6e 4465 6661 756c  lt,itemLonDefaul
-00004f00: 7429 290a 0a20 2020 2020 2020 2072 6574  t))..        ret
-00004f10: 7572 6e20 7265 740a 2020 2020 2020 2020  urn ret.        
-00004f20: 2020 2020 0a0a 2020 2020 6465 6620 5f5f      ..    def __
-00004f30: 7061 7273 6532 4c61 744c 6f6e 4469 6374  parse2LatLonDict
-00004f40: 2873 656c 662c 6974 656d 5661 6c2c 6865  (self,itemVal,he
-00004f50: 6164 6572 5661 6c4c 6174 2c68 6561 6465  aderValLat,heade
-00004f60: 7256 616c 4c6f 6e29 3a0a 2020 2020 2020  rValLon):.      
-00004f70: 2020 2222 2220 7265 7475 726e 7320 7b27    """ returns {'
-00004f80: 6c61 7427 3a6c 6174 2c27 6c6f 6e27 3a6c  lat':lat,'lon':l
-00004f90: 6f6e 2c27 6461 7465 7469 6d65 273a 6461  on,'datetime':da
-00004fa0: 7465 7469 6d65 7d20 2222 220a 2020 2020  tetime} """.    
-00004fb0: 2020 2020 6461 7465 7469 6d65 203d 2069      datetime = i
-00004fc0: 7465 6d56 616c 5b27 696d 6167 652d 6461  temVal['image-da
-00004fd0: 7465 7469 6d65 275d 0a20 2020 2020 2020  tetime'].       
-00004fe0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00004ff0: 2020 6c61 7420 3d20 6974 656d 5661 6c5b    lat = itemVal[
-00005000: 2769 6d61 6765 2d6c 6174 6974 7564 6527  'image-latitude'
-00005010: 5d0a 2020 2020 2020 2020 6578 6365 7074  ].        except
-00005020: 204b 6579 4572 726f 723a 0a20 2020 2020   KeyError:.     
-00005030: 2020 2020 2020 206c 6174 203d 2068 6561         lat = hea
-00005040: 6465 7256 616c 4c61 740a 2020 2020 2020  derValLat.      
-00005050: 2020 2020 2020 6966 206c 6174 2069 7320        if lat is 
-00005060: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00005070: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-00005080: 7074 696f 6e28 2245 7272 6f72 3a20 4669  ption("Error: Fi
-00005090: 656c 6420 7b30 7d20 6e65 6974 6865 7220  eld {0} neither 
-000050a0: 666f 756e 6420 696e 2069 7465 6d20 7b31  found in item {1
-000050b0: 7d20 6e6f 7220 6865 6164 6572 222e 666f  } nor header".fo
-000050c0: 726d 6174 2827 696d 6167 652d 6c61 7469  rmat('image-lati
-000050d0: 7475 6465 272c 6974 656d 5661 6c29 290a  tude',itemVal)).
-000050e0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-000050f0: 2020 2020 2020 2020 206c 6f6e 203d 2069           lon = i
-00005100: 7465 6d56 616c 5b27 696d 6167 652d 6c6f  temVal['image-lo
-00005110: 6e67 6974 7564 6527 5d0a 2020 2020 2020  ngitude'].      
-00005120: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-00005130: 723a 0a20 2020 2020 2020 2020 2020 206c  r:.            l
-00005140: 6f6e 203d 2068 6561 6465 7256 616c 4c6f  on = headerValLo
-00005150: 6e0a 2020 2020 2020 2020 2020 2020 6966  n.            if
-00005160: 206c 6f6e 2069 7320 4e6f 6e65 3a0a 2020   lon is None:.  
-00005170: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00005180: 6973 6520 4578 6365 7074 696f 6e28 2245  ise Exception("E
-00005190: 7272 6f72 3a20 4669 656c 6420 7b30 7d20  rror: Field {0} 
-000051a0: 6e65 6974 6865 7220 666f 756e 6420 696e  neither found in
-000051b0: 2069 7465 6d20 7b31 7d20 6e6f 7220 6865   item {1} nor he
-000051c0: 6164 6572 222e 666f 726d 6174 2827 696d  ader".format('im
-000051d0: 6167 652d 6c6f 6e67 6974 7564 6527 2c69  age-longitude',i
-000051e0: 7465 6d56 616c 2929 0a20 2020 2020 2020  temVal)).       
-000051f0: 2072 6574 7572 6e20 7b27 6c61 7427 3a6c   return {'lat':l
-00005200: 6174 2c27 6c6f 6e27 3a6c 6f6e 2c27 6461  at,'lon':lon,'da
-00005210: 7465 7469 6d65 273a 6461 7465 7469 6d65  tetime':datetime
-00005220: 7d0a 0a0a 6465 6620 6946 444f 4672 6f6d  }...def iFDOFrom
-00005230: 4669 6c65 2869 4644 4f66 696c 653a 7374  File(iFDOfile:st
-00005240: 722c 6861 6e64 6c65 5f70 7265 6669 783d  r,handle_prefix=
-00005250: 2732 302e 3530 302e 3132 3038 3527 2c70  '20.500.12085',p
-00005260: 726f 7665 6e61 6e63 6520 3d20 4e6f 6e65  rovenance = None
-00005270: 2c76 6572 626f 7365 3d54 7275 652c 6967  ,verbose=True,ig
-00005280: 6e6f 7265 5f69 6d61 6765 5f66 696c 6573  nore_image_files
-00005290: 3d46 616c 7365 2c77 7269 7465 546d 7050  =False,writeTmpP
-000052a0: 726f 7646 696c 653d 5472 7565 2c69 6d61  rovFile=True,ima
-000052b0: 6765 5f62 726f 6b65 725f 7575 6964 3d22  ge_broker_uuid="
-000052c0: 6565 3237 3735 3738 2d61 3931 312d 3438  ee277578-a911-48
-000052d0: 3464 2d61 3531 352d 3963 3738 3164 3739  4d-a515-9c781d79
-000052e0: 6161 3931 2229 3a0a 2020 2020 2222 2220  aa91"):.    """ 
-000052f0: 436f 6e76 656e 6965 6e63 6520 6675 6e63  Convenience func
-00005300: 7469 6f6e 2074 6f20 6372 6561 7465 2061  tion to create a
-00005310: 6e20 6946 444f 206f 626a 6563 7420 6469  n iFDO object di
-00005320: 7265 6374 6c79 2066 6f72 6d20 616e 2065  rectly form an e
-00005330: 7869 7374 696e 6720 6946 444f 2066 696c  xisting iFDO fil
-00005340: 652e 2054 7269 6573 2074 6f20 696e 6665  e. Tries to infe
-00005350: 7220 696d 6167 6520 6669 6c65 7320 6c6f  r image files lo
-00005360: 6361 7469 6f6e 2066 726f 6d20 2769 6d61  cation from 'ima
-00005370: 6765 2d73 6574 2d6c 6f63 616c 2d70 6174  ge-set-local-pat
-00005380: 6827 2e20 5265 7475 726e 7320 6946 444f  h'. Returns iFDO
-00005390: 206f 626a 6563 742e 200a 2020 2020 2020   object. .      
-000053a0: 2020 2d20 6946 444f 6669 6c65 3a20 7374    - iFDOfile: st
-000053b0: 7269 6e67 2070 6174 6820 746f 206c 6f61  ring path to loa
-000053c0: 6420 616e 2065 7870 6c69 6369 7420 6946  d an explicit iF
-000053d0: 444f 2066 696c 652e 0a20 2020 2020 2020  DO file..       
-000053e0: 202d 2068 616e 646c 655f 7072 6566 6978   - handle_prefix
-000053f0: 3a20 7374 7269 6e67 2070 7265 6669 7820  : string prefix 
-00005400: 6f66 2074 6865 2068 616e 646c 6520 7365  of the handle se
-00005410: 7276 6572 2e20 4465 6661 756c 743a 2074  rver. Default: t
-00005420: 6865 206f 6e65 2066 6f72 2047 656f 6d61  he one for Geoma
-00005430: 722e 0a20 2020 2020 2020 202d 2070 726f  r..        - pro
-00005440: 7665 6e61 6e63 653a 206d 6172 6971 742e  venance: mariqt.
-00005450: 7072 6f76 656e 6361 6e63 652e 5072 6f76  provencance.Prov
-00005460: 656e 616e 6365 206f 626a 6563 7420 746f  enance object to
-00005470: 2074 7261 636b 2064 6174 6120 7072 6f76   track data prov
-00005480: 656e 616e 6365 2e20 4465 6661 756c 743a  enance. Default:
-00005490: 2061 206e 6577 2070 726f 7665 6e61 6e63   a new provenanc
-000054a0: 6520 6f62 6a65 6374 2069 7320 6372 6561  e object is crea
-000054b0: 7465 6420 696e 2074 6865 2027 7072 6f74  ted in the 'prot
-000054c0: 6f63 6f6c 2720 7375 6266 6f6c 6465 722e  ocol' subfolder.
-000054d0: 0a20 2020 2020 2020 202d 2076 6572 626f  .        - verbo
-000054e0: 7365 3a20 626f 6f6c 2077 6865 7468 6572  se: bool whether
-000054f0: 2074 6f20 7072 696e 7420 6f75 7420 696e   to print out in
-00005500: 666f 726d 6174 696f 6e2e 2050 726f 6365  formation. Proce
-00005510: 7373 696e 6720 6973 2066 6173 7465 7220  ssing is faster 
-00005520: 6966 2076 6572 626f 7365 2069 7320 4661  if verbose is Fa
-00005530: 6c73 652e 2044 6566 6175 6c74 3a20 5472  lse. Default: Tr
-00005540: 7565 2e0a 2020 2020 2020 2020 2d20 6967  ue..        - ig
-00005550: 6e6f 7265 5f69 6d61 6765 5f66 696c 6573  nore_image_files
-00005560: 3a20 626f 6f6c 2077 6865 7468 6572 2069  : bool whether i
-00005570: 7427 7320 6163 6365 7074 6564 2074 6861  t's accepted tha
-00005580: 7420 7468 6572 6520 6172 6520 6e6f 7420  t there are not 
-00005590: 696d 6167 6573 2079 6574 2069 6e20 2764  images yet in 'd
-000055a0: 6972 272e 2044 6566 6175 6c74 3a20 4661  ir'. Default: Fa
-000055b0: 6c73 652e 0a20 2020 2020 2020 202d 2077  lse..        - w
-000055c0: 7269 7465 546d 7050 726f 7646 696c 653a  riteTmpProvFile:
-000055d0: 2062 6f6f 6c20 7768 6574 6865 7220 746f   bool whether to
-000055e0: 2077 7269 7465 2061 2074 656d 706f 7261   write a tempora
-000055f0: 7279 2070 726f 7665 6e61 6e63 6520 6669  ry provenance fi
-00005600: 6c65 2064 7572 696e 6720 7468 6520 6946  le during the iF
-00005610: 444f 2063 7265 6174 696f 6e20 7072 6f63  DO creation proc
-00005620: 6573 7320 7768 6963 6820 7769 6c6c 2062  ess which will b
-00005630: 6520 7265 706c 6163 6564 2062 7920 6120  e replaced by a 
-00005640: 6669 6e61 6c20 6f6e 6520 696e 2074 6865  final one in the
-00005650: 2065 6e64 2e20 4465 6661 756c 743a 2054   end. Default: T
-00005660: 7275 650a 2020 2020 2020 2020 2d20 696d  rue.        - im
-00005670: 6167 655f 6272 6f6b 6572 5f75 7569 643a  age_broker_uuid:
-00005680: 2075 7569 6420 6f66 2069 6d61 6765 2062   uuid of image b
-00005690: 726f 6b65 7220 746f 2063 7265 6174 6520  roker to create 
-000056a0: 696d 6167 6520 6861 6e64 6c65 7320 6173  image handles as
-000056b0: 2068 7474 7073 3a2f 2f68 646c 2e68 616e   https://hdl.han
-000056c0: 646c 652e 6e65 742f 3c68 616e 646c 655f  dle.net/<handle_
-000056d0: 7072 6566 6978 3e2f 3c69 6d61 6765 5f62  prefix>/<image_b
-000056e0: 726f 6b65 725f 7575 6964 3e40 3c69 6d61  roker_uuid>@<ima
-000056f0: 6765 2d75 7569 643e 2022 2222 0a20 2020  ge-uuid> """.   
-00005700: 200a 2020 2020 7265 6164 6572 203d 2069   .    reader = i
-00005710: 4644 4f5f 5265 6164 6572 2869 4644 4f66  FDO_Reader(iFDOf
-00005720: 696c 6529 0a20 2020 2069 6d61 6765 7344  ile).    imagesD
-00005730: 6972 203d 206d 6971 7463 2e74 6f55 6e69  ir = miqtc.toUni
-00005740: 7850 6174 6828 6f73 2e70 6174 682e 6e6f  xPath(os.path.no
-00005750: 726d 7061 7468 286d 6971 7463 2e74 6f55  rmpath(miqtc.toU
-00005760: 6e69 7850 6174 6828 7265 6164 6572 2e67  nixPath(reader.g
-00005770: 6574 496d 6167 6544 6972 6563 746f 7279  etImageDirectory
-00005780: 2829 2929 290a 2020 2020 6261 7365 4469  ()))).    baseDi
-00005790: 7220 3d20 6d69 7174 632e 746f 556e 6978  r = miqtc.toUnix
-000057a0: 5061 7468 286f 732e 7061 7468 2e63 6f6d  Path(os.path.com
-000057b0: 6d6f 6e70 6174 6828 5b69 4644 4f66 696c  monpath([iFDOfil
-000057c0: 652c 696d 6167 6573 4469 725d 2929 0a20  e,imagesDir])). 
-000057d0: 2020 2069 6d61 6765 4461 7461 5479 7065     imageDataType
-000057e0: 466f 6c64 6572 203d 205b 6520 666f 7220  Folder = [e for 
-000057f0: 6520 696e 2069 6d61 6765 7344 6972 2e72  e in imagesDir.r
-00005800: 6570 6c61 6365 2862 6173 6544 6972 2c22  eplace(baseDir,"
-00005810: 2229 2e73 706c 6974 2822 2f22 2920 6966  ").split("/") if
-00005820: 2065 2021 3d20 2222 5d5b 305d 0a20 2020   e != ""][0].   
-00005830: 2069 6620 696d 6167 6544 6174 6154 7970   if imageDataTyp
-00005840: 6546 6f6c 6465 7220 6e6f 7420 696e 206d  eFolder not in m
-00005850: 6971 7464 2e44 6972 2e64 742e 5f5f 6d65  iqtd.Dir.dt.__me
-00005860: 6d62 6572 735f 5f3a 0a20 2020 2020 2020  mbers__:.       
-00005870: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
-00005880: 6f45 7863 6570 7469 6f6e 2822 496d 6167  oException("Imag
-00005890: 6573 2061 7265 206e 6f74 206c 6f63 6174  es are not locat
-000058a0: 6564 2069 6e20 6120 7661 6c69 6420 6461  ed in a valid da
-000058b0: 7461 2074 7970 6520 6469 7265 6374 6f72  ta type director
-000058c0: 7920 2872 6177 2c20 696e 7465 726d 6564  y (raw, intermed
-000058d0: 6961 7465 2c20 7072 6f63 6573 7365 642c  iate, processed,
-000058e0: 202e 2e2e 2920 696e 2074 6865 2073 616d   ...) in the sam
-000058f0: 6520 7072 6f6a 6563 7420 6173 2069 4644  e project as iFD
-00005900: 4f20 6669 6c65 2e22 290a 2020 2020 696d  O file.").    im
-00005910: 6167 6573 4461 7461 5479 7065 4469 7220  agesDataTypeDir 
-00005920: 3d20 6f73 2e70 6174 682e 6a6f 696e 2862  = os.path.join(b
-00005930: 6173 6544 6972 2c69 6d61 6765 4461 7461  aseDir,imageData
-00005940: 5479 7065 466f 6c64 6572 290a 2020 2020  TypeFolder).    
-00005950: 6469 724f 626a 203d 206d 6971 7464 2e44  dirObj = miqtd.D
-00005960: 6972 2822 222c 696d 6167 6573 4461 7461  ir("",imagesData
-00005970: 5479 7065 4469 722c 2063 7265 6174 653d  TypeDir, create=
-00005980: 4661 6c73 652c 2077 6974 685f 6765 6172  False, with_gear
-00005990: 3d46 616c 7365 290a 2020 2020 7265 7475  =False).    retu
-000059a0: 726e 2069 4644 4f28 6469 723d 6469 724f  rn iFDO(dir=dirO
-000059b0: 626a 2c68 616e 646c 655f 7072 6566 6978  bj,handle_prefix
-000059c0: 3d68 616e 646c 655f 7072 6566 6978 2c70  =handle_prefix,p
-000059d0: 726f 7665 6e61 6e63 653d 7072 6f76 656e  rovenance=proven
-000059e0: 616e 6365 2c76 6572 626f 7365 3d76 6572  ance,verbose=ver
-000059f0: 626f 7365 2c69 676e 6f72 655f 696d 6167  bose,ignore_imag
-00005a00: 655f 6669 6c65 733d 6967 6e6f 7265 5f69  e_files=ignore_i
-00005a10: 6d61 6765 5f66 696c 6573 2c77 7269 7465  mage_files,write
-00005a20: 546d 7050 726f 7646 696c 653d 7772 6974  TmpProvFile=writ
-00005a30: 6554 6d70 5072 6f76 4669 6c65 2c69 4644  eTmpProvFile,iFD
-00005a40: 4f66 696c 653d 6946 444f 6669 6c65 2c69  Ofile=iFDOfile,i
-00005a50: 6d61 6765 5f62 726f 6b65 725f 7575 6964  mage_broker_uuid
-00005a60: 3d69 6d61 6765 5f62 726f 6b65 725f 7575  =image_broker_uu
-00005a70: 6964 290a 0a0a 636c 6173 7320 6946 444f  id)...class iFDO
-00005a80: 3a0a 2020 2020 2220 436c 6173 7320 666f  :.    " Class fo
-00005a90: 7220 6372 6561 7469 6e67 2061 6e64 2065  r creating and e
-00005aa0: 6469 7469 6e67 2069 4644 4f2e 7961 6d6c  diting iFDO.yaml
-00005ab0: 2066 696c 6573 2022 0a0a 2020 2020 6465   files "..    de
-00005ac0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00005ad0: 2064 6972 3a6d 6971 7464 2e44 6972 2c20   dir:miqtd.Dir, 
-00005ae0: 6861 6e64 6c65 5f70 7265 6669 783d 2732  handle_prefix='2
-00005af0: 302e 3530 302e 3132 3038 3527 2c70 726f  0.500.12085',pro
-00005b00: 7665 6e61 6e63 6520 3d20 4e6f 6e65 2c76  venance = None,v
-00005b10: 6572 626f 7365 3d54 7275 652c 6967 6e6f  erbose=True,igno
-00005b20: 7265 5f69 6d61 6765 5f66 696c 6573 3d46  re_image_files=F
-00005b30: 616c 7365 2c77 7269 7465 546d 7050 726f  alse,writeTmpPro
-00005b40: 7646 696c 653d 5472 7565 2c69 4644 4f66  vFile=True,iFDOf
-00005b50: 696c 653d 4e6f 6e65 2c69 6d61 6765 5f62  ile=None,image_b
-00005b60: 726f 6b65 725f 7575 6964 3d22 6565 3237  roker_uuid="ee27
-00005b70: 3735 3738 2d61 3931 312d 3438 3464 2d61  7578-a911-484d-a
-00005b80: 3531 352d 3963 3738 3164 3739 6161 3931  515-9c781d79aa91
-00005b90: 2229 3a0a 2020 2020 2020 2020 2222 2220  "):.        """ 
-00005ba0: 4372 6561 7465 7320 616e 2069 464f 4420  Creates an iFOD 
-00005bb0: 6f62 6a65 6374 2e20 5265 7175 6972 6573  object. Requires
-00005bc0: 2061 2076 616c 6964 2064 6972 6563 746f   a valid directo
-00005bd0: 7279 2063 6f6e 7461 696e 696e 6720 696d  ry containing im
-00005be0: 6167 6520 6461 7461 206f 722f 616e 6420  age data or/and 
-00005bf0: 616e 6420 6946 444f 2066 696c 6520 616e  and iFDO file an
-00005c00: 6420 6120 6861 6e64 6c65 2070 7265 6669  d a handle prefi
-00005c10: 7820 6966 2069 7427 7320 6e6f 7420 7468  x if it's not th
-00005c20: 6520 4765 6f6d 6172 206f 6e65 2e20 4c6f  e Geomar one. Lo
-00005c30: 6164 7320 6469 7265 6374 6f72 7927 7320  ads directory's 
-00005c40: 6946 444f 2066 696c 6520 6966 2069 7420  iFDO file if it 
-00005c50: 6578 6973 7473 2061 6c72 6561 6479 2e0a  exists already..
-00005c60: 2020 2020 2020 2020 2020 2020 2d20 6469              - di
-00005c70: 723a 206d 6172 6971 742e 6469 7265 6374  r: mariqt.direct
-00005c80: 6f72 6965 732e 4469 7220 6f62 6a65 6374  ories.Dir object
-00005c90: 2070 6f69 6e74 696e 6720 746f 2061 2076   pointing to a v
-00005ca0: 616c 6964 2064 6174 6120 7479 7065 2064  alid data type d
-00005cb0: 6972 6563 746f 7279 2028 7261 772c 2069  irectory (raw, i
-00005cc0: 6e74 6572 6d65 6469 6174 652c 2070 726f  ntermediate, pro
-00005cd0: 6365 7373 6564 2c20 2e2e 2e29 2063 6f6e  cessed, ...) con
-00005ce0: 7461 696e 696e 6720 7468 6520 696d 6167  taining the imag
-00005cf0: 6520 6461 7461 2e0a 2020 2020 2020 2020  e data..        
-00005d00: 2020 2020 2d20 6861 6e64 6c65 5f70 7265      - handle_pre
-00005d10: 6669 783a 2073 7472 696e 6720 7072 6566  fix: string pref
-00005d20: 6978 206f 6620 7468 6520 6861 6e64 6c65  ix of the handle
-00005d30: 2073 6572 7665 722e 2044 6566 6175 6c74   server. Default
-00005d40: 3a20 7468 6520 6f6e 6520 666f 7220 4765  : the one for Ge
-00005d50: 6f6d 6172 2e0a 2020 2020 2020 2020 2020  omar..          
-00005d60: 2020 2d20 7072 6f76 656e 616e 6365 3a20    - provenance: 
-00005d70: 6d61 7269 7174 2e70 726f 7665 6e63 616e  mariqt.provencan
-00005d80: 6365 2e50 726f 7665 6e61 6e63 6520 6f62  ce.Provenance ob
-00005d90: 6a65 6374 2074 6f20 7472 6163 6b20 6461  ject to track da
-00005da0: 7461 2070 726f 7665 6e61 6e63 652e 2044  ta provenance. D
-00005db0: 6566 6175 6c74 3a20 6120 6e65 7720 7072  efault: a new pr
-00005dc0: 6f76 656e 616e 6365 206f 626a 6563 7420  ovenance object 
-00005dd0: 6973 2063 7265 6174 6564 2069 6e20 7468  is created in th
-00005de0: 6520 2770 726f 746f 636f 6c27 2073 7562  e 'protocol' sub
-00005df0: 666f 6c64 6572 2e0a 2020 2020 2020 2020  folder..        
-00005e00: 2020 2020 2d20 7665 7262 6f73 653a 2062      - verbose: b
-00005e10: 6f6f 6c20 7768 6574 6865 7220 746f 2070  ool whether to p
-00005e20: 7269 6e74 206f 7574 2069 6e66 6f72 6d61  rint out informa
-00005e30: 7469 6f6e 2e20 4465 6661 756c 743a 2054  tion. Default: T
-00005e40: 7275 652e 0a20 2020 2020 2020 2020 2020  rue..           
-00005e50: 202d 2069 676e 6f72 655f 696d 6167 655f   - ignore_image_
-00005e60: 6669 6c65 733a 2069 6d61 6765 7320 6669  files: images fi
-00005e70: 6c65 7320 6172 6520 6967 6e6f 7265 642e  les are ignored.
-00005e80: 2054 6865 7920 6172 6520 6e6f 7420 7365   They are not se
-00005e90: 6172 6368 6564 2066 6f72 2069 6e20 2772  arched for in 'r
-00005ea0: 6177 2720 616e 6420 6974 656d 7320 7661  aw' and items va
-00005eb0: 6c75 6573 2061 7265 206e 6f74 2075 7064  lues are not upd
-00005ec0: 6174 6564 206e 6f72 2063 6865 636b 6564  ated nor checked
-00005ed0: 2e20 4465 6661 756c 7420 3d20 4661 6c73  . Default = Fals
-00005ee0: 650a 2020 2020 2020 2020 2020 2020 2d20  e.            - 
-00005ef0: 7772 6974 6554 6d70 5072 6f76 4669 6c65  writeTmpProvFile
-00005f00: 3a20 626f 6f6c 2077 6865 7468 6572 2074  : bool whether t
-00005f10: 6f20 7772 6974 6520 6120 7465 6d70 6f72  o write a tempor
-00005f20: 6172 7920 7072 6f76 656e 616e 6365 2066  ary provenance f
-00005f30: 696c 6520 6475 7269 6e67 2074 6865 2069  ile during the i
-00005f40: 4644 4f20 6372 6561 7469 6f6e 2070 726f  FDO creation pro
-00005f50: 6365 7373 2077 6869 6368 2077 696c 6c20  cess which will 
-00005f60: 6265 2072 6570 6c61 6365 6420 6279 2061  be replaced by a
-00005f70: 2066 696e 616c 206f 6e65 2069 6e20 7468   final one in th
-00005f80: 6520 656e 642e 2044 6566 6175 6c74 3a20  e end. Default: 
-00005f90: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00005fa0: 202d 2069 4644 4f66 696c 653a 2073 7472   - iFDOfile: str
-00005fb0: 696e 6720 7061 7468 2074 6f20 6c6f 6164  ing path to load
-00005fc0: 2061 6e20 6578 706c 6963 6974 2069 4644   an explicit iFD
-00005fd0: 4f20 6669 6c65 2e20 4966 206e 6f74 2070  O file. If not p
-00005fe0: 726f 7669 6465 6420 6120 6d61 7463 6869  rovided a matchi
-00005ff0: 6e67 2069 4644 4f20 6669 6c65 2028 6966  ng iFDO file (if
-00006000: 2069 7420 616c 7265 6164 7920 6578 6973   it already exis
-00006010: 7473 2920 7769 6c6c 2062 6520 6c6f 6164  ts) will be load
-00006020: 6564 2066 726f 6d20 7468 6520 2770 726f  ed from the 'pro
-00006030: 6475 6374 7327 2073 7562 6469 7265 6374  ducts' subdirect
-00006040: 6f72 792e 2044 6566 6175 6c74 3a20 4e6f  ory. Default: No
-00006050: 6e65 200a 2020 2020 2020 2020 2020 2020  ne .            
-00006060: 2d20 696d 6167 655f 6272 6f6b 6572 5f75  - image_broker_u
-00006070: 7569 643a 2075 7569 6420 6f66 2069 6d61  uid: uuid of ima
-00006080: 6765 2062 726f 6b65 7220 746f 2063 7265  ge broker to cre
-00006090: 6174 6520 696d 6167 6520 6861 6e64 6c65  ate image handle
-000060a0: 7320 6173 2068 7474 7073 3a2f 2f68 646c  s as https://hdl
-000060b0: 2e68 616e 646c 652e 6e65 742f 3c68 616e  .handle.net/<han
-000060c0: 646c 655f 7072 6566 6978 3e2f 3c69 6d61  dle_prefix>/<ima
-000060d0: 6765 5f62 726f 6b65 725f 7575 6964 3e40  ge_broker_uuid>@
-000060e0: 3c69 6d61 6765 2d75 7569 643e 2022 2222  <image-uuid> """
-000060f0: 0a0a 2020 2020 2020 2020 2320 6368 6563  ..        # chec
-00006100: 6b20 7468 6174 2061 7420 6469 7220 6f72  k that at dir or
-00006110: 2069 4644 4f66 696c 6520 7072 6f76 6964   iFDOfile provid
-00006120: 6564 0a20 2020 2020 2020 2069 6620 6469  ed.        if di
-00006130: 7220 6973 204e 6f6e 6520 616e 6420 6946  r is None and iF
-00006140: 444f 6669 6c65 2069 7320 4e6f 6e65 3a0a  DOfile is None:.
-00006150: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00006160: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
-00006170: 7074 696f 6e28 224e 6569 7468 6572 2064  ption("Neither d
-00006180: 6972 206e 6f72 2069 4644 4f66 696c 6520  ir nor iFDOfile 
-00006190: 7072 6f76 6964 6564 2066 6f72 2069 4644  provided for iFD
-000061a0: 4f2e 2229 0a0a 2020 2020 2020 2020 7365  O.")..        se
-000061b0: 6c66 2e64 6972 203d 2064 6972 0a20 2020  lf.dir = dir.   
-000061c0: 2020 2020 2073 656c 662e 696d 6167 6573       self.images
-000061d0: 4469 7220 3d20 6469 722e 746f 7479 7065  Dir = dir.totype
-000061e0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-000061f0: 6469 722e 6372 6561 7465 5479 7065 466f  dir.createTypeFo
-00006200: 6c64 6572 2829 0a20 2020 2020 2020 2073  lder().        s
-00006210: 656c 662e 6861 6e64 6c65 5f70 7265 6669  elf.handle_prefi
-00006220: 7820 3d20 2268 7474 7073 3a2f 2f68 646c  x = "https://hdl
-00006230: 2e68 616e 646c 652e 6e65 742f 2220 2b20  .handle.net/" + 
-00006240: 6861 6e64 6c65 5f70 7265 6669 780a 2020  handle_prefix.  
-00006250: 2020 2020 2020 7365 6c66 2e69 6d61 6765        self.image
-00006260: 5f68 616e 646c 655f 7072 6566 6978 203d  _handle_prefix =
-00006270: 2073 656c 662e 6861 6e64 6c65 5f70 7265   self.handle_pre
-00006280: 6669 7820 2b20 222f 2220 2b20 696d 6167  fix + "/" + imag
-00006290: 655f 6272 6f6b 6572 5f75 7569 640a 2020  e_broker_uuid.  
-000062a0: 2020 2020 2020 7365 6c66 2e69 676e 6f72        self.ignor
-000062b0: 655f 696d 6167 655f 6669 6c65 7320 3d20  e_image_files = 
-000062c0: 6967 6e6f 7265 5f69 6d61 6765 5f66 696c  ignore_image_fil
-000062d0: 6573 0a0a 2020 2020 2020 2020 7365 6c66  es..        self
-000062e0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-000062f0: 6579 203d 206d 6971 7476 2e69 6d61 6765  ey = miqtv.image
-00006300: 5f73 6574 5f68 6561 6465 725f 6b65 790a  _set_header_key.
-00006310: 2020 2020 2020 2020 7365 6c66 2e69 6d61          self.ima
-00006320: 6765 5365 7449 7465 6d73 4b65 7920 3d20  geSetItemsKey = 
-00006330: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
-00006340: 6974 656d 735f 6b65 790a 2020 2020 2020  items_key.      
-00006350: 2020 7365 6c66 2e69 6664 6f5f 746d 7020    self.ifdo_tmp 
-00006360: 3d20 7b73 656c 662e 696d 6167 6553 6574  = {self.imageSet
-00006370: 4865 6164 6572 4b65 793a 207b 7d2c 0a20  HeaderKey: {},. 
-00006380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006390: 2020 2020 2020 2020 7365 6c66 2e69 6d61          self.ima
-000063a0: 6765 5365 7449 7465 6d73 4b65 793a 207b  geSetItemsKey: {
-000063b0: 7d7d 0a20 2020 2020 2020 2073 656c 662e  }}.        self.
-000063c0: 6966 646f 5f70 6172 7365 6420 3d20 4e6f  ifdo_parsed = No
-000063d0: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
-000063e0: 6966 646f 5f63 6865 636b 6564 203d 2063  ifdo_checked = c
-000063f0: 6f70 792e 6465 6570 636f 7079 2873 656c  opy.deepcopy(sel
-00006400: 662e 6966 646f 5f74 6d70 2920 2023 2074  f.ifdo_tmp)  # t
-00006410: 6f20 6265 2073 6574 2062 7920 6372 6561  o be set by crea
-00006420: 7465 6946 444f 2829 206f 6e6c 7921 0a20  teiFDO() only!. 
-00006430: 2020 2020 2020 2073 656c 662e 5f5f 616c         self.__al
-00006440: 6c55 5549 4473 4368 6563 6b65 6420 3d20  lUUIDsChecked = 
-00006450: 4661 6c73 650a 2020 2020 2020 2020 7365  False.        se
-00006460: 6c66 2e70 726f 7620 3d20 7072 6f76 656e  lf.prov = proven
-00006470: 616e 6365 0a20 2020 2020 2020 2069 6620  ance.        if 
-00006480: 7072 6f76 656e 616e 6365 203d 3d20 4e6f  provenance == No
-00006490: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000064a0: 746d 7046 696c 6550 6174 6820 3d20 2222  tmpFilePath = ""
-000064b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000064c0: 7772 6974 6554 6d70 5072 6f76 4669 6c65  writeTmpProvFile
-000064d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000064e0: 2020 746d 7046 696c 6550 6174 6820 3d20    tmpFilePath = 
-000064f0: 7365 6c66 2e64 6972 2e74 6f28 7365 6c66  self.dir.to(self
-00006500: 2e64 6972 2e64 742e 7072 6f74 6f63 6f6c  .dir.dt.protocol
-00006510: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00006520: 6c66 2e70 726f 7620 3d20 6d69 7174 702e  lf.prov = miqtp.
-00006530: 5072 6f76 656e 616e 6365 2822 6946 444f  Provenance("iFDO
-00006540: 222c 7665 7262 6f73 653d 7665 7262 6f73  ",verbose=verbos
-00006550: 652c 746d 7046 696c 6550 6174 683d 746d  e,tmpFilePath=tm
-00006560: 7046 696c 6550 6174 6829 0a0a 2020 2020  pFilePath)..    
-00006570: 2020 2020 2320 7365 7420 676c 6f62 616c      # set global
-00006580: 2076 6572 626f 7369 7479 0a20 2020 2020   verbosity.     
-00006590: 2020 206d 6971 7476 2e73 6574 476c 6f62     miqtv.setGlob
-000065a0: 616c 5665 7262 6f73 6528 7665 7262 6f73  alVerbose(verbos
-000065b0: 6529 0a0a 2020 2020 2020 2020 6966 206e  e)..        if n
-000065c0: 6f74 2064 6972 2e65 7869 7374 7328 293a  ot dir.exists():
-000065d0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-000065e0: 7365 2045 7863 6570 7469 6f6e 2822 6469  se Exception("di
-000065f0: 7265 6374 726f 7922 2c20 6469 722e 7374  rectroy", dir.st
-00006600: 7228 292c 2022 646f 6573 206e 6f74 2065  r(), "does not e
-00006610: 7869 7374 2e22 290a 0a20 2020 2020 2020  xist.")..       
-00006620: 2069 6620 6e6f 7420 6469 722e 7661 6c69   if not dir.vali
-00006630: 6444 6174 6144 6972 2829 3a0a 2020 2020  dDataDir():.    
-00006640: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-00006650: 6365 7074 696f 6e28 2264 6972 6563 7472  ception("directr
-00006660: 6f79 222c 2064 6972 2e73 7472 2829 2c20  oy", dir.str(), 
-00006670: 226e 6f74 2076 616c 6964 2e20 446f 6573  "not valid. Does
-00006680: 206e 6f74 2063 6f6d 706c 7920 7769 7468   not comply with
-00006690: 2073 7472 7563 7475 7265 202f 6261 7365   structure /base
-000066a0: 2f70 726f 6a65 6374 2f5b 4765 6172 2f5d  /project/[Gear/]
-000066b0: 6576 656e 742f 7365 6e73 6f72 2f64 6174  event/sensor/dat
-000066c0: 615f 7479 7065 2f22 290a 0a20 2020 2020  a_type/")..     
-000066d0: 2020 2023 2063 6865 636b 2069 4644 4f20     # check iFDO 
-000066e0: 6669 6c65 0a20 2020 2020 2020 2073 656c  file.        sel
-000066f0: 662e 6946 444f 6669 6c65 5f20 3d20 2222  f.iFDOfile_ = ""
-00006700: 2023 2069 7320 7365 7420 6279 2073 6574   # is set by set
-00006710: 6946 444f 4669 6c65 4e61 6d65 2829 0a20  iFDOFileName(). 
-00006720: 2020 2020 2020 206c 6f61 6465 6469 4644         loadediFD
-00006730: 4f20 3d20 4661 6c73 650a 2020 2020 2020  O = False.      
-00006740: 2020 6966 206e 6f74 2069 4644 4f66 696c    if not iFDOfil
-00006750: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-00006760: 2020 2020 2020 2069 4644 4f66 696c 655f         iFDOfile_
-00006770: 203d 2069 4644 4f66 696c 650a 2020 2020   = iFDOfile.    
-00006780: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-00006790: 6946 444f 4669 6c65 4e61 6d65 2869 4644  iFDOFileName(iFD
-000067a0: 4f66 696c 655f 290a 2020 2020 2020 2020  Ofile_).        
-000067b0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-000067c0: 7468 2e69 7366 696c 6528 6946 444f 6669  th.isfile(iFDOfi
-000067d0: 6c65 5f29 3a0a 2020 2020 2020 2020 2020  le_):.          
-000067e0: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
-000067f0: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
-00006800: 2269 4644 4f20 6669 6c65 206e 6f74 2066  "iFDO file not f
-00006810: 6f75 6e64 3a20 2220 2b20 6946 444f 6669  ound: " + iFDOfi
-00006820: 6c65 5f29 0a20 2020 2020 2020 2065 6c73  le_).        els
-00006830: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-00006840: 4644 4f66 696c 655f 203d 2073 656c 662e  FDOfile_ = self.
-00006850: 6469 722e 746f 2873 656c 662e 6469 722e  dir.to(self.dir.
-00006860: 6474 2e70 726f 6475 6374 7329 2b73 656c  dt.products)+sel
-00006870: 662e 636f 6e73 7472 7563 7469 4644 4f66  f.constructiFDOf
-00006880: 696c 654e 616d 6528 7365 6c66 2e64 6972  ileName(self.dir
-00006890: 2e70 726f 6a65 6374 2829 2c73 656c 662e  .project(),self.
-000068a0: 6469 722e 6576 656e 7428 292c 7365 6c66  dir.event(),self
-000068b0: 2e64 6972 2e73 656e 736f 7228 2929 0a0a  .dir.sensor())..
-000068c0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-000068d0: 2073 656c 662e 5f69 6d61 6765 7349 6e49   self._imagesInI
-000068e0: 6d61 6765 7344 6972 203d 205b 5d0a 2020  magesDir = [].  
-000068f0: 2020 2020 2020 6966 2073 656c 662e 6967        if self.ig
-00006900: 6e6f 7265 5f69 6d61 6765 5f66 696c 6573  nore_image_files
-00006910: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00006920: 696e 7428 2243 6175 7469 6f6e 2120 7275  int("Caution! ru
-00006930: 6e6e 696e 6720 696e 2069 676e 6f72 655f  nning in ignore_
-00006940: 696d 6167 655f 6669 6c65 7320 6d6f 6465  image_files mode
-00006950: 2e22 290a 2020 2020 2020 2020 656c 7365  .").        else
-00006960: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00006970: 6c66 2e5f 696d 6167 6573 496e 496d 6167  lf._imagesInImag
-00006980: 6573 4469 7220 3d20 6d69 7174 692e 6272  esDir = miqti.br
-00006990: 6f77 7365 466f 7249 6d61 6765 4669 6c65  owseForImageFile
-000069a0: 7328 7365 6c66 2e69 6d61 6765 7344 6972  s(self.imagesDir
-000069b0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-000069c0: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
-000069d0: 7253 6f72 7465 644c 6973 7420 3d20 5b66  rSortedList = [f
-000069e0: 696c 6520 666f 7220 6669 6c65 2069 6e20  ile for file in 
-000069f0: 7365 6c66 2e5f 696d 6167 6573 496e 496d  self._imagesInIm
-00006a00: 6167 6573 4469 725d 0a20 2020 2020 2020  agesDir].       
-00006a10: 2073 656c 662e 5f69 6d61 6765 7349 6e49   self._imagesInI
-00006a20: 6d61 6765 7344 6972 536f 7274 6564 4c69  magesDirSortedLi
-00006a30: 7374 2e73 6f72 7428 290a 2020 2020 2020  st.sort().      
-00006a40: 2020 7365 6c66 2e5f 696d 6167 654e 616d    self._imageNam
-00006a50: 6573 496d 6167 6573 4469 7220 3d20 5b6f  esImagesDir = [o
-00006a60: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-00006a70: 6669 6c65 2920 666f 7220 6669 6c65 2069  file) for file i
-00006a80: 6e20 7365 6c66 2e5f 696d 6167 6573 496e  n self._imagesIn
-00006a90: 496d 6167 6573 4469 725d 0a0a 2020 2020  ImagesDir]..    
-00006aa0: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
-00006ab0: 5f69 6d61 6765 7349 6e49 6d61 6765 7344  _imagesInImagesD
-00006ac0: 6972 2920 3d3d 2030 2061 6e64 206e 6f74  ir) == 0 and not
-00006ad0: 2069 676e 6f72 655f 696d 6167 655f 6669   ignore_image_fi
-00006ae0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-00006af0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-00006b00: 2822 4e6f 2069 6d61 6765 7320 6669 6c65  ("No images file
-00006b10: 7320 666f 756e 6420 696e 2022 202b 2073  s found in " + s
-00006b20: 656c 662e 696d 6167 6573 4469 7220 2b20  elf.imagesDir + 
-00006b30: 2220 616e 6420 6974 7320 7375 6264 6972  " and its subdir
-00006b40: 6563 746f 7269 6573 2229 0a0a 2020 2020  ectories")..    
-00006b50: 2020 2020 756e 6971 7565 2c20 6475 7020      unique, dup 
-00006b60: 3d20 6d69 7174 742e 6669 6c65 7348 6176  = miqtt.filesHav
-00006b70: 6555 6e69 7175 654e 616d 6528 7365 6c66  eUniqueName(self
-00006b80: 2e5f 696d 6167 6573 496e 496d 6167 6573  ._imagesInImages
-00006b90: 4469 7229 0a20 2020 2020 2020 2069 6620  Dir).        if 
-00006ba0: 6e6f 7420 756e 6971 7565 3a0a 2020 2020  not unique:.    
-00006bb0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-00006bc0: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
-00006bd0: 2020 2020 2020 2020 2022 4e6f 7420 616c           "Not al
-00006be0: 6c20 6669 6c65 7320 6861 7665 2075 6e69  l files have uni
-00006bf0: 7175 6520 6e61 6d65 732e 2044 7570 6c69  que names. Dupli
-00006c00: 6361 7465 733a 2022 202b 2073 7472 2864  cates: " + str(d
-00006c10: 7570 2929 0a0a 2020 2020 2020 2020 616c  up))..        al
-00006c20: 6c76 616c 6964 2c20 6d73 6720 3d20 6d69  lvalid, msg = mi
-00006c30: 7174 742e 616c 6c49 6d61 6765 4e61 6d65  qtt.allImageName
-00006c40: 7356 616c 6964 2873 656c 662e 5f69 6d61  sValid(self._ima
-00006c50: 6765 7349 6e49 6d61 6765 7344 6972 2920  gesInImagesDir) 
-00006c60: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00006c70: 616c 6c76 616c 6964 3a0a 2020 2020 2020  allvalid:.      
-00006c80: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-00006c90: 7074 696f 6e28 6d73 6729 0a0a 2020 2020  ption(msg)..    
-00006ca0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-00006cb0: 6728 7374 7228 6c65 6e28 7365 6c66 2e5f  g(str(len(self._
-00006cc0: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
-00006cd0: 7229 2920 2b20 2220 696d 6167 6520 6669  r)) + " image fi
-00006ce0: 6c65 7320 666f 756e 642e 2229 0a20 2020  les found.").   
-00006cf0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-00006d00: 6f67 2822 2229 0a20 2020 2020 2020 2073  og("").        s
-00006d10: 656c 662e 7072 6f76 2e6c 6f67 2822 466f  elf.prov.log("Fo
-00006d20: 6c6c 6f77 696e 6720 696e 666f 726d 6174  llowing informat
-00006d30: 696f 6e20 7761 7320 7061 7273 6564 2066  ion was parsed f
-00006d40: 726f 6d20 6469 7265 6374 6f72 792c 2070  rom directory, p
-00006d50: 6c65 6173 6520 6368 6563 6b20 666f 7220  lease check for 
-00006d60: 636f 7272 6563 746e 6573 733a 2229 0a20  correctness:"). 
-00006d70: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-00006d80: 2e6c 6f67 2822 5072 6f6a 6563 743a 5c74  .log("Project:\t
-00006d90: 222b 7365 6c66 2e64 6972 2e70 726f 6a65  "+self.dir.proje
-00006da0: 6374 2829 290a 2020 2020 2020 2020 6966  ct()).        if
-00006db0: 2073 656c 662e 6469 722e 7769 7468 5f67   self.dir.with_g
-00006dc0: 6561 723a 0a20 2020 2020 2020 2020 2020  ear:.           
-00006dd0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-00006de0: 4765 6172 3a5c 745c 7422 2b73 656c 662e  Gear:\t\t"+self.
-00006df0: 6469 722e 6765 6172 2829 290a 2020 2020  dir.gear()).    
-00006e00: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-00006e10: 6728 2245 7665 6e74 3a5c 745c 7422 2b73  g("Event:\t\t"+s
-00006e20: 656c 662e 6469 722e 6576 656e 7428 2929  elf.dir.event())
-00006e30: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
-00006e40: 6f76 2e6c 6f67 2822 5365 6e73 6f72 3a5c  ov.log("Sensor:\
-00006e50: 745c 7422 2b73 656c 662e 6469 722e 7365  t\t"+self.dir.se
-00006e60: 6e73 6f72 2829 290a 2020 2020 2020 2020  nsor()).        
-00006e70: 7365 6c66 2e70 726f 762e 6c6f 6728 2222  self.prov.log(""
-00006e80: 290a 0a20 2020 2020 2020 2023 2069 6e74  )..        # int
-00006e90: 6572 6d65 6469 6174 6520 6669 6c65 730a  ermediate files.
-00006ea0: 2020 2020 2020 2020 7365 6c66 2e5f 5f69          self.__i
-00006eb0: 6e69 7449 6e74 6572 6d65 6469 6174 6546  nitIntermediateF
-00006ec0: 696c 6573 2829 2020 2020 0a0a 2020 2020  iles()    ..    
-00006ed0: 2020 2020 2320 7472 7920 6c6f 6164 2065      # try load e
-00006ee0: 7869 7374 696e 6720 6946 444f 2066 696c  xisting iFDO fil
-00006ef0: 650a 2020 2020 2020 2020 6966 2873 656c  e.        if(sel
-00006f00: 662e 7265 6164 6946 444f 6669 6c65 2869  f.readiFDOfile(i
-00006f10: 4644 4f66 696c 655f 2929 3a0a 2020 2020  FDOfile_)):.    
-00006f20: 2020 2020 2020 2020 6c6f 6164 6564 6946          loadediF
-00006f30: 444f 203d 2054 7275 650a 2020 2020 2020  DO = True.      
-00006f40: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00006f50: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00006f60: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
-00006f70: 7365 6c66 2e64 6972 2e74 6f28 7365 6c66  self.dir.to(self
-00006f80: 2e64 6972 2e64 742e 7072 6f64 7563 7473  .dir.dt.products
-00006f90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00006fa0: 2020 666f 7220 6669 6c65 5f20 696e 206f    for file_ in o
-00006fb0: 732e 6c69 7374 6469 7228 7061 7468 293a  s.listdir(path):
-00006fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006fd0: 2020 2020 2069 6620 6669 6c65 5f5b 2d31       if file_[-1
-00006fe0: 303a 2d34 5d20 3d3d 2022 5f69 4644 4f2e  0:-4] == "_iFDO.
-00006ff0: 2220 616e 6420 7365 6c66 2e72 6561 6469  " and self.readi
-00007000: 4644 4f66 696c 6528 7061 7468 2b66 696c  FDOfile(path+fil
-00007010: 655f 293a 0a20 2020 2020 2020 2020 2020  e_):.           
-00007020: 2020 2020 2020 2020 2020 2020 206c 6f61               loa
-00007030: 6465 6469 4644 4f20 3d20 5472 7565 0a20  dediFDO = True. 
-00007040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007050: 2020 2020 2020 2069 4644 4f66 696c 655f         iFDOfile_
-00007060: 203d 2070 6174 682b 6669 6c65 5f0a 2020   = path+file_.  
-00007070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007080: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-00007090: 2020 2020 2020 2020 6578 6365 7074 2046          except F
-000070a0: 696c 654e 6f74 466f 756e 6445 7272 6f72  ileNotFoundError
-000070b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000070c0: 2020 7061 7373 2020 2020 2020 2020 0a0a    pass        ..
-000070d0: 2020 2020 2020 2020 7365 6c66 2e74 7279          self.try
-000070e0: 4175 746f 5365 7448 6561 6465 7246 6965  AutoSetHeaderFie
-000070f0: 6c64 7328 290a 2020 2020 2020 2020 7365  lds().        se
-00007100: 6c66 2e73 6574 4865 6164 6572 496d 6167  lf.setHeaderImag
-00007110: 654c 6f63 616c 5061 7468 4669 656c 6428  eLocalPathField(
-00007120: 290a 2020 2020 2020 2020 6966 206c 6f61  ).        if loa
-00007130: 6465 6469 4644 4f3a 0a20 2020 2020 2020  dediFDO:.       
-00007140: 2020 2020 2073 656c 662e 7365 7469 4644       self.setiFD
-00007150: 4f46 696c 654e 616d 6528 6946 444f 6669  OFileName(iFDOfi
-00007160: 6c65 5f29 0a0a 0a20 2020 2040 7374 6174  le_)...    @stat
-00007170: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-00007180: 206f 7065 6e5f 6966 646f 5f66 696c 6528   open_ifdo_file(
-00007190: 6669 6c65 3a73 7472 293a 2020 0a20 2020  file:str):  .   
-000071a0: 2020 2020 2022 2222 206f 7065 6e20 6966       """ open if
-000071b0: 646f 206a 736f 6e20 6f72 2079 616d 6c20  do json or yaml 
-000071c0: 6f72 207a 6970 2066 696c 6520 616e 6420  or zip file and 
-000071d0: 7265 7475 726e 2061 7320 6469 6374 2e20  return as dict. 
-000071e0: 2222 220a 2020 2020 2020 2020 0a20 2020  """.        .   
-000071f0: 2020 2020 2023 2069 6620 6669 6c65 2069       # if file i
-00007200: 7320 7a69 702c 2075 6e7a 6970 0a20 2020  s zip, unzip.   
-00007210: 2020 2020 2069 6620 6669 6c65 2e73 706c       if file.spl
-00007220: 6974 2827 2e27 295b 2d31 5d20 3d3d 2027  it('.')[-1] == '
-00007230: 7a69 7027 3a0a 2020 2020 2020 2020 2020  zip':.          
-00007240: 2020 6669 6c65 5f6e 616d 6520 3d20 272e    file_name = '.
-00007250: 272e 6a6f 696e 286f 732e 7061 7468 2e62  '.join(os.path.b
-00007260: 6173 656e 616d 6528 6669 6c65 292e 7370  asename(file).sp
-00007270: 6c69 7428 272e 2729 5b30 3a2d 315d 290a  lit('.')[0:-1]).
-00007280: 2020 2020 2020 2020 2020 2020 7a69 705f              zip_
-00007290: 6669 6c65 2020 2020 3d20 7a69 7066 696c  file    = zipfil
-000072a0: 652e 5a69 7046 696c 6528 6669 6c65 290a  e.ZipFile(file).
-000072b0: 2020 2020 2020 2020 2020 2020 6966 646f              ifdo
-000072c0: 5f66 696c 6520 203d 207a 6970 5f66 696c  _file  = zip_fil
-000072d0: 652e 6f70 656e 2866 696c 655f 6e61 6d65  e.open(file_name
-000072e0: 2c20 2772 2729 0a20 2020 2020 2020 2020  , 'r').         
-000072f0: 2020 2077 6974 6820 696f 2e54 6578 7449     with io.TextI
-00007300: 4f57 7261 7070 6572 2869 6664 6f5f 6669  OWrapper(ifdo_fi
-00007310: 6c65 2c20 656e 636f 6469 6e67 3d22 7574  le, encoding="ut
-00007320: 662d 3822 2920 6173 206f 3a0a 2020 2020  f-8") as o:.    
-00007330: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-00007340: 696c 652e 7370 6c69 7428 272e 2729 5b2d  ile.split('.')[-
-00007350: 315d 203d 3d20 2779 616d 6c27 3a0a 2020  1] == 'yaml':.  
-00007360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007370: 2020 6966 646f 5f64 6374 203d 2079 616d    ifdo_dct = yam
-00007380: 6c2e 6c6f 6164 286f 2c20 4c6f 6164 6572  l.load(o, Loader
-00007390: 3d79 616d 6c2e 434c 6f61 6465 7229 0a20  =yaml.CLoader). 
-000073a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000073b0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000073c0: 2020 2020 2020 2020 2069 6664 6f5f 6463           ifdo_dc
-000073d0: 7420 3d20 6a73 6f6e 2e6c 6f61 6428 6f29  t = json.load(o)
-000073e0: 0a0a 2020 2020 2020 2020 656c 7365 3a0a  ..        else:.
-000073f0: 2020 2020 2020 2020 2020 2020 7472 795f              try_
-00007400: 7961 6d6c 203d 2046 616c 7365 0a20 2020  yaml = False.   
-00007410: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00007420: 2020 2020 2020 2320 6966 2066 696c 6520        # if file 
-00007430: 6973 2079 616d 6c20 6669 6c65 206c 6f61  is yaml file loa
-00007440: 6420 6974 2061 7320 7375 6368 0a20 2020  d it as such.   
-00007450: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
-00007460: 2e73 706c 6974 2827 2e27 295b 2d31 5d20  .split('.')[-1] 
-00007470: 3d3d 2027 7961 6d6c 273a 0a20 2020 2020  == 'yaml':.     
-00007480: 2020 2020 2020 2020 2020 2074 7279 5f79             try_y
-00007490: 616d 6c20 3d20 5472 7565 0a20 2020 2020  aml = True.     
-000074a0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-000074b0: 7961 6d6c 203d 2066 696c 650a 0a20 2020  yaml = file..   
-000074c0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-000074d0: 6f73 2e70 6174 682e 6973 6669 6c65 2866  os.path.isfile(f
-000074e0: 696c 6529 3a0a 2020 2020 2020 2020 2020  ile):.          
-000074f0: 2020 2020 2020 2320 6966 2066 696c 6520        # if file 
-00007500: 646f 6573 206e 6f74 2065 7869 7374 2063  does not exist c
-00007510: 6865 636b 2069 6620 7961 6d6c 2076 6572  heck if yaml ver
-00007520: 7369 6f6e 2065 7873 6973 7420 616e 6420  sion exsist and 
-00007530: 7472 7920 746f 206c 6f61 6420 7468 6174  try to load that
-00007540: 206f 6e65 0a20 2020 2020 2020 2020 2020   one.           
-00007550: 2020 2020 2066 696c 655f 7961 6d6c 203d       file_yaml =
-00007560: 2066 696c 652e 7265 706c 6163 6528 272e   file.replace('.
-00007570: 6a73 6f6e 272c 272e 7961 6d6c 2729 0a20  json','.yaml'). 
-00007580: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00007590: 6620 6f73 2e70 6174 682e 6973 6669 6c65  f os.path.isfile
-000075a0: 2866 696c 655f 7961 6d6c 293a 0a20 2020  (file_yaml):.   
-000075b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075c0: 2074 7279 5f79 616d 6c20 3d20 5472 7565   try_yaml = True
-000075d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000075e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000075f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00007600: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
-00007610: 7469 6f6e 2822 4669 6c65 206e 6f74 2066  tion("File not f
-00007620: 6f75 6e64 3a20 2220 2b20 6669 6c65 290a  ound: " + file).
-00007630: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
-00007640: 7279 206c 6f61 6420 6a73 6f6e 2c20 6f74  ry load json, ot
-00007650: 6865 7277 6973 6520 7472 7920 7961 6d6c  herwise try yaml
-00007660: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00007670: 7472 795f 7961 6d6c 3a0a 2020 2020 2020  try_yaml:.      
-00007680: 2020 2020 2020 2020 2020 6f20 3d20 6f70            o = op
-00007690: 656e 2866 696c 655f 7961 6d6c 2c20 2772  en(file_yaml, 'r
-000076a0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-000076b0: 2020 2069 6664 6f5f 6463 7420 3d20 7961     ifdo_dct = ya
-000076c0: 6d6c 2e6c 6f61 6428 6f2c 204c 6f61 6465  ml.load(o, Loade
-000076d0: 723d 7961 6d6c 2e43 4c6f 6164 6572 290a  r=yaml.CLoader).
-000076e0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000076f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007700: 2020 6f20 3d20 6f70 656e 2866 696c 652c    o = open(file,
-00007710: 2027 7227 290a 2020 2020 2020 2020 2020   'r').          
-00007720: 2020 2020 2020 6966 646f 5f64 6374 203d        ifdo_dct =
-00007730: 206a 736f 6e2e 6c6f 6164 286f 290a 2020   json.load(o).  
-00007740: 2020 2020 2020 2020 2020 6f2e 636c 6f73            o.clos
-00007750: 6528 290a 0a20 2020 2020 2020 2072 6574  e()..        ret
-00007760: 7572 6e20 6966 646f 5f64 6374 0a0a 0a20  urn ifdo_dct... 
-00007770: 2020 2064 6566 2072 6561 6469 4644 4f66     def readiFDOf
-00007780: 696c 6528 7365 6c66 2c66 696c 653a 7374  ile(self,file:st
-00007790: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
-000077a0: 7265 6164 7320 6946 444f 2066 696c 6520  reads iFDO file 
-000077b0: 2222 220a 0a20 2020 2020 2020 2073 203d  """..        s =
-000077c0: 206d 6971 7463 2e50 7269 6e74 4c6f 6164   miqtc.PrintLoad
-000077d0: 696e 674d 7367 2822 4c6f 6164 696e 6720  ingMsg("Loading 
-000077e0: 6946 444f 2066 696c 6522 290a 2020 2020  iFDO file").    
-000077f0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00007800: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
-00007810: 6d70 203d 2073 656c 662e 6f70 656e 5f69  mp = self.open_i
-00007820: 6664 6f5f 6669 6c65 2866 696c 6529 0a20  fdo_file(file). 
-00007830: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007840: 6966 646f 5f70 6172 7365 6420 3d20 636f  ifdo_parsed = co
-00007850: 7079 2e64 6565 7063 6f70 7928 7365 6c66  py.deepcopy(self
-00007860: 2e69 6664 6f5f 746d 7029 0a20 2020 2020  .ifdo_tmp).     
-00007870: 2020 2020 2020 2073 2e73 746f 7028 290a         s.stop().
-00007880: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007890: 2e70 726f 762e 6164 6450 7265 7669 6f75  .prov.addPreviou
-000078a0: 7350 726f 7665 6e61 6e63 6528 7365 6c66  sProvenance(self
-000078b0: 2e70 726f 762e 6765 744c 6173 7450 726f  .prov.getLastPro
-000078c0: 7665 6e61 6e63 6546 696c 6528 7365 6c66  venanceFile(self
-000078d0: 2e64 6972 2e74 6f28 7365 6c66 2e64 6972  .dir.to(self.dir
-000078e0: 2e64 742e 7072 6f74 6f63 6f6c 292c 7365  .dt.protocol),se
-000078f0: 6c66 2e70 726f 762e 6578 6563 7574 6162  lf.prov.executab
-00007900: 6c65 2929 0a20 2020 2020 2020 2065 7863  le)).        exc
-00007910: 6570 7420 6d69 7174 632e 4966 646f 4578  ept miqtc.IfdoEx
-00007920: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-00007930: 2020 2020 2073 2e73 746f 7028 290a 2020       s.stop().  
-00007940: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00007950: 2046 616c 7365 0a20 2020 2020 2020 2065   False.        e
-00007960: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
-00007970: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-00007980: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-00007990: 7374 7228 6529 290a 2020 2020 2020 2020  str(e)).        
-000079a0: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
-000079b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000079c0: 4661 6c73 650a 0a20 2020 2020 2020 2023  False..        #
-000079d0: 2074 7279 2074 6f20 7061 7273 6520 652e   try to parse e.
-000079e0: 672e 2073 7472 696e 6773 2074 6861 7420  g. strings that 
-000079f0: 7265 7072 6573 656e 7420 6469 6374 730a  represent dicts.
-00007a00: 2020 2020 2020 2020 6d69 7174 632e 7265          miqtc.re
-00007a10: 6375 7273 6976 6545 7661 6c28 7365 6c66  cursiveEval(self
-00007a20: 2e69 6664 6f5f 746d 7029 0a0a 2020 2020  .ifdo_tmp)..    
-00007a30: 2020 2020 6966 2073 656c 662e 696d 6167      if self.imag
-00007a40: 6553 6574 4865 6164 6572 4b65 7920 6e6f  eSetHeaderKey no
-00007a50: 7420 696e 2073 656c 662e 6966 646f 5f74  t in self.ifdo_t
-00007a60: 6d70 3a0a 2020 2020 2020 2020 2020 2020  mp:.            
-00007a70: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-00007a80: 2245 7272 6f72 206c 6f61 6469 6e67 2069  "Error loading i
-00007a90: 4644 4f20 6669 6c65 222c 6669 6c65 2c22  FDO file",file,"
-00007aa0: 646f 6573 206e 6f74 2063 6f6e 7461 696e  does not contain
-00007ab0: 222c 7365 6c66 2e69 6d61 6765 5365 7448  ",self.imageSetH
-00007ac0: 6561 6465 724b 6579 290a 2020 2020 2020  eaderKey).      
-00007ad0: 2020 6966 2073 656c 662e 696d 6167 6553    if self.imageS
-00007ae0: 6574 4974 656d 734b 6579 206e 6f74 2069  etItemsKey not i
-00007af0: 6e20 7365 6c66 2e69 6664 6f5f 746d 703a  n self.ifdo_tmp:
-00007b00: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00007b10: 7365 2045 7863 6570 7469 6f6e 2822 4572  se Exception("Er
-00007b20: 726f 7220 6c6f 6164 696e 6720 6946 444f  ror loading iFDO
-00007b30: 2066 696c 6522 2c66 696c 652c 2264 6f65   file",file,"doe
-00007b40: 7320 6e6f 7420 636f 6e74 6169 6e22 2c73  s not contain",s
-00007b50: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-00007b60: 734b 6579 290a 0a20 2020 2020 2020 2069  sKey)..        i
-00007b70: 6620 2073 656c 662e 6966 646f 5f74 6d70  f  self.ifdo_tmp
-00007b80: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-00007b90: 6164 6572 4b65 795d 203d 3d20 4e6f 6e65  aderKey] == None
-00007ba0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00007bb0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00007bc0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-00007bd0: 6579 5d20 3d20 7b7d 0a20 2020 2020 2020  ey] = {}.       
-00007be0: 2069 6620 7365 6c66 2e69 6664 6f5f 746d   if self.ifdo_tm
-00007bf0: 705b 7365 6c66 2e69 6d61 6765 5365 7449  p[self.imageSetI
-00007c00: 7465 6d73 4b65 795d 203d 3d20 4e6f 6e65  temsKey] == None
-00007c10: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00007c20: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00007c30: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-00007c40: 795d 203d 207b 7d0a 0a20 2020 2020 2020  y] = {}..       
-00007c50: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-00007c60: 6946 444f 2066 696c 6520 6c6f 6164 6564  iFDO file loaded
-00007c70: 3a5c 7422 2b6f 732e 7061 7468 2e62 6173  :\t"+os.path.bas
-00007c80: 656e 616d 6528 6669 6c65 2929 0a0a 2020  ename(file))..  
-00007c90: 2020 2020 2020 2320 6368 6563 6b20 6946        # check iF
-00007ca0: 444f 2076 6572 7369 6f6e 0a20 2020 2020  DO version.     
-00007cb0: 2020 2072 6561 6456 6572 7369 6f6e 203d     readVersion =
-00007cc0: 2022 762e 312e 302e 3022 2023 2064 6964   "v.1.0.0" # did
-00007cd0: 206e 6f74 2068 6176 6520 7468 6520 2769   not have the 'i
-00007ce0: 6d61 6765 2d73 6574 2d69 6664 6f2d 7665  mage-set-ifdo-ve
-00007cf0: 7273 696f 6e27 2066 6965 6c64 2079 6574  rsion' field yet
-00007d00: 0a20 2020 2020 2020 2074 7279 3a20 0a20  .        try: . 
-00007d10: 2020 2020 2020 2020 2020 2072 6561 6456             readV
-00007d20: 6572 7369 6f6e 203d 2073 656c 662e 6669  ersion = self.fi
-00007d30: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
-00007d40: 652d 7365 742d 6966 646f 2d76 6572 7369  e-set-ifdo-versi
-00007d50: 6f6e 2729 0a20 2020 2020 2020 2065 7863  on').        exc
-00007d60: 6570 7420 4b65 7945 7272 6f72 3a0a 2020  ept KeyError:.  
-00007d70: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
-00007d80: 2020 2020 2020 2069 6e74 5265 6164 5665         intReadVe
-00007d90: 7273 696f 6e20 3d20 5665 7273 696f 6e28  rsion = Version(
-00007da0: 7265 6164 5665 7273 696f 6e29 0a20 2020  readVersion).   
-00007db0: 2020 2020 2069 6e74 5468 6973 5665 7273       intThisVers
-00007dc0: 696f 6e20 3d20 5665 7273 696f 6e28 6d69  ion = Version(mi
-00007dd0: 7174 762e 6946 444f 5f76 6572 7369 6f6e  qtv.iFDO_version
-00007de0: 290a 2020 2020 2020 2020 6966 2069 6e74  ).        if int
-00007df0: 5265 6164 5665 7273 696f 6e20 3c20 696e  ReadVersion < in
-00007e00: 7454 6869 7356 6572 7369 6f6e 3a0a 2020  tThisVersion:.  
-00007e10: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00007e20: 726f 762e 6c6f 6728 224c 6f61 6465 6420  rov.log("Loaded 
-00007e30: 6946 444f 2068 6173 2076 6572 7369 6f6e  iFDO has version
-00007e40: 2022 202b 2072 6561 6456 6572 7369 6f6e   " + readVersion
-00007e50: 202b 2022 2061 6e64 2077 696c 6c20 6265   + " and will be
-00007e60: 2075 7064 6174 6564 2074 6f20 7665 7273   updated to vers
-00007e70: 696f 6e20 2220 2b20 6d69 7174 762e 6946  ion " + miqtv.iF
-00007e80: 444f 5f76 6572 7369 6f6e 290a 2020 2020  DO_version).    
-00007e90: 2020 2020 6966 2069 6e74 5265 6164 5665      if intReadVe
-00007ea0: 7273 696f 6e20 3e20 696e 7454 6869 7356  rsion > intThisV
-00007eb0: 6572 7369 6f6e 3a0a 2020 2020 2020 2020  ersion:.        
-00007ec0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-00007ed0: 6728 2243 6175 7469 6f6e 2120 4c6f 6164  g("Caution! Load
-00007ee0: 6564 2069 4644 4f20 6861 7320 7665 7273  ed iFDO has vers
-00007ef0: 696f 6e20 2220 2b20 7265 6164 5665 7273  ion " + readVers
-00007f00: 696f 6e20 2b20 2220 6973 2061 6865 6164  ion + " is ahead
-00007f10: 206f 6620 7665 7273 696f 6e20 7573 6564   of version used
-00007f20: 2068 6572 653a 2022 202b 206d 6971 7476   here: " + miqtv
-00007f30: 2e69 4644 4f5f 7665 7273 696f 6e29 0a0a  .iFDO_version)..
-00007f40: 2020 2020 2020 2020 2320 666f 7220 736f          # for so
-00007f50: 6f6f 6f6f 6d65 2072 6561 736f 6e20 7468  oooome reason th
-00007f60: 6973 2066 6978 6573 2061 2068 6963 6b75  is fixes a hicku
-00007f70: 7020 6f66 2074 6865 2070 726f 6720 696e  p of the prog in
-00007f80: 2063 7265 6174 6569 4644 4f28 290a 2020   createiFDO().  
-00007f90: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
-00007fa0: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
-00007fb0: 6772 6573 734d 7367 2822 666f 6f22 2c20  gressMsg("foo", 
-00007fc0: 312c 6d6f 6475 6c6f 3d31 290a 2020 2020  1,modulo=1).    
-00007fd0: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
-00007fe0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00007ff0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00008000: 6f6e 7665 7274 546f 4465 6661 756c 7444  onvertToDefaultD
-00008010: 6174 6554 696d 6546 6f72 6d61 7428 7365  ateTimeFormat(se
-00008020: 6c66 2e69 6664 6f5f 746d 7029 0a20 2020  lf.ifdo_tmp).   
-00008030: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00008040: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
-00008050: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00008060: 6f76 2e6c 6f67 2822 4368 6563 6b69 6e67  ov.log("Checking
-00008070: 2064 6174 6574 696d 6520 666f 726d 6174   datetime format
-00008080: 3a20 2220 2b20 7374 7228 6578 2929 0a0a  : " + str(ex))..
-00008090: 2020 2020 2020 2020 2320 666f 7220 736f          # for so
-000080a0: 6f6f 6f6f 6d65 2072 6561 736f 6e20 7468  oooome reason th
-000080b0: 6973 2066 6978 6573 2061 2068 6963 6b75  is fixes a hicku
-000080c0: 7020 6f66 2074 6865 2070 726f 6720 696e  p of the prog in
-000080d0: 2063 7265 6174 6569 4644 4f28 290a 2020   createiFDO().  
-000080e0: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
-000080f0: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
-00008100: 6772 6573 734d 7367 2822 666f 6f22 2c20  gressMsg("foo", 
-00008110: 312c 6d6f 6475 6c6f 3d31 290a 2020 2020  1,modulo=1).    
-00008120: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
-00008130: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00008140: 7472 795f 7570 6772 6164 655f 746f 5f69  try_upgrade_to_i
-00008150: 6664 6f5f 7665 7273 696f 6e5f 3278 2829  fdo_version_2x()
-00008160: 0a0a 2020 2020 2020 2020 2320 6368 6563  ..        # chec
-00008170: 6b20 7265 6164 2069 4644 4f20 6669 6c65  k read iFDO file
-00008180: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00008190: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-000081a0: 2073 656c 662e 6967 6e6f 7265 5f69 6d61   self.ignore_ima
-000081b0: 6765 5f66 696c 6573 3a0a 2020 2020 2020  ge_files:.      
-000081c0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-000081d0: 7265 6174 6569 4644 4f28 7365 6c66 2e69  reateiFDO(self.i
-000081e0: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-000081f0: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
-00008200: 206d 6971 7469 2e63 7265 6174 6549 6d61   miqti.createIma
-00008210: 6765 4974 656d 734c 6973 7446 726f 6d49  geItemsListFromI
-00008220: 6d61 6765 4974 656d 7344 6963 7428 7365  mageItemsDict(se
-00008230: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00008240: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-00008250: 795d 2929 0a20 2020 2020 2020 2020 2020  y])).           
-00008260: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00008270: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
-00008280: 7465 6946 444f 2873 656c 662e 6966 646f  teiFDO(self.ifdo
-00008290: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-000082a0: 6574 4865 6164 6572 4b65 795d 2c20 6d69  etHeaderKey], mi
-000082b0: 7174 692e 6372 6561 7465 496d 6167 6549  qti.createImageI
-000082c0: 7465 6d73 4c69 7374 4672 6f6d 496d 6167  temsListFromImag
-000082d0: 6549 7465 6d73 4469 6374 2873 656c 662e  eItemsDict(self.
-000082e0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-000082f0: 6167 6553 6574 4974 656d 734b 6579 5d29  ageSetItemsKey])
-00008300: 2c68 6561 6465 725f 6f6e 6c79 3d73 656c  ,header_only=sel
-00008310: 662e 6967 6e6f 7265 5f69 6d61 6765 5f66  f.ignore_image_f
-00008320: 696c 6573 290a 2020 2020 2020 2020 6578  iles).        ex
-00008330: 6365 7074 206d 6971 7463 2e49 6664 6f45  cept miqtc.IfdoE
-00008340: 7863 6570 7469 6f6e 2061 7320 6578 3a0a  xception as ex:.
-00008350: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008360: 2e70 726f 762e 6c6f 6728 224c 6f61 6465  .prov.log("Loade
-00008370: 6420 6946 444f 2066 696c 6520 6e6f 7420  d iFDO file not 
-00008380: 7661 6c69 6420 7965 743a 2022 202b 2073  valid yet: " + s
-00008390: 7472 2865 7829 290a 0a20 2020 2020 2020  tr(ex))..       
-000083a0: 2072 6574 7572 6e20 5472 7565 0a0a 0a20   return True... 
-000083b0: 2020 2064 6566 2077 7269 7465 5f69 6664     def write_ifd
-000083c0: 6f5f 6669 6c65 2873 656c 662c 616c 6c6f  o_file(self,allo
-000083d0: 775f 6d69 7373 696e 675f 7265 7175 6972  w_missing_requir
-000083e0: 6564 3d46 616c 7365 2c20 6173 5f7a 6970  ed=False, as_zip
-000083f0: 3a62 6f6f 6c3d 4661 6c73 6529 3a0a 2020  :bool=False):.  
-00008400: 2020 2020 2020 2222 2220 5772 6974 6573        """ Writes
-00008410: 2061 6e20 6946 444f 2066 696c 6520 746f   an iFDO file to
-00008420: 2064 6973 6b2e 204f 7665 7277 7269 7465   disk. Overwrite
-00008430: 7320 706f 7465 6e74 6961 6c6c 7920 6578  s potentially ex
-00008440: 6973 7469 6e67 2066 696c 652e 0a20 2020  isting file..   
-00008450: 2020 2020 2061 735f 7a69 703a 2073 6166       as_zip: saf
-00008460: 6520 6669 6c65 2061 7320 7a69 7020 6669  e file as zip fi
-00008470: 6c65 2022 2222 0a0a 2020 2020 2020 2020  le """..        
-00008480: 7320 3d20 6d69 7174 632e 5072 696e 744c  s = miqtc.PrintL
-00008490: 6f61 6469 6e67 4d73 6728 2257 7269 7469  oadingMsg("Writi
-000084a0: 6e67 2069 4644 4f20 6669 6c65 2229 0a0a  ng iFDO file")..
-000084b0: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
-000084c0: 6669 656c 6473 2061 6761 696e 2069 6620  fields again if 
-000084d0: 6368 616e 6765 6420 7369 6e63 6520 6c61  changed since la
-000084e0: 7374 2063 6865 636b 2028 6372 6561 7465  st check (create
-000084f0: 6946 444f 290a 2020 2020 2020 2020 6966  iFDO).        if
-00008500: 2073 656c 662e 6966 646f 5f74 6d70 2021   self.ifdo_tmp !
-00008510: 3d20 7365 6c66 2e69 6664 6f5f 6368 6563  = self.ifdo_chec
-00008520: 6b65 643a 0a20 2020 2020 2020 2020 2020  ked:.           
-00008530: 2073 656c 662e 6372 6561 7465 6946 444f   self.createiFDO
-00008540: 2873 656c 662e 6966 646f 5f74 6d70 5b73  (self.ifdo_tmp[s
-00008550: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-00008560: 6572 4b65 795d 2c20 6d69 7174 692e 6372  erKey], miqti.cr
-00008570: 6561 7465 496d 6167 6549 7465 6d73 4c69  eateImageItemsLi
-00008580: 7374 4672 6f6d 496d 6167 6549 7465 6d73  stFromImageItems
-00008590: 4469 6374 2873 656c 662e 6966 646f 5f74  Dict(self.ifdo_t
-000085a0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-000085b0: 4974 656d 734b 6579 5d29 2c0a 2020 2020  ItemsKey]),.    
-000085c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000085d0: 2020 2020 2020 2020 616c 6c6f 775f 6d69          allow_mi
-000085e0: 7373 696e 675f 7265 7175 6972 6564 3d61  ssing_required=a
-000085f0: 6c6c 6f77 5f6d 6973 7369 6e67 5f72 6571  llow_missing_req
-00008600: 7569 7265 6429 0a20 2020 2020 2020 200a  uired).        .
-00008610: 2020 2020 2020 2020 2320 6164 6420 2224          # add "$
-00008620: 7363 6865 6d61 220a 2020 2020 2020 2020  schema".        
-00008630: 7365 6c66 2e69 6664 6f5f 6368 6563 6b65  self.ifdo_checke
-00008640: 645b 2224 7363 6865 6d61 225d 203d 206d  d["$schema"] = m
-00008650: 6971 7476 2e69 6664 6f5f 7363 6865 6d61  iqtv.ifdo_schema
-00008660: 5b27 2469 6427 5d0a 2020 2020 2020 2020  ['$id'].        
-00008670: 0a20 2020 2020 2020 2069 4644 4f5f 7061  .        iFDO_pa
-00008680: 7468 203d 2073 656c 662e 6765 7469 4644  th = self.getiFD
-00008690: 4f46 696c 654e 616d 6528 6f76 6572 7772  OFileName(overwr
-000086a0: 6974 653d 5472 7565 290a 0a20 2020 2020  ite=True)..     
-000086b0: 2020 2023 2070 7574 7320 6576 6572 7974     # puts everyt
-000086c0: 6869 6e67 2069 6e20 6f6e 6520 6c69 6e65  hing in one line
-000086d0: 0a20 2020 2020 2020 2023 7769 7468 206f  .        #with o
-000086e0: 7065 6e28 6946 444f 5f70 6174 682e 7265  pen(iFDO_path.re
-000086f0: 706c 6163 6528 2279 616d 6c22 2c22 6a73  place("yaml","js
-00008700: 6f6e 2229 2c20 2777 2729 2061 7320 6670  on"), 'w') as fp
-00008710: 3a0a 2020 2020 2020 2020 2320 2020 206a  :.        #    j
-00008720: 736f 6e2e 6475 6d70 2873 656c 662e 6966  son.dump(self.if
-00008730: 646f 5f63 6865 636b 6564 2c20 6670 290a  do_checked, fp).
-00008740: 0a20 2020 2020 2020 2023 2063 6f6e 7665  .        # conve
-00008750: 7274 2064 6963 7469 6f6e 6172 7920 746f  rt dictionary to
-00008760: 204a 534f 4e20 7374 7269 6e67 0a20 2020   JSON string.   
-00008770: 2020 2020 206a 736f 6e5f 6461 7461 203d       json_data =
-00008780: 206a 736f 6e2e 6475 6d70 7328 7365 6c66   json.dumps(self
-00008790: 2e69 6664 6f5f 6368 6563 6b65 642c 2069  .ifdo_checked, i
-000087a0: 6e64 656e 7420 3d20 342c 2073 6f72 745f  ndent = 4, sort_
-000087b0: 6b65 7973 3d54 7275 6529 0a0a 2020 2020  keys=True)..    
-000087c0: 2020 2020 2320 7772 6974 6520 7468 6520      # write the 
-000087d0: 4a53 4f4e 2073 7472 696e 6720 746f 2061  JSON string to a
-000087e0: 2066 696c 650a 2020 2020 2020 2020 6966   file.        if
-000087f0: 2061 735f 7a69 703a 0a20 2020 2020 2020   as_zip:.       
-00008800: 2020 2020 2077 6974 6820 7a69 7066 696c       with zipfil
-00008810: 652e 5a69 7046 696c 6528 6946 444f 5f70  e.ZipFile(iFDO_p
-00008820: 6174 6820 2b20 272e 7a69 7027 2c27 7727  ath + '.zip','w'
-00008830: 2c20 7a69 7066 696c 652e 5a49 505f 4445  , zipfile.ZIP_DE
-00008840: 464c 4154 4544 2920 6173 207a 6970 3a0a  FLATED) as zip:.
-00008850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008860: 7a69 702e 7772 6974 6573 7472 286f 732e  zip.writestr(os.
-00008870: 7061 7468 2e62 6173 656e 616d 6528 6946  path.basename(iF
-00008880: 444f 5f70 6174 6829 2c20 6a73 6f6e 5f64  DO_path), json_d
-00008890: 6174 6129 0a20 2020 2020 2020 2065 6c73  ata).        els
-000088a0: 653a 0a20 2020 2020 2020 2020 2020 2077  e:.            w
-000088b0: 6974 6820 6f70 656e 2869 4644 4f5f 7061  ith open(iFDO_pa
-000088c0: 7468 2c20 2777 2729 2061 7320 663a 0a20  th, 'w') as f:. 
-000088d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000088e0: 2e77 7269 7465 286a 736f 6e5f 6461 7461  .write(json_data
-000088f0: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
-00008900: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00008910: 2320 6c6f 6720 6368 616e 6765 730a 2020  # log changes.  
-00008920: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00008930: 662e 6966 646f 5f70 6172 7365 6420 6973  f.ifdo_parsed is
-00008940: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00008950: 2020 2069 6664 6f5f 7570 6461 7465 203d     ifdo_update =
-00008960: 2044 6565 7044 6966 6628 7365 6c66 2e69   DeepDiff(self.i
-00008970: 6664 6f5f 7061 7273 6564 2c73 656c 662e  fdo_parsed,self.
-00008980: 6966 646f 5f63 6865 636b 6564 290a 2020  ifdo_checked).  
-00008990: 2020 2020 2020 2020 2020 2370 7072 696e            #pprin
-000089a0: 7428 6966 646f 5f75 7064 6174 6529 0a20  t(ifdo_update). 
-000089b0: 2020 2020 2020 2020 2020 2069 6620 6966             if if
-000089c0: 646f 5f75 7064 6174 6520 213d 207b 7d3a  do_update != {}:
-000089d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000089e0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-000089f0: 6946 444f 2075 7064 6174 6564 2229 0a20  iFDO updated"). 
-00008a00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00008a10: 656c 662e 7072 6f76 2e6c 6f67 2873 7472  elf.prov.log(str
-00008a20: 2869 6664 6f5f 7570 6461 7465 292c 646f  (ifdo_update),do
-00008a30: 6e74 5368 6f77 3d54 7275 6529 0a20 2020  ntShow=True).   
-00008a40: 2020 2020 200a 2020 2020 2020 2020 7365       .        se
-00008a50: 6c66 2e70 726f 762e 6c6f 6728 2257 726f  lf.prov.log("Wro
-00008a60: 7465 2069 4644 4f20 746f 2066 696c 6520  te iFDO to file 
-00008a70: 2220 2b20 6946 444f 5f70 6174 6829 0a20  " + iFDO_path). 
-00008a80: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-00008a90: 2e77 7269 7465 2873 656c 662e 6469 722e  .write(self.dir.
-00008aa0: 746f 2873 656c 662e 6469 722e 6474 2e70  to(self.dir.dt.p
-00008ab0: 726f 746f 636f 6c29 290a 2020 2020 2020  rotocol)).      
-00008ac0: 2020 732e 7374 6f70 2829 0a0a 0a20 2020    s.stop()...   
-00008ad0: 2064 6566 2077 7269 7465 6946 444f 6669   def writeiFDOfi
-00008ae0: 6c65 2873 656c 662c 616c 6c6f 775f 6d69  le(self,allow_mi
-00008af0: 7373 696e 675f 7265 7175 6972 6564 3d46  ssing_required=F
-00008b00: 616c 7365 293a 0a20 2020 2020 2020 2022  alse):.        "
-00008b10: 2222 2044 6570 7265 6361 7465 6420 2d20  "" Deprecated - 
-00008b20: 7573 6520 7772 6974 655f 6966 646f 5f66  use write_ifdo_f
-00008b30: 696c 6520 2222 220a 2020 2020 2020 2020  ile """.        
-00008b40: 7365 6c66 2e77 7269 7465 5f69 6664 6f5f  self.write_ifdo_
-00008b50: 6669 6c65 2861 6c6c 6f77 5f6d 6973 7369  file(allow_missi
-00008b60: 6e67 5f72 6571 7569 7265 6429 0a0a 0a20  ng_required)... 
-00008b70: 2020 2064 6566 2073 6574 6946 444f 4669     def setiFDOFi
-00008b80: 6c65 4e61 6d65 2873 656c 662c 6946 444f  leName(self,iFDO
-00008b90: 6669 6c65 3a73 7472 293a 0a20 2020 2020  file:str):.     
-00008ba0: 2020 2022 2222 2053 6574 2074 6865 2063     """ Set the c
-00008bb0: 7572 7265 6e74 2069 4644 4f20 6669 6c65  urrent iFDO file
-00008bc0: 206e 616d 6520 7769 7468 2070 6174 682e   name with path.
-00008bd0: 2053 6574 2074 6f20 2222 2069 6e20 6f72   Set to "" in or
-00008be0: 6465 7220 746f 2067 6574 2064 6566 6175  der to get defau
-00008bf0: 6c74 206e 616d 6520 616e 6420 6c6f 6361  lt name and loca
-00008c00: 7469 6f6e 2e20 2222 220a 2020 2020 2020  tion. """.      
-00008c10: 2020 7365 6c66 2e69 4644 4f66 696c 655f    self.iFDOfile_
-00008c20: 203d 2069 4644 4f66 696c 650a 2020 2020   = iFDOfile.    
-00008c30: 2020 2020 7365 6c66 2e69 4644 4f66 696c      self.iFDOfil
-00008c40: 655f 203d 2073 656c 662e 6765 7469 4644  e_ = self.getiFD
-00008c50: 4f46 696c 654e 616d 6528 2920 2320 636f  OFileName() # co
-00008c60: 6e73 7472 7563 7420 6465 6661 756c 7420  nstruct default 
-00008c70: 6e61 6d65 2069 6620 656d 7074 790a 2020  name if empty.  
-00008c80: 2020 2020 2020 6966 206d 6971 7463 2e61        if miqtc.a
-00008c90: 7373 6572 7453 6c61 7368 286f 732e 7061  ssertSlash(os.pa
-00008ca0: 7468 2e64 6972 6e61 6d65 2873 656c 662e  th.dirname(self.
-00008cb0: 6946 444f 6669 6c65 5f29 2920 213d 206d  iFDOfile_)) != m
-00008cc0: 6971 7463 2e61 7373 6572 7453 6c61 7368  iqtc.assertSlash
-00008cd0: 2873 656c 662e 6469 722e 746f 2873 656c  (self.dir.to(sel
-00008ce0: 662e 6469 722e 6474 2e70 726f 6475 6374  f.dir.dt.product
-00008cf0: 7329 293a 0a20 2020 2020 2020 2020 2020  s)):.           
-00008d00: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-00008d10: 4361 7574 696f 6e21 2069 4644 4f20 6669  Caution! iFDO fi
-00008d20: 6c65 2070 6174 6820 6973 206e 6f74 2069  le path is not i
-00008d30: 6e20 2770 726f 6475 6374 7327 2073 7562  n 'products' sub
-00008d40: 2066 6f6c 6465 7220 6173 2072 6563 6f6d   folder as recom
-00008d50: 6d65 6e64 6564 2e20 436f 6e73 6964 6572  mended. Consider
-00008d60: 2072 6573 6574 7469 6e67 2077 6974 6820   resetting with 
-00008d70: 7365 7469 4644 4f46 696c 654e 616d 6528  setiFDOFileName(
-00008d80: 292e 2022 202b 2069 4644 4f66 696c 6529  ). " + iFDOfile)
-00008d90: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00008da0: 2020 2020 2020 2020 2020 6576 656e 7420            event 
-00008db0: 3d20 7365 6c66 2e66 696e 6454 6d70 4669  = self.findTmpFi
-00008dc0: 656c 6428 2769 6d61 6765 2d65 7665 6e74  eld('image-event
-00008dd0: 2729 5b27 6e61 6d65 275d 0a20 2020 2020  ')['name'].     
-00008de0: 2020 2020 2020 2073 656e 736f 7220 3d20         sensor = 
-00008df0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-00008e00: 6428 2769 6d61 6765 2d73 656e 736f 7227  d('image-sensor'
-00008e10: 295b 276e 616d 6527 5d0a 2020 2020 2020  )['name'].      
-00008e20: 2020 6578 6365 7074 206d 6971 7463 2e49    except miqtc.I
-00008e30: 6664 6f45 7863 6570 7469 6f6e 3a0a 2020  fdoException:.  
-00008e40: 2020 2020 2020 2020 2020 6576 656e 7420            event 
-00008e50: 3d20 7365 6c66 2e64 6972 2e65 7665 6e74  = self.dir.event
-00008e60: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
-00008e70: 656e 736f 7220 3d20 7365 6c66 2e64 6972  ensor = self.dir
-00008e80: 2e73 656e 736f 7228 290a 0a20 2020 2020  .sensor()..     
-00008e90: 2020 2069 4644 4f66 696c 654e 616d 6520     iFDOfileName 
-00008ea0: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
-00008eb0: 6d65 2873 656c 662e 6946 444f 6669 6c65  me(self.iFDOfile
-00008ec0: 5f29 0a20 2020 2020 2020 2069 6620 6e6f  _).        if no
-00008ed0: 7420 6576 656e 7420 696e 2069 4644 4f66  t event in iFDOf
-00008ee0: 696c 654e 616d 6520 6f72 206e 6f74 2069  ileName or not i
-00008ef0: 4644 4f2e 6765 7453 686f 7274 4571 7569  FDO.getShortEqui
-00008f00: 706d 656e 7449 4428 7365 6e73 6f72 2920  pmentID(sensor) 
-00008f10: 696e 2069 4644 4f66 696c 654e 616d 653a  in iFDOfileName:
-00008f20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00008f30: 662e 7072 6f76 2e6c 6f67 2822 4361 7574  f.prov.log("Caut
-00008f40: 696f 6e21 2069 4644 4f20 6669 6c65 206e  ion! iFDO file n
-00008f50: 616d 6520 646f 6573 206e 6f74 2063 6f6e  ame does not con
-00008f60: 7461 696e 2070 726f 6a65 6374 2c20 6576  tain project, ev
-00008f70: 656e 7420 616e 6420 7365 6e73 6f72 206e  ent and sensor n
-00008f80: 616d 6520 6173 2072 6563 6f6d 6d65 6e64  ame as recommend
-00008f90: 6564 2e20 436f 6e73 6964 6572 2072 6573  ed. Consider res
-00008fa0: 6574 7469 6e67 2077 6974 6820 7365 7469  etting with seti
-00008fb0: 4644 4f46 696c 654e 616d 6528 292e 2022  FDOFileName(). "
-00008fc0: 202b 2069 4644 4f66 696c 6529 0a0a 0a20   + iFDOfile)... 
-00008fd0: 2020 2064 6566 2067 6574 6946 444f 4669     def getiFDOFi
-00008fe0: 6c65 4e61 6d65 2873 656c 662c 6f76 6572  leName(self,over
-00008ff0: 7772 6974 653d 4661 6c73 6529 3a0a 2020  write=False):.  
-00009000: 2020 2020 2020 2222 2220 5265 7475 726e        """ Return
-00009010: 7320 7468 6520 6375 7272 656e 7420 6946  s the current iF
-00009020: 444f 2066 696c 6527 7320 6e61 6d65 2077  DO file's name w
-00009030: 6974 6820 7061 7468 2e20 4966 206e 6f74  ith path. If not
-00009040: 2073 6574 2079 6574 206f 7220 6f76 6572   set yet or over
-00009050: 7772 6974 653d 3d54 7275 6520 6974 2072  write==True it r
-00009060: 6574 7572 6e73 2074 6865 206f 6e65 206d  eturns the one m
-00009070: 6174 6368 696e 6720 696d 6167 652d 7365  atching image-se
-00009080: 742d 6e61 6d65 2e20 2222 220a 2020 2020  t-name. """.    
-00009090: 2020 2020 6966 2073 656c 662e 6946 444f      if self.iFDO
-000090a0: 6669 6c65 5f20 3d3d 2022 2220 6f72 206f  file_ == "" or o
-000090b0: 7665 7277 7269 7465 3a0a 2020 2020 2020  verwrite:.      
-000090c0: 2020 2020 2020 6669 6c65 5f6e 616d 6520        file_name 
-000090d0: 3d20 7365 6c66 2e66 696e 6454 6d70 4669  = self.findTmpFi
-000090e0: 656c 6428 2769 6d61 6765 2d73 6574 2d6e  eld('image-set-n
-000090f0: 616d 6527 2920 2b20 275f 6946 444f 2e6a  ame') + '_iFDO.j
-00009100: 736f 6e27 0a20 2020 2020 2020 2020 2020  son'.           
-00009110: 2069 6620 7365 6c66 2e69 4644 4f66 696c   if self.iFDOfil
-00009120: 655f 2021 3d20 2222 3a0a 2020 2020 2020  e_ != "":.      
-00009130: 2020 2020 2020 2020 2020 2320 7265 6e61            # rena
-00009140: 6d65 2066 696c 6520 6275 7420 6b65 6570  me file but keep
-00009150: 206c 6f63 6174 696f 6e0a 2020 2020 2020   location.      
-00009160: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
-00009170: 655f 6e61 6d65 2021 3d20 6f73 2e70 6174  e_name != os.pat
-00009180: 682e 6261 7365 6e61 6d65 2873 656c 662e  h.basename(self.
-00009190: 6946 444f 6669 6c65 5f29 2061 6e64 206f  iFDOfile_) and o
-000091a0: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
-000091b0: 6c66 2e69 4644 4f66 696c 655f 293a 0a20  lf.iFDOfile_):. 
-000091c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000091d0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-000091e0: 2822 4361 7574 696f 6e21 2069 6664 6f20  ("Caution! ifdo 
-000091f0: 6669 6c65 2072 656e 616d 6564 2074 6f20  file renamed to 
-00009200: 2220 2b20 6669 6c65 5f6e 616d 6529 0a20  " + file_name). 
-00009210: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00009220: 656c 662e 6946 444f 6669 6c65 5f20 3d20  elf.iFDOfile_ = 
-00009230: 6f73 2e70 6174 682e 6a6f 696e 286f 732e  os.path.join(os.
-00009240: 7061 7468 2e64 6972 6e61 6d65 2873 656c  path.dirname(sel
-00009250: 662e 6946 444f 6669 6c65 5f29 2c66 696c  f.iFDOfile_),fil
-00009260: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
-00009270: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00009280: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-00009290: 4644 4f66 696c 655f 203d 206f 732e 7061  FDOfile_ = os.pa
-000092a0: 7468 2e6a 6f69 6e28 7365 6c66 2e64 6972  th.join(self.dir
-000092b0: 2e74 6f28 7365 6c66 2e64 6972 2e64 742e  .to(self.dir.dt.
-000092c0: 7072 6f64 7563 7473 292c 2066 696c 655f  products), file_
-000092d0: 6e61 6d65 290a 2020 2020 2020 2020 7265  name).        re
-000092e0: 7475 726e 2073 656c 662e 6946 444f 6669  turn self.iFDOfi
-000092f0: 6c65 5f0a 0a0a 2020 2020 6465 6620 7365  le_...    def se
-00009300: 745f 696d 6167 655f 7365 745f 6e61 6d65  t_image_set_name
-00009310: 5f66 6965 6c64 5f66 726f 6d5f 7072 6f6a  _field_from_proj
-00009320: 6563 745f 6576 656e 745f 7365 6e73 6f72  ect_event_sensor
-00009330: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00009340: 2222 2220 5365 7473 2066 6965 6c64 2069  """ Sets field i
-00009350: 6d61 6765 2d73 6574 2d6e 616d 6520 6672  mage-set-name fr
-00009360: 6f6d 2063 7572 7265 6e74 2074 6d70 2066  om current tmp f
-00009370: 6965 6c64 7320 666f 7220 7072 6f6a 6563  ields for projec
-00009380: 742c 2065 7665 6e74 2061 6e64 2073 656e  t, event and sen
-00009390: 736f 722e 200a 2020 2020 2020 2020 5265  sor. .        Re
-000093a0: 7475 726e 7320 696d 6167 652d 7365 742d  turns image-set-
-000093b0: 6e61 6d65 2076 616c 7565 2e20 2222 220a  name value. """.
-000093c0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-000093d0: 206e 6577 5f69 6d61 6765 5f73 6574 5f6e   new_image_set_n
-000093e0: 616d 6520 3d20 7365 6c66 2e67 6574 5f69  ame = self.get_i
-000093f0: 6d61 6765 5f73 6574 5f6e 616d 655f 6669  mage_set_name_fi
-00009400: 656c 645f 6672 6f6d 5f70 726f 6a65 6374  eld_from_project
-00009410: 5f65 7665 6e74 5f73 656e 736f 7228 7365  _event_sensor(se
-00009420: 6c66 2e69 6664 6f5f 746d 7029 0a20 2020  lf.ifdo_tmp).   
-00009430: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
-00009440: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-00009450: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
-00009460: 652d 7365 742d 6e61 6d65 275d 203d 206e  e-set-name'] = n
-00009470: 6577 5f69 6d61 6765 5f73 6574 5f6e 616d  ew_image_set_nam
-00009480: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-00009490: 206e 6577 5f69 6d61 6765 5f73 6574 5f6e   new_image_set_n
-000094a0: 616d 650a 2020 2020 2020 2020 0a0a 2020  ame.        ..  
-000094b0: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
-000094c0: 2020 2020 6465 6620 6765 745f 696d 6167      def get_imag
-000094d0: 655f 7365 745f 6e61 6d65 5f66 6965 6c64  e_set_name_field
-000094e0: 5f66 726f 6d5f 7072 6f6a 6563 745f 6576  _from_project_ev
-000094f0: 656e 745f 7365 6e73 6f72 2869 6664 6f3a  ent_sensor(ifdo:
-00009500: 6469 6374 293a 0a20 2020 2020 2020 2022  dict):.        "
-00009510: 2222 2043 7265 6174 6573 2061 6e64 2072  "" Creates and r
-00009520: 6574 7572 6e73 2069 6d61 6765 2d73 6574  eturns image-set
-00009530: 2d6e 616d 6520 6672 6f6d 2063 7572 7265  -name from curre
-00009540: 6e74 2074 6d70 2066 6965 6c64 7320 666f  nt tmp fields fo
-00009550: 7220 7072 6f6a 6563 742c 2065 7665 6e74  r project, event
-00009560: 2061 6e64 2073 656e 736f 722e 2022 2222   and sensor. """
-00009570: 0a20 2020 2020 2020 206e 6577 5f69 6d61  .        new_ima
-00009580: 6765 5f73 6574 5f6e 616d 6520 3d20 6946  ge_set_name = iF
-00009590: 444f 2e63 6f6e 7374 7275 6374 496d 6167  DO.constructImag
-000095a0: 6553 6574 4e61 6d65 2869 6664 6f5b 2769  eSetName(ifdo['i
-000095b0: 6d61 6765 2d73 6574 2d68 6561 6465 7227  mage-set-header'
-000095c0: 5d5b 2769 6d61 6765 2d70 726f 6a65 6374  ]['image-project
-000095d0: 275d 5b27 6e61 6d65 275d 2c0a 2020 2020  ']['name'],.    
-000095e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000160: 7274 2069 6f0a 696d 706f 7274 2077 6172  rt io.import war
+00000170: 6e69 6e67 730a 0a69 6d70 6f72 7420 6d61  nings..import ma
+00000180: 7269 7174 2e63 6f72 6520 6173 206d 6971  riqt.core as miq
+00000190: 7463 0a69 6d70 6f72 7420 6d61 7269 7174  tc.import mariqt
+000001a0: 2e64 6972 6563 746f 7269 6573 2061 7320  .directories as 
+000001b0: 6d69 7174 640a 696d 706f 7274 206d 6172  miqtd.import mar
+000001c0: 6971 742e 6669 6c65 7320 6173 206d 6971  iqt.files as miq
+000001d0: 7466 0a69 6d70 6f72 7420 6d61 7269 7174  tf.import mariqt
+000001e0: 2e76 6172 6961 626c 6573 2061 7320 6d69  .variables as mi
+000001f0: 7174 760a 696d 706f 7274 206d 6172 6971  qtv.import mariq
+00000200: 742e 696d 6167 6520 6173 206d 6971 7469  t.image as miqti
+00000210: 0a69 6d70 6f72 7420 6d61 7269 7174 2e74  .import mariqt.t
+00000220: 6573 7473 2061 7320 6d69 7174 740a 696d  ests as miqtt.im
+00000230: 706f 7274 206d 6172 6971 742e 6e61 7669  port mariqt.navi
+00000240: 6761 7469 6f6e 2061 7320 6d69 7174 6e0a  gation as miqtn.
+00000250: 696d 706f 7274 206d 6172 6971 742e 7365  import mariqt.se
+00000260: 7474 696e 6773 2061 7320 6d69 7174 730a  ttings as miqts.
+00000270: 696d 706f 7274 206d 6172 6971 742e 7072  import mariqt.pr
+00000280: 6f76 656e 616e 6365 2061 7320 6d69 7174  ovenance as miqt
+00000290: 700a 696d 706f 7274 206d 6172 6971 742e  p.import mariqt.
+000002a0: 6765 6f20 6173 206d 6971 7467 0a69 6d70  geo as miqtg.imp
+000002b0: 6f72 7420 6d61 7269 7174 2e73 6f75 7263  ort mariqt.sourc
+000002c0: 6573 2e6f 7369 7320 6173 206d 6971 746f  es.osis as miqto
+000002d0: 7369 730a 696d 706f 7274 206d 6172 6971  sis.import mariq
+000002e0: 742e 6571 7569 706d 656e 7420 6173 206d  t.equipment as m
+000002f0: 6971 7465 7175 6970 0a0a 0a63 6c61 7373  iqtequip...class
+00000300: 206e 6f6e 436f 7265 4669 656c 6449 6e74   nonCoreFieldInt
+00000310: 6572 6d65 6469 6174 6549 7465 6d49 6e66  ermediateItemInf
+00000320: 6f46 696c 653a 0a20 2020 2064 6566 205f  oFile:.    def _
+00000330: 5f69 6e69 745f 5f28 7365 6c66 2c20 6669  _init__(self, fi
+00000340: 6c65 4e61 6d65 3a73 7472 2c20 7365 7061  leName:str, sepa
+00000350: 7261 746f 723a 7374 722c 2068 6561 6465  rator:str, heade
+00000360: 723a 6469 6374 2c20 6461 7465 7469 6d65  r:dict, datetime
+00000370: 5f66 6f72 6d61 743a 7374 723d 6d69 7174  _format:str=miqt
+00000380: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
+00000390: 6d61 7269 7174 275d 293a 0a20 2020 2020  mariqt']):.     
+000003a0: 2020 2073 656c 662e 6669 6c65 4e61 6d65     self.fileName
+000003b0: 203d 2066 696c 654e 616d 650a 2020 2020   = fileName.    
+000003c0: 2020 2020 7365 6c66 2e73 6570 6172 6174      self.separat
+000003d0: 6f72 203d 2073 6570 6172 6174 6f72 0a20  or = separator. 
+000003e0: 2020 2020 2020 2073 656c 662e 6865 6164         self.head
+000003f0: 6572 203d 2068 6561 6465 720a 2020 2020  er = header.    
+00000400: 2020 2020 7365 6c66 2e64 6174 6574 696d      self.datetim
+00000410: 655f 666f 726d 6174 203d 2064 6174 6574  e_format = datet
+00000420: 696d 655f 666f 726d 6174 0a0a 2020 2020  ime_format..    
+00000430: 6465 6620 5f5f 6571 5f5f 2873 656c 662c  def __eq__(self,
+00000440: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
+00000450: 2069 6620 7365 6c66 2e66 696c 654e 616d   if self.fileNam
+00000460: 653d 3d6f 7468 6572 2e66 696c 654e 616d  e==other.fileNam
+00000470: 6520 616e 6420 7365 6c66 2e73 6570 6172  e and self.separ
+00000480: 6174 6f72 203d 3d20 6f74 6865 722e 7365  ator == other.se
+00000490: 7061 7261 746f 7220 616e 6420 7365 6c66  parator and self
+000004a0: 2e68 6561 6465 723d 3d6f 7468 6572 2e68  .header==other.h
+000004b0: 6561 6465 7220 616e 6420 7365 6c66 2e64  eader and self.d
+000004c0: 6174 6574 696d 655f 666f 726d 6174 3d3d  atetime_format==
+000004d0: 6f74 6865 722e 6461 7465 7469 6d65 5f66  other.datetime_f
+000004e0: 6f72 6d61 743a 0a20 2020 2020 2020 2020  ormat:.         
+000004f0: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
+00000500: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00000510: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00000520: 4661 6c73 650a 0a64 6566 2066 696e 6446  False..def findF
+00000530: 6965 6c64 2869 6664 6f5f 6469 6374 2c6b  ield(ifdo_dict,k
+00000540: 6579 7329 3a0a 2020 2020 2020 2020 2222  eys):.        ""
+00000550: 2220 4c6f 6f6b 7320 666f 7220 206b 6579  " Looks for  key
+00000560: 7320 2822 6b65 7922 206f 7220 5b6b 6579  s ("key" or [key
+00000570: 312c 6b65 7932 5d29 2069 6e20 6966 646f  1,key2]) in ifdo
+00000580: 5f64 6963 7420 616e 6420 7265 7475 726e  _dict and return
+00000590: 7320 6974 7320 7661 6c75 6520 6f72 2061  s its value or a
+000005a0: 6e20 656d 7074 7920 7374 7269 6e67 2069  n empty string i
+000005b0: 6620 6b65 7920 6e6f 7420 666f 756e 6422  f key not found"
+000005c0: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+000005d0: 7420 6973 696e 7374 616e 6365 286b 6579  t isinstance(key
+000005e0: 732c 206c 6973 7429 3a0a 2020 2020 2020  s, list):.      
+000005f0: 2020 2020 2020 6b65 7973 203d 205b 6b65        keys = [ke
+00000600: 7973 5d0a 0a20 2020 2020 2020 2061 7220  ys]..        ar 
+00000610: 3d20 6966 646f 5f64 6963 740a 2020 2020  = ifdo_dict.    
+00000620: 2020 2020 666f 7220 6b20 696e 206b 6579      for k in key
+00000630: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+00000640: 6620 6b20 696e 2061 723a 0a20 2020 2020  f k in ar:.     
+00000650: 2020 2020 2020 2020 2020 2061 7220 3d20             ar = 
+00000660: 6172 5b6b 5d0a 2020 2020 2020 2020 2020  ar[k].          
+00000670: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00000680: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00000690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000006a0: 206b 203d 2069 6e74 286b 290a 2020 2020   k = int(k).    
+000006b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000006c0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+000006d0: 6528 6172 2c6c 6973 7429 206f 7220 6c65  e(ar,list) or le
+000006e0: 6e28 6172 2920 3c20 6b3a 0a20 2020 2020  n(ar) < k:.     
+000006f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000700: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00000710: 726f 7228 2249 6e64 6578 222c 6b2c 226f  ror("Index",k,"o
+00000720: 7574 206f 6620 626f 756e 6473 222c 6c65  ut of bounds",le
+00000730: 6e28 6172 2929 0a20 2020 2020 2020 2020  n(ar)).         
+00000740: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
+00000750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000760: 2020 2072 6574 7572 6e20 2222 0a20 2020     return "".   
+00000770: 2020 2020 2020 2020 2020 2020 2061 7220               ar 
+00000780: 3d20 6172 5b6b 5d0a 2020 2020 2020 2020  = ar[k].        
+00000790: 7265 7475 726e 2061 720a 0a0a 636c 6173  return ar...clas
+000007a0: 7320 6946 444f 5f52 6561 6465 723a 0a20  s iFDO_Reader:. 
+000007b0: 2020 2022 2050 726f 7669 6465 7320 636f     " Provides co
+000007c0: 6e76 656e 6965 6e74 2066 756e 6374 696f  nvenient functio
+000007d0: 6e73 2066 6f72 2072 6561 6469 6e67 2064  ns for reading d
+000007e0: 6174 6120 6672 6f6d 2069 4644 4f20 6669  ata from iFDO fi
+000007f0: 6c65 7320 220a 0a20 2020 2064 6566 205f  les "..    def _
+00000800: 5f69 6e69 745f 5f28 7365 6c66 2c20 6946  _init__(self, iF
+00000810: 444f 6669 6c65 3a73 7472 293a 0a20 2020  DOfile:str):.   
+00000820: 2020 2020 2022 2050 726f 7669 6465 7320       " Provides 
+00000830: 636f 6e76 656e 6965 6e74 2066 756e 6374  convenient funct
+00000840: 696f 6e73 2066 6f72 2072 6561 6469 6e67  ions for reading
+00000850: 2064 6174 6120 6672 6f6d 2069 4644 4f20   data from iFDO 
+00000860: 6669 6c65 7320 220a 2020 2020 2020 2020  files ".        
+00000870: 0a20 2020 2020 2020 2073 656c 662e 6946  .        self.iF
+00000880: 444f 6669 6c65 203d 2069 4644 4f66 696c  DOfile = iFDOfil
+00000890: 650a 2020 2020 2020 2020 7365 6c66 2e69  e.        self.i
+000008a0: 6664 6f20 3d20 6946 444f 2e6f 7065 6e5f  fdo = iFDO.open_
+000008b0: 6966 646f 5f66 696c 6528 7365 6c66 2e69  ifdo_file(self.i
+000008c0: 4644 4f66 696c 6529 0a0a 0a20 2020 2064  FDOfile)...    d
+000008d0: 6566 205f 5f67 6574 6974 656d 5f5f 2873  ef __getitem__(s
+000008e0: 656c 662c 206b 6579 7329 3a0a 2020 2020  elf, keys):.    
+000008f0: 2020 2020 2222 2220 5265 7475 726e 7320      """ Returns 
+00000900: 636f 7079 206f 6620 6368 6563 6b65 6420  copy of checked 
+00000910: 6966 646f 2073 6574 206f 7220 6974 656d  ifdo set or item
+00000920: 2066 6965 6c64 2076 616c 7565 2c20 616c   field value, al
+00000930: 736f 2063 6f6e 7369 6465 726e 6720 6465  so considerng de
+00000940: 6661 756c 7420 7661 6c75 6573 2066 726f  fault values fro
+00000950: 6d20 6865 6164 6572 2e0a 2020 2020 2020  m header..      
+00000960: 2020 2020 2020 5573 6520 6b65 7973 2061        Use keys a
+00000970: 7320 652e 672e 2027 3c69 7465 6d3e 3a3c  s e.g. '<item>:<
+00000980: 6b65 793e 3a2e 2e2e 272e 2043 616e 2062  key>:...'. Can b
+00000990: 6520 7573 6564 2066 6f72 2068 6561 6465  e used for heade
+000009a0: 7220 6669 656c 6473 2061 7320 7765 6c6c  r fields as well
+000009b0: 2061 7320 6974 656d 2066 6965 6c64 732e   as item fields.
+000009c0: 0a20 2020 2020 2020 2020 2020 2049 7465  .            Ite
+000009d0: 6d20 696e 6465 7820 6361 6e20 6265 206c  m index can be l
+000009e0: 6567 6c65 6374 6564 2c20 696e 2063 6173  eglected, in cas
+000009f0: 6520 6f66 2076 6964 656f 2061 2064 6963  e of video a dic
+00000a00: 7420 7b3c 696d 6167 652d 6461 7461 7469  t {<image-datati
+00000a10: 6d65 3e3a 3c76 616c 7565 3e2c 2e2e 2e7d  me>:<value>,...}
+00000a20: 2069 7320 7265 7475 726e 6564 2e0a 2020   is returned..  
+00000a30: 2020 2020 2020 2020 2020 5261 6973 6573            Raises
+00000a40: 2049 6664 6f45 7863 6570 7469 6f6e 2069   IfdoException i
+00000a50: 6620 6974 656d 2064 6f65 7320 6e6f 7420  f item does not 
+00000a60: 6578 6973 742e 2022 2222 0a20 2020 2020  exist. """.     
+00000a70: 2020 206b 6579 7320 3d20 6b65 7973 2e73     keys = keys.s
+00000a80: 706c 6974 2827 3a27 290a 2020 2020 2020  plit(':').      
+00000a90: 2020 7265 7475 726e 2069 4644 4f2e 5f69    return iFDO._i
+00000aa0: 4644 4f5f 5f67 6574 4669 656c 6456 616c  FDO__getFieldVal
+00000ab0: 7565 2873 656c 662e 6966 646f 2c6b 6579  ue(self.ifdo,key
+00000ac0: 7329 0a0a 0a20 2020 2064 6566 2067 6574  s)...    def get
+00000ad0: 496d 6167 6573 506f 7369 7469 6f6e 7328  ImagesPositions(
+00000ae0: 7365 6c66 2c69 6d61 6765 5f74 7970 6573  self,image_types
+00000af0: 3d6d 6971 7476 2e69 6d61 6765 5f74 7970  =miqtv.image_typ
+00000b00: 6573 293a 0a20 2020 2020 2020 2022 2222  es):.        """
+00000b10: 2052 6574 7572 6e73 2069 6d61 6765 7320   Returns images 
+00000b20: 6669 7273 7420 706f 7369 7469 6f6e 2873  first position(s
+00000b30: 2920 0a20 2020 2020 2020 2020 2020 2040  ) .            @
+00000b40: 7265 7475 726e 3a20 7b27 696d 6167 654e  return: {'imageN
+00000b50: 616d 6527 3a20 5b7b 276c 6174 273a 2076  ame': [{'lat': v
+00000b60: 616c 7565 2c20 276c 6f6e 273a 2076 616c  alue, 'lon': val
+00000b70: 7565 2c20 2764 6174 6574 696d 6527 3a20  ue, 'datetime': 
+00000b80: 7661 6c75 657d 5d7d 2c20 696d 6167 652d  value}]}, image-
+00000b90: 636f 6f72 6469 6e61 7465 2d72 6566 6572  coordinate-refer
+00000ba0: 656e 6365 2d73 7973 7465 6d20 2222 220a  ence-system """.
+00000bb0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00000bc0: 2072 6574 4469 6374 203d 207b 7d0a 2020   retDict = {}.  
+00000bd0: 2020 2020 2020 7265 7452 6566 7379 7320        retRefsys 
+00000be0: 3d20 7365 6c66 2e69 6664 6f5b 6d69 7174  = self.ifdo[miqt
+00000bf0: 762e 696d 6167 655f 7365 745f 6865 6164  v.image_set_head
+00000c00: 6572 5f6b 6579 5d5b 2769 6d61 6765 2d63  er_key]['image-c
+00000c10: 6f6f 7264 696e 6174 652d 7265 6665 7265  oordinate-refere
+00000c20: 6e63 652d 7379 7374 656d 275d 0a0a 2020  nce-system']..  
+00000c30: 2020 2020 2020 6865 6164 6572 5661 6c4c        headerValL
+00000c40: 6174 203d 204e 6f6e 650a 2020 2020 2020  at = None.      
+00000c50: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00000c60: 2020 2068 6561 6465 7256 616c 4c61 7420     headerValLat 
+00000c70: 3d20 7365 6c66 2e69 6664 6f5b 6d69 7174  = self.ifdo[miqt
+00000c80: 762e 696d 6167 655f 7365 745f 6865 6164  v.image_set_head
+00000c90: 6572 5f6b 6579 5d5b 2769 6d61 6765 2d6c  er_key]['image-l
+00000ca0: 6174 6974 7564 6527 5d0a 2020 2020 2020  atitude'].      
+00000cb0: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
+00000cc0: 723a 0a20 2020 2020 2020 2020 2020 2070  r:.            p
+00000cd0: 6173 730a 0a20 2020 2020 2020 2068 6561  ass..        hea
+00000ce0: 6465 7256 616c 4c6f 6e20 3d20 4e6f 6e65  derValLon = None
+00000cf0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00000d00: 2020 2020 2020 2020 2020 6865 6164 6572            header
+00000d10: 5661 6c4c 6f6e 203d 2073 656c 662e 6966  ValLon = self.if
+00000d20: 646f 5b6d 6971 7476 2e69 6d61 6765 5f73  do[miqtv.image_s
+00000d30: 6574 5f68 6561 6465 725f 6b65 795d 5b27  et_header_key]['
+00000d40: 696d 6167 652d 6c6f 6e67 6974 7564 6527  image-longitude'
+00000d50: 5d0a 2020 2020 2020 2020 6578 6365 7074  ].        except
+00000d60: 204b 6579 4572 726f 723a 0a20 2020 2020   KeyError:.     
+00000d70: 2020 2020 2020 2070 6173 730a 0a0a 2020         pass...  
+00000d80: 2020 2020 2020 666f 7220 6669 6c65 4e61        for fileNa
+00000d90: 6d65 2069 6e20 7365 6c66 2e69 6664 6f5b  me in self.ifdo[
+00000da0: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
+00000db0: 6974 656d 735f 6b65 795d 3a0a 2020 2020  items_key]:.    
+00000dc0: 2020 2020 2020 2020 6966 2066 696c 654e          if fileN
+00000dd0: 616d 652e 7370 6c69 7428 272e 2729 5b2d  ame.split('.')[-
+00000de0: 315d 2e6c 6f77 6572 2829 2069 6e20 696d  1].lower() in im
+00000df0: 6167 655f 7479 7065 733a 0a20 2020 2020  age_types:.     
+00000e00: 2020 2020 2020 2020 2020 2072 6574 4469             retDi
+00000e10: 6374 5b66 696c 654e 616d 655d 203d 2073  ct[fileName] = s
+00000e20: 656c 662e 5f5f 6765 7449 7465 6d4c 6174  elf.__getItemLat
+00000e30: 4c6f 6e28 6669 6c65 4e61 6d65 2c68 6561  Lon(fileName,hea
+00000e40: 6465 7256 616c 4c61 742c 6865 6164 6572  derValLat,header
+00000e50: 5661 6c4c 6f6e 290a 0a20 2020 2020 2020  ValLon)..       
+00000e60: 2072 6574 7572 6e20 7265 7444 6963 742c   return retDict,
+00000e70: 2072 6574 5265 6673 7973 0a0a 0a20 2020   retRefsys...   
+00000e80: 2064 6566 2077 7269 7465 576f 726c 6446   def writeWorldF
+00000e90: 696c 6573 466f 7250 686f 746f 7328 7365  ilesForPhotos(se
+00000ea0: 6c66 2c64 6573 7444 6972 3a73 7472 2c69  lf,destDir:str,i
+00000eb0: 6d61 6765 536f 7572 6365 4469 723a 7374  mageSourceDir:st
+00000ec0: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
+00000ed0: 5772 6974 6573 2077 6f72 6c64 2066 696c  Writes world fil
+00000ee0: 6573 2066 6f72 2070 686f 746f 7320 6966  es for photos if
+00000ef0: 2061 6c6c 2072 6571 7569 7265 6420 6669   all required fi
+00000f00: 656c 6473 2061 7265 2074 6865 7265 2075  elds are there u
+00000f10: 6e64 6572 2074 6865 2061 7373 756d 7074  nder the assumpt
+00000f20: 696f 6e20 7468 6174 2074 6865 2063 616d  ion that the cam
+00000f30: 6572 6120 7761 7320 6c6f 6f6b 696e 6720  era was looking 
+00000f40: 7374 7261 6967 6874 2064 6f77 6e20 2870  straight down (p
+00000f50: 6974 6368 2061 6e64 2072 6f6c 6c20 6172  itch and roll ar
+00000f60: 6520 6967 6e6f 7265 6421 292e 200a 2020  e ignored!). .  
+00000f70: 2020 2020 2020 2020 2020 5265 7475 726e            Return
+00000f80: 7320 6120 6c69 7374 206f 6620 6974 656d  s a list of item
+00000f90: 7320 666f 7220 7768 6963 6820 6372 6561  s for which crea
+00000fa0: 7469 6f6e 2066 6169 6c65 643a 205b 5b69  tion failed: [[i
+00000fb0: 7465 6d2c 6d73 675d 2c2e 2e2e 5d22 2222  tem,msg],...]"""
+00000fc0: 0a0a 2020 2020 2020 2020 2320 544f 444f  ..        # TODO
+00000fd0: 2067 6574 2069 6d61 6765 7320 6f6e 6c69   get images onli
+00000fe0: 6e65 2066 726f 6d20 6272 6f6b 6572 0a0a  ne from broker..
+00000ff0: 2020 2020 2020 2020 6946 444f 6578 6365          iFDOexce
+00001000: 7074 696f 6e73 203d 205b 5d0a 0a20 2020  ptions = []..   
+00001010: 2020 2020 2023 2067 6574 2069 6d61 6765       # get image
+00001020: 7320 706f 7369 7469 6f6e 0a20 2020 2020  s position.     
+00001030: 2020 2070 6f73 6974 696f 6e73 4c61 744c     positionsLatL
+00001040: 6f6e 2c20 7265 6673 7973 203d 2073 656c  on, refsys = sel
+00001050: 662e 6765 7449 6d61 6765 7350 6f73 6974  f.getImagesPosit
+00001060: 696f 6e73 2869 6d61 6765 5f74 7970 6573  ions(image_types
+00001070: 3d6d 6971 7476 2e70 686f 746f 5f74 7970  =miqtv.photo_typ
+00001080: 6573 290a 2020 2020 2020 2020 6372 7346  es).        crsF
+00001090: 6965 6c64 546d 7020 3d20 2727 2e6a 6f69  ieldTmp = ''.joi
+000010a0: 6e28 6520 666f 7220 6520 696e 2072 6566  n(e for e in ref
+000010b0: 7379 7320 6966 2065 2e69 7361 6c6e 756d  sys if e.isalnum
+000010c0: 2829 292e 6c6f 7765 7228 290a 2020 2020  ()).lower().    
+000010d0: 2020 2020 6966 2063 7273 4669 656c 6454      if crsFieldT
+000010e0: 6d70 203d 3d20 2777 6773 3834 2720 6f72  mp == 'wgs84' or
+000010f0: 2063 7273 4669 656c 6454 6d70 203d 3d20   crsFieldTmp == 
+00001100: 2765 7073 6734 3332 3627 3a0a 2020 2020  'epsg4326':.    
+00001110: 2020 2020 2020 2020 7265 6673 7973 203d          refsys =
+00001120: 2022 5747 5338 3422 0a20 2020 2020 2020   "WGS84".       
+00001130: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00001140: 2020 2069 4644 4f65 7863 6570 7469 6f6e     iFDOexception
+00001150: 732e 6170 7065 6e64 285b 2222 2c22 436f  s.append(["","Co
+00001160: 6f72 6469 6e61 7465 7320 7265 6665 7265  ordinates refere
+00001170: 6e63 6520 7379 7374 656d 205c 2222 202b  nce system \"" +
+00001180: 2072 6566 7379 7320 2b20 225c 2220 6361   refsys + "\" ca
+00001190: 6e20 6e6f 7420 6265 2068 616e 646c 6564  n not be handled
+000011a0: 2e20 5573 6520 7072 6566 6572 6162 6c79  . Use preferably
+000011b0: 2045 5053 473a 3433 3236 206f 7220 5747   EPSG:4326 or WG
+000011c0: 5338 3422 5d29 0a20 2020 2020 2020 2020  S84"]).         
+000011d0: 2020 2072 6574 7572 6e20 6946 444f 6578     return iFDOex
+000011e0: 6365 7074 696f 6e73 0a0a 0a20 2020 2020  ceptions...     
+000011f0: 2020 2066 6f72 2070 686f 746f 2069 6e20     for photo in 
+00001200: 706f 7369 7469 6f6e 734c 6174 4c6f 6e3a  positionsLatLon:
+00001210: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+00001220: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00001230: 2020 7365 6c66 2e63 6865 636b 4974 656d    self.checkItem
+00001240: 4861 7368 2870 686f 746f 2c69 6d61 6765  Hash(photo,image
+00001250: 536f 7572 6365 4469 7229 2023 2054 4f44  SourceDir) # TOD
+00001260: 4f20 636f 756c 6420 6265 2069 6e20 6469  O could be in di
+00001270: 6666 6572 656e 7420 7375 6266 6f6c 6465  fferent subfolde
+00001280: 7220 6f72 2066 726f 6d20 6f6e 6c69 6e65  r or from online
+00001290: 2062 726f 6b65 720a 0a20 2020 2020 2020   broker..       
+000012a0: 2020 2020 2020 2020 2023 2063 6f6e 7665           # conve
+000012b0: 7274 2074 6f20 7574 6d20 746f 2061 766f  rt to utm to avo
+000012c0: 6964 2070 7265 6369 7369 6f6e 2069 7373  id precision iss
+000012d0: 7565 2077 6974 6820 6c61 742f 6c6f 6e20  ue with lat/lon 
+000012e0: 7661 6c75 6573 2069 6e20 776f 726c 6420  values in world 
+000012f0: 6669 6c65 730a 2020 2020 2020 2020 2020  files.          
+00001300: 2020 2020 2020 6c61 7420 3d20 706f 7369        lat = posi
+00001310: 7469 6f6e 734c 6174 4c6f 6e5b 7068 6f74  tionsLatLon[phot
+00001320: 6f5d 5b30 5d5b 276c 6174 275d 0a20 2020  o][0]['lat'].   
+00001330: 2020 2020 2020 2020 2020 2020 206c 6f6e               lon
+00001340: 203d 2070 6f73 6974 696f 6e73 4c61 744c   = positionsLatL
+00001350: 6f6e 5b70 686f 746f 5d5b 305d 5b27 6c6f  on[photo][0]['lo
+00001360: 6e27 5d0a 2020 2020 2020 2020 2020 2020  n'].            
+00001370: 2020 2020 6561 7374 696e 672c 6e6f 7274      easting,nort
+00001380: 6869 6e67 2c7a 6f6e 652c 6973 4e6f 7274  hing,zone,isNort
+00001390: 6820 3d20 6d69 7174 672e 6c61 744c 6f6e  h = miqtg.latLon
+000013a0: 3275 746d 286c 6174 2c6c 6f6e 2c72 6566  2utm(lat,lon,ref
+000013b0: 7379 7329 0a20 2020 2020 2020 2020 2020  sys).           
+000013c0: 2020 2020 2065 7869 6620 3d20 7365 6c66       exif = self
+000013d0: 2e5f 5f67 6574 4974 656d 4465 6661 756c  .__getItemDefaul
+000013e0: 7456 616c 7565 2870 686f 746f 2c27 696d  tValue(photo,'im
+000013f0: 6167 652d 6163 7175 6973 6974 696f 6e2d  age-acquisition-
+00001400: 7365 7474 696e 6773 2729 2023 2054 4f44  settings') # TOD
+00001410: 4f20 7768 6174 2069 6620 6e6f 7420 7468  O what if not th
+00001420: 6572 653f 2072 6561 6420 6672 6f6d 2069  ere? read from i
+00001430: 6d61 6765 2064 6972 6563 746c 793f 2053  mage directly? S
+00001440: 686f 756c 6420 6265 2063 6865 636b 6564  hould be checked
+00001450: 2069 6620 6861 7368 206d 6174 6368 6573   if hash matches
+00001460: 3f20 496d 6167 6520 636f 756c 6420 6861  ? Image could ha
+00001470: 7665 2062 6565 6e20 6372 6f70 7065 6420  ve been cropped 
+00001480: 6166 7465 7220 6946 444f 2063 7265 6174  after iFDO creat
+00001490: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+000014a0: 2020 2020 696d 6167 6557 6964 7468 203d      imageWidth =
+000014b0: 2069 6e74 2873 7472 2865 7869 665b 2749   int(str(exif['I
+000014c0: 6d61 6765 2057 6964 7468 275d 292e 7374  mage Width']).st
+000014d0: 7269 7028 275c 2727 2929 0a20 2020 2020  rip('\'')).     
+000014e0: 2020 2020 2020 2020 2020 2069 6d61 6765             image
+000014f0: 4865 6967 6874 203d 2069 6e74 2873 7472  Height = int(str
+00001500: 2865 7869 665b 2749 6d61 6765 2048 6569  (exif['Image Hei
+00001510: 6768 7427 5d29 2e73 7472 6970 2827 5c27  ght']).strip('\'
+00001520: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
+00001530: 2020 2020 6865 6164 696e 6720 3d20 7365      heading = se
+00001540: 6c66 2e5f 5f67 6574 4974 656d 4465 6661  lf.__getItemDefa
+00001550: 756c 7456 616c 7565 2870 686f 746f 2c27  ultValue(photo,'
+00001560: 696d 6167 652d 6361 6d65 7261 2d79 6177  image-camera-yaw
+00001570: 2d64 6567 7265 6573 2729 0a20 2020 2020  -degrees').     
+00001580: 2020 2020 2020 2020 2020 2061 6c74 6974             altit
+00001590: 7564 6520 3d20 7365 6c66 2e5f 5f67 6574  ude = self.__get
+000015a0: 4974 656d 4465 6661 756c 7456 616c 7565  ItemDefaultValue
+000015b0: 2870 686f 746f 2c27 696d 6167 652d 6d65  (photo,'image-me
+000015c0: 7465 7273 2d61 626f 7665 2d67 726f 756e  ters-above-groun
+000015d0: 6427 290a 0a20 2020 2020 2020 2020 2020  d')..           
+000015e0: 2020 2020 2064 6f6d 6550 6f72 742c 6d73       domePort,ms
+000015f0: 6720 3d20 7365 6c66 2e5f 5f74 7279 4765  g = self.__tryGe
+00001600: 7449 7344 6f6d 6550 6f72 7428 7068 6f74  tIsDomePort(phot
+00001610: 6f29 0a20 2020 2020 2020 2020 2020 2020  o).             
+00001620: 2020 2066 6f63 616c 4c65 6e67 6850 6978     focalLenghPix
+00001630: 656c 732c 206d 7367 203d 2073 656c 662e  els, msg = self.
+00001640: 5f5f 7472 7947 6574 466f 6361 6c4c 656e  __tryGetFocalLen
+00001650: 6774 6849 6e50 6978 656c 7328 7068 6f74  gthInPixels(phot
+00001660: 6f2c 2064 6f6d 6550 6f72 7429 0a20 2020  o, domePort).   
+00001670: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00001680: 666f 6361 6c4c 656e 6768 5069 7865 6c73  focalLenghPixels
+00001690: 203d 3d20 5b2d 312c 2d31 5d20 6f72 2066   == [-1,-1] or f
+000016a0: 6f63 616c 4c65 6e67 6850 6978 656c 7320  ocalLenghPixels 
+000016b0: 3d3d 202d 313a 0a20 2020 2020 2020 2020  == -1:.         
+000016c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000016d0: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
+000016e0: 7469 6f6e 286d 7367 290a 2020 2020 2020  tion(msg).      
+000016f0: 2020 2020 2020 2020 2020 6d69 7174 672e            miqtg.
+00001700: 7772 6974 6553 696d 706c 6555 746d 576f  writeSimpleUtmWo
+00001710: 726c 6446 696c 6528 6f73 2e70 6174 682e  rldFile(os.path.
+00001720: 6a6f 696e 2864 6573 7444 6972 2c6d 6971  join(destDir,miq
+00001730: 7467 2e63 6f6e 7665 7274 496d 6167 654e  tg.convertImageN
+00001740: 616d 6554 6f57 6f72 6c64 4669 6c65 4e61  ameToWorldFileNa
+00001750: 6d65 2870 686f 746f 2929 2c65 6173 7469  me(photo)),easti
+00001760: 6e67 2c6e 6f72 7468 696e 672c 7a6f 6e65  ng,northing,zone
+00001770: 2c69 734e 6f72 7468 2c69 6d61 6765 5769  ,isNorth,imageWi
+00001780: 6474 682c 696d 6167 6548 6569 6768 742c  dth,imageHeight,
+00001790: 6865 6164 696e 672c 616c 7469 7475 6465  heading,altitude
+000017a0: 2c66 6f63 616c 4c65 6e67 6850 6978 656c  ,focalLenghPixel
+000017b0: 735b 305d 2c66 6f63 616c 4c65 6e67 6850  s[0],focalLenghP
+000017c0: 6978 656c 735b 315d 290a 2020 2020 2020  ixels[1]).      
+000017d0: 2020 2020 2020 6578 6365 7074 206d 6971        except miq
+000017e0: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+000017f0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00001800: 2020 2020 2020 2069 4644 4f65 7863 6570         iFDOexcep
+00001810: 7469 6f6e 732e 6170 7065 6e64 285b 7068  tions.append([ph
+00001820: 6f74 6f2c 7374 7228 652e 6172 6773 295d  oto,str(e.args)]
+00001830: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00001840: 6e20 6946 444f 6578 6365 7074 696f 6e73  n iFDOexceptions
+00001850: 0a0a 0a20 2020 2064 6566 2063 6865 636b  ...    def check
+00001860: 4974 656d 4861 7368 2873 656c 662c 6974  ItemHash(self,it
+00001870: 656d 3a73 7472 2c66 696c 6544 6972 3a73  em:str,fileDir:s
+00001880: 7472 293a 0a20 2020 2020 2020 2022 2222  tr):.        """
+00001890: 2063 6f6d 7061 7265 7320 6669 6c65 2773   compares file's
+000018a0: 2068 6173 6820 7769 7468 2068 6173 6820   hash with hash 
+000018b0: 696e 2069 4644 4f20 616e 6420 7468 726f  in iFDO and thro
+000018c0: 7773 2065 7863 6570 7469 6f6e 2069 6620  ws exception if 
+000018d0: 7468 6579 2064 6f6e 2774 206d 6174 6368  they don't match
+000018e0: 2022 2222 0a0a 2020 2020 2020 2020 6669   """..        fi
+000018f0: 6c65 203d 206f 732e 7061 7468 2e6a 6f69  le = os.path.joi
+00001900: 6e28 6669 6c65 4469 722c 6974 656d 290a  n(fileDir,item).
+00001910: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+00001920: 732e 7061 7468 2e69 7366 696c 6528 6669  s.path.isfile(fi
+00001930: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+00001940: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
+00001950: 6f45 7863 6570 7469 6f6e 2822 4669 6c65  oException("File
+00001960: 205c 2222 202b 2069 7465 6d20 2b20 225c   \"" + item + "\
+00001970: 2220 6e6f 7420 666f 756e 6420 696e 2064  " not found in d
+00001980: 6972 205c 2222 202b 2066 696c 6544 6972  ir \"" + fileDir
+00001990: 202b 2022 5c22 2229 0a0a 2020 2020 2020   + "\"")..      
+000019a0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000019b0: 7365 6c66 2e69 6664 6f5b 6d69 7174 762e  self.ifdo[miqtv.
+000019c0: 696d 6167 655f 7365 745f 6974 656d 735f  image_set_items_
+000019d0: 6b65 795d 5b69 7465 6d5d 2c6c 6973 7429  key][item],list)
+000019e0: 3a20 2320 696e 2063 6173 6520 6f66 2076  : # in case of v
+000019f0: 6964 656f 2077 6974 6820 6974 656d 2061  ideo with item a
+00001a00: 7320 6c69 7374 2074 6865 2066 6972 7374  s list the first
+00001a10: 2065 6e74 7279 2068 6f6c 6473 2074 6865   entry holds the
+00001a20: 2064 6566 6175 6c74 2061 6e64 2074 6865   default and the
+00001a30: 2068 6173 6820 6361 6e6e 6f74 2076 6172   hash cannot var
+00001a40: 7920 666f 7220 7468 6520 7361 6d65 2069  y for the same i
+00001a50: 6d61 6765 0a20 2020 2020 2020 2020 2020  mage.           
+00001a60: 2069 7465 6d45 6e74 7279 203d 2073 656c   itemEntry = sel
+00001a70: 662e 6966 646f 5b6d 6971 7476 2e69 6d61  f.ifdo[miqtv.ima
+00001a80: 6765 5f73 6574 5f69 7465 6d73 5f6b 6579  ge_set_items_key
+00001a90: 5d5b 6974 656d 5d5b 305d 200a 2020 2020  ][item][0] .    
+00001aa0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00001ab0: 2020 2020 2020 6974 656d 456e 7472 7920        itemEntry 
+00001ac0: 3d20 7365 6c66 2e69 6664 6f5b 6d69 7174  = self.ifdo[miqt
+00001ad0: 762e 696d 6167 655f 7365 745f 6974 656d  v.image_set_item
+00001ae0: 735f 6b65 795d 5b69 7465 6d5d 0a20 2020  s_key][item].   
+00001af0: 2020 2020 2069 6620 6e6f 7420 6974 656d       if not item
+00001b00: 456e 7472 795b 2769 6d61 6765 2d68 6173  Entry['image-has
+00001b10: 682d 7368 6132 3536 275d 203d 3d20 6d69  h-sha256'] == mi
+00001b20: 7174 632e 7368 6132 3536 4861 7368 4669  qtc.sha256HashFi
+00001b30: 6c65 2866 696c 6529 3a0a 2020 2020 2020  le(file):.      
+00001b40: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
+00001b50: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
+00001b60: 6974 656d 2c20 2269 4644 4f20 656e 7472  item, "iFDO entr
+00001b70: 7920 6973 206e 6f74 2075 7020 746f 2064  y is not up to d
+00001b80: 6174 652c 2069 6d61 6765 2068 6173 6820  ate, image hash 
+00001b90: 646f 6573 206e 6f74 206d 6174 6368 2e22  does not match."
+00001ba0: 290a 0a20 2020 2064 6566 2067 6574 496d  )..    def getIm
+00001bb0: 6167 6544 6972 6563 746f 7279 2873 656c  ageDirectory(sel
+00001bc0: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
+00001bd0: 5265 7475 726e 7320 7468 6520 6c6f 7765  Returns the lowe
+00001be0: 726d 6f73 7420 6c6f 6361 6c20 6469 7265  rmost local dire
+00001bf0: 6374 6f72 7920 636f 6e74 6169 6e69 6e67  ctory containing
+00001c00: 2074 6865 2069 6d61 6765 2066 696c 6573   the image files
+00001c10: 2069 6e66 6572 7265 6420 6672 6f6d 2027   inferred from '
+00001c20: 696d 6167 652d 7365 742d 6c6f 6361 6c2d  image-set-local-
+00001c30: 7061 7468 272e 2049 6620 2769 6d61 6765  path'. If 'image
+00001c40: 2d73 6574 2d6c 6f63 616c 2d70 6174 6827  -set-local-path'
+00001c50: 206e 6f74 2070 726f 7669 6465 6420 666f   not provided fo
+00001c60: 7220 616c 6c20 696d 6167 6520 6974 656d  r all image item
+00001c70: 7320 7468 6520 6946 444f 2773 2070 6172  s the iFDO's par
+00001c80: 656e 7420 6469 7265 6374 6f72 7920 6973  ent directory is
+00001c90: 2072 6574 7572 6e65 642e 2022 2222 0a20   returned. """. 
+00001ca0: 2020 2020 2020 206c 6f63 616c 5061 7468         localPath
+00001cb0: 7320 3d20 5b5d 0a20 2020 2020 2020 2069  s = [].        i
+00001cc0: 4644 4f46 696c 6550 6172 656e 7444 6972  FDOFileParentDir
+00001cd0: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
+00001ce0: 6d65 286f 732e 7061 7468 2e64 6972 6e61  me(os.path.dirna
+00001cf0: 6d65 2873 656c 662e 6946 444f 6669 6c65  me(self.iFDOfile
+00001d00: 2929 0a20 2020 2020 2020 2066 6f72 2069  )).        for i
+00001d10: 7465 6d20 696e 2073 656c 662e 6966 646f  tem in self.ifdo
+00001d20: 5b6d 6971 7476 2e69 6d61 6765 5f73 6574  [miqtv.image_set
+00001d30: 5f69 7465 6d73 5f6b 6579 5d3a 0a20 2020  _items_key]:.   
+00001d40: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00001d50: 2020 2020 2020 2020 2020 2020 2020 6974                it
+00001d60: 656d 4c6f 6361 6c50 6174 6820 3d20 7365  emLocalPath = se
+00001d70: 6c66 2e5f 5f67 6574 4974 656d 4465 6661  lf.__getItemDefa
+00001d80: 756c 7456 616c 7565 2869 7465 6d2c 2769  ultValue(item,'i
+00001d90: 6d61 6765 2d73 6574 2d6c 6f63 616c 2d70  mage-set-local-p
+00001da0: 6174 6827 290a 2020 2020 2020 2020 2020  ath').          
+00001db0: 2020 6578 6365 7074 206d 6971 7463 2e49    except miqtc.I
+00001dc0: 6664 6f45 7863 6570 7469 6f6e 3a0a 2020  fdoException:.  
+00001dd0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00001de0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00001df0: 2020 2020 2020 2069 7465 6d4c 6f63 616c         itemLocal
+00001e00: 5061 7468 203d 2073 656c 662e 5f5f 6765  Path = self.__ge
+00001e10: 7449 7465 6d44 6566 6175 6c74 5661 6c75  tItemDefaultValu
+00001e20: 6528 6974 656d 2c27 696d 6167 652d 6c6f  e(item,'image-lo
+00001e30: 6361 6c2d 7061 7468 2729 2023 2062 6163  cal-path') # bac
+00001e40: 6b77 6172 6473 2063 6f6d 7061 7469 6269  kwards compatibi
+00001e50: 6c69 7479 0a20 2020 2020 2020 2020 2020  lity.           
+00001e60: 2020 2020 2065 7863 6570 7420 6d69 7174       except miqt
+00001e70: 632e 4966 646f 4578 6365 7074 696f 6e3a  c.IfdoException:
+00001e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001e90: 2020 2020 2069 7465 6d4c 6f63 616c 5061       itemLocalPa
+00001ea0: 7468 203d 2069 4644 4f46 696c 6550 6172  th = iFDOFilePar
+00001eb0: 656e 7444 6972 0a20 2020 2020 2020 2020  entDir.         
+00001ec0: 2020 2069 6620 6974 656d 4c6f 6361 6c50     if itemLocalP
+00001ed0: 6174 6820 6e6f 7420 696e 206c 6f63 616c  ath not in local
+00001ee0: 5061 7468 733a 0a20 2020 2020 2020 2020  Paths:.         
+00001ef0: 2020 2020 2020 206c 6f63 616c 5061 7468         localPath
+00001f00: 732e 6170 7065 6e64 2869 7465 6d4c 6f63  s.append(itemLoc
+00001f10: 616c 5061 7468 290a 2020 2020 2020 2020  alPath).        
+00001f20: 636f 6d6d 6f6e 5061 7468 203d 206f 732e  commonPath = os.
+00001f30: 7061 7468 2e63 6f6d 6d6f 6e70 6174 6828  path.commonpath(
+00001f40: 6c6f 6361 6c50 6174 6873 290a 2020 2020  localPaths).    
+00001f50: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+00001f60: 7468 2e69 7361 6273 2863 6f6d 6d6f 6e50  th.isabs(commonP
+00001f70: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
+00001f80: 2020 636f 6d6d 6f6e 5061 7468 203d 206f    commonPath = o
+00001f90: 732e 7061 7468 2e6e 6f72 6d70 6174 6828  s.path.normpath(
+00001fa0: 6f73 2e70 6174 682e 6a6f 696e 286f 732e  os.path.join(os.
+00001fb0: 7061 7468 2e64 6972 6e61 6d65 2873 656c  path.dirname(sel
+00001fc0: 662e 6946 444f 6669 6c65 292c 2063 6f6d  f.iFDOfile), com
+00001fd0: 6d6f 6e50 6174 6829 290a 2020 2020 2020  monPath)).      
+00001fe0: 2020 7265 7475 726e 2063 6f6d 6d6f 6e50    return commonP
+00001ff0: 6174 680a 0a0a 2020 2020 6465 6620 5f5f  ath...    def __
+00002000: 7472 7947 6574 4973 446f 6d65 506f 7274  tryGetIsDomePort
+00002010: 2873 656c 662c 6974 656d 293a 0a20 2020  (self,item):.   
+00002020: 2020 2020 2022 2222 2054 7269 6573 2074       """ Tries t
+00002030: 6f20 7265 6164 2070 6f72 7420 7479 7065  o read port type
+00002040: 2066 726f 6d20 2769 6d61 6765 2d63 616d   from 'image-cam
+00002050: 6572 612d 686f 7573 696e 672d 7669 6577  era-housing-view
+00002060: 706f 7274 275b 7669 6577 706f 7274 2d74  port'[viewport-t
+00002070: 7970 655d 206f 7220 2769 6d61 6765 2d66  ype] or 'image-f
+00002080: 6c61 7470 6f72 742d 7061 7261 6d65 7465  latport-paramete
+00002090: 7273 272f 2769 6d61 6765 2d64 6f6d 6570  rs'/'image-domep
+000020a0: 6f72 742d 7061 7261 6d65 7465 7273 2720  ort-parameters' 
+000020b0: 0a20 2020 2020 2020 2020 2020 2052 6574  .            Ret
+000020c0: 7572 6e73 2054 7275 652c 6d73 6720 6966  urns True,msg if
+000020d0: 2064 6f6d 6520 706f 7274 2c20 4661 6c73   dome port, Fals
+000020e0: 652c 6d73 6720 6966 2066 6c61 7420 706f  e,msg if flat po
+000020f0: 7274 2c20 4e6f 6e65 2c6d 7367 206f 7468  rt, None,msg oth
+00002100: 6572 7769 7365 2022 2222 0a0a 2020 2020  erwise """..    
+00002110: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00002120: 2020 2020 2070 6f72 7454 7970 6553 7472       portTypeStr
+00002130: 203d 2073 656c 662e 5f5f 6765 7449 7465   = self.__getIte
+00002140: 6d44 6566 6175 6c74 5661 6c75 6528 6974  mDefaultValue(it
+00002150: 656d 2c27 696d 6167 652d 6361 6d65 7261  em,'image-camera
+00002160: 2d68 6f75 7369 6e67 2d76 6965 7770 6f72  -housing-viewpor
+00002170: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
+00002180: 706f 7274 5479 7065 5374 7220 3d20 706f  portTypeStr = po
+00002190: 7274 5479 7065 5374 725b 2776 6965 7770  rtTypeStr['viewp
+000021a0: 6f72 742d 7479 7065 275d 0a20 2020 2020  ort-type'].     
+000021b0: 2020 2020 2020 2069 6620 2764 6f6d 6527         if 'dome'
+000021c0: 2069 6e20 706f 7274 5479 7065 5374 722e   in portTypeStr.
+000021d0: 6c6f 7765 7228 2920 616e 6420 6e6f 7420  lower() and not 
+000021e0: 2766 6c61 7427 2069 6e20 706f 7274 5479  'flat' in portTy
+000021f0: 7065 5374 722e 6c6f 7765 7228 293a 0a20  peStr.lower():. 
+00002200: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00002210: 6574 7572 6e20 5472 7565 2c22 5061 7273  eturn True,"Pars
+00002220: 6564 2066 726f 6d20 2769 6d61 6765 2d63  ed from 'image-c
+00002230: 616d 6572 612d 686f 7573 696e 672d 7669  amera-housing-vi
+00002240: 6577 706f 7274 275b 2776 6965 7770 6f72  ewport'['viewpor
+00002250: 742d 7479 7065 275d 220a 2020 2020 2020  t-type']".      
+00002260: 2020 2020 2020 656c 6966 206e 6f74 2027        elif not '
+00002270: 646f 6d65 2720 696e 2070 6f72 7454 7970  dome' in portTyp
+00002280: 6553 7472 2e6c 6f77 6572 2829 2061 6e64  eStr.lower() and
+00002290: 2027 666c 6174 2720 696e 2070 6f72 7454   'flat' in portT
+000022a0: 7970 6553 7472 2e6c 6f77 6572 2829 3a0a  ypeStr.lower():.
+000022b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000022c0: 7265 7475 726e 2046 616c 7365 2c22 5061  return False,"Pa
+000022d0: 7273 6564 2066 726f 6d20 2769 6d61 6765  rsed from 'image
+000022e0: 2d63 616d 6572 612d 686f 7573 696e 672d  -camera-housing-
+000022f0: 7669 6577 706f 7274 275b 2776 6965 7770  viewport'['viewp
+00002300: 6f72 742d 7479 7065 275d 220a 2020 2020  ort-type']".    
+00002310: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00002320: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00002330: 7475 726e 204e 6f6e 652c 2243 6f75 6c64  turn None,"Could
+00002340: 206e 6f74 2072 6561 6420 706f 7274 2074   not read port t
+00002350: 7970 6520 6672 6f6d 2027 696d 6167 652d  ype from 'image-
+00002360: 6361 6d65 7261 2d68 6f75 7369 6e67 2d76  camera-housing-v
+00002370: 6965 7770 6f72 7427 5b27 7669 6577 706f  iewport'['viewpo
+00002380: 7274 2d74 7970 6527 5d20 696e 2069 7465  rt-type'] in ite
+00002390: 6d3a 2022 202b 2069 7465 6d0a 2020 2020  m: " + item.    
+000023a0: 2020 2020 6578 6365 7074 2028 6d69 7174      except (miqt
+000023b0: 632e 4966 646f 4578 6365 7074 696f 6e2c  c.IfdoException,
+000023c0: 204b 6579 4572 726f 7229 3a0a 2020 2020   KeyError):.    
+000023d0: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
+000023e0: 2020 2020 2020 666c 6174 506f 7274 5061        flatPortPa
+000023f0: 7261 6d73 466f 756e 6420 3d20 4661 6c73  ramsFound = Fals
+00002400: 650a 2020 2020 2020 2020 7472 793a 200a  e.        try: .
+00002410: 2020 2020 2020 2020 2020 2020 666c 6174              flat
+00002420: 506f 7274 5061 7261 6d73 203d 2073 656c  PortParams = sel
+00002430: 662e 5f5f 6765 7449 7465 6d44 6566 6175  f.__getItemDefau
+00002440: 6c74 5661 6c75 6528 6974 656d 2c27 696d  ltValue(item,'im
+00002450: 6167 652d 666c 6174 706f 7274 2d70 6172  age-flatport-par
+00002460: 616d 6574 6572 7327 290a 2020 2020 2020  ameters').      
+00002470: 2020 2020 2020 666c 6174 506f 7274 5061        flatPortPa
+00002480: 7261 6d73 466f 756e 6420 3d20 5472 7565  ramsFound = True
+00002490: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+000024a0: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+000024b0: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+000024c0: 2070 6173 730a 2020 2020 2020 2020 646f   pass.        do
+000024d0: 6d65 506f 7274 5061 7261 6d73 466f 756e  mePortParamsFoun
+000024e0: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
+000024f0: 2020 7472 793a 200a 2020 2020 2020 2020    try: .        
+00002500: 2020 2020 646f 6d65 506f 7274 5061 7261      domePortPara
+00002510: 6d73 203d 2073 656c 662e 5f5f 6765 7449  ms = self.__getI
+00002520: 7465 6d44 6566 6175 6c74 5661 6c75 6528  temDefaultValue(
+00002530: 6974 656d 2c27 696d 6167 652d 646f 6d65  item,'image-dome
+00002540: 706f 7274 2d70 6172 616d 6574 6572 7327  port-parameters'
+00002550: 290a 2020 2020 2020 2020 2020 2020 646f  ).            do
+00002560: 6d65 506f 7274 5061 7261 6d73 466f 756e  mePortParamsFoun
+00002570: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
+00002580: 2065 7863 6570 7420 6d69 7174 632e 4966   except miqtc.If
+00002590: 646f 4578 6365 7074 696f 6e3a 0a20 2020  doException:.   
+000025a0: 2020 2020 2020 2020 2070 6173 730a 0a20           pass.. 
+000025b0: 2020 2020 2020 2069 6620 666c 6174 506f         if flatPo
+000025c0: 7274 5061 7261 6d73 466f 756e 6420 616e  rtParamsFound an
+000025d0: 6420 646f 6d65 506f 7274 5061 7261 6d73  d domePortParams
+000025e0: 466f 756e 643a 0a20 2020 2020 2020 2020  Found:.         
+000025f0: 2020 2072 6574 7572 6e20 4e6f 6e65 2c22     return None,"
+00002600: 436f 756c 6420 6e6f 7420 7265 6164 2070  Could not read p
+00002610: 6f72 7420 7479 7065 2066 726f 6d20 6974  ort type from it
+00002620: 656d 2061 7320 6974 2063 6f6e 7461 696e  em as it contain
+00002630: 7320 696e 666f 206f 6e20 626f 7468 2066  s info on both f
+00002640: 6c61 7420 616e 6420 646f 6d65 2070 6f72  lat and dome por
+00002650: 743a 2022 202b 2069 7465 6d0a 2020 2020  t: " + item.    
+00002660: 2020 2020 6966 2066 6c61 7450 6f72 7450      if flatPortP
+00002670: 6172 616d 7346 6f75 6e64 3a0a 2020 2020  aramsFound:.    
+00002680: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00002690: 616c 7365 2c22 4173 7375 6d65 6420 6173  alse,"Assumed as
+000026a0: 2066 6c61 7420 706f 7274 2061 7320 2769   flat port as 'i
+000026b0: 6d61 6765 2d66 6c61 7470 6f72 742d 7061  mage-flatport-pa
+000026c0: 7261 6d65 7465 7273 2720 666f 756e 6420  rameters' found 
+000026d0: 696e 2069 7465 6d3a 2022 202b 2069 7465  in item: " + ite
+000026e0: 6d0a 2020 2020 2020 2020 6966 2064 6f6d  m.        if dom
+000026f0: 6550 6f72 7450 6172 616d 7346 6f75 6e64  ePortParamsFound
+00002700: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00002710: 7475 726e 2054 7275 652c 2241 7373 756d  turn True,"Assum
+00002720: 6564 2061 7320 646f 6d65 2070 6f72 7420  ed as dome port 
+00002730: 6173 2027 696d 6167 652d 646f 6d65 706f  as 'image-domepo
+00002740: 7274 2d70 6172 616d 6574 6572 7327 2066  rt-parameters' f
+00002750: 6f75 6e64 2069 6e20 6974 656d 3a20 2220  ound in item: " 
+00002760: 2b20 6974 656d 0a20 2020 2020 2020 2072  + item.        r
+00002770: 6574 7572 6e20 4e6f 6e65 2c22 436f 756c  eturn None,"Coul
+00002780: 6420 6e6f 7420 7265 6164 2070 6f72 7420  d not read port 
+00002790: 7479 7065 2066 726f 6d20 6974 656d 3a20  type from item: 
+000027a0: 2220 2b20 6974 656d 0a0a 0a20 2020 2064  " + item...    d
+000027b0: 6566 205f 5f74 7279 4765 7446 6f63 616c  ef __tryGetFocal
+000027c0: 4c65 6e67 7468 496e 5069 7865 6c73 2873  LengthInPixels(s
+000027d0: 656c 662c 6974 656d 3a73 7472 2c64 6f6d  elf,item:str,dom
+000027e0: 6550 6f72 743d 4e6f 6e65 293a 0a20 2020  ePort=None):.   
+000027f0: 2020 2020 2022 2222 200a 2020 2020 2020       """ .      
+00002800: 2020 5472 6965 7320 746f 2072 6561 642f    Tries to read/
+00002810: 6465 7465 726d 696e 6520 666f 6361 6c20  determine focal 
+00002820: 6c65 6e67 7468 2069 6e20 7069 7865 6c73  length in pixels
+00002830: 2065 6974 6865 7220 6672 6f6d 2027 696d   either from 'im
+00002840: 6167 652d 6361 6d65 7261 2d63 616c 6962  age-camera-calib
+00002850: 7261 7469 6f6e 2d6d 6f64 656c 275b 2763  ration-model'['c
+00002860: 616c 6962 7261 7469 6f6e 2d66 6f63 616c  alibration-focal
+00002870: 2d6c 656e 6774 682d 7879 2d70 6978 656c  -length-xy-pixel
+00002880: 275d 206f 7220 6672 6f6d 2065 7869 6620  '] or from exif 
+00002890: 7661 6c75 6573 2e0a 2020 2020 2020 2020  values..        
+000028a0: 6966 2064 6f6d 6550 6f72 7420 3d20 4661  if domePort = Fa
+000028b0: 6c73 652c 2066 6c61 7420 706f 7274 2069  lse, flat port i
+000028c0: 7320 6173 7375 6d65 6420 616e 6420 6120  s assumed and a 
+000028d0: 636f 7272 6563 7469 6f6e 2066 6163 746f  correction facto
+000028e0: 7220 6f66 2031 2e33 3320 6973 2061 7070  r of 1.33 is app
+000028f0: 6c69 6564 2066 6f72 2066 6f63 616c 206c  lied for focal l
+00002900: 656e 6774 6820 6465 7465 726d 696e 6564  ength determined
+00002910: 2066 726f 6d20 6578 6966 2076 616c 7565   from exif value
+00002920: 730a 2020 2020 2020 2020 5265 7475 726e  s.        Return
+00002930: 7320 6569 7468 6572 2066 6f63 616c 4c65  s either focalLe
+00002940: 6e67 7468 2c20 6d65 7373 6167 6520 6f72  ngth, message or
+00002950: 205b 666f 6361 6c4c 656e 6774 6858 2c66   [focalLengthX,f
+00002960: 6f63 616c 4c65 6e67 7468 595d 2c20 6d65  ocalLengthY], me
+00002970: 7373 6167 652e 2049 6620 756e 7375 6363  ssage. If unsucc
+00002980: 6573 7366 756c 2066 6f63 616c 4c65 6e67  essful focalLeng
+00002990: 7468 203d 202d 310a 2020 2020 2020 2020  th = -1.        
+000029a0: 2222 220a 0a20 2020 2020 2020 2023 2074  """..        # t
+000029b0: 7279 2072 6561 6420 6672 6f6d 2027 696d  ry read from 'im
+000029c0: 6167 652d 6361 6d65 7261 2d63 616c 6962  age-camera-calib
+000029d0: 7261 7469 6f6e 2d6d 6f64 656c 275b 2763  ration-model'['c
+000029e0: 616c 6962 7261 7469 6f6e 2d66 6f63 616c  alibration-focal
+000029f0: 2d6c 656e 6774 682d 7879 2d70 6978 656c  -length-xy-pixel
+00002a00: 275d 0a20 2020 2020 2020 2074 7279 3a0a  '].        try:.
+00002a10: 2020 2020 2020 2020 2020 2020 666f 6361              foca
+00002a20: 6c4c 656e 6774 6858 5920 3d20 7365 6c66  lLengthXY = self
+00002a30: 2e5f 5f67 6574 4974 656d 4465 6661 756c  .__getItemDefaul
+00002a40: 7456 616c 7565 2869 7465 6d2c 2769 6d61  tValue(item,'ima
+00002a50: 6765 2d63 616d 6572 612d 6361 6c69 6272  ge-camera-calibr
+00002a60: 6174 696f 6e2d 6d6f 6465 6c27 290a 2020  ation-model').  
+00002a70: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00002a80: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00002a90: 6f63 616c 4c65 6e67 7468 5859 203d 2066  ocalLengthXY = f
+00002aa0: 6f63 616c 4c65 6e67 7468 5859 5b27 6361  ocalLengthXY['ca
+00002ab0: 6c69 6272 6174 696f 6e2d 666f 6361 6c2d  libration-focal-
+00002ac0: 6c65 6e67 7468 2d78 792d 7069 7865 6c27  length-xy-pixel'
+00002ad0: 5d0a 2020 2020 2020 2020 2020 2020 6578  ].            ex
+00002ae0: 6365 7074 204b 6579 4572 726f 723a 0a20  cept KeyError:. 
+00002af0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00002b00: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
+00002b10: 7863 6570 7469 6f6e 2869 7465 6d2c 2264  xception(item,"d
+00002b20: 6f65 7320 6e6f 7420 636f 6e74 6169 6e20  oes not contain 
+00002b30: 2769 6d61 6765 2d63 616d 6572 612d 6361  'image-camera-ca
+00002b40: 6c69 6272 6174 696f 6e2d 6d6f 6465 6c27  libration-model'
+00002b50: 5b27 6361 6c69 6272 6174 696f 6e2d 666f  ['calibration-fo
+00002b60: 6361 6c2d 6c65 6e67 7468 2d78 792d 7069  cal-length-xy-pi
+00002b70: 7865 6c27 5d22 290a 0a20 2020 2020 2020  xel']")..       
+00002b80: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+00002b90: 7374 616e 6365 2866 6f63 616c 4c65 6e67  stance(focalLeng
+00002ba0: 7468 5859 2c6c 6973 7429 3a20 2320 7820  thXY,list): # x 
+00002bb0: 616e 6420 7920 7661 6c75 6520 6172 6520  and y value are 
+00002bc0: 6964 656e 7469 6361 6c0a 2020 2020 2020  identical.      
+00002bd0: 2020 2020 2020 2020 2020 666f 6361 6c4c            focalL
+00002be0: 656e 6774 6858 5920 3d20 5b66 6f63 616c  engthXY = [focal
+00002bf0: 4c65 6e67 7468 5859 2c66 6f63 616c 4c65  LengthXY,focalLe
+00002c00: 6e67 7468 5859 5d0a 2020 2020 2020 2020  ngthXY].        
+00002c10: 2020 2020 6966 206c 656e 2866 6f63 616c      if len(focal
+00002c20: 4c65 6e67 7468 5859 2920 213d 2032 3a0a  LengthXY) != 2:.
+00002c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002c40: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
+00002c50: 4578 6365 7074 696f 6e28 6974 656d 2c22  Exception(item,"
+00002c60: 496e 7661 6c69 6420 656e 7472 7920 666f  Invalid entry fo
+00002c70: 7220 2769 6d61 6765 2d63 616d 6572 612d  r 'image-camera-
+00002c80: 6361 6c69 6272 6174 696f 6e2d 6d6f 6465  calibration-mode
+00002c90: 6c27 5b27 6361 6c69 6272 6174 696f 6e2d  l'['calibration-
+00002ca0: 666f 6361 6c2d 6c65 6e67 7468 2d78 792d  focal-length-xy-
+00002cb0: 7069 7865 6c27 5d20 3a20 2220 2b20 7374  pixel'] : " + st
+00002cc0: 7228 666f 6361 6c4c 656e 6774 6858 5929  r(focalLengthXY)
+00002cd0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+00002ce0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00002cf0: 6528 666f 6361 6c4c 656e 6774 6858 595b  e(focalLengthXY[
+00002d00: 305d 2c66 6c6f 6174 2920 6f72 206e 6f74  0],float) or not
+00002d10: 2069 7369 6e73 7461 6e63 6528 666f 6361   isinstance(foca
+00002d20: 6c4c 656e 6774 6858 595b 305d 2c69 6e74  lLengthXY[0],int
+00002d30: 2920 6f72 206e 6f74 2069 7369 6e73 7461  ) or not isinsta
+00002d40: 6e63 6528 666f 6361 6c4c 656e 6774 6858  nce(focalLengthX
+00002d50: 595b 315d 2c66 6c6f 6174 2920 6f72 206e  Y[1],float) or n
+00002d60: 6f74 2069 7369 6e73 7461 6e63 6528 666f  ot isinstance(fo
+00002d70: 6361 6c4c 656e 6774 6858 595b 315d 2c69  calLengthXY[1],i
+00002d80: 6e74 293a 0a20 2020 2020 2020 2020 2020  nt):.           
+00002d90: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00002da0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00002db0: 6361 6c4c 656e 6774 6858 5920 3d20 5b66  calLengthXY = [f
+00002dc0: 6c6f 6174 2866 6f63 616c 4c65 6e67 7468  loat(focalLength
+00002dd0: 5859 5b30 5d29 2c66 6c6f 6174 2866 6f63  XY[0]),float(foc
+00002de0: 616c 4c65 6e67 7468 5859 5b31 5d29 5d0a  alLengthXY[1])].
+00002df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002e00: 6578 6365 7074 2056 616c 7565 4572 726f  except ValueErro
+00002e10: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00002e20: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
+00002e30: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+00002e40: 2869 7465 6d2c 2249 6e76 616c 6964 2065  (item,"Invalid e
+00002e50: 6e74 7279 2066 6f72 2027 696d 6167 652d  ntry for 'image-
+00002e60: 6361 6d65 7261 2d63 616c 6962 7261 7469  camera-calibrati
+00002e70: 6f6e 2d6d 6f64 656c 275b 2763 616c 6962  on-model'['calib
+00002e80: 7261 7469 6f6e 2d66 6f63 616c 2d6c 656e  ration-focal-len
+00002e90: 6774 682d 7879 2d70 6978 656c 275d 203a  gth-xy-pixel'] :
+00002ea0: 2022 202b 2073 7472 2866 6f63 616c 4c65   " + str(focalLe
+00002eb0: 6e67 7468 5859 2920 290a 2020 2020 2020  ngthXY) ).      
+00002ec0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+00002ed0: 2020 2072 6574 7572 6e20 666f 6361 6c4c     return focalL
+00002ee0: 656e 6774 6858 592c 2022 5061 7273 6564  engthXY, "Parsed
+00002ef0: 2066 726f 6d20 2769 6d61 6765 2d63 616d   from 'image-cam
+00002f00: 6572 612d 6361 6c69 6272 6174 696f 6e2d  era-calibration-
+00002f10: 6d6f 6465 6c27 5b27 6361 6c69 6272 6174  model'['calibrat
+00002f20: 696f 6e2d 666f 6361 6c2d 6c65 6e67 7468  ion-focal-length
+00002f30: 2d78 792d 7069 7865 6c27 5d22 0a20 2020  -xy-pixel']".   
+00002f40: 2020 2020 2065 7863 6570 7420 6d69 7174       except miqt
+00002f50: 632e 4966 646f 4578 6365 7074 696f 6e3a  c.IfdoException:
+00002f60: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+00002f70: 730a 0a20 2020 2020 2020 2075 6e64 6572  s..        under
+00002f80: 7761 7465 7249 6d61 6765 203d 2054 7275  waterImage = Tru
+00002f90: 650a 2020 2020 2020 2020 7472 793a 0a20  e.        try:. 
+00002fa0: 2020 2020 2020 2020 2020 2061 6c74 3020             alt0 
+00002fb0: 3d20 7365 6c66 5b69 7465 6d2b 2730 3a69  = self[item+'0:i
+00002fc0: 6d61 6765 2d61 6c74 6974 7564 652d 6d65  mage-altitude-me
+00002fd0: 7465 7273 275d 2023 7365 6c66 2e5f 5f67  ters'] #self.__g
+00002fe0: 6574 4974 656d 4465 6661 756c 7456 616c  etItemDefaultVal
+00002ff0: 7565 2869 7465 6d2c 2027 696d 6167 652d  ue(item, 'image-
+00003000: 616c 7469 7475 6465 2d6d 6574 6572 7327  altitude-meters'
+00003010: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00003020: 2061 6c74 3020 3e20 303a 0a20 2020 2020   alt0 > 0:.     
+00003030: 2020 2020 2020 2020 2020 2075 6e64 6572             under
+00003040: 7761 7465 7249 6d61 6765 203d 2046 616c  waterImage = Fal
+00003050: 7365 0a20 2020 2020 2020 2065 7863 6570  se.        excep
+00003060: 7420 6d69 7174 632e 4966 646f 4578 6365  t miqtc.IfdoExce
+00003070: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
+00003080: 2020 2070 6173 730a 0a20 2020 2020 2020     pass..       
+00003090: 2023 2061 6464 2063 6f72 7265 6374 696f   # add correctio
+000030a0: 6e20 6661 6374 6f72 2066 6f72 2066 6c61  n factor for fla
+000030b0: 7420 706f 7274 0a20 2020 2020 2020 2069  t port.        i
+000030c0: 6620 646f 6d65 506f 7274 2069 7320 4e6f  f domePort is No
+000030d0: 6e65 2061 6e64 2075 6e64 6572 7761 7465  ne and underwate
+000030e0: 7249 6d61 6765 3a0a 2020 2020 2020 2020  rImage:.        
+000030f0: 2020 2020 7265 7475 726e 205b 2d31 2c2d      return [-1,-
+00003100: 315d 2c20 2243 6f75 6c64 206e 6f74 2064  1], "Could not d
+00003110: 6574 6572 6d69 6e65 2066 6f63 616c 206c  etermine focal l
+00003120: 656e 6774 6820 6672 6f6d 2027 696d 6167  ength from 'imag
+00003130: 652d 6361 6d65 7261 2d63 616c 6962 7261  e-camera-calibra
+00003140: 7469 6f6e 2d6d 6f64 656c 275b 2763 616c  tion-model'['cal
+00003150: 6962 7261 7469 6f6e 2d66 6f63 616c 2d6c  ibration-focal-l
+00003160: 656e 6774 682d 7879 2d70 6978 656c 275d  ength-xy-pixel']
+00003170: 2061 6e64 2070 6f72 7420 7479 7065 2c20   and port type, 
+00003180: 7768 6963 6820 6973 2072 6571 7569 7265  which is require
+00003190: 6420 666f 7220 636f 7272 6563 7420 6576  d for correct ev
+000031a0: 616c 7561 7469 6f6e 206f 6620 6578 6966  aluation of exif
+000031b0: 2076 616c 7565 732c 2069 7320 6e6f 7420   values, is not 
+000031c0: 7072 6f76 6964 6564 2122 0a20 2020 2020  provided!".     
+000031d0: 2020 2063 6f72 7265 6374 696f 6e46 6b74     correctionFkt
+000031e0: 203d 2031 2e30 0a20 2020 2020 2020 2069   = 1.0.        i
+000031f0: 6620 646f 6d65 506f 7274 203d 3d20 4661  f domePort == Fa
+00003200: 6c73 6520 616e 6420 756e 6465 7277 6174  lse and underwat
+00003210: 6572 496d 6167 653a 0a20 2020 2020 2020  erImage:.       
+00003220: 2020 2020 2063 6f72 7265 6374 696f 6e46       correctionF
+00003230: 6b74 203d 2031 2e33 330a 0a20 2020 2020  kt = 1.33..     
+00003240: 2020 2023 206f 7468 6572 7769 7365 2074     # otherwise t
+00003250: 7279 2064 6572 6976 6520 6672 6f6d 2065  ry derive from e
+00003260: 7869 6620 7461 6773 0a20 2020 2020 2020  xif tags.       
+00003270: 2065 7869 6620 3d20 7365 6c66 2e5f 5f67   exif = self.__g
+00003280: 6574 4974 656d 4465 6661 756c 7456 616c  etItemDefaultVal
+00003290: 7565 2869 7465 6d2c 2769 6d61 6765 2d61  ue(item,'image-a
+000032a0: 6371 7569 7369 7469 6f6e 2d73 6574 7469  cquisition-setti
+000032b0: 6e67 7327 290a 2020 2020 2020 2020 2323  ngs').        ##
+000032c0: 2066 726f 6d20 466f 6361 6c20 4c65 6e67   from Focal Leng
+000032d0: 7468 2c20 466f 6361 6c20 506c 616e 6520  th, Focal Plane 
+000032e0: 5820 5265 736f 6c75 7469 6f6e 2c20 466f  X Resolution, Fo
+000032f0: 6361 6c20 506c 616e 6520 5920 5265 736f  cal Plane Y Reso
+00003300: 6c75 7469 6f6e 2c20 466f 6361 6c20 506c  lution, Focal Pl
+00003310: 616e 6520 5265 736f 6c75 7469 6f6e 2055  ane Resolution U
+00003320: 6e69 740a 2020 2020 2020 2020 666f 6361  nit.        foca
+00003330: 6c4c 656e 6774 6858 592c 206d 7367 203d  lLengthXY, msg =
+00003340: 2073 656c 662e 5f5f 7472 7944 6574 6572   self.__tryDeter
+00003350: 6d69 6e65 466f 6361 6c4c 656e 6768 7449  mineFocalLenghtI
+00003360: 6e50 6978 656c 7346 726f 6d45 7869 665f  nPixelsFromExif_
+00003370: 3128 6578 6966 290a 2020 2020 2020 2020  1(exif).        
+00003380: 6966 2066 6f63 616c 4c65 6e67 7468 5859  if focalLengthXY
+00003390: 2021 3d20 5b2d 312c 2d31 5d3a 0a20 2020   != [-1,-1]:.   
+000033a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000033b0: 5b65 2a63 6f72 7265 6374 696f 6e46 6b74  [e*correctionFkt
+000033c0: 2066 6f72 2065 2069 6e20 666f 6361 6c4c   for e in focalL
+000033d0: 656e 6774 6858 595d 2c20 2744 6572 6976  engthXY], 'Deriv
+000033e0: 6564 2066 726f 6d20 6578 6966 2074 6167  ed from exif tag
+000033f0: 7320 466f 6361 6c20 4c65 6e67 7468 2c20  s Focal Length, 
+00003400: 466f 6361 6c20 506c 616e 6520 5820 5265  Focal Plane X Re
+00003410: 736f 6c75 7469 6f6e 2c20 466f 6361 6c20  solution, Focal 
+00003420: 506c 616e 6520 5920 5265 736f 6c75 7469  Plane Y Resoluti
+00003430: 6f6e 2c20 466f 6361 6c20 506c 616e 6520  on, Focal Plane 
+00003440: 5265 736f 6c75 7469 6f6e 2055 6e69 7427  Resolution Unit'
+00003450: 0a20 2020 2020 2020 2023 2320 6672 6f6d  .        ## from
+00003460: 2066 726f 6d20 3335 206d 6d20 6571 7569   from 35 mm equi
+00003470: 7661 6c65 6e74 2066 6f63 616c 206c 656e  valent focal len
+00003480: 6774 680a 2020 2020 2020 2020 666f 6361  gth.        foca
+00003490: 6c4c 656e 6774 6858 592c 206d 7367 203d  lLengthXY, msg =
+000034a0: 2073 656c 662e 5f5f 7472 7944 6574 6572   self.__tryDeter
+000034b0: 6d69 6e65 466f 6361 6c4c 656e 6768 7449  mineFocalLenghtI
+000034c0: 6e50 6978 656c 7346 726f 6d45 7869 665f  nPixelsFromExif_
+000034d0: 3228 6578 6966 290a 2020 2020 2020 2020  2(exif).        
+000034e0: 6966 2066 6f63 616c 4c65 6e67 7468 5859  if focalLengthXY
+000034f0: 2021 3d20 5b2d 312c 2d31 5d3a 0a20 2020   != [-1,-1]:.   
+00003500: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00003510: 5b65 2a63 6f72 7265 6374 696f 6e46 6b74  [e*correctionFkt
+00003520: 2066 6f72 2065 2069 6e20 666f 6361 6c4c   for e in focalL
+00003530: 656e 6774 6858 595d 2c20 2744 6572 6976  engthXY], 'Deriv
+00003540: 6564 2066 726f 6d20 6578 6966 2074 6167  ed from exif tag
+00003550: 2046 6f63 616c 204c 656e 6774 6820 7769   Focal Length wi
+00003560: 7468 2033 3520 6d6d 2065 7175 6976 616c  th 35 mm equival
+00003570: 656e 7427 0a20 0a20 2020 2020 2020 2072  ent'. .        r
+00003580: 6574 7572 6e20 5b2d 312c 2d31 5d2c 2022  eturn [-1,-1], "
+00003590: 436f 756c 6420 6e6f 7420 6465 7465 726d  Could not determ
+000035a0: 696e 6520 6672 6f6d 2066 6f63 616c 206c  ine from focal l
+000035b0: 656e 6774 6820 696e 2070 6978 656c 7320  ength in pixels 
+000035c0: 6672 6f6d 206e 6569 7468 6572 2027 696d  from neither 'im
+000035d0: 6167 652d 6361 6d65 7261 2d63 616c 6962  age-camera-calib
+000035e0: 7261 7469 6f6e 2d6d 6f64 656c 275b 2763  ration-model'['c
+000035f0: 616c 6962 7261 7469 6f6e 2d66 6f63 616c  alibration-focal
+00003600: 2d6c 656e 6774 682d 7879 2d70 6978 656c  -length-xy-pixel
+00003610: 275d 206e 6f72 2065 7869 6620 7461 6773  '] nor exif tags
+00003620: 2046 6f63 616c 204c 656e 6774 682c 2046   Focal Length, F
+00003630: 6f63 616c 2050 6c61 6e65 2058 2052 6573  ocal Plane X Res
+00003640: 6f6c 7574 696f 6e2c 2046 6f63 616c 2050  olution, Focal P
+00003650: 6c61 6e65 2059 2052 6573 6f6c 7574 696f  lane Y Resolutio
+00003660: 6e2c 2046 6f63 616c 2050 6c61 6e65 2052  n, Focal Plane R
+00003670: 6573 6f6c 7574 696f 6e20 556e 6974 220a  esolution Unit".
+00003680: 0a0a 2020 2020 6465 6620 5f5f 7472 7944  ..    def __tryD
+00003690: 6574 6572 6d69 6e65 466f 6361 6c4c 656e  etermineFocalLen
+000036a0: 6768 7449 6e50 6978 656c 7346 726f 6d45  ghtInPixelsFromE
+000036b0: 7869 665f 3128 7365 6c66 2c65 7869 6644  xif_1(self,exifD
+000036c0: 6963 743a 6469 6374 293a 0a20 2020 2020  ict:dict):.     
+000036d0: 2020 2022 2222 2074 7279 2074 6f20 6465     """ try to de
+000036e0: 7465 726d 696e 6520 666f 6361 6c20 6c65  termine focal le
+000036f0: 6e67 7468 2069 6e20 7069 7865 6c73 2066  ngth in pixels f
+00003700: 726f 6d20 6578 6966 2074 6167 7320 466f  rom exif tags Fo
+00003710: 6361 6c20 4c65 6e67 7468 2c20 466f 6361  cal Length, Foca
+00003720: 6c20 506c 616e 6520 5820 5265 736f 6c75  l Plane X Resolu
+00003730: 7469 6f6e 2c20 466f 6361 6c20 506c 616e  tion, Focal Plan
+00003740: 6520 5920 5265 736f 6c75 7469 6f6e 2c20  e Y Resolution, 
+00003750: 466f 6361 6c20 506c 616e 6520 5265 736f  Focal Plane Reso
+00003760: 6c75 7469 6f6e 2055 6e69 742e 0a20 2020  lution Unit..   
+00003770: 2020 2020 2020 2020 2052 6574 7275 6e73           Retruns
+00003780: 205b 666f 6361 6c4c 656e 6774 6850 6978   [focalLengthPix
+00003790: 656c 735f 782c 666f 6361 6c4c 656e 6774  els_x,focalLengt
+000037a0: 6850 6978 656c 735f 795d 2c20 6d65 7373  hPixels_y], mess
+000037b0: 6167 650a 2020 2020 2020 2020 2020 2020  age.            
+000037c0: 5265 7472 756e 7320 666f 6361 6c4c 656e  Retruns focalLen
+000037d0: 6774 6850 6978 656c 7320 3d20 2d31 2069  gthPixels = -1 i
+000037e0: 6620 6e6f 7420 7375 6363 6573 7366 756c  f not successful
+000037f0: 6c20 2222 220a 0a20 2020 2020 2020 2074  l """..        t
+00003800: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00003810: 666f 6361 6c4c 656e 6774 6820 3d20 7374  focalLength = st
+00003820: 7228 6578 6966 4469 6374 5b27 466f 6361  r(exifDict['Foca
+00003830: 6c20 4c65 6e67 7468 275d 290a 2020 2020  l Length']).    
+00003840: 2020 2020 2020 2020 666f 6361 6c50 6c61          focalPla
+00003850: 6e65 5265 735f 7820 3d20 666c 6f61 7428  neRes_x = float(
+00003860: 7374 7228 6578 6966 4469 6374 5b27 466f  str(exifDict['Fo
+00003870: 6361 6c20 506c 616e 6520 5820 5265 736f  cal Plane X Reso
+00003880: 6c75 7469 6f6e 275d 292e 7374 7269 7028  lution']).strip(
+00003890: 275c 2727 2929 0a20 2020 2020 2020 2020  '\'')).         
+000038a0: 2020 2066 6f63 616c 506c 616e 6552 6573     focalPlaneRes
+000038b0: 5f79 203d 2066 6c6f 6174 2873 7472 2865  _y = float(str(e
+000038c0: 7869 6644 6963 745b 2746 6f63 616c 2050  xifDict['Focal P
+000038d0: 6c61 6e65 2059 2052 6573 6f6c 7574 696f  lane Y Resolutio
+000038e0: 6e27 5d29 2e73 7472 6970 2827 5c27 2729  n']).strip('\'')
+000038f0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+00003900: 6361 6c50 6c61 6e65 5265 735f 756e 6974  calPlaneRes_unit
+00003910: 203d 2073 7472 2865 7869 6644 6963 745b   = str(exifDict[
+00003920: 2746 6f63 616c 2050 6c61 6e65 2052 6573  'Focal Plane Res
+00003930: 6f6c 7574 696f 6e20 556e 6974 275d 292e  olution Unit']).
+00003940: 7374 7269 7028 275c 2727 290a 2020 2020  strip('\'').    
+00003950: 2020 2020 6578 6365 7074 2028 4b65 7945      except (KeyE
+00003960: 7272 6f72 2c20 5661 6c75 6545 7272 6f72  rror, ValueError
+00003970: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00003980: 6574 7572 6e20 5b2d 312c 2d31 5d2c 2022  eturn [-1,-1], "
+00003990: 436f 756c 6420 6e6f 7420 6669 6e64 2061  Could not find a
+000039a0: 6c6c 2072 6571 7569 7265 6420 6669 656c  ll required fiel
+000039b0: 6473 2046 6f63 616c 204c 656e 6774 682c  ds Focal Length,
+000039c0: 2046 6f63 616c 2050 6c61 6e65 2058 2052   Focal Plane X R
+000039d0: 6573 6f6c 7574 696f 6e2c 2046 6f63 616c  esolution, Focal
+000039e0: 2050 6c61 6e65 2059 2052 6573 6f6c 7574   Plane Y Resolut
+000039f0: 696f 6e2c 2046 6f63 616c 2050 6c61 6e65  ion, Focal Plane
+00003a00: 2052 6573 6f6c 7574 696f 6e20 556e 6974   Resolution Unit
+00003a10: 220a 2020 2020 2020 2020 0a20 2020 2020  ".        .     
+00003a20: 2020 2023 2070 6172 7365 2066 6f63 616c     # parse focal
+00003a30: 206c 656e 6774 6820 6672 6f6d 206c 6566   length from lef
+00003a40: 7420 286d 6179 2062 6520 2737 2e35 206d  t (may be '7.5 m
+00003a50: 6d20 282e 2e2e 2927 290a 2020 2020 2020  m (...)').      
+00003a60: 2020 666f 6361 6c4c 656e 6774 6853 7472    focalLengthStr
+00003a70: 6970 7065 6420 3d20 666f 6361 6c4c 656e  ipped = focalLen
+00003a80: 6774 682e 7374 7269 7028 290a 2020 2020  gth.strip().    
+00003a90: 2020 2020 666f 6361 6c4c 656e 6774 6846      focalLengthF
+00003aa0: 6c6f 6174 203d 204e 6f6e 650a 2020 2020  loat = None.    
+00003ab0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+00003ac0: 6765 286c 656e 2866 6f63 616c 4c65 6e67  ge(len(focalLeng
+00003ad0: 7468 5374 7269 7070 6564 2929 3a0a 2020  thStripped)):.  
+00003ae0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00003af0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00003b00: 6f63 616c 4c65 6e67 7468 466c 6f61 7420  ocalLengthFloat 
+00003b10: 3d20 666c 6f61 7428 666f 6361 6c4c 656e  = float(focalLen
+00003b20: 6774 6853 7472 6970 7065 645b 303a 692b  gthStripped[0:i+
+00003b30: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
+00003b40: 6578 6365 7074 2056 616c 7565 4572 726f  except ValueErro
+00003b50: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00003b60: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+00003b70: 6966 2066 6f63 616c 4c65 6e67 7468 466c  if focalLengthFl
+00003b80: 6f61 7420 6973 204e 6f6e 653a 0a20 2020  oat is None:.   
+00003b90: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00003ba0: 5b2d 312c 2d31 5d2c 2022 436f 756c 6420  [-1,-1], "Could 
+00003bb0: 6e6f 7420 7061 7273 6520 666f 7263 616c  not parse forcal
+00003bc0: 206c 656e 6774 6820 6672 6f6d 2027 466f   length from 'Fo
+00003bd0: 6361 6c20 4c65 6e67 7468 273a 2022 202b  cal Length': " +
+00003be0: 2066 6f63 616c 4c65 6e67 7468 0a20 2020   focalLength.   
+00003bf0: 2020 2020 2073 6361 6c65 466b 745f 666f       scaleFkt_fo
+00003c00: 6361 6c20 3d20 7365 6c66 2e5f 5f75 6e69  cal = self.__uni
+00003c10: 7443 6f6e 7665 7273 696f 6e46 6163 7432  tConversionFact2
+00003c20: 6d6d 2866 6f63 616c 4c65 6e67 7468 290a  mm(focalLength).
+00003c30: 2020 2020 2020 2020 6966 2073 6361 6c65          if scale
+00003c40: 466b 745f 666f 6361 6c20 3d3d 202d 313a  Fkt_focal == -1:
+00003c50: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00003c60: 7572 6e20 5b2d 312c 2d31 5d2c 2022 436f  urn [-1,-1], "Co
+00003c70: 756c 6420 6e6f 7420 7061 7273 6520 666f  uld not parse fo
+00003c80: 7263 616c 206c 656e 6774 6820 756e 6974  rcal length unit
+00003c90: 2066 726f 6d20 2746 6f63 616c 204c 656e   from 'Focal Len
+00003ca0: 6774 6827 3a20 2220 2b20 666f 6361 6c4c  gth': " + focalL
+00003cb0: 656e 6774 680a 2020 2020 2020 2020 666f  ength.        fo
+00003cc0: 6361 6c4c 656e 6774 685f 6d6d 203d 2066  calLength_mm = f
+00003cd0: 6f63 616c 4c65 6e67 7468 466c 6f61 7420  ocalLengthFloat 
+00003ce0: 2a20 7363 616c 6546 6b74 5f66 6f63 616c  * scaleFkt_focal
+00003cf0: 0a0a 2020 2020 2020 2020 7363 616c 6546  ..        scaleF
+00003d00: 6b74 5f72 6573 203d 2073 656c 662e 5f5f  kt_res = self.__
+00003d10: 756e 6974 436f 6e76 6572 7369 6f6e 4661  unitConversionFa
+00003d20: 6374 326d 6d28 666f 6361 6c50 6c61 6e65  ct2mm(focalPlane
+00003d30: 5265 735f 756e 6974 290a 2020 2020 2020  Res_unit).      
+00003d40: 2020 6966 2073 6361 6c65 466b 745f 7265    if scaleFkt_re
+00003d50: 7320 3d3d 202d 313a 0a20 2020 2020 2020  s == -1:.       
+00003d60: 2020 2020 2072 6574 7572 6e20 5b2d 312c       return [-1,
+00003d70: 2d31 5d2c 2022 436f 756c 6420 6e6f 7420  -1], "Could not 
+00003d80: 7061 7273 6520 466f 6361 6c20 506c 616e  parse Focal Plan
+00003d90: 6520 5265 736f 6c75 7469 6f6e 2055 6e69  e Resolution Uni
+00003da0: 7420 6672 6f6d 2027 466f 6361 6c20 506c  t from 'Focal Pl
+00003db0: 616e 6520 5265 736f 6c75 7469 6f6e 2055  ane Resolution U
+00003dc0: 6e69 7427 3a20 2220 2b20 666f 6361 6c50  nit': " + focalP
+00003dd0: 6c61 6e65 5265 735f 756e 6974 0a0a 2020  laneRes_unit..  
+00003de0: 2020 2020 2020 666f 6361 6c4c 656e 6774        focalLengt
+00003df0: 6850 6978 656c 735f 7820 3d20 666f 6361  hPixels_x = foca
+00003e00: 6c4c 656e 6774 685f 6d6d 202a 2066 6f63  lLength_mm * foc
+00003e10: 616c 506c 616e 6552 6573 5f78 202f 2073  alPlaneRes_x / s
+00003e20: 6361 6c65 466b 745f 7265 730a 2020 2020  caleFkt_res.    
+00003e30: 2020 2020 666f 6361 6c4c 656e 6774 6850      focalLengthP
+00003e40: 6978 656c 735f 7920 3d20 666f 6361 6c4c  ixels_y = focalL
+00003e50: 656e 6774 685f 6d6d 202a 2066 6f63 616c  ength_mm * focal
+00003e60: 506c 616e 6552 6573 5f79 202f 2073 6361  PlaneRes_y / sca
+00003e70: 6c65 466b 745f 7265 730a 0a20 2020 2020  leFkt_res..     
+00003e80: 2020 2072 6574 7572 6e20 5b66 6f63 616c     return [focal
+00003e90: 4c65 6e67 7468 5069 7865 6c73 5f78 2c66  LengthPixels_x,f
+00003ea0: 6f63 616c 4c65 6e67 7468 5069 7865 6c73  ocalLengthPixels
+00003eb0: 5f79 5d2c 2022 220a 0a0a 2020 2020 6465  _y], ""...    de
+00003ec0: 6620 5f5f 7472 7944 6574 6572 6d69 6e65  f __tryDetermine
+00003ed0: 466f 6361 6c4c 656e 6768 7449 6e50 6978  FocalLenghtInPix
+00003ee0: 656c 7346 726f 6d45 7869 665f 3228 7365  elsFromExif_2(se
+00003ef0: 6c66 2c65 7869 6644 6963 743a 6469 6374  lf,exifDict:dict
+00003f00: 293a 0a20 2020 2020 2020 2022 2222 2074  ):.        """ t
+00003f10: 7279 2074 6f20 6465 7465 726d 696e 6520  ry to determine 
+00003f20: 666f 6361 6c20 6c65 6e67 7468 2069 6e20  focal length in 
+00003f30: 7069 7865 6c73 2066 726f 6d20 3335 206d  pixels from 35 m
+00003f40: 6d20 6571 7569 7661 6c65 6e74 2066 6f63  m equivalent foc
+00003f50: 616c 206c 656e 6774 6820 696e 2065 7869  al length in exi
+00003f60: 6620 7461 6720 466f 6361 6c20 4c65 6e67  f tag Focal Leng
+00003f70: 7468 2773 2061 6464 206f 6e20 652e 672e  th's add on e.g.
+00003f80: 2027 372e 3020 6d6d 2028 3335 206d 6d20   '7.0 mm (35 mm 
+00003f90: 6571 7569 7661 6c65 6e74 3a20 3338 2e38  equivalent: 38.8
+00003fa0: 206d 6d29 272e 0a20 2020 2020 2020 2020   mm)'..         
+00003fb0: 2020 2052 6574 7275 6e73 205b 666f 6361     Retruns [foca
+00003fc0: 6c4c 656e 6774 6850 6978 656c 735f 782c  lLengthPixels_x,
+00003fd0: 666f 6361 6c4c 656e 6774 6850 6978 656c  focalLengthPixel
+00003fe0: 735f 795d 2c20 6d65 7373 6167 650a 2020  s_y], message.  
+00003ff0: 2020 2020 2020 2020 2020 5265 7472 756e            Retrun
+00004000: 7320 666f 6361 6c4c 656e 6774 6850 6978  s focalLengthPix
+00004010: 656c 7320 3d20 2d31 2069 6620 6e6f 7420  els = -1 if not 
+00004020: 7375 6363 6573 7366 756c 6c20 2222 220a  successfull """.
+00004030: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00004040: 2020 2020 2020 2020 2020 666f 6361 6c4c            focalL
+00004050: 656e 6774 6820 3d20 7374 7228 6578 6966  ength = str(exif
+00004060: 4469 6374 5b27 466f 6361 6c20 4c65 6e67  Dict['Focal Leng
+00004070: 7468 275d 290a 2020 2020 2020 2020 2020  th']).          
+00004080: 2020 696d 6167 6557 6964 7468 203d 2069    imageWidth = i
+00004090: 6e74 2873 7472 2865 7869 6644 6963 745b  nt(str(exifDict[
+000040a0: 2749 6d61 6765 2057 6964 7468 275d 292e  'Image Width']).
+000040b0: 7374 7269 7028 275c 2727 2929 0a20 2020  strip('\'')).   
+000040c0: 2020 2020 2065 7863 6570 7420 284b 6579       except (Key
+000040d0: 4572 726f 722c 2056 616c 7565 4572 726f  Error, ValueErro
+000040e0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+000040f0: 7265 7475 726e 205b 2d31 2c2d 315d 2c20  return [-1,-1], 
+00004100: 2243 6f75 6c64 206e 6f74 2066 696e 6420  "Could not find 
+00004110: 616c 6c20 7265 7175 6972 6564 2066 6965  all required fie
+00004120: 6c64 7320 466f 6361 6c20 4c65 6e67 7468  lds Focal Length
+00004130: 2c20 496d 6167 6520 5769 6474 6822 0a0a  , Image Width"..
+00004140: 2020 2020 2020 2020 2320 7472 7920 7061          # try pa
+00004150: 7273 6520 3335 206d 6d20 6571 7569 7661  rse 35 mm equiva
+00004160: 6c65 6e74 2066 726f 6d20 652e 672e 3a20  lent from e.g.: 
+00004170: 2037 2e30 206d 6d20 2833 3520 6d6d 2065   7.0 mm (35 mm e
+00004180: 7175 6976 616c 656e 743a 2033 382e 3820  quivalent: 38.8 
+00004190: 6d6d 290a 2020 2020 2020 2020 636f 6c6f  mm).        colo
+000041a0: 6e49 6e64 6578 203d 2066 6f63 616c 4c65  nIndex = focalLe
+000041b0: 6e67 7468 2e66 696e 6428 273a 2729 0a20  ngth.find(':'). 
+000041c0: 2020 2020 2020 2069 6620 636f 6c6f 6e49         if colonI
+000041d0: 6e64 6578 203d 3d20 2d31 3a0a 2020 2020  ndex == -1:.    
+000041e0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+000041f0: 2d31 2c2d 315d 2c20 2243 6f75 6c64 206e  -1,-1], "Could n
+00004200: 6f74 2070 6172 7365 2033 3520 6d6d 2065  ot parse 35 mm e
+00004210: 7175 6976 616c 656e 7420 666f 6361 6c20  quivalent focal 
+00004220: 6c65 6e67 7468 2066 726f 6d20 2746 6f63  length from 'Foc
+00004230: 616c 204c 656e 6774 6827 3a20 2220 2b20  al Length': " + 
+00004240: 666f 6361 6c4c 656e 6774 680a 2020 2020  focalLength.    
+00004250: 2020 2020 666f 6361 6c4c 656e 6774 6845      focalLengthE
+00004260: 7133 356d 6d46 6c6f 6174 203d 204e 6f6e  q35mmFloat = Non
+00004270: 650a 2020 2020 2020 2020 6571 7561 6c33  e.        equal3
+00004280: 356d 6d50 6172 7420 3d20 666f 6361 6c4c  5mmPart = focalL
+00004290: 656e 6774 685b 636f 6c6f 6e49 6e64 6578  ength[colonIndex
+000042a0: 2b31 3a3a 5d2e 7374 7269 7028 290a 2020  +1::].strip().  
+000042b0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+000042c0: 616e 6765 286c 656e 2865 7175 616c 3335  ange(len(equal35
+000042d0: 6d6d 5061 7274 2929 3a0a 2020 2020 2020  mmPart)):.      
+000042e0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000042f0: 2020 2020 2020 2020 2020 2066 6f63 616c             focal
+00004300: 4c65 6e67 7468 4571 3335 6d6d 466c 6f61  LengthEq35mmFloa
+00004310: 7420 3d20 666c 6f61 7428 6571 7561 6c33  t = float(equal3
+00004320: 356d 6d50 6172 745b 303a 692b 315d 290a  5mmPart[0:i+1]).
+00004330: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00004340: 7074 2056 616c 7565 4572 726f 723a 0a20  pt ValueError:. 
+00004350: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00004360: 6173 730a 2020 2020 2020 2020 7363 616c  ass.        scal
+00004370: 6546 6b74 203d 2073 656c 662e 5f5f 756e  eFkt = self.__un
+00004380: 6974 436f 6e76 6572 7369 6f6e 4661 6374  itConversionFact
+00004390: 326d 6d28 666f 6361 6c4c 656e 6774 685b  2mm(focalLength[
+000043a0: 636f 6c6f 6e49 6e64 6578 2b31 3a3a 5d29  colonIndex+1::])
+000043b0: 0a20 2020 2020 2020 2069 6620 666f 6361  .        if foca
+000043c0: 6c4c 656e 6774 6845 7133 356d 6d46 6c6f  lLengthEq35mmFlo
+000043d0: 6174 2069 7320 4e6f 6e65 206f 7220 7363  at is None or sc
+000043e0: 616c 6546 6b74 203d 3d20 2d31 3a0a 2020  aleFkt == -1:.  
+000043f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00004400: 205b 2d31 2c2d 315d 2c20 2243 6f75 6c64   [-1,-1], "Could
+00004410: 206e 6f74 2070 6172 7365 2033 3520 6d6d   not parse 35 mm
+00004420: 2065 7175 6976 616c 656e 7420 666f 6361   equivalent foca
+00004430: 6c20 6c65 6e67 7468 2066 726f 6d20 2746  l length from 'F
+00004440: 6f63 616c 204c 656e 6774 6827 3a20 2220  ocal Length': " 
+00004450: 2b20 666f 6361 6c4c 656e 6774 680a 2020  + focalLength.  
+00004460: 2020 2020 2020 0a20 2020 2020 2020 2066        .        f
+00004470: 6f63 616c 4c65 6e67 7468 5069 7865 6c73  ocalLengthPixels
+00004480: 203d 2066 6f63 616c 4c65 6e67 7468 4571   = focalLengthEq
+00004490: 3335 6d6d 466c 6f61 7420 2a20 7363 616c  35mmFloat * scal
+000044a0: 6546 6b74 202a 2069 6d61 6765 5769 6474  eFkt * imageWidt
+000044b0: 6820 2f20 3336 2e30 0a20 2020 2020 2020  h / 36.0.       
+000044c0: 2072 6574 7572 6e20 5b66 6f63 616c 4c65   return [focalLe
+000044d0: 6e67 7468 5069 7865 6c73 2c66 6f63 616c  ngthPixels,focal
+000044e0: 4c65 6e67 7468 5069 7865 6c73 5d2c 2022  LengthPixels], "
+000044f0: 220a 0a0a 2020 2020 6465 6620 5f5f 756e  "...    def __un
+00004500: 6974 436f 6e76 6572 7369 6f6e 4661 6374  itConversionFact
+00004510: 326d 6d28 7365 6c66 2c75 6e69 743a 7374  2mm(self,unit:st
+00004520: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
+00004530: 6c6f 6f6b 7320 666f 7220 6c65 7474 6572  looks for letter
+00004540: 2073 6571 7565 6e63 6520 696e 2075 6e69   sequence in uni
+00004550: 7420 616e 6420 6368 6563 6b73 2069 6620  t and checks if 
+00004560: 6974 2773 2027 696e 6368 6573 272c 276d  it's 'inches','m
+00004570: 272c 2763 6d27 2c27 6d6d 272c 2775 6d27  ','cm','mm','um'
+00004580: 206f 7220 2727 2061 6e64 2072 6574 7572   or '' and retur
+00004590: 6e73 2072 6573 7065 6374 6976 6520 636f  ns respective co
+000045a0: 6e76 6572 7369 6f6e 2066 6163 746f 7220  nversion factor 
+000045b0: 746f 206d 6d20 2869 6620 7468 6572 6520  to mm (if there 
+000045c0: 6172 6520 6e6f 206c 6574 7465 7273 2069  are no letters i
+000045d0: 7420 7265 7475 726e 7320 3129 2e20 4f74  t returns 1). Ot
+000045e0: 6865 7277 6973 6520 7265 7475 726e 202d  herwise return -
+000045f0: 3120 2222 220a 0a20 2020 2020 2020 2066  1 """..        f
+00004600: 6972 7374 4c65 7474 6572 5365 7120 3d20  irstLetterSeq = 
+00004610: 2222 0a20 2020 2020 2020 2066 6972 7374  "".        first
+00004620: 466f 756e 6420 3d20 4661 6c73 650a 2020  Found = False.  
+00004630: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00004640: 616e 6765 286c 656e 2875 6e69 7429 293a  ange(len(unit)):
+00004650: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00004660: 756e 6974 5b69 5d2e 6973 616c 7068 6128  unit[i].isalpha(
+00004670: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00004680: 2020 2066 6972 7374 466f 756e 6420 3d20     firstFound = 
+00004690: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+000046a0: 2020 2020 2066 6972 7374 4c65 7474 6572       firstLetter
+000046b0: 5365 7120 2b3d 2075 6e69 745b 695d 0a20  Seq += unit[i]. 
+000046c0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+000046d0: 7420 756e 6974 5b69 5d2e 6973 616c 7068  t unit[i].isalph
+000046e0: 6128 2920 616e 6420 6669 7273 7446 6f75  a() and firstFou
+000046f0: 6e64 203d 3d20 5472 7565 3a0a 2020 2020  nd == True:.    
+00004700: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00004710: 6b0a 0a20 2020 2020 2020 2069 6620 6669  k..        if fi
+00004720: 7273 744c 6574 7465 7253 6571 2e6c 6f77  rstLetterSeq.low
+00004730: 6572 2829 203d 3d20 2269 6e63 6865 7322  er() == "inches"
+00004740: 3a0a 2020 2020 2020 2020 2020 2020 7363  :.            sc
+00004750: 616c 6546 6b74 203d 2032 352e 340a 2020  aleFkt = 25.4.  
+00004760: 2020 2020 2020 656c 6966 2066 6972 7374        elif first
+00004770: 4c65 7474 6572 5365 712e 6c6f 7765 7228  LetterSeq.lower(
+00004780: 2920 3d3d 2022 6d22 3a0a 2020 2020 2020  ) == "m":.      
+00004790: 2020 2020 2020 7363 616c 6546 6b74 203d        scaleFkt =
+000047a0: 2031 3030 302e 303b 0a20 2020 2020 2020   1000.0;.       
+000047b0: 2065 6c69 6620 6669 7273 744c 6574 7465   elif firstLette
+000047c0: 7253 6571 2e6c 6f77 6572 2829 203d 3d20  rSeq.lower() == 
+000047d0: 2263 6d22 3a0a 2020 2020 2020 2020 2020  "cm":.          
+000047e0: 2020 7363 616c 6546 6b74 203d 2031 302e    scaleFkt = 10.
+000047f0: 303b 0a20 2020 2020 2020 2065 6c69 6620  0;.        elif 
+00004800: 6669 7273 744c 6574 7465 7253 6571 2e6c  firstLetterSeq.l
+00004810: 6f77 6572 2829 203d 3d20 226d 6d22 3a0a  ower() == "mm":.
+00004820: 2020 2020 2020 2020 2020 2020 7363 616c              scal
+00004830: 6546 6b74 203d 2031 2e30 3b0a 2020 2020  eFkt = 1.0;.    
+00004840: 2020 2020 656c 6966 2066 6972 7374 4c65      elif firstLe
+00004850: 7474 6572 5365 712e 6c6f 7765 7228 2920  tterSeq.lower() 
+00004860: 3d3d 2022 756d 223a 0a20 2020 2020 2020  == "um":.       
+00004870: 2020 2020 2073 6361 6c65 466b 7420 3d20       scaleFkt = 
+00004880: 312f 3130 3030 3b0a 2020 2020 2020 2020  1/1000;.        
+00004890: 656c 6966 2066 6972 7374 4c65 7474 6572  elif firstLetter
+000048a0: 5365 712e 6c6f 7765 7228 2920 3d3d 2022  Seq.lower() == "
+000048b0: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
+000048c0: 6361 6c65 466b 7420 3d20 313b 0a20 2020  caleFkt = 1;.   
+000048d0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000048e0: 2020 2020 2020 2073 6361 6c65 466b 7420         scaleFkt 
+000048f0: 3d20 2d31 0a0a 2020 2020 2020 2020 7265  = -1..        re
+00004900: 7475 726e 2073 6361 6c65 466b 740a 0a0a  turn scaleFkt...
+00004910: 2020 2020 6465 6620 5f5f 6765 7449 7465      def __getIte
+00004920: 6d44 6566 6175 6c74 5661 6c75 6528 7365  mDefaultValue(se
+00004930: 6c66 2c69 7465 6d3a 7374 722c 6669 656c  lf,item:str,fiel
+00004940: 644e 616d 653a 7374 7229 3a0a 2020 2020  dName:str):.    
+00004950: 2020 2020 2222 2220 7265 7475 726e 7320      """ returns 
+00004960: 6974 656d 2076 616c 7565 7320 2866 6972  item values (fir
+00004970: 7374 2065 6e74 7279 2069 6e20 6361 7365  st entry in case
+00004980: 206f 6620 7669 6465 6f73 292e 2054 6872   of videos). Thr
+00004990: 6f77 7320 6d61 7269 7174 2e63 6f72 652e  ows mariqt.core.
+000049a0: 4966 646f 4578 6365 7074 696f 6e20 6966  IfdoException if
+000049b0: 2066 6965 6c64 206e 6f74 2066 6f75 6e64   field not found
+000049c0: 2e20 2222 220a 0a20 2020 2020 2020 2072  . """..        r
+000049d0: 6574 203d 2073 656c 665b 223a 222e 6a6f  et = self[":".jo
+000049e0: 696e 285b 6974 656d 2c27 3027 2c66 6965  in([item,'0',fie
+000049f0: 6c64 4e61 6d65 5d29 5d0a 2020 2020 2020  ldName])].      
+00004a00: 2020 6966 2072 6574 203d 3d20 2222 3a0a    if ret == "":.
+00004a10: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00004a20: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
+00004a30: 7469 6f6e 2822 4572 726f 723a 2046 6965  tion("Error: Fie
+00004a40: 6c64 207b 307d 206e 6569 7468 6572 2066  ld {0} neither f
+00004a50: 6f75 6e64 2069 6e20 6974 656d 207b 317d  ound in item {1}
+00004a60: 206e 6f72 2068 6561 6465 7222 2e66 6f72   nor header".for
+00004a70: 6d61 7428 6669 656c 644e 616d 652c 6974  mat(fieldName,it
+00004a80: 656d 2929 0a20 2020 2020 2020 2072 6574  em)).        ret
+00004a90: 7572 6e20 7265 740a 0a0a 2020 2020 6465  urn ret...    de
+00004aa0: 6620 5f5f 6765 7449 7465 6d4c 6174 4c6f  f __getItemLatLo
+00004ab0: 6e28 7365 6c66 2c69 7465 6d3a 7374 722c  n(self,item:str,
+00004ac0: 6865 6164 6572 5661 6c4c 6174 2c68 6561  headerValLat,hea
+00004ad0: 6465 7256 616c 4c6f 6e29 3a0a 2020 2020  derValLon):.    
+00004ae0: 2020 2020 2222 2220 7265 7475 726e 7320      """ returns 
+00004af0: 7b27 6c61 7427 3a20 7661 6c75 652c 2027  {'lat': value, '
+00004b00: 6c6f 6e27 3a20 7661 6c75 652c 2027 6461  lon': value, 'da
+00004b10: 7465 7469 6d65 273a 2076 616c 7565 7d20  tetime': value} 
+00004b20: 6f66 206c 6973 7420 6f66 2074 686f 7365  of list of those
+00004b30: 2022 2222 0a0a 2020 2020 2020 2020 6974   """..        it
+00004b40: 656d 5661 6c20 3d20 7365 6c66 2e69 6664  emVal = self.ifd
+00004b50: 6f5b 6d69 7174 762e 696d 6167 655f 7365  o[miqtv.image_se
+00004b60: 745f 6974 656d 735f 6b65 795d 5b69 7465  t_items_key][ite
+00004b70: 6d5d 0a20 2020 2020 2020 2069 6620 6e6f  m].        if no
+00004b80: 7420 6973 696e 7374 616e 6365 2869 7465  t isinstance(ite
+00004b90: 6d56 616c 2c6c 6973 7429 3a0a 2020 2020  mVal,list):.    
+00004ba0: 2020 2020 2020 2020 7265 7420 3d20 7365          ret = se
+00004bb0: 6c66 2e5f 5f70 6172 7365 324c 6174 4c6f  lf.__parse2LatLo
+00004bc0: 6e44 6963 7428 6974 656d 5661 6c2c 6865  nDict(itemVal,he
+00004bd0: 6164 6572 5661 6c4c 6174 2c68 6561 6465  aderValLat,heade
+00004be0: 7256 616c 4c6f 6e29 0a20 2020 2020 2020  rValLon).       
+00004bf0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00004c00: 2020 2072 6574 203d 205b 5d0a 2020 2020     ret = [].    
+00004c10: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00004c20: 2020 2020 2020 2020 2020 2020 2069 7465               ite
+00004c30: 6d4c 6174 4465 6661 756c 7420 3d20 6974  mLatDefault = it
+00004c40: 656d 5661 6c5b 305d 5b27 696d 6167 652d  emVal[0]['image-
+00004c50: 6c61 7469 7475 6465 275d 0a20 2020 2020  latitude'].     
+00004c60: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
+00004c70: 7945 7272 6f72 3a0a 2020 2020 2020 2020  yError:.        
+00004c80: 2020 2020 2020 2020 6974 656d 4c61 7444          itemLatD
+00004c90: 6566 6175 6c74 203d 2068 6561 6465 7256  efault = headerV
+00004ca0: 616c 4c61 740a 2020 2020 2020 2020 2020  alLat.          
+00004cb0: 2020 2020 2020 2369 6620 6974 656d 4c61        #if itemLa
+00004cc0: 7444 6566 6175 6c74 2069 7320 4e6f 6e65  tDefault is None
+00004cd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004ce0: 2020 2320 2020 2072 6169 7365 2045 7863    #    raise Exc
+00004cf0: 6570 7469 6f6e 2822 4572 726f 723a 2046  eption("Error: F
+00004d00: 6965 6c64 207b 307d 206e 6569 7468 6572  ield {0} neither
+00004d10: 2066 6f75 6e64 2069 6e20 6974 656d 207b   found in item {
+00004d20: 317d 206e 6f72 2068 6561 6465 7222 2e66  1} nor header".f
+00004d30: 6f72 6d61 7428 2769 6d61 6765 2d6c 6174  ormat('image-lat
+00004d40: 6974 7564 6527 2c69 7465 6d29 290a 0a20  itude',item)).. 
+00004d50: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00004d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d70: 6974 656d 4c6f 6e44 6566 6175 6c74 203d  itemLonDefault =
+00004d80: 2069 7465 6d56 616c 5b30 5d5b 2769 6d61   itemVal[0]['ima
+00004d90: 6765 2d6c 6f6e 6769 7475 6465 275d 0a20  ge-longitude']. 
+00004da0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00004db0: 7420 4b65 7945 7272 6f72 3a0a 2020 2020  t KeyError:.    
+00004dc0: 2020 2020 2020 2020 2020 2020 6974 656d              item
+00004dd0: 4c6f 6e44 6566 6175 6c74 203d 2068 6561  LonDefault = hea
+00004de0: 6465 7256 616c 4c6f 6e0a 2020 2020 2020  derValLon.      
+00004df0: 2020 2020 2020 2020 2020 2369 6620 6974            #if it
+00004e00: 656d 4c6f 6e44 6566 6175 6c74 2069 7320  emLonDefault is 
+00004e10: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00004e20: 2020 2020 2020 2320 2020 2072 6169 7365        #    raise
+00004e30: 2045 7863 6570 7469 6f6e 2822 4572 726f   Exception("Erro
+00004e40: 723a 2046 6965 6c64 207b 307d 206e 6569  r: Field {0} nei
+00004e50: 7468 6572 2066 6f75 6e64 2069 6e20 6974  ther found in it
+00004e60: 656d 207b 317d 206e 6f72 2068 6561 6465  em {1} nor heade
+00004e70: 7222 2e66 6f72 6d61 7428 2769 6d61 6765  r".format('image
+00004e80: 2d6c 6174 6974 7564 6527 2c69 7465 6d29  -latitude',item)
+00004e90: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
+00004ea0: 6f72 2073 7562 456e 7472 7920 696e 2069  or subEntry in i
+00004eb0: 7465 6d56 616c 3a0a 2020 2020 2020 2020  temVal:.        
+00004ec0: 2020 2020 2020 2020 7265 742e 6170 7065          ret.appe
+00004ed0: 6e64 2873 656c 662e 5f5f 7061 7273 6532  nd(self.__parse2
+00004ee0: 4c61 744c 6f6e 4469 6374 2873 7562 456e  LatLonDict(subEn
+00004ef0: 7472 792c 6974 656d 4c61 7444 6566 6175  try,itemLatDefau
+00004f00: 6c74 2c69 7465 6d4c 6f6e 4465 6661 756c  lt,itemLonDefaul
+00004f10: 7429 290a 0a20 2020 2020 2020 2072 6574  t))..        ret
+00004f20: 7572 6e20 7265 740a 2020 2020 2020 2020  urn ret.        
+00004f30: 2020 2020 0a0a 2020 2020 6465 6620 5f5f      ..    def __
+00004f40: 7061 7273 6532 4c61 744c 6f6e 4469 6374  parse2LatLonDict
+00004f50: 2873 656c 662c 6974 656d 5661 6c2c 6865  (self,itemVal,he
+00004f60: 6164 6572 5661 6c4c 6174 2c68 6561 6465  aderValLat,heade
+00004f70: 7256 616c 4c6f 6e29 3a0a 2020 2020 2020  rValLon):.      
+00004f80: 2020 2222 2220 7265 7475 726e 7320 7b27    """ returns {'
+00004f90: 6c61 7427 3a6c 6174 2c27 6c6f 6e27 3a6c  lat':lat,'lon':l
+00004fa0: 6f6e 2c27 6461 7465 7469 6d65 273a 6461  on,'datetime':da
+00004fb0: 7465 7469 6d65 7d20 2222 220a 2020 2020  tetime} """.    
+00004fc0: 2020 2020 6461 7465 7469 6d65 203d 2069      datetime = i
+00004fd0: 7465 6d56 616c 5b27 696d 6167 652d 6461  temVal['image-da
+00004fe0: 7465 7469 6d65 275d 0a20 2020 2020 2020  tetime'].       
+00004ff0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00005000: 2020 6c61 7420 3d20 6974 656d 5661 6c5b    lat = itemVal[
+00005010: 2769 6d61 6765 2d6c 6174 6974 7564 6527  'image-latitude'
+00005020: 5d0a 2020 2020 2020 2020 6578 6365 7074  ].        except
+00005030: 204b 6579 4572 726f 723a 0a20 2020 2020   KeyError:.     
+00005040: 2020 2020 2020 206c 6174 203d 2068 6561         lat = hea
+00005050: 6465 7256 616c 4c61 740a 2020 2020 2020  derValLat.      
+00005060: 2020 2020 2020 6966 206c 6174 2069 7320        if lat is 
+00005070: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00005080: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+00005090: 7074 696f 6e28 2245 7272 6f72 3a20 4669  ption("Error: Fi
+000050a0: 656c 6420 7b30 7d20 6e65 6974 6865 7220  eld {0} neither 
+000050b0: 666f 756e 6420 696e 2069 7465 6d20 7b31  found in item {1
+000050c0: 7d20 6e6f 7220 6865 6164 6572 222e 666f  } nor header".fo
+000050d0: 726d 6174 2827 696d 6167 652d 6c61 7469  rmat('image-lati
+000050e0: 7475 6465 272c 6974 656d 5661 6c29 290a  tude',itemVal)).
+000050f0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00005100: 2020 2020 2020 2020 206c 6f6e 203d 2069           lon = i
+00005110: 7465 6d56 616c 5b27 696d 6167 652d 6c6f  temVal['image-lo
+00005120: 6e67 6974 7564 6527 5d0a 2020 2020 2020  ngitude'].      
+00005130: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
+00005140: 723a 0a20 2020 2020 2020 2020 2020 206c  r:.            l
+00005150: 6f6e 203d 2068 6561 6465 7256 616c 4c6f  on = headerValLo
+00005160: 6e0a 2020 2020 2020 2020 2020 2020 6966  n.            if
+00005170: 206c 6f6e 2069 7320 4e6f 6e65 3a0a 2020   lon is None:.  
+00005180: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00005190: 6973 6520 4578 6365 7074 696f 6e28 2245  ise Exception("E
+000051a0: 7272 6f72 3a20 4669 656c 6420 7b30 7d20  rror: Field {0} 
+000051b0: 6e65 6974 6865 7220 666f 756e 6420 696e  neither found in
+000051c0: 2069 7465 6d20 7b31 7d20 6e6f 7220 6865   item {1} nor he
+000051d0: 6164 6572 222e 666f 726d 6174 2827 696d  ader".format('im
+000051e0: 6167 652d 6c6f 6e67 6974 7564 6527 2c69  age-longitude',i
+000051f0: 7465 6d56 616c 2929 0a20 2020 2020 2020  temVal)).       
+00005200: 2072 6574 7572 6e20 7b27 6c61 7427 3a6c   return {'lat':l
+00005210: 6174 2c27 6c6f 6e27 3a6c 6f6e 2c27 6461  at,'lon':lon,'da
+00005220: 7465 7469 6d65 273a 6461 7465 7469 6d65  tetime':datetime
+00005230: 7d0a 0a0a 6465 6620 6946 444f 4672 6f6d  }...def iFDOFrom
+00005240: 4669 6c65 2869 4644 4f66 696c 653a 7374  File(iFDOfile:st
+00005250: 722c 6861 6e64 6c65 5f70 7265 6669 783d  r,handle_prefix=
+00005260: 2732 302e 3530 302e 3132 3038 3527 2c70  '20.500.12085',p
+00005270: 726f 7665 6e61 6e63 6520 3d20 4e6f 6e65  rovenance = None
+00005280: 2c76 6572 626f 7365 3d54 7275 652c 6967  ,verbose=True,ig
+00005290: 6e6f 7265 5f69 6d61 6765 5f66 696c 6573  nore_image_files
+000052a0: 3d46 616c 7365 2c77 7269 7465 546d 7050  =False,writeTmpP
+000052b0: 726f 7646 696c 653d 5472 7565 2c69 6d61  rovFile=True,ima
+000052c0: 6765 5f62 726f 6b65 725f 7575 6964 3d22  ge_broker_uuid="
+000052d0: 6565 3237 3735 3738 2d61 3931 312d 3438  ee277578-a911-48
+000052e0: 3464 2d61 3531 352d 3963 3738 3164 3739  4d-a515-9c781d79
+000052f0: 6161 3931 2229 3a0a 2020 2020 2222 2220  aa91"):.    """ 
+00005300: 436f 6e76 656e 6965 6e63 6520 6675 6e63  Convenience func
+00005310: 7469 6f6e 2074 6f20 6372 6561 7465 2061  tion to create a
+00005320: 6e20 6946 444f 206f 626a 6563 7420 6469  n iFDO object di
+00005330: 7265 6374 6c79 2066 6f72 6d20 616e 2065  rectly form an e
+00005340: 7869 7374 696e 6720 6946 444f 2066 696c  xisting iFDO fil
+00005350: 652e 2054 7269 6573 2074 6f20 696e 6665  e. Tries to infe
+00005360: 7220 696d 6167 6520 6669 6c65 7320 6c6f  r image files lo
+00005370: 6361 7469 6f6e 2066 726f 6d20 2769 6d61  cation from 'ima
+00005380: 6765 2d73 6574 2d6c 6f63 616c 2d70 6174  ge-set-local-pat
+00005390: 6827 2e20 5265 7475 726e 7320 6946 444f  h'. Returns iFDO
+000053a0: 206f 626a 6563 742e 200a 2020 2020 2020   object. .      
+000053b0: 2020 2d20 6946 444f 6669 6c65 3a20 7374    - iFDOfile: st
+000053c0: 7269 6e67 2070 6174 6820 746f 206c 6f61  ring path to loa
+000053d0: 6420 616e 2065 7870 6c69 6369 7420 6946  d an explicit iF
+000053e0: 444f 2066 696c 652e 0a20 2020 2020 2020  DO file..       
+000053f0: 202d 2068 616e 646c 655f 7072 6566 6978   - handle_prefix
+00005400: 3a20 7374 7269 6e67 2070 7265 6669 7820  : string prefix 
+00005410: 6f66 2074 6865 2068 616e 646c 6520 7365  of the handle se
+00005420: 7276 6572 2e20 4465 6661 756c 743a 2074  rver. Default: t
+00005430: 6865 206f 6e65 2066 6f72 2047 656f 6d61  he one for Geoma
+00005440: 722e 0a20 2020 2020 2020 202d 2070 726f  r..        - pro
+00005450: 7665 6e61 6e63 653a 206d 6172 6971 742e  venance: mariqt.
+00005460: 7072 6f76 656e 6361 6e63 652e 5072 6f76  provencance.Prov
+00005470: 656e 616e 6365 206f 626a 6563 7420 746f  enance object to
+00005480: 2074 7261 636b 2064 6174 6120 7072 6f76   track data prov
+00005490: 656e 616e 6365 2e20 4465 6661 756c 743a  enance. Default:
+000054a0: 2061 206e 6577 2070 726f 7665 6e61 6e63   a new provenanc
+000054b0: 6520 6f62 6a65 6374 2069 7320 6372 6561  e object is crea
+000054c0: 7465 6420 696e 2074 6865 2027 7072 6f74  ted in the 'prot
+000054d0: 6f63 6f6c 2720 7375 6266 6f6c 6465 722e  ocol' subfolder.
+000054e0: 0a20 2020 2020 2020 202d 2076 6572 626f  .        - verbo
+000054f0: 7365 3a20 626f 6f6c 2077 6865 7468 6572  se: bool whether
+00005500: 2074 6f20 7072 696e 7420 6f75 7420 696e   to print out in
+00005510: 666f 726d 6174 696f 6e2e 2050 726f 6365  formation. Proce
+00005520: 7373 696e 6720 6973 2066 6173 7465 7220  ssing is faster 
+00005530: 6966 2076 6572 626f 7365 2069 7320 4661  if verbose is Fa
+00005540: 6c73 652e 2044 6566 6175 6c74 3a20 5472  lse. Default: Tr
+00005550: 7565 2e0a 2020 2020 2020 2020 2d20 6967  ue..        - ig
+00005560: 6e6f 7265 5f69 6d61 6765 5f66 696c 6573  nore_image_files
+00005570: 3a20 626f 6f6c 2077 6865 7468 6572 2069  : bool whether i
+00005580: 7427 7320 6163 6365 7074 6564 2074 6861  t's accepted tha
+00005590: 7420 7468 6572 6520 6172 6520 6e6f 7420  t there are not 
+000055a0: 696d 6167 6573 2079 6574 2069 6e20 2764  images yet in 'd
+000055b0: 6972 272e 2044 6566 6175 6c74 3a20 4661  ir'. Default: Fa
+000055c0: 6c73 652e 0a20 2020 2020 2020 202d 2077  lse..        - w
+000055d0: 7269 7465 546d 7050 726f 7646 696c 653a  riteTmpProvFile:
+000055e0: 2062 6f6f 6c20 7768 6574 6865 7220 746f   bool whether to
+000055f0: 2077 7269 7465 2061 2074 656d 706f 7261   write a tempora
+00005600: 7279 2070 726f 7665 6e61 6e63 6520 6669  ry provenance fi
+00005610: 6c65 2064 7572 696e 6720 7468 6520 6946  le during the iF
+00005620: 444f 2063 7265 6174 696f 6e20 7072 6f63  DO creation proc
+00005630: 6573 7320 7768 6963 6820 7769 6c6c 2062  ess which will b
+00005640: 6520 7265 706c 6163 6564 2062 7920 6120  e replaced by a 
+00005650: 6669 6e61 6c20 6f6e 6520 696e 2074 6865  final one in the
+00005660: 2065 6e64 2e20 4465 6661 756c 743a 2054   end. Default: T
+00005670: 7275 650a 2020 2020 2020 2020 2d20 696d  rue.        - im
+00005680: 6167 655f 6272 6f6b 6572 5f75 7569 643a  age_broker_uuid:
+00005690: 2075 7569 6420 6f66 2069 6d61 6765 2062   uuid of image b
+000056a0: 726f 6b65 7220 746f 2063 7265 6174 6520  roker to create 
+000056b0: 696d 6167 6520 6861 6e64 6c65 7320 6173  image handles as
+000056c0: 2068 7474 7073 3a2f 2f68 646c 2e68 616e   https://hdl.han
+000056d0: 646c 652e 6e65 742f 3c68 616e 646c 655f  dle.net/<handle_
+000056e0: 7072 6566 6978 3e2f 3c69 6d61 6765 5f62  prefix>/<image_b
+000056f0: 726f 6b65 725f 7575 6964 3e40 3c69 6d61  roker_uuid>@<ima
+00005700: 6765 2d75 7569 643e 2022 2222 0a20 2020  ge-uuid> """.   
+00005710: 200a 2020 2020 7265 6164 6572 203d 2069   .    reader = i
+00005720: 4644 4f5f 5265 6164 6572 2869 4644 4f66  FDO_Reader(iFDOf
+00005730: 696c 6529 0a20 2020 2069 6d61 6765 7344  ile).    imagesD
+00005740: 6972 203d 206d 6971 7463 2e74 6f55 6e69  ir = miqtc.toUni
+00005750: 7850 6174 6828 6f73 2e70 6174 682e 6e6f  xPath(os.path.no
+00005760: 726d 7061 7468 286d 6971 7463 2e74 6f55  rmpath(miqtc.toU
+00005770: 6e69 7850 6174 6828 7265 6164 6572 2e67  nixPath(reader.g
+00005780: 6574 496d 6167 6544 6972 6563 746f 7279  etImageDirectory
+00005790: 2829 2929 290a 2020 2020 6261 7365 4469  ()))).    baseDi
+000057a0: 7220 3d20 6d69 7174 632e 746f 556e 6978  r = miqtc.toUnix
+000057b0: 5061 7468 286f 732e 7061 7468 2e63 6f6d  Path(os.path.com
+000057c0: 6d6f 6e70 6174 6828 5b69 4644 4f66 696c  monpath([iFDOfil
+000057d0: 652c 696d 6167 6573 4469 725d 2929 0a20  e,imagesDir])). 
+000057e0: 2020 2069 6d61 6765 4461 7461 5479 7065     imageDataType
+000057f0: 466f 6c64 6572 203d 205b 6520 666f 7220  Folder = [e for 
+00005800: 6520 696e 2069 6d61 6765 7344 6972 2e72  e in imagesDir.r
+00005810: 6570 6c61 6365 2862 6173 6544 6972 2c22  eplace(baseDir,"
+00005820: 2229 2e73 706c 6974 2822 2f22 2920 6966  ").split("/") if
+00005830: 2065 2021 3d20 2222 5d5b 305d 0a20 2020   e != ""][0].   
+00005840: 2069 6620 696d 6167 6544 6174 6154 7970   if imageDataTyp
+00005850: 6546 6f6c 6465 7220 6e6f 7420 696e 206d  eFolder not in m
+00005860: 6971 7464 2e44 6972 2e64 742e 5f5f 6d65  iqtd.Dir.dt.__me
+00005870: 6d62 6572 735f 5f3a 0a20 2020 2020 2020  mbers__:.       
+00005880: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
+00005890: 6f45 7863 6570 7469 6f6e 2822 496d 6167  oException("Imag
+000058a0: 6573 2061 7265 206e 6f74 206c 6f63 6174  es are not locat
+000058b0: 6564 2069 6e20 6120 7661 6c69 6420 6461  ed in a valid da
+000058c0: 7461 2074 7970 6520 6469 7265 6374 6f72  ta type director
+000058d0: 7920 2872 6177 2c20 696e 7465 726d 6564  y (raw, intermed
+000058e0: 6961 7465 2c20 7072 6f63 6573 7365 642c  iate, processed,
+000058f0: 202e 2e2e 2920 696e 2074 6865 2073 616d   ...) in the sam
+00005900: 6520 7072 6f6a 6563 7420 6173 2069 4644  e project as iFD
+00005910: 4f20 6669 6c65 2e22 290a 2020 2020 696d  O file.").    im
+00005920: 6167 6573 4461 7461 5479 7065 4469 7220  agesDataTypeDir 
+00005930: 3d20 6f73 2e70 6174 682e 6a6f 696e 2862  = os.path.join(b
+00005940: 6173 6544 6972 2c69 6d61 6765 4461 7461  aseDir,imageData
+00005950: 5479 7065 466f 6c64 6572 290a 2020 2020  TypeFolder).    
+00005960: 6469 724f 626a 203d 206d 6971 7464 2e44  dirObj = miqtd.D
+00005970: 6972 2822 222c 696d 6167 6573 4461 7461  ir("",imagesData
+00005980: 5479 7065 4469 722c 2063 7265 6174 653d  TypeDir, create=
+00005990: 4661 6c73 652c 2077 6974 685f 6765 6172  False, with_gear
+000059a0: 3d46 616c 7365 290a 2020 2020 7265 7475  =False).    retu
+000059b0: 726e 2069 4644 4f28 6469 723d 6469 724f  rn iFDO(dir=dirO
+000059c0: 626a 2c68 616e 646c 655f 7072 6566 6978  bj,handle_prefix
+000059d0: 3d68 616e 646c 655f 7072 6566 6978 2c70  =handle_prefix,p
+000059e0: 726f 7665 6e61 6e63 653d 7072 6f76 656e  rovenance=proven
+000059f0: 616e 6365 2c76 6572 626f 7365 3d76 6572  ance,verbose=ver
+00005a00: 626f 7365 2c69 676e 6f72 655f 696d 6167  bose,ignore_imag
+00005a10: 655f 6669 6c65 733d 6967 6e6f 7265 5f69  e_files=ignore_i
+00005a20: 6d61 6765 5f66 696c 6573 2c77 7269 7465  mage_files,write
+00005a30: 546d 7050 726f 7646 696c 653d 7772 6974  TmpProvFile=writ
+00005a40: 6554 6d70 5072 6f76 4669 6c65 2c69 4644  eTmpProvFile,iFD
+00005a50: 4f66 696c 653d 6946 444f 6669 6c65 2c69  Ofile=iFDOfile,i
+00005a60: 6d61 6765 5f62 726f 6b65 725f 7575 6964  mage_broker_uuid
+00005a70: 3d69 6d61 6765 5f62 726f 6b65 725f 7575  =image_broker_uu
+00005a80: 6964 290a 0a0a 636c 6173 7320 6946 444f  id)...class iFDO
+00005a90: 3a0a 2020 2020 2220 436c 6173 7320 666f  :.    " Class fo
+00005aa0: 7220 6372 6561 7469 6e67 2061 6e64 2065  r creating and e
+00005ab0: 6469 7469 6e67 2069 4644 4f2e 7961 6d6c  diting iFDO.yaml
+00005ac0: 2066 696c 6573 2022 0a0a 2020 2020 6465   files "..    de
+00005ad0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00005ae0: 2064 6972 3a6d 6971 7464 2e44 6972 2c20   dir:miqtd.Dir, 
+00005af0: 6861 6e64 6c65 5f70 7265 6669 783d 2732  handle_prefix='2
+00005b00: 302e 3530 302e 3132 3038 3527 2c70 726f  0.500.12085',pro
+00005b10: 7665 6e61 6e63 6520 3d20 4e6f 6e65 2c76  venance = None,v
+00005b20: 6572 626f 7365 3d54 7275 652c 6967 6e6f  erbose=True,igno
+00005b30: 7265 5f69 6d61 6765 5f66 696c 6573 3d46  re_image_files=F
+00005b40: 616c 7365 2c77 7269 7465 546d 7050 726f  alse,writeTmpPro
+00005b50: 7646 696c 653d 5472 7565 2c69 4644 4f66  vFile=True,iFDOf
+00005b60: 696c 653d 4e6f 6e65 2c69 6d61 6765 5f62  ile=None,image_b
+00005b70: 726f 6b65 725f 7575 6964 3d22 6565 3237  roker_uuid="ee27
+00005b80: 3735 3738 2d61 3931 312d 3438 3464 2d61  7578-a911-484d-a
+00005b90: 3531 352d 3963 3738 3164 3739 6161 3931  515-9c781d79aa91
+00005ba0: 2229 3a0a 2020 2020 2020 2020 2222 2220  "):.        """ 
+00005bb0: 4372 6561 7465 7320 616e 2069 464f 4420  Creates an iFOD 
+00005bc0: 6f62 6a65 6374 2e20 5265 7175 6972 6573  object. Requires
+00005bd0: 2061 2076 616c 6964 2064 6972 6563 746f   a valid directo
+00005be0: 7279 2063 6f6e 7461 696e 696e 6720 696d  ry containing im
+00005bf0: 6167 6520 6461 7461 206f 722f 616e 6420  age data or/and 
+00005c00: 616e 6420 6946 444f 2066 696c 6520 616e  and iFDO file an
+00005c10: 6420 6120 6861 6e64 6c65 2070 7265 6669  d a handle prefi
+00005c20: 7820 6966 2069 7427 7320 6e6f 7420 7468  x if it's not th
+00005c30: 6520 4765 6f6d 6172 206f 6e65 2e20 4c6f  e Geomar one. Lo
+00005c40: 6164 7320 6469 7265 6374 6f72 7927 7320  ads directory's 
+00005c50: 6946 444f 2066 696c 6520 6966 2069 7420  iFDO file if it 
+00005c60: 6578 6973 7473 2061 6c72 6561 6479 2e0a  exists already..
+00005c70: 2020 2020 2020 2020 2020 2020 2d20 6469              - di
+00005c80: 723a 206d 6172 6971 742e 6469 7265 6374  r: mariqt.direct
+00005c90: 6f72 6965 732e 4469 7220 6f62 6a65 6374  ories.Dir object
+00005ca0: 2070 6f69 6e74 696e 6720 746f 2061 2076   pointing to a v
+00005cb0: 616c 6964 2064 6174 6120 7479 7065 2064  alid data type d
+00005cc0: 6972 6563 746f 7279 2028 7261 772c 2069  irectory (raw, i
+00005cd0: 6e74 6572 6d65 6469 6174 652c 2070 726f  ntermediate, pro
+00005ce0: 6365 7373 6564 2c20 2e2e 2e29 2063 6f6e  cessed, ...) con
+00005cf0: 7461 696e 696e 6720 7468 6520 696d 6167  taining the imag
+00005d00: 6520 6461 7461 2e0a 2020 2020 2020 2020  e data..        
+00005d10: 2020 2020 2d20 6861 6e64 6c65 5f70 7265      - handle_pre
+00005d20: 6669 783a 2073 7472 696e 6720 7072 6566  fix: string pref
+00005d30: 6978 206f 6620 7468 6520 6861 6e64 6c65  ix of the handle
+00005d40: 2073 6572 7665 722e 2044 6566 6175 6c74   server. Default
+00005d50: 3a20 7468 6520 6f6e 6520 666f 7220 4765  : the one for Ge
+00005d60: 6f6d 6172 2e0a 2020 2020 2020 2020 2020  omar..          
+00005d70: 2020 2d20 7072 6f76 656e 616e 6365 3a20    - provenance: 
+00005d80: 6d61 7269 7174 2e70 726f 7665 6e63 616e  mariqt.provencan
+00005d90: 6365 2e50 726f 7665 6e61 6e63 6520 6f62  ce.Provenance ob
+00005da0: 6a65 6374 2074 6f20 7472 6163 6b20 6461  ject to track da
+00005db0: 7461 2070 726f 7665 6e61 6e63 652e 2044  ta provenance. D
+00005dc0: 6566 6175 6c74 3a20 6120 6e65 7720 7072  efault: a new pr
+00005dd0: 6f76 656e 616e 6365 206f 626a 6563 7420  ovenance object 
+00005de0: 6973 2063 7265 6174 6564 2069 6e20 7468  is created in th
+00005df0: 6520 2770 726f 746f 636f 6c27 2073 7562  e 'protocol' sub
+00005e00: 666f 6c64 6572 2e0a 2020 2020 2020 2020  folder..        
+00005e10: 2020 2020 2d20 7665 7262 6f73 653a 2062      - verbose: b
+00005e20: 6f6f 6c20 7768 6574 6865 7220 746f 2070  ool whether to p
+00005e30: 7269 6e74 206f 7574 2069 6e66 6f72 6d61  rint out informa
+00005e40: 7469 6f6e 2e20 4465 6661 756c 743a 2054  tion. Default: T
+00005e50: 7275 652e 0a20 2020 2020 2020 2020 2020  rue..           
+00005e60: 202d 2069 676e 6f72 655f 696d 6167 655f   - ignore_image_
+00005e70: 6669 6c65 733a 2069 6d61 6765 7320 6669  files: images fi
+00005e80: 6c65 7320 6172 6520 6967 6e6f 7265 642e  les are ignored.
+00005e90: 2054 6865 7920 6172 6520 6e6f 7420 7365   They are not se
+00005ea0: 6172 6368 6564 2066 6f72 2069 6e20 2772  arched for in 'r
+00005eb0: 6177 2720 616e 6420 6974 656d 7320 7661  aw' and items va
+00005ec0: 6c75 6573 2061 7265 206e 6f74 2075 7064  lues are not upd
+00005ed0: 6174 6564 206e 6f72 2063 6865 636b 6564  ated nor checked
+00005ee0: 2e20 4465 6661 756c 7420 3d20 4661 6c73  . Default = Fals
+00005ef0: 650a 2020 2020 2020 2020 2020 2020 2d20  e.            - 
+00005f00: 7772 6974 6554 6d70 5072 6f76 4669 6c65  writeTmpProvFile
+00005f10: 3a20 626f 6f6c 2077 6865 7468 6572 2074  : bool whether t
+00005f20: 6f20 7772 6974 6520 6120 7465 6d70 6f72  o write a tempor
+00005f30: 6172 7920 7072 6f76 656e 616e 6365 2066  ary provenance f
+00005f40: 696c 6520 6475 7269 6e67 2074 6865 2069  ile during the i
+00005f50: 4644 4f20 6372 6561 7469 6f6e 2070 726f  FDO creation pro
+00005f60: 6365 7373 2077 6869 6368 2077 696c 6c20  cess which will 
+00005f70: 6265 2072 6570 6c61 6365 6420 6279 2061  be replaced by a
+00005f80: 2066 696e 616c 206f 6e65 2069 6e20 7468   final one in th
+00005f90: 6520 656e 642e 2044 6566 6175 6c74 3a20  e end. Default: 
+00005fa0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00005fb0: 202d 2069 4644 4f66 696c 653a 2073 7472   - iFDOfile: str
+00005fc0: 696e 6720 7061 7468 2074 6f20 6c6f 6164  ing path to load
+00005fd0: 2061 6e20 6578 706c 6963 6974 2069 4644   an explicit iFD
+00005fe0: 4f20 6669 6c65 2e20 4966 206e 6f74 2070  O file. If not p
+00005ff0: 726f 7669 6465 6420 6120 6d61 7463 6869  rovided a matchi
+00006000: 6e67 2069 4644 4f20 6669 6c65 2028 6966  ng iFDO file (if
+00006010: 2069 7420 616c 7265 6164 7920 6578 6973   it already exis
+00006020: 7473 2920 7769 6c6c 2062 6520 6c6f 6164  ts) will be load
+00006030: 6564 2066 726f 6d20 7468 6520 2770 726f  ed from the 'pro
+00006040: 6475 6374 7327 2073 7562 6469 7265 6374  ducts' subdirect
+00006050: 6f72 792e 2044 6566 6175 6c74 3a20 4e6f  ory. Default: No
+00006060: 6e65 200a 2020 2020 2020 2020 2020 2020  ne .            
+00006070: 2d20 696d 6167 655f 6272 6f6b 6572 5f75  - image_broker_u
+00006080: 7569 643a 2075 7569 6420 6f66 2069 6d61  uid: uuid of ima
+00006090: 6765 2062 726f 6b65 7220 746f 2063 7265  ge broker to cre
+000060a0: 6174 6520 696d 6167 6520 6861 6e64 6c65  ate image handle
+000060b0: 7320 6173 2068 7474 7073 3a2f 2f68 646c  s as https://hdl
+000060c0: 2e68 616e 646c 652e 6e65 742f 3c68 616e  .handle.net/<han
+000060d0: 646c 655f 7072 6566 6978 3e2f 3c69 6d61  dle_prefix>/<ima
+000060e0: 6765 5f62 726f 6b65 725f 7575 6964 3e40  ge_broker_uuid>@
+000060f0: 3c69 6d61 6765 2d75 7569 643e 2022 2222  <image-uuid> """
+00006100: 0a0a 2020 2020 2020 2020 2320 6368 6563  ..        # chec
+00006110: 6b20 7468 6174 2061 7420 6469 7220 6f72  k that at dir or
+00006120: 2069 4644 4f66 696c 6520 7072 6f76 6964   iFDOfile provid
+00006130: 6564 0a20 2020 2020 2020 2069 6620 6469  ed.        if di
+00006140: 7220 6973 204e 6f6e 6520 616e 6420 6946  r is None and iF
+00006150: 444f 6669 6c65 2069 7320 4e6f 6e65 3a0a  DOfile is None:.
+00006160: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00006170: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
+00006180: 7074 696f 6e28 224e 6569 7468 6572 2064  ption("Neither d
+00006190: 6972 206e 6f72 2069 4644 4f66 696c 6520  ir nor iFDOfile 
+000061a0: 7072 6f76 6964 6564 2066 6f72 2069 4644  provided for iFD
+000061b0: 4f2e 2229 0a0a 2020 2020 2020 2020 7365  O.")..        se
+000061c0: 6c66 2e64 6972 203d 2064 6972 0a20 2020  lf.dir = dir.   
+000061d0: 2020 2020 2073 656c 662e 696d 6167 6573       self.images
+000061e0: 4469 7220 3d20 6469 722e 746f 7479 7065  Dir = dir.totype
+000061f0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+00006200: 6469 722e 6372 6561 7465 5479 7065 466f  dir.createTypeFo
+00006210: 6c64 6572 2829 0a20 2020 2020 2020 2073  lder().        s
+00006220: 656c 662e 6861 6e64 6c65 5f70 7265 6669  elf.handle_prefi
+00006230: 7820 3d20 2268 7474 7073 3a2f 2f68 646c  x = "https://hdl
+00006240: 2e68 616e 646c 652e 6e65 742f 2220 2b20  .handle.net/" + 
+00006250: 6861 6e64 6c65 5f70 7265 6669 780a 2020  handle_prefix.  
+00006260: 2020 2020 2020 7365 6c66 2e69 6d61 6765        self.image
+00006270: 5f68 616e 646c 655f 7072 6566 6978 203d  _handle_prefix =
+00006280: 2073 656c 662e 6861 6e64 6c65 5f70 7265   self.handle_pre
+00006290: 6669 7820 2b20 222f 2220 2b20 696d 6167  fix + "/" + imag
+000062a0: 655f 6272 6f6b 6572 5f75 7569 640a 2020  e_broker_uuid.  
+000062b0: 2020 2020 2020 7365 6c66 2e69 676e 6f72        self.ignor
+000062c0: 655f 696d 6167 655f 6669 6c65 7320 3d20  e_image_files = 
+000062d0: 6967 6e6f 7265 5f69 6d61 6765 5f66 696c  ignore_image_fil
+000062e0: 6573 0a0a 2020 2020 2020 2020 7365 6c66  es..        self
+000062f0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+00006300: 6579 203d 206d 6971 7476 2e69 6d61 6765  ey = miqtv.image
+00006310: 5f73 6574 5f68 6561 6465 725f 6b65 790a  _set_header_key.
+00006320: 2020 2020 2020 2020 7365 6c66 2e69 6d61          self.ima
+00006330: 6765 5365 7449 7465 6d73 4b65 7920 3d20  geSetItemsKey = 
+00006340: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
+00006350: 6974 656d 735f 6b65 790a 2020 2020 2020  items_key.      
+00006360: 2020 7365 6c66 2e69 6664 6f5f 746d 7020    self.ifdo_tmp 
+00006370: 3d20 7b73 656c 662e 696d 6167 6553 6574  = {self.imageSet
+00006380: 4865 6164 6572 4b65 793a 207b 7d2c 0a20  HeaderKey: {},. 
+00006390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063a0: 2020 2020 2020 2020 7365 6c66 2e69 6d61          self.ima
+000063b0: 6765 5365 7449 7465 6d73 4b65 793a 207b  geSetItemsKey: {
+000063c0: 7d7d 0a20 2020 2020 2020 2073 656c 662e  }}.        self.
+000063d0: 6966 646f 5f70 6172 7365 6420 3d20 4e6f  ifdo_parsed = No
+000063e0: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
+000063f0: 6966 646f 5f63 6865 636b 6564 203d 2063  ifdo_checked = c
+00006400: 6f70 792e 6465 6570 636f 7079 2873 656c  opy.deepcopy(sel
+00006410: 662e 6966 646f 5f74 6d70 2920 2023 2074  f.ifdo_tmp)  # t
+00006420: 6f20 6265 2073 6574 2062 7920 6372 6561  o be set by crea
+00006430: 7465 6946 444f 2829 206f 6e6c 7921 0a20  teiFDO() only!. 
+00006440: 2020 2020 2020 2073 656c 662e 5f5f 616c         self.__al
+00006450: 6c55 5549 4473 4368 6563 6b65 6420 3d20  lUUIDsChecked = 
+00006460: 4661 6c73 650a 2020 2020 2020 2020 7365  False.        se
+00006470: 6c66 2e70 726f 7620 3d20 7072 6f76 656e  lf.prov = proven
+00006480: 616e 6365 0a20 2020 2020 2020 2069 6620  ance.        if 
+00006490: 7072 6f76 656e 616e 6365 203d 3d20 4e6f  provenance == No
+000064a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000064b0: 746d 7046 696c 6550 6174 6820 3d20 2222  tmpFilePath = ""
+000064c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000064d0: 7772 6974 6554 6d70 5072 6f76 4669 6c65  writeTmpProvFile
+000064e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000064f0: 2020 746d 7046 696c 6550 6174 6820 3d20    tmpFilePath = 
+00006500: 7365 6c66 2e64 6972 2e74 6f28 7365 6c66  self.dir.to(self
+00006510: 2e64 6972 2e64 742e 7072 6f74 6f63 6f6c  .dir.dt.protocol
+00006520: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00006530: 6c66 2e70 726f 7620 3d20 6d69 7174 702e  lf.prov = miqtp.
+00006540: 5072 6f76 656e 616e 6365 2822 6946 444f  Provenance("iFDO
+00006550: 222c 7665 7262 6f73 653d 7665 7262 6f73  ",verbose=verbos
+00006560: 652c 746d 7046 696c 6550 6174 683d 746d  e,tmpFilePath=tm
+00006570: 7046 696c 6550 6174 6829 0a0a 2020 2020  pFilePath)..    
+00006580: 2020 2020 2320 7365 7420 676c 6f62 616c      # set global
+00006590: 2076 6572 626f 7369 7479 0a20 2020 2020   verbosity.     
+000065a0: 2020 206d 6971 7476 2e73 6574 476c 6f62     miqtv.setGlob
+000065b0: 616c 5665 7262 6f73 6528 7665 7262 6f73  alVerbose(verbos
+000065c0: 6529 0a0a 2020 2020 2020 2020 6966 206e  e)..        if n
+000065d0: 6f74 2064 6972 2e65 7869 7374 7328 293a  ot dir.exists():
+000065e0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+000065f0: 7365 2045 7863 6570 7469 6f6e 2822 6469  se Exception("di
+00006600: 7265 6374 726f 7922 2c20 6469 722e 7374  rectroy", dir.st
+00006610: 7228 292c 2022 646f 6573 206e 6f74 2065  r(), "does not e
+00006620: 7869 7374 2e22 290a 0a20 2020 2020 2020  xist.")..       
+00006630: 2069 6620 6e6f 7420 6469 722e 7661 6c69   if not dir.vali
+00006640: 6444 6174 6144 6972 2829 3a0a 2020 2020  dDataDir():.    
+00006650: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+00006660: 6365 7074 696f 6e28 2264 6972 6563 7472  ception("directr
+00006670: 6f79 222c 2064 6972 2e73 7472 2829 2c20  oy", dir.str(), 
+00006680: 226e 6f74 2076 616c 6964 2e20 446f 6573  "not valid. Does
+00006690: 206e 6f74 2063 6f6d 706c 7920 7769 7468   not comply with
+000066a0: 2073 7472 7563 7475 7265 202f 6261 7365   structure /base
+000066b0: 2f70 726f 6a65 6374 2f5b 4765 6172 2f5d  /project/[Gear/]
+000066c0: 6576 656e 742f 7365 6e73 6f72 2f64 6174  event/sensor/dat
+000066d0: 615f 7479 7065 2f22 290a 0a20 2020 2020  a_type/")..     
+000066e0: 2020 2023 2063 6865 636b 2069 4644 4f20     # check iFDO 
+000066f0: 6669 6c65 0a20 2020 2020 2020 2073 656c  file.        sel
+00006700: 662e 6946 444f 6669 6c65 5f20 3d20 2222  f.iFDOfile_ = ""
+00006710: 2023 2069 7320 7365 7420 6279 2073 6574   # is set by set
+00006720: 6946 444f 4669 6c65 4e61 6d65 2829 0a20  iFDOFileName(). 
+00006730: 2020 2020 2020 206c 6f61 6465 6469 4644         loadediFD
+00006740: 4f20 3d20 4661 6c73 650a 2020 2020 2020  O = False.      
+00006750: 2020 6966 206e 6f74 2069 4644 4f66 696c    if not iFDOfil
+00006760: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+00006770: 2020 2020 2020 2069 4644 4f66 696c 655f         iFDOfile_
+00006780: 203d 2069 4644 4f66 696c 650a 2020 2020   = iFDOfile.    
+00006790: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
+000067a0: 6946 444f 4669 6c65 4e61 6d65 2869 4644  iFDOFileName(iFD
+000067b0: 4f66 696c 655f 290a 2020 2020 2020 2020  Ofile_).        
+000067c0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+000067d0: 7468 2e69 7366 696c 6528 6946 444f 6669  th.isfile(iFDOfi
+000067e0: 6c65 5f29 3a0a 2020 2020 2020 2020 2020  le_):.          
+000067f0: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
+00006800: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
+00006810: 2269 4644 4f20 6669 6c65 206e 6f74 2066  "iFDO file not f
+00006820: 6f75 6e64 3a20 2220 2b20 6946 444f 6669  ound: " + iFDOfi
+00006830: 6c65 5f29 0a20 2020 2020 2020 2065 6c73  le_).        els
+00006840: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+00006850: 4644 4f66 696c 655f 203d 2073 656c 662e  FDOfile_ = self.
+00006860: 6469 722e 746f 2873 656c 662e 6469 722e  dir.to(self.dir.
+00006870: 6474 2e70 726f 6475 6374 7329 2b73 656c  dt.products)+sel
+00006880: 662e 636f 6e73 7472 7563 7469 4644 4f66  f.constructiFDOf
+00006890: 696c 654e 616d 6528 7365 6c66 2e64 6972  ileName(self.dir
+000068a0: 2e70 726f 6a65 6374 2829 2c73 656c 662e  .project(),self.
+000068b0: 6469 722e 6576 656e 7428 292c 7365 6c66  dir.event(),self
+000068c0: 2e64 6972 2e73 656e 736f 7228 2929 0a0a  .dir.sensor())..
+000068d0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+000068e0: 2073 656c 662e 5f69 6d61 6765 7349 6e49   self._imagesInI
+000068f0: 6d61 6765 7344 6972 203d 205b 5d0a 2020  magesDir = [].  
+00006900: 2020 2020 2020 6966 2073 656c 662e 6967        if self.ig
+00006910: 6e6f 7265 5f69 6d61 6765 5f66 696c 6573  nore_image_files
+00006920: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00006930: 696e 7428 2243 6175 7469 6f6e 2120 7275  int("Caution! ru
+00006940: 6e6e 696e 6720 696e 2069 676e 6f72 655f  nning in ignore_
+00006950: 696d 6167 655f 6669 6c65 7320 6d6f 6465  image_files mode
+00006960: 2e22 290a 2020 2020 2020 2020 656c 7365  .").        else
+00006970: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00006980: 6c66 2e5f 696d 6167 6573 496e 496d 6167  lf._imagesInImag
+00006990: 6573 4469 7220 3d20 6d69 7174 692e 6272  esDir = miqti.br
+000069a0: 6f77 7365 466f 7249 6d61 6765 4669 6c65  owseForImageFile
+000069b0: 7328 7365 6c66 2e69 6d61 6765 7344 6972  s(self.imagesDir
+000069c0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+000069d0: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
+000069e0: 7253 6f72 7465 644c 6973 7420 3d20 5b66  rSortedList = [f
+000069f0: 696c 6520 666f 7220 6669 6c65 2069 6e20  ile for file in 
+00006a00: 7365 6c66 2e5f 696d 6167 6573 496e 496d  self._imagesInIm
+00006a10: 6167 6573 4469 725d 0a20 2020 2020 2020  agesDir].       
+00006a20: 2073 656c 662e 5f69 6d61 6765 7349 6e49   self._imagesInI
+00006a30: 6d61 6765 7344 6972 536f 7274 6564 4c69  magesDirSortedLi
+00006a40: 7374 2e73 6f72 7428 290a 2020 2020 2020  st.sort().      
+00006a50: 2020 7365 6c66 2e5f 696d 6167 654e 616d    self._imageNam
+00006a60: 6573 496d 6167 6573 4469 7220 3d20 5b6f  esImagesDir = [o
+00006a70: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+00006a80: 6669 6c65 2920 666f 7220 6669 6c65 2069  file) for file i
+00006a90: 6e20 7365 6c66 2e5f 696d 6167 6573 496e  n self._imagesIn
+00006aa0: 496d 6167 6573 4469 725d 0a0a 2020 2020  ImagesDir]..    
+00006ab0: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
+00006ac0: 5f69 6d61 6765 7349 6e49 6d61 6765 7344  _imagesInImagesD
+00006ad0: 6972 2920 3d3d 2030 2061 6e64 206e 6f74  ir) == 0 and not
+00006ae0: 2069 676e 6f72 655f 696d 6167 655f 6669   ignore_image_fi
+00006af0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+00006b00: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+00006b10: 2822 4e6f 2069 6d61 6765 7320 6669 6c65  ("No images file
+00006b20: 7320 666f 756e 6420 696e 2022 202b 2073  s found in " + s
+00006b30: 656c 662e 696d 6167 6573 4469 7220 2b20  elf.imagesDir + 
+00006b40: 2220 616e 6420 6974 7320 7375 6264 6972  " and its subdir
+00006b50: 6563 746f 7269 6573 2229 0a0a 2020 2020  ectories")..    
+00006b60: 2020 2020 756e 6971 7565 2c20 6475 7020      unique, dup 
+00006b70: 3d20 6d69 7174 742e 6669 6c65 7348 6176  = miqtt.filesHav
+00006b80: 6555 6e69 7175 654e 616d 6528 7365 6c66  eUniqueName(self
+00006b90: 2e5f 696d 6167 6573 496e 496d 6167 6573  ._imagesInImages
+00006ba0: 4469 7229 0a20 2020 2020 2020 2069 6620  Dir).        if 
+00006bb0: 6e6f 7420 756e 6971 7565 3a0a 2020 2020  not unique:.    
+00006bc0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+00006bd0: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
+00006be0: 2020 2020 2020 2020 2022 4e6f 7420 616c           "Not al
+00006bf0: 6c20 6669 6c65 7320 6861 7665 2075 6e69  l files have uni
+00006c00: 7175 6520 6e61 6d65 732e 2044 7570 6c69  que names. Dupli
+00006c10: 6361 7465 733a 2022 202b 2073 7472 2864  cates: " + str(d
+00006c20: 7570 2929 0a0a 2020 2020 2020 2020 616c  up))..        al
+00006c30: 6c76 616c 6964 2c20 6d73 6720 3d20 6d69  lvalid, msg = mi
+00006c40: 7174 742e 616c 6c49 6d61 6765 4e61 6d65  qtt.allImageName
+00006c50: 7356 616c 6964 2873 656c 662e 5f69 6d61  sValid(self._ima
+00006c60: 6765 7349 6e49 6d61 6765 7344 6972 2920  gesInImagesDir) 
+00006c70: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00006c80: 616c 6c76 616c 6964 3a0a 2020 2020 2020  allvalid:.      
+00006c90: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+00006ca0: 7074 696f 6e28 6d73 6729 0a0a 2020 2020  ption(msg)..    
+00006cb0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+00006cc0: 6728 7374 7228 6c65 6e28 7365 6c66 2e5f  g(str(len(self._
+00006cd0: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
+00006ce0: 7229 2920 2b20 2220 696d 6167 6520 6669  r)) + " image fi
+00006cf0: 6c65 7320 666f 756e 642e 2229 0a20 2020  les found.").   
+00006d00: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+00006d10: 6f67 2822 2229 0a20 2020 2020 2020 2073  og("").        s
+00006d20: 656c 662e 7072 6f76 2e6c 6f67 2822 466f  elf.prov.log("Fo
+00006d30: 6c6c 6f77 696e 6720 696e 666f 726d 6174  llowing informat
+00006d40: 696f 6e20 7761 7320 7061 7273 6564 2066  ion was parsed f
+00006d50: 726f 6d20 6469 7265 6374 6f72 792c 2070  rom directory, p
+00006d60: 6c65 6173 6520 6368 6563 6b20 666f 7220  lease check for 
+00006d70: 636f 7272 6563 746e 6573 733a 2229 0a20  correctness:"). 
+00006d80: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+00006d90: 2e6c 6f67 2822 5072 6f6a 6563 743a 5c74  .log("Project:\t
+00006da0: 222b 7365 6c66 2e64 6972 2e70 726f 6a65  "+self.dir.proje
+00006db0: 6374 2829 290a 2020 2020 2020 2020 6966  ct()).        if
+00006dc0: 2073 656c 662e 6469 722e 7769 7468 5f67   self.dir.with_g
+00006dd0: 6561 723a 0a20 2020 2020 2020 2020 2020  ear:.           
+00006de0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+00006df0: 4765 6172 3a5c 745c 7422 2b73 656c 662e  Gear:\t\t"+self.
+00006e00: 6469 722e 6765 6172 2829 290a 2020 2020  dir.gear()).    
+00006e10: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+00006e20: 6728 2245 7665 6e74 3a5c 745c 7422 2b73  g("Event:\t\t"+s
+00006e30: 656c 662e 6469 722e 6576 656e 7428 2929  elf.dir.event())
+00006e40: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
+00006e50: 6f76 2e6c 6f67 2822 5365 6e73 6f72 3a5c  ov.log("Sensor:\
+00006e60: 745c 7422 2b73 656c 662e 6469 722e 7365  t\t"+self.dir.se
+00006e70: 6e73 6f72 2829 290a 2020 2020 2020 2020  nsor()).        
+00006e80: 7365 6c66 2e70 726f 762e 6c6f 6728 2222  self.prov.log(""
+00006e90: 290a 0a20 2020 2020 2020 2023 2069 6e74  )..        # int
+00006ea0: 6572 6d65 6469 6174 6520 6669 6c65 730a  ermediate files.
+00006eb0: 2020 2020 2020 2020 7365 6c66 2e5f 5f69          self.__i
+00006ec0: 6e69 7449 6e74 6572 6d65 6469 6174 6546  nitIntermediateF
+00006ed0: 696c 6573 2829 2020 2020 0a0a 2020 2020  iles()    ..    
+00006ee0: 2020 2020 2320 7472 7920 6c6f 6164 2065      # try load e
+00006ef0: 7869 7374 696e 6720 6946 444f 2066 696c  xisting iFDO fil
+00006f00: 650a 2020 2020 2020 2020 6966 2873 656c  e.        if(sel
+00006f10: 662e 7265 6164 6946 444f 6669 6c65 2869  f.readiFDOfile(i
+00006f20: 4644 4f66 696c 655f 2929 3a0a 2020 2020  FDOfile_)):.    
+00006f30: 2020 2020 2020 2020 6c6f 6164 6564 6946          loadediF
+00006f40: 444f 203d 2054 7275 650a 2020 2020 2020  DO = True.      
+00006f50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00006f60: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00006f70: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
+00006f80: 7365 6c66 2e64 6972 2e74 6f28 7365 6c66  self.dir.to(self
+00006f90: 2e64 6972 2e64 742e 7072 6f64 7563 7473  .dir.dt.products
+00006fa0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00006fb0: 2020 666f 7220 6669 6c65 5f20 696e 206f    for file_ in o
+00006fc0: 732e 6c69 7374 6469 7228 7061 7468 293a  s.listdir(path):
+00006fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006fe0: 2020 2020 2069 6620 6669 6c65 5f5b 2d31       if file_[-1
+00006ff0: 303a 2d34 5d20 3d3d 2022 5f69 4644 4f2e  0:-4] == "_iFDO.
+00007000: 2220 616e 6420 7365 6c66 2e72 6561 6469  " and self.readi
+00007010: 4644 4f66 696c 6528 7061 7468 2b66 696c  FDOfile(path+fil
+00007020: 655f 293a 0a20 2020 2020 2020 2020 2020  e_):.           
+00007030: 2020 2020 2020 2020 2020 2020 206c 6f61               loa
+00007040: 6465 6469 4644 4f20 3d20 5472 7565 0a20  dediFDO = True. 
+00007050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007060: 2020 2020 2020 2069 4644 4f66 696c 655f         iFDOfile_
+00007070: 203d 2070 6174 682b 6669 6c65 5f0a 2020   = path+file_.  
+00007080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007090: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+000070a0: 2020 2020 2020 2020 6578 6365 7074 2046          except F
+000070b0: 696c 654e 6f74 466f 756e 6445 7272 6f72  ileNotFoundError
+000070c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000070d0: 2020 7061 7373 2020 2020 2020 2020 0a0a    pass        ..
+000070e0: 2020 2020 2020 2020 7365 6c66 2e74 7279          self.try
+000070f0: 4175 746f 5365 7448 6561 6465 7246 6965  AutoSetHeaderFie
+00007100: 6c64 7328 290a 2020 2020 2020 2020 7365  lds().        se
+00007110: 6c66 2e73 6574 4865 6164 6572 496d 6167  lf.setHeaderImag
+00007120: 654c 6f63 616c 5061 7468 4669 656c 6428  eLocalPathField(
+00007130: 290a 2020 2020 2020 2020 6966 206c 6f61  ).        if loa
+00007140: 6465 6469 4644 4f3a 0a20 2020 2020 2020  dediFDO:.       
+00007150: 2020 2020 2073 656c 662e 7365 7469 4644       self.setiFD
+00007160: 4f46 696c 654e 616d 6528 6946 444f 6669  OFileName(iFDOfi
+00007170: 6c65 5f29 0a0a 0a20 2020 2040 7374 6174  le_)...    @stat
+00007180: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+00007190: 206f 7065 6e5f 6966 646f 5f66 696c 6528   open_ifdo_file(
+000071a0: 6669 6c65 3a73 7472 293a 2020 0a20 2020  file:str):  .   
+000071b0: 2020 2020 2022 2222 206f 7065 6e20 6966       """ open if
+000071c0: 646f 206a 736f 6e20 6f72 2079 616d 6c20  do json or yaml 
+000071d0: 6f72 207a 6970 2066 696c 6520 616e 6420  or zip file and 
+000071e0: 7265 7475 726e 2061 7320 6469 6374 2e20  return as dict. 
+000071f0: 2222 220a 2020 2020 2020 2020 0a20 2020  """.        .   
+00007200: 2020 2020 2023 2069 6620 6669 6c65 2069       # if file i
+00007210: 7320 7a69 702c 2075 6e7a 6970 0a20 2020  s zip, unzip.   
+00007220: 2020 2020 2069 6620 6669 6c65 2e73 706c       if file.spl
+00007230: 6974 2827 2e27 295b 2d31 5d20 3d3d 2027  it('.')[-1] == '
+00007240: 7a69 7027 3a0a 2020 2020 2020 2020 2020  zip':.          
+00007250: 2020 6669 6c65 5f6e 616d 6520 3d20 272e    file_name = '.
+00007260: 272e 6a6f 696e 286f 732e 7061 7468 2e62  '.join(os.path.b
+00007270: 6173 656e 616d 6528 6669 6c65 292e 7370  asename(file).sp
+00007280: 6c69 7428 272e 2729 5b30 3a2d 315d 290a  lit('.')[0:-1]).
+00007290: 2020 2020 2020 2020 2020 2020 7a69 705f              zip_
+000072a0: 6669 6c65 2020 2020 3d20 7a69 7066 696c  file    = zipfil
+000072b0: 652e 5a69 7046 696c 6528 6669 6c65 290a  e.ZipFile(file).
+000072c0: 2020 2020 2020 2020 2020 2020 6966 646f              ifdo
+000072d0: 5f66 696c 6520 203d 207a 6970 5f66 696c  _file  = zip_fil
+000072e0: 652e 6f70 656e 2866 696c 655f 6e61 6d65  e.open(file_name
+000072f0: 2c20 2772 2729 0a20 2020 2020 2020 2020  , 'r').         
+00007300: 2020 2077 6974 6820 696f 2e54 6578 7449     with io.TextI
+00007310: 4f57 7261 7070 6572 2869 6664 6f5f 6669  OWrapper(ifdo_fi
+00007320: 6c65 2c20 656e 636f 6469 6e67 3d22 7574  le, encoding="ut
+00007330: 662d 3822 2920 6173 206f 3a0a 2020 2020  f-8") as o:.    
+00007340: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+00007350: 696c 652e 7370 6c69 7428 272e 2729 5b2d  ile.split('.')[-
+00007360: 315d 203d 3d20 2779 616d 6c27 3a0a 2020  1] == 'yaml':.  
+00007370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007380: 2020 6966 646f 5f64 6374 203d 2079 616d    ifdo_dct = yam
+00007390: 6c2e 6c6f 6164 286f 2c20 4c6f 6164 6572  l.load(o, Loader
+000073a0: 3d79 616d 6c2e 434c 6f61 6465 7229 0a20  =yaml.CLoader). 
+000073b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000073c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000073d0: 2020 2020 2020 2020 2069 6664 6f5f 6463           ifdo_dc
+000073e0: 7420 3d20 6a73 6f6e 2e6c 6f61 6428 6f29  t = json.load(o)
+000073f0: 0a0a 2020 2020 2020 2020 656c 7365 3a0a  ..        else:.
+00007400: 2020 2020 2020 2020 2020 2020 7472 795f              try_
+00007410: 7961 6d6c 203d 2046 616c 7365 0a20 2020  yaml = False.   
+00007420: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00007430: 2020 2020 2020 2320 6966 2066 696c 6520        # if file 
+00007440: 6973 2079 616d 6c20 6669 6c65 206c 6f61  is yaml file loa
+00007450: 6420 6974 2061 7320 7375 6368 0a20 2020  d it as such.   
+00007460: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
+00007470: 2e73 706c 6974 2827 2e27 295b 2d31 5d20  .split('.')[-1] 
+00007480: 3d3d 2027 7961 6d6c 273a 0a20 2020 2020  == 'yaml':.     
+00007490: 2020 2020 2020 2020 2020 2074 7279 5f79             try_y
+000074a0: 616d 6c20 3d20 5472 7565 0a20 2020 2020  aml = True.     
+000074b0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+000074c0: 7961 6d6c 203d 2066 696c 650a 0a20 2020  yaml = file..   
+000074d0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000074e0: 6f73 2e70 6174 682e 6973 6669 6c65 2866  os.path.isfile(f
+000074f0: 696c 6529 3a0a 2020 2020 2020 2020 2020  ile):.          
+00007500: 2020 2020 2020 2320 6966 2066 696c 6520        # if file 
+00007510: 646f 6573 206e 6f74 2065 7869 7374 2063  does not exist c
+00007520: 6865 636b 2069 6620 7961 6d6c 2076 6572  heck if yaml ver
+00007530: 7369 6f6e 2065 7873 6973 7420 616e 6420  sion exsist and 
+00007540: 7472 7920 746f 206c 6f61 6420 7468 6174  try to load that
+00007550: 206f 6e65 0a20 2020 2020 2020 2020 2020   one.           
+00007560: 2020 2020 2066 696c 655f 7961 6d6c 203d       file_yaml =
+00007570: 2066 696c 652e 7265 706c 6163 6528 272e   file.replace('.
+00007580: 6a73 6f6e 272c 272e 7961 6d6c 2729 0a20  json','.yaml'). 
+00007590: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000075a0: 6620 6f73 2e70 6174 682e 6973 6669 6c65  f os.path.isfile
+000075b0: 2866 696c 655f 7961 6d6c 293a 0a20 2020  (file_yaml):.   
+000075c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075d0: 2074 7279 5f79 616d 6c20 3d20 5472 7565   try_yaml = True
+000075e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000075f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00007600: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00007610: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
+00007620: 7469 6f6e 2822 4669 6c65 206e 6f74 2066  tion("File not f
+00007630: 6f75 6e64 3a20 2220 2b20 6669 6c65 290a  ound: " + file).
+00007640: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
+00007650: 7279 206c 6f61 6420 6a73 6f6e 2c20 6f74  ry load json, ot
+00007660: 6865 7277 6973 6520 7472 7920 7961 6d6c  herwise try yaml
+00007670: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00007680: 7472 795f 7961 6d6c 3a0a 2020 2020 2020  try_yaml:.      
+00007690: 2020 2020 2020 2020 2020 6f20 3d20 6f70            o = op
+000076a0: 656e 2866 696c 655f 7961 6d6c 2c20 2772  en(file_yaml, 'r
+000076b0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+000076c0: 2020 2069 6664 6f5f 6463 7420 3d20 7961     ifdo_dct = ya
+000076d0: 6d6c 2e6c 6f61 6428 6f2c 204c 6f61 6465  ml.load(o, Loade
+000076e0: 723d 7961 6d6c 2e43 4c6f 6164 6572 290a  r=yaml.CLoader).
+000076f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00007700: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007710: 2020 6f20 3d20 6f70 656e 2866 696c 652c    o = open(file,
+00007720: 2027 7227 290a 2020 2020 2020 2020 2020   'r').          
+00007730: 2020 2020 2020 6966 646f 5f64 6374 203d        ifdo_dct =
+00007740: 206a 736f 6e2e 6c6f 6164 286f 290a 2020   json.load(o).  
+00007750: 2020 2020 2020 2020 2020 6f2e 636c 6f73            o.clos
+00007760: 6528 290a 0a20 2020 2020 2020 2072 6574  e()..        ret
+00007770: 7572 6e20 6966 646f 5f64 6374 0a0a 0a20  urn ifdo_dct... 
+00007780: 2020 2064 6566 2072 6561 6469 4644 4f66     def readiFDOf
+00007790: 696c 6528 7365 6c66 2c66 696c 653a 7374  ile(self,file:st
+000077a0: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
+000077b0: 7265 6164 7320 6946 444f 2066 696c 6520  reads iFDO file 
+000077c0: 2222 220a 0a20 2020 2020 2020 2073 203d  """..        s =
+000077d0: 206d 6971 7463 2e50 7269 6e74 4c6f 6164   miqtc.PrintLoad
+000077e0: 696e 674d 7367 2822 4c6f 6164 696e 6720  ingMsg("Loading 
+000077f0: 6946 444f 2066 696c 6522 290a 2020 2020  iFDO file").    
+00007800: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00007810: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
+00007820: 6d70 203d 2073 656c 662e 6f70 656e 5f69  mp = self.open_i
+00007830: 6664 6f5f 6669 6c65 2866 696c 6529 0a20  fdo_file(file). 
+00007840: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007850: 6966 646f 5f70 6172 7365 6420 3d20 636f  ifdo_parsed = co
+00007860: 7079 2e64 6565 7063 6f70 7928 7365 6c66  py.deepcopy(self
+00007870: 2e69 6664 6f5f 746d 7029 0a20 2020 2020  .ifdo_tmp).     
+00007880: 2020 2020 2020 2073 2e73 746f 7028 290a         s.stop().
+00007890: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000078a0: 2e70 726f 762e 6164 6450 7265 7669 6f75  .prov.addPreviou
+000078b0: 7350 726f 7665 6e61 6e63 6528 7365 6c66  sProvenance(self
+000078c0: 2e70 726f 762e 6765 744c 6173 7450 726f  .prov.getLastPro
+000078d0: 7665 6e61 6e63 6546 696c 6528 7365 6c66  venanceFile(self
+000078e0: 2e64 6972 2e74 6f28 7365 6c66 2e64 6972  .dir.to(self.dir
+000078f0: 2e64 742e 7072 6f74 6f63 6f6c 292c 7365  .dt.protocol),se
+00007900: 6c66 2e70 726f 762e 6578 6563 7574 6162  lf.prov.executab
+00007910: 6c65 2929 0a20 2020 2020 2020 2065 7863  le)).        exc
+00007920: 6570 7420 6d69 7174 632e 4966 646f 4578  ept miqtc.IfdoEx
+00007930: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+00007940: 2020 2020 2073 2e73 746f 7028 290a 2020       s.stop().  
+00007950: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00007960: 2046 616c 7365 0a20 2020 2020 2020 2065   False.        e
+00007970: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00007980: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+00007990: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+000079a0: 7374 7228 6529 290a 2020 2020 2020 2020  str(e)).        
+000079b0: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
+000079c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000079d0: 4661 6c73 650a 0a20 2020 2020 2020 2023  False..        #
+000079e0: 2074 7279 2074 6f20 7061 7273 6520 652e   try to parse e.
+000079f0: 672e 2073 7472 696e 6773 2074 6861 7420  g. strings that 
+00007a00: 7265 7072 6573 656e 7420 6469 6374 730a  represent dicts.
+00007a10: 2020 2020 2020 2020 6d69 7174 632e 7265          miqtc.re
+00007a20: 6375 7273 6976 6545 7661 6c28 7365 6c66  cursiveEval(self
+00007a30: 2e69 6664 6f5f 746d 7029 0a0a 2020 2020  .ifdo_tmp)..    
+00007a40: 2020 2020 6966 2073 656c 662e 696d 6167      if self.imag
+00007a50: 6553 6574 4865 6164 6572 4b65 7920 6e6f  eSetHeaderKey no
+00007a60: 7420 696e 2073 656c 662e 6966 646f 5f74  t in self.ifdo_t
+00007a70: 6d70 3a0a 2020 2020 2020 2020 2020 2020  mp:.            
+00007a80: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+00007a90: 2245 7272 6f72 206c 6f61 6469 6e67 2069  "Error loading i
+00007aa0: 4644 4f20 6669 6c65 222c 6669 6c65 2c22  FDO file",file,"
+00007ab0: 646f 6573 206e 6f74 2063 6f6e 7461 696e  does not contain
+00007ac0: 222c 7365 6c66 2e69 6d61 6765 5365 7448  ",self.imageSetH
+00007ad0: 6561 6465 724b 6579 290a 2020 2020 2020  eaderKey).      
+00007ae0: 2020 6966 2073 656c 662e 696d 6167 6553    if self.imageS
+00007af0: 6574 4974 656d 734b 6579 206e 6f74 2069  etItemsKey not i
+00007b00: 6e20 7365 6c66 2e69 6664 6f5f 746d 703a  n self.ifdo_tmp:
+00007b10: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00007b20: 7365 2045 7863 6570 7469 6f6e 2822 4572  se Exception("Er
+00007b30: 726f 7220 6c6f 6164 696e 6720 6946 444f  ror loading iFDO
+00007b40: 2066 696c 6522 2c66 696c 652c 2264 6f65   file",file,"doe
+00007b50: 7320 6e6f 7420 636f 6e74 6169 6e22 2c73  s not contain",s
+00007b60: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
+00007b70: 734b 6579 290a 0a20 2020 2020 2020 2069  sKey)..        i
+00007b80: 6620 2073 656c 662e 6966 646f 5f74 6d70  f  self.ifdo_tmp
+00007b90: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+00007ba0: 6164 6572 4b65 795d 203d 3d20 4e6f 6e65  aderKey] == None
+00007bb0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00007bc0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00007bd0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+00007be0: 6579 5d20 3d20 7b7d 0a20 2020 2020 2020  ey] = {}.       
+00007bf0: 2069 6620 7365 6c66 2e69 6664 6f5f 746d   if self.ifdo_tm
+00007c00: 705b 7365 6c66 2e69 6d61 6765 5365 7449  p[self.imageSetI
+00007c10: 7465 6d73 4b65 795d 203d 3d20 4e6f 6e65  temsKey] == None
+00007c20: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00007c30: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00007c40: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+00007c50: 795d 203d 207b 7d0a 0a20 2020 2020 2020  y] = {}..       
+00007c60: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+00007c70: 6946 444f 2066 696c 6520 6c6f 6164 6564  iFDO file loaded
+00007c80: 3a5c 7422 2b6f 732e 7061 7468 2e62 6173  :\t"+os.path.bas
+00007c90: 656e 616d 6528 6669 6c65 2929 0a0a 2020  ename(file))..  
+00007ca0: 2020 2020 2020 2320 6368 6563 6b20 6946        # check iF
+00007cb0: 444f 2076 6572 7369 6f6e 0a20 2020 2020  DO version.     
+00007cc0: 2020 2072 6561 6456 6572 7369 6f6e 203d     readVersion =
+00007cd0: 2022 762e 312e 302e 3022 2023 2064 6964   "v.1.0.0" # did
+00007ce0: 206e 6f74 2068 6176 6520 7468 6520 2769   not have the 'i
+00007cf0: 6d61 6765 2d73 6574 2d69 6664 6f2d 7665  mage-set-ifdo-ve
+00007d00: 7273 696f 6e27 2066 6965 6c64 2079 6574  rsion' field yet
+00007d10: 0a20 2020 2020 2020 2074 7279 3a20 0a20  .        try: . 
+00007d20: 2020 2020 2020 2020 2020 2072 6561 6456             readV
+00007d30: 6572 7369 6f6e 203d 2073 656c 662e 6669  ersion = self.fi
+00007d40: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
+00007d50: 652d 7365 742d 6966 646f 2d76 6572 7369  e-set-ifdo-versi
+00007d60: 6f6e 2729 0a20 2020 2020 2020 2065 7863  on').        exc
+00007d70: 6570 7420 4b65 7945 7272 6f72 3a0a 2020  ept KeyError:.  
+00007d80: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+00007d90: 2020 2020 2020 2069 6e74 5265 6164 5665         intReadVe
+00007da0: 7273 696f 6e20 3d20 5665 7273 696f 6e28  rsion = Version(
+00007db0: 7265 6164 5665 7273 696f 6e29 0a20 2020  readVersion).   
+00007dc0: 2020 2020 2069 6e74 5468 6973 5665 7273       intThisVers
+00007dd0: 696f 6e20 3d20 5665 7273 696f 6e28 6d69  ion = Version(mi
+00007de0: 7174 762e 6946 444f 5f76 6572 7369 6f6e  qtv.iFDO_version
+00007df0: 290a 2020 2020 2020 2020 6966 2069 6e74  ).        if int
+00007e00: 5265 6164 5665 7273 696f 6e20 3c20 696e  ReadVersion < in
+00007e10: 7454 6869 7356 6572 7369 6f6e 3a0a 2020  tThisVersion:.  
+00007e20: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00007e30: 726f 762e 6c6f 6728 224c 6f61 6465 6420  rov.log("Loaded 
+00007e40: 6946 444f 2068 6173 2076 6572 7369 6f6e  iFDO has version
+00007e50: 2022 202b 2072 6561 6456 6572 7369 6f6e   " + readVersion
+00007e60: 202b 2022 2061 6e64 2077 696c 6c20 6265   + " and will be
+00007e70: 2075 7064 6174 6564 2074 6f20 7665 7273   updated to vers
+00007e80: 696f 6e20 2220 2b20 6d69 7174 762e 6946  ion " + miqtv.iF
+00007e90: 444f 5f76 6572 7369 6f6e 290a 2020 2020  DO_version).    
+00007ea0: 2020 2020 6966 2069 6e74 5265 6164 5665      if intReadVe
+00007eb0: 7273 696f 6e20 3e20 696e 7454 6869 7356  rsion > intThisV
+00007ec0: 6572 7369 6f6e 3a0a 2020 2020 2020 2020  ersion:.        
+00007ed0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+00007ee0: 6728 2243 6175 7469 6f6e 2120 4c6f 6164  g("Caution! Load
+00007ef0: 6564 2069 4644 4f20 6861 7320 7665 7273  ed iFDO has vers
+00007f00: 696f 6e20 2220 2b20 7265 6164 5665 7273  ion " + readVers
+00007f10: 696f 6e20 2b20 2220 6973 2061 6865 6164  ion + " is ahead
+00007f20: 206f 6620 7665 7273 696f 6e20 7573 6564   of version used
+00007f30: 2068 6572 653a 2022 202b 206d 6971 7476   here: " + miqtv
+00007f40: 2e69 4644 4f5f 7665 7273 696f 6e29 0a0a  .iFDO_version)..
+00007f50: 2020 2020 2020 2020 2320 666f 7220 736f          # for so
+00007f60: 6f6f 6f6f 6d65 2072 6561 736f 6e20 7468  oooome reason th
+00007f70: 6973 2066 6978 6573 2061 2068 6963 6b75  is fixes a hicku
+00007f80: 7020 6f66 2074 6865 2070 726f 6720 696e  p of the prog in
+00007f90: 2063 7265 6174 6569 4644 4f28 290a 2020   createiFDO().  
+00007fa0: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
+00007fb0: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
+00007fc0: 6772 6573 734d 7367 2822 666f 6f22 2c20  gressMsg("foo", 
+00007fd0: 312c 6d6f 6475 6c6f 3d31 290a 2020 2020  1,modulo=1).    
+00007fe0: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
+00007ff0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00008000: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+00008010: 6f6e 7665 7274 546f 4465 6661 756c 7444  onvertToDefaultD
+00008020: 6174 6554 696d 6546 6f72 6d61 7428 7365  ateTimeFormat(se
+00008030: 6c66 2e69 6664 6f5f 746d 7029 0a20 2020  lf.ifdo_tmp).   
+00008040: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00008050: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
+00008060: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+00008070: 6f76 2e6c 6f67 2822 4368 6563 6b69 6e67  ov.log("Checking
+00008080: 2064 6174 6574 696d 6520 666f 726d 6174   datetime format
+00008090: 3a20 2220 2b20 7374 7228 6578 2929 0a0a  : " + str(ex))..
+000080a0: 2020 2020 2020 2020 2320 666f 7220 736f          # for so
+000080b0: 6f6f 6f6f 6d65 2072 6561 736f 6e20 7468  oooome reason th
+000080c0: 6973 2066 6978 6573 2061 2068 6963 6b75  is fixes a hicku
+000080d0: 7020 6f66 2074 6865 2070 726f 6720 696e  p of the prog in
+000080e0: 2063 7265 6174 6569 4644 4f28 290a 2020   createiFDO().  
+000080f0: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
+00008100: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
+00008110: 6772 6573 734d 7367 2822 666f 6f22 2c20  gressMsg("foo", 
+00008120: 312c 6d6f 6475 6c6f 3d31 290a 2020 2020  1,modulo=1).    
+00008130: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
+00008140: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+00008150: 7472 795f 7570 6772 6164 655f 746f 5f69  try_upgrade_to_i
+00008160: 6664 6f5f 7665 7273 696f 6e5f 3278 2829  fdo_version_2x()
+00008170: 0a0a 2020 2020 2020 2020 2320 6368 6563  ..        # chec
+00008180: 6b20 7265 6164 2069 4644 4f20 6669 6c65  k read iFDO file
+00008190: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+000081a0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+000081b0: 2073 656c 662e 6967 6e6f 7265 5f69 6d61   self.ignore_ima
+000081c0: 6765 5f66 696c 6573 3a0a 2020 2020 2020  ge_files:.      
+000081d0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+000081e0: 7265 6174 6569 4644 4f28 7365 6c66 2e69  reateiFDO(self.i
+000081f0: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+00008200: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
+00008210: 206d 6971 7469 2e63 7265 6174 6549 6d61   miqti.createIma
+00008220: 6765 4974 656d 734c 6973 7446 726f 6d49  geItemsListFromI
+00008230: 6d61 6765 4974 656d 7344 6963 7428 7365  mageItemsDict(se
+00008240: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00008250: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+00008260: 795d 2929 0a20 2020 2020 2020 2020 2020  y])).           
+00008270: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00008280: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
+00008290: 7465 6946 444f 2873 656c 662e 6966 646f  teiFDO(self.ifdo
+000082a0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+000082b0: 6574 4865 6164 6572 4b65 795d 2c20 6d69  etHeaderKey], mi
+000082c0: 7174 692e 6372 6561 7465 496d 6167 6549  qti.createImageI
+000082d0: 7465 6d73 4c69 7374 4672 6f6d 496d 6167  temsListFromImag
+000082e0: 6549 7465 6d73 4469 6374 2873 656c 662e  eItemsDict(self.
+000082f0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+00008300: 6167 6553 6574 4974 656d 734b 6579 5d29  ageSetItemsKey])
+00008310: 2c68 6561 6465 725f 6f6e 6c79 3d73 656c  ,header_only=sel
+00008320: 662e 6967 6e6f 7265 5f69 6d61 6765 5f66  f.ignore_image_f
+00008330: 696c 6573 290a 2020 2020 2020 2020 6578  iles).        ex
+00008340: 6365 7074 206d 6971 7463 2e49 6664 6f45  cept miqtc.IfdoE
+00008350: 7863 6570 7469 6f6e 2061 7320 6578 3a0a  xception as ex:.
+00008360: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008370: 2e70 726f 762e 6c6f 6728 224c 6f61 6465  .prov.log("Loade
+00008380: 6420 6946 444f 2066 696c 6520 6e6f 7420  d iFDO file not 
+00008390: 7661 6c69 6420 7965 743a 2022 202b 2073  valid yet: " + s
+000083a0: 7472 2865 7829 290a 0a20 2020 2020 2020  tr(ex))..       
+000083b0: 2072 6574 7572 6e20 5472 7565 0a0a 0a20   return True... 
+000083c0: 2020 2064 6566 2077 7269 7465 5f69 6664     def write_ifd
+000083d0: 6f5f 6669 6c65 2873 656c 662c 616c 6c6f  o_file(self,allo
+000083e0: 775f 6d69 7373 696e 675f 7265 7175 6972  w_missing_requir
+000083f0: 6564 3d46 616c 7365 2c20 6173 5f7a 6970  ed=False, as_zip
+00008400: 3a62 6f6f 6c3d 4661 6c73 6529 3a0a 2020  :bool=False):.  
+00008410: 2020 2020 2020 2222 2220 5772 6974 6573        """ Writes
+00008420: 2061 6e20 6946 444f 2066 696c 6520 746f   an iFDO file to
+00008430: 2064 6973 6b2e 204f 7665 7277 7269 7465   disk. Overwrite
+00008440: 7320 706f 7465 6e74 6961 6c6c 7920 6578  s potentially ex
+00008450: 6973 7469 6e67 2066 696c 652e 0a20 2020  isting file..   
+00008460: 2020 2020 2061 735f 7a69 703a 2073 6166       as_zip: saf
+00008470: 6520 6669 6c65 2061 7320 7a69 7020 6669  e file as zip fi
+00008480: 6c65 2022 2222 0a0a 2020 2020 2020 2020  le """..        
+00008490: 7320 3d20 6d69 7174 632e 5072 696e 744c  s = miqtc.PrintL
+000084a0: 6f61 6469 6e67 4d73 6728 2257 7269 7469  oadingMsg("Writi
+000084b0: 6e67 2069 4644 4f20 6669 6c65 2229 0a0a  ng iFDO file")..
+000084c0: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+000084d0: 6669 656c 6473 2061 6761 696e 2069 6620  fields again if 
+000084e0: 6368 616e 6765 6420 7369 6e63 6520 6c61  changed since la
+000084f0: 7374 2063 6865 636b 2028 6372 6561 7465  st check (create
+00008500: 6946 444f 290a 2020 2020 2020 2020 6966  iFDO).        if
+00008510: 2073 656c 662e 6966 646f 5f74 6d70 2021   self.ifdo_tmp !
+00008520: 3d20 7365 6c66 2e69 6664 6f5f 6368 6563  = self.ifdo_chec
+00008530: 6b65 643a 0a20 2020 2020 2020 2020 2020  ked:.           
+00008540: 2073 656c 662e 6372 6561 7465 6946 444f   self.createiFDO
+00008550: 2873 656c 662e 6966 646f 5f74 6d70 5b73  (self.ifdo_tmp[s
+00008560: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+00008570: 6572 4b65 795d 2c20 6d69 7174 692e 6372  erKey], miqti.cr
+00008580: 6561 7465 496d 6167 6549 7465 6d73 4c69  eateImageItemsLi
+00008590: 7374 4672 6f6d 496d 6167 6549 7465 6d73  stFromImageItems
+000085a0: 4469 6374 2873 656c 662e 6966 646f 5f74  Dict(self.ifdo_t
+000085b0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+000085c0: 4974 656d 734b 6579 5d29 2c0a 2020 2020  ItemsKey]),.    
+000085d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000085e0: 2020 2020 2020 2020 616c 6c6f 775f 6d69          allow_mi
+000085f0: 7373 696e 675f 7265 7175 6972 6564 3d61  ssing_required=a
+00008600: 6c6c 6f77 5f6d 6973 7369 6e67 5f72 6571  llow_missing_req
+00008610: 7569 7265 6429 0a20 2020 2020 2020 200a  uired).        .
+00008620: 2020 2020 2020 2020 2320 6164 6420 2224          # add "$
+00008630: 7363 6865 6d61 220a 2020 2020 2020 2020  schema".        
+00008640: 7365 6c66 2e69 6664 6f5f 6368 6563 6b65  self.ifdo_checke
+00008650: 645b 2224 7363 6865 6d61 225d 203d 206d  d["$schema"] = m
+00008660: 6971 7476 2e69 6664 6f5f 7363 6865 6d61  iqtv.ifdo_schema
+00008670: 5b27 2469 6427 5d0a 2020 2020 2020 2020  ['$id'].        
+00008680: 0a20 2020 2020 2020 2069 4644 4f5f 7061  .        iFDO_pa
+00008690: 7468 203d 2073 656c 662e 6765 7469 4644  th = self.getiFD
+000086a0: 4f46 696c 654e 616d 6528 6f76 6572 7772  OFileName(overwr
+000086b0: 6974 653d 5472 7565 290a 0a20 2020 2020  ite=True)..     
+000086c0: 2020 2023 2070 7574 7320 6576 6572 7974     # puts everyt
+000086d0: 6869 6e67 2069 6e20 6f6e 6520 6c69 6e65  hing in one line
+000086e0: 0a20 2020 2020 2020 2023 7769 7468 206f  .        #with o
+000086f0: 7065 6e28 6946 444f 5f70 6174 682e 7265  pen(iFDO_path.re
+00008700: 706c 6163 6528 2279 616d 6c22 2c22 6a73  place("yaml","js
+00008710: 6f6e 2229 2c20 2777 2729 2061 7320 6670  on"), 'w') as fp
+00008720: 3a0a 2020 2020 2020 2020 2320 2020 206a  :.        #    j
+00008730: 736f 6e2e 6475 6d70 2873 656c 662e 6966  son.dump(self.if
+00008740: 646f 5f63 6865 636b 6564 2c20 6670 290a  do_checked, fp).
+00008750: 0a20 2020 2020 2020 2023 2063 6f6e 7665  .        # conve
+00008760: 7274 2064 6963 7469 6f6e 6172 7920 746f  rt dictionary to
+00008770: 204a 534f 4e20 7374 7269 6e67 0a20 2020   JSON string.   
+00008780: 2020 2020 206a 736f 6e5f 6461 7461 203d       json_data =
+00008790: 206a 736f 6e2e 6475 6d70 7328 7365 6c66   json.dumps(self
+000087a0: 2e69 6664 6f5f 6368 6563 6b65 642c 2069  .ifdo_checked, i
+000087b0: 6e64 656e 7420 3d20 342c 2073 6f72 745f  ndent = 4, sort_
+000087c0: 6b65 7973 3d54 7275 6529 0a0a 2020 2020  keys=True)..    
+000087d0: 2020 2020 2320 7772 6974 6520 7468 6520      # write the 
+000087e0: 4a53 4f4e 2073 7472 696e 6720 746f 2061  JSON string to a
+000087f0: 2066 696c 650a 2020 2020 2020 2020 6966   file.        if
+00008800: 2061 735f 7a69 703a 0a20 2020 2020 2020   as_zip:.       
+00008810: 2020 2020 2077 6974 6820 7a69 7066 696c       with zipfil
+00008820: 652e 5a69 7046 696c 6528 6946 444f 5f70  e.ZipFile(iFDO_p
+00008830: 6174 6820 2b20 272e 7a69 7027 2c27 7727  ath + '.zip','w'
+00008840: 2c20 7a69 7066 696c 652e 5a49 505f 4445  , zipfile.ZIP_DE
+00008850: 464c 4154 4544 2920 6173 207a 6970 3a0a  FLATED) as zip:.
+00008860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008870: 7a69 702e 7772 6974 6573 7472 286f 732e  zip.writestr(os.
+00008880: 7061 7468 2e62 6173 656e 616d 6528 6946  path.basename(iF
+00008890: 444f 5f70 6174 6829 2c20 6a73 6f6e 5f64  DO_path), json_d
+000088a0: 6174 6129 0a20 2020 2020 2020 2065 6c73  ata).        els
+000088b0: 653a 0a20 2020 2020 2020 2020 2020 2077  e:.            w
+000088c0: 6974 6820 6f70 656e 2869 4644 4f5f 7061  ith open(iFDO_pa
+000088d0: 7468 2c20 2777 2729 2061 7320 663a 0a20  th, 'w') as f:. 
+000088e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000088f0: 2e77 7269 7465 286a 736f 6e5f 6461 7461  .write(json_data
+00008900: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
+00008910: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00008920: 2320 6c6f 6720 6368 616e 6765 730a 2020  # log changes.  
+00008930: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00008940: 662e 6966 646f 5f70 6172 7365 6420 6973  f.ifdo_parsed is
+00008950: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00008960: 2020 2069 6664 6f5f 7570 6461 7465 203d     ifdo_update =
+00008970: 2044 6565 7044 6966 6628 7365 6c66 2e69   DeepDiff(self.i
+00008980: 6664 6f5f 7061 7273 6564 2c73 656c 662e  fdo_parsed,self.
+00008990: 6966 646f 5f63 6865 636b 6564 290a 2020  ifdo_checked).  
+000089a0: 2020 2020 2020 2020 2020 2370 7072 696e            #pprin
+000089b0: 7428 6966 646f 5f75 7064 6174 6529 0a20  t(ifdo_update). 
+000089c0: 2020 2020 2020 2020 2020 2069 6620 6966             if if
+000089d0: 646f 5f75 7064 6174 6520 213d 207b 7d3a  do_update != {}:
+000089e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000089f0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+00008a00: 6946 444f 2075 7064 6174 6564 2229 0a20  iFDO updated"). 
+00008a10: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00008a20: 656c 662e 7072 6f76 2e6c 6f67 2873 7472  elf.prov.log(str
+00008a30: 2869 6664 6f5f 7570 6461 7465 292c 646f  (ifdo_update),do
+00008a40: 6e74 5368 6f77 3d54 7275 6529 0a20 2020  ntShow=True).   
+00008a50: 2020 2020 200a 2020 2020 2020 2020 7365       .        se
+00008a60: 6c66 2e70 726f 762e 6c6f 6728 2257 726f  lf.prov.log("Wro
+00008a70: 7465 2069 4644 4f20 746f 2066 696c 6520  te iFDO to file 
+00008a80: 2220 2b20 6946 444f 5f70 6174 6829 0a20  " + iFDO_path). 
+00008a90: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+00008aa0: 2e77 7269 7465 2873 656c 662e 6469 722e  .write(self.dir.
+00008ab0: 746f 2873 656c 662e 6469 722e 6474 2e70  to(self.dir.dt.p
+00008ac0: 726f 746f 636f 6c29 290a 2020 2020 2020  rotocol)).      
+00008ad0: 2020 732e 7374 6f70 2829 0a0a 0a20 2020    s.stop()...   
+00008ae0: 2064 6566 2077 7269 7465 6946 444f 6669   def writeiFDOfi
+00008af0: 6c65 2873 656c 662c 616c 6c6f 775f 6d69  le(self,allow_mi
+00008b00: 7373 696e 675f 7265 7175 6972 6564 3d46  ssing_required=F
+00008b10: 616c 7365 293a 0a20 2020 2020 2020 2022  alse):.        "
+00008b20: 2222 2044 6570 7265 6361 7465 6420 2d20  "" Deprecated - 
+00008b30: 7573 6520 7772 6974 655f 6966 646f 5f66  use write_ifdo_f
+00008b40: 696c 6520 2222 220a 2020 2020 2020 2020  ile """.        
+00008b50: 7365 6c66 2e77 7269 7465 5f69 6664 6f5f  self.write_ifdo_
+00008b60: 6669 6c65 2861 6c6c 6f77 5f6d 6973 7369  file(allow_missi
+00008b70: 6e67 5f72 6571 7569 7265 6429 0a0a 0a20  ng_required)... 
+00008b80: 2020 2064 6566 2073 6574 6946 444f 4669     def setiFDOFi
+00008b90: 6c65 4e61 6d65 2873 656c 662c 6946 444f  leName(self,iFDO
+00008ba0: 6669 6c65 3a73 7472 293a 0a20 2020 2020  file:str):.     
+00008bb0: 2020 2022 2222 2053 6574 2074 6865 2063     """ Set the c
+00008bc0: 7572 7265 6e74 2069 4644 4f20 6669 6c65  urrent iFDO file
+00008bd0: 206e 616d 6520 7769 7468 2070 6174 682e   name with path.
+00008be0: 2053 6574 2074 6f20 2222 2069 6e20 6f72   Set to "" in or
+00008bf0: 6465 7220 746f 2067 6574 2064 6566 6175  der to get defau
+00008c00: 6c74 206e 616d 6520 616e 6420 6c6f 6361  lt name and loca
+00008c10: 7469 6f6e 2e20 2222 220a 2020 2020 2020  tion. """.      
+00008c20: 2020 7365 6c66 2e69 4644 4f66 696c 655f    self.iFDOfile_
+00008c30: 203d 2069 4644 4f66 696c 650a 2020 2020   = iFDOfile.    
+00008c40: 2020 2020 7365 6c66 2e69 4644 4f66 696c      self.iFDOfil
+00008c50: 655f 203d 2073 656c 662e 6765 7469 4644  e_ = self.getiFD
+00008c60: 4f46 696c 654e 616d 6528 2920 2320 636f  OFileName() # co
+00008c70: 6e73 7472 7563 7420 6465 6661 756c 7420  nstruct default 
+00008c80: 6e61 6d65 2069 6620 656d 7074 790a 2020  name if empty.  
+00008c90: 2020 2020 2020 6966 206d 6971 7463 2e61        if miqtc.a
+00008ca0: 7373 6572 7453 6c61 7368 286f 732e 7061  ssertSlash(os.pa
+00008cb0: 7468 2e64 6972 6e61 6d65 2873 656c 662e  th.dirname(self.
+00008cc0: 6946 444f 6669 6c65 5f29 2920 213d 206d  iFDOfile_)) != m
+00008cd0: 6971 7463 2e61 7373 6572 7453 6c61 7368  iqtc.assertSlash
+00008ce0: 2873 656c 662e 6469 722e 746f 2873 656c  (self.dir.to(sel
+00008cf0: 662e 6469 722e 6474 2e70 726f 6475 6374  f.dir.dt.product
+00008d00: 7329 293a 0a20 2020 2020 2020 2020 2020  s)):.           
+00008d10: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+00008d20: 4361 7574 696f 6e21 2069 4644 4f20 6669  Caution! iFDO fi
+00008d30: 6c65 2070 6174 6820 6973 206e 6f74 2069  le path is not i
+00008d40: 6e20 2770 726f 6475 6374 7327 2073 7562  n 'products' sub
+00008d50: 2066 6f6c 6465 7220 6173 2072 6563 6f6d   folder as recom
+00008d60: 6d65 6e64 6564 2e20 436f 6e73 6964 6572  mended. Consider
+00008d70: 2072 6573 6574 7469 6e67 2077 6974 6820   resetting with 
+00008d80: 7365 7469 4644 4f46 696c 654e 616d 6528  setiFDOFileName(
+00008d90: 292e 2022 202b 2069 4644 4f66 696c 6529  ). " + iFDOfile)
+00008da0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00008db0: 2020 2020 2020 2020 2020 6576 656e 7420            event 
+00008dc0: 3d20 7365 6c66 2e66 696e 6454 6d70 4669  = self.findTmpFi
+00008dd0: 656c 6428 2769 6d61 6765 2d65 7665 6e74  eld('image-event
+00008de0: 2729 5b27 6e61 6d65 275d 0a20 2020 2020  ')['name'].     
+00008df0: 2020 2020 2020 2073 656e 736f 7220 3d20         sensor = 
+00008e00: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+00008e10: 6428 2769 6d61 6765 2d73 656e 736f 7227  d('image-sensor'
+00008e20: 295b 276e 616d 6527 5d0a 2020 2020 2020  )['name'].      
+00008e30: 2020 6578 6365 7074 206d 6971 7463 2e49    except miqtc.I
+00008e40: 6664 6f45 7863 6570 7469 6f6e 3a0a 2020  fdoException:.  
+00008e50: 2020 2020 2020 2020 2020 6576 656e 7420            event 
+00008e60: 3d20 7365 6c66 2e64 6972 2e65 7665 6e74  = self.dir.event
+00008e70: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
+00008e80: 656e 736f 7220 3d20 7365 6c66 2e64 6972  ensor = self.dir
+00008e90: 2e73 656e 736f 7228 290a 0a20 2020 2020  .sensor()..     
+00008ea0: 2020 2069 4644 4f66 696c 654e 616d 6520     iFDOfileName 
+00008eb0: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
+00008ec0: 6d65 2873 656c 662e 6946 444f 6669 6c65  me(self.iFDOfile
+00008ed0: 5f29 0a20 2020 2020 2020 2069 6620 6e6f  _).        if no
+00008ee0: 7420 6576 656e 7420 696e 2069 4644 4f66  t event in iFDOf
+00008ef0: 696c 654e 616d 6520 6f72 206e 6f74 2069  ileName or not i
+00008f00: 4644 4f2e 6765 7453 686f 7274 4571 7569  FDO.getShortEqui
+00008f10: 706d 656e 7449 4428 7365 6e73 6f72 2920  pmentID(sensor) 
+00008f20: 696e 2069 4644 4f66 696c 654e 616d 653a  in iFDOfileName:
+00008f30: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008f40: 662e 7072 6f76 2e6c 6f67 2822 4361 7574  f.prov.log("Caut
+00008f50: 696f 6e21 2069 4644 4f20 6669 6c65 206e  ion! iFDO file n
+00008f60: 616d 6520 646f 6573 206e 6f74 2063 6f6e  ame does not con
+00008f70: 7461 696e 2070 726f 6a65 6374 2c20 6576  tain project, ev
+00008f80: 656e 7420 616e 6420 7365 6e73 6f72 206e  ent and sensor n
+00008f90: 616d 6520 6173 2072 6563 6f6d 6d65 6e64  ame as recommend
+00008fa0: 6564 2e20 436f 6e73 6964 6572 2072 6573  ed. Consider res
+00008fb0: 6574 7469 6e67 2077 6974 6820 7365 7469  etting with seti
+00008fc0: 4644 4f46 696c 654e 616d 6528 292e 2022  FDOFileName(). "
+00008fd0: 202b 2069 4644 4f66 696c 6529 0a0a 0a20   + iFDOfile)... 
+00008fe0: 2020 2064 6566 2067 6574 6946 444f 4669     def getiFDOFi
+00008ff0: 6c65 4e61 6d65 2873 656c 662c 6f76 6572  leName(self,over
+00009000: 7772 6974 653d 4661 6c73 6529 3a0a 2020  write=False):.  
+00009010: 2020 2020 2020 2222 2220 5265 7475 726e        """ Return
+00009020: 7320 7468 6520 6375 7272 656e 7420 6946  s the current iF
+00009030: 444f 2066 696c 6527 7320 6e61 6d65 2077  DO file's name w
+00009040: 6974 6820 7061 7468 2e20 4966 206e 6f74  ith path. If not
+00009050: 2073 6574 2079 6574 206f 7220 6f76 6572   set yet or over
+00009060: 7772 6974 653d 3d54 7275 6520 6974 2072  write==True it r
+00009070: 6574 7572 6e73 2074 6865 206f 6e65 206d  eturns the one m
+00009080: 6174 6368 696e 6720 696d 6167 652d 7365  atching image-se
+00009090: 742d 6e61 6d65 2e20 2222 220a 2020 2020  t-name. """.    
+000090a0: 2020 2020 6966 2073 656c 662e 6946 444f      if self.iFDO
+000090b0: 6669 6c65 5f20 3d3d 2022 2220 6f72 206f  file_ == "" or o
+000090c0: 7665 7277 7269 7465 3a0a 2020 2020 2020  verwrite:.      
+000090d0: 2020 2020 2020 6669 6c65 5f6e 616d 6520        file_name 
+000090e0: 3d20 7365 6c66 2e66 696e 6454 6d70 4669  = self.findTmpFi
+000090f0: 656c 6428 2769 6d61 6765 2d73 6574 2d6e  eld('image-set-n
+00009100: 616d 6527 2920 2b20 275f 6946 444f 2e6a  ame') + '_iFDO.j
+00009110: 736f 6e27 0a20 2020 2020 2020 2020 2020  son'.           
+00009120: 2069 6620 7365 6c66 2e69 4644 4f66 696c   if self.iFDOfil
+00009130: 655f 2021 3d20 2222 3a0a 2020 2020 2020  e_ != "":.      
+00009140: 2020 2020 2020 2020 2020 2320 7265 6e61            # rena
+00009150: 6d65 2066 696c 6520 6275 7420 6b65 6570  me file but keep
+00009160: 206c 6f63 6174 696f 6e0a 2020 2020 2020   location.      
+00009170: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
+00009180: 655f 6e61 6d65 2021 3d20 6f73 2e70 6174  e_name != os.pat
+00009190: 682e 6261 7365 6e61 6d65 2873 656c 662e  h.basename(self.
+000091a0: 6946 444f 6669 6c65 5f29 2061 6e64 206f  iFDOfile_) and o
+000091b0: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
+000091c0: 6c66 2e69 4644 4f66 696c 655f 293a 0a20  lf.iFDOfile_):. 
+000091d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000091e0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+000091f0: 2822 4361 7574 696f 6e21 2069 6664 6f20  ("Caution! ifdo 
+00009200: 6669 6c65 2072 656e 616d 6564 2074 6f20  file renamed to 
+00009210: 2220 2b20 6669 6c65 5f6e 616d 6529 0a20  " + file_name). 
+00009220: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00009230: 656c 662e 6946 444f 6669 6c65 5f20 3d20  elf.iFDOfile_ = 
+00009240: 6f73 2e70 6174 682e 6a6f 696e 286f 732e  os.path.join(os.
+00009250: 7061 7468 2e64 6972 6e61 6d65 2873 656c  path.dirname(sel
+00009260: 662e 6946 444f 6669 6c65 5f29 2c66 696c  f.iFDOfile_),fil
+00009270: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
+00009280: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00009290: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+000092a0: 4644 4f66 696c 655f 203d 206f 732e 7061  FDOfile_ = os.pa
+000092b0: 7468 2e6a 6f69 6e28 7365 6c66 2e64 6972  th.join(self.dir
+000092c0: 2e74 6f28 7365 6c66 2e64 6972 2e64 742e  .to(self.dir.dt.
+000092d0: 7072 6f64 7563 7473 292c 2066 696c 655f  products), file_
+000092e0: 6e61 6d65 290a 2020 2020 2020 2020 7265  name).        re
+000092f0: 7475 726e 2073 656c 662e 6946 444f 6669  turn self.iFDOfi
+00009300: 6c65 5f0a 0a0a 2020 2020 6465 6620 7365  le_...    def se
+00009310: 745f 696d 6167 655f 7365 745f 6e61 6d65  t_image_set_name
+00009320: 5f66 6965 6c64 5f66 726f 6d5f 7072 6f6a  _field_from_proj
+00009330: 6563 745f 6576 656e 745f 7365 6e73 6f72  ect_event_sensor
+00009340: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00009350: 2222 2220 5365 7473 2066 6965 6c64 2069  """ Sets field i
+00009360: 6d61 6765 2d73 6574 2d6e 616d 6520 6672  mage-set-name fr
+00009370: 6f6d 2063 7572 7265 6e74 2074 6d70 2066  om current tmp f
+00009380: 6965 6c64 7320 666f 7220 7072 6f6a 6563  ields for projec
+00009390: 742c 2065 7665 6e74 2061 6e64 2073 656e  t, event and sen
+000093a0: 736f 722e 200a 2020 2020 2020 2020 5265  sor. .        Re
+000093b0: 7475 726e 7320 696d 6167 652d 7365 742d  turns image-set-
+000093c0: 6e61 6d65 2076 616c 7565 2e20 2222 220a  name value. """.
+000093d0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+000093e0: 206e 6577 5f69 6d61 6765 5f73 6574 5f6e   new_image_set_n
+000093f0: 616d 6520 3d20 7365 6c66 2e67 6574 5f69  ame = self.get_i
+00009400: 6d61 6765 5f73 6574 5f6e 616d 655f 6669  mage_set_name_fi
+00009410: 656c 645f 6672 6f6d 5f70 726f 6a65 6374  eld_from_project
+00009420: 5f65 7665 6e74 5f73 656e 736f 7228 7365  _event_sensor(se
+00009430: 6c66 2e69 6664 6f5f 746d 7029 0a20 2020  lf.ifdo_tmp).   
+00009440: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
+00009450: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+00009460: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
+00009470: 652d 7365 742d 6e61 6d65 275d 203d 206e  e-set-name'] = n
+00009480: 6577 5f69 6d61 6765 5f73 6574 5f6e 616d  ew_image_set_nam
+00009490: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+000094a0: 206e 6577 5f69 6d61 6765 5f73 6574 5f6e   new_image_set_n
+000094b0: 616d 650a 2020 2020 2020 2020 0a0a 2020  ame.        ..  
+000094c0: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
+000094d0: 2020 2020 6465 6620 6765 745f 696d 6167      def get_imag
+000094e0: 655f 7365 745f 6e61 6d65 5f66 6965 6c64  e_set_name_field
+000094f0: 5f66 726f 6d5f 7072 6f6a 6563 745f 6576  _from_project_ev
+00009500: 656e 745f 7365 6e73 6f72 2869 6664 6f3a  ent_sensor(ifdo:
+00009510: 6469 6374 293a 0a20 2020 2020 2020 2022  dict):.        "
+00009520: 2222 2043 7265 6174 6573 2061 6e64 2072  "" Creates and r
+00009530: 6574 7572 6e73 2069 6d61 6765 2d73 6574  eturns image-set
+00009540: 2d6e 616d 6520 6672 6f6d 2063 7572 7265  -name from curre
+00009550: 6e74 2074 6d70 2066 6965 6c64 7320 666f  nt tmp fields fo
+00009560: 7220 7072 6f6a 6563 742c 2065 7665 6e74  r project, event
+00009570: 2061 6e64 2073 656e 736f 722e 2022 2222   and sensor. """
+00009580: 0a20 2020 2020 2020 206e 6577 5f69 6d61  .        new_ima
+00009590: 6765 5f73 6574 5f6e 616d 6520 3d20 6946  ge_set_name = iF
+000095a0: 444f 2e63 6f6e 7374 7275 6374 496d 6167  DO.constructImag
+000095b0: 6553 6574 4e61 6d65 2869 6664 6f5b 2769  eSetName(ifdo['i
+000095c0: 6d61 6765 2d73 6574 2d68 6561 6465 7227  mage-set-header'
+000095d0: 5d5b 2769 6d61 6765 2d70 726f 6a65 6374  ]['image-project
+000095e0: 275d 5b27 6e61 6d65 275d 2c0a 2020 2020  ']['name'],.    
 000095f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00009600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009610: 2020 2020 6966 646f 5b27 696d 6167 652d      ifdo['image-
-00009620: 7365 742d 6865 6164 6572 275d 5b27 696d  set-header']['im
-00009630: 6167 652d 6576 656e 7427 5d5b 276e 616d  age-event']['nam
-00009640: 6527 5d2c 0a20 2020 2020 2020 2020 2020  e'],.           
-00009650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009620: 2020 2020 6966 646f 5b27 696d 6167 652d      ifdo['image-
+00009630: 7365 742d 6865 6164 6572 275d 5b27 696d  set-header']['im
+00009640: 6167 652d 6576 656e 7427 5d5b 276e 616d  age-event']['nam
+00009650: 6527 5d2c 0a20 2020 2020 2020 2020 2020  e'],.           
 00009660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009670: 2020 2020 2020 2020 2020 2020 2069 6664               ifd
-00009680: 6f5b 2769 6d61 6765 2d73 6574 2d68 6561  o['image-set-hea
-00009690: 6465 7227 5d5b 2769 6d61 6765 2d73 656e  der']['image-sen
-000096a0: 736f 7227 5d5b 276e 616d 6527 5d29 0a20  sor']['name']). 
-000096b0: 2020 2020 2020 2072 6574 7572 6e20 6e65         return ne
-000096c0: 775f 696d 6167 655f 7365 745f 6e61 6d65  w_image_set_name
-000096d0: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
-000096e0: 686f 640a 2020 2020 6465 6620 636f 6e73  hod.    def cons
-000096f0: 7472 7563 7449 6d61 6765 5365 744e 616d  tructImageSetNam
-00009700: 6528 7072 6f6a 6563 743a 7374 722c 6576  e(project:str,ev
-00009710: 656e 743a 7374 722c 7365 6e73 6f72 3a73  ent:str,sensor:s
-00009720: 7472 293a 0a20 2020 2020 2020 2022 2222  tr):.        """
-00009730: 2072 6574 7572 6e73 203c 7072 6f6a 6563   returns <projec
-00009740: 743e 5f3c 6576 656e 743e 5f3c 7365 6e73  t>_<event>_<sens
-00009750: 6f72 3e2c 2077 6974 6820 7368 6f72 7420  or>, with short 
-00009760: 7665 7273 696f 6e20 6f66 203c 7365 6e73  version of <sens
-00009770: 6f72 3e20 286f 6e6c 7920 6964 292c 2070  or> (only id), p
-00009780: 7265 7665 6e74 696e 6720 706f 7465 6e74  reventing potent
-00009790: 6961 6c20 646f 7562 6c69 6e67 206f 6620  ial doubling of 
-000097a0: 3c70 726f 6a65 6374 3e20 2022 2222 0a20  <project>  """. 
-000097b0: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
-000097c0: 2070 726f 6a65 6374 2e73 7472 6970 2829   project.strip()
-000097d0: 2e72 6570 6c61 6365 2827 2027 2c27 2d27  .replace(' ','-'
-000097e0: 290a 2020 2020 2020 2020 6576 656e 7420  ).        event 
-000097f0: 3d20 6576 656e 742e 7374 7269 7028 292e  = event.strip().
-00009800: 7265 706c 6163 6528 2720 272c 272d 2729  replace(' ','-')
-00009810: 0a20 2020 2020 2020 2073 656e 736f 7220  .        sensor 
-00009820: 3d20 7365 6e73 6f72 2e73 7472 6970 2829  = sensor.strip()
-00009830: 2e72 6570 6c61 6365 2827 2027 2c27 2d27  .replace(' ','-'
-00009840: 290a 2020 2020 2020 2020 7365 6e73 6f72  ).        sensor
-00009850: 5f73 686f 7274 203d 2069 4644 4f2e 6765  _short = iFDO.ge
-00009860: 7453 686f 7274 4571 7569 706d 656e 7449  tShortEquipmentI
-00009870: 4428 7365 6e73 6f72 290a 2020 2020 2020  D(sensor).      
-00009880: 2020 6966 206c 656e 2865 7665 6e74 2920    if len(event) 
-00009890: 3e20 6c65 6e28 7072 6f6a 6563 7429 2061  > len(project) a
-000098a0: 6e64 2065 7665 6e74 5b30 3a6c 656e 2870  nd event[0:len(p
-000098b0: 726f 6a65 6374 295d 203d 3d20 7072 6f6a  roject)] == proj
-000098c0: 6563 743a 0a20 2020 2020 2020 2020 2020  ect:.           
-000098d0: 2069 6d61 6765 5f73 6574 5f6e 616d 655f   image_set_name_
-000098e0: 203d 2065 7665 6e74 202b 2022 5f22 202b   = event + "_" +
-000098f0: 2073 656e 736f 725f 7368 6f72 740a 2020   sensor_short.  
-00009900: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00009910: 2020 2020 2020 2020 696d 6167 655f 7365          image_se
-00009920: 745f 6e61 6d65 5f20 3d20 7072 6f6a 6563  t_name_ = projec
-00009930: 7420 2b20 225f 2220 2b20 6576 656e 7420  t + "_" + event 
-00009940: 2b20 225f 2220 2b20 7365 6e73 6f72 5f73  + "_" + sensor_s
-00009950: 686f 7274 0a20 2020 2020 2020 2072 6574  hort.        ret
-00009960: 7572 6e20 696d 6167 655f 7365 745f 6e61  urn image_set_na
-00009970: 6d65 5f20 2320 544f 444f 2069 6e63 6c75  me_ # TODO inclu
-00009980: 6465 2064 6174 6154 7970 653f 0a0a 0a20  de dataType?... 
-00009990: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
-000099a0: 0a20 2020 2064 6566 2067 6574 5368 6f72  .    def getShor
-000099b0: 7445 7175 6970 6d65 6e74 4944 2865 7175  tEquipmentID(equ
-000099c0: 6970 6d65 6e74 4944 3a73 7472 293a 0a20  ipmentID:str):. 
-000099d0: 2020 2020 2020 2022 2222 2072 6574 7572         """ retur
-000099e0: 6e73 2065 7175 6970 6d65 6e74 2069 6420  ns equipment id 
-000099f0: 7769 7468 6f75 7420 706f 7465 6e74 6961  without potentia
-00009a00: 6c6c 206c 6f6e 6720 3c6e 616d 653e 2070  ll long <name> p
-00009a10: 6172 742c 2069 2e65 2e3a 203c 6f77 6e65  art, i.e.: <owne
-00009a20: 723e 5f3c 7479 7065 3e2d 3c74 7970 6520  r>_<type>-<type 
-00009a30: 696e 6465 785b 5f3c 7375 6274 7970 653e  index[_<subtype>
-00009a40: 5d20 2222 220a 2020 2020 2020 2020 7265  ] """.        re
-00009a50: 7475 726e 2027 5f27 2e6a 6f69 6e28 6571  turn '_'.join(eq
-00009a60: 7569 706d 656e 7449 442e 7370 6c69 7428  uipmentID.split(
-00009a70: 275f 2729 5b30 3a33 5d29 0a0a 2020 2020  '_')[0:3])..    
-00009a80: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
-00009a90: 2020 6465 6620 636f 6e73 7472 7563 7469    def constructi
-00009aa0: 4644 4f66 696c 654e 616d 6528 7072 6f6a  FDOfileName(proj
-00009ab0: 6563 743a 7374 722c 6576 656e 743a 7374  ect:str,event:st
-00009ac0: 722c 7365 6e73 6f72 3a73 7472 293a 0a20  r,sensor:str):. 
-00009ad0: 2020 2020 2020 2022 2222 2072 6574 7572         """ retur
-00009ae0: 6e73 203c 636f 6e73 7472 7563 7449 6d61  ns <constructIma
-00009af0: 6765 5365 744e 616d 6528 293e 5f69 4644  geSetName()>_iFD
-00009b00: 4f2e 6a73 6f6e 2022 2222 0a20 2020 2020  O.json """.     
-00009b10: 2020 2072 6574 7572 6e20 6946 444f 2e63     return iFDO.c
-00009b20: 6f6e 7374 7275 6374 496d 6167 6553 6574  onstructImageSet
-00009b30: 4e61 6d65 2870 726f 6a65 6374 2c65 7665  Name(project,eve
-00009b40: 6e74 2c73 656e 736f 7229 202b 2027 5f69  nt,sensor) + '_i
-00009b50: 4644 4f2e 6a73 6f6e 2720 0a0a 2020 2020  FDO.json' ..    
-00009b60: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
-00009b70: 6f64 0a20 2020 2064 6566 205f 5f67 6574  od.    def __get
-00009b80: 4669 656c 6456 616c 7565 2869 6664 6f3a  FieldValue(ifdo:
-00009b90: 6469 6374 2c6b 6579 733a 6c69 7374 2c64  dict,keys:list,d
-00009ba0: 6566 6175 6c74 5f6f 6e6c 7920 3d20 4661  efault_only = Fa
-00009bb0: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
-00009bc0: 2220 7265 7475 726e 7320 636f 7079 206f  " returns copy o
-00009bd0: 6620 7365 7420 6f72 2069 7465 6d20 6669  f set or item fi
-00009be0: 656c 6420 7661 6c75 652c 2061 6c73 6f20  eld value, also 
-00009bf0: 636f 6e73 6964 6572 6e67 2064 6566 6175  considerng defau
-00009c00: 6c74 2076 616c 7565 7320 6672 6f6d 2068  lt values from h
-00009c10: 6561 6465 722e 0a20 2020 2020 2020 2020  eader..         
-00009c20: 2020 2055 7365 206b 6579 7320 6173 2065     Use keys as e
-00009c30: 2e67 2e20 5b3c 6974 656d 3e2c 3c6b 6579  .g. [<item>,<key
-00009c40: 3e2c 2e2e 5d2e 2043 616e 2062 6520 7573  >,..]. Can be us
-00009c50: 6564 2066 6f72 2068 6561 6465 7220 6669  ed for header fi
-00009c60: 656c 6473 2061 7320 7765 6c6c 2061 7320  elds as well as 
-00009c70: 6974 656d 2066 6965 6c64 732e 0a20 2020  item fields..   
-00009c80: 2020 2020 2020 2020 2049 7465 6d20 696e           Item in
-00009c90: 6465 7820 6361 6e20 6265 206e 6567 6c65  dex can be negle
-00009ca0: 6374 6564 2c20 696e 2063 6173 6520 6f66  cted, in case of
-00009cb0: 2076 6964 656f 2061 2064 6963 7420 7b3c   video a dict {<
-00009cc0: 696d 6167 652d 6461 7461 7469 6d65 3e3a  image-datatime>:
-00009cd0: 3c76 616c 7565 3e2c 2e2e 2e7d 2069 7320  <value>,...} is 
-00009ce0: 7265 7475 726e 6564 0a20 2020 2020 2020  returned.       
-00009cf0: 2020 2020 2075 6e6c 6573 7320 6465 6661       unless defa
-00009d00: 756c 745f 6f6e 6c79 203d 2046 616c 7365  ult_only = False
-00009d10: 2c20 7468 656e 2064 6566 6175 6c74 2076  , then default v
-00009d20: 616c 7565 7320 6174 2069 6e64 6578 2030  alues at index 0
-00009d30: 2069 7320 7265 7475 726e 6564 2e0a 2020   is returned..  
-00009d40: 2020 2020 2020 2020 2020 5261 6973 6573            Raises
-00009d50: 2049 6664 6f45 7863 6570 7469 6f6e 2069   IfdoException i
-00009d60: 6620 6b65 7973 2064 6f20 6e6f 7420 6578  f keys do not ex
-00009d70: 6973 742e 2022 2222 0a0a 2020 2020 2020  ist. """..      
-00009d80: 2020 6966 206e 6f74 206d 6971 7476 2e69    if not miqtv.i
-00009d90: 6d61 6765 5f73 6574 5f69 7465 6d73 5f6b  mage_set_items_k
-00009da0: 6579 2069 6e20 6966 646f 206f 7220 6e6f  ey in ifdo or no
-00009db0: 7420 6d69 7174 762e 696d 6167 655f 7365  t miqtv.image_se
-00009dc0: 745f 6865 6164 6572 5f6b 6579 2069 6e20  t_header_key in 
-00009dd0: 6966 646f 3a0a 2020 2020 2020 2020 2020  ifdo:.          
-00009de0: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
-00009df0: 646f 4578 6365 7074 696f 6e28 2249 6e76  doException("Inv
-00009e00: 616c 6964 2069 6664 6f20 6469 6374 2c20  alid ifdo dict, 
-00009e10: 6d69 7373 696e 6720 6974 656d 7320 6f72  missing items or
-00009e20: 2068 6561 6465 7220 6b65 793a 2022 202b   header key: " +
-00009e30: 2073 7472 2869 6664 6f29 290a 2020 2020   str(ifdo)).    
-00009e40: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
-00009e50: 6e6f 7420 6973 696e 7374 616e 6365 286b  not isinstance(k
-00009e60: 6579 732c 6c69 7374 293a 0a20 2020 2020  eys,list):.     
-00009e70: 2020 2020 2020 206b 6579 7320 3d20 5b6b         keys = [k
-00009e80: 6579 735d 0a0a 2020 2020 2020 2020 2320  eys]..        # 
-00009e90: 7265 6d6f 7665 2068 6561 6465 7220 6f72  remove header or
-00009ea0: 2069 7465 6d20 7072 6566 6978 6573 2069   item prefixes i
-00009eb0: 6620 7468 6572 650a 2020 2020 2020 2020  f there.        
-00009ec0: 6966 206b 6579 735b 305d 203d 3d20 6d69  if keys[0] == mi
-00009ed0: 7174 762e 696d 6167 655f 7365 745f 6974  qtv.image_set_it
-00009ee0: 656d 735f 6b65 7920 6f72 206b 6579 735b  ems_key or keys[
-00009ef0: 305d 203d 3d20 6d69 7174 762e 696d 6167  0] == miqtv.imag
-00009f00: 655f 7365 745f 6865 6164 6572 5f6b 6579  e_set_header_key
-00009f10: 3a0a 2020 2020 2020 2020 2020 2020 6b65  :.            ke
-00009f20: 7973 203d 206b 6579 735b 313a 3a5d 0a0a  ys = keys[1::]..
-00009f30: 2020 2020 2020 2020 6865 6164 6572 203d          header =
-00009f40: 2069 6664 6f5b 6d69 7174 762e 696d 6167   ifdo[miqtv.imag
-00009f50: 655f 7365 745f 6865 6164 6572 5f6b 6579  e_set_header_key
-00009f60: 5d0a 2020 2020 2020 2020 6974 656d 7320  ].        items 
-00009f70: 3d20 6966 646f 5b6d 6971 7476 2e69 6d61  = ifdo[miqtv.ima
-00009f80: 6765 5f73 6574 5f69 7465 6d73 5f6b 6579  ge_set_items_key
-00009f90: 5d0a 2020 2020 2020 2020 2320 6c6f 6f6b  ].        # look
-00009fa0: 2066 6f72 2064 6566 6175 6c74 2076 616c   for default val
-00009fb0: 7565 0a20 2020 2020 2020 2066 6f72 2073  ue.        for s
-00009fc0: 6b69 7070 6564 496e 4865 6164 6572 2069  kippedInHeader i
-00009fd0: 6e20 7261 6e67 6528 6c65 6e28 6b65 7973  n range(len(keys
-00009fe0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-00009ff0: 6465 6661 756c 7456 616c 203d 2066 696e  defaultVal = fin
-0000a000: 6446 6965 6c64 2868 6561 6465 722c 6b65  dField(header,ke
-0000a010: 7973 5b73 6b69 7070 6564 496e 4865 6164  ys[skippedInHead
-0000a020: 6572 3a3a 5d29 0a20 2020 2020 2020 2020  er::]).         
-0000a030: 2020 2069 6620 6465 6661 756c 7456 616c     if defaultVal
-0000a040: 2021 3d20 2222 3a0a 2020 2020 2020 2020   != "":.        
-0000a050: 2020 2020 2020 2020 6272 6561 6b0a 0a20          break.. 
-0000a060: 2020 2020 2020 2023 2320 6c6f 6f6b 2066         ## look f
-0000a070: 6f72 2069 7465 6d20 7661 6c75 650a 2020  or item value.  
-0000a080: 2020 2020 2020 2320 6865 6164 6572 206f        # header o
-0000a090: 6e6c 7920 7661 6c75 652c 2064 6f6e 2774  nly value, don't
-0000a0a0: 2063 6865 636b 2069 6e20 6974 656d 730a   check in items.
-0000a0b0: 2020 2020 2020 2020 6966 2066 696e 6446          if findF
-0000a0c0: 6965 6c64 2869 7465 6d73 2c6b 6579 735b  ield(items,keys[
-0000a0d0: 303a 315d 2920 3d3d 2022 2220 616e 6420  0:1]) == "" and 
-0000a0e0: 736b 6970 7065 6449 6e48 6561 6465 7220  skippedInHeader 
-0000a0f0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-0000a100: 2020 7265 7420 3d20 6465 6661 756c 7456    ret = defaultV
-0000a110: 616c 0a20 2020 2020 2020 2020 2020 2069  al.            i
-0000a120: 6620 7265 7420 3d3d 2022 223a 0a20 2020  f ret == "":.   
-0000a130: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0000a140: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
-0000a150: 6570 7469 6f6e 2822 6b65 7920 646f 6573  eption("key does
-0000a160: 206e 6f74 2065 7869 7374 3a22 202b 2073   not exist:" + s
-0000a170: 7472 286b 6579 7329 290a 2020 2020 2020  tr(keys)).      
-0000a180: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000a190: 2020 2020 2320 6966 2066 6972 7374 206b      # if first k
-0000a1a0: 6579 206e 6f74 2066 6f75 6e64 2069 6e20  ey not found in 
-0000a1b0: 6974 656d 732c 2069 2e65 2e20 6973 206e  items, i.e. is n
-0000a1c0: 6f74 2061 2069 6d61 6765 206e 616d 652c  ot a image name,
-0000a1d0: 2061 6e64 2066 6972 7374 206b 6579 2069   and first key i
-0000a1e0: 7320 6e6f 7420 6120 6865 6164 6572 206b  s not a header k
-0000a1f0: 6579 3a0a 2020 2020 2020 2020 2020 2020  ey:.            
-0000a200: 6966 2066 696e 6446 6965 6c64 2869 7465  if findField(ite
-0000a210: 6d73 2c6b 6579 735b 303a 315d 2920 3d3d  ms,keys[0:1]) ==
-0000a220: 2022 2220 616e 6420 736b 6970 7065 6449   "" and skippedI
-0000a230: 6e48 6561 6465 7220 213d 2030 3a0a 2020  nHeader != 0:.  
-0000a240: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0000a250: 6973 6520 6d69 7174 632e 4966 646f 4578  ise miqtc.IfdoEx
-0000a260: 6365 7074 696f 6e28 2269 7465 6d20 646f  ception("item do
-0000a270: 6573 206e 6f74 2065 7869 7374 3a22 202b  es not exist:" +
-0000a280: 2073 7472 286b 6579 735b 303a 315d 2929   str(keys[0:1]))
-0000a290: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0000a2a0: 6368 6563 6b20 6966 2069 6e64 6578 2070  check if index p
-0000a2b0: 726f 7669 6465 640a 2020 2020 2020 2020  rovided.        
-0000a2c0: 2020 2020 696e 6465 7850 726f 7669 6465      indexProvide
-0000a2d0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
-0000a2e0: 2020 2020 2069 6620 6c65 6e28 6b65 7973       if len(keys
-0000a2f0: 2920 3e20 313a 0a20 2020 2020 2020 2020  ) > 1:.         
-0000a300: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0000a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a320: 696e 6465 7820 3d20 696e 7428 6b65 7973  index = int(keys
-0000a330: 5b31 5d29 0a20 2020 2020 2020 2020 2020  [1]).           
-0000a340: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-0000a350: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
-0000a360: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-0000a370: 5072 6f76 6964 6564 203d 2046 616c 7365  Provided = False
-0000a380: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0000a390: 6620 6c65 6e28 6b65 7973 2920 3d3d 2031  f len(keys) == 1
-0000a3a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a3b0: 2020 696e 6465 7850 726f 7669 6465 6420    indexProvided 
-0000a3c0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0000a3d0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0000a3e0: 2020 2020 2069 6d61 6765 4974 656d 5469       imageItemTi
-0000a3f0: 6d65 506f 696e 7473 203d 2069 7465 6d73  mePoints = items
-0000a400: 5b6b 6579 735b 305d 5d0a 0a20 2020 2020  [keys[0]]..     
-0000a410: 2020 2020 2020 2069 6620 696e 6465 7850         if indexP
-0000a420: 726f 7669 6465 643a 0a20 2020 2020 2020  rovided:.       
-0000a430: 2020 2020 2020 2020 2023 2069 6620 6b65           # if ke
-0000a440: 7920 6973 2077 686f 6c65 2069 6d61 6765  y is whole image
-0000a450: 2061 6464 2061 6c6c 2076 616c 7565 7320   add all values 
-0000a460: 6672 6f6d 2068 6561 6465 720a 2020 2020  from header.    
-0000a470: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0000a480: 656e 286b 6579 7329 203d 3d20 323a 0a20  en(keys) == 2:. 
-0000a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4a0: 2020 2064 6566 6175 6c74 5661 6c20 3d20     defaultVal = 
-0000a4b0: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
-0000a4c0: 2020 2020 2020 2023 2061 6464 2064 6566         # add def
-0000a4d0: 6175 6c74 2066 726f 6d20 696e 6465 7820  ault from index 
-0000a4e0: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-0000a4f0: 2020 6966 206c 656e 286b 6579 7329 203e    if len(keys) >
-0000a500: 2031 2061 6e64 2069 6e64 6578 2021 3d20   1 and index != 
-0000a510: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0000a520: 2020 2020 2020 206b 6579 735f 3020 3d20         keys_0 = 
-0000a530: 636f 7079 2e64 6565 7063 6f70 7928 6b65  copy.deepcopy(ke
-0000a540: 7973 290a 2020 2020 2020 2020 2020 2020  ys).            
-0000a550: 2020 2020 2020 2020 6b65 7973 5f30 5b31          keys_0[1
-0000a560: 5d20 3d20 300a 2020 2020 2020 2020 2020  ] = 0.          
-0000a570: 2020 2020 2020 2020 2020 7265 745f 3020            ret_0 
-0000a580: 3d20 6946 444f 2e5f 5f67 6574 4974 656d  = iFDO.__getItem
-0000a590: 5661 6c75 6528 6974 656d 732c 6b65 7973  Value(items,keys
-0000a5a0: 5f30 2c73 6b69 7070 6564 496e 4865 6164  _0,skippedInHead
-0000a5b0: 6572 2c64 6566 6175 6c74 5661 6c29 0a20  er,defaultVal). 
-0000a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5d0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0000a5e0: 2872 6574 5f30 2c64 6963 7429 3a0a 2020  (ret_0,dict):.  
-0000a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a600: 2020 2020 2020 6465 6661 756c 7456 616c        defaultVal
-0000a610: 203d 207b 2a2a 6465 6661 756c 7456 616c   = {**defaultVal
-0000a620: 2c2a 2a72 6574 5f30 7d0a 2020 2020 2020  ,**ret_0}.      
-0000a630: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
-0000a640: 6946 444f 2e5f 5f67 6574 4974 656d 5661  iFDO.__getItemVa
-0000a650: 6c75 6528 6974 656d 732c 6b65 7973 2c73  lue(items,keys,s
-0000a660: 6b69 7070 6564 496e 4865 6164 6572 2c64  kippedInHeader,d
-0000a670: 6566 6175 6c74 5661 6c29 0a20 2020 2020  efaultVal).     
-0000a680: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0000a690: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000a6a0: 2020 2020 2020 2020 2020 2320 6966 206b            # if k
-0000a6b0: 6579 2069 7320 7768 6f6c 6520 696d 6167  ey is whole imag
-0000a6c0: 6520 6164 6420 616c 6c20 7661 6c75 6573  e add all values
-0000a6d0: 2066 726f 6d20 6865 6164 6572 0a20 2020   from header.   
-0000a6e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000a6f0: 6c65 6e28 6b65 7973 2920 3d3d 2031 3a0a  len(keys) == 1:.
-0000a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a710: 2020 2020 6465 6661 756c 7456 616c 203d      defaultVal =
-0000a720: 2068 6561 6465 720a 0a20 2020 2020 2020   header..       
-0000a730: 2020 2020 2020 2020 2023 2070 6963 7475           # pictu
-0000a740: 7265 202d 3e20 6a75 7374 206f 6e65 2065  re -> just one e
-0000a750: 6e74 7279 2c20 696e 7365 7274 2069 6e64  ntry, insert ind
-0000a760: 6578 2030 0a20 2020 2020 2020 2020 2020  ex 0.           
-0000a770: 2020 2020 2069 6620 6c65 6e28 696d 6167       if len(imag
-0000a780: 6549 7465 6d54 696d 6550 6f69 6e74 7329  eItemTimePoints)
-0000a790: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-0000a7a0: 2020 2020 2020 2020 2020 206b 6579 7320             keys 
-0000a7b0: 3d20 6b65 7973 5b30 3a31 5d20 2b20 5b30  = keys[0:1] + [0
-0000a7c0: 5d20 2b20 6b65 7973 5b31 3a3a 5d0a 2020  ] + keys[1::].  
-0000a7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a7e0: 2020 7265 7420 3d20 6946 444f 2e5f 5f67    ret = iFDO.__g
-0000a7f0: 6574 4974 656d 5661 6c75 6528 6974 656d  etItemValue(item
-0000a800: 732c 6b65 7973 2c73 6b69 7070 6564 496e  s,keys,skippedIn
-0000a810: 4865 6164 6572 2c64 6566 6175 6c74 5661  Header,defaultVa
-0000a820: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
-0000a830: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0000a840: 2020 2020 2020 2020 2320 7669 6465 6f20          # video 
-0000a850: 2d3e 2072 6574 7572 6e20 7661 6c75 6573  -> return values
-0000a860: 2066 6f72 2065 6163 6820 7469 6d65 2073   for each time s
-0000a870: 7461 6d70 0a20 2020 2020 2020 2020 2020  tamp.           
-0000a880: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000a890: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000a8a0: 6574 203d 207b 7d0a 2020 2020 2020 2020  et = {}.        
-0000a8b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000a8c0: 6920 696e 2072 616e 6765 286c 656e 2869  i in range(len(i
-0000a8d0: 6d61 6765 4974 656d 5469 6d65 506f 696e  mageItemTimePoin
-0000a8e0: 7473 2929 3a0a 2020 2020 2020 2020 2020  ts)):.          
-0000a8f0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-0000a900: 6d65 506f 696e 7444 6174 6120 3d20 696d  mePointData = im
-0000a910: 6167 6549 7465 6d54 696d 6550 6f69 6e74  ageItemTimePoint
-0000a920: 735b 695d 0a20 2020 2020 2020 2020 2020  s[i].           
-0000a930: 2020 2020 2020 2020 2020 2020 206b 6579               key
-0000a940: 735f 6920 3d20 6b65 7973 5b30 3a31 5d20  s_i = keys[0:1] 
-0000a950: 2b20 5b69 5d20 2b20 6b65 7973 5b31 3a3a  + [i] + keys[1::
-0000a960: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0000a970: 2020 2020 2020 2020 2020 7661 6c5f 6920            val_i 
-0000a980: 3d20 6946 444f 2e5f 5f67 6574 4974 656d  = iFDO.__getItem
-0000a990: 5661 6c75 6528 6974 656d 732c 6b65 7973  Value(items,keys
-0000a9a0: 5f69 2c73 6b69 7070 6564 496e 4865 6164  _i,skippedInHead
-0000a9b0: 6572 2c64 6566 6175 6c74 5661 6c29 0a20  er,defaultVal). 
-0000a9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a9d0: 2020 2020 2020 2023 2064 6566 6175 6c74         # default
-0000a9e0: 206f 6e6c 790a 2020 2020 2020 2020 2020   only.          
-0000a9f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000aa00: 2064 6566 6175 6c74 5f6f 6e6c 793a 0a20   default_only:. 
-0000aa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa20: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
-0000aa30: 2076 616c 5f69 0a20 2020 2020 2020 2020   val_i.         
-0000aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa50: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-0000aa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa70: 2072 6574 5b74 696d 6550 6f69 6e74 4461   ret[timePointDa
-0000aa80: 7461 5b27 696d 6167 652d 6461 7465 7469  ta['image-dateti
-0000aa90: 6d65 275d 5d20 3d20 7661 6c5f 690a 2020  me']] = val_i.  
-0000aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aab0: 2020 2020 2020 2320 7265 6d6f 7665 2069        # remove i
-0000aac0: 6d61 6765 2d64 6174 6574 696d 6520 6966  mage-datetime if
-0000aad0: 2074 6865 7265 0a20 2020 2020 2020 2020   there.         
-0000aae0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000aaf0: 6620 6973 696e 7374 616e 6365 2872 6574  f isinstance(ret
-0000ab00: 5b74 696d 6550 6f69 6e74 4461 7461 5b27  [timePointData['
-0000ab10: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
-0000ab20: 5d2c 6469 6374 2920 616e 6420 2769 6d61  ],dict) and 'ima
-0000ab30: 6765 2d64 6174 6574 696d 6527 2069 6e20  ge-datetime' in 
-0000ab40: 7265 745b 7469 6d65 506f 696e 7444 6174  ret[timePointDat
-0000ab50: 615b 2769 6d61 6765 2d64 6174 6574 696d  a['image-datetim
-0000ab60: 6527 5d5d 3a0a 2020 2020 2020 2020 2020  e']]:.          
-0000ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab80: 2020 6465 6c20 7265 745b 7469 6d65 506f    del ret[timePo
-0000ab90: 696e 7444 6174 615b 2769 6d61 6765 2d64  intData['image-d
-0000aba0: 6174 6574 696d 6527 5d5d 5b27 696d 6167  atetime']]['imag
-0000abb0: 652d 6461 7465 7469 6d65 275d 0a20 2020  e-datetime'].   
-0000abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000abd0: 2020 2020 2023 2076 6964 656f 2064 6566       # video def
-0000abe0: 6175 6c74 730a 2020 2020 2020 2020 2020  aults.          
-0000abf0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000ac00: 2069 203d 3d20 303a 0a20 2020 2020 2020   i == 0:.       
-0000ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac20: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0000ac30: 6365 2872 6574 5b74 696d 6550 6f69 6e74  ce(ret[timePoint
-0000ac40: 4461 7461 5b27 696d 6167 652d 6461 7465  Data['image-date
-0000ac50: 7469 6d65 275d 5d2c 6469 6374 293a 0a20  time']],dict):. 
-0000ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac70: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000ac80: 6566 6175 6c74 5661 6c20 3d20 7b2a 2a64  efaultVal = {**d
-0000ac90: 6566 6175 6c74 5661 6c2c 2a2a 7265 745b  efaultVal,**ret[
-0000aca0: 7469 6d65 506f 696e 7444 6174 615b 2769  timePointData['i
-0000acb0: 6d61 6765 2d64 6174 6574 696d 6527 5d5d  mage-datetime']]
-0000acc0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0000acd0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0000ace0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad00: 2020 2020 6465 6661 756c 7456 616c 203d      defaultVal =
-0000ad10: 2072 6574 5b74 696d 6550 6f69 6e74 4461   ret[timePointDa
-0000ad20: 7461 5b27 696d 6167 652d 6461 7465 7469  ta['image-dateti
-0000ad30: 6d65 275d 5d0a 0a20 2020 2020 2020 2020  me']]..         
-0000ad40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000ad50: 202b 3d20 310a 0a20 2020 2020 2020 2069   += 1..        i
-0000ad60: 6620 6973 696e 7374 616e 6365 2872 6574  f isinstance(ret
-0000ad70: 2c64 6963 7429 206f 7220 6973 696e 7374  ,dict) or isinst
-0000ad80: 616e 6365 2872 6574 2c6c 6973 7429 3a0a  ance(ret,list):.
-0000ad90: 2020 2020 2020 2020 2020 2020 7265 7420              ret 
-0000ada0: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
-0000adb0: 7265 7429 0a20 2020 2020 2020 2069 6620  ret).        if 
-0000adc0: 7265 7420 3d3d 2022 2220 6f72 2072 6574  ret == "" or ret
-0000add0: 203d 3d20 7b7d 3a0a 2020 2020 2020 2020   == {}:.        
-0000ade0: 2020 2020 7261 6973 6520 6d69 7174 632e      raise miqtc.
-0000adf0: 4966 646f 4578 6365 7074 696f 6e28 226b  IfdoException("k
-0000ae00: 6579 7320 646f 206e 6f74 2065 7869 7374  eys do not exist
-0000ae10: 3a22 202b 2073 7472 286b 6579 7329 290a  :" + str(keys)).
-0000ae20: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-0000ae30: 6574 0a0a 0a20 2020 2040 7374 6174 6963  et...    @static
-0000ae40: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
-0000ae50: 5f67 6574 4974 656d 5661 6c75 6528 6974  _getItemValue(it
-0000ae60: 656d 732c 6b65 7973 2c73 6b69 7070 6564  ems,keys,skipped
-0000ae70: 496e 4865 6164 6572 2c64 6566 6175 6c74  InHeader,default
-0000ae80: 5661 6c29 3a0a 2020 2020 2020 2020 0a20  Val):.        . 
-0000ae90: 2020 2020 2020 2023 2069 6e20 6361 7365         # in case
-0000aea0: 2069 7465 6d20 6973 206e 6f74 2061 206c   item is not a l
-0000aeb0: 6973 7420 2873 686f 756c 6420 6e6f 7420  ist (should not 
-0000aec0: 6265 2070 6f73 7369 626c 6529 0a20 2020  be possible).   
-0000aed0: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-0000aee0: 7374 616e 6365 2869 7465 6d73 5b6b 6579  stance(items[key
-0000aef0: 735b 305d 5d2c 6c69 7374 293a 0a20 2020  s[0]],list):.   
-0000af00: 2020 2020 2020 2020 2069 7465 6d73 5b6b           items[k
-0000af10: 6579 735b 305d 5d20 3d20 5b69 7465 6d73  eys[0]] = [items
-0000af20: 5b6b 6579 735b 305d 5d5d 0a0a 2020 2020  [keys[0]]]..    
-0000af30: 2020 2020 6974 656d 5661 6c75 6520 3d20      itemValue = 
-0000af40: 6669 6e64 4669 656c 6428 6974 656d 732c  findField(items,
-0000af50: 6b65 7973 290a 0a20 2020 2020 2020 2069  keys)..        i
-0000af60: 6620 6974 656d 5661 6c75 6520 3d3d 2022  f itemValue == "
-0000af70: 223a 0a20 2020 2020 2020 2020 2020 2072  ":.            r
-0000af80: 6574 203d 2064 6566 6175 6c74 5661 6c0a  et = defaultVal.
-0000af90: 2020 2020 2020 2020 2320 696e 2063 6173          # in cas
-0000afa0: 6520 6f66 2064 6963 7473 206a 6f69 6e74  e of dicts joint
-0000afb0: 2068 6561 6465 7220 616e 6420 6974 656d   header and item
-0000afc0: 2066 6965 6c64 730a 2020 2020 2020 2020   fields.        
-0000afd0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-0000afe0: 6974 656d 5661 6c75 652c 6469 6374 2920  itemValue,dict) 
-0000aff0: 616e 6420 6465 6661 756c 7456 616c 2021  and defaultVal !
-0000b000: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
-0000b010: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-0000b020: 6e63 6528 6465 6661 756c 7456 616c 2c64  nce(defaultVal,d
-0000b030: 6963 7429 3a0a 2020 2020 2020 2020 2020  ict):.          
-0000b040: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
-0000b050: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
-0000b060: 2249 7465 6d20 6669 656c 6420 6973 2064  "Item field is d
-0000b070: 6963 7420 6275 7420 6465 6661 756c 7420  ict but default 
-0000b080: 7661 6c75 6520 696e 2068 6561 6465 7220  value in header 
-0000b090: 6973 206e 6f74 3a20 2220 2b20 7374 7228  is not: " + str(
-0000b0a0: 6b65 7973 2929 0a20 2020 2020 2020 2020  keys)).         
-0000b0b0: 2020 2072 6574 203d 207b 2a2a 6465 6661     ret = {**defa
-0000b0c0: 756c 7456 616c 2c2a 2a69 7465 6d56 616c  ultVal,**itemVal
-0000b0d0: 7565 7d0a 2020 2020 2020 2020 656c 7365  ue}.        else
-0000b0e0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000b0f0: 7420 3d20 6974 656d 5661 6c75 650a 2020  t = itemValue.  
-0000b100: 2020 2020 2020 7265 7475 726e 2072 6574        return ret
-0000b110: 0a0a 0a20 2020 2064 6566 205f 5f73 7472  ...    def __str
-0000b120: 5f5f 2873 656c 6629 202d 3e20 7374 723a  __(self) -> str:
-0000b130: 0a20 2020 2020 2020 2022 2222 2050 7269  .        """ Pri
-0000b140: 6e74 7320 6375 7272 656e 7420 6946 444f  nts current iFDO
-0000b150: 2066 696c 6520 2222 220a 2020 2020 2020   file """.      
-0000b160: 2020 7265 7475 726e 2079 616d 6c2e 6475    return yaml.du
-0000b170: 6d70 2873 656c 662e 6966 646f 5f63 6865  mp(self.ifdo_che
-0000b180: 636b 6564 2c20 6465 6661 756c 745f 7374  cked, default_st
-0000b190: 796c 653d 4e6f 6e65 2c20 6465 6661 756c  yle=None, defaul
-0000b1a0: 745f 666c 6f77 5f73 7479 6c65 3d4e 6f6e  t_flow_style=Non
-0000b1b0: 652c 2061 6c6c 6f77 5f75 6e69 636f 6465  e, allow_unicode
-0000b1c0: 3d54 7275 652c 2077 6964 7468 3d66 6c6f  =True, width=flo
-0000b1d0: 6174 2822 696e 6622 2929 0a0a 0a20 2020  at("inf"))...   
-0000b1e0: 2064 6566 205f 5f67 6574 6974 656d 5f5f   def __getitem__
-0000b1f0: 2873 656c 662c 206b 6579 7329 3a0a 2020  (self, keys):.  
-0000b200: 2020 2020 2020 2222 2220 5265 7475 726e        """ Return
-0000b210: 7320 636f 7079 206f 6620 6368 6563 6b65  s copy of checke
-0000b220: 6420 6966 646f 2073 6574 206f 7220 6974  d ifdo set or it
-0000b230: 656d 2066 6965 6c64 2076 616c 7565 2c20  em field value, 
-0000b240: 616c 736f 2063 6f6e 7369 6465 726e 6720  also considerng 
-0000b250: 6465 6661 756c 7420 7661 6c75 6573 2066  default values f
-0000b260: 726f 6d20 6865 6164 6572 2e0a 2020 2020  rom header..    
-0000b270: 2020 2020 2020 2020 5573 6520 6b65 7973          Use keys
-0000b280: 2061 7320 652e 672e 2027 3c69 7465 6d3e   as e.g. '<item>
-0000b290: 3a3c 6b65 793e 3a2e 2e2e 272e 2043 616e  :<key>:...'. Can
-0000b2a0: 2062 6520 7573 6564 2066 6f72 2068 6561   be used for hea
-0000b2b0: 6465 7220 6669 656c 6473 2061 7320 7765  der fields as we
-0000b2c0: 6c6c 2061 7320 6974 656d 2066 6965 6c64  ll as item field
-0000b2d0: 732e 0a20 2020 2020 2020 2020 2020 2049  s..            I
-0000b2e0: 7465 6d20 696e 6465 7820 6361 6e20 6265  tem index can be
-0000b2f0: 206c 6567 6c65 6374 6564 2c20 696e 2063   leglected, in c
-0000b300: 6173 6520 6f66 2076 6964 656f 2061 2064  ase of video a d
-0000b310: 6963 7420 7b3c 696d 6167 652d 6461 7461  ict {<image-data
-0000b320: 7469 6d65 3e3a 3c76 616c 7565 3e2c 2e2e  time>:<value>,..
-0000b330: 2e7d 2069 7320 7265 7475 726e 6564 2e0a  .} is returned..
-0000b340: 2020 2020 2020 2020 2020 2020 5261 6973              Rais
-0000b350: 6573 2049 6664 6f45 7863 6570 7469 6f6e  es IfdoException
-0000b360: 2069 6620 6974 656d 2064 6f65 7320 6e6f   if item does no
-0000b370: 7420 6578 6973 742e 2022 2222 0a20 2020  t exist. """.   
-0000b380: 2020 2020 206b 6579 7320 3d20 6b65 7973       keys = keys
-0000b390: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
-0000b3a0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000b3b0: 5f5f 6765 7446 6965 6c64 5661 6c75 6528  __getFieldValue(
-0000b3c0: 7365 6c66 2e69 6664 6f5f 6368 6563 6b65  self.ifdo_checke
-0000b3d0: 642c 6b65 7973 290a 0a0a 2020 2020 6465  d,keys)...    de
-0000b3e0: 6620 6669 6e64 546d 7046 6965 6c64 2873  f findTmpField(s
-0000b3f0: 656c 662c 6b65 7973 293a 0a20 2020 2020  elf,keys):.     
-0000b400: 2020 2022 2222 2052 6574 7572 6e73 2063     """ Returns c
-0000b410: 6f70 7920 6f66 2074 656d 706f 7261 7279  opy of temporary
-0000b420: 2075 6e63 6865 636b 6564 2069 6664 6f20   unchecked ifdo 
-0000b430: 7365 7420 6f72 2069 7465 6d20 6669 656c  set or item fiel
-0000b440: 6420 7661 6c75 652c 2061 6c73 6f20 636f  d value, also co
-0000b450: 6e73 6964 6572 6e67 2064 6566 6175 6c74  nsiderng default
-0000b460: 2076 616c 7565 7320 6672 6f6d 2068 6561   values from hea
-0000b470: 6465 722e 0a20 2020 2020 2020 2020 2020  der..           
-0000b480: 2055 7365 206b 6579 7320 6173 2065 2e67   Use keys as e.g
-0000b490: 2e20 273c 6974 656d 3e3a 3c6b 6579 3e3a  . '<item>:<key>:
-0000b4a0: 2e2e 2e27 2e20 4361 6e20 6265 2075 7365  ...'. Can be use
-0000b4b0: 6420 666f 7220 6865 6164 6572 2066 6965  d for header fie
-0000b4c0: 6c64 7320 6173 2077 656c 6c20 6173 2069  lds as well as i
-0000b4d0: 7465 6d20 6669 656c 6473 2e0a 2020 2020  tem fields..    
-0000b4e0: 2020 2020 2020 2020 4974 656d 2069 6e64          Item ind
-0000b4f0: 6578 2063 616e 2062 6520 6c65 676c 6563  ex can be leglec
-0000b500: 7465 642c 2069 6e20 6361 7365 206f 6620  ted, in case of 
-0000b510: 7669 6465 6f20 6120 6469 6374 207b 3c69  video a dict {<i
-0000b520: 6d61 6765 2d64 6174 6174 696d 653e 3a3c  mage-datatime>:<
-0000b530: 7661 6c75 653e 2c2e 2e2e 7d20 6973 2072  value>,...} is r
-0000b540: 6574 7572 6e65 642e 0a20 2020 2020 2020  eturned..       
-0000b550: 2020 2020 2052 6169 7365 7320 4966 646f       Raises Ifdo
-0000b560: 4578 6365 7074 696f 6e20 6966 2069 7465  Exception if ite
-0000b570: 6d20 646f 6573 206e 6f74 2065 7869 7374  m does not exist
-0000b580: 2e20 2222 220a 2020 2020 2020 2020 6b65  . """.        ke
-0000b590: 7973 203d 206b 6579 732e 7370 6c69 7428  ys = keys.split(
-0000b5a0: 273a 2729 0a20 2020 2020 2020 2072 6574  ':').        ret
-0000b5b0: 7572 6e20 7365 6c66 2e5f 5f67 6574 4669  urn self.__getFi
-0000b5c0: 656c 6456 616c 7565 2873 656c 662e 6966  eldValue(self.if
-0000b5d0: 646f 5f74 6d70 2c6b 6579 7329 0a20 2020  do_tmp,keys).   
-0000b5e0: 200a 0a20 2020 2064 6566 2066 696e 6454   ..    def findT
-0000b5f0: 6d70 4669 656c 6432 2873 656c 662c 6b65  mpField2(self,ke
-0000b600: 7973 293a 0a20 2020 2020 2020 2022 2222  ys):.        """
-0000b610: 2052 6574 7572 6e73 2063 6f70 7920 6f66   Returns copy of
-0000b620: 2074 656d 706f 7261 7279 2075 6e63 6865   temporary unche
-0000b630: 636b 6564 2069 6664 6f20 7365 7420 6f72  cked ifdo set or
-0000b640: 2069 7465 6d20 6669 656c 6420 7661 6c75   item field valu
-0000b650: 652c 2061 6c73 6f20 636f 6e73 6964 6572  e, also consider
-0000b660: 6e67 2064 6566 6175 6c74 2076 616c 7565  ng default value
-0000b670: 7320 6672 6f6d 2068 6561 6465 722e 0a20  s from header.. 
-0000b680: 2020 2020 2020 2020 2020 2055 7365 206b             Use k
-0000b690: 6579 7320 6173 2065 2e67 2e20 273c 6974  eys as e.g. '<it
-0000b6a0: 656d 3e3a 3c6b 6579 3e3a 2e2e 2e27 2e20  em>:<key>:...'. 
-0000b6b0: 4361 6e20 6265 2075 7365 6420 666f 7220  Can be used for 
-0000b6c0: 6865 6164 6572 2066 6965 6c64 7320 6173  header fields as
-0000b6d0: 2077 656c 6c20 6173 2069 7465 6d20 6669   well as item fi
-0000b6e0: 656c 6473 2e0a 2020 2020 2020 2020 2020  elds..          
-0000b6f0: 2020 4974 656d 2069 6e64 6578 2063 616e    Item index can
-0000b700: 2062 6520 6c65 676c 6563 7465 642c 2069   be leglected, i
-0000b710: 6e20 6361 7365 206f 6620 7669 6465 6f20  n case of video 
-0000b720: 6120 6469 6374 207b 3c69 6d61 6765 2d64  a dict {<image-d
-0000b730: 6174 6174 696d 653e 3a3c 7661 6c75 653e  atatime>:<value>
-0000b740: 2c2e 2e2e 7d20 6973 2072 6574 7572 6e65  ,...} is returne
-0000b750: 642e 0a20 2020 2020 2020 2020 2020 2052  d..            R
-0000b760: 6574 7572 6e73 2065 6d70 7479 2073 7472  eturns empty str
-0000b770: 696e 6720 6966 2069 7465 6d20 646f 6573  ing if item does
-0000b780: 206e 6f74 2065 7869 7374 2e20 2222 220a   not exist. """.
-0000b790: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-0000b7a0: 4644 4f2e 6669 6e64 5f66 6965 6c64 5f73  FDO.find_field_s
-0000b7b0: 7472 2873 656c 662e 6966 646f 5f74 6d70  tr(self.ifdo_tmp
-0000b7c0: 2c6b 6579 7329 0a20 2020 200a 0a20 2020  ,keys).    ..   
-0000b7d0: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
-0000b7e0: 2020 2064 6566 2066 696e 645f 6669 656c     def find_fiel
-0000b7f0: 645f 7374 7228 6966 646f 3a64 6963 742c  d_str(ifdo:dict,
-0000b800: 6b65 7973 293a 0a20 2020 2020 2020 2022  keys):.        "
-0000b810: 2222 2052 6574 7572 6e73 2063 6f70 7920  "" Returns copy 
-0000b820: 6f66 2069 6664 6f20 7365 7420 6f72 2069  of ifdo set or i
-0000b830: 7465 6d20 6669 656c 6420 7661 6c75 652c  tem field value,
-0000b840: 2061 6c73 6f20 636f 6e73 6964 6572 6e67   also considerng
-0000b850: 2064 6566 6175 6c74 2076 616c 7565 7320   default values 
-0000b860: 6672 6f6d 2068 6561 6465 722e 0a20 2020  from header..   
-0000b870: 2020 2020 2020 2020 2055 7365 206b 6579           Use key
-0000b880: 7320 6173 2065 2e67 2e20 273c 6974 656d  s as e.g. '<item
-0000b890: 3e3a 3c6b 6579 3e3a 2e2e 2e27 2e20 4361  >:<key>:...'. Ca
-0000b8a0: 6e20 6265 2075 7365 6420 666f 7220 6865  n be used for he
-0000b8b0: 6164 6572 2066 6965 6c64 7320 6173 2077  ader fields as w
-0000b8c0: 656c 6c20 6173 2069 7465 6d20 6669 656c  ell as item fiel
-0000b8d0: 6473 2e0a 2020 2020 2020 2020 2020 2020  ds..            
-0000b8e0: 4974 656d 2069 6e64 6578 2063 616e 2062  Item index can b
-0000b8f0: 6520 6c65 676c 6563 7465 642c 2069 6e20  e leglected, in 
-0000b900: 6361 7365 206f 6620 7669 6465 6f20 6120  case of video a 
-0000b910: 6469 6374 207b 3c69 6d61 6765 2d64 6174  dict {<image-dat
-0000b920: 6174 696d 653e 3a3c 7661 6c75 653e 2c2e  atime>:<value>,.
-0000b930: 2e2e 7d20 6973 2072 6574 7572 6e65 642e  ..} is returned.
-0000b940: 0a20 2020 2020 2020 2020 2020 2052 6574  .            Ret
-0000b950: 7572 6e73 2065 6d70 7479 2073 7472 696e  urns empty strin
-0000b960: 6720 6966 2069 7465 6d20 646f 6573 206e  g if item does n
-0000b970: 6f74 2065 7869 7374 2e20 2222 220a 2020  ot exist. """.  
-0000b980: 2020 2020 2020 6b65 7973 203d 206b 6579        keys = key
-0000b990: 732e 7370 6c69 7428 273a 2729 0a20 2020  s.split(':').   
-0000b9a0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0000b9b0: 2020 2020 2020 7265 7420 3d20 6946 444f        ret = iFDO
-0000b9c0: 2e5f 5f67 6574 4669 656c 6456 616c 7565  .__getFieldValue
-0000b9d0: 2869 6664 6f2c 6b65 7973 290a 2020 2020  (ifdo,keys).    
-0000b9e0: 2020 2020 6578 6365 7074 206d 6971 7463      except miqtc
-0000b9f0: 2e49 6664 6f45 7863 6570 7469 6f6e 2061  .IfdoException a
-0000ba00: 7320 6578 3a0a 2020 2020 2020 2020 2020  s ex:.          
-0000ba10: 2020 7265 7420 3d20 2222 0a20 2020 2020    ret = "".     
-0000ba20: 2020 2072 6574 7572 6e20 7265 740a 0a0a     return ret...
-0000ba30: 2020 2020 6465 6620 7365 7469 4644 4f48      def setiFDOH
-0000ba40: 6561 6465 7246 6965 6c64 7328 7365 6c66  eaderFields(self
-0000ba50: 2c20 6865 6164 6572 3a20 6469 6374 293a  , header: dict):
-0000ba60: 0a20 2020 2020 2020 2022 2222 2044 6570  .        """ Dep
-0000ba70: 7265 6361 7465 6420 2d20 7573 6520 7365  recated - use se
-0000ba80: 745f 6966 646f 5f68 6561 6465 725f 6669  t_ifdo_header_fi
-0000ba90: 656c 6473 2022 2222 0a20 2020 2020 2020  elds """.       
-0000baa0: 2073 656c 662e 7365 745f 6966 646f 5f68   self.set_ifdo_h
-0000bab0: 6561 6465 725f 6669 656c 6473 2868 6561  eader_fields(hea
-0000bac0: 6465 7229 0a0a 0a20 2020 2064 6566 2073  der)...    def s
-0000bad0: 6574 5f69 6664 6f5f 6865 6164 6572 5f66  et_ifdo_header_f
-0000bae0: 6965 6c64 7328 7365 6c66 2c20 6865 6164  ields(self, head
-0000baf0: 6572 3a20 6469 6374 293a 0a20 2020 2020  er: dict):.     
-0000bb00: 2020 2022 2222 2043 6c65 6172 7320 6375     """ Clears cu
-0000bb10: 7272 656e 7420 6865 6164 6572 2066 6965  rrent header fie
-0000bb20: 6c64 7320 756e 6420 7365 7473 2070 726f  lds und sets pro
-0000bb30: 7669 6465 6420 6669 656c 6420 7661 6c75  vided field valu
-0000bb40: 6573 2e20 466f 7220 7570 6461 7469 6e67  es. For updating
-0000bb50: 2065 7869 7374 696e 6720 6f6e 6573 2075   existing ones u
-0000bb60: 7365 2075 7064 6174 655f 6966 646f 5f68  se update_ifdo_h
-0000bb70: 6561 6465 725f 6669 656c 6473 2829 2022  eader_fields() "
-0000bb80: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-0000bb90: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-0000bba0: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-0000bbb0: 203d 207b 7d0a 2020 2020 2020 2020 6966   = {}.        if
-0000bbc0: 2073 656c 662e 696d 6167 6553 6574 4865   self.imageSetHe
-0000bbd0: 6164 6572 4b65 7920 696e 2068 6561 6465  aderKey in heade
-0000bbe0: 723a 0a20 2020 2020 2020 2020 2020 2068  r:.            h
-0000bbf0: 6561 6465 7220 3d20 6865 6164 6572 5b73  eader = header[s
-0000bc00: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000bc10: 6572 4b65 795d 0a20 2020 2020 2020 2066  erKey].        f
-0000bc20: 6f72 2066 6965 6c64 2069 6e20 6865 6164  or field in head
-0000bc30: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-0000bc40: 2369 6620 6669 656c 6420 6e6f 7420 696e  #if field not in
-0000bc50: 206d 6971 7476 2e69 6664 6f5f 6865 6164   miqtv.ifdo_head
-0000bc60: 6572 5f63 6f72 655f 6669 656c 6473 3a0a  er_core_fields:.
-0000bc70: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-0000bc80: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-0000bc90: 4361 7574 696f 6e21 2055 6e6b 6e6f 776e  Caution! Unknown
-0000bca0: 2068 6561 6465 7220 6669 656c 6420 5c22   header field \"
-0000bcb0: 2220 2b20 6669 656c 6420 2b20 225c 222e  " + field + "\".
-0000bcc0: 204d 6179 6265 2061 2074 7970 6f3f 204f   Maybe a typo? O
-0000bcd0: 7468 6572 7769 7365 2069 676e 6f72 6520  therwise ignore 
-0000bce0: 6d65 2e22 290a 2020 2020 2020 2020 2020  me.").          
-0000bcf0: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
-0000bd00: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000bd10: 6465 724b 6579 5d5b 6669 656c 645d 203d  derKey][field] =
-0000bd20: 2068 6561 6465 725b 6669 656c 645d 0a0a   header[field]..
-0000bd30: 0a20 2020 2064 6566 2075 7064 6174 655f  .    def update_
-0000bd40: 6966 646f 5f68 6561 6465 725f 6669 656c  ifdo_header_fiel
-0000bd50: 6473 2873 656c 662c 2068 6561 6465 723a  ds(self, header:
-0000bd60: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
-0000bd70: 2222 2220 5570 6461 7465 7320 6578 6973  """ Updates exis
-0000bd80: 7469 6e67 2068 6561 6465 7220 6669 656c  ting header fiel
-0000bd90: 6473 2022 2222 0a20 2020 2020 2020 2069  ds """.        i
-0000bda0: 6620 7365 6c66 2e69 6d61 6765 5365 7448  f self.imageSetH
-0000bdb0: 6561 6465 724b 6579 2069 6e20 6865 6164  eaderKey in head
-0000bdc0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-0000bdd0: 6865 6164 6572 203d 2068 6561 6465 725b  header = header[
-0000bde0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000bdf0: 6465 724b 6579 5d0a 2020 2020 2020 2020  derKey].        
-0000be00: 6c6f 6720 3d20 6d69 7174 632e 7265 6375  log = miqtc.recu
-0000be10: 7273 6976 656c 7955 7064 6174 6544 6963  rsivelyUpdateDic
-0000be20: 7473 2873 656c 662e 6966 646f 5f74 6d70  ts(self.ifdo_tmp
-0000be30: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000be40: 6164 6572 4b65 795d 2c20 6865 6164 6572  aderKey], header
-0000be50: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
-0000be60: 726f 762e 6c6f 6728 6c6f 672c 646f 6e74  rov.log(log,dont
-0000be70: 5368 6f77 3d54 7275 6529 0a0a 2020 2020  Show=True)..    
-0000be80: 6465 6620 7570 6461 7465 6946 444f 4865  def updateiFDOHe
-0000be90: 6164 6572 4669 656c 6473 2873 656c 662c  aderFields(self,
-0000bea0: 2068 6561 6465 723a 2064 6963 7429 3a0a   header: dict):.
-0000beb0: 2020 2020 2020 2020 2222 2220 4465 7072          """ Depr
-0000bec0: 6563 6174 6564 202d 2075 7365 2075 7064  ecated - use upd
-0000bed0: 6174 655f 6966 646f 5f68 6561 6465 725f  ate_ifdo_header_
-0000bee0: 6669 656c 6473 2022 2222 0a20 2020 2020  fields """.     
-0000bef0: 2020 2073 656c 662e 7570 6461 7465 5f69     self.update_i
-0000bf00: 6664 6f5f 6865 6164 6572 5f66 6965 6c64  fdo_header_field
-0000bf10: 7328 6865 6164 6572 290a 0a0a 2020 2020  s(header)...    
-0000bf20: 6465 6620 5f74 7279 5f75 7067 7261 6465  def _try_upgrade
-0000bf30: 5f74 6f5f 6966 646f 5f76 6572 7369 6f6e  _to_ifdo_version
-0000bf40: 5f32 7828 7365 6c66 293a 0a20 2020 2020  _2x(self):.     
-0000bf50: 2020 2022 2222 2054 7279 2074 6f20 636f     """ Try to co
-0000bf60: 6e76 6572 7420 6669 656c 6473 2066 726f  nvert fields fro
-0000bf70: 6d20 6946 444f 2076 6572 7369 6f6e 203c  m iFDO version <
-0000bf80: 2032 2e30 2e30 2074 6f20 322e 7820 2222   2.0.0 to 2.x ""
-0000bf90: 220a 2020 2020 2020 2020 7265 6164 5f76  ".        read_v
-0000bfa0: 6572 7369 6f6e 5f73 7472 203d 2022 7631  ersion_str = "v1
-0000bfb0: 2e30 2e30 2220 2320 6469 6420 6e6f 7420  .0.0" # did not 
-0000bfc0: 6861 7665 2074 6865 2027 696d 6167 652d  have the 'image-
-0000bfd0: 7365 742d 6966 646f 2d76 6572 7369 6f6e  set-ifdo-version
-0000bfe0: 2720 6669 656c 6420 7965 740a 2020 2020  ' field yet.    
-0000bff0: 2020 2020 7472 793a 200a 2020 2020 2020      try: .      
-0000c000: 2020 2020 2020 7265 6164 5f76 6572 7369        read_versi
-0000c010: 6f6e 5f73 7472 203d 2073 656c 662e 6669  on_str = self.fi
-0000c020: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
-0000c030: 652d 7365 742d 6966 646f 2d76 6572 7369  e-set-ifdo-versi
-0000c040: 6f6e 2729 0a20 2020 2020 2020 2065 7863  on').        exc
-0000c050: 6570 7420 6d69 7174 632e 4966 646f 4578  ept miqtc.IfdoEx
-0000c060: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-0000c070: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-0000c080: 2020 7265 6164 5f76 6572 7369 6f6e 203d    read_version =
-0000c090: 2056 6572 7369 6f6e 2872 6561 645f 7665   Version(read_ve
-0000c0a0: 7273 696f 6e5f 7374 7229 0a0a 2020 2020  rsion_str)..    
-0000c0b0: 2020 2020 6966 2072 6561 645f 7665 7273      if read_vers
-0000c0c0: 696f 6e20 3c20 5665 7273 696f 6e28 2232  ion < Version("2
-0000c0d0: 2e30 2e30 2229 3a0a 2020 2020 2020 2020  .0.0"):.        
-0000c0e0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0000c0f0: 2023 206e 6577 2055 5249 206f 626a 6563   # new URI objec
-0000c100: 7420 6669 656c 6473 0a20 2020 2020 2020  t fields.       
-0000c110: 2020 2020 206e 6577 5f75 7269 5f66 6965       new_uri_fie
-0000c120: 6c64 7320 3d20 5b27 696d 6167 652d 7365  lds = ['image-se
-0000c130: 6e73 6f72 272c 2769 6d61 6765 2d65 7665  nsor','image-eve
-0000c140: 6e74 272c 2769 6d61 6765 2d70 726f 6a65  nt','image-proje
-0000c150: 6374 272c 2769 6d61 6765 2d63 6f6e 7465  ct','image-conte
-0000c160: 7874 272c 2769 6d61 6765 2d6c 6963 656e  xt','image-licen
-0000c170: 7365 272c 2769 6d61 6765 2d70 6c61 7466  se','image-platf
-0000c180: 6f72 6d27 5d0a 2020 2020 2020 2020 2020  orm'].          
-0000c190: 2020 666f 7220 7572 695f 6669 656c 6420    for uri_field 
-0000c1a0: 696e 206e 6577 5f75 7269 5f66 6965 6c64  in new_uri_field
-0000c1b0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000c1c0: 2020 206f 6c64 5f73 7472 5f76 616c 203d     old_str_val =
-0000c1d0: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
-0000c1e0: 6c64 3228 7572 695f 6669 656c 6429 0a20  ld2(uri_field). 
-0000c1f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000c200: 6620 6973 696e 7374 616e 6365 286f 6c64  f isinstance(old
-0000c210: 5f73 7472 5f76 616c 2c73 7472 2920 616e  _str_val,str) an
-0000c220: 6420 6f6c 645f 7374 725f 7661 6c20 213d  d old_str_val !=
-0000c230: 2022 223a 2020 2020 2020 2020 2020 2020   "":            
-0000c240: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0000c250: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0000c260: 5f6f 626a 5f76 616c 203d 207b 276e 616d  _obj_val = {'nam
-0000c270: 6527 3a20 6f6c 645f 7374 725f 7661 6c7d  e': old_str_val}
-0000c280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c290: 2020 2020 2069 735f 7572 692c 206d 7367       is_uri, msg
-0000c2a0: 203d 206d 6971 7474 2e76 616c 6964 6174   = miqtt.validat
-0000c2b0: 655f 6167 6169 6e73 745f 7363 6865 6d61  e_against_schema
-0000c2c0: 286f 6c64 5f73 7472 5f76 616c 2c7b 2274  (old_str_val,{"t
-0000c2d0: 7970 6522 3a20 2273 7472 696e 6722 2c22  ype": "string","
-0000c2e0: 666f 726d 6174 223a 2022 7572 6922 7d29  format": "uri"})
-0000c2f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c300: 2020 2020 2069 6620 6973 5f75 7269 3a0a       if is_uri:.
-0000c310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c320: 2020 2020 2020 2020 6e65 775f 6f62 6a5f          new_obj_
-0000c330: 7661 6c5b 2775 7269 275d 203d 206f 6c64  val['uri'] = old
-0000c340: 5f73 7472 5f76 616c 0a20 2020 2020 2020  _str_val.       
-0000c350: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000c360: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000c370: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000c380: 795d 5b75 7269 5f66 6965 6c64 5d20 3d20  y][uri_field] = 
-0000c390: 6e65 775f 6f62 6a5f 7661 6c0a 2020 2020  new_obj_val.    
-0000c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3b0: 7365 6c66 2e70 726f 762e 6c6f 6728 2241  self.prov.log("A
-0000c3c0: 7574 6f2d 7570 6772 6164 6564 2022 202b  uto-upgraded " +
-0000c3d0: 2075 7269 5f66 6965 6c64 202b 2022 2066   uri_field + " f
-0000c3e0: 726f 6d20 2220 2b20 6f6c 645f 7374 725f  rom " + old_str_
-0000c3f0: 7661 6c20 2b20 2220 746f 2022 202b 2073  val + " to " + s
-0000c400: 7472 286e 6577 5f6f 626a 5f76 616c 2929  tr(new_obj_val))
-0000c410: 0a0a 0a0a 2020 2020 6465 6620 7472 7941  ....    def tryA
-0000c420: 7574 6f53 6574 4865 6164 6572 4669 656c  utoSetHeaderFiel
-0000c430: 6473 2873 656c 6629 3a0a 2020 2020 2020  ds(self):.      
-0000c440: 2020 2222 2220 5365 7473 2063 6572 7461    """ Sets certa
-0000c450: 696e 2068 6561 6465 7220 6669 656c 6473  in header fields
-0000c460: 2065 2e67 2e20 6672 6f6d 2064 6972 6563   e.g. from direc
-0000c470: 746f 7279 2069 6620 7468 6579 2061 7265  tory if they are
-0000c480: 206e 6f74 2073 6574 2079 6574 2022 2222   not set yet """
-0000c490: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0000c4a0: 662e 6669 6e64 546d 7046 6965 6c64 3228  f.findTmpField2(
-0000c4b0: 2769 6d61 6765 2d73 656e 736f 7227 2920  'image-sensor') 
-0000c4c0: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
-0000c4d0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0000c4e0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000c4f0: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
-0000c500: 7365 6e73 6f72 275d 203d 207b 276e 616d  sensor'] = {'nam
-0000c510: 6527 3a20 7365 6c66 2e64 6972 2e73 656e  e': self.dir.sen
-0000c520: 736f 7228 297d 0a20 2020 2020 2020 2065  sor()}.        e
-0000c530: 6c69 6620 7365 6c66 2e66 696e 6454 6d70  lif self.findTmp
-0000c540: 4669 656c 6428 2769 6d61 6765 2d73 656e  Field('image-sen
-0000c550: 736f 7227 295b 276e 616d 6527 5d20 213d  sor')['name'] !=
-0000c560: 2073 656c 662e 6469 722e 7365 6e73 6f72   self.dir.sensor
-0000c570: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0000c580: 7365 6c66 2e70 726f 762e 6c6f 6728 2243  self.prov.log("C
-0000c590: 6175 7469 6f6e 2120 2769 6d61 6765 2d73  aution! 'image-s
-0000c5a0: 656e 736f 7227 2022 2b20 7374 7228 7365  ensor' "+ str(se
-0000c5b0: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
-0000c5c0: 2769 6d61 6765 2d73 656e 736f 7227 2929  'image-sensor'))
-0000c5d0: 202b 2022 2064 6966 6665 7273 2066 726f   + " differs fro
-0000c5e0: 6d20 7365 6e73 6f72 2070 6172 7365 6420  m sensor parsed 
-0000c5f0: 6672 6f6d 2064 6972 6563 746f 7279 3a20  from directory: 
-0000c600: 2220 2b20 7365 6c66 2e64 6972 2e73 656e  " + self.dir.sen
-0000c610: 736f 7228 2929 0a0a 2020 2020 2020 2020  sor())..        
-0000c620: 6966 2073 656c 662e 6669 6e64 546d 7046  if self.findTmpF
-0000c630: 6965 6c64 3228 2769 6d61 6765 2d65 7665  ield2('image-eve
-0000c640: 6e74 2729 203d 3d20 2222 3a0a 2020 2020  nt') == "":.    
-0000c650: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-0000c660: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000c670: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
-0000c680: 6d61 6765 2d65 7665 6e74 275d 203d 207b  mage-event'] = {
-0000c690: 276e 616d 6527 3a20 7365 6c66 2e64 6972  'name': self.dir
-0000c6a0: 2e65 7665 6e74 2829 7d0a 2020 2020 2020  .event()}.      
-0000c6b0: 2020 656c 6966 2073 656c 662e 6669 6e64    elif self.find
-0000c6c0: 546d 7046 6965 6c64 2827 696d 6167 652d  TmpField('image-
-0000c6d0: 6576 656e 7427 295b 276e 616d 6527 5d20  event')['name'] 
-0000c6e0: 213d 2073 656c 662e 6469 722e 6576 656e  != self.dir.even
-0000c6f0: 7428 293a 0a20 2020 2020 2020 2020 2020  t():.           
-0000c700: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-0000c710: 4361 7574 696f 6e21 2027 696d 6167 652d  Caution! 'image-
-0000c720: 6576 656e 7427 2022 202b 2073 7472 2873  event' " + str(s
-0000c730: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
-0000c740: 2827 696d 6167 652d 6576 656e 7427 2929  ('image-event'))
-0000c750: 202b 2022 2064 6966 6665 7273 2066 726f   + " differs fro
-0000c760: 6d20 6576 656e 7420 7061 7273 6564 2066  m event parsed f
-0000c770: 726f 6d20 6469 7265 6374 6f72 793a 2022  rom directory: "
-0000c780: 202b 2073 656c 662e 6469 722e 6576 656e   + self.dir.even
-0000c790: 7428 2929 0a0a 2020 2020 2020 2020 6966  t())..        if
-0000c7a0: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
-0000c7b0: 6c64 3228 2769 6d61 6765 2d70 726f 6a65  ld2('image-proje
-0000c7c0: 6374 2729 203d 3d20 2222 3a0a 2020 2020  ct') == "":.    
-0000c7d0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-0000c7e0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000c7f0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
-0000c800: 6d61 6765 2d70 726f 6a65 6374 275d 203d  mage-project'] =
-0000c810: 2020 7b27 6e61 6d65 273a 2073 656c 662e    {'name': self.
-0000c820: 6469 722e 7072 6f6a 6563 7428 297d 0a20  dir.project()}. 
-0000c830: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-0000c840: 2e66 696e 6454 6d70 4669 656c 6428 2769  .findTmpField('i
-0000c850: 6d61 6765 2d70 726f 6a65 6374 2729 5b27  mage-project')['
-0000c860: 6e61 6d65 275d 2021 3d20 7365 6c66 2e64  name'] != self.d
-0000c870: 6972 2e70 726f 6a65 6374 2829 3a0a 2020  ir.project():.  
-0000c880: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0000c890: 726f 762e 6c6f 6728 2243 6175 7469 6f6e  rov.log("Caution
-0000c8a0: 2120 2769 6d61 6765 2d70 726f 6a65 6374  ! 'image-project
-0000c8b0: 2720 2220 2b20 7374 7228 7365 6c66 2e66  ' " + str(self.f
-0000c8c0: 696e 6454 6d70 4669 656c 6428 2769 6d61  indTmpField('ima
-0000c8d0: 6765 2d70 726f 6a65 6374 2729 2920 2b20  ge-project')) + 
-0000c8e0: 2220 6469 6666 6572 7320 6672 6f6d 2070  " differs from p
-0000c8f0: 726f 6a65 6374 2070 6172 7365 6420 6672  roject parsed fr
-0000c900: 6f6d 2064 6972 6563 746f 7279 3a20 2220  om directory: " 
-0000c910: 2b20 7365 6c66 2e64 6972 2e70 726f 6a65  + self.dir.proje
-0000c920: 6374 2829 290a 0a20 2020 2020 2020 2069  ct())..        i
-0000c930: 6620 7365 6c66 2e66 696e 6454 6d70 4669  f self.findTmpFi
-0000c940: 656c 6432 2827 696d 6167 652d 706c 6174  eld2('image-plat
-0000c950: 666f 726d 2729 203d 3d20 2222 2061 6e64  form') == "" and
-0000c960: 2073 656c 662e 6469 722e 6765 6172 2829   self.dir.gear()
-0000c970: 2021 3d20 2222 3a0a 2020 2020 2020 2020   != "":.        
-0000c980: 2020 2020 7365 6c66 2e69 6664 6f5f 746d      self.ifdo_tm
-0000c990: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
-0000c9a0: 6561 6465 724b 6579 5d5b 2769 6d61 6765  eaderKey]['image
-0000c9b0: 2d70 6c61 7466 6f72 6d27 5d20 3d20 7b27  -platform'] = {'
-0000c9c0: 6e61 6d65 273a 2073 656c 662e 6469 722e  name': self.dir.
-0000c9d0: 6765 6172 2829 7d0a 0a20 2020 2020 2020  gear()}..       
-0000c9e0: 2069 6620 6e6f 7420 2769 6d61 6765 2d73   if not 'image-s
-0000c9f0: 6574 2d75 7569 6427 2069 6e20 7365 6c66  et-uuid' in self
-0000ca00: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-0000ca10: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000ca20: 5d3a 0a20 2020 2020 2020 2020 2020 2073  ]:.            s
-0000ca30: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0000ca40: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-0000ca50: 4b65 795d 5b27 696d 6167 652d 7365 742d  Key]['image-set-
-0000ca60: 7575 6964 275d 203d 2073 7472 286d 6971  uuid'] = str(miq
-0000ca70: 7463 2e75 7569 6434 2829 290a 2020 2020  tc.uuid4()).    
-0000ca80: 2020 2020 6966 206e 6f74 2027 696d 6167      if not 'imag
-0000ca90: 652d 7365 742d 6861 6e64 6c65 2720 696e  e-set-handle' in
-0000caa0: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-0000cab0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000cac0: 6572 4b65 795d 3a0a 2020 2020 2020 2020  erKey]:.        
-0000cad0: 2020 2020 7365 6c66 2e69 6664 6f5f 746d      self.ifdo_tm
-0000cae0: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
-0000caf0: 6561 6465 724b 6579 5d5b 2769 6d61 6765  eaderKey]['image
-0000cb00: 2d73 6574 2d68 616e 646c 6527 5d20 3d20  -set-handle'] = 
-0000cb10: 7365 6c66 2e68 616e 646c 655f 7072 6566  self.handle_pref
-0000cb20: 6978 202b 2022 2f22 202b 2073 656c 662e  ix + "/" + self.
-0000cb30: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
-0000cb40: 6167 652d 7365 742d 7575 6964 2729 0a20  age-set-uuid'). 
-0000cb50: 2020 2020 2020 2069 6620 6e6f 7420 2769         if not 'i
-0000cb60: 6d61 6765 2d73 6574 2d6e 616d 6527 2069  mage-set-name' i
-0000cb70: 6e20 7365 6c66 2e69 6664 6f5f 746d 705b  n self.ifdo_tmp[
-0000cb80: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000cb90: 6465 724b 6579 5d20 6f72 2073 656c 662e  derKey] or self.
-0000cba0: 6669 6e64 546d 7046 6965 6c64 3228 2769  findTmpField2('i
-0000cbb0: 6d61 6765 2d73 6574 2d6e 616d 6527 2920  mage-set-name') 
-0000cbc0: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
-0000cbd0: 2020 2023 2063 6f6e 7374 7275 6374 2061     # construct a
-0000cbe0: 7320 3c70 726f 6a65 6374 3e5f 3c65 7665  s <project>_<eve
-0000cbf0: 6e74 3e5f 3c73 656e 736f 723e 0a20 2020  nt>_<sensor>.   
-0000cc00: 2020 2020 2020 2020 2070 726f 6a65 6374           project
-0000cc10: 5f20 3d20 7365 6c66 2e66 696e 6454 6d70  _ = self.findTmp
-0000cc20: 4669 656c 6432 2822 696d 6167 652d 7072  Field2("image-pr
-0000cc30: 6f6a 6563 7422 295b 276e 616d 6527 5d0a  oject")['name'].
-0000cc40: 2020 2020 2020 2020 2020 2020 6576 656e              even
-0000cc50: 745f 203d 2073 656c 662e 6669 6e64 546d  t_ = self.findTm
-0000cc60: 7046 6965 6c64 3228 2269 6d61 6765 2d65  pField2("image-e
-0000cc70: 7665 6e74 2229 5b27 6e61 6d65 275d 0a20  vent")['name']. 
-0000cc80: 2020 2020 2020 2020 2020 2069 6620 6576             if ev
-0000cc90: 656e 745f 203d 3d20 2222 3a0a 2020 2020  ent_ == "":.    
-0000cca0: 2020 2020 2020 2020 2020 2020 6576 656e              even
-0000ccb0: 745f 203d 2073 656c 662e 6469 722e 6576  t_ = self.dir.ev
-0000ccc0: 656e 7428 290a 2020 2020 2020 2020 2020  ent().          
-0000ccd0: 2020 7365 6e73 6f72 5f20 3d20 7365 6c66    sensor_ = self
-0000cce0: 2e66 696e 6454 6d70 4669 656c 6432 2822  .findTmpField2("
-0000ccf0: 696d 6167 652d 7365 6e73 6f72 2229 5b27  image-sensor")['
-0000cd00: 6e61 6d65 275d 0a20 2020 2020 2020 2020  name'].         
-0000cd10: 2020 2069 6620 7365 6e73 6f72 5f20 3d3d     if sensor_ ==
-0000cd20: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-0000cd30: 2020 2020 2073 656e 736f 725f 203d 2073       sensor_ = s
-0000cd40: 656c 662e 6469 722e 7365 6e73 6f72 2829  elf.dir.sensor()
-0000cd50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000cd60: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000cd70: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000cd80: 795d 5b27 696d 6167 652d 7365 742d 6e61  y]['image-set-na
-0000cd90: 6d65 275d 203d 2069 4644 4f2e 636f 6e73  me'] = iFDO.cons
-0000cda0: 7472 7563 7449 6d61 6765 5365 744e 616d  tructImageSetNam
-0000cdb0: 6528 7072 6f6a 6563 745f 2c65 7665 6e74  e(project_,event
-0000cdc0: 5f2c 7365 6e73 6f72 5f29 0a0a 2020 2020  _,sensor_)..    
-0000cdd0: 2020 2020 2320 7365 7420 7665 7273 696f      # set versio
-0000cde0: 6e0a 2020 2020 2020 2020 7365 6c66 2e69  n.        self.i
-0000cdf0: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-0000ce00: 6765 5365 7448 6561 6465 724b 6579 5d5b  geSetHeaderKey][
-0000ce10: 2769 6d61 6765 2d73 6574 2d69 6664 6f2d  'image-set-ifdo-
-0000ce20: 7665 7273 696f 6e27 5d20 3d20 6d69 7174  version'] = miqt
-0000ce30: 762e 6946 444f 5f76 6572 7369 6f6e 0a0a  v.iFDO_version..
-0000ce40: 0a20 2020 2064 6566 2073 6574 4865 6164  .    def setHead
-0000ce50: 6572 496d 6167 654c 6f63 616c 5061 7468  erImageLocalPath
-0000ce60: 4669 656c 6428 7365 6c66 293a 0a20 2020  Field(self):.   
-0000ce70: 2020 2020 2022 2222 2053 6574 7320 6865       """ Sets he
-0000ce80: 6164 6572 2066 6965 6c64 2027 696d 6167  ader field 'imag
-0000ce90: 652d 7365 742d 6c6f 6361 6c2d 7061 7468  e-set-local-path
-0000cea0: 2720 6672 6f6d 2069 6d61 6765 2064 6972  ' from image dir
-0000ceb0: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
-0000cec0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000ced0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000cee0: 795d 5b27 696d 6167 652d 7365 742d 6c6f  y]['image-set-lo
-0000cef0: 6361 6c2d 7061 7468 275d 203d 206f 732e  cal-path'] = os.
-0000cf00: 7061 7468 2e72 656c 7061 7468 2873 656c  path.relpath(sel
-0000cf10: 662e 696d 6167 6573 4469 722c 206f 732e  f.imagesDir, os.
-0000cf20: 7061 7468 2e64 6972 6e61 6d65 2873 656c  path.dirname(sel
-0000cf30: 662e 6765 7469 4644 4f46 696c 654e 616d  f.getiFDOFileNam
-0000cf40: 6528 2929 290a 0a0a 2020 2020 6465 6620  e()))...    def 
-0000cf50: 6372 6561 7465 5f66 6965 6c64 7328 7365  create_fields(se
-0000cf60: 6c66 2c20 616c 6c6f 775f 6d69 7373 696e  lf, allow_missin
-0000cf70: 675f 7265 7175 6972 6564 3d46 616c 7365  g_required=False
-0000cf80: 293a 0a20 2020 2020 2020 2022 2222 2043  ):.        """ C
-0000cf90: 7265 6174 6520 616e 6420 7661 6c69 6461  reate and valida
-0000cfa0: 7465 2063 7572 7265 6e74 2068 6561 6465  te current heade
-0000cfb0: 7220 6669 656c 6473 2061 6e64 2069 7465  r fields and ite
-0000cfc0: 6d20 6669 656c 6473 2066 726f 6d20 696e  m fields from in
-0000cfd0: 7465 726d 6564 6961 7465 2066 696c 6573  termediate files
-0000cfe0: 2e20 4f76 6572 7772 6974 6573 2065 7869  . Overwrites exi
-0000cff0: 7374 696e 6720 6669 656c 6473 2e20 2222  sting fields. ""
-0000d000: 220a 2020 2020 2020 2020 6974 656d 5f64  ".        item_d
-0000d010: 6174 6120 3d20 7365 6c66 2e5f 6765 745f  ata = self._get_
-0000d020: 6974 656d 5f64 6174 615f 6672 6f6d 5f69  item_data_from_i
-0000d030: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
-0000d040: 7328 290a 2020 2020 2020 2020 7265 7475  s().        retu
-0000d050: 726e 2073 656c 662e 6372 6561 7465 6946  rn self.createiF
-0000d060: 444f 2873 656c 662e 6966 646f 5f74 6d70  DO(self.ifdo_tmp
-0000d070: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000d080: 6164 6572 4b65 795d 2c20 6974 656d 5f64  aderKey], item_d
-0000d090: 6174 612e 7661 6c75 6573 2829 2c20 616c  ata.values(), al
-0000d0a0: 6c6f 775f 6d69 7373 696e 675f 7265 7175  low_missing_requ
-0000d0b0: 6972 6564 3d61 6c6c 6f77 5f6d 6973 7369  ired=allow_missi
-0000d0c0: 6e67 5f72 6571 7569 7265 6429 0a0a 0a20  ng_required)... 
-0000d0d0: 2020 2064 6566 2075 7064 6174 655f 6669     def update_fi
-0000d0e0: 656c 6473 2873 656c 662c 2068 6561 6465  elds(self, heade
-0000d0f0: 725f 6f6e 6c79 3a62 6f6f 6c3d 4e6f 6e65  r_only:bool=None
-0000d100: 293a 0a20 2020 2020 2020 2022 2222 2055  ):.        """ U
-0000d110: 7064 6174 6520 616e 6420 7661 6c69 6461  pdate and valida
-0000d120: 7465 2063 7572 7265 6e74 2068 6561 6465  te current heade
-0000d130: 7220 6669 656c 6473 2061 6e64 2069 7465  r fields and ite
-0000d140: 6d20 6669 656c 6473 2066 726f 6d20 696e  m fields from in
-0000d150: 7465 726d 6564 6961 7465 2066 696c 6573  termediate files
-0000d160: 2e20 2222 220a 2020 2020 2020 2020 6966  . """.        if
-0000d170: 2068 6561 6465 725f 6f6e 6c79 2069 7320   header_only is 
-0000d180: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000d190: 2020 6865 6164 6572 5f6f 6e6c 7920 3d20    header_only = 
-0000d1a0: 7365 6c66 2e69 676e 6f72 655f 696d 6167  self.ignore_imag
-0000d1b0: 655f 6669 6c65 730a 2020 2020 2020 2020  e_files.        
-0000d1c0: 6966 206e 6f74 2068 6561 6465 725f 6f6e  if not header_on
-0000d1d0: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
-0000d1e0: 6974 656d 5f64 6174 6120 3d20 7365 6c66  item_data = self
-0000d1f0: 2e5f 6765 745f 6974 656d 5f64 6174 615f  ._get_item_data_
-0000d200: 6672 6f6d 5f69 6e74 6572 6d65 6469 6174  from_intermediat
-0000d210: 655f 6669 6c65 7328 290a 2020 2020 2020  e_files().      
-0000d220: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000d230: 662e 7570 6461 7465 6946 444f 2873 656c  f.updateiFDO(sel
-0000d240: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000d250: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000d260: 795d 2c20 6974 656d 5f64 6174 612e 7661  y], item_data.va
-0000d270: 6c75 6573 2829 290a 2020 2020 2020 2020  lues()).        
-0000d280: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000d290: 2020 7265 7475 726e 2073 656c 662e 7570    return self.up
-0000d2a0: 6461 7465 6946 444f 2873 656c 662e 6966  dateiFDO(self.if
-0000d2b0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-0000d2c0: 6553 6574 4865 6164 6572 4b65 795d 2c20  eSetHeaderKey], 
-0000d2d0: 5b5d 2c20 6865 6164 6572 5f6f 6e6c 793d  [], header_only=
-0000d2e0: 5472 7565 290a 0a0a 2020 2020 6465 6620  True)...    def 
-0000d2f0: 6372 6561 7465 436f 7265 4669 656c 6473  createCoreFields
-0000d300: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000d310: 2222 2220 4445 5052 4543 4144 4554 2c20  """ DEPRECADET, 
-0000d320: 7573 6520 6372 6561 7465 5f66 6965 6c64  use create_field
-0000d330: 7328 2920 6f72 2075 7064 6174 655f 6669  s() or update_fi
-0000d340: 656c 6473 2829 2069 6e73 7465 642e 0a20  elds() insted.. 
-0000d350: 2020 2020 2020 2046 696c 6c73 2074 6865         Fills the
-0000d360: 2069 4644 4f20 636f 7265 2066 6965 6c64   iFDO core field
-0000d370: 7320 6672 6f6d 2069 6e74 6572 6d65 6469  s from intermedi
-0000d380: 6174 6520 6669 6c65 732e 2057 6974 686f  ate files. Witho
-0000d390: 7574 2074 6865 6d20 6e6f 2076 616c 6964  ut them no valid
-0000d3a0: 2069 4644 4f20 6361 6e20 6265 2063 7265   iFDO can be cre
-0000d3b0: 6174 6564 2e0a 2020 2020 2020 2020 2222  ated..        ""
-0000d3c0: 220a 2020 2020 2020 2020 6974 656d 5f64  ".        item_d
-0000d3d0: 6174 6120 3d20 7365 6c66 2e5f 6765 745f  ata = self._get_
-0000d3e0: 6974 656d 5f64 6174 615f 6672 6f6d 5f69  item_data_from_i
-0000d3f0: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
-0000d400: 735f 636f 7265 2829 0a20 2020 2020 2020  s_core().       
-0000d410: 2023 2063 6865 636b 2066 6965 6c64 7320   # check fields 
-0000d420: 666f 7220 7661 6c69 6469 7479 0a20 2020  for validity.   
-0000d430: 2020 2020 2023 2069 7465 6d5f 6461 7461       # item_data
-0000d440: 2063 6f6e 7461 696e 7320 6669 656c 6420   contains field 
-0000d450: 696d 6167 652d 6669 6c65 6e61 6d65 2c20  image-filename, 
-0000d460: 7768 6963 6820 7768 6963 6820 7769 6c6c  which which will
-0000d470: 206e 6f74 2062 6520 7374 6f72 6564 2061   not be stored a
-0000d480: 7320 616e 2069 7465 6d20 6669 656c 6420  s an item field 
-0000d490: 696e 2069 464f 4420 6275 7420 6173 2074  in iFOD but as t
-0000d4a0: 6865 2069 7465 6d20 6e61 6d65 2069 7473  he item name its
-0000d4b0: 656c 660a 2020 2020 2020 2020 7265 7475  elf.        retu
-0000d4c0: 726e 2073 656c 662e 7570 6461 7465 6946  rn self.updateiF
-0000d4d0: 444f 2873 656c 662e 6966 646f 5f74 6d70  DO(self.ifdo_tmp
-0000d4e0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000d4f0: 6164 6572 4b65 795d 2c20 6974 656d 5f64  aderKey], item_d
-0000d500: 6174 612e 7661 6c75 6573 2829 290a 0a0a  ata.values())...
-0000d510: 2020 2020 6465 6620 6372 6561 7465 4361      def createCa
-0000d520: 7074 7572 6541 6e64 436f 6e74 656e 7446  ptureAndContentF
-0000d530: 6965 6c64 7328 7365 6c66 293a 0a20 2020  ields(self):.   
-0000d540: 2020 2020 2022 2222 2044 4550 5245 4341       """ DEPRECA
-0000d550: 4445 542c 2075 7365 2063 7265 6174 655f  DET, use create_
-0000d560: 6669 656c 6473 2829 206f 7220 7570 6461  fields() or upda
-0000d570: 7465 5f66 6965 6c64 7328 2920 696e 7374  te_fields() inst
-0000d580: 6564 2e0a 2020 2020 2020 2020 4669 6c6c  ed..        Fill
-0000d590: 7320 7468 6520 6946 444f 2063 6170 7574  s the iFDO caput
-0000d5a0: 7265 2061 6e64 2063 6f6e 7465 6e74 2066  re and content f
-0000d5b0: 6965 6473 2066 726f 6d20 7072 6f76 6964  ieds from provid
-0000d5c0: 6564 2064 6174 6120 6669 656c 6473 200a  ed data fields .
-0000d5d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000d5e0: 2020 2020 6974 656d 5f64 6174 6120 3d20      item_data = 
-0000d5f0: 7365 6c66 2e5f 6765 745f 6974 656d 5f64  self._get_item_d
-0000d600: 6174 615f 6672 6f6d 5f69 6e74 6572 6d65  ata_from_interme
-0000d610: 6469 6174 655f 6669 6c65 735f 6e6f 6e65  diate_files_none
-0000d620: 5f63 6f72 6528 290a 2020 2020 2020 2020  _core().        
-0000d630: 2320 6368 6563 6b20 6669 656c 6473 2066  # check fields f
-0000d640: 6f72 2076 616c 6964 6974 790a 2020 2020  or validity.    
-0000d650: 2020 2020 2320 6974 656d 5f64 6174 6120      # item_data 
-0000d660: 636f 6e74 6169 6e73 2066 6965 6c64 2069  contains field i
-0000d670: 6d61 6765 2d66 696c 656e 616d 652c 2077  mage-filename, w
-0000d680: 6869 6368 2077 6869 6368 2077 696c 6c20  hich which will 
-0000d690: 6e6f 7420 6265 2073 746f 7265 6420 6173  not be stored as
-0000d6a0: 2061 6e20 6974 656d 2066 6965 6c64 2069   an item field i
-0000d6b0: 6e20 6946 4f44 2062 7574 2061 7320 7468  n iFOD but as th
-0000d6c0: 6520 6974 656d 206e 616d 6520 6974 7365  e item name itse
-0000d6d0: 6c66 0a20 2020 2020 2020 2072 6574 7572  lf.        retur
-0000d6e0: 6e20 7365 6c66 2e75 7064 6174 6569 4644  n self.updateiFD
-0000d6f0: 4f28 7365 6c66 2e69 6664 6f5f 746d 705b  O(self.ifdo_tmp[
-0000d700: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000d710: 6465 724b 6579 5d2c 2069 7465 6d5f 6461  derKey], item_da
-0000d720: 7461 2e76 616c 7565 7328 2929 0a0a 2020  ta.values())..  
-0000d730: 2020 0a20 2020 2064 6566 205f 6765 745f    .    def _get_
-0000d740: 6974 656d 5f64 6174 615f 6672 6f6d 5f69  item_data_from_i
-0000d750: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
-0000d760: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-0000d770: 2022 2222 2052 6561 6420 6461 7461 2066   """ Read data f
-0000d780: 726f 6d20 636f 7265 2061 6e64 206e 6f6e  rom core and non
-0000d790: 652d 636f 7265 2069 6e74 6572 6d64 6561  e-core intermdea
-0000d7a0: 7465 2066 696c 6573 2c20 6368 6563 6b20  te files, check 
-0000d7b0: 6669 6c65 7320 6578 6973 742c 2061 6464  files exist, add
-0000d7c0: 2027 696d 6167 652d 6861 6e64 6c65 272e   'image-handle'.
-0000d7d0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-0000d7e0: 2064 6963 7420 6f66 2066 6f72 6d20 7b69   dict of form {i
-0000d7f0: 6d61 6765 2d66 696c 652d 6e61 6d65 3a7b  mage-file-name:{
-0000d800: 6669 656c 643a 7661 6c75 657d 2c2e 2e2e  field:value},...
-0000d810: 7d20 0a20 2020 2020 2020 2022 2222 0a20  } .        """. 
-0000d820: 2020 2020 2020 2069 7465 6d5f 6461 7461         item_data
-0000d830: 5f63 6f72 6520 3d20 7365 6c66 2e5f 6765  _core = self._ge
-0000d840: 745f 6974 656d 5f64 6174 615f 6672 6f6d  t_item_data_from
-0000d850: 5f69 6e74 6572 6d65 6469 6174 655f 6669  _intermediate_fi
-0000d860: 6c65 735f 636f 7265 2829 0a20 2020 2020  les_core().     
-0000d870: 2020 2069 7465 6d5f 6461 7461 5f6e 6f6e     item_data_non
-0000d880: 655f 636f 7265 203d 2073 656c 662e 5f67  e_core = self._g
-0000d890: 6574 5f69 7465 6d5f 6461 7461 5f66 726f  et_item_data_fro
-0000d8a0: 6d5f 696e 7465 726d 6564 6961 7465 5f66  m_intermediate_f
-0000d8b0: 696c 6573 5f6e 6f6e 655f 636f 7265 2829  iles_none_core()
-0000d8c0: 0a20 2020 2020 2020 2023 7070 7269 6e74  .        #pprint
-0000d8d0: 2869 7465 6d5f 6461 7461 5f6e 6f6e 655f  (item_data_none_
-0000d8e0: 636f 7265 290a 2020 2020 2020 2020 2370  core).        #p
-0000d8f0: 7072 696e 7428 6974 656d 5f64 6174 615f  print(item_data_
-0000d900: 636f 7265 290a 2020 2020 2020 2020 6974  core).        it
-0000d910: 656d 5f64 6174 6120 3d20 6974 656d 5f64  em_data = item_d
-0000d920: 6174 615f 636f 7265 0a20 2020 2020 2020  ata_core.       
-0000d930: 206c 6f67 203d 206d 6971 7463 2e72 6563   log = miqtc.rec
-0000d940: 7572 7369 7665 6c79 5570 6461 7465 4469  ursivelyUpdateDi
-0000d950: 6374 7328 6974 656d 5f64 6174 612c 2069  cts(item_data, i
-0000d960: 7465 6d5f 6461 7461 5f6e 6f6e 655f 636f  tem_data_none_co
-0000d970: 7265 290a 2020 2020 2020 2020 2370 7072  re).        #ppr
-0000d980: 696e 7428 6974 656d 5f64 6174 6129 0a20  int(item_data). 
-0000d990: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-0000d9a0: 2e6c 6f67 286c 6f67 2c64 6f6e 7453 686f  .log(log,dontSho
-0000d9b0: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
-0000d9c0: 7265 7475 726e 2069 7465 6d5f 6461 7461  return item_data
-0000d9d0: 0a0a 2020 2020 6465 6620 5f67 6574 5f69  ..    def _get_i
-0000d9e0: 7465 6d5f 6461 7461 5f66 726f 6d5f 696e  tem_data_from_in
-0000d9f0: 7465 726d 6564 6961 7465 5f66 696c 6573  termediate_files
-0000da00: 5f6e 6f6e 655f 636f 7265 2873 656c 6629  _none_core(self)
-0000da10: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
-0000da20: 6164 2064 6174 6120 6672 6f6d 206e 6f6e  ad data from non
-0000da30: 2d63 6f72 6520 696e 7465 726d 6465 6174  -core intermdeat
-0000da40: 6520 6669 6c65 732e 0a20 2020 2020 2020  e files..       
-0000da50: 2052 6574 7572 6e73 2064 6963 7420 6f66   Returns dict of
-0000da60: 2066 6f72 6d20 7b69 6d61 6765 2d66 696c   form {image-fil
-0000da70: 652d 6e61 6d65 3a7b 6669 656c 643a 7661  e-name:{field:va
-0000da80: 6c75 657d 2c2e 2e2e 7d20 0a20 2020 2020  lue},...} .     
-0000da90: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-0000daa0: 6571 203d 2073 656c 662e 6e6f 6e43 6f72  eq = self.nonCor
-0000dab0: 6546 6965 6c64 496e 7465 726d 6564 6961  eFieldIntermedia
-0000dac0: 7465 4974 656d 496e 666f 4669 6c65 730a  teItemInfoFiles.
-0000dad0: 0a20 2020 2020 2020 2069 7465 6d5f 6461  .        item_da
-0000dae0: 7461 203d 207b 7d0a 2020 2020 2020 2020  ta = {}.        
-0000daf0: 7072 6f67 203d 206d 6971 7463 2e50 7269  prog = miqtc.Pri
-0000db00: 6e74 4b6e 6f77 6e50 726f 6772 6573 734d  ntKnownProgressM
-0000db10: 7367 2822 5061 7273 696e 6720 696e 7465  sg("Parsing inte
-0000db20: 726d 6564 6961 7465 2061 6464 6974 696f  rmediate additio
-0000db30: 6e61 6c20 6461 7461 222c 206c 656e 2872  nal data", len(r
-0000db40: 6571 2929 0a20 2020 2020 2020 2066 6f72  eq)).        for
-0000db50: 2072 2069 6e20 7265 713a 0a20 2020 2020   r in req:.     
-0000db60: 2020 2020 2020 2070 726f 672e 7072 6f67         prog.prog
-0000db70: 7265 7373 2829 0a20 2020 2020 2020 2020  ress().         
-0000db80: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-0000db90: 6973 7473 2872 2e66 696c 654e 616d 6529  ists(r.fileName)
-0000dba0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000dbb0: 2020 7365 6c66 2e70 7261 7365 4974 656d    self.praseItem
-0000dbc0: 4461 7461 4672 6f6d 4669 6c65 2869 7465  DataFromFile(ite
-0000dbd0: 6d5f 6461 7461 2c72 2e66 696c 654e 616d  m_data,r.fileNam
-0000dbe0: 652c 722e 7365 7061 7261 746f 722c 722e  e,r.separator,r.
-0000dbf0: 6865 6164 6572 2c20 722e 6461 7465 7469  header, r.dateti
-0000dc00: 6d65 5f66 6f72 6d61 7429 0a20 2020 2020  me_format).     
-0000dc10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000dc20: 7072 6f76 2e6c 6f67 2822 5061 7273 6564  prov.log("Parsed
-0000dc30: 2069 7465 6d20 6461 7461 2066 726f 6d3a   item data from:
-0000dc40: 2022 202b 2072 2e66 696c 654e 616d 6529   " + r.fileName)
-0000dc50: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000dc60: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000dc70: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-0000dc80: 2822 4669 6c65 2064 6f65 7320 6e6f 7420  ("File does not 
-0000dc90: 6578 6973 7473 3a20 2220 2b20 722e 6669  exists: " + r.fi
-0000dca0: 6c65 4e61 6d65 290a 2020 2020 2020 2020  leName).        
-0000dcb0: 7072 6f67 2e63 6c65 6172 2829 0a0a 2020  prog.clear()..  
-0000dcc0: 2020 2020 2020 2320 6368 6563 6b20 6669        # check fi
-0000dcd0: 6c65 7320 6578 6973 740a 2020 2020 2020  les exist.      
-0000dce0: 2020 7265 6d6f 7665 203d 205b 5d0a 2020    remove = [].  
-0000dcf0: 2020 2020 2020 666f 7220 696d 6720 696e        for img in
-0000dd00: 2069 7465 6d5f 6461 7461 3a0a 2020 2020   item_data:.    
-0000dd10: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-0000dd20: 6d67 2069 6e20 7365 6c66 2e5f 696d 6167  mg in self._imag
-0000dd30: 654e 616d 6573 496d 6167 6573 4469 723a  eNamesImagesDir:
-0000dd40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dd50: 2072 656d 6f76 652e 6170 7065 6e64 2869   remove.append(i
-0000dd60: 6d67 290a 2020 2020 2020 2020 666f 7220  mg).        for 
-0000dd70: 696d 6720 696e 2072 656d 6f76 653a 0a20  img in remove:. 
-0000dd80: 2020 2020 2020 2020 2020 2064 656c 2069             del i
-0000dd90: 7465 6d5f 6461 7461 5b69 6d67 5d0a 0a20  tem_data[img].. 
-0000dda0: 2020 2020 2020 2072 6574 7572 6e20 6974         return it
-0000ddb0: 656d 5f64 6174 610a 0a0a 2020 2020 6465  em_data...    de
-0000ddc0: 6620 5f67 6574 5f69 7465 6d5f 6461 7461  f _get_item_data
-0000ddd0: 5f66 726f 6d5f 696e 7465 726d 6564 6961  _from_intermedia
-0000dde0: 7465 5f66 696c 6573 5f63 6f72 6528 7365  te_files_core(se
-0000ddf0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0000de00: 2052 6561 6420 6461 7461 2066 726f 6d20   Read data from 
-0000de10: 636f 7265 2069 6e74 6572 6d64 6561 7465  core intermdeate
-0000de20: 2066 696c 6573 2c20 6368 6563 6b20 6669   files, check fi
-0000de30: 6c65 7320 6578 6973 742c 2061 6464 2027  les exist, add '
-0000de40: 696d 6167 652d 6861 6e64 6c65 272e 0a20  image-handle'.. 
-0000de50: 2020 2020 2020 2052 6574 7572 6e73 2064         Returns d
-0000de60: 6963 7420 6f66 2066 6f72 6d20 7b69 6d61  ict of form {ima
-0000de70: 6765 2d66 696c 652d 6e61 6d65 3a7b 6669  ge-file-name:{fi
-0000de80: 656c 643a 7661 6c75 657d 2c2e 2e2e 7d20  eld:value},...} 
-0000de90: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0000dea0: 2020 2020 2020 2320 5768 6963 6820 6669        # Which fi
-0000deb0: 6c65 7320 636f 6e74 6169 6e20 7468 6520  les contain the 
-0000dec0: 696e 666f 726d 6174 696f 6e20 6e65 6564  information need
-0000ded0: 6564 2074 6f20 6372 6561 7465 2074 6865  ed to create the
-0000dee0: 2069 4644 4f20 6974 656d 7320 636f 7265   iFDO items core
-0000def0: 2069 6e66 6f72 6d61 7469 6f6e 2061 6e64   information and
-0000df00: 2077 6869 6368 2063 6f6c 756d 6e73 2073   which columns s
-0000df10: 6861 6c6c 2062 6520 7573 6564 0a20 2020  hall be used.   
-0000df20: 2020 2020 2072 6571 203d 2073 656c 662e       req = self.
-0000df30: 696e 7465 726d 6564 6961 7465 4669 6c65  intermediateFile
-0000df40: 7344 6566 5f63 6f72 650a 0a20 2020 2020  sDef_core..     
-0000df50: 2020 2069 7465 6d5f 6461 7461 203d 207b     item_data = {
-0000df60: 7d0a 2020 2020 2020 2020 7072 6f67 203d  }.        prog =
-0000df70: 206d 6971 7463 2e50 7269 6e74 4b6e 6f77   miqtc.PrintKnow
-0000df80: 6e50 726f 6772 6573 734d 7367 2822 5061  nProgressMsg("Pa
-0000df90: 7273 696e 6720 696e 7465 726d 6564 6961  rsing intermedia
-0000dfa0: 7465 2063 6f72 6520 6461 7461 222c 206c  te core data", l
-0000dfb0: 656e 2872 6571 2929 0a20 2020 2020 2020  en(req)).       
-0000dfc0: 2066 6f72 2072 2069 6e20 7265 713a 0a20   for r in req:. 
-0000dfd0: 2020 2020 2020 2020 2020 2070 726f 672e             prog.
-0000dfe0: 7072 6f67 7265 7373 2829 0a20 2020 2020  progress().     
-0000dff0: 2020 2020 2020 2066 696c 6520 3d20 7365         file = se
-0000e000: 6c66 2e5f 5f67 6574 5f69 6e74 5f66 696c  lf.__get_int_fil
-0000e010: 655f 7072 6566 6978 2829 202b 2072 6571  e_prefix() + req
-0000e020: 5b72 5d5b 2773 7566 6669 7827 5d0a 2020  [r]['suffix'].  
-0000e030: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0000e040: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-0000e050: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
-0000e060: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-0000e070: 2e6c 6f67 2822 5741 524e 494e 4721 2046  .log("WARNING! F
-0000e080: 6f72 2061 6368 6965 7669 6e67 2046 4149  or achieving FAI
-0000e090: 526e 6573 7320 616e 2069 6e74 6572 6d65  Rness an interme
-0000e0a0: 6469 6174 6520 696d 6167 6520 696e 666f  diate image info
-0000e0b0: 2066 696c 6520 6973 206d 6973 7369 6e67   file is missing
-0000e0c0: 3a20 222b 2073 656c 662e 5f5f 6765 745f  : "+ self.__get_
-0000e0d0: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
-0000e0e0: 2920 2b20 7265 715b 725d 5b27 7375 6666  ) + req[r]['suff
-0000e0f0: 6978 275d 2b20 2220 7275 6e20 6669 7273  ix']+ " run firs
-0000e100: 743a 2022 202b 2072 6571 5b72 5d5b 2763  t: " + req[r]['c
-0000e110: 7265 6174 696f 6e46 6374 275d 290a 2020  reationFct']).  
-0000e120: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e140: 7365 6c66 2e70 6172 7365 4974 656d 4461  self.parseItemDa
-0000e150: 7461 6672 6f6d 5461 6246 696c 6544 6174  tafromTabFileDat
-0000e160: 6128 6974 656d 5f64 6174 612c 2066 696c  a(item_data, fil
-0000e170: 652c 2072 6571 5b72 5d5b 2763 6f6c 7327  e, req[r]['cols'
-0000e180: 5d2c 2072 6571 5b72 5d5b 276f 7074 696f  ], req[r]['optio
-0000e190: 6e61 6c27 5d29 0a20 2020 2020 2020 2020  nal']).         
-0000e1a0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-0000e1b0: 2e6c 6f67 2822 5061 7273 6564 2069 7465  .log("Parsed ite
-0000e1c0: 6d20 6461 7461 2066 726f 6d3a 2022 202b  m data from: " +
-0000e1d0: 2066 696c 6529 0a0a 2020 2020 2020 2020   file)..        
-0000e1e0: 7072 6f67 2e63 6c65 6172 2829 0a20 2020  prog.clear().   
-0000e1f0: 2020 2020 2069 6620 6c65 6e28 6974 656d       if len(item
-0000e200: 5f64 6174 6129 203d 3d20 303a 0a20 2020  _data) == 0:.   
-0000e210: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
-0000e220: 7863 6570 7469 6f6e 2822 4e6f 2069 4644  xception("No iFD
-0000e230: 4f20 6974 656d 7322 290a 0a20 2020 2020  O items")..     
-0000e240: 2020 2023 2063 6865 636b 2066 696c 6573     # check files
-0000e250: 2065 7869 7374 0a20 2020 2020 2020 2072   exist.        r
-0000e260: 656d 6f76 6520 3d20 5b5d 0a20 2020 2020  emove = [].     
-0000e270: 2020 2066 6f72 2069 6d67 2069 6e20 6974     for img in it
-0000e280: 656d 5f64 6174 613a 0a20 2020 2020 2020  em_data:.       
-0000e290: 2020 2020 2069 6620 6e6f 7420 696d 6720       if not img 
-0000e2a0: 696e 2073 656c 662e 5f69 6d61 6765 4e61  in self._imageNa
-0000e2b0: 6d65 7349 6d61 6765 7344 6972 3a0a 2020  mesImagesDir:.  
-0000e2c0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000e2d0: 6d6f 7665 2e61 7070 656e 6428 696d 6729  move.append(img)
-0000e2e0: 0a20 2020 2020 2020 2066 6f72 2069 6d67  .        for img
-0000e2f0: 2069 6e20 7265 6d6f 7665 3a0a 2020 2020   in remove:.    
-0000e300: 2020 2020 2020 2020 6465 6c20 6974 656d          del item
-0000e310: 5f64 6174 615b 696d 675d 0a0a 2020 2020  _data[img]..    
-0000e320: 2020 2020 2320 6164 6420 696d 6167 652d      # add image-
-0000e330: 7572 6c0a 2020 2020 2020 2020 666f 7220  url.        for 
-0000e340: 696d 6720 696e 2069 7465 6d5f 6461 7461  img in item_data
-0000e350: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0000e360: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
-0000e370: 5f64 6174 615b 696d 675d 2c6c 6973 7429  _data[img],list)
-0000e380: 3a20 2320 6974 656d 2069 7320 616c 7265  : # item is alre
-0000e390: 6164 7920 6120 6c69 7374 2028 7669 6465  ady a list (vide
-0000e3a0: 6f29 2062 7574 2070 6172 7365 6420 6461  o) but parsed da
-0000e3b0: 7461 2069 7320 6e6f 742c 2069 2e65 2e20  ta is not, i.e. 
-0000e3c0: 7061 7273 6564 2064 6174 6120 7265 6665  parsed data refe
-0000e3d0: 7273 2074 6f20 7768 6f6c 6520 7669 6465  rs to whole vide
-0000e3e0: 6f20 2874 696d 6520 696e 6465 7065 6e64  o (time independ
-0000e3f0: 656e 7429 2c20 692e 652e 2077 7269 7465  ent), i.e. write
-0000e400: 2074 6f20 6669 7273 7420 656e 7472 790a   to first entry.
-0000e410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e420: 7575 6964 203d 2066 696e 6446 6965 6c64  uuid = findField
-0000e430: 2869 7465 6d5f 6461 7461 5b69 6d67 5d5b  (item_data[img][
-0000e440: 305d 2c27 696d 6167 652d 7575 6964 2729  0],'image-uuid')
-0000e450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e460: 2069 6620 7575 6964 203d 3d20 2222 3a0a   if uuid == "":.
-0000e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e480: 2020 2020 7070 7269 6e74 2869 7465 6d5f      pprint(item_
-0000e490: 6461 7461 5b69 6d67 5d5b 305d 290a 2020  data[img][0]).  
-0000e4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e4b0: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
-0000e4c0: 646f 4578 6365 7074 696f 6e28 2275 7569  doException("uui
-0000e4d0: 6420 6e6f 7420 666f 756e 6420 2861 2922  d not found (a)"
-0000e4e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000e4f0: 2020 6974 656d 5f64 6174 615b 696d 675d    item_data[img]
-0000e500: 5b30 5d5b 2769 6d61 6765 2d68 616e 646c  [0]['image-handl
-0000e510: 6527 5d20 3d20 7365 6c66 2e69 6d61 6765  e'] = self.image
-0000e520: 5f68 616e 646c 655f 7072 6566 6978 202b  _handle_prefix +
-0000e530: 2027 4027 202b 2075 7569 640a 2020 2020   '@' + uuid.    
-0000e540: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000e550: 2020 2020 2020 2020 2020 2020 2020 7575                uu
-0000e560: 6964 203d 2066 696e 6446 6965 6c64 2869  id = findField(i
-0000e570: 7465 6d5f 6461 7461 5b69 6d67 5d2c 2769  tem_data[img],'i
-0000e580: 6d61 6765 2d75 7569 6427 290a 2020 2020  mage-uuid').    
-0000e590: 2020 2020 2020 2020 2020 2020 6966 2075              if u
-0000e5a0: 7569 6420 3d3d 2022 223a 0a20 2020 2020  uid == "":.     
-0000e5b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000e5c0: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
-0000e5d0: 7863 6570 7469 6f6e 2822 7575 6964 206e  xception("uuid n
-0000e5e0: 6f74 2066 6f75 6e64 2028 6229 2229 0a20  ot found (b)"). 
-0000e5f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000e600: 7465 6d5f 6461 7461 5b69 6d67 5d5b 2769  tem_data[img]['i
-0000e610: 6d61 6765 2d68 616e 646c 6527 5d20 3d20  mage-handle'] = 
-0000e620: 7365 6c66 2e69 6d61 6765 5f68 616e 646c  self.image_handl
-0000e630: 655f 7072 6566 6978 202b 2027 4027 202b  e_prefix + '@' +
-0000e640: 2075 7569 640a 0a20 2020 2020 2020 2072   uuid..        r
-0000e650: 6574 7572 6e20 6974 656d 5f64 6174 610a  eturn item_data.
-0000e660: 0a0a 2020 2020 6465 6620 6164 645f 6974  ..    def add_it
-0000e670: 656d 5f69 6e66 6f5f 7461 625f 6669 6c65  em_info_tab_file
-0000e680: 2873 656c 662c 2066 696c 654e 616d 653a  (self, fileName:
-0000e690: 2073 7472 2c20 7365 7061 7261 746f 723a   str, separator:
-0000e6a0: 7374 722c 2068 6561 6465 723a 6469 6374  str, header:dict
-0000e6b0: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
-0000e6c0: 7420 3d20 6d69 7174 762e 6461 7465 5f66  t = miqtv.date_f
-0000e6d0: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
-0000e6e0: 293a 0a20 2020 2020 2020 2022 2222 2041  ):.        """ A
-0000e6f0: 6464 2061 2063 6f6c 756d 6e20 7365 7065  dd a column sepe
-0000e700: 7261 7465 6420 7465 7874 2066 696c 6520  rated text file 
-0000e710: 746f 2070 6172 7365 2069 7465 6d20 6461  to parse item da
-0000e720: 7461 2066 726f 6d20 6279 2063 7265 6174  ta from by creat
-0000e730: 6543 6170 7475 7265 416e 6443 6f6e 7465  eCaptureAndConte
-0000e740: 6e74 4669 656c 6473 2829 2e20 0a20 2020  ntFields(). .   
-0000e750: 2020 2020 2043 6f6c 756d 6e73 2068 6561       Columns hea
-0000e760: 6465 7273 2077 696c 6c20 6265 2073 6574  ders will be set
-0000e770: 2061 7320 6974 656d 2066 6965 6c64 206e   as item field n
-0000e780: 616d 6573 2e20 4d75 7374 2063 6f6e 7461  ames. Must conta
-0000e790: 696e 2063 6f6c 756d 6e20 2769 6d61 6765  in column 'image
-0000e7a0: 2d66 696c 656e 616d 6527 2e0a 2020 2020  -filename'..    
-0000e7b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000e7c0: 6966 2066 696c 654e 616d 6520 3d3d 204e  if fileName == N
-0000e7d0: 6f6e 6520 6f72 206e 6f74 206f 732e 7061  one or not os.pa
-0000e7e0: 7468 2e65 7869 7374 7328 6669 6c65 4e61  th.exists(fileNa
-0000e7f0: 6d65 293a 0a20 2020 2020 2020 2020 2020  me):.           
-0000e800: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-0000e810: 2822 4669 6c65 222c 6669 6c65 4e61 6d65  ("File",fileName
-0000e820: 2c22 6e6f 7420 666f 756e 6422 290a 0a20  ,"not found").. 
-0000e830: 2020 2020 2020 2066 6f72 2066 6965 6c64         for field
-0000e840: 2069 6e20 6865 6164 6572 3a0a 2020 2020   in header:.    
-0000e850: 2020 2020 2020 2020 6966 2068 6561 6465          if heade
-0000e860: 725b 6669 656c 645d 206e 6f74 2069 6e20  r[field] not in 
-0000e870: 6d69 7174 662e 7461 6246 696c 6543 6f6c  miqtf.tabFileCol
-0000e880: 756d 6e4e 616d 6573 2866 696c 654e 616d  umnNames(fileNam
-0000e890: 652c 636f 6c5f 7365 7061 7261 746f 723d  e,col_separator=
-0000e8a0: 7365 7061 7261 746f 7229 3a0a 2020 2020  separator):.    
-0000e8b0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000e8c0: 6520 4578 6365 7074 696f 6e28 2243 6f6c  e Exception("Col
-0000e8d0: 756d 6e22 2c20 6865 6164 6572 5b66 6965  umn", header[fie
-0000e8e0: 6c64 5d2c 2022 6e6f 7420 696e 2066 696c  ld], "not in fil
-0000e8f0: 6522 2c20 6669 6c65 4e61 6d65 290a 0a20  e", fileName).. 
-0000e900: 2020 2020 2020 2069 6620 6d69 7174 632e         if miqtc.
-0000e910: 6173 7365 7274 536c 6173 6828 6f73 2e70  assertSlash(os.p
-0000e920: 6174 682e 6469 726e 616d 6528 6669 6c65  ath.dirname(file
-0000e930: 4e61 6d65 2929 2021 3d20 6d69 7174 632e  Name)) != miqtc.
-0000e940: 6173 7365 7274 536c 6173 6828 7365 6c66  assertSlash(self
-0000e950: 2e64 6972 2e74 6f28 7365 6c66 2e64 6972  .dir.to(self.dir
-0000e960: 2e64 742e 696e 7465 726d 6564 6961 7465  .dt.intermediate
-0000e970: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0000e980: 7365 6c66 2e70 726f 762e 6c6f 6728 2022  self.prov.log( "
-0000e990: 4361 7574 696f 6e21 2049 7420 6973 2072  Caution! It is r
-0000e9a0: 6563 6f6d 6d65 6e64 6564 2074 6f20 7075  ecommended to pu
-0000e9b0: 7420 6669 6c65 2069 6e20 7468 6520 6469  t file in the di
-0000e9c0: 7265 6374 6f72 7927 7320 2769 6e74 6572  rectory's 'inter
-0000e9d0: 6d65 6469 6174 6527 2066 6f6c 6465 723a  mediate' folder:
-0000e9e0: 2022 202b 2066 696c 654e 616d 6529 0a20   " + fileName). 
-0000e9f0: 2020 2020 2020 206e 6366 6969 6620 3d20         ncfiif = 
-0000ea00: 6e6f 6e43 6f72 6546 6965 6c64 496e 7465  nonCoreFieldInte
-0000ea10: 726d 6564 6961 7465 4974 656d 496e 666f  rmediateItemInfo
-0000ea20: 4669 6c65 2866 696c 654e 616d 652c 2073  File(fileName, s
-0000ea30: 6570 6172 6174 6f72 2c20 6865 6164 6572  eparator, header
-0000ea40: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
-0000ea50: 7429 0a20 2020 2020 2020 2069 6620 6e63  t).        if nc
-0000ea60: 6669 6966 206e 6f74 2069 6e20 7365 6c66  fiif not in self
-0000ea70: 2e6e 6f6e 436f 7265 4669 656c 6449 6e74  .nonCoreFieldInt
-0000ea80: 6572 6d65 6469 6174 6549 7465 6d49 6e66  ermediateItemInf
-0000ea90: 6f46 696c 6573 3a20 0a20 2020 2020 2020  oFiles: .       
-0000eaa0: 2020 2020 2073 656c 662e 6e6f 6e43 6f72       self.nonCor
-0000eab0: 6546 6965 6c64 496e 7465 726d 6564 6961  eFieldIntermedia
-0000eac0: 7465 4974 656d 496e 666f 4669 6c65 732e  teItemInfoFiles.
-0000ead0: 6170 7065 6e64 286e 6366 6969 6629 0a0a  append(ncfiif)..
-0000eae0: 2020 2020 6465 6620 6164 6449 7465 6d49      def addItemI
-0000eaf0: 6e66 6f54 6162 4669 6c65 2873 656c 662c  nfoTabFile(self,
-0000eb00: 2066 696c 654e 616d 653a 2073 7472 2c20   fileName: str, 
-0000eb10: 7365 7061 7261 746f 723a 7374 722c 2068  separator:str, h
-0000eb20: 6561 6465 723a 6469 6374 2c20 6461 7465  eader:dict, date
-0000eb30: 7469 6d65 5f66 6f72 6d61 7420 3d20 6d69  time_format = mi
-0000eb40: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
-0000eb50: 5b27 6d61 7269 7174 275d 293a 0a20 2020  ['mariqt']):.   
-0000eb60: 2020 2020 2022 2222 2044 6570 7265 6361       """ Depreca
-0000eb70: 7465 6420 2d20 7573 6520 6164 645f 6974  ted - use add_it
-0000eb80: 656d 5f69 6e66 6f5f 7461 625f 6669 6c65  em_info_tab_file
-0000eb90: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
-0000eba0: 662e 6164 645f 6974 656d 5f69 6e66 6f5f  f.add_item_info_
-0000ebb0: 7461 625f 6669 6c65 2866 696c 654e 616d  tab_file(fileNam
-0000ebc0: 652c 7365 7061 7261 746f 722c 6865 6164  e,separator,head
-0000ebd0: 6572 2c64 6174 6574 696d 655f 666f 726d  er,datetime_form
-0000ebe0: 6174 290a 0a20 2020 2020 2020 200a 2020  at)..        .  
-0000ebf0: 2020 6465 6620 7265 6d6f 7665 4974 656d    def removeItem
-0000ec00: 496e 666f 5461 6246 696c 6528 7365 6c66  InfoTabFile(self
-0000ec10: 2c20 6669 6c65 4e61 6d65 3a20 7374 722c  , fileName: str,
-0000ec20: 2073 6570 6172 6174 6f72 3a73 7472 2c20   separator:str, 
-0000ec30: 6865 6164 6572 3a64 6963 742c 2064 6174  header:dict, dat
-0000ec40: 6574 696d 655f 666f 726d 6174 3a73 7472  etime_format:str
-0000ec50: 293a 0a20 2020 2020 2020 2022 2222 2072  ):.        """ r
-0000ec60: 656d 6f76 6573 2066 696c 6520 6974 656d  emoves file item
-0000ec70: 2066 726f 6d20 6c69 7374 206f 6620 6669   from list of fi
-0000ec80: 6c65 7320 746f 2070 6172 7365 2069 7465  les to parse ite
-0000ec90: 6d20 6461 7461 2066 726f 6d20 6279 2063  m data from by c
-0000eca0: 7265 6174 6543 6170 7475 7265 416e 6443  reateCaptureAndC
-0000ecb0: 6f6e 7465 6e74 4669 656c 6473 2829 2022  ontentFields() "
-0000ecc0: 2222 0a20 2020 2020 2020 206e 6366 6969  "".        ncfii
-0000ecd0: 6620 3d20 6e6f 6e43 6f72 6546 6965 6c64  f = nonCoreField
-0000ece0: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
-0000ecf0: 496e 666f 4669 6c65 2866 696c 654e 616d  InfoFile(fileNam
-0000ed00: 652c 2073 6570 6172 6174 6f72 2c20 6865  e, separator, he
-0000ed10: 6164 6572 2c20 6461 7465 7469 6d65 5f66  ader, datetime_f
-0000ed20: 6f72 6d61 7429 0a20 2020 2020 2020 2069  ormat).        i
-0000ed30: 6620 6e63 6669 6966 2069 6e20 7365 6c66  f ncfiif in self
-0000ed40: 2e6e 6f6e 436f 7265 4669 656c 6449 6e74  .nonCoreFieldInt
-0000ed50: 6572 6d65 6469 6174 6549 7465 6d49 6e66  ermediateItemInf
-0000ed60: 6f46 696c 6573 3a20 0a20 2020 2020 2020  oFiles: .       
-0000ed70: 2020 2020 2073 656c 662e 6e6f 6e43 6f72       self.nonCor
-0000ed80: 6546 6965 6c64 496e 7465 726d 6564 6961  eFieldIntermedia
-0000ed90: 7465 4974 656d 496e 666f 4669 6c65 732e  teItemInfoFiles.
-0000eda0: 7265 6d6f 7665 286e 6366 6969 6629 0a0a  remove(ncfiif)..
-0000edb0: 0a20 2020 2064 6566 2075 7064 6174 6569  .    def updatei
-0000edc0: 4644 4f28 7365 6c66 2c20 6865 6164 6572  FDO(self, header
-0000edd0: 3a20 6469 6374 2c20 6974 656d 733a 206c  : dict, items: l
-0000ede0: 6973 742c 2068 6561 6465 725f 6f6e 6c79  ist, header_only
-0000edf0: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-0000ee00: 2022 2222 2055 7064 6174 6573 2074 6865   """ Updates the
-0000ee10: 2063 7572 7265 6e74 2076 616c 7565 7320   current values 
-0000ee20: 6946 444f 2077 6974 6820 7468 6520 7072  iFDO with the pr
-0000ee30: 6f76 6964 6564 206e 6577 2076 616c 7565  ovided new value
-0000ee40: 7320 2222 220a 2020 2020 2020 2020 7265  s """.        re
-0000ee50: 7475 726e 2073 656c 662e 6372 6561 7465  turn self.create
-0000ee60: 6946 444f 2868 6561 6465 722c 2069 7465  iFDO(header, ite
-0000ee70: 6d73 2c20 7570 6461 7465 4578 6973 7469  ms, updateExisti
-0000ee80: 6e67 3d54 7275 652c 2068 6561 6465 724f  ng=True, headerO
-0000ee90: 6e6c 793d 6865 6164 6572 5f6f 6e6c 7929  nly=header_only)
-0000eea0: 0a0a 0a20 2020 2064 6566 2063 7265 6174  ...    def creat
-0000eeb0: 6569 4644 4f28 7365 6c66 2c20 6865 6164  eiFDO(self, head
-0000eec0: 6572 3a20 6469 6374 2c20 6974 656d 733a  er: dict, items:
-0000eed0: 206c 6973 742c 2075 7064 6174 6545 7869   list, updateExi
-0000eee0: 7374 696e 673d 4661 6c73 652c 6865 6164  sting=False,head
-0000eef0: 6572 4f6e 6c79 3d46 616c 7365 2c61 6c6c  erOnly=False,all
-0000ef00: 6f77 5f6d 6973 7369 6e67 5f72 6571 7569  ow_missing_requi
-0000ef10: 7265 643d 4661 6c73 652c 7661 6c69 6461  red=False,valida
-0000ef20: 7465 5f73 696e 676c 655f 6974 656d 733d  te_single_items=
-0000ef30: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-0000ef40: 2222 2220 4372 6561 7465 7320 4641 4952  """ Creates FAIR
-0000ef50: 2064 6967 6974 616c 206f 626a 6563 7420   digital object 
-0000ef60: 666f 7220 7468 6520 696d 6167 6520 6461  for the image da
-0000ef70: 7461 2069 7473 656c 662e 2054 6869 7320  ta itself. This 
-0000ef80: 636f 6e73 6973 7473 206f 6620 6865 6164  consists of head
-0000ef90: 6572 2069 6e66 6f72 6d61 7469 6f6e 2061  er information a
-0000efa0: 6e64 2069 7465 6d20 696e 666f 726d 6174  nd item informat
-0000efb0: 696f 6e2e 0a20 2020 2020 2020 2075 7064  ion..        upd
-0000efc0: 6174 6545 7869 7374 696e 673a 2069 6620  ateExisting: if 
-0000efd0: 4661 6c73 6520 6f6c 6420 7661 6c75 6573  False old values
-0000efe0: 2061 7265 2072 656d 6f76 6564 2c20 6f74   are removed, ot
-0000eff0: 6865 7277 6973 6520 7468 6579 2061 7265  herwise they are
-0000f000: 2075 7064 6174 6564 2e0a 2020 2020 2020   updated..      
-0000f010: 2020 6865 6164 6572 4f6e 6c79 3a20 6966    headerOnly: if
-0000f020: 2054 7275 6520 6974 656d 7320 6d61 7920   True items may 
-0000f030: 6265 2065 6d70 7479 206c 6973 742e 0a20  be empty list.. 
-0000f040: 2020 2020 2020 2061 6c6c 6f77 5f6d 6973         allow_mis
-0000f050: 7369 6e67 5f72 6571 7569 7265 643a 2069  sing_required: i
-0000f060: 6620 5472 7565 2c20 6e6f 2065 7863 6570  f True, no excep
-0000f070: 7469 6f6e 2072 6973 656e 2069 6620 6120  tion risen if a 
-0000f080: 7265 7175 6972 6564 2066 6965 6c64 2069  required field i
-0000f090: 7320 6d69 7373 696e 672e 2020 2222 220a  s missing.  """.
-0000f0a0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000f0b0: 7570 6461 7465 4578 6973 7469 6e67 2061  updateExisting a
-0000f0c0: 6e64 206c 656e 2869 7465 6d73 2920 3d3d  nd len(items) ==
-0000f0d0: 2030 2061 6e64 206e 6f74 2068 6561 6465   0 and not heade
-0000f0e0: 724f 6e6c 793a 0a20 2020 2020 2020 2020  rOnly:.         
-0000f0f0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-0000f100: 6f6e 2827 4e6f 2069 7465 6d20 696e 666f  on('No item info
-0000f110: 726d 6174 696f 6e20 6769 7665 6e27 290a  rmation given').
-0000f120: 0a20 2020 2020 2020 2069 6620 7570 6461  .        if upda
-0000f130: 7465 4578 6973 7469 6e67 3a0a 2020 2020  teExisting:.    
-0000f140: 2020 2020 2020 2020 2320 6865 6164 6572          # header
-0000f150: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000f160: 662e 7570 6461 7465 5f69 6664 6f5f 6865  f.update_ifdo_he
-0000f170: 6164 6572 5f66 6965 6c64 7328 6865 6164  ader_fields(head
-0000f180: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
-0000f190: 2320 6974 656d 730a 2020 2020 2020 2020  # items.        
-0000f1a0: 2020 2020 2320 7570 6461 7465 2063 6f70      # update cop
-0000f1b0: 7920 6f66 2063 7572 7265 6e74 2069 7465  y of current ite
-0000f1c0: 6d73 2077 6974 6820 6e65 7720 6974 656d  ms with new item
-0000f1d0: 7320 6669 656c 6473 0a20 2020 2020 2020  s fields.       
-0000f1e0: 2020 2020 2069 6620 6e6f 7420 6865 6164       if not head
-0000f1f0: 6572 4f6e 6c79 3a0a 2020 2020 2020 2020  erOnly:.        
-0000f200: 2020 2020 2020 2020 6974 656d 7344 6963          itemsDic
-0000f210: 7420 3d20 6d69 7174 692e 6372 6561 7465  t = miqti.create
-0000f220: 496d 6167 6549 7465 6d73 4469 6374 4672  ImageItemsDictFr
-0000f230: 6f6d 496d 6167 6549 7465 6d73 4c69 7374  omImageItemsList
-0000f240: 2869 7465 6d73 290a 2020 2020 2020 2020  (items).        
-0000f250: 2020 2020 2020 2020 7570 6461 7465 6449          updatedI
-0000f260: 7465 6d73 5f63 6f70 7920 3d20 636f 7079  tems_copy = copy
-0000f270: 2e64 6565 7063 6f70 7928 7365 6c66 2e69  .deepcopy(self.i
-0000f280: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-0000f290: 6765 5365 7449 7465 6d73 4b65 795d 290a  geSetItemsKey]).
-0000f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2b0: 6c6f 6720 3d20 6d69 7174 632e 7265 6375  log = miqtc.recu
-0000f2c0: 7273 6976 656c 7955 7064 6174 6544 6963  rsivelyUpdateDic
-0000f2d0: 7473 2875 7064 6174 6564 4974 656d 735f  ts(updatedItems_
-0000f2e0: 636f 7079 2c20 6974 656d 7344 6963 7429  copy, itemsDict)
-0000f2f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f300: 2073 656c 662e 7072 6f76 2e6c 6f67 286c   self.prov.log(l
-0000f310: 6f67 2c64 6f6e 7453 686f 773d 5472 7565  og,dontShow=True
-0000f320: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000f330: 2020 6974 656d 7320 3d20 6d69 7174 692e    items = miqti.
-0000f340: 6372 6561 7465 496d 6167 6549 7465 6d73  createImageItems
-0000f350: 4c69 7374 4672 6f6d 496d 6167 6549 7465  ListFromImageIte
-0000f360: 6d73 4469 6374 2875 7064 6174 6564 4974  msDict(updatedIt
-0000f370: 656d 735f 636f 7079 290a 0a20 2020 2020  ems_copy)..     
-0000f380: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000f390: 2020 2020 2023 206f 7665 7277 7269 7465       # overwrite
-0000f3a0: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
-0000f3b0: 2020 2020 7365 6c66 2e73 6574 5f69 6664      self.set_ifd
-0000f3c0: 6f5f 6865 6164 6572 5f66 6965 6c64 7328  o_header_fields(
-0000f3d0: 6865 6164 6572 290a 2020 2020 2020 2020  header).        
-0000f3e0: 2020 2020 2320 636c 6561 7220 6974 656d      # clear item
-0000f3f0: 7320 7365 6374 696f 6e0a 2020 2020 2020  s section.      
-0000f400: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
-0000f410: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-0000f420: 7449 7465 6d73 4b65 795d 203d 207b 7d0a  tItemsKey] = {}.
-0000f430: 0a20 2020 2020 2020 2023 2050 6172 7365  .        # Parse
-0000f440: 2069 6d61 6765 2d61 6273 7472 6163 7420   image-abstract 
-0000f450: 616e 6420 6669 6c6c 2069 7473 2070 6c61  and fill its pla
-0000f460: 6365 686f 6c64 6572 7320 7769 7468 2069  ceholders with i
-0000f470: 6e66 6f72 6d61 7469 6f6e 0a20 2020 2020  nformation.     
-0000f480: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000f490: 2020 2020 7365 6c66 2e69 6664 6f5f 746d      self.ifdo_tm
-0000f4a0: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
-0000f4b0: 6561 6465 724b 6579 5d5b 2769 6d61 6765  eaderKey]['image
-0000f4c0: 2d61 6273 7472 6163 7427 5d20 3d20 6d69  -abstract'] = mi
-0000f4d0: 7174 732e 7061 7273 6552 6570 6c61 6365  qts.parseReplace
-0000f4e0: 5661 6c28 7365 6c66 2e69 6664 6f5f 746d  Val(self.ifdo_tm
-0000f4f0: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
-0000f500: 6561 6465 724b 6579 5d2c 2027 696d 6167  eaderKey], 'imag
-0000f510: 652d 6162 7374 7261 6374 2729 0a20 2020  e-abstract').   
-0000f520: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-0000f530: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
-0000f540: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-0000f550: 6f76 2e6c 6f67 2822 436f 756c 6420 6e6f  ov.log("Could no
-0000f560: 7420 7265 706c 6163 6520 6b65 7973 2069  t replace keys i
-0000f570: 6e20 5c27 696d 6167 652d 6162 7374 7261  n \'image-abstra
-0000f580: 6374 5c27 3a20 2220 2b20 7374 7228 6578  ct\': " + str(ex
-0000f590: 2929 0a0a 0a20 2020 2020 2020 2023 2073  ))...        # s
-0000f5a0: 6574 2076 6572 7369 6f6e 2028 736f 2069  et version (so i
-0000f5b0: 7420 6361 6e6e 6f74 2062 6520 6368 616e  t cannot be chan
-0000f5c0: 6765 6420 6279 2075 7365 7229 0a20 2020  ged by user).   
-0000f5d0: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
-0000f5e0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-0000f5f0: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
-0000f600: 652d 7365 742d 6966 646f 2d76 6572 7369  e-set-ifdo-versi
-0000f610: 6f6e 275d 203d 206d 6971 7476 2e69 4644  on'] = miqtv.iFD
-0000f620: 4f5f 7665 7273 696f 6e0a 0a20 2020 2020  O_version..     
-0000f630: 2020 2023 2056 616c 6964 6174 6520 6974     # Validate it
-0000f640: 656d 2069 6e66 6f72 6d61 7469 6f6e 0a20  em information. 
-0000f650: 2020 2020 2020 2069 6d61 6765 5f73 6574         image_set
-0000f660: 5f69 7465 6d73 203d 207b 7d0a 2020 2020  _items = {}.    
-0000f670: 2020 2020 6966 2068 6561 6465 724f 6e6c      if headerOnl
-0000f680: 793a 0a20 2020 2020 2020 2020 2020 2073  y:.            s
-0000f690: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
-0000f6a0: 7574 696f 6e21 2069 4644 4f20 6372 6561  ution! iFDO crea
-0000f6b0: 7465 6420 696e 2068 6561 6465 725f 6f6e  ted in header_on
-0000f6c0: 6c79 2f69 676e 6f72 655f 696d 6167 655f  ly/ignore_image_
-0000f6d0: 6669 6c65 206d 6f64 652e 2049 6d61 6765  file mode. Image
-0000f6e0: 2069 7465 6d73 2061 7265 206e 6569 7468   items are neith
-0000f6f0: 6572 2075 7064 6174 6564 206e 6f72 2063  er updated nor c
-0000f700: 6865 636b 6564 2e22 290a 2020 2020 2020  hecked.").      
-0000f710: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000f720: 2020 2020 696e 7661 6c69 645f 6974 656d      invalid_item
-0000f730: 7320 3d20 300a 0a20 2020 2020 2020 2020  s = 0..         
-0000f740: 2020 2070 726f 6720 3d20 6d69 7174 632e     prog = miqtc.
-0000f750: 5072 696e 744b 6e6f 776e 5072 6f67 7265  PrintKnownProgre
-0000f760: 7373 4d73 6728 2243 6865 636b 696e 6720  ssMsg("Checking 
-0000f770: 6974 656d 7322 2c20 6c65 6e28 6974 656d  items", len(item
-0000f780: 7329 2c6d 6f64 756c 6f3d 3529 0a20 2020  s),modulo=5).   
-0000f790: 2020 2020 2020 2020 2066 6f72 2069 7465           for ite
-0000f7a0: 6d20 696e 2069 7465 6d73 3a0a 2020 2020  m in items:.    
-0000f7b0: 2020 2020 2020 2020 2020 2020 7072 6f67              prog
-0000f7c0: 2e70 726f 6772 6573 7328 290a 2020 2020  .progress().    
-0000f7d0: 2020 2020 2020 2020 2020 2020 2320 6368              # ch
-0000f7e0: 6563 6b20 6966 2061 6c6c 2063 6f72 6520  eck if all core 
-0000f7f0: 6669 656c 6473 2061 7265 2066 696c 6c65  fields are fille
-0000f800: 6420 616e 6420 6172 6520 6669 6c6c 6564  d and are filled
-0000f810: 2076 616c 6964 6c79 0a20 2020 2020 2020   validly.       
-0000f820: 2020 2020 2020 2020 2074 7279 3a0a 0a20           try:.. 
-0000f830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f840: 2020 2023 2063 6865 636b 2069 7465 6d20     # check item 
-0000f850: 696d 6167 6520 6578 6973 7473 0a20 2020  image exists.   
-0000f860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f870: 2023 2069 6620 6974 656d 2069 7320 6120   # if item is a 
-0000f880: 6c69 7374 2028 7669 6465 6f29 2c20 6f6e  list (video), on
-0000f890: 6520 776f 756c 6420 6861 7665 2074 6f20  e would have to 
-0000f8a0: 6368 6563 6b20 6966 2065 6163 6820 656e  check if each en
-0000f8b0: 7472 7920 6973 2076 616c 6964 2067 6976  try is valid giv
-0000f8c0: 656e 2074 6865 2064 6566 6175 6c74 2076  en the default v
-0000f8d0: 616c 7565 7320 696e 2066 6972 7374 2065  alues in first e
-0000f8e0: 6e74 7279 2070 6c75 7320 6769 7665 6e20  ntry plus given 
-0000f8f0: 6465 6661 756c 7420 7661 6c75 6573 2069  default values i
-0000f900: 6e20 6865 6164 6572 0a20 2020 2020 2020  n header.       
-0000f910: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000f920: 6e6f 7420 6973 696e 7374 616e 6365 2869  not isinstance(i
-0000f930: 7465 6d2c 6c69 7374 293a 0a20 2020 2020  tem,list):.     
-0000f940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f950: 2020 2069 7465 6d20 3d20 5b69 7465 6d5d     item = [item]
-0000f960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f970: 2020 2020 2073 7562 4974 656d 4465 6661       subItemDefa
-0000f980: 756c 7420 3d20 6974 656d 5b30 5d20 0a20  ult = item[0] . 
-0000f990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f9a0: 2020 2066 6f72 2073 7562 4974 656d 2069     for subItem i
-0000f9b0: 6e20 6974 656d 3a0a 2020 2020 2020 2020  n item:.        
-0000f9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f9d0: 6669 6c65 5f6e 616d 6520 3d20 7375 6249  file_name = subI
-0000f9e0: 7465 6d5b 2769 6d61 6765 2d66 696c 656e  tem['image-filen
-0000f9f0: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
-0000fa00: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000fa10: 206e 6f74 2073 656c 662e 6967 6e6f 7265   not self.ignore
-0000fa20: 5f69 6d61 6765 5f66 696c 6573 2061 6e64  _image_files and
-0000fa30: 2066 696c 655f 6e61 6d65 206e 6f74 2069   file_name not i
-0000fa40: 6e20 7365 6c66 2e5f 696d 6167 654e 616d  n self._imageNam
-0000fa50: 6573 496d 6167 6573 4469 723a 0a20 2020  esImagesDir:.   
-0000fa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa70: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
-0000fa80: 7863 6570 7469 6f6e 2822 4974 656d 2027  xception("Item '
-0000fa90: 2220 2b20 6669 6c65 5f6e 616d 6520 2b20  " + file_name + 
-0000faa0: 2227 206e 6f74 2066 6f75 6e64 2069 6e20  "' not found in 
-0000fab0: 2f72 6177 2064 6972 6563 746f 7279 2e22  /raw directory."
-0000fac0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000fad0: 2020 2020 2020 2020 2020 2069 6620 7661             if va
-0000fae0: 6c69 6461 7465 5f73 696e 676c 655f 6974  lidate_single_it
-0000faf0: 656d 733a 0a20 2020 2020 2020 2020 2020  ems:.           
-0000fb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb10: 206d 6971 7474 2e61 7265 5f76 616c 6964   miqtt.are_valid
-0000fb20: 5f69 6664 6f5f 6669 656c 6473 2873 7562  _ifdo_fields(sub
-0000fb30: 4974 656d 290a 2020 2020 2020 2020 2020  Item).          
-0000fb40: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0000fb50: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000fb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb70: 666f 7220 6669 656c 645f 6e61 6d65 2c66  for field_name,f
-0000fb80: 6965 6c64 5f76 616c 2069 6e20 7375 6249  ield_val in subI
-0000fb90: 7465 6d2e 6974 656d 7328 293a 0a20 2020  tem.items():.   
-0000fba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fbb0: 2020 2020 2020 2020 2020 2020 206d 6971               miq
-0000fbc0: 7474 2e69 6664 6f5f 6669 656c 645f 6164  tt.ifdo_field_ad
-0000fbd0: 6469 7469 6f6e 616c 5f63 6865 636b 7328  ditional_checks(
-0000fbe0: 6669 656c 645f 6e61 6d65 2c66 6965 6c64  field_name,field
-0000fbf0: 5f76 616c 2920 2020 2020 2020 2020 2020  _val)           
-0000fc00: 2020 2020 2020 2020 2020 2020 200a 0a20               .. 
-0000fc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc20: 2020 2069 6d61 6765 5f73 6574 5f69 7465     image_set_ite
-0000fc30: 6d73 5b73 7562 4974 656d 4465 6661 756c  ms[subItemDefaul
-0000fc40: 745b 2769 6d61 6765 2d66 696c 656e 616d  t['image-filenam
-0000fc50: 6527 5d5d 203d 205b 5d20 2320 636f 756c  e']] = [] # coul
-0000fc60: 6420 6d61 6b65 2061 6e20 6578 7472 6120  d make an extra 
-0000fc70: 6361 7365 2066 6f72 2069 6d61 6765 7320  case for images 
-0000fc80: 6f6d 6974 7469 6e67 2074 6865 206c 6973  omitting the lis
-0000fc90: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0000fca0: 2020 2020 2020 666f 7220 7375 6249 7465        for subIte
-0000fcb0: 6d20 696e 2069 7465 6d3a 0a20 2020 2020  m in item:.     
-0000fcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fcd0: 2020 2073 7562 4974 656d 4469 6374 203d     subItemDict =
-0000fce0: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
-0000fcf0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000fd00: 6974 2069 6e20 7375 6249 7465 6d3a 0a20  it in subItem:. 
-0000fd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd20: 2020 2020 2020 2020 2020 2069 6620 6974             if it
-0000fd30: 2021 3d20 2769 6d61 6765 2d66 696c 656e   != 'image-filen
-0000fd40: 616d 6527 3a0a 2020 2020 2020 2020 2020  ame':.          
-0000fd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd60: 2020 2020 2020 7375 6249 7465 6d44 6963        subItemDic
-0000fd70: 745b 6974 5d20 3d20 7375 6249 7465 6d5b  t[it] = subItem[
-0000fd80: 6974 5d0a 2020 2020 2020 2020 2020 2020  it].            
-0000fd90: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-0000fda0: 655f 7365 745f 6974 656d 735b 7375 6249  e_set_items[subI
-0000fdb0: 7465 6d44 6566 6175 6c74 5b27 696d 6167  temDefault['imag
-0000fdc0: 652d 6669 6c65 6e61 6d65 275d 5d2e 6170  e-filename']].ap
-0000fdd0: 7065 6e64 2873 7562 4974 656d 4469 6374  pend(subItemDict
-0000fde0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000fdf0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-0000fe00: 2020 2065 7863 6570 7420 6d69 7174 632e     except miqtc.
-0000fe10: 4966 646f 4578 6365 7074 696f 6e20 6173  IfdoException as
-0000fe20: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0000fe30: 2020 2020 2020 2020 696e 7661 6c69 645f          invalid_
-0000fe40: 6974 656d 7320 2b3d 2031 0a20 2020 2020  items += 1.     
-0000fe50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000fe60: 656c 662e 7072 6f76 2e6c 6f67 2822 496e  elf.prov.log("In
-0000fe70: 7661 6c69 6420 696d 6167 6520 6974 656d  valid image item
-0000fe80: 3a20 222b 2073 7472 2869 7465 6d29 2c64  : "+ str(item),d
-0000fe90: 6f6e 7453 686f 773d 5472 7565 290a 2020  ontShow=True).  
-0000fea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000feb0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-0000fec0: 2245 7863 6570 7469 6f6e 3a5c 6e22 2b20  "Exception:\n"+ 
-0000fed0: 7374 7228 652e 6172 6773 292c 646f 6e74  str(e.args),dont
-0000fee0: 5368 6f77 3d54 7275 6529 0a20 2020 2020  Show=True).     
-0000fef0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000ff00: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
-0000ff10: 7863 6570 7469 6f6e 2822 496e 7661 6c69  xception("Invali
-0000ff20: 6420 696d 6167 6520 6974 656d 2022 2b20  d image item "+ 
-0000ff30: 6669 6c65 5f6e 616d 6520 2b20 223a 5c6e  file_name + ":\n
-0000ff40: 4578 6365 7074 696f 6e3a 5c6e 222b 2073  Exception:\n"+ s
-0000ff50: 7472 2865 2e61 7267 7329 2920 2320 6f74  tr(e.args)) # ot
-0000ff60: 6865 7277 6973 652c 2069 6e20 6361 7365  herwise, in case
-0000ff70: 206f 6620 6d61 6e79 2069 6d61 6765 732c   of many images,
-0000ff80: 2069 7420 6d61 7920 6b65 6570 2072 756e   it may keep run
-0000ff90: 6e69 6e67 2061 6e64 2074 6872 6f77 696e  ning and throwin
-0000ffa0: 6720 6572 726f 7273 2066 6f72 2071 7569  g errors for qui
-0000ffb0: 7420 736f 6d65 2074 696d 650a 2020 2020  t some time.    
-0000ffc0: 2020 2020 2020 2020 7072 6f67 2e63 6c65          prog.cle
-0000ffd0: 6172 2829 0a0a 2020 2020 2020 2020 2020  ar()..          
-0000ffe0: 2020 6966 206c 656e 2869 7465 6d73 2920    if len(items) 
-0000fff0: 213d 2030 2061 6e64 2069 6e76 616c 6964  != 0 and invalid
-00010000: 5f69 7465 6d73 203d 3d20 6c65 6e28 6974  _items == len(it
-00010010: 656d 7329 3a0a 2020 2020 2020 2020 2020  ems):.          
-00010020: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-00010030: 7074 696f 6e28 2241 6c6c 2069 7465 6d73  ption("All items
-00010040: 2061 7265 2069 6e76 616c 6964 2229 0a20   are invalid"). 
-00010050: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00010060: 696e 7661 6c69 645f 6974 656d 7320 3e20  invalid_items > 
-00010070: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00010080: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00010090: 2822 4174 206c 6561 7374 2022 202b 2073  ("At least " + s
-000100a0: 7472 2869 6e76 616c 6964 5f69 7465 6d73  tr(invalid_items
-000100b0: 2920 2b20 2220 6974 656d 7320 7765 7265  ) + " items were
-000100c0: 2069 6e76 616c 6964 2028 6f66 2220 2b20   invalid (of" + 
-000100d0: 7374 7228 6c65 6e28 6974 656d 7329 292b  str(len(items))+
-000100e0: 2022 2922 290a 0a20 2020 2020 2020 2023   ")")..        #
-000100f0: 2056 616c 6964 6174 6520 6865 6164 6572   Validate header
-00010100: 2069 6e66 6f72 6d61 7469 6f6e 0a20 2020   information.   
-00010110: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00010120: 2020 2020 2020 6d69 7174 742e 6172 655f        miqtt.are_
-00010130: 7661 6c69 645f 6966 646f 5f66 6965 6c64  valid_ifdo_field
-00010140: 7328 7365 6c66 2e69 6664 6f5f 746d 705b  s(self.ifdo_tmp[
-00010150: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-00010160: 6465 724b 6579 5d29 0a20 2020 2020 2020  derKey]).       
-00010170: 2065 7863 6570 7420 6d69 7174 632e 4966   except miqtc.If
-00010180: 646f 4578 6365 7074 696f 6e20 6173 2065  doException as e
-00010190: 783a 0a20 2020 2020 2020 2020 2020 206d  x:.            m
-000101a0: 7367 203d 2022 496e 7661 6c69 6420 6865  sg = "Invalid he
-000101b0: 6164 6572 2066 6965 6c64 3a20 2220 2b20  ader field: " + 
-000101c0: 7374 7228 6578 290a 2020 2020 2020 2020  str(ex).        
-000101d0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-000101e0: 6728 2245 7863 6570 7469 6f6e 3a20 2220  g("Exception: " 
-000101f0: 2b20 6d73 672c 2064 6f6e 7453 686f 773d  + msg, dontShow=
-00010200: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00010210: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
-00010220: 646f 4578 6365 7074 696f 6e28 6d73 6729  doException(msg)
-00010230: 0a0a 2020 2020 2020 2020 2320 7075 7420  ..        # put 
-00010240: 6974 656d 2069 6e66 6f20 696e 746f 2073  item info into s
-00010250: 656c 662e 6966 646f 5f74 6d70 0a20 2020  elf.ifdo_tmp.   
-00010260: 2020 2020 2073 203d 206d 6971 7463 2e50       s = miqtc.P
-00010270: 7269 6e74 4c6f 6164 696e 674d 7367 2822  rintLoadingMsg("
-00010280: 5570 6461 7469 6e67 2229 0a20 2020 2020  Updating").     
-00010290: 2020 206c 6f67 203d 206d 6971 7463 2e72     log = miqtc.r
-000102a0: 6563 7572 7369 7665 6c79 5570 6461 7465  ecursivelyUpdate
-000102b0: 4469 6374 7328 7365 6c66 2e69 6664 6f5f  Dicts(self.ifdo_
-000102c0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-000102d0: 7449 7465 6d73 4b65 795d 2c20 696d 6167  tItemsKey], imag
-000102e0: 655f 7365 745f 6974 656d 7329 0a20 2020  e_set_items).   
-000102f0: 2020 2020 2073 2e73 746f 7028 290a 2020       s.stop().  
-00010300: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-00010310: 6c6f 6728 6c6f 6729 0a0a 2020 2020 2020  log(log)..      
-00010320: 2020 2320 7365 7420 6c61 7420 6c6f 6e20    # set lat lon 
-00010330: 626f 756e 6469 6e67 2062 6f78 0a20 2020  bounding box.   
-00010340: 2020 2020 2073 656c 662e 5f73 6574 5f6c       self._set_l
-00010350: 6174 5f6c 6f6e 5f62 6f75 6e64 696e 675f  at_lon_bounding_
-00010360: 626f 7828 7365 6c66 2e69 6664 6f5f 746d  box(self.ifdo_tm
-00010370: 7029 0a0a 2020 2020 2020 2020 2320 7365  p)..        # se
-00010380: 7420 7265 7072 6573 656e 7461 7469 7665  t representative
-00010390: 2068 6561 6465 7220 6669 656c 6473 2064   header fields d
-000103a0: 6174 6574 696d 652c 206c 6174 2c20 6c6f  atetime, lat, lo
-000103b0: 6e2c 2061 6c74 0a20 2020 2020 2020 2073  n, alt.        s
-000103c0: 656c 662e 5f73 6574 5f72 6570 5f68 6561  elf._set_rep_hea
-000103d0: 6465 725f 6669 656c 6473 5f64 745f 6c61  der_fields_dt_la
-000103e0: 745f 6c6f 6e5f 616c 7428 7365 6c66 2e69  t_lon_alt(self.i
-000103f0: 6664 6f5f 746d 7029 0a0a 2020 2020 2020  fdo_tmp)..      
-00010400: 2020 7365 6c66 2e5f 7365 745f 696d 6167    self._set_imag
-00010410: 655f 6974 656d 5f69 6465 6e74 6966 6963  e_item_identific
-00010420: 6174 696f 6e5f 7363 6865 6d65 2873 656c  ation_scheme(sel
-00010430: 662e 6966 646f 5f74 6d70 290a 0a20 2020  f.ifdo_tmp)..   
-00010440: 2020 2020 2023 2072 656d 6f76 6520 656d       # remove em
-00010450: 7470 7920 6669 656c 6473 0a20 2020 2020  tpy fields.     
-00010460: 2020 2073 203d 206d 6971 7463 2e50 7269     s = miqtc.Pri
-00010470: 6e74 4c6f 6164 696e 674d 7367 2822 5265  ntLoadingMsg("Re
-00010480: 6d6f 7669 6e67 2065 6d70 7479 2066 6965  moving empty fie
-00010490: 6c64 7322 290a 2020 2020 2020 2020 7365  lds").        se
-000104a0: 6c66 2e69 6664 6f5f 746d 7020 3d20 6d69  lf.ifdo_tmp = mi
-000104b0: 7174 632e 7265 6375 7273 6976 656c 7952  qtc.recursivelyR
-000104c0: 656d 6f76 6545 6d70 7479 4669 656c 6473  emoveEmptyFields
-000104d0: 2873 656c 662e 6966 646f 5f74 6d70 290a  (self.ifdo_tmp).
-000104e0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-000104f0: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-00010500: 734b 6579 2069 6e20 7365 6c66 2e69 6664  sKey in self.ifd
-00010510: 6f5f 746d 703a 0a20 2020 2020 2020 2020  o_tmp:.         
-00010520: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-00010530: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
-00010540: 656d 734b 6579 5d20 3d20 5b5d 0a20 2020  emsKey] = [].   
-00010550: 2020 2020 2023 2072 656d 6f76 6520 6669       # remove fi
-00010560: 656c 6473 2074 6861 7420 636f 6e74 6169  elds that contai
-00010570: 6e20 2769 6d61 6765 2d64 6174 6574 696d  n 'image-datetim
-00010580: 6527 206f 6e6c 790a 2020 2020 2020 2020  e' only.        
-00010590: 7365 6c66 2e72 656d 6f76 6549 7465 6d46  self.removeItemF
-000105a0: 6965 6c64 7357 6974 684f 6e6c 7944 6174  ieldsWithOnlyDat
-000105b0: 6554 696d 6528 290a 2020 2020 2020 2020  eTime().        
-000105c0: 732e 7374 6f70 2829 0a0a 2020 2020 2020  s.stop()..      
-000105d0: 2020 6966 206e 6f74 2073 656c 662e 6967    if not self.ig
-000105e0: 6e6f 7265 5f69 6d61 6765 5f66 696c 6573  nore_image_files
-000105f0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00010600: 6c66 2e63 6865 636b 416c 6c49 7465 6d48  lf.checkAllItemH
-00010610: 6173 6865 7328 290a 0a20 2020 2020 2020  ashes()..       
-00010620: 2023 2063 6865 636b 2061 6761 696e 7374   # check against
-00010630: 2073 6368 656d 610a 2020 2020 2020 2020   schema.        
-00010640: 7661 6c69 642c 206d 7367 203d 206d 6971  valid, msg = miq
-00010650: 7474 2e76 616c 6964 6174 655f 6966 646f  tt.validate_ifdo
-00010660: 2873 656c 662e 6966 646f 5f74 6d70 290a  (self.ifdo_tmp).
-00010670: 2020 2020 2020 2020 6966 206e 6f74 2076          if not v
-00010680: 616c 6964 2061 6e64 206e 6f74 2061 6c6c  alid and not all
-00010690: 6f77 5f6d 6973 7369 6e67 5f72 6571 7569  ow_missing_requi
-000106a0: 7265 643a 0a20 2020 2020 2020 2020 2020  red:.           
-000106b0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-000106c0: 5761 726e 696e 6721 2069 4644 4f20 6e6f  Warning! iFDO no
-000106d0: 2076 616c 6964 2079 6574 3a20 2220 2b20   valid yet: " + 
-000106e0: 6d73 6729 0a20 2020 2020 2020 2020 2020  msg).           
-000106f0: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
-00010700: 6f45 7863 6570 7469 6f6e 286d 7367 290a  oException(msg).
-00010710: 0a20 2020 2020 2020 2023 2073 6574 2066  .        # set f
-00010720: 696e 616c 206f 6e65 0a20 2020 2020 2020  inal one.       
-00010730: 2073 656c 662e 6966 646f 5f63 6865 636b   self.ifdo_check
-00010740: 6564 203d 2063 6f70 792e 6465 6570 636f  ed = copy.deepco
-00010750: 7079 2873 656c 662e 6966 646f 5f74 6d70  py(self.ifdo_tmp
-00010760: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00010770: 2073 656c 662e 6966 646f 5f63 6865 636b   self.ifdo_check
-00010780: 6564 0a0a 0a20 2020 2064 6566 205f 7365  ed...    def _se
-00010790: 745f 696d 6167 655f 6974 656d 5f69 6465  t_image_item_ide
-000107a0: 6e74 6966 6963 6174 696f 6e5f 7363 6865  ntification_sche
-000107b0: 6d65 2873 656c 662c 6966 646f 3a64 6963  me(self,ifdo:dic
-000107c0: 7429 3a0a 2020 2020 2020 2020 2222 2220  t):.        """ 
-000107d0: 5365 7420 696d 6167 652d 6974 656d 2d69  Set image-item-i
-000107e0: 6465 6e74 6966 6963 6174 696f 6e2d 7363  dentification-sc
-000107f0: 6865 6d65 2074 6f20 6069 6d61 6765 2d70  heme to `image-p
-00010800: 726f 6a65 6374 5f69 6d61 6765 2d65 7665  roject_image-eve
-00010810: 6e74 5f69 6d61 6765 2d73 656e 736f 725f  nt_image-sensor_
-00010820: 696d 6167 652d 6461 7465 7469 6d65 2e65  image-datetime.e
-00010830: 7874 6020 6966 2065 6d70 7479 2e20 2222  xt` if empty. ""
-00010840: 220a 2020 2020 2020 2020 6966 2066 696e  ".        if fin
-00010850: 6446 6965 6c64 2869 6664 6f5b 7365 6c66  dField(ifdo[self
-00010860: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-00010870: 6579 5d2c 2769 6d61 6765 2d69 7465 6d2d  ey],'image-item-
-00010880: 6964 656e 7469 6669 6361 7469 6f6e 2d73  identification-s
-00010890: 6368 656d 6527 2920 3d3d 2022 223a 0a20  cheme') == "":. 
-000108a0: 2020 2020 2020 2020 2020 2069 6664 6f5b             ifdo[
-000108b0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-000108c0: 6465 724b 6579 5d5b 2769 6d61 6765 2d69  derKey]['image-i
-000108d0: 7465 6d2d 6964 656e 7469 6669 6361 7469  tem-identificati
-000108e0: 6f6e 2d73 6368 656d 6527 5d20 3d20 2027  on-scheme'] =  '
-000108f0: 696d 6167 652d 7072 6f6a 6563 745f 696d  image-project_im
-00010900: 6167 652d 6576 656e 745f 696d 6167 652d  age-event_image-
-00010910: 7365 6e73 6f72 5f69 6d61 6765 2d64 6174  sensor_image-dat
-00010920: 6574 696d 652e 6578 7427 0a0a 0a20 2020  etime.ext'...   
-00010930: 2064 6566 205f 7365 745f 7265 705f 6865   def _set_rep_he
-00010940: 6164 6572 5f66 6965 6c64 735f 6474 5f6c  ader_fields_dt_l
-00010950: 6174 5f6c 6f6e 5f61 6c74 2873 656c 662c  at_lon_alt(self,
-00010960: 6966 646f 3a64 6963 7429 3a0a 2020 2020  ifdo:dict):.    
-00010970: 2020 2020 2222 2220 4669 6c6c 2068 6561      """ Fill hea
-00010980: 6465 7220 6669 656c 6473 2069 6d61 6765  der fields image
-00010990: 2d64 6174 6574 696d 6520 616e 6420 2d6c  -datetime and -l
-000109a0: 6174 6974 7564 652c 202d 6c6f 6e67 6974  atitude, -longit
-000109b0: 7565 6465 2c20 2d61 6c74 6974 7564 652d  uede, -altitude-
-000109c0: 6d65 7465 7273 2c20 2d63 6f6f 7264 696e  meters, -coordin
-000109d0: 6174 652d 756e 6365 7274 6169 6e74 792d  ate-uncertainty-
-000109e0: 6d65 7465 7273 2c20 6966 2065 6d70 7479  meters, if empty
-000109f0: 2c0a 2020 2020 2020 2020 7265 7072 6573  ,.        repres
-00010a00: 656e 7461 7469 7665 6c79 2077 6974 6820  entatively with 
-00010a10: 6669 7273 7420 6974 656d 7320 656e 7472  first items entr
-00010a20: 7920 616e 6420 6d65 6469 616e 206f 6620  y and median of 
-00010a30: 616c 6c20 6974 656d 7320 7661 6c75 6573  all items values
-00010a40: 2c20 7265 7370 6563 7469 7665 6c79 2e20  , respectively. 
-00010a50: 2222 220a 0a20 2020 2020 2020 2023 2027  """..        # '
-00010a60: 696d 6167 652d 6461 7465 7469 6d65 270a  image-datetime'.
-00010a70: 2020 2020 2020 2020 6669 7273 745f 696d          first_im
-00010a80: 6167 6520 3d20 736f 7274 6564 2869 6664  age = sorted(ifd
-00010a90: 6f5b 7365 6c66 2e69 6d61 6765 5365 7449  o[self.imageSetI
-00010aa0: 7465 6d73 4b65 795d 2e6b 6579 7328 2929  temsKey].keys())
-00010ab0: 5b30 5d0a 2020 2020 2020 2020 6669 656c  [0].        fiel
-00010ac0: 6420 3d20 2769 6d61 6765 2d64 6174 6574  d = 'image-datet
-00010ad0: 696d 6527 0a20 2020 2020 2020 2069 6620  ime'.        if 
-00010ae0: 6669 6e64 4669 656c 6428 6966 646f 5b73  findField(ifdo[s
-00010af0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-00010b00: 6572 4b65 795d 2c66 6965 6c64 2920 3d3d  erKey],field) ==
-00010b10: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-00010b20: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00010b30: 2020 2020 2020 6966 646f 5b73 656c 662e        ifdo[self.
-00010b40: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-00010b50: 795d 5b66 6965 6c64 5d20 3d20 7365 6c66  y][field] = self
-00010b60: 2e5f 5f67 6574 4669 656c 6456 616c 7565  .__getFieldValue
-00010b70: 2869 6664 6f2c 5b66 6972 7374 5f69 6d61  (ifdo,[first_ima
-00010b80: 6765 2c66 6965 6c64 5d2c 6465 6661 756c  ge,field],defaul
-00010b90: 745f 6f6e 6c79 3d54 7275 6529 0a20 2020  t_only=True).   
-00010ba0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00010bb0: 662e 7072 6f76 2e6c 6f67 2822 5365 7420  f.prov.log("Set 
-00010bc0: 7265 7072 6573 656e 7461 7469 7665 2068  representative h
-00010bd0: 6561 6465 7220 6669 656c 6420 2722 202b  eader field '" +
-00010be0: 2066 6965 6c64 202b 2022 2720 746f 2022   field + "' to "
-00010bf0: 202b 2073 7472 2869 6664 6f5b 7365 6c66   + str(ifdo[self
-00010c00: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-00010c10: 6579 5d5b 6669 656c 645d 2920 2b20 2220  ey][field]) + " 
-00010c20: 6672 6f6d 2066 6972 7374 2069 6d61 6765  from first image
-00010c30: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00010c40: 6578 6365 7074 206d 6971 7463 2e49 6664  except miqtc.Ifd
-00010c50: 6f45 7863 6570 7469 6f6e 2061 7320 6578  oException as ex
-00010c60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010c70: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-00010c80: 2243 6f75 6c64 206e 6f74 2073 6574 2072  "Could not set r
-00010c90: 6570 7265 7365 6e74 6174 6976 6520 6865  epresentative he
-00010ca0: 6164 6572 2066 6965 6c64 3a20 2220 2b20  ader field: " + 
-00010cb0: 7374 7228 6578 2929 0a20 2020 2020 2020  str(ex)).       
-00010cc0: 2020 2020 2020 2020 2070 6173 730a 0a20           pass.. 
-00010cd0: 2020 2020 2020 2023 2072 6573 740a 2020         # rest.  
-00010ce0: 2020 2020 2020 7265 705f 6865 6164 6572        rep_header
-00010cf0: 5f66 6965 6c64 735f 6d65 6469 616e 203d  _fields_median =
-00010d00: 205b 2769 6d61 6765 2d6c 6174 6974 7564   ['image-latitud
-00010d10: 6527 2c27 696d 6167 652d 6c6f 6e67 6974  e','image-longit
-00010d20: 7564 6527 2c27 696d 6167 652d 616c 7469  ude','image-alti
-00010d30: 7475 6465 2d6d 6574 6572 7327 2c27 696d  tude-meters','im
-00010d40: 6167 652d 636f 6f72 6469 6e61 7465 2d75  age-coordinate-u
-00010d50: 6e63 6572 7461 696e 7479 2d6d 6574 6572  ncertainty-meter
-00010d60: 7327 5d0a 2020 2020 2020 2020 666f 7220  s'].        for 
-00010d70: 6669 656c 6420 696e 2072 6570 5f68 6561  field in rep_hea
-00010d80: 6465 725f 6669 656c 6473 5f6d 6564 6961  der_fields_media
-00010d90: 6e3a 0a20 2020 2020 2020 2020 2020 2069  n:.            i
-00010da0: 6620 6669 6e64 4669 656c 6428 6966 646f  f findField(ifdo
-00010db0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-00010dc0: 6164 6572 4b65 795d 2c66 6965 6c64 2920  aderKey],field) 
-00010dd0: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
-00010de0: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
-00010df0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
-00010e00: 2020 2066 6f72 2069 6d61 6765 5f6e 616d     for image_nam
-00010e10: 6520 696e 2069 6664 6f5b 7365 6c66 2e69  e in ifdo[self.i
-00010e20: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
-00010e30: 2e6b 6579 7328 293a 0a20 2020 2020 2020  .keys():.       
-00010e40: 2020 2020 2020 2020 2020 2020 2074 7279               try
-00010e50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010e60: 2020 2020 2020 2020 2020 6974 656d 5f76            item_v
-00010e70: 616c 203d 2073 656c 662e 5f5f 6765 7446  al = self.__getF
-00010e80: 6965 6c64 5661 6c75 6528 6966 646f 2c5b  ieldValue(ifdo,[
-00010e90: 696d 6167 655f 6e61 6d65 2c66 6965 6c64  image_name,field
-00010ea0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00010eb0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00010ec0: 696e 7374 616e 6365 2869 7465 6d5f 7661  instance(item_va
-00010ed0: 6c2c 6469 6374 293a 0a20 2020 2020 2020  l,dict):.       
-00010ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ef0: 2020 2020 2076 616c 7565 7320 2b3d 206c       values += l
-00010f00: 6973 7428 6974 656d 5f76 616c 2e76 616c  ist(item_val.val
-00010f10: 7565 7328 2929 0a20 2020 2020 2020 2020  ues()).         
-00010f20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00010f30: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00010f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f50: 2076 616c 7565 732e 6170 7065 6e64 2869   values.append(i
-00010f60: 7465 6d5f 7661 6c29 0a20 2020 2020 2020  tem_val).       
-00010f70: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00010f80: 6570 7420 6d69 7174 632e 4966 646f 4578  ept miqtc.IfdoEx
-00010f90: 6365 7074 696f 6e20 6173 2065 783a 0a20  ception as ex:. 
-00010fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010fb0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00010fc0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-00010fd0: 6573 203d 205b 6920 666f 7220 6920 696e  es = [i for i in
-00010fe0: 2076 616c 7565 7320 6966 2069 2021 3d20   values if i != 
-00010ff0: 2727 5d0a 2020 2020 2020 2020 2020 2020  ''].            
-00011000: 2020 2020 6966 206c 656e 2876 616c 7565      if len(value
-00011010: 7329 203d 3d20 303a 0a20 2020 2020 2020  s) == 0:.       
-00011020: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00011030: 662e 7072 6f76 2e6c 6f67 2822 436f 756c  f.prov.log("Coul
-00011040: 6420 6e6f 7420 7365 7420 7265 7072 6573  d not set repres
-00011050: 656e 7461 7469 7665 2068 6561 6465 7220  entative header 
-00011060: 6669 656c 642c 206e 6f20 7661 6c75 6573  field, no values
-00011070: 2066 6f75 6e64 3a20 2220 2b20 6669 656c   found: " + fiel
-00011080: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
-00011090: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000110a0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-000110b0: 676e 6f72 6520 756e 6b6e 6f6e 772c 2069  gnore unknonw, i
-000110c0: 2e65 2e20 302e 302c 2076 616c 7565 730a  .e. 0.0, values.
-000110d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000110e0: 2020 2020 7661 6c75 6573 203d 205b 6920      values = [i 
-000110f0: 666f 7220 6920 696e 2076 616c 7565 7320  for i in values 
-00011100: 6966 2069 2021 3d20 302e 305d 0a20 2020  if i != 0.0].   
-00011110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011120: 2069 6620 6c65 6e28 7661 6c75 6573 2920   if len(values) 
-00011130: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00011140: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00011150: 6c75 6573 2e61 7070 656e 6428 302e 3029  lues.append(0.0)
-00011160: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00011170: 2020 2020 2020 6966 646f 5b73 656c 662e        ifdo[self.
-00011180: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-00011190: 795d 5b66 6965 6c64 5d20 3d20 7374 6174  y][field] = stat
-000111a0: 6973 7469 6373 2e6d 6564 6961 6e28 7661  istics.median(va
-000111b0: 6c75 6573 290a 2020 2020 2020 2020 2020  lues).          
-000111c0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-000111d0: 726f 762e 6c6f 6728 2253 6574 2072 6570  rov.log("Set rep
-000111e0: 7265 7365 6e74 6174 6976 6520 6865 6164  resentative head
-000111f0: 6572 2066 6965 6c64 2027 2220 2b20 6669  er field '" + fi
-00011200: 656c 6420 2b20 2227 2074 6f20 6d65 6469  eld + "' to medi
-00011210: 616e 3a20 2220 2b20 7374 7228 6966 646f  an: " + str(ifdo
-00011220: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-00011230: 6164 6572 4b65 795d 5b66 6965 6c64 5d29  aderKey][field])
-00011240: 202b 2022 2e22 290a 0a0a 2020 2020 6465   + ".")...    de
-00011250: 6620 5f73 6574 5f6c 6174 5f6c 6f6e 5f62  f _set_lat_lon_b
-00011260: 6f75 6e64 696e 675f 626f 7828 7365 6c66  ounding_box(self
-00011270: 2c69 6664 6f3a 6469 6374 293a 0a20 2020  ,ifdo:dict):.   
-00011280: 2020 2020 2022 2222 2053 6574 2069 6d61       """ Set ima
-00011290: 6765 2d73 6574 2d5b 6d69 6e2c 6d61 785d  ge-set-[min,max]
-000112a0: 2d5b 6c61 7469 7475 6465 2c6c 6f6e 6769  -[latitude,longi
-000112b0: 7475 6465 5d2d 6465 6772 6565 7320 2222  tude]-degrees ""
-000112c0: 220a 2020 2020 2020 2020 6c61 745f 6d69  ".        lat_mi
-000112d0: 6e2c 206c 6174 5f6d 6178 2c20 6c6f 6e5f  n, lat_max, lon_
-000112e0: 6d69 6e2c 206c 6f6e 5f6d 6178 203d 2073  min, lon_max = s
-000112f0: 656c 662e 5f67 6574 5f6c 6174 5f6c 6f6e  elf._get_lat_lon
-00011300: 5f62 6f75 6e64 696e 675f 626f 7828 6966  _bounding_box(if
-00011310: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
-00011320: 4974 656d 734b 6579 5d29 0a20 2020 2020  ItemsKey]).     
-00011330: 2020 2069 6620 6e6f 7420 4e6f 6e65 2069     if not None i
-00011340: 6e20 5b6c 6174 5f6d 696e 2c20 6c61 745f  n [lat_min, lat_
-00011350: 6d61 782c 206c 6f6e 5f6d 696e 2c20 6c6f  max, lon_min, lo
-00011360: 6e5f 6d61 785d 3a0a 2020 2020 2020 2020  n_max]:.        
-00011370: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
-00011380: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-00011390: 5b27 696d 6167 652d 7365 742d 6d69 6e2d  ['image-set-min-
-000113a0: 6c61 7469 7475 6465 2d64 6567 7265 6573  latitude-degrees
-000113b0: 275d 203d 206c 6174 5f6d 696e 0a20 2020  '] = lat_min.   
-000113c0: 2020 2020 2020 2020 2069 6664 6f5b 7365           ifdo[se
-000113d0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-000113e0: 724b 6579 5d5b 2769 6d61 6765 2d73 6574  rKey]['image-set
-000113f0: 2d6d 6178 2d6c 6174 6974 7564 652d 6465  -max-latitude-de
-00011400: 6772 6565 7327 5d20 3d20 6c61 745f 6d61  grees'] = lat_ma
-00011410: 780a 2020 2020 2020 2020 2020 2020 6966  x.            if
-00011420: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
-00011430: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
-00011440: 652d 7365 742d 6d69 6e2d 6c6f 6e67 6974  e-set-min-longit
-00011450: 7564 652d 6465 6772 6565 7327 5d20 3d20  ude-degrees'] = 
-00011460: 6c6f 6e5f 6d69 6e0a 2020 2020 2020 2020  lon_min.        
-00011470: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
-00011480: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-00011490: 5b27 696d 6167 652d 7365 742d 6d61 782d  ['image-set-max-
-000114a0: 6c6f 6e67 6974 7564 652d 6465 6772 6565  longitude-degree
-000114b0: 7327 5d20 3d20 6c6f 6e5f 6d61 780a 0a0a  s'] = lon_max...
-000114c0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
-000114d0: 640a 2020 2020 6465 6620 5f67 6574 5f6c  d.    def _get_l
-000114e0: 6174 5f6c 6f6e 5f62 6f75 6e64 696e 675f  at_lon_bounding_
-000114f0: 626f 7828 6974 656d 733a 6469 6374 293a  box(items:dict):
-00011500: 0a20 2020 2020 2020 2022 2222 2052 6574  .        """ Ret
-00011510: 7572 6e73 206c 6174 5f6d 696e 2c20 6c61  urns lat_min, la
-00011520: 745f 6d61 782c 206c 6f6e 5f6d 696e 2c20  t_max, lon_min, 
-00011530: 6c6f 6e5f 6d61 7820 2222 220a 2020 2020  lon_max """.    
-00011540: 2020 2020 6c61 745f 6d69 6e2c 206c 6174      lat_min, lat
-00011550: 5f6d 6178 2c20 6c6f 6e5f 6d69 6e2c 206c  _max, lon_min, l
-00011560: 6f6e 5f6d 6178 203d 204e 6f6e 652c 204e  on_max = None, N
-00011570: 6f6e 652c 204e 6f6e 652c 204e 6f6e 650a  one, None, None.
-00011580: 2020 2020 2020 2020 6920 3d20 300a 2020          i = 0.  
-00011590: 2020 2020 2020 666f 7220 696d 6167 652c        for image,
-000115a0: 2064 6174 6120 696e 2069 7465 6d73 2e69   data in items.i
-000115b0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-000115c0: 2020 2020 2320 6d61 6b65 2069 6d61 6765      # make image
-000115d0: 2065 6e74 7279 206c 6973 7420 2861 6c73   entry list (als
-000115e0: 6f20 6966 2069 7473 2061 2070 6963 7475  o if its a pictu
-000115f0: 7265 290a 2020 2020 2020 2020 2020 2020  re).            
-00011600: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-00011610: 6528 6461 7461 2c20 6c69 7374 293a 0a20  e(data, list):. 
-00011620: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00011630: 6174 6120 3d20 5b64 6174 615d 0a20 2020  ata = [data].   
-00011640: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00011650: 2020 2020 2020 666f 7220 7469 6d65 706f        for timepo
-00011660: 696e 745f 6461 7461 2069 6e20 6461 7461  int_data in data
-00011670: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00011680: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00011690: 2020 2020 2020 2020 2020 206c 6174 203d             lat =
-000116a0: 2074 696d 6570 6f69 6e74 5f64 6174 615b   timepoint_data[
-000116b0: 2769 6d61 6765 2d6c 6174 6974 7564 6527  'image-latitude'
-000116c0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000116d0: 2020 2020 2020 6c6f 6e20 3d20 7469 6d65        lon = time
-000116e0: 706f 696e 745f 6461 7461 5b27 696d 6167  point_data['imag
-000116f0: 652d 6c6f 6e67 6974 7564 6527 5d0a 2020  e-longitude'].  
-00011700: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00011710: 6365 7074 204b 6579 4572 726f 7220 6173  cept KeyError as
-00011720: 2065 783a 0a20 2020 2020 2020 2020 2020   ex:.           
-00011730: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00011740: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-00011750: 2020 2069 6620 6920 3d3d 2030 3a0a 2020     if i == 0:.  
-00011760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011770: 2020 6c61 745f 6d69 6e2c 206c 6174 5f6d    lat_min, lat_m
-00011780: 6178 203d 206c 6174 2c20 6c61 740a 2020  ax = lat, lat.  
-00011790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000117a0: 2020 6c6f 6e5f 6d69 6e2c 206c 6f6e 5f6d    lon_min, lon_m
-000117b0: 6178 203d 206c 6f6e 2c20 6c6f 6e0a 2020  ax = lon, lon.  
-000117c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000117d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000117e0: 2020 2020 2020 2020 6966 206c 6174 203c          if lat <
-000117f0: 206c 6174 5f6d 696e 3a0a 2020 2020 2020   lat_min:.      
-00011800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011810: 2020 6c61 745f 6d69 6e20 3d20 6c61 740a    lat_min = lat.
-00011820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011830: 2020 2020 6966 206c 6174 203e 206c 6174      if lat > lat
-00011840: 5f6d 6178 3a0a 2020 2020 2020 2020 2020  _max:.          
-00011850: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00011860: 745f 6d61 7820 3d20 6c61 740a 2020 2020  t_max = lat.    
-00011870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011880: 6966 206c 6f6e 203c 206c 6f6e 5f6d 696e  if lon < lon_min
-00011890: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000118a0: 2020 2020 2020 2020 2020 6c6f 6e5f 6d69            lon_mi
-000118b0: 6e20 3d20 6c6f 6e0a 2020 2020 2020 2020  n = lon.        
-000118c0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-000118d0: 6f6e 203e 206c 6f6e 5f6d 6178 3a0a 2020  on > lon_max:.  
-000118e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118f0: 2020 2020 2020 6c6f 6e5f 6d61 7820 3d20        lon_max = 
-00011900: 6c6f 6e0a 2020 2020 2020 2020 2020 2020  lon.            
-00011910: 2020 2020 6920 2b3d 2031 0a20 2020 2020      i += 1.     
-00011920: 2020 2072 6574 7572 6e20 6c61 745f 6d69     return lat_mi
-00011930: 6e2c 206c 6174 5f6d 6178 2c20 6c6f 6e5f  n, lat_max, lon_
-00011940: 6d69 6e2c 206c 6f6e 5f6d 6178 0a0a 0a20  min, lon_max... 
-00011950: 2020 2064 6566 2072 656d 6f76 6549 7465     def removeIte
-00011960: 6d46 6965 6c64 7357 6974 684f 6e6c 7944  mFieldsWithOnlyD
-00011970: 6174 6554 696d 6528 7365 6c66 293a 0a20  ateTime(self):. 
-00011980: 2020 2020 2020 2022 2222 2069 7420 6361         """ it ca
-00011990: 6e20 6861 7070 656e 2074 6861 7420 616e  n happen that an
-000119a0: 2069 6d61 6765 2074 696d 6573 7461 6d70   image timestamp
-000119b0: 2064 6f65 7320 6e6f 7420 636f 6e74 6169   does not contai
-000119c0: 6e20 616e 7920 6669 656c 6473 2062 7574  n any fields but
-000119d0: 2074 6865 2074 696d 6573 7461 6d70 2061   the timestamp a
-000119e0: 6e79 206d 6f72 652e 2054 686f 7365 2061  ny more. Those a
-000119f0: 7265 2072 656d 6f76 6564 2068 6572 652e  re removed here.
-00011a00: 2022 2222 200a 2020 2020 2020 2020 666f   """ .        fo
-00011a10: 7220 6974 656d 2069 6e20 7365 6c66 2e69  r item in self.i
-00011a20: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-00011a30: 6765 5365 7449 7465 6d73 4b65 795d 3a0a  geSetItemsKey]:.
-00011a40: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00011a50: 6f74 2069 7369 6e73 7461 6e63 6528 7365  ot isinstance(se
-00011a60: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00011a70: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-00011a80: 795d 5b69 7465 6d5d 2c6c 6973 7429 3a0a  y][item],list):.
-00011a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011aa0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-00011ab0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-00011ac0: 4b65 795d 5b69 7465 6d5d 203d 205b 7365  Key][item] = [se
-00011ad0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00011ae0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-00011af0: 795d 5b69 7465 6d5d 5d0a 2020 2020 2020  y][item]].      
-00011b00: 2020 2020 2020 746f 4265 5265 6d6f 7665        toBeRemove
-00011b10: 6420 3d20 5b5d 0a20 2020 2020 2020 2020  d = [].         
-00011b20: 2020 2066 6f72 2065 6e74 7279 2069 6e20     for entry in 
-00011b30: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-00011b40: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-00011b50: 4b65 795d 5b69 7465 6d5d 3a0a 2020 2020  Key][item]:.    
-00011b60: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
-00011b70: 6e74 2865 6e74 7279 290a 2020 2020 2020  nt(entry).      
-00011b80: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00011b90: 2865 6e74 7279 2920 3d3d 2031 2061 6e64  (entry) == 1 and
-00011ba0: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
-00011bb0: 2720 696e 2065 6e74 7279 3a0a 2020 2020  ' in entry:.    
-00011bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011bd0: 746f 4265 5265 6d6f 7665 642e 6170 7065  toBeRemoved.appe
-00011be0: 6e64 2865 6e74 7279 290a 2020 2020 2020  nd(entry).      
-00011bf0: 2020 2020 2020 666f 7220 656e 7472 7920        for entry 
-00011c00: 696e 2074 6f42 6552 656d 6f76 6564 3a0a  in toBeRemoved:.
-00011c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c20: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-00011c30: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-00011c40: 4b65 795d 5b69 7465 6d5d 2e72 656d 6f76  Key][item].remov
-00011c50: 6528 656e 7472 7929 200a 0a0a 2020 2020  e(entry) ...    
-00011c60: 6465 6620 6368 6563 6b41 6c6c 4974 656d  def checkAllItem
-00011c70: 4861 7368 6573 2873 656c 662c 2068 6172  Hashes(self, har
-00011c80: 643d 4661 6c73 652c 2072 6169 7365 4578  d=False, raiseEx
-00011c90: 6365 7074 696f 6e20 3d20 5472 7565 293a  ception = True):
-00011ca0: 0a20 2020 2020 2020 2022 2222 200a 2020  .        """ .  
-00011cb0: 2020 2020 2020 4368 6563 6b73 2069 6620        Checks if 
-00011cc0: 6861 7368 6573 2069 6e20 6946 444f 206d  hashes in iFDO m
-00011cd0: 6174 6368 2068 6173 6865 7320 696e 2069  atch hashes in i
-00011ce0: 6e74 6572 6d65 6964 6174 6520 6861 7368  ntermeidate hash
-00011cf0: 2066 696c 6520 6966 2074 6865 206c 6174   file if the lat
-00011d00: 7465 7220 7761 7320 6368 616e 6765 6420  ter was changed 
-00011d10: 6c61 7374 2061 6674 6572 2074 6865 2069  last after the i
-00011d20: 6d61 6765 7320 6861 7320 6368 616e 6765  mages has change
-00011d30: 642e 0a20 2020 2020 2020 204f 7468 6572  d..        Other
-00011d40: 7769 7365 206f 7220 6966 2068 6172 643d  wise or if hard=
-00011d50: 3d54 7275 6520 6974 2072 6564 6574 6572  =True it redeter
-00011d60: 6d69 6e65 7320 7468 6520 6163 7475 616c  mines the actual
-00011d70: 6c20 6669 6c65 2773 2068 6173 6820 616e  l file's hash an
-00011d80: 6420 636f 6d70 6172 6573 2074 6865 2069  d compares the i
-00011d90: 4644 4f20 6974 656d 2773 2068 6173 6820  FDO item's hash 
-00011da0: 7769 7468 2074 6861 742e 0a20 2020 2020  with that..     
-00011db0: 2020 2049 6620 6861 7368 6573 2064 6f20     If hashes do 
-00011dc0: 6e6f 7420 6d61 7463 6820 6120 6d61 7269  not match a mari
-00011dd0: 7174 2e63 6f72 652e 4966 646f 4578 6365  qt.core.IfdoExce
-00011de0: 7074 696f 6e20 6973 2072 6973 656e 2075  ption is risen u
-00011df0: 6e73 6c65 7373 2072 6169 7365 4578 6365  nsless raiseExce
-00011e00: 7074 696f 6e20 3d3d 2046 616c 7365 2c20  ption == False, 
-00011e10: 7468 656e 2061 206c 6973 7420 6f66 206c  then a list of l
-00011e20: 6973 7473 205b 3c66 696c 653e 2c3c 6578  ists [<file>,<ex
-00011e30: 6365 7074 696f 6e3e 5d20 6973 2072 6574  ception>] is ret
-00011e40: 7572 6e65 642e 0a20 2020 2020 2020 2022  urned..        "
-00011e50: 2222 0a20 2020 2020 2020 2068 6173 6865  "".        hashe
-00011e60: 7320 3d20 7b7d 0a20 2020 2020 2020 2068  s = {}.        h
-00011e70: 6173 6846 696c 654d 6f64 5469 6d65 203d  ashFileModTime =
-00011e80: 2031 3065 2b31 3030 0a20 2020 2020 2020   10e+100.       
-00011e90: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
-00011ea0: 7473 2873 656c 662e 6765 745f 696e 745f  ts(self.get_int_
-00011eb0: 6861 7368 5f66 696c 6528 2929 3a0a 2020  hash_file()):.  
-00011ec0: 2020 2020 2020 2020 2020 6861 7368 6573            hashes
-00011ed0: 203d 206d 6971 7466 2e74 6162 4669 6c65   = miqtf.tabFile
-00011ee0: 4461 7461 2873 656c 662e 6765 745f 696e  Data(self.get_in
-00011ef0: 745f 6861 7368 5f66 696c 6528 292c 205b  t_hash_file(), [
-00011f00: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00011f10: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
-00011f20: 5d2c 206d 6971 7476 2e63 6f6c 5f68 6561  ], miqtv.col_hea
-00011f30: 6465 725b 276d 6172 6971 7427 5d5b 2768  der['mariqt']['h
-00011f40: 6173 6827 5d5d 2c20 6b65 795f 636f 6c3d  ash']], key_col=
-00011f50: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00011f60: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
-00011f70: 5d29 0a20 2020 2020 2020 2020 2020 2068  ]).            h
-00011f80: 6173 6846 696c 654d 6f64 5469 6d65 203d  ashFileModTime =
-00011f90: 206f 732e 7061 7468 2e67 6574 6d74 696d   os.path.getmtim
-00011fa0: 6528 7365 6c66 2e67 6574 5f69 6e74 5f68  e(self.get_int_h
-00011fb0: 6173 685f 6669 6c65 2829 290a 0a20 2020  ash_file())..   
-00011fc0: 2020 2020 2065 7863 6570 7469 6f6e 4c69       exceptionLi
-00011fd0: 7374 203d 205b 5d0a 0a20 2020 2020 2020  st = []..       
-00011fe0: 2068 6173 6855 6e63 6865 636b 496d 6167   hashUncheckImag
-00011ff0: 6573 496e 5261 7720 3d20 7365 6c66 2e69  esInRaw = self.i
-00012000: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
-00012010: 2829 0a20 2020 2020 2020 2070 726f 6720  ().        prog 
-00012020: 3d20 6d69 7174 632e 5072 696e 744b 6e6f  = miqtc.PrintKno
-00012030: 776e 5072 6f67 7265 7373 4d73 6728 2243  wnProgressMsg("C
-00012040: 6865 636b 696e 6720 6974 656d 2068 6173  hecking item has
-00012050: 6865 7322 2c20 6c65 6e28 7365 6c66 2e69  hes", len(self.i
-00012060: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-00012070: 6765 5365 7449 7465 6d73 4b65 795d 2929  geSetItemsKey]))
-00012080: 0a20 2020 2020 2020 2066 6f72 2069 7465  .        for ite
-00012090: 6d20 696e 2073 656c 662e 6966 646f 5f74  m in self.ifdo_t
-000120a0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-000120b0: 4974 656d 734b 6579 5d3a 0a20 2020 2020  ItemsKey]:.     
-000120c0: 2020 2020 2020 2070 726f 672e 7072 6f67         prog.prog
-000120d0: 7265 7373 2829 0a0a 2020 2020 2020 2020  ress()..        
-000120e0: 2020 2020 666f 756e 6420 3d20 4661 6c73      found = Fals
-000120f0: 650a 2020 2020 2020 2020 2020 2020 666f  e.            fo
-00012100: 7220 696d 6167 6520 696e 2068 6173 6855  r image in hashU
-00012110: 6e63 6865 636b 496d 6167 6573 496e 5261  ncheckImagesInRa
-00012120: 773a 0a20 2020 2020 2020 2020 2020 2020  w:.             
-00012130: 2020 2066 696c 654e 616d 6520 3d20 6f73     fileName = os
-00012140: 2e70 6174 682e 6261 7365 6e61 6d65 2869  .path.basename(i
-00012150: 6d61 6765 290a 2020 2020 2020 2020 2020  mage).          
-00012160: 2020 2020 2020 6966 2066 696c 654e 616d        if fileNam
-00012170: 6520 3d3d 2069 7465 6d3a 0a20 2020 2020  e == item:.     
-00012180: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00012190: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
-000121a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121b0: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
-000121c0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-000121d0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-000121e0: 795d 5b69 7465 6d5d 2c6c 6973 7429 3a20  y][item],list): 
-000121f0: 2320 696e 2063 6173 6520 6f66 2076 6964  # in case of vid
-00012200: 656f 2077 6974 6820 6974 656d 2061 7320  eo with item as 
-00012210: 6c69 7374 2074 6865 2066 6972 7374 2065  list the first e
-00012220: 6e74 7279 2068 6f6c 6473 2074 6865 2064  ntry holds the d
-00012230: 6566 6175 6c74 2061 6e64 2074 6865 2068  efault and the h
-00012240: 6173 6820 6361 6e6e 6f74 2076 6172 7920  ash cannot vary 
-00012250: 666f 7220 7468 6520 7361 6d65 2069 6d61  for the same ima
-00012260: 6765 0a20 2020 2020 2020 2020 2020 2020  ge.             
-00012270: 2020 2020 2020 2020 2020 2069 7465 6d45             itemE
-00012280: 6e74 7279 203d 2073 656c 662e 6966 646f  ntry = self.ifdo
-00012290: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-000122a0: 6574 4974 656d 734b 6579 5d5b 6974 656d  etItemsKey][item
-000122b0: 5d5b 305d 200a 2020 2020 2020 2020 2020  ][0] .          
-000122c0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000122d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000122e0: 2020 2020 2020 2020 6974 656d 456e 7472          itemEntr
-000122f0: 7920 3d20 7365 6c66 2e69 6664 6f5f 746d  y = self.ifdo_tm
-00012300: 705b 7365 6c66 2e69 6d61 6765 5365 7449  p[self.imageSetI
-00012310: 7465 6d73 4b65 795d 5b69 7465 6d5d 0a0a  temsKey][item]..
-00012320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012330: 2020 2020 696d 6167 654d 6f64 5469 6d65      imageModTime
-00012340: 203d 206f 732e 7061 7468 2e67 6574 6d74   = os.path.getmt
-00012350: 696d 6528 696d 6167 6529 0a20 2020 2020  ime(image).     
-00012360: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00012370: 6620 6e6f 7420 6861 7264 2061 6e64 2069  f not hard and i
-00012380: 6d61 6765 4d6f 6454 696d 6520 3c20 6861  mageModTime < ha
-00012390: 7368 4669 6c65 4d6f 6454 696d 653a 0a20  shFileModTime:. 
-000123a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000123b0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-000123c0: 2e70 6174 682e 6261 7365 6e61 6d65 2869  .path.basename(i
-000123d0: 6d61 6765 2920 696e 2068 6173 6865 733a  mage) in hashes:
-000123e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000123f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00012400: 7261 6973 6545 7863 6570 7469 6f6e 3a0a  raiseException:.
-00012410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009680: 2020 2020 2020 2020 2020 2020 2069 6664               ifd
+00009690: 6f5b 2769 6d61 6765 2d73 6574 2d68 6561  o['image-set-hea
+000096a0: 6465 7227 5d5b 2769 6d61 6765 2d73 656e  der']['image-sen
+000096b0: 736f 7227 5d5b 276e 616d 6527 5d29 0a20  sor']['name']). 
+000096c0: 2020 2020 2020 2072 6574 7572 6e20 6e65         return ne
+000096d0: 775f 696d 6167 655f 7365 745f 6e61 6d65  w_image_set_name
+000096e0: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
+000096f0: 686f 640a 2020 2020 6465 6620 636f 6e73  hod.    def cons
+00009700: 7472 7563 7449 6d61 6765 5365 744e 616d  tructImageSetNam
+00009710: 6528 7072 6f6a 6563 743a 7374 722c 6576  e(project:str,ev
+00009720: 656e 743a 7374 722c 7365 6e73 6f72 3a73  ent:str,sensor:s
+00009730: 7472 293a 0a20 2020 2020 2020 2022 2222  tr):.        """
+00009740: 2072 6574 7572 6e73 203c 7072 6f6a 6563   returns <projec
+00009750: 743e 5f3c 6576 656e 743e 5f3c 7365 6e73  t>_<event>_<sens
+00009760: 6f72 3e2c 2077 6974 6820 7368 6f72 7420  or>, with short 
+00009770: 7665 7273 696f 6e20 6f66 203c 7365 6e73  version of <sens
+00009780: 6f72 3e20 286f 6e6c 7920 6964 292c 2070  or> (only id), p
+00009790: 7265 7665 6e74 696e 6720 706f 7465 6e74  reventing potent
+000097a0: 6961 6c20 646f 7562 6c69 6e67 206f 6620  ial doubling of 
+000097b0: 3c70 726f 6a65 6374 3e20 2022 2222 0a20  <project>  """. 
+000097c0: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
+000097d0: 2070 726f 6a65 6374 2e73 7472 6970 2829   project.strip()
+000097e0: 2e72 6570 6c61 6365 2827 2027 2c27 2d27  .replace(' ','-'
+000097f0: 290a 2020 2020 2020 2020 6576 656e 7420  ).        event 
+00009800: 3d20 6576 656e 742e 7374 7269 7028 292e  = event.strip().
+00009810: 7265 706c 6163 6528 2720 272c 272d 2729  replace(' ','-')
+00009820: 0a20 2020 2020 2020 2073 656e 736f 7220  .        sensor 
+00009830: 3d20 7365 6e73 6f72 2e73 7472 6970 2829  = sensor.strip()
+00009840: 2e72 6570 6c61 6365 2827 2027 2c27 2d27  .replace(' ','-'
+00009850: 290a 2020 2020 2020 2020 7365 6e73 6f72  ).        sensor
+00009860: 5f73 686f 7274 203d 2069 4644 4f2e 6765  _short = iFDO.ge
+00009870: 7453 686f 7274 4571 7569 706d 656e 7449  tShortEquipmentI
+00009880: 4428 7365 6e73 6f72 290a 2020 2020 2020  D(sensor).      
+00009890: 2020 6966 206c 656e 2865 7665 6e74 2920    if len(event) 
+000098a0: 3e20 6c65 6e28 7072 6f6a 6563 7429 2061  > len(project) a
+000098b0: 6e64 2065 7665 6e74 5b30 3a6c 656e 2870  nd event[0:len(p
+000098c0: 726f 6a65 6374 295d 203d 3d20 7072 6f6a  roject)] == proj
+000098d0: 6563 743a 0a20 2020 2020 2020 2020 2020  ect:.           
+000098e0: 2069 6d61 6765 5f73 6574 5f6e 616d 655f   image_set_name_
+000098f0: 203d 2065 7665 6e74 202b 2022 5f22 202b   = event + "_" +
+00009900: 2073 656e 736f 725f 7368 6f72 740a 2020   sensor_short.  
+00009910: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00009920: 2020 2020 2020 2020 696d 6167 655f 7365          image_se
+00009930: 745f 6e61 6d65 5f20 3d20 7072 6f6a 6563  t_name_ = projec
+00009940: 7420 2b20 225f 2220 2b20 6576 656e 7420  t + "_" + event 
+00009950: 2b20 225f 2220 2b20 7365 6e73 6f72 5f73  + "_" + sensor_s
+00009960: 686f 7274 0a20 2020 2020 2020 2072 6574  hort.        ret
+00009970: 7572 6e20 696d 6167 655f 7365 745f 6e61  urn image_set_na
+00009980: 6d65 5f20 2320 544f 444f 2069 6e63 6c75  me_ # TODO inclu
+00009990: 6465 2064 6174 6154 7970 653f 0a0a 0a20  de dataType?... 
+000099a0: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+000099b0: 0a20 2020 2064 6566 2067 6574 5368 6f72  .    def getShor
+000099c0: 7445 7175 6970 6d65 6e74 4944 2865 7175  tEquipmentID(equ
+000099d0: 6970 6d65 6e74 4944 3a73 7472 293a 0a20  ipmentID:str):. 
+000099e0: 2020 2020 2020 2022 2222 2072 6574 7572         """ retur
+000099f0: 6e73 2065 7175 6970 6d65 6e74 2069 6420  ns equipment id 
+00009a00: 7769 7468 6f75 7420 706f 7465 6e74 6961  without potentia
+00009a10: 6c6c 206c 6f6e 6720 3c6e 616d 653e 2070  ll long <name> p
+00009a20: 6172 742c 2069 2e65 2e3a 203c 6f77 6e65  art, i.e.: <owne
+00009a30: 723e 5f3c 7479 7065 3e2d 3c74 7970 6520  r>_<type>-<type 
+00009a40: 696e 6465 785b 5f3c 7375 6274 7970 653e  index[_<subtype>
+00009a50: 5d20 2222 220a 2020 2020 2020 2020 7265  ] """.        re
+00009a60: 7475 726e 2027 5f27 2e6a 6f69 6e28 6571  turn '_'.join(eq
+00009a70: 7569 706d 656e 7449 442e 7370 6c69 7428  uipmentID.split(
+00009a80: 275f 2729 5b30 3a33 5d29 0a0a 2020 2020  '_')[0:3])..    
+00009a90: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+00009aa0: 2020 6465 6620 636f 6e73 7472 7563 7469    def constructi
+00009ab0: 4644 4f66 696c 654e 616d 6528 7072 6f6a  FDOfileName(proj
+00009ac0: 6563 743a 7374 722c 6576 656e 743a 7374  ect:str,event:st
+00009ad0: 722c 7365 6e73 6f72 3a73 7472 293a 0a20  r,sensor:str):. 
+00009ae0: 2020 2020 2020 2022 2222 2072 6574 7572         """ retur
+00009af0: 6e73 203c 636f 6e73 7472 7563 7449 6d61  ns <constructIma
+00009b00: 6765 5365 744e 616d 6528 293e 5f69 4644  geSetName()>_iFD
+00009b10: 4f2e 6a73 6f6e 2022 2222 0a20 2020 2020  O.json """.     
+00009b20: 2020 2072 6574 7572 6e20 6946 444f 2e63     return iFDO.c
+00009b30: 6f6e 7374 7275 6374 496d 6167 6553 6574  onstructImageSet
+00009b40: 4e61 6d65 2870 726f 6a65 6374 2c65 7665  Name(project,eve
+00009b50: 6e74 2c73 656e 736f 7229 202b 2027 5f69  nt,sensor) + '_i
+00009b60: 4644 4f2e 6a73 6f6e 2720 0a0a 2020 2020  FDO.json' ..    
+00009b70: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
+00009b80: 6f64 0a20 2020 2064 6566 205f 5f67 6574  od.    def __get
+00009b90: 4669 656c 6456 616c 7565 2869 6664 6f3a  FieldValue(ifdo:
+00009ba0: 6469 6374 2c6b 6579 733a 6c69 7374 2c64  dict,keys:list,d
+00009bb0: 6566 6175 6c74 5f6f 6e6c 7920 3d20 4661  efault_only = Fa
+00009bc0: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
+00009bd0: 2220 7265 7475 726e 7320 636f 7079 206f  " returns copy o
+00009be0: 6620 7365 7420 6f72 2069 7465 6d20 6669  f set or item fi
+00009bf0: 656c 6420 7661 6c75 652c 2061 6c73 6f20  eld value, also 
+00009c00: 636f 6e73 6964 6572 6e67 2064 6566 6175  considerng defau
+00009c10: 6c74 2076 616c 7565 7320 6672 6f6d 2068  lt values from h
+00009c20: 6561 6465 722e 0a20 2020 2020 2020 2020  eader..         
+00009c30: 2020 2055 7365 206b 6579 7320 6173 2065     Use keys as e
+00009c40: 2e67 2e20 5b3c 6974 656d 3e2c 3c6b 6579  .g. [<item>,<key
+00009c50: 3e2c 2e2e 5d2e 2043 616e 2062 6520 7573  >,..]. Can be us
+00009c60: 6564 2066 6f72 2068 6561 6465 7220 6669  ed for header fi
+00009c70: 656c 6473 2061 7320 7765 6c6c 2061 7320  elds as well as 
+00009c80: 6974 656d 2066 6965 6c64 732e 0a20 2020  item fields..   
+00009c90: 2020 2020 2020 2020 2049 7465 6d20 696e           Item in
+00009ca0: 6465 7820 6361 6e20 6265 206e 6567 6c65  dex can be negle
+00009cb0: 6374 6564 2c20 696e 2063 6173 6520 6f66  cted, in case of
+00009cc0: 2076 6964 656f 2061 2064 6963 7420 7b3c   video a dict {<
+00009cd0: 696d 6167 652d 6461 7461 7469 6d65 3e3a  image-datatime>:
+00009ce0: 3c76 616c 7565 3e2c 2e2e 2e7d 2069 7320  <value>,...} is 
+00009cf0: 7265 7475 726e 6564 0a20 2020 2020 2020  returned.       
+00009d00: 2020 2020 2075 6e6c 6573 7320 6465 6661       unless defa
+00009d10: 756c 745f 6f6e 6c79 203d 2046 616c 7365  ult_only = False
+00009d20: 2c20 7468 656e 2064 6566 6175 6c74 2076  , then default v
+00009d30: 616c 7565 7320 6174 2069 6e64 6578 2030  alues at index 0
+00009d40: 2069 7320 7265 7475 726e 6564 2e0a 2020   is returned..  
+00009d50: 2020 2020 2020 2020 2020 5261 6973 6573            Raises
+00009d60: 2049 6664 6f45 7863 6570 7469 6f6e 2069   IfdoException i
+00009d70: 6620 6b65 7973 2064 6f20 6e6f 7420 6578  f keys do not ex
+00009d80: 6973 742e 2022 2222 0a0a 2020 2020 2020  ist. """..      
+00009d90: 2020 6966 206e 6f74 206d 6971 7476 2e69    if not miqtv.i
+00009da0: 6d61 6765 5f73 6574 5f69 7465 6d73 5f6b  mage_set_items_k
+00009db0: 6579 2069 6e20 6966 646f 206f 7220 6e6f  ey in ifdo or no
+00009dc0: 7420 6d69 7174 762e 696d 6167 655f 7365  t miqtv.image_se
+00009dd0: 745f 6865 6164 6572 5f6b 6579 2069 6e20  t_header_key in 
+00009de0: 6966 646f 3a0a 2020 2020 2020 2020 2020  ifdo:.          
+00009df0: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+00009e00: 646f 4578 6365 7074 696f 6e28 2249 6e76  doException("Inv
+00009e10: 616c 6964 2069 6664 6f20 6469 6374 2c20  alid ifdo dict, 
+00009e20: 6d69 7373 696e 6720 6974 656d 7320 6f72  missing items or
+00009e30: 2068 6561 6465 7220 6b65 793a 2022 202b   header key: " +
+00009e40: 2073 7472 2869 6664 6f29 290a 2020 2020   str(ifdo)).    
+00009e50: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
+00009e60: 6e6f 7420 6973 696e 7374 616e 6365 286b  not isinstance(k
+00009e70: 6579 732c 6c69 7374 293a 0a20 2020 2020  eys,list):.     
+00009e80: 2020 2020 2020 206b 6579 7320 3d20 5b6b         keys = [k
+00009e90: 6579 735d 0a0a 2020 2020 2020 2020 2320  eys]..        # 
+00009ea0: 7265 6d6f 7665 2068 6561 6465 7220 6f72  remove header or
+00009eb0: 2069 7465 6d20 7072 6566 6978 6573 2069   item prefixes i
+00009ec0: 6620 7468 6572 650a 2020 2020 2020 2020  f there.        
+00009ed0: 6966 206b 6579 735b 305d 203d 3d20 6d69  if keys[0] == mi
+00009ee0: 7174 762e 696d 6167 655f 7365 745f 6974  qtv.image_set_it
+00009ef0: 656d 735f 6b65 7920 6f72 206b 6579 735b  ems_key or keys[
+00009f00: 305d 203d 3d20 6d69 7174 762e 696d 6167  0] == miqtv.imag
+00009f10: 655f 7365 745f 6865 6164 6572 5f6b 6579  e_set_header_key
+00009f20: 3a0a 2020 2020 2020 2020 2020 2020 6b65  :.            ke
+00009f30: 7973 203d 206b 6579 735b 313a 3a5d 0a0a  ys = keys[1::]..
+00009f40: 2020 2020 2020 2020 6865 6164 6572 203d          header =
+00009f50: 2069 6664 6f5b 6d69 7174 762e 696d 6167   ifdo[miqtv.imag
+00009f60: 655f 7365 745f 6865 6164 6572 5f6b 6579  e_set_header_key
+00009f70: 5d0a 2020 2020 2020 2020 6974 656d 7320  ].        items 
+00009f80: 3d20 6966 646f 5b6d 6971 7476 2e69 6d61  = ifdo[miqtv.ima
+00009f90: 6765 5f73 6574 5f69 7465 6d73 5f6b 6579  ge_set_items_key
+00009fa0: 5d0a 2020 2020 2020 2020 2320 6c6f 6f6b  ].        # look
+00009fb0: 2066 6f72 2064 6566 6175 6c74 2076 616c   for default val
+00009fc0: 7565 0a20 2020 2020 2020 2066 6f72 2073  ue.        for s
+00009fd0: 6b69 7070 6564 496e 4865 6164 6572 2069  kippedInHeader i
+00009fe0: 6e20 7261 6e67 6528 6c65 6e28 6b65 7973  n range(len(keys
+00009ff0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0000a000: 6465 6661 756c 7456 616c 203d 2066 696e  defaultVal = fin
+0000a010: 6446 6965 6c64 2868 6561 6465 722c 6b65  dField(header,ke
+0000a020: 7973 5b73 6b69 7070 6564 496e 4865 6164  ys[skippedInHead
+0000a030: 6572 3a3a 5d29 0a20 2020 2020 2020 2020  er::]).         
+0000a040: 2020 2069 6620 6465 6661 756c 7456 616c     if defaultVal
+0000a050: 2021 3d20 2222 3a0a 2020 2020 2020 2020   != "":.        
+0000a060: 2020 2020 2020 2020 6272 6561 6b0a 0a20          break.. 
+0000a070: 2020 2020 2020 2023 2320 6c6f 6f6b 2066         ## look f
+0000a080: 6f72 2069 7465 6d20 7661 6c75 650a 2020  or item value.  
+0000a090: 2020 2020 2020 2320 6865 6164 6572 206f        # header o
+0000a0a0: 6e6c 7920 7661 6c75 652c 2064 6f6e 2774  nly value, don't
+0000a0b0: 2063 6865 636b 2069 6e20 6974 656d 730a   check in items.
+0000a0c0: 2020 2020 2020 2020 6966 2066 696e 6446          if findF
+0000a0d0: 6965 6c64 2869 7465 6d73 2c6b 6579 735b  ield(items,keys[
+0000a0e0: 303a 315d 2920 3d3d 2022 2220 616e 6420  0:1]) == "" and 
+0000a0f0: 736b 6970 7065 6449 6e48 6561 6465 7220  skippedInHeader 
+0000a100: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+0000a110: 2020 7265 7420 3d20 6465 6661 756c 7456    ret = defaultV
+0000a120: 616c 0a20 2020 2020 2020 2020 2020 2069  al.            i
+0000a130: 6620 7265 7420 3d3d 2022 223a 0a20 2020  f ret == "":.   
+0000a140: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0000a150: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
+0000a160: 6570 7469 6f6e 2822 6b65 7920 646f 6573  eption("key does
+0000a170: 206e 6f74 2065 7869 7374 3a22 202b 2073   not exist:" + s
+0000a180: 7472 286b 6579 7329 290a 2020 2020 2020  tr(keys)).      
+0000a190: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000a1a0: 2020 2020 2320 6966 2066 6972 7374 206b      # if first k
+0000a1b0: 6579 206e 6f74 2066 6f75 6e64 2069 6e20  ey not found in 
+0000a1c0: 6974 656d 732c 2069 2e65 2e20 6973 206e  items, i.e. is n
+0000a1d0: 6f74 2061 2069 6d61 6765 206e 616d 652c  ot a image name,
+0000a1e0: 2061 6e64 2066 6972 7374 206b 6579 2069   and first key i
+0000a1f0: 7320 6e6f 7420 6120 6865 6164 6572 206b  s not a header k
+0000a200: 6579 3a0a 2020 2020 2020 2020 2020 2020  ey:.            
+0000a210: 6966 2066 696e 6446 6965 6c64 2869 7465  if findField(ite
+0000a220: 6d73 2c6b 6579 735b 303a 315d 2920 3d3d  ms,keys[0:1]) ==
+0000a230: 2022 2220 616e 6420 736b 6970 7065 6449   "" and skippedI
+0000a240: 6e48 6561 6465 7220 213d 2030 3a0a 2020  nHeader != 0:.  
+0000a250: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0000a260: 6973 6520 6d69 7174 632e 4966 646f 4578  ise miqtc.IfdoEx
+0000a270: 6365 7074 696f 6e28 2269 7465 6d20 646f  ception("item do
+0000a280: 6573 206e 6f74 2065 7869 7374 3a22 202b  es not exist:" +
+0000a290: 2073 7472 286b 6579 735b 303a 315d 2929   str(keys[0:1]))
+0000a2a0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000a2b0: 6368 6563 6b20 6966 2069 6e64 6578 2070  check if index p
+0000a2c0: 726f 7669 6465 640a 2020 2020 2020 2020  rovided.        
+0000a2d0: 2020 2020 696e 6465 7850 726f 7669 6465      indexProvide
+0000a2e0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
+0000a2f0: 2020 2020 2069 6620 6c65 6e28 6b65 7973       if len(keys
+0000a300: 2920 3e20 313a 0a20 2020 2020 2020 2020  ) > 1:.         
+0000a310: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0000a320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a330: 696e 6465 7820 3d20 696e 7428 6b65 7973  index = int(keys
+0000a340: 5b31 5d29 0a20 2020 2020 2020 2020 2020  [1]).           
+0000a350: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+0000a360: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
+0000a370: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+0000a380: 5072 6f76 6964 6564 203d 2046 616c 7365  Provided = False
+0000a390: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0000a3a0: 6620 6c65 6e28 6b65 7973 2920 3d3d 2031  f len(keys) == 1
+0000a3b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000a3c0: 2020 696e 6465 7850 726f 7669 6465 6420    indexProvided 
+0000a3d0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+0000a3e0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0000a3f0: 2020 2020 2069 6d61 6765 4974 656d 5469       imageItemTi
+0000a400: 6d65 506f 696e 7473 203d 2069 7465 6d73  mePoints = items
+0000a410: 5b6b 6579 735b 305d 5d0a 0a20 2020 2020  [keys[0]]..     
+0000a420: 2020 2020 2020 2069 6620 696e 6465 7850         if indexP
+0000a430: 726f 7669 6465 643a 0a20 2020 2020 2020  rovided:.       
+0000a440: 2020 2020 2020 2020 2023 2069 6620 6b65           # if ke
+0000a450: 7920 6973 2077 686f 6c65 2069 6d61 6765  y is whole image
+0000a460: 2061 6464 2061 6c6c 2076 616c 7565 7320   add all values 
+0000a470: 6672 6f6d 2068 6561 6465 720a 2020 2020  from header.    
+0000a480: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0000a490: 656e 286b 6579 7329 203d 3d20 323a 0a20  en(keys) == 2:. 
+0000a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4b0: 2020 2064 6566 6175 6c74 5661 6c20 3d20     defaultVal = 
+0000a4c0: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
+0000a4d0: 2020 2020 2020 2023 2061 6464 2064 6566         # add def
+0000a4e0: 6175 6c74 2066 726f 6d20 696e 6465 7820  ault from index 
+0000a4f0: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
+0000a500: 2020 6966 206c 656e 286b 6579 7329 203e    if len(keys) >
+0000a510: 2031 2061 6e64 2069 6e64 6578 2021 3d20   1 and index != 
+0000a520: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0000a530: 2020 2020 2020 206b 6579 735f 3020 3d20         keys_0 = 
+0000a540: 636f 7079 2e64 6565 7063 6f70 7928 6b65  copy.deepcopy(ke
+0000a550: 7973 290a 2020 2020 2020 2020 2020 2020  ys).            
+0000a560: 2020 2020 2020 2020 6b65 7973 5f30 5b31          keys_0[1
+0000a570: 5d20 3d20 300a 2020 2020 2020 2020 2020  ] = 0.          
+0000a580: 2020 2020 2020 2020 2020 7265 745f 3020            ret_0 
+0000a590: 3d20 6946 444f 2e5f 5f67 6574 4974 656d  = iFDO.__getItem
+0000a5a0: 5661 6c75 6528 6974 656d 732c 6b65 7973  Value(items,keys
+0000a5b0: 5f30 2c73 6b69 7070 6564 496e 4865 6164  _0,skippedInHead
+0000a5c0: 6572 2c64 6566 6175 6c74 5661 6c29 0a20  er,defaultVal). 
+0000a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5e0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0000a5f0: 2872 6574 5f30 2c64 6963 7429 3a0a 2020  (ret_0,dict):.  
+0000a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a610: 2020 2020 2020 6465 6661 756c 7456 616c        defaultVal
+0000a620: 203d 207b 2a2a 6465 6661 756c 7456 616c   = {**defaultVal
+0000a630: 2c2a 2a72 6574 5f30 7d0a 2020 2020 2020  ,**ret_0}.      
+0000a640: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
+0000a650: 6946 444f 2e5f 5f67 6574 4974 656d 5661  iFDO.__getItemVa
+0000a660: 6c75 6528 6974 656d 732c 6b65 7973 2c73  lue(items,keys,s
+0000a670: 6b69 7070 6564 496e 4865 6164 6572 2c64  kippedInHeader,d
+0000a680: 6566 6175 6c74 5661 6c29 0a20 2020 2020  efaultVal).     
+0000a690: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0000a6a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000a6b0: 2020 2020 2020 2020 2020 2320 6966 206b            # if k
+0000a6c0: 6579 2069 7320 7768 6f6c 6520 696d 6167  ey is whole imag
+0000a6d0: 6520 6164 6420 616c 6c20 7661 6c75 6573  e add all values
+0000a6e0: 2066 726f 6d20 6865 6164 6572 0a20 2020   from header.   
+0000a6f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000a700: 6c65 6e28 6b65 7973 2920 3d3d 2031 3a0a  len(keys) == 1:.
+0000a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a720: 2020 2020 6465 6661 756c 7456 616c 203d      defaultVal =
+0000a730: 2068 6561 6465 720a 0a20 2020 2020 2020   header..       
+0000a740: 2020 2020 2020 2020 2023 2070 6963 7475           # pictu
+0000a750: 7265 202d 3e20 6a75 7374 206f 6e65 2065  re -> just one e
+0000a760: 6e74 7279 2c20 696e 7365 7274 2069 6e64  ntry, insert ind
+0000a770: 6578 2030 0a20 2020 2020 2020 2020 2020  ex 0.           
+0000a780: 2020 2020 2069 6620 6c65 6e28 696d 6167       if len(imag
+0000a790: 6549 7465 6d54 696d 6550 6f69 6e74 7329  eItemTimePoints)
+0000a7a0: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+0000a7b0: 2020 2020 2020 2020 2020 206b 6579 7320             keys 
+0000a7c0: 3d20 6b65 7973 5b30 3a31 5d20 2b20 5b30  = keys[0:1] + [0
+0000a7d0: 5d20 2b20 6b65 7973 5b31 3a3a 5d0a 2020  ] + keys[1::].  
+0000a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a7f0: 2020 7265 7420 3d20 6946 444f 2e5f 5f67    ret = iFDO.__g
+0000a800: 6574 4974 656d 5661 6c75 6528 6974 656d  etItemValue(item
+0000a810: 732c 6b65 7973 2c73 6b69 7070 6564 496e  s,keys,skippedIn
+0000a820: 4865 6164 6572 2c64 6566 6175 6c74 5661  Header,defaultVa
+0000a830: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
+0000a840: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0000a850: 2020 2020 2020 2020 2320 7669 6465 6f20          # video 
+0000a860: 2d3e 2072 6574 7572 6e20 7661 6c75 6573  -> return values
+0000a870: 2066 6f72 2065 6163 6820 7469 6d65 2073   for each time s
+0000a880: 7461 6d70 0a20 2020 2020 2020 2020 2020  tamp.           
+0000a890: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000a8a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000a8b0: 6574 203d 207b 7d0a 2020 2020 2020 2020  et = {}.        
+0000a8c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000a8d0: 6920 696e 2072 616e 6765 286c 656e 2869  i in range(len(i
+0000a8e0: 6d61 6765 4974 656d 5469 6d65 506f 696e  mageItemTimePoin
+0000a8f0: 7473 2929 3a0a 2020 2020 2020 2020 2020  ts)):.          
+0000a900: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+0000a910: 6d65 506f 696e 7444 6174 6120 3d20 696d  mePointData = im
+0000a920: 6167 6549 7465 6d54 696d 6550 6f69 6e74  ageItemTimePoint
+0000a930: 735b 695d 0a20 2020 2020 2020 2020 2020  s[i].           
+0000a940: 2020 2020 2020 2020 2020 2020 206b 6579               key
+0000a950: 735f 6920 3d20 6b65 7973 5b30 3a31 5d20  s_i = keys[0:1] 
+0000a960: 2b20 5b69 5d20 2b20 6b65 7973 5b31 3a3a  + [i] + keys[1::
+0000a970: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0000a980: 2020 2020 2020 2020 2020 7661 6c5f 6920            val_i 
+0000a990: 3d20 6946 444f 2e5f 5f67 6574 4974 656d  = iFDO.__getItem
+0000a9a0: 5661 6c75 6528 6974 656d 732c 6b65 7973  Value(items,keys
+0000a9b0: 5f69 2c73 6b69 7070 6564 496e 4865 6164  _i,skippedInHead
+0000a9c0: 6572 2c64 6566 6175 6c74 5661 6c29 0a20  er,defaultVal). 
+0000a9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a9e0: 2020 2020 2020 2023 2064 6566 6175 6c74         # default
+0000a9f0: 206f 6e6c 790a 2020 2020 2020 2020 2020   only.          
+0000aa00: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000aa10: 2064 6566 6175 6c74 5f6f 6e6c 793a 0a20   default_only:. 
+0000aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa30: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
+0000aa40: 2076 616c 5f69 0a20 2020 2020 2020 2020   val_i.         
+0000aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa60: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+0000aa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa80: 2072 6574 5b74 696d 6550 6f69 6e74 4461   ret[timePointDa
+0000aa90: 7461 5b27 696d 6167 652d 6461 7465 7469  ta['image-dateti
+0000aaa0: 6d65 275d 5d20 3d20 7661 6c5f 690a 2020  me']] = val_i.  
+0000aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aac0: 2020 2020 2020 2320 7265 6d6f 7665 2069        # remove i
+0000aad0: 6d61 6765 2d64 6174 6574 696d 6520 6966  mage-datetime if
+0000aae0: 2074 6865 7265 0a20 2020 2020 2020 2020   there.         
+0000aaf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000ab00: 6620 6973 696e 7374 616e 6365 2872 6574  f isinstance(ret
+0000ab10: 5b74 696d 6550 6f69 6e74 4461 7461 5b27  [timePointData['
+0000ab20: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
+0000ab30: 5d2c 6469 6374 2920 616e 6420 2769 6d61  ],dict) and 'ima
+0000ab40: 6765 2d64 6174 6574 696d 6527 2069 6e20  ge-datetime' in 
+0000ab50: 7265 745b 7469 6d65 506f 696e 7444 6174  ret[timePointDat
+0000ab60: 615b 2769 6d61 6765 2d64 6174 6574 696d  a['image-datetim
+0000ab70: 6527 5d5d 3a0a 2020 2020 2020 2020 2020  e']]:.          
+0000ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab90: 2020 6465 6c20 7265 745b 7469 6d65 506f    del ret[timePo
+0000aba0: 696e 7444 6174 615b 2769 6d61 6765 2d64  intData['image-d
+0000abb0: 6174 6574 696d 6527 5d5d 5b27 696d 6167  atetime']]['imag
+0000abc0: 652d 6461 7465 7469 6d65 275d 0a20 2020  e-datetime'].   
+0000abd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000abe0: 2020 2020 2023 2076 6964 656f 2064 6566       # video def
+0000abf0: 6175 6c74 730a 2020 2020 2020 2020 2020  aults.          
+0000ac00: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000ac10: 2069 203d 3d20 303a 0a20 2020 2020 2020   i == 0:.       
+0000ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac30: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0000ac40: 6365 2872 6574 5b74 696d 6550 6f69 6e74  ce(ret[timePoint
+0000ac50: 4461 7461 5b27 696d 6167 652d 6461 7465  Data['image-date
+0000ac60: 7469 6d65 275d 5d2c 6469 6374 293a 0a20  time']],dict):. 
+0000ac70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac80: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000ac90: 6566 6175 6c74 5661 6c20 3d20 7b2a 2a64  efaultVal = {**d
+0000aca0: 6566 6175 6c74 5661 6c2c 2a2a 7265 745b  efaultVal,**ret[
+0000acb0: 7469 6d65 506f 696e 7444 6174 615b 2769  timePointData['i
+0000acc0: 6d61 6765 2d64 6174 6574 696d 6527 5d5d  mage-datetime']]
+0000acd0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+0000ace0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000acf0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad10: 2020 2020 6465 6661 756c 7456 616c 203d      defaultVal =
+0000ad20: 2072 6574 5b74 696d 6550 6f69 6e74 4461   ret[timePointDa
+0000ad30: 7461 5b27 696d 6167 652d 6461 7465 7469  ta['image-dateti
+0000ad40: 6d65 275d 5d0a 0a20 2020 2020 2020 2020  me']]..         
+0000ad50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000ad60: 202b 3d20 310a 0a20 2020 2020 2020 2069   += 1..        i
+0000ad70: 6620 6973 696e 7374 616e 6365 2872 6574  f isinstance(ret
+0000ad80: 2c64 6963 7429 206f 7220 6973 696e 7374  ,dict) or isinst
+0000ad90: 616e 6365 2872 6574 2c6c 6973 7429 3a0a  ance(ret,list):.
+0000ada0: 2020 2020 2020 2020 2020 2020 7265 7420              ret 
+0000adb0: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
+0000adc0: 7265 7429 0a20 2020 2020 2020 2069 6620  ret).        if 
+0000add0: 7265 7420 3d3d 2022 2220 6f72 2072 6574  ret == "" or ret
+0000ade0: 203d 3d20 7b7d 3a0a 2020 2020 2020 2020   == {}:.        
+0000adf0: 2020 2020 7261 6973 6520 6d69 7174 632e      raise miqtc.
+0000ae00: 4966 646f 4578 6365 7074 696f 6e28 226b  IfdoException("k
+0000ae10: 6579 7320 646f 206e 6f74 2065 7869 7374  eys do not exist
+0000ae20: 3a22 202b 2073 7472 286b 6579 7329 290a  :" + str(keys)).
+0000ae30: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0000ae40: 6574 0a0a 0a20 2020 2040 7374 6174 6963  et...    @static
+0000ae50: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
+0000ae60: 5f67 6574 4974 656d 5661 6c75 6528 6974  _getItemValue(it
+0000ae70: 656d 732c 6b65 7973 2c73 6b69 7070 6564  ems,keys,skipped
+0000ae80: 496e 4865 6164 6572 2c64 6566 6175 6c74  InHeader,default
+0000ae90: 5661 6c29 3a0a 2020 2020 2020 2020 0a20  Val):.        . 
+0000aea0: 2020 2020 2020 2023 2069 6e20 6361 7365         # in case
+0000aeb0: 2069 7465 6d20 6973 206e 6f74 2061 206c   item is not a l
+0000aec0: 6973 7420 2873 686f 756c 6420 6e6f 7420  ist (should not 
+0000aed0: 6265 2070 6f73 7369 626c 6529 0a20 2020  be possible).   
+0000aee0: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+0000aef0: 7374 616e 6365 2869 7465 6d73 5b6b 6579  stance(items[key
+0000af00: 735b 305d 5d2c 6c69 7374 293a 0a20 2020  s[0]],list):.   
+0000af10: 2020 2020 2020 2020 2069 7465 6d73 5b6b           items[k
+0000af20: 6579 735b 305d 5d20 3d20 5b69 7465 6d73  eys[0]] = [items
+0000af30: 5b6b 6579 735b 305d 5d5d 0a0a 2020 2020  [keys[0]]]..    
+0000af40: 2020 2020 6974 656d 5661 6c75 6520 3d20      itemValue = 
+0000af50: 6669 6e64 4669 656c 6428 6974 656d 732c  findField(items,
+0000af60: 6b65 7973 290a 0a20 2020 2020 2020 2069  keys)..        i
+0000af70: 6620 6974 656d 5661 6c75 6520 3d3d 2022  f itemValue == "
+0000af80: 223a 0a20 2020 2020 2020 2020 2020 2072  ":.            r
+0000af90: 6574 203d 2064 6566 6175 6c74 5661 6c0a  et = defaultVal.
+0000afa0: 2020 2020 2020 2020 2320 696e 2063 6173          # in cas
+0000afb0: 6520 6f66 2064 6963 7473 206a 6f69 6e74  e of dicts joint
+0000afc0: 2068 6561 6465 7220 616e 6420 6974 656d   header and item
+0000afd0: 2066 6965 6c64 730a 2020 2020 2020 2020   fields.        
+0000afe0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+0000aff0: 6974 656d 5661 6c75 652c 6469 6374 2920  itemValue,dict) 
+0000b000: 616e 6420 6465 6661 756c 7456 616c 2021  and defaultVal !
+0000b010: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
+0000b020: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+0000b030: 6e63 6528 6465 6661 756c 7456 616c 2c64  nce(defaultVal,d
+0000b040: 6963 7429 3a0a 2020 2020 2020 2020 2020  ict):.          
+0000b050: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
+0000b060: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
+0000b070: 2249 7465 6d20 6669 656c 6420 6973 2064  "Item field is d
+0000b080: 6963 7420 6275 7420 6465 6661 756c 7420  ict but default 
+0000b090: 7661 6c75 6520 696e 2068 6561 6465 7220  value in header 
+0000b0a0: 6973 206e 6f74 3a20 2220 2b20 7374 7228  is not: " + str(
+0000b0b0: 6b65 7973 2929 0a20 2020 2020 2020 2020  keys)).         
+0000b0c0: 2020 2072 6574 203d 207b 2a2a 6465 6661     ret = {**defa
+0000b0d0: 756c 7456 616c 2c2a 2a69 7465 6d56 616c  ultVal,**itemVal
+0000b0e0: 7565 7d0a 2020 2020 2020 2020 656c 7365  ue}.        else
+0000b0f0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000b100: 7420 3d20 6974 656d 5661 6c75 650a 2020  t = itemValue.  
+0000b110: 2020 2020 2020 7265 7475 726e 2072 6574        return ret
+0000b120: 0a0a 0a20 2020 2064 6566 205f 5f73 7472  ...    def __str
+0000b130: 5f5f 2873 656c 6629 202d 3e20 7374 723a  __(self) -> str:
+0000b140: 0a20 2020 2020 2020 2022 2222 2050 7269  .        """ Pri
+0000b150: 6e74 7320 6375 7272 656e 7420 6946 444f  nts current iFDO
+0000b160: 2066 696c 6520 2222 220a 2020 2020 2020   file """.      
+0000b170: 2020 7265 7475 726e 2079 616d 6c2e 6475    return yaml.du
+0000b180: 6d70 2873 656c 662e 6966 646f 5f63 6865  mp(self.ifdo_che
+0000b190: 636b 6564 2c20 6465 6661 756c 745f 7374  cked, default_st
+0000b1a0: 796c 653d 4e6f 6e65 2c20 6465 6661 756c  yle=None, defaul
+0000b1b0: 745f 666c 6f77 5f73 7479 6c65 3d4e 6f6e  t_flow_style=Non
+0000b1c0: 652c 2061 6c6c 6f77 5f75 6e69 636f 6465  e, allow_unicode
+0000b1d0: 3d54 7275 652c 2077 6964 7468 3d66 6c6f  =True, width=flo
+0000b1e0: 6174 2822 696e 6622 2929 0a0a 0a20 2020  at("inf"))...   
+0000b1f0: 2064 6566 205f 5f67 6574 6974 656d 5f5f   def __getitem__
+0000b200: 2873 656c 662c 206b 6579 7329 3a0a 2020  (self, keys):.  
+0000b210: 2020 2020 2020 2222 2220 5265 7475 726e        """ Return
+0000b220: 7320 636f 7079 206f 6620 6368 6563 6b65  s copy of checke
+0000b230: 6420 6966 646f 2073 6574 206f 7220 6974  d ifdo set or it
+0000b240: 656d 2066 6965 6c64 2076 616c 7565 2c20  em field value, 
+0000b250: 616c 736f 2063 6f6e 7369 6465 726e 6720  also considerng 
+0000b260: 6465 6661 756c 7420 7661 6c75 6573 2066  default values f
+0000b270: 726f 6d20 6865 6164 6572 2e0a 2020 2020  rom header..    
+0000b280: 2020 2020 2020 2020 5573 6520 6b65 7973          Use keys
+0000b290: 2061 7320 652e 672e 2027 3c69 7465 6d3e   as e.g. '<item>
+0000b2a0: 3a3c 6b65 793e 3a2e 2e2e 272e 2043 616e  :<key>:...'. Can
+0000b2b0: 2062 6520 7573 6564 2066 6f72 2068 6561   be used for hea
+0000b2c0: 6465 7220 6669 656c 6473 2061 7320 7765  der fields as we
+0000b2d0: 6c6c 2061 7320 6974 656d 2066 6965 6c64  ll as item field
+0000b2e0: 732e 0a20 2020 2020 2020 2020 2020 2049  s..            I
+0000b2f0: 7465 6d20 696e 6465 7820 6361 6e20 6265  tem index can be
+0000b300: 206c 6567 6c65 6374 6564 2c20 696e 2063   leglected, in c
+0000b310: 6173 6520 6f66 2076 6964 656f 2061 2064  ase of video a d
+0000b320: 6963 7420 7b3c 696d 6167 652d 6461 7461  ict {<image-data
+0000b330: 7469 6d65 3e3a 3c76 616c 7565 3e2c 2e2e  time>:<value>,..
+0000b340: 2e7d 2069 7320 7265 7475 726e 6564 2e0a  .} is returned..
+0000b350: 2020 2020 2020 2020 2020 2020 5261 6973              Rais
+0000b360: 6573 2049 6664 6f45 7863 6570 7469 6f6e  es IfdoException
+0000b370: 2069 6620 6974 656d 2064 6f65 7320 6e6f   if item does no
+0000b380: 7420 6578 6973 742e 2022 2222 0a20 2020  t exist. """.   
+0000b390: 2020 2020 206b 6579 7320 3d20 6b65 7973       keys = keys
+0000b3a0: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
+0000b3b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000b3c0: 5f5f 6765 7446 6965 6c64 5661 6c75 6528  __getFieldValue(
+0000b3d0: 7365 6c66 2e69 6664 6f5f 6368 6563 6b65  self.ifdo_checke
+0000b3e0: 642c 6b65 7973 290a 0a0a 2020 2020 6465  d,keys)...    de
+0000b3f0: 6620 6669 6e64 546d 7046 6965 6c64 2873  f findTmpField(s
+0000b400: 656c 662c 6b65 7973 293a 0a20 2020 2020  elf,keys):.     
+0000b410: 2020 2022 2222 2052 6574 7572 6e73 2063     """ Returns c
+0000b420: 6f70 7920 6f66 2074 656d 706f 7261 7279  opy of temporary
+0000b430: 2075 6e63 6865 636b 6564 2069 6664 6f20   unchecked ifdo 
+0000b440: 7365 7420 6f72 2069 7465 6d20 6669 656c  set or item fiel
+0000b450: 6420 7661 6c75 652c 2061 6c73 6f20 636f  d value, also co
+0000b460: 6e73 6964 6572 6e67 2064 6566 6175 6c74  nsiderng default
+0000b470: 2076 616c 7565 7320 6672 6f6d 2068 6561   values from hea
+0000b480: 6465 722e 0a20 2020 2020 2020 2020 2020  der..           
+0000b490: 2055 7365 206b 6579 7320 6173 2065 2e67   Use keys as e.g
+0000b4a0: 2e20 273c 6974 656d 3e3a 3c6b 6579 3e3a  . '<item>:<key>:
+0000b4b0: 2e2e 2e27 2e20 4361 6e20 6265 2075 7365  ...'. Can be use
+0000b4c0: 6420 666f 7220 6865 6164 6572 2066 6965  d for header fie
+0000b4d0: 6c64 7320 6173 2077 656c 6c20 6173 2069  lds as well as i
+0000b4e0: 7465 6d20 6669 656c 6473 2e0a 2020 2020  tem fields..    
+0000b4f0: 2020 2020 2020 2020 4974 656d 2069 6e64          Item ind
+0000b500: 6578 2063 616e 2062 6520 6c65 676c 6563  ex can be leglec
+0000b510: 7465 642c 2069 6e20 6361 7365 206f 6620  ted, in case of 
+0000b520: 7669 6465 6f20 6120 6469 6374 207b 3c69  video a dict {<i
+0000b530: 6d61 6765 2d64 6174 6174 696d 653e 3a3c  mage-datatime>:<
+0000b540: 7661 6c75 653e 2c2e 2e2e 7d20 6973 2072  value>,...} is r
+0000b550: 6574 7572 6e65 642e 0a20 2020 2020 2020  eturned..       
+0000b560: 2020 2020 2052 6169 7365 7320 4966 646f       Raises Ifdo
+0000b570: 4578 6365 7074 696f 6e20 6966 2069 7465  Exception if ite
+0000b580: 6d20 646f 6573 206e 6f74 2065 7869 7374  m does not exist
+0000b590: 2e20 2222 220a 2020 2020 2020 2020 6b65  . """.        ke
+0000b5a0: 7973 203d 206b 6579 732e 7370 6c69 7428  ys = keys.split(
+0000b5b0: 273a 2729 0a20 2020 2020 2020 2072 6574  ':').        ret
+0000b5c0: 7572 6e20 7365 6c66 2e5f 5f67 6574 4669  urn self.__getFi
+0000b5d0: 656c 6456 616c 7565 2873 656c 662e 6966  eldValue(self.if
+0000b5e0: 646f 5f74 6d70 2c6b 6579 7329 0a20 2020  do_tmp,keys).   
+0000b5f0: 200a 0a20 2020 2064 6566 2066 696e 6454   ..    def findT
+0000b600: 6d70 4669 656c 6432 2873 656c 662c 6b65  mpField2(self,ke
+0000b610: 7973 293a 0a20 2020 2020 2020 2022 2222  ys):.        """
+0000b620: 2052 6574 7572 6e73 2063 6f70 7920 6f66   Returns copy of
+0000b630: 2074 656d 706f 7261 7279 2075 6e63 6865   temporary unche
+0000b640: 636b 6564 2069 6664 6f20 7365 7420 6f72  cked ifdo set or
+0000b650: 2069 7465 6d20 6669 656c 6420 7661 6c75   item field valu
+0000b660: 652c 2061 6c73 6f20 636f 6e73 6964 6572  e, also consider
+0000b670: 6e67 2064 6566 6175 6c74 2076 616c 7565  ng default value
+0000b680: 7320 6672 6f6d 2068 6561 6465 722e 0a20  s from header.. 
+0000b690: 2020 2020 2020 2020 2020 2055 7365 206b             Use k
+0000b6a0: 6579 7320 6173 2065 2e67 2e20 273c 6974  eys as e.g. '<it
+0000b6b0: 656d 3e3a 3c6b 6579 3e3a 2e2e 2e27 2e20  em>:<key>:...'. 
+0000b6c0: 4361 6e20 6265 2075 7365 6420 666f 7220  Can be used for 
+0000b6d0: 6865 6164 6572 2066 6965 6c64 7320 6173  header fields as
+0000b6e0: 2077 656c 6c20 6173 2069 7465 6d20 6669   well as item fi
+0000b6f0: 656c 6473 2e0a 2020 2020 2020 2020 2020  elds..          
+0000b700: 2020 4974 656d 2069 6e64 6578 2063 616e    Item index can
+0000b710: 2062 6520 6c65 676c 6563 7465 642c 2069   be leglected, i
+0000b720: 6e20 6361 7365 206f 6620 7669 6465 6f20  n case of video 
+0000b730: 6120 6469 6374 207b 3c69 6d61 6765 2d64  a dict {<image-d
+0000b740: 6174 6174 696d 653e 3a3c 7661 6c75 653e  atatime>:<value>
+0000b750: 2c2e 2e2e 7d20 6973 2072 6574 7572 6e65  ,...} is returne
+0000b760: 642e 0a20 2020 2020 2020 2020 2020 2052  d..            R
+0000b770: 6574 7572 6e73 2065 6d70 7479 2073 7472  eturns empty str
+0000b780: 696e 6720 6966 2069 7465 6d20 646f 6573  ing if item does
+0000b790: 206e 6f74 2065 7869 7374 2e20 2222 220a   not exist. """.
+0000b7a0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
+0000b7b0: 4644 4f2e 6669 6e64 5f66 6965 6c64 5f73  FDO.find_field_s
+0000b7c0: 7472 2873 656c 662e 6966 646f 5f74 6d70  tr(self.ifdo_tmp
+0000b7d0: 2c6b 6579 7329 0a20 2020 200a 0a20 2020  ,keys).    ..   
+0000b7e0: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
+0000b7f0: 2020 2064 6566 2066 696e 645f 6669 656c     def find_fiel
+0000b800: 645f 7374 7228 6966 646f 3a64 6963 742c  d_str(ifdo:dict,
+0000b810: 6b65 7973 293a 0a20 2020 2020 2020 2022  keys):.        "
+0000b820: 2222 2052 6574 7572 6e73 2063 6f70 7920  "" Returns copy 
+0000b830: 6f66 2069 6664 6f20 7365 7420 6f72 2069  of ifdo set or i
+0000b840: 7465 6d20 6669 656c 6420 7661 6c75 652c  tem field value,
+0000b850: 2061 6c73 6f20 636f 6e73 6964 6572 6e67   also considerng
+0000b860: 2064 6566 6175 6c74 2076 616c 7565 7320   default values 
+0000b870: 6672 6f6d 2068 6561 6465 722e 0a20 2020  from header..   
+0000b880: 2020 2020 2020 2020 2055 7365 206b 6579           Use key
+0000b890: 7320 6173 2065 2e67 2e20 273c 6974 656d  s as e.g. '<item
+0000b8a0: 3e3a 3c6b 6579 3e3a 2e2e 2e27 2e20 4361  >:<key>:...'. Ca
+0000b8b0: 6e20 6265 2075 7365 6420 666f 7220 6865  n be used for he
+0000b8c0: 6164 6572 2066 6965 6c64 7320 6173 2077  ader fields as w
+0000b8d0: 656c 6c20 6173 2069 7465 6d20 6669 656c  ell as item fiel
+0000b8e0: 6473 2e0a 2020 2020 2020 2020 2020 2020  ds..            
+0000b8f0: 4974 656d 2069 6e64 6578 2063 616e 2062  Item index can b
+0000b900: 6520 6c65 676c 6563 7465 642c 2069 6e20  e leglected, in 
+0000b910: 6361 7365 206f 6620 7669 6465 6f20 6120  case of video a 
+0000b920: 6469 6374 207b 3c69 6d61 6765 2d64 6174  dict {<image-dat
+0000b930: 6174 696d 653e 3a3c 7661 6c75 653e 2c2e  atime>:<value>,.
+0000b940: 2e2e 7d20 6973 2072 6574 7572 6e65 642e  ..} is returned.
+0000b950: 0a20 2020 2020 2020 2020 2020 2052 6574  .            Ret
+0000b960: 7572 6e73 2065 6d70 7479 2073 7472 696e  urns empty strin
+0000b970: 6720 6966 2069 7465 6d20 646f 6573 206e  g if item does n
+0000b980: 6f74 2065 7869 7374 2e20 2222 220a 2020  ot exist. """.  
+0000b990: 2020 2020 2020 6b65 7973 203d 206b 6579        keys = key
+0000b9a0: 732e 7370 6c69 7428 273a 2729 0a20 2020  s.split(':').   
+0000b9b0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000b9c0: 2020 2020 2020 7265 7420 3d20 6946 444f        ret = iFDO
+0000b9d0: 2e5f 5f67 6574 4669 656c 6456 616c 7565  .__getFieldValue
+0000b9e0: 2869 6664 6f2c 6b65 7973 290a 2020 2020  (ifdo,keys).    
+0000b9f0: 2020 2020 6578 6365 7074 206d 6971 7463      except miqtc
+0000ba00: 2e49 6664 6f45 7863 6570 7469 6f6e 2061  .IfdoException a
+0000ba10: 7320 6578 3a0a 2020 2020 2020 2020 2020  s ex:.          
+0000ba20: 2020 7265 7420 3d20 2222 0a20 2020 2020    ret = "".     
+0000ba30: 2020 2072 6574 7572 6e20 7265 740a 0a0a     return ret...
+0000ba40: 2020 2020 6465 6620 7365 7469 4644 4f48      def setiFDOH
+0000ba50: 6561 6465 7246 6965 6c64 7328 7365 6c66  eaderFields(self
+0000ba60: 2c20 6865 6164 6572 3a20 6469 6374 293a  , header: dict):
+0000ba70: 0a20 2020 2020 2020 2022 2222 2044 6570  .        """ Dep
+0000ba80: 7265 6361 7465 6420 2d20 7573 6520 7365  recated - use se
+0000ba90: 745f 6966 646f 5f68 6561 6465 725f 6669  t_ifdo_header_fi
+0000baa0: 656c 6473 2022 2222 0a20 2020 2020 2020  elds """.       
+0000bab0: 2073 656c 662e 7365 745f 6966 646f 5f68   self.set_ifdo_h
+0000bac0: 6561 6465 725f 6669 656c 6473 2868 6561  eader_fields(hea
+0000bad0: 6465 7229 0a0a 0a20 2020 2064 6566 2073  der)...    def s
+0000bae0: 6574 5f69 6664 6f5f 6865 6164 6572 5f66  et_ifdo_header_f
+0000baf0: 6965 6c64 7328 7365 6c66 2c20 6865 6164  ields(self, head
+0000bb00: 6572 3a20 6469 6374 293a 0a20 2020 2020  er: dict):.     
+0000bb10: 2020 2022 2222 2043 6c65 6172 7320 6375     """ Clears cu
+0000bb20: 7272 656e 7420 6865 6164 6572 2066 6965  rrent header fie
+0000bb30: 6c64 7320 756e 6420 7365 7473 2070 726f  lds und sets pro
+0000bb40: 7669 6465 6420 6669 656c 6420 7661 6c75  vided field valu
+0000bb50: 6573 2e20 466f 7220 7570 6461 7469 6e67  es. For updating
+0000bb60: 2065 7869 7374 696e 6720 6f6e 6573 2075   existing ones u
+0000bb70: 7365 2075 7064 6174 655f 6966 646f 5f68  se update_ifdo_h
+0000bb80: 6561 6465 725f 6669 656c 6473 2829 2022  eader_fields() "
+0000bb90: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
+0000bba0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+0000bbb0: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+0000bbc0: 203d 207b 7d0a 2020 2020 2020 2020 6966   = {}.        if
+0000bbd0: 2073 656c 662e 696d 6167 6553 6574 4865   self.imageSetHe
+0000bbe0: 6164 6572 4b65 7920 696e 2068 6561 6465  aderKey in heade
+0000bbf0: 723a 0a20 2020 2020 2020 2020 2020 2068  r:.            h
+0000bc00: 6561 6465 7220 3d20 6865 6164 6572 5b73  eader = header[s
+0000bc10: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000bc20: 6572 4b65 795d 0a20 2020 2020 2020 2066  erKey].        f
+0000bc30: 6f72 2066 6965 6c64 2069 6e20 6865 6164  or field in head
+0000bc40: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+0000bc50: 2369 6620 6669 656c 6420 6e6f 7420 696e  #if field not in
+0000bc60: 206d 6971 7476 2e69 6664 6f5f 6865 6164   miqtv.ifdo_head
+0000bc70: 6572 5f63 6f72 655f 6669 656c 6473 3a0a  er_core_fields:.
+0000bc80: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+0000bc90: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+0000bca0: 4361 7574 696f 6e21 2055 6e6b 6e6f 776e  Caution! Unknown
+0000bcb0: 2068 6561 6465 7220 6669 656c 6420 5c22   header field \"
+0000bcc0: 2220 2b20 6669 656c 6420 2b20 225c 222e  " + field + "\".
+0000bcd0: 204d 6179 6265 2061 2074 7970 6f3f 204f   Maybe a typo? O
+0000bce0: 7468 6572 7769 7365 2069 676e 6f72 6520  therwise ignore 
+0000bcf0: 6d65 2e22 290a 2020 2020 2020 2020 2020  me.").          
+0000bd00: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
+0000bd10: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000bd20: 6465 724b 6579 5d5b 6669 656c 645d 203d  derKey][field] =
+0000bd30: 2068 6561 6465 725b 6669 656c 645d 0a0a   header[field]..
+0000bd40: 0a20 2020 2064 6566 2075 7064 6174 655f  .    def update_
+0000bd50: 6966 646f 5f68 6561 6465 725f 6669 656c  ifdo_header_fiel
+0000bd60: 6473 2873 656c 662c 2068 6561 6465 723a  ds(self, header:
+0000bd70: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
+0000bd80: 2222 2220 5570 6461 7465 7320 6578 6973  """ Updates exis
+0000bd90: 7469 6e67 2068 6561 6465 7220 6669 656c  ting header fiel
+0000bda0: 6473 2022 2222 0a20 2020 2020 2020 2069  ds """.        i
+0000bdb0: 6620 7365 6c66 2e69 6d61 6765 5365 7448  f self.imageSetH
+0000bdc0: 6561 6465 724b 6579 2069 6e20 6865 6164  eaderKey in head
+0000bdd0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+0000bde0: 6865 6164 6572 203d 2068 6561 6465 725b  header = header[
+0000bdf0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000be00: 6465 724b 6579 5d0a 2020 2020 2020 2020  derKey].        
+0000be10: 6c6f 6720 3d20 6d69 7174 632e 7265 6375  log = miqtc.recu
+0000be20: 7273 6976 656c 7955 7064 6174 6544 6963  rsivelyUpdateDic
+0000be30: 7473 2873 656c 662e 6966 646f 5f74 6d70  ts(self.ifdo_tmp
+0000be40: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000be50: 6164 6572 4b65 795d 2c20 6865 6164 6572  aderKey], header
+0000be60: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
+0000be70: 726f 762e 6c6f 6728 6c6f 672c 646f 6e74  rov.log(log,dont
+0000be80: 5368 6f77 3d54 7275 6529 0a0a 2020 2020  Show=True)..    
+0000be90: 6465 6620 7570 6461 7465 6946 444f 4865  def updateiFDOHe
+0000bea0: 6164 6572 4669 656c 6473 2873 656c 662c  aderFields(self,
+0000beb0: 2068 6561 6465 723a 2064 6963 7429 3a0a   header: dict):.
+0000bec0: 2020 2020 2020 2020 2222 2220 4465 7072          """ Depr
+0000bed0: 6563 6174 6564 202d 2075 7365 2075 7064  ecated - use upd
+0000bee0: 6174 655f 6966 646f 5f68 6561 6465 725f  ate_ifdo_header_
+0000bef0: 6669 656c 6473 2022 2222 0a20 2020 2020  fields """.     
+0000bf00: 2020 2073 656c 662e 7570 6461 7465 5f69     self.update_i
+0000bf10: 6664 6f5f 6865 6164 6572 5f66 6965 6c64  fdo_header_field
+0000bf20: 7328 6865 6164 6572 290a 0a0a 2020 2020  s(header)...    
+0000bf30: 6465 6620 5f74 7279 5f75 7067 7261 6465  def _try_upgrade
+0000bf40: 5f74 6f5f 6966 646f 5f76 6572 7369 6f6e  _to_ifdo_version
+0000bf50: 5f32 7828 7365 6c66 293a 0a20 2020 2020  _2x(self):.     
+0000bf60: 2020 2022 2222 2054 7279 2074 6f20 636f     """ Try to co
+0000bf70: 6e76 6572 7420 6669 656c 6473 2066 726f  nvert fields fro
+0000bf80: 6d20 6946 444f 2076 6572 7369 6f6e 203c  m iFDO version <
+0000bf90: 2032 2e30 2e30 2074 6f20 322e 7820 2222   2.0.0 to 2.x ""
+0000bfa0: 220a 2020 2020 2020 2020 7265 6164 5f76  ".        read_v
+0000bfb0: 6572 7369 6f6e 5f73 7472 203d 2022 7631  ersion_str = "v1
+0000bfc0: 2e30 2e30 2220 2320 6469 6420 6e6f 7420  .0.0" # did not 
+0000bfd0: 6861 7665 2074 6865 2027 696d 6167 652d  have the 'image-
+0000bfe0: 7365 742d 6966 646f 2d76 6572 7369 6f6e  set-ifdo-version
+0000bff0: 2720 6669 656c 6420 7965 740a 2020 2020  ' field yet.    
+0000c000: 2020 2020 7472 793a 200a 2020 2020 2020      try: .      
+0000c010: 2020 2020 2020 7265 6164 5f76 6572 7369        read_versi
+0000c020: 6f6e 5f73 7472 203d 2073 656c 662e 6669  on_str = self.fi
+0000c030: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
+0000c040: 652d 7365 742d 6966 646f 2d76 6572 7369  e-set-ifdo-versi
+0000c050: 6f6e 2729 0a20 2020 2020 2020 2065 7863  on').        exc
+0000c060: 6570 7420 6d69 7174 632e 4966 646f 4578  ept miqtc.IfdoEx
+0000c070: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+0000c080: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0000c090: 2020 7265 6164 5f76 6572 7369 6f6e 203d    read_version =
+0000c0a0: 2056 6572 7369 6f6e 2872 6561 645f 7665   Version(read_ve
+0000c0b0: 7273 696f 6e5f 7374 7229 0a0a 2020 2020  rsion_str)..    
+0000c0c0: 2020 2020 6966 2072 6561 645f 7665 7273      if read_vers
+0000c0d0: 696f 6e20 3c20 5665 7273 696f 6e28 2232  ion < Version("2
+0000c0e0: 2e30 2e30 2229 3a0a 2020 2020 2020 2020  .0.0"):.        
+0000c0f0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0000c100: 2023 206e 6577 2055 5249 206f 626a 6563   # new URI objec
+0000c110: 7420 6669 656c 6473 0a20 2020 2020 2020  t fields.       
+0000c120: 2020 2020 206e 6577 5f75 7269 5f66 6965       new_uri_fie
+0000c130: 6c64 7320 3d20 5b27 696d 6167 652d 7365  lds = ['image-se
+0000c140: 6e73 6f72 272c 2769 6d61 6765 2d65 7665  nsor','image-eve
+0000c150: 6e74 272c 2769 6d61 6765 2d70 726f 6a65  nt','image-proje
+0000c160: 6374 272c 2769 6d61 6765 2d63 6f6e 7465  ct','image-conte
+0000c170: 7874 272c 2769 6d61 6765 2d6c 6963 656e  xt','image-licen
+0000c180: 7365 272c 2769 6d61 6765 2d70 6c61 7466  se','image-platf
+0000c190: 6f72 6d27 5d0a 2020 2020 2020 2020 2020  orm'].          
+0000c1a0: 2020 666f 7220 7572 695f 6669 656c 6420    for uri_field 
+0000c1b0: 696e 206e 6577 5f75 7269 5f66 6965 6c64  in new_uri_field
+0000c1c0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0000c1d0: 2020 206f 6c64 5f73 7472 5f76 616c 203d     old_str_val =
+0000c1e0: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
+0000c1f0: 6c64 3228 7572 695f 6669 656c 6429 0a20  ld2(uri_field). 
+0000c200: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000c210: 6620 6973 696e 7374 616e 6365 286f 6c64  f isinstance(old
+0000c220: 5f73 7472 5f76 616c 2c73 7472 2920 616e  _str_val,str) an
+0000c230: 6420 6f6c 645f 7374 725f 7661 6c20 213d  d old_str_val !=
+0000c240: 2022 223a 2020 2020 2020 2020 2020 2020   "":            
+0000c250: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0000c260: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0000c270: 5f6f 626a 5f76 616c 203d 207b 276e 616d  _obj_val = {'nam
+0000c280: 6527 3a20 6f6c 645f 7374 725f 7661 6c7d  e': old_str_val}
+0000c290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c2a0: 2020 2020 2069 735f 7572 692c 206d 7367       is_uri, msg
+0000c2b0: 203d 206d 6971 7474 2e76 616c 6964 6174   = miqtt.validat
+0000c2c0: 655f 6167 6169 6e73 745f 7363 6865 6d61  e_against_schema
+0000c2d0: 286f 6c64 5f73 7472 5f76 616c 2c7b 2274  (old_str_val,{"t
+0000c2e0: 7970 6522 3a20 2273 7472 696e 6722 2c22  ype": "string","
+0000c2f0: 666f 726d 6174 223a 2022 7572 6922 7d29  format": "uri"})
+0000c300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c310: 2020 2020 2069 6620 6973 5f75 7269 3a0a       if is_uri:.
+0000c320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c330: 2020 2020 2020 2020 6e65 775f 6f62 6a5f          new_obj_
+0000c340: 7661 6c5b 2775 7269 275d 203d 206f 6c64  val['uri'] = old
+0000c350: 5f73 7472 5f76 616c 0a20 2020 2020 2020  _str_val.       
+0000c360: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000c370: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+0000c380: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000c390: 795d 5b75 7269 5f66 6965 6c64 5d20 3d20  y][uri_field] = 
+0000c3a0: 6e65 775f 6f62 6a5f 7661 6c0a 2020 2020  new_obj_val.    
+0000c3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3c0: 7365 6c66 2e70 726f 762e 6c6f 6728 2241  self.prov.log("A
+0000c3d0: 7574 6f2d 7570 6772 6164 6564 2022 202b  uto-upgraded " +
+0000c3e0: 2075 7269 5f66 6965 6c64 202b 2022 2066   uri_field + " f
+0000c3f0: 726f 6d20 2220 2b20 6f6c 645f 7374 725f  rom " + old_str_
+0000c400: 7661 6c20 2b20 2220 746f 2022 202b 2073  val + " to " + s
+0000c410: 7472 286e 6577 5f6f 626a 5f76 616c 2929  tr(new_obj_val))
+0000c420: 0a0a 0a0a 2020 2020 6465 6620 7472 7941  ....    def tryA
+0000c430: 7574 6f53 6574 4865 6164 6572 4669 656c  utoSetHeaderFiel
+0000c440: 6473 2873 656c 6629 3a0a 2020 2020 2020  ds(self):.      
+0000c450: 2020 2222 2220 5365 7473 2063 6572 7461    """ Sets certa
+0000c460: 696e 2068 6561 6465 7220 6669 656c 6473  in header fields
+0000c470: 2065 2e67 2e20 6672 6f6d 2064 6972 6563   e.g. from direc
+0000c480: 746f 7279 2069 6620 7468 6579 2061 7265  tory if they are
+0000c490: 206e 6f74 2073 6574 2079 6574 2022 2222   not set yet """
+0000c4a0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0000c4b0: 662e 6669 6e64 546d 7046 6965 6c64 3228  f.findTmpField2(
+0000c4c0: 2769 6d61 6765 2d73 656e 736f 7227 2920  'image-sensor') 
+0000c4d0: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
+0000c4e0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
+0000c4f0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000c500: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
+0000c510: 7365 6e73 6f72 275d 203d 207b 276e 616d  sensor'] = {'nam
+0000c520: 6527 3a20 7365 6c66 2e64 6972 2e73 656e  e': self.dir.sen
+0000c530: 736f 7228 297d 0a20 2020 2020 2020 2065  sor()}.        e
+0000c540: 6c69 6620 7365 6c66 2e66 696e 6454 6d70  lif self.findTmp
+0000c550: 4669 656c 6428 2769 6d61 6765 2d73 656e  Field('image-sen
+0000c560: 736f 7227 295b 276e 616d 6527 5d20 213d  sor')['name'] !=
+0000c570: 2073 656c 662e 6469 722e 7365 6e73 6f72   self.dir.sensor
+0000c580: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0000c590: 7365 6c66 2e70 726f 762e 6c6f 6728 2243  self.prov.log("C
+0000c5a0: 6175 7469 6f6e 2120 2769 6d61 6765 2d73  aution! 'image-s
+0000c5b0: 656e 736f 7227 2022 2b20 7374 7228 7365  ensor' "+ str(se
+0000c5c0: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
+0000c5d0: 2769 6d61 6765 2d73 656e 736f 7227 2929  'image-sensor'))
+0000c5e0: 202b 2022 2064 6966 6665 7273 2066 726f   + " differs fro
+0000c5f0: 6d20 7365 6e73 6f72 2070 6172 7365 6420  m sensor parsed 
+0000c600: 6672 6f6d 2064 6972 6563 746f 7279 3a20  from directory: 
+0000c610: 2220 2b20 7365 6c66 2e64 6972 2e73 656e  " + self.dir.sen
+0000c620: 736f 7228 2929 0a0a 2020 2020 2020 2020  sor())..        
+0000c630: 6966 2073 656c 662e 6669 6e64 546d 7046  if self.findTmpF
+0000c640: 6965 6c64 3228 2769 6d61 6765 2d65 7665  ield2('image-eve
+0000c650: 6e74 2729 203d 3d20 2222 3a0a 2020 2020  nt') == "":.    
+0000c660: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+0000c670: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+0000c680: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
+0000c690: 6d61 6765 2d65 7665 6e74 275d 203d 207b  mage-event'] = {
+0000c6a0: 276e 616d 6527 3a20 7365 6c66 2e64 6972  'name': self.dir
+0000c6b0: 2e65 7665 6e74 2829 7d0a 2020 2020 2020  .event()}.      
+0000c6c0: 2020 656c 6966 2073 656c 662e 6669 6e64    elif self.find
+0000c6d0: 546d 7046 6965 6c64 2827 696d 6167 652d  TmpField('image-
+0000c6e0: 6576 656e 7427 295b 276e 616d 6527 5d20  event')['name'] 
+0000c6f0: 213d 2073 656c 662e 6469 722e 6576 656e  != self.dir.even
+0000c700: 7428 293a 0a20 2020 2020 2020 2020 2020  t():.           
+0000c710: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+0000c720: 4361 7574 696f 6e21 2027 696d 6167 652d  Caution! 'image-
+0000c730: 6576 656e 7427 2022 202b 2073 7472 2873  event' " + str(s
+0000c740: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
+0000c750: 2827 696d 6167 652d 6576 656e 7427 2929  ('image-event'))
+0000c760: 202b 2022 2064 6966 6665 7273 2066 726f   + " differs fro
+0000c770: 6d20 6576 656e 7420 7061 7273 6564 2066  m event parsed f
+0000c780: 726f 6d20 6469 7265 6374 6f72 793a 2022  rom directory: "
+0000c790: 202b 2073 656c 662e 6469 722e 6576 656e   + self.dir.even
+0000c7a0: 7428 2929 0a0a 2020 2020 2020 2020 6966  t())..        if
+0000c7b0: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
+0000c7c0: 6c64 3228 2769 6d61 6765 2d70 726f 6a65  ld2('image-proje
+0000c7d0: 6374 2729 203d 3d20 2222 3a0a 2020 2020  ct') == "":.    
+0000c7e0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+0000c7f0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+0000c800: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
+0000c810: 6d61 6765 2d70 726f 6a65 6374 275d 203d  mage-project'] =
+0000c820: 2020 7b27 6e61 6d65 273a 2073 656c 662e    {'name': self.
+0000c830: 6469 722e 7072 6f6a 6563 7428 297d 0a20  dir.project()}. 
+0000c840: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+0000c850: 2e66 696e 6454 6d70 4669 656c 6428 2769  .findTmpField('i
+0000c860: 6d61 6765 2d70 726f 6a65 6374 2729 5b27  mage-project')['
+0000c870: 6e61 6d65 275d 2021 3d20 7365 6c66 2e64  name'] != self.d
+0000c880: 6972 2e70 726f 6a65 6374 2829 3a0a 2020  ir.project():.  
+0000c890: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000c8a0: 726f 762e 6c6f 6728 2243 6175 7469 6f6e  rov.log("Caution
+0000c8b0: 2120 2769 6d61 6765 2d70 726f 6a65 6374  ! 'image-project
+0000c8c0: 2720 2220 2b20 7374 7228 7365 6c66 2e66  ' " + str(self.f
+0000c8d0: 696e 6454 6d70 4669 656c 6428 2769 6d61  indTmpField('ima
+0000c8e0: 6765 2d70 726f 6a65 6374 2729 2920 2b20  ge-project')) + 
+0000c8f0: 2220 6469 6666 6572 7320 6672 6f6d 2070  " differs from p
+0000c900: 726f 6a65 6374 2070 6172 7365 6420 6672  roject parsed fr
+0000c910: 6f6d 2064 6972 6563 746f 7279 3a20 2220  om directory: " 
+0000c920: 2b20 7365 6c66 2e64 6972 2e70 726f 6a65  + self.dir.proje
+0000c930: 6374 2829 290a 0a20 2020 2020 2020 2069  ct())..        i
+0000c940: 6620 7365 6c66 2e66 696e 6454 6d70 4669  f self.findTmpFi
+0000c950: 656c 6432 2827 696d 6167 652d 706c 6174  eld2('image-plat
+0000c960: 666f 726d 2729 203d 3d20 2222 2061 6e64  form') == "" and
+0000c970: 2073 656c 662e 6469 722e 6765 6172 2829   self.dir.gear()
+0000c980: 2021 3d20 2222 3a0a 2020 2020 2020 2020   != "":.        
+0000c990: 2020 2020 7365 6c66 2e69 6664 6f5f 746d      self.ifdo_tm
+0000c9a0: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
+0000c9b0: 6561 6465 724b 6579 5d5b 2769 6d61 6765  eaderKey]['image
+0000c9c0: 2d70 6c61 7466 6f72 6d27 5d20 3d20 7b27  -platform'] = {'
+0000c9d0: 6e61 6d65 273a 2073 656c 662e 6469 722e  name': self.dir.
+0000c9e0: 6765 6172 2829 7d0a 0a20 2020 2020 2020  gear()}..       
+0000c9f0: 2069 6620 6e6f 7420 2769 6d61 6765 2d73   if not 'image-s
+0000ca00: 6574 2d75 7569 6427 2069 6e20 7365 6c66  et-uuid' in self
+0000ca10: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+0000ca20: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000ca30: 5d3a 0a20 2020 2020 2020 2020 2020 2073  ]:.            s
+0000ca40: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+0000ca50: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000ca60: 4b65 795d 5b27 696d 6167 652d 7365 742d  Key]['image-set-
+0000ca70: 7575 6964 275d 203d 2073 7472 286d 6971  uuid'] = str(miq
+0000ca80: 7463 2e75 7569 6434 2829 290a 2020 2020  tc.uuid4()).    
+0000ca90: 2020 2020 6966 206e 6f74 2027 696d 6167      if not 'imag
+0000caa0: 652d 7365 742d 6861 6e64 6c65 2720 696e  e-set-handle' in
+0000cab0: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+0000cac0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000cad0: 6572 4b65 795d 3a0a 2020 2020 2020 2020  erKey]:.        
+0000cae0: 2020 2020 7365 6c66 2e69 6664 6f5f 746d      self.ifdo_tm
+0000caf0: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
+0000cb00: 6561 6465 724b 6579 5d5b 2769 6d61 6765  eaderKey]['image
+0000cb10: 2d73 6574 2d68 616e 646c 6527 5d20 3d20  -set-handle'] = 
+0000cb20: 7365 6c66 2e68 616e 646c 655f 7072 6566  self.handle_pref
+0000cb30: 6978 202b 2022 2f22 202b 2073 656c 662e  ix + "/" + self.
+0000cb40: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
+0000cb50: 6167 652d 7365 742d 7575 6964 2729 0a20  age-set-uuid'). 
+0000cb60: 2020 2020 2020 2069 6620 6e6f 7420 2769         if not 'i
+0000cb70: 6d61 6765 2d73 6574 2d6e 616d 6527 2069  mage-set-name' i
+0000cb80: 6e20 7365 6c66 2e69 6664 6f5f 746d 705b  n self.ifdo_tmp[
+0000cb90: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000cba0: 6465 724b 6579 5d20 6f72 2073 656c 662e  derKey] or self.
+0000cbb0: 6669 6e64 546d 7046 6965 6c64 3228 2769  findTmpField2('i
+0000cbc0: 6d61 6765 2d73 6574 2d6e 616d 6527 2920  mage-set-name') 
+0000cbd0: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
+0000cbe0: 2020 2023 2063 6f6e 7374 7275 6374 2061     # construct a
+0000cbf0: 7320 3c70 726f 6a65 6374 3e5f 3c65 7665  s <project>_<eve
+0000cc00: 6e74 3e5f 3c73 656e 736f 723e 0a20 2020  nt>_<sensor>.   
+0000cc10: 2020 2020 2020 2020 2070 726f 6a65 6374           project
+0000cc20: 5f20 3d20 7365 6c66 2e66 696e 6454 6d70  _ = self.findTmp
+0000cc30: 4669 656c 6432 2822 696d 6167 652d 7072  Field2("image-pr
+0000cc40: 6f6a 6563 7422 295b 276e 616d 6527 5d0a  oject")['name'].
+0000cc50: 2020 2020 2020 2020 2020 2020 6576 656e              even
+0000cc60: 745f 203d 2073 656c 662e 6669 6e64 546d  t_ = self.findTm
+0000cc70: 7046 6965 6c64 3228 2269 6d61 6765 2d65  pField2("image-e
+0000cc80: 7665 6e74 2229 5b27 6e61 6d65 275d 0a20  vent")['name']. 
+0000cc90: 2020 2020 2020 2020 2020 2069 6620 6576             if ev
+0000cca0: 656e 745f 203d 3d20 2222 3a0a 2020 2020  ent_ == "":.    
+0000ccb0: 2020 2020 2020 2020 2020 2020 6576 656e              even
+0000ccc0: 745f 203d 2073 656c 662e 6469 722e 6576  t_ = self.dir.ev
+0000ccd0: 656e 7428 290a 2020 2020 2020 2020 2020  ent().          
+0000cce0: 2020 7365 6e73 6f72 5f20 3d20 7365 6c66    sensor_ = self
+0000ccf0: 2e66 696e 6454 6d70 4669 656c 6432 2822  .findTmpField2("
+0000cd00: 696d 6167 652d 7365 6e73 6f72 2229 5b27  image-sensor")['
+0000cd10: 6e61 6d65 275d 0a20 2020 2020 2020 2020  name'].         
+0000cd20: 2020 2069 6620 7365 6e73 6f72 5f20 3d3d     if sensor_ ==
+0000cd30: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
+0000cd40: 2020 2020 2073 656e 736f 725f 203d 2073       sensor_ = s
+0000cd50: 656c 662e 6469 722e 7365 6e73 6f72 2829  elf.dir.sensor()
+0000cd60: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000cd70: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+0000cd80: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000cd90: 795d 5b27 696d 6167 652d 7365 742d 6e61  y]['image-set-na
+0000cda0: 6d65 275d 203d 2069 4644 4f2e 636f 6e73  me'] = iFDO.cons
+0000cdb0: 7472 7563 7449 6d61 6765 5365 744e 616d  tructImageSetNam
+0000cdc0: 6528 7072 6f6a 6563 745f 2c65 7665 6e74  e(project_,event
+0000cdd0: 5f2c 7365 6e73 6f72 5f29 0a0a 2020 2020  _,sensor_)..    
+0000cde0: 2020 2020 2320 7365 7420 7665 7273 696f      # set versio
+0000cdf0: 6e0a 2020 2020 2020 2020 7365 6c66 2e69  n.        self.i
+0000ce00: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+0000ce10: 6765 5365 7448 6561 6465 724b 6579 5d5b  geSetHeaderKey][
+0000ce20: 2769 6d61 6765 2d73 6574 2d69 6664 6f2d  'image-set-ifdo-
+0000ce30: 7665 7273 696f 6e27 5d20 3d20 6d69 7174  version'] = miqt
+0000ce40: 762e 6946 444f 5f76 6572 7369 6f6e 0a0a  v.iFDO_version..
+0000ce50: 0a20 2020 2064 6566 2073 6574 4865 6164  .    def setHead
+0000ce60: 6572 496d 6167 654c 6f63 616c 5061 7468  erImageLocalPath
+0000ce70: 4669 656c 6428 7365 6c66 293a 0a20 2020  Field(self):.   
+0000ce80: 2020 2020 2022 2222 2053 6574 7320 6865       """ Sets he
+0000ce90: 6164 6572 2066 6965 6c64 2027 696d 6167  ader field 'imag
+0000cea0: 652d 7365 742d 6c6f 6361 6c2d 7061 7468  e-set-local-path
+0000ceb0: 2720 6672 6f6d 2069 6d61 6765 2064 6972  ' from image dir
+0000cec0: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
+0000ced0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+0000cee0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000cef0: 795d 5b27 696d 6167 652d 7365 742d 6c6f  y]['image-set-lo
+0000cf00: 6361 6c2d 7061 7468 275d 203d 206f 732e  cal-path'] = os.
+0000cf10: 7061 7468 2e72 656c 7061 7468 2873 656c  path.relpath(sel
+0000cf20: 662e 696d 6167 6573 4469 722c 206f 732e  f.imagesDir, os.
+0000cf30: 7061 7468 2e64 6972 6e61 6d65 2873 656c  path.dirname(sel
+0000cf40: 662e 6765 7469 4644 4f46 696c 654e 616d  f.getiFDOFileNam
+0000cf50: 6528 2929 290a 0a0a 2020 2020 6465 6620  e()))...    def 
+0000cf60: 6372 6561 7465 5f66 6965 6c64 7328 7365  create_fields(se
+0000cf70: 6c66 2c20 616c 6c6f 775f 6d69 7373 696e  lf, allow_missin
+0000cf80: 675f 7265 7175 6972 6564 3d46 616c 7365  g_required=False
+0000cf90: 293a 0a20 2020 2020 2020 2022 2222 2043  ):.        """ C
+0000cfa0: 7265 6174 6520 616e 6420 7661 6c69 6461  reate and valida
+0000cfb0: 7465 2063 7572 7265 6e74 2068 6561 6465  te current heade
+0000cfc0: 7220 6669 656c 6473 2061 6e64 2069 7465  r fields and ite
+0000cfd0: 6d20 6669 656c 6473 2066 726f 6d20 696e  m fields from in
+0000cfe0: 7465 726d 6564 6961 7465 2066 696c 6573  termediate files
+0000cff0: 2e20 4f76 6572 7772 6974 6573 2065 7869  . Overwrites exi
+0000d000: 7374 696e 6720 6669 656c 6473 2e20 2222  sting fields. ""
+0000d010: 220a 2020 2020 2020 2020 6974 656d 5f64  ".        item_d
+0000d020: 6174 6120 3d20 7365 6c66 2e5f 6765 745f  ata = self._get_
+0000d030: 6974 656d 5f64 6174 615f 6672 6f6d 5f69  item_data_from_i
+0000d040: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
+0000d050: 7328 290a 2020 2020 2020 2020 7265 7475  s().        retu
+0000d060: 726e 2073 656c 662e 6372 6561 7465 6946  rn self.createiF
+0000d070: 444f 2873 656c 662e 6966 646f 5f74 6d70  DO(self.ifdo_tmp
+0000d080: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000d090: 6164 6572 4b65 795d 2c20 6974 656d 5f64  aderKey], item_d
+0000d0a0: 6174 612e 7661 6c75 6573 2829 2c20 616c  ata.values(), al
+0000d0b0: 6c6f 775f 6d69 7373 696e 675f 7265 7175  low_missing_requ
+0000d0c0: 6972 6564 3d61 6c6c 6f77 5f6d 6973 7369  ired=allow_missi
+0000d0d0: 6e67 5f72 6571 7569 7265 6429 0a0a 0a20  ng_required)... 
+0000d0e0: 2020 2064 6566 2075 7064 6174 655f 6669     def update_fi
+0000d0f0: 656c 6473 2873 656c 662c 2068 6561 6465  elds(self, heade
+0000d100: 725f 6f6e 6c79 3a62 6f6f 6c3d 4e6f 6e65  r_only:bool=None
+0000d110: 293a 0a20 2020 2020 2020 2022 2222 2055  ):.        """ U
+0000d120: 7064 6174 6520 616e 6420 7661 6c69 6461  pdate and valida
+0000d130: 7465 2063 7572 7265 6e74 2068 6561 6465  te current heade
+0000d140: 7220 6669 656c 6473 2061 6e64 2069 7465  r fields and ite
+0000d150: 6d20 6669 656c 6473 2066 726f 6d20 696e  m fields from in
+0000d160: 7465 726d 6564 6961 7465 2066 696c 6573  termediate files
+0000d170: 2e20 2222 220a 2020 2020 2020 2020 6966  . """.        if
+0000d180: 2068 6561 6465 725f 6f6e 6c79 2069 7320   header_only is 
+0000d190: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000d1a0: 2020 6865 6164 6572 5f6f 6e6c 7920 3d20    header_only = 
+0000d1b0: 7365 6c66 2e69 676e 6f72 655f 696d 6167  self.ignore_imag
+0000d1c0: 655f 6669 6c65 730a 2020 2020 2020 2020  e_files.        
+0000d1d0: 6966 206e 6f74 2068 6561 6465 725f 6f6e  if not header_on
+0000d1e0: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
+0000d1f0: 6974 656d 5f64 6174 6120 3d20 7365 6c66  item_data = self
+0000d200: 2e5f 6765 745f 6974 656d 5f64 6174 615f  ._get_item_data_
+0000d210: 6672 6f6d 5f69 6e74 6572 6d65 6469 6174  from_intermediat
+0000d220: 655f 6669 6c65 7328 290a 2020 2020 2020  e_files().      
+0000d230: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000d240: 662e 7570 6461 7465 6946 444f 2873 656c  f.updateiFDO(sel
+0000d250: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+0000d260: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000d270: 795d 2c20 6974 656d 5f64 6174 612e 7661  y], item_data.va
+0000d280: 6c75 6573 2829 290a 2020 2020 2020 2020  lues()).        
+0000d290: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000d2a0: 2020 7265 7475 726e 2073 656c 662e 7570    return self.up
+0000d2b0: 6461 7465 6946 444f 2873 656c 662e 6966  dateiFDO(self.if
+0000d2c0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+0000d2d0: 6553 6574 4865 6164 6572 4b65 795d 2c20  eSetHeaderKey], 
+0000d2e0: 5b5d 2c20 6865 6164 6572 5f6f 6e6c 793d  [], header_only=
+0000d2f0: 5472 7565 290a 0a0a 2020 2020 6465 6620  True)...    def 
+0000d300: 6372 6561 7465 436f 7265 4669 656c 6473  createCoreFields
+0000d310: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0000d320: 2222 2220 4445 5052 4543 4144 4554 2c20  """ DEPRECADET, 
+0000d330: 7573 6520 6372 6561 7465 5f66 6965 6c64  use create_field
+0000d340: 7328 2920 6f72 2075 7064 6174 655f 6669  s() or update_fi
+0000d350: 656c 6473 2829 2069 6e73 7465 642e 0a20  elds() insted.. 
+0000d360: 2020 2020 2020 2046 696c 6c73 2074 6865         Fills the
+0000d370: 2069 4644 4f20 636f 7265 2066 6965 6c64   iFDO core field
+0000d380: 7320 6672 6f6d 2069 6e74 6572 6d65 6469  s from intermedi
+0000d390: 6174 6520 6669 6c65 732e 2057 6974 686f  ate files. Witho
+0000d3a0: 7574 2074 6865 6d20 6e6f 2076 616c 6964  ut them no valid
+0000d3b0: 2069 4644 4f20 6361 6e20 6265 2063 7265   iFDO can be cre
+0000d3c0: 6174 6564 2e0a 2020 2020 2020 2020 2222  ated..        ""
+0000d3d0: 220a 2020 2020 2020 2020 6974 656d 5f64  ".        item_d
+0000d3e0: 6174 6120 3d20 7365 6c66 2e5f 6765 745f  ata = self._get_
+0000d3f0: 6974 656d 5f64 6174 615f 6672 6f6d 5f69  item_data_from_i
+0000d400: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
+0000d410: 735f 636f 7265 2829 0a20 2020 2020 2020  s_core().       
+0000d420: 2023 2063 6865 636b 2066 6965 6c64 7320   # check fields 
+0000d430: 666f 7220 7661 6c69 6469 7479 0a20 2020  for validity.   
+0000d440: 2020 2020 2023 2069 7465 6d5f 6461 7461       # item_data
+0000d450: 2063 6f6e 7461 696e 7320 6669 656c 6420   contains field 
+0000d460: 696d 6167 652d 6669 6c65 6e61 6d65 2c20  image-filename, 
+0000d470: 7768 6963 6820 7768 6963 6820 7769 6c6c  which which will
+0000d480: 206e 6f74 2062 6520 7374 6f72 6564 2061   not be stored a
+0000d490: 7320 616e 2069 7465 6d20 6669 656c 6420  s an item field 
+0000d4a0: 696e 2069 464f 4420 6275 7420 6173 2074  in iFOD but as t
+0000d4b0: 6865 2069 7465 6d20 6e61 6d65 2069 7473  he item name its
+0000d4c0: 656c 660a 2020 2020 2020 2020 7265 7475  elf.        retu
+0000d4d0: 726e 2073 656c 662e 7570 6461 7465 6946  rn self.updateiF
+0000d4e0: 444f 2873 656c 662e 6966 646f 5f74 6d70  DO(self.ifdo_tmp
+0000d4f0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000d500: 6164 6572 4b65 795d 2c20 6974 656d 5f64  aderKey], item_d
+0000d510: 6174 612e 7661 6c75 6573 2829 290a 0a0a  ata.values())...
+0000d520: 2020 2020 6465 6620 6372 6561 7465 4361      def createCa
+0000d530: 7074 7572 6541 6e64 436f 6e74 656e 7446  ptureAndContentF
+0000d540: 6965 6c64 7328 7365 6c66 293a 0a20 2020  ields(self):.   
+0000d550: 2020 2020 2022 2222 2044 4550 5245 4341       """ DEPRECA
+0000d560: 4445 542c 2075 7365 2063 7265 6174 655f  DET, use create_
+0000d570: 6669 656c 6473 2829 206f 7220 7570 6461  fields() or upda
+0000d580: 7465 5f66 6965 6c64 7328 2920 696e 7374  te_fields() inst
+0000d590: 6564 2e0a 2020 2020 2020 2020 4669 6c6c  ed..        Fill
+0000d5a0: 7320 7468 6520 6946 444f 2063 6170 7574  s the iFDO caput
+0000d5b0: 7265 2061 6e64 2063 6f6e 7465 6e74 2066  re and content f
+0000d5c0: 6965 6473 2066 726f 6d20 7072 6f76 6964  ieds from provid
+0000d5d0: 6564 2064 6174 6120 6669 656c 6473 200a  ed data fields .
+0000d5e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000d5f0: 2020 2020 6974 656d 5f64 6174 6120 3d20      item_data = 
+0000d600: 7365 6c66 2e5f 6765 745f 6974 656d 5f64  self._get_item_d
+0000d610: 6174 615f 6672 6f6d 5f69 6e74 6572 6d65  ata_from_interme
+0000d620: 6469 6174 655f 6669 6c65 735f 6e6f 6e65  diate_files_none
+0000d630: 5f63 6f72 6528 290a 2020 2020 2020 2020  _core().        
+0000d640: 2320 6368 6563 6b20 6669 656c 6473 2066  # check fields f
+0000d650: 6f72 2076 616c 6964 6974 790a 2020 2020  or validity.    
+0000d660: 2020 2020 2320 6974 656d 5f64 6174 6120      # item_data 
+0000d670: 636f 6e74 6169 6e73 2066 6965 6c64 2069  contains field i
+0000d680: 6d61 6765 2d66 696c 656e 616d 652c 2077  mage-filename, w
+0000d690: 6869 6368 2077 6869 6368 2077 696c 6c20  hich which will 
+0000d6a0: 6e6f 7420 6265 2073 746f 7265 6420 6173  not be stored as
+0000d6b0: 2061 6e20 6974 656d 2066 6965 6c64 2069   an item field i
+0000d6c0: 6e20 6946 4f44 2062 7574 2061 7320 7468  n iFOD but as th
+0000d6d0: 6520 6974 656d 206e 616d 6520 6974 7365  e item name itse
+0000d6e0: 6c66 0a20 2020 2020 2020 2072 6574 7572  lf.        retur
+0000d6f0: 6e20 7365 6c66 2e75 7064 6174 6569 4644  n self.updateiFD
+0000d700: 4f28 7365 6c66 2e69 6664 6f5f 746d 705b  O(self.ifdo_tmp[
+0000d710: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000d720: 6465 724b 6579 5d2c 2069 7465 6d5f 6461  derKey], item_da
+0000d730: 7461 2e76 616c 7565 7328 2929 0a0a 2020  ta.values())..  
+0000d740: 2020 0a20 2020 2064 6566 205f 6765 745f    .    def _get_
+0000d750: 6974 656d 5f64 6174 615f 6672 6f6d 5f69  item_data_from_i
+0000d760: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
+0000d770: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+0000d780: 2022 2222 2052 6561 6420 6461 7461 2066   """ Read data f
+0000d790: 726f 6d20 636f 7265 2061 6e64 206e 6f6e  rom core and non
+0000d7a0: 652d 636f 7265 2069 6e74 6572 6d64 6561  e-core intermdea
+0000d7b0: 7465 2066 696c 6573 2c20 6368 6563 6b20  te files, check 
+0000d7c0: 6669 6c65 7320 6578 6973 742c 2061 6464  files exist, add
+0000d7d0: 2027 696d 6167 652d 6861 6e64 6c65 272e   'image-handle'.
+0000d7e0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+0000d7f0: 2064 6963 7420 6f66 2066 6f72 6d20 7b69   dict of form {i
+0000d800: 6d61 6765 2d66 696c 652d 6e61 6d65 3a7b  mage-file-name:{
+0000d810: 6669 656c 643a 7661 6c75 657d 2c2e 2e2e  field:value},...
+0000d820: 7d20 0a20 2020 2020 2020 2022 2222 0a20  } .        """. 
+0000d830: 2020 2020 2020 2069 7465 6d5f 6461 7461         item_data
+0000d840: 5f63 6f72 6520 3d20 7365 6c66 2e5f 6765  _core = self._ge
+0000d850: 745f 6974 656d 5f64 6174 615f 6672 6f6d  t_item_data_from
+0000d860: 5f69 6e74 6572 6d65 6469 6174 655f 6669  _intermediate_fi
+0000d870: 6c65 735f 636f 7265 2829 0a20 2020 2020  les_core().     
+0000d880: 2020 2069 7465 6d5f 6461 7461 5f6e 6f6e     item_data_non
+0000d890: 655f 636f 7265 203d 2073 656c 662e 5f67  e_core = self._g
+0000d8a0: 6574 5f69 7465 6d5f 6461 7461 5f66 726f  et_item_data_fro
+0000d8b0: 6d5f 696e 7465 726d 6564 6961 7465 5f66  m_intermediate_f
+0000d8c0: 696c 6573 5f6e 6f6e 655f 636f 7265 2829  iles_none_core()
+0000d8d0: 0a20 2020 2020 2020 2023 7070 7269 6e74  .        #pprint
+0000d8e0: 2869 7465 6d5f 6461 7461 5f6e 6f6e 655f  (item_data_none_
+0000d8f0: 636f 7265 290a 2020 2020 2020 2020 2370  core).        #p
+0000d900: 7072 696e 7428 6974 656d 5f64 6174 615f  print(item_data_
+0000d910: 636f 7265 290a 2020 2020 2020 2020 6974  core).        it
+0000d920: 656d 5f64 6174 6120 3d20 6974 656d 5f64  em_data = item_d
+0000d930: 6174 615f 636f 7265 0a20 2020 2020 2020  ata_core.       
+0000d940: 206c 6f67 203d 206d 6971 7463 2e72 6563   log = miqtc.rec
+0000d950: 7572 7369 7665 6c79 5570 6461 7465 4469  ursivelyUpdateDi
+0000d960: 6374 7328 6974 656d 5f64 6174 612c 2069  cts(item_data, i
+0000d970: 7465 6d5f 6461 7461 5f6e 6f6e 655f 636f  tem_data_none_co
+0000d980: 7265 290a 2020 2020 2020 2020 2370 7072  re).        #ppr
+0000d990: 696e 7428 6974 656d 5f64 6174 6129 0a20  int(item_data). 
+0000d9a0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+0000d9b0: 2e6c 6f67 286c 6f67 2c64 6f6e 7453 686f  .log(log,dontSho
+0000d9c0: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
+0000d9d0: 7265 7475 726e 2069 7465 6d5f 6461 7461  return item_data
+0000d9e0: 0a0a 2020 2020 6465 6620 5f67 6574 5f69  ..    def _get_i
+0000d9f0: 7465 6d5f 6461 7461 5f66 726f 6d5f 696e  tem_data_from_in
+0000da00: 7465 726d 6564 6961 7465 5f66 696c 6573  termediate_files
+0000da10: 5f6e 6f6e 655f 636f 7265 2873 656c 6629  _none_core(self)
+0000da20: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
+0000da30: 6164 2064 6174 6120 6672 6f6d 206e 6f6e  ad data from non
+0000da40: 2d63 6f72 6520 696e 7465 726d 6465 6174  -core intermdeat
+0000da50: 6520 6669 6c65 732e 0a20 2020 2020 2020  e files..       
+0000da60: 2052 6574 7572 6e73 2064 6963 7420 6f66   Returns dict of
+0000da70: 2066 6f72 6d20 7b69 6d61 6765 2d66 696c   form {image-fil
+0000da80: 652d 6e61 6d65 3a7b 6669 656c 643a 7661  e-name:{field:va
+0000da90: 6c75 657d 2c2e 2e2e 7d20 0a20 2020 2020  lue},...} .     
+0000daa0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+0000dab0: 6571 203d 2073 656c 662e 6e6f 6e43 6f72  eq = self.nonCor
+0000dac0: 6546 6965 6c64 496e 7465 726d 6564 6961  eFieldIntermedia
+0000dad0: 7465 4974 656d 496e 666f 4669 6c65 730a  teItemInfoFiles.
+0000dae0: 0a20 2020 2020 2020 2069 7465 6d5f 6461  .        item_da
+0000daf0: 7461 203d 207b 7d0a 2020 2020 2020 2020  ta = {}.        
+0000db00: 7072 6f67 203d 206d 6971 7463 2e50 7269  prog = miqtc.Pri
+0000db10: 6e74 4b6e 6f77 6e50 726f 6772 6573 734d  ntKnownProgressM
+0000db20: 7367 2822 5061 7273 696e 6720 696e 7465  sg("Parsing inte
+0000db30: 726d 6564 6961 7465 2061 6464 6974 696f  rmediate additio
+0000db40: 6e61 6c20 6461 7461 222c 206c 656e 2872  nal data", len(r
+0000db50: 6571 2929 0a20 2020 2020 2020 2066 6f72  eq)).        for
+0000db60: 2072 2069 6e20 7265 713a 0a20 2020 2020   r in req:.     
+0000db70: 2020 2020 2020 2070 726f 672e 7072 6f67         prog.prog
+0000db80: 7265 7373 2829 0a20 2020 2020 2020 2020  ress().         
+0000db90: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
+0000dba0: 6973 7473 2872 2e66 696c 654e 616d 6529  ists(r.fileName)
+0000dbb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000dbc0: 2020 7365 6c66 2e70 7261 7365 4974 656d    self.praseItem
+0000dbd0: 4461 7461 4672 6f6d 4669 6c65 2869 7465  DataFromFile(ite
+0000dbe0: 6d5f 6461 7461 2c72 2e66 696c 654e 616d  m_data,r.fileNam
+0000dbf0: 652c 722e 7365 7061 7261 746f 722c 722e  e,r.separator,r.
+0000dc00: 6865 6164 6572 2c20 722e 6461 7465 7469  header, r.dateti
+0000dc10: 6d65 5f66 6f72 6d61 7429 0a20 2020 2020  me_format).     
+0000dc20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000dc30: 7072 6f76 2e6c 6f67 2822 5061 7273 6564  prov.log("Parsed
+0000dc40: 2069 7465 6d20 6461 7461 2066 726f 6d3a   item data from:
+0000dc50: 2022 202b 2072 2e66 696c 654e 616d 6529   " + r.fileName)
+0000dc60: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0000dc70: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000dc80: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+0000dc90: 2822 4669 6c65 2064 6f65 7320 6e6f 7420  ("File does not 
+0000dca0: 6578 6973 7473 3a20 2220 2b20 722e 6669  exists: " + r.fi
+0000dcb0: 6c65 4e61 6d65 290a 2020 2020 2020 2020  leName).        
+0000dcc0: 7072 6f67 2e63 6c65 6172 2829 0a0a 2020  prog.clear()..  
+0000dcd0: 2020 2020 2020 2320 6368 6563 6b20 6669        # check fi
+0000dce0: 6c65 7320 6578 6973 740a 2020 2020 2020  les exist.      
+0000dcf0: 2020 7265 6d6f 7665 203d 205b 5d0a 2020    remove = [].  
+0000dd00: 2020 2020 2020 666f 7220 696d 6720 696e        for img in
+0000dd10: 2069 7465 6d5f 6461 7461 3a0a 2020 2020   item_data:.    
+0000dd20: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+0000dd30: 6d67 2069 6e20 7365 6c66 2e5f 696d 6167  mg in self._imag
+0000dd40: 654e 616d 6573 496d 6167 6573 4469 723a  eNamesImagesDir:
+0000dd50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dd60: 2072 656d 6f76 652e 6170 7065 6e64 2869   remove.append(i
+0000dd70: 6d67 290a 2020 2020 2020 2020 666f 7220  mg).        for 
+0000dd80: 696d 6720 696e 2072 656d 6f76 653a 0a20  img in remove:. 
+0000dd90: 2020 2020 2020 2020 2020 2064 656c 2069             del i
+0000dda0: 7465 6d5f 6461 7461 5b69 6d67 5d0a 0a20  tem_data[img].. 
+0000ddb0: 2020 2020 2020 2072 6574 7572 6e20 6974         return it
+0000ddc0: 656d 5f64 6174 610a 0a0a 2020 2020 6465  em_data...    de
+0000ddd0: 6620 5f67 6574 5f69 7465 6d5f 6461 7461  f _get_item_data
+0000dde0: 5f66 726f 6d5f 696e 7465 726d 6564 6961  _from_intermedia
+0000ddf0: 7465 5f66 696c 6573 5f63 6f72 6528 7365  te_files_core(se
+0000de00: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0000de10: 2052 6561 6420 6461 7461 2066 726f 6d20   Read data from 
+0000de20: 636f 7265 2069 6e74 6572 6d64 6561 7465  core intermdeate
+0000de30: 2066 696c 6573 2c20 6368 6563 6b20 6669   files, check fi
+0000de40: 6c65 7320 6578 6973 742c 2061 6464 2027  les exist, add '
+0000de50: 696d 6167 652d 6861 6e64 6c65 272e 0a20  image-handle'.. 
+0000de60: 2020 2020 2020 2052 6574 7572 6e73 2064         Returns d
+0000de70: 6963 7420 6f66 2066 6f72 6d20 7b69 6d61  ict of form {ima
+0000de80: 6765 2d66 696c 652d 6e61 6d65 3a7b 6669  ge-file-name:{fi
+0000de90: 656c 643a 7661 6c75 657d 2c2e 2e2e 7d20  eld:value},...} 
+0000dea0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0000deb0: 2020 2020 2020 2320 5768 6963 6820 6669        # Which fi
+0000dec0: 6c65 7320 636f 6e74 6169 6e20 7468 6520  les contain the 
+0000ded0: 696e 666f 726d 6174 696f 6e20 6e65 6564  information need
+0000dee0: 6564 2074 6f20 6372 6561 7465 2074 6865  ed to create the
+0000def0: 2069 4644 4f20 6974 656d 7320 636f 7265   iFDO items core
+0000df00: 2069 6e66 6f72 6d61 7469 6f6e 2061 6e64   information and
+0000df10: 2077 6869 6368 2063 6f6c 756d 6e73 2073   which columns s
+0000df20: 6861 6c6c 2062 6520 7573 6564 0a20 2020  hall be used.   
+0000df30: 2020 2020 2072 6571 203d 2073 656c 662e       req = self.
+0000df40: 696e 7465 726d 6564 6961 7465 4669 6c65  intermediateFile
+0000df50: 7344 6566 5f63 6f72 650a 0a20 2020 2020  sDef_core..     
+0000df60: 2020 2069 7465 6d5f 6461 7461 203d 207b     item_data = {
+0000df70: 7d0a 2020 2020 2020 2020 7072 6f67 203d  }.        prog =
+0000df80: 206d 6971 7463 2e50 7269 6e74 4b6e 6f77   miqtc.PrintKnow
+0000df90: 6e50 726f 6772 6573 734d 7367 2822 5061  nProgressMsg("Pa
+0000dfa0: 7273 696e 6720 696e 7465 726d 6564 6961  rsing intermedia
+0000dfb0: 7465 2063 6f72 6520 6461 7461 222c 206c  te core data", l
+0000dfc0: 656e 2872 6571 2929 0a20 2020 2020 2020  en(req)).       
+0000dfd0: 2066 6f72 2072 2069 6e20 7265 713a 0a20   for r in req:. 
+0000dfe0: 2020 2020 2020 2020 2020 2070 726f 672e             prog.
+0000dff0: 7072 6f67 7265 7373 2829 0a20 2020 2020  progress().     
+0000e000: 2020 2020 2020 2066 696c 6520 3d20 7365         file = se
+0000e010: 6c66 2e5f 5f67 6574 5f69 6e74 5f66 696c  lf.__get_int_fil
+0000e020: 655f 7072 6566 6978 2829 202b 2072 6571  e_prefix() + req
+0000e030: 5b72 5d5b 2773 7566 6669 7827 5d0a 2020  [r]['suffix'].  
+0000e040: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000e050: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+0000e060: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
+0000e070: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+0000e080: 2e6c 6f67 2822 5741 524e 494e 4721 2046  .log("WARNING! F
+0000e090: 6f72 2061 6368 6965 7669 6e67 2046 4149  or achieving FAI
+0000e0a0: 526e 6573 7320 616e 2069 6e74 6572 6d65  Rness an interme
+0000e0b0: 6469 6174 6520 696d 6167 6520 696e 666f  diate image info
+0000e0c0: 2066 696c 6520 6973 206d 6973 7369 6e67   file is missing
+0000e0d0: 3a20 222b 2073 656c 662e 5f5f 6765 745f  : "+ self.__get_
+0000e0e0: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
+0000e0f0: 2920 2b20 7265 715b 725d 5b27 7375 6666  ) + req[r]['suff
+0000e100: 6978 275d 2b20 2220 7275 6e20 6669 7273  ix']+ " run firs
+0000e110: 743a 2022 202b 2072 6571 5b72 5d5b 2763  t: " + req[r]['c
+0000e120: 7265 6174 696f 6e46 6374 275d 290a 2020  reationFct']).  
+0000e130: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000e140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e150: 7365 6c66 2e70 6172 7365 4974 656d 4461  self.parseItemDa
+0000e160: 7461 6672 6f6d 5461 6246 696c 6544 6174  tafromTabFileDat
+0000e170: 6128 6974 656d 5f64 6174 612c 2066 696c  a(item_data, fil
+0000e180: 652c 2072 6571 5b72 5d5b 2763 6f6c 7327  e, req[r]['cols'
+0000e190: 5d2c 2072 6571 5b72 5d5b 276f 7074 696f  ], req[r]['optio
+0000e1a0: 6e61 6c27 5d29 0a20 2020 2020 2020 2020  nal']).         
+0000e1b0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+0000e1c0: 2e6c 6f67 2822 5061 7273 6564 2069 7465  .log("Parsed ite
+0000e1d0: 6d20 6461 7461 2066 726f 6d3a 2022 202b  m data from: " +
+0000e1e0: 2066 696c 6529 0a0a 2020 2020 2020 2020   file)..        
+0000e1f0: 7072 6f67 2e63 6c65 6172 2829 0a20 2020  prog.clear().   
+0000e200: 2020 2020 2069 6620 6c65 6e28 6974 656d       if len(item
+0000e210: 5f64 6174 6129 203d 3d20 303a 0a20 2020  _data) == 0:.   
+0000e220: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
+0000e230: 7863 6570 7469 6f6e 2822 4e6f 2069 4644  xception("No iFD
+0000e240: 4f20 6974 656d 7322 290a 0a20 2020 2020  O items")..     
+0000e250: 2020 2023 2063 6865 636b 2066 696c 6573     # check files
+0000e260: 2065 7869 7374 0a20 2020 2020 2020 2072   exist.        r
+0000e270: 656d 6f76 6520 3d20 5b5d 0a20 2020 2020  emove = [].     
+0000e280: 2020 2066 6f72 2069 6d67 2069 6e20 6974     for img in it
+0000e290: 656d 5f64 6174 613a 0a20 2020 2020 2020  em_data:.       
+0000e2a0: 2020 2020 2069 6620 6e6f 7420 696d 6720       if not img 
+0000e2b0: 696e 2073 656c 662e 5f69 6d61 6765 4e61  in self._imageNa
+0000e2c0: 6d65 7349 6d61 6765 7344 6972 3a0a 2020  mesImagesDir:.  
+0000e2d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000e2e0: 6d6f 7665 2e61 7070 656e 6428 696d 6729  move.append(img)
+0000e2f0: 0a20 2020 2020 2020 2066 6f72 2069 6d67  .        for img
+0000e300: 2069 6e20 7265 6d6f 7665 3a0a 2020 2020   in remove:.    
+0000e310: 2020 2020 2020 2020 6465 6c20 6974 656d          del item
+0000e320: 5f64 6174 615b 696d 675d 0a0a 2020 2020  _data[img]..    
+0000e330: 2020 2020 2320 6164 6420 696d 6167 652d      # add image-
+0000e340: 7572 6c0a 2020 2020 2020 2020 666f 7220  url.        for 
+0000e350: 696d 6720 696e 2069 7465 6d5f 6461 7461  img in item_data
+0000e360: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000e370: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
+0000e380: 5f64 6174 615b 696d 675d 2c6c 6973 7429  _data[img],list)
+0000e390: 3a20 2320 6974 656d 2069 7320 616c 7265  : # item is alre
+0000e3a0: 6164 7920 6120 6c69 7374 2028 7669 6465  ady a list (vide
+0000e3b0: 6f29 2062 7574 2070 6172 7365 6420 6461  o) but parsed da
+0000e3c0: 7461 2069 7320 6e6f 742c 2069 2e65 2e20  ta is not, i.e. 
+0000e3d0: 7061 7273 6564 2064 6174 6120 7265 6665  parsed data refe
+0000e3e0: 7273 2074 6f20 7768 6f6c 6520 7669 6465  rs to whole vide
+0000e3f0: 6f20 2874 696d 6520 696e 6465 7065 6e64  o (time independ
+0000e400: 656e 7429 2c20 692e 652e 2077 7269 7465  ent), i.e. write
+0000e410: 2074 6f20 6669 7273 7420 656e 7472 790a   to first entry.
+0000e420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e430: 7575 6964 203d 2066 696e 6446 6965 6c64  uuid = findField
+0000e440: 2869 7465 6d5f 6461 7461 5b69 6d67 5d5b  (item_data[img][
+0000e450: 305d 2c27 696d 6167 652d 7575 6964 2729  0],'image-uuid')
+0000e460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e470: 2069 6620 7575 6964 203d 3d20 2222 3a0a   if uuid == "":.
+0000e480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e490: 2020 2020 7070 7269 6e74 2869 7465 6d5f      pprint(item_
+0000e4a0: 6461 7461 5b69 6d67 5d5b 305d 290a 2020  data[img][0]).  
+0000e4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4c0: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+0000e4d0: 646f 4578 6365 7074 696f 6e28 2275 7569  doException("uui
+0000e4e0: 6420 6e6f 7420 666f 756e 6420 2861 2922  d not found (a)"
+0000e4f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000e500: 2020 6974 656d 5f64 6174 615b 696d 675d    item_data[img]
+0000e510: 5b30 5d5b 2769 6d61 6765 2d68 616e 646c  [0]['image-handl
+0000e520: 6527 5d20 3d20 7365 6c66 2e69 6d61 6765  e'] = self.image
+0000e530: 5f68 616e 646c 655f 7072 6566 6978 202b  _handle_prefix +
+0000e540: 2027 4027 202b 2075 7569 640a 2020 2020   '@' + uuid.    
+0000e550: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000e560: 2020 2020 2020 2020 2020 2020 2020 7575                uu
+0000e570: 6964 203d 2066 696e 6446 6965 6c64 2869  id = findField(i
+0000e580: 7465 6d5f 6461 7461 5b69 6d67 5d2c 2769  tem_data[img],'i
+0000e590: 6d61 6765 2d75 7569 6427 290a 2020 2020  mage-uuid').    
+0000e5a0: 2020 2020 2020 2020 2020 2020 6966 2075              if u
+0000e5b0: 7569 6420 3d3d 2022 223a 0a20 2020 2020  uid == "":.     
+0000e5c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000e5d0: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
+0000e5e0: 7863 6570 7469 6f6e 2822 7575 6964 206e  xception("uuid n
+0000e5f0: 6f74 2066 6f75 6e64 2028 6229 2229 0a20  ot found (b)"). 
+0000e600: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000e610: 7465 6d5f 6461 7461 5b69 6d67 5d5b 2769  tem_data[img]['i
+0000e620: 6d61 6765 2d68 616e 646c 6527 5d20 3d20  mage-handle'] = 
+0000e630: 7365 6c66 2e69 6d61 6765 5f68 616e 646c  self.image_handl
+0000e640: 655f 7072 6566 6978 202b 2027 4027 202b  e_prefix + '@' +
+0000e650: 2075 7569 640a 0a20 2020 2020 2020 2072   uuid..        r
+0000e660: 6574 7572 6e20 6974 656d 5f64 6174 610a  eturn item_data.
+0000e670: 0a0a 2020 2020 6465 6620 6164 645f 6974  ..    def add_it
+0000e680: 656d 5f69 6e66 6f5f 7461 625f 6669 6c65  em_info_tab_file
+0000e690: 2873 656c 662c 2066 696c 654e 616d 653a  (self, fileName:
+0000e6a0: 2073 7472 2c20 7365 7061 7261 746f 723a   str, separator:
+0000e6b0: 7374 722c 2068 6561 6465 723a 6469 6374  str, header:dict
+0000e6c0: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
+0000e6d0: 7420 3d20 6d69 7174 762e 6461 7465 5f66  t = miqtv.date_f
+0000e6e0: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
+0000e6f0: 293a 0a20 2020 2020 2020 2022 2222 2041  ):.        """ A
+0000e700: 6464 2061 2063 6f6c 756d 6e20 7365 7065  dd a column sepe
+0000e710: 7261 7465 6420 7465 7874 2066 696c 6520  rated text file 
+0000e720: 746f 2070 6172 7365 2069 7465 6d20 6461  to parse item da
+0000e730: 7461 2066 726f 6d20 6279 2063 7265 6174  ta from by creat
+0000e740: 6543 6170 7475 7265 416e 6443 6f6e 7465  eCaptureAndConte
+0000e750: 6e74 4669 656c 6473 2829 2e20 0a20 2020  ntFields(). .   
+0000e760: 2020 2020 2043 6f6c 756d 6e73 2068 6561       Columns hea
+0000e770: 6465 7273 2077 696c 6c20 6265 2073 6574  ders will be set
+0000e780: 2061 7320 6974 656d 2066 6965 6c64 206e   as item field n
+0000e790: 616d 6573 2e20 4d75 7374 2063 6f6e 7461  ames. Must conta
+0000e7a0: 696e 2063 6f6c 756d 6e20 2769 6d61 6765  in column 'image
+0000e7b0: 2d66 696c 656e 616d 6527 2e0a 2020 2020  -filename'..    
+0000e7c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000e7d0: 6966 2066 696c 654e 616d 6520 3d3d 204e  if fileName == N
+0000e7e0: 6f6e 6520 6f72 206e 6f74 206f 732e 7061  one or not os.pa
+0000e7f0: 7468 2e65 7869 7374 7328 6669 6c65 4e61  th.exists(fileNa
+0000e800: 6d65 293a 0a20 2020 2020 2020 2020 2020  me):.           
+0000e810: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+0000e820: 2822 4669 6c65 222c 6669 6c65 4e61 6d65  ("File",fileName
+0000e830: 2c22 6e6f 7420 666f 756e 6422 290a 0a20  ,"not found").. 
+0000e840: 2020 2020 2020 2066 6f72 2066 6965 6c64         for field
+0000e850: 2069 6e20 6865 6164 6572 3a0a 2020 2020   in header:.    
+0000e860: 2020 2020 2020 2020 6966 2068 6561 6465          if heade
+0000e870: 725b 6669 656c 645d 206e 6f74 2069 6e20  r[field] not in 
+0000e880: 6d69 7174 662e 7461 6246 696c 6543 6f6c  miqtf.tabFileCol
+0000e890: 756d 6e4e 616d 6573 2866 696c 654e 616d  umnNames(fileNam
+0000e8a0: 652c 636f 6c5f 7365 7061 7261 746f 723d  e,col_separator=
+0000e8b0: 7365 7061 7261 746f 7229 3a0a 2020 2020  separator):.    
+0000e8c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000e8d0: 6520 4578 6365 7074 696f 6e28 2243 6f6c  e Exception("Col
+0000e8e0: 756d 6e22 2c20 6865 6164 6572 5b66 6965  umn", header[fie
+0000e8f0: 6c64 5d2c 2022 6e6f 7420 696e 2066 696c  ld], "not in fil
+0000e900: 6522 2c20 6669 6c65 4e61 6d65 290a 0a20  e", fileName).. 
+0000e910: 2020 2020 2020 2069 6620 6d69 7174 632e         if miqtc.
+0000e920: 6173 7365 7274 536c 6173 6828 6f73 2e70  assertSlash(os.p
+0000e930: 6174 682e 6469 726e 616d 6528 6669 6c65  ath.dirname(file
+0000e940: 4e61 6d65 2929 2021 3d20 6d69 7174 632e  Name)) != miqtc.
+0000e950: 6173 7365 7274 536c 6173 6828 7365 6c66  assertSlash(self
+0000e960: 2e64 6972 2e74 6f28 7365 6c66 2e64 6972  .dir.to(self.dir
+0000e970: 2e64 742e 696e 7465 726d 6564 6961 7465  .dt.intermediate
+0000e980: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0000e990: 7365 6c66 2e70 726f 762e 6c6f 6728 2022  self.prov.log( "
+0000e9a0: 4361 7574 696f 6e21 2049 7420 6973 2072  Caution! It is r
+0000e9b0: 6563 6f6d 6d65 6e64 6564 2074 6f20 7075  ecommended to pu
+0000e9c0: 7420 6669 6c65 2069 6e20 7468 6520 6469  t file in the di
+0000e9d0: 7265 6374 6f72 7927 7320 2769 6e74 6572  rectory's 'inter
+0000e9e0: 6d65 6469 6174 6527 2066 6f6c 6465 723a  mediate' folder:
+0000e9f0: 2022 202b 2066 696c 654e 616d 6529 0a20   " + fileName). 
+0000ea00: 2020 2020 2020 206e 6366 6969 6620 3d20         ncfiif = 
+0000ea10: 6e6f 6e43 6f72 6546 6965 6c64 496e 7465  nonCoreFieldInte
+0000ea20: 726d 6564 6961 7465 4974 656d 496e 666f  rmediateItemInfo
+0000ea30: 4669 6c65 2866 696c 654e 616d 652c 2073  File(fileName, s
+0000ea40: 6570 6172 6174 6f72 2c20 6865 6164 6572  eparator, header
+0000ea50: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
+0000ea60: 7429 0a20 2020 2020 2020 2069 6620 6e63  t).        if nc
+0000ea70: 6669 6966 206e 6f74 2069 6e20 7365 6c66  fiif not in self
+0000ea80: 2e6e 6f6e 436f 7265 4669 656c 6449 6e74  .nonCoreFieldInt
+0000ea90: 6572 6d65 6469 6174 6549 7465 6d49 6e66  ermediateItemInf
+0000eaa0: 6f46 696c 6573 3a20 0a20 2020 2020 2020  oFiles: .       
+0000eab0: 2020 2020 2073 656c 662e 6e6f 6e43 6f72       self.nonCor
+0000eac0: 6546 6965 6c64 496e 7465 726d 6564 6961  eFieldIntermedia
+0000ead0: 7465 4974 656d 496e 666f 4669 6c65 732e  teItemInfoFiles.
+0000eae0: 6170 7065 6e64 286e 6366 6969 6629 0a0a  append(ncfiif)..
+0000eaf0: 2020 2020 6465 6620 6164 6449 7465 6d49      def addItemI
+0000eb00: 6e66 6f54 6162 4669 6c65 2873 656c 662c  nfoTabFile(self,
+0000eb10: 2066 696c 654e 616d 653a 2073 7472 2c20   fileName: str, 
+0000eb20: 7365 7061 7261 746f 723a 7374 722c 2068  separator:str, h
+0000eb30: 6561 6465 723a 6469 6374 2c20 6461 7465  eader:dict, date
+0000eb40: 7469 6d65 5f66 6f72 6d61 7420 3d20 6d69  time_format = mi
+0000eb50: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
+0000eb60: 5b27 6d61 7269 7174 275d 293a 0a20 2020  ['mariqt']):.   
+0000eb70: 2020 2020 2022 2222 2044 6570 7265 6361       """ Depreca
+0000eb80: 7465 6420 2d20 7573 6520 6164 645f 6974  ted - use add_it
+0000eb90: 656d 5f69 6e66 6f5f 7461 625f 6669 6c65  em_info_tab_file
+0000eba0: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
+0000ebb0: 662e 6164 645f 6974 656d 5f69 6e66 6f5f  f.add_item_info_
+0000ebc0: 7461 625f 6669 6c65 2866 696c 654e 616d  tab_file(fileNam
+0000ebd0: 652c 7365 7061 7261 746f 722c 6865 6164  e,separator,head
+0000ebe0: 6572 2c64 6174 6574 696d 655f 666f 726d  er,datetime_form
+0000ebf0: 6174 290a 0a20 2020 2020 2020 200a 2020  at)..        .  
+0000ec00: 2020 6465 6620 7265 6d6f 7665 4974 656d    def removeItem
+0000ec10: 496e 666f 5461 6246 696c 6528 7365 6c66  InfoTabFile(self
+0000ec20: 2c20 6669 6c65 4e61 6d65 3a20 7374 722c  , fileName: str,
+0000ec30: 2073 6570 6172 6174 6f72 3a73 7472 2c20   separator:str, 
+0000ec40: 6865 6164 6572 3a64 6963 742c 2064 6174  header:dict, dat
+0000ec50: 6574 696d 655f 666f 726d 6174 3a73 7472  etime_format:str
+0000ec60: 293a 0a20 2020 2020 2020 2022 2222 2072  ):.        """ r
+0000ec70: 656d 6f76 6573 2066 696c 6520 6974 656d  emoves file item
+0000ec80: 2066 726f 6d20 6c69 7374 206f 6620 6669   from list of fi
+0000ec90: 6c65 7320 746f 2070 6172 7365 2069 7465  les to parse ite
+0000eca0: 6d20 6461 7461 2066 726f 6d20 6279 2063  m data from by c
+0000ecb0: 7265 6174 6543 6170 7475 7265 416e 6443  reateCaptureAndC
+0000ecc0: 6f6e 7465 6e74 4669 656c 6473 2829 2022  ontentFields() "
+0000ecd0: 2222 0a20 2020 2020 2020 206e 6366 6969  "".        ncfii
+0000ece0: 6620 3d20 6e6f 6e43 6f72 6546 6965 6c64  f = nonCoreField
+0000ecf0: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
+0000ed00: 496e 666f 4669 6c65 2866 696c 654e 616d  InfoFile(fileNam
+0000ed10: 652c 2073 6570 6172 6174 6f72 2c20 6865  e, separator, he
+0000ed20: 6164 6572 2c20 6461 7465 7469 6d65 5f66  ader, datetime_f
+0000ed30: 6f72 6d61 7429 0a20 2020 2020 2020 2069  ormat).        i
+0000ed40: 6620 6e63 6669 6966 2069 6e20 7365 6c66  f ncfiif in self
+0000ed50: 2e6e 6f6e 436f 7265 4669 656c 6449 6e74  .nonCoreFieldInt
+0000ed60: 6572 6d65 6469 6174 6549 7465 6d49 6e66  ermediateItemInf
+0000ed70: 6f46 696c 6573 3a20 0a20 2020 2020 2020  oFiles: .       
+0000ed80: 2020 2020 2073 656c 662e 6e6f 6e43 6f72       self.nonCor
+0000ed90: 6546 6965 6c64 496e 7465 726d 6564 6961  eFieldIntermedia
+0000eda0: 7465 4974 656d 496e 666f 4669 6c65 732e  teItemInfoFiles.
+0000edb0: 7265 6d6f 7665 286e 6366 6969 6629 0a0a  remove(ncfiif)..
+0000edc0: 0a20 2020 2064 6566 2075 7064 6174 6569  .    def updatei
+0000edd0: 4644 4f28 7365 6c66 2c20 6865 6164 6572  FDO(self, header
+0000ede0: 3a20 6469 6374 2c20 6974 656d 733a 206c  : dict, items: l
+0000edf0: 6973 742c 2068 6561 6465 725f 6f6e 6c79  ist, header_only
+0000ee00: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+0000ee10: 2022 2222 2055 7064 6174 6573 2074 6865   """ Updates the
+0000ee20: 2063 7572 7265 6e74 2076 616c 7565 7320   current values 
+0000ee30: 6946 444f 2077 6974 6820 7468 6520 7072  iFDO with the pr
+0000ee40: 6f76 6964 6564 206e 6577 2076 616c 7565  ovided new value
+0000ee50: 7320 2222 220a 2020 2020 2020 2020 7265  s """.        re
+0000ee60: 7475 726e 2073 656c 662e 6372 6561 7465  turn self.create
+0000ee70: 6946 444f 2868 6561 6465 722c 2069 7465  iFDO(header, ite
+0000ee80: 6d73 2c20 7570 6461 7465 4578 6973 7469  ms, updateExisti
+0000ee90: 6e67 3d54 7275 652c 2068 6561 6465 724f  ng=True, headerO
+0000eea0: 6e6c 793d 6865 6164 6572 5f6f 6e6c 7929  nly=header_only)
+0000eeb0: 0a0a 0a20 2020 2064 6566 2063 7265 6174  ...    def creat
+0000eec0: 6569 4644 4f28 7365 6c66 2c20 6865 6164  eiFDO(self, head
+0000eed0: 6572 3a20 6469 6374 2c20 6974 656d 733a  er: dict, items:
+0000eee0: 206c 6973 742c 2075 7064 6174 6545 7869   list, updateExi
+0000eef0: 7374 696e 673d 4661 6c73 652c 6865 6164  sting=False,head
+0000ef00: 6572 4f6e 6c79 3d46 616c 7365 2c61 6c6c  erOnly=False,all
+0000ef10: 6f77 5f6d 6973 7369 6e67 5f72 6571 7569  ow_missing_requi
+0000ef20: 7265 643d 4661 6c73 652c 7661 6c69 6461  red=False,valida
+0000ef30: 7465 5f73 696e 676c 655f 6974 656d 733d  te_single_items=
+0000ef40: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+0000ef50: 2222 2220 4372 6561 7465 7320 4641 4952  """ Creates FAIR
+0000ef60: 2064 6967 6974 616c 206f 626a 6563 7420   digital object 
+0000ef70: 666f 7220 7468 6520 696d 6167 6520 6461  for the image da
+0000ef80: 7461 2069 7473 656c 662e 2054 6869 7320  ta itself. This 
+0000ef90: 636f 6e73 6973 7473 206f 6620 6865 6164  consists of head
+0000efa0: 6572 2069 6e66 6f72 6d61 7469 6f6e 2061  er information a
+0000efb0: 6e64 2069 7465 6d20 696e 666f 726d 6174  nd item informat
+0000efc0: 696f 6e2e 0a20 2020 2020 2020 2075 7064  ion..        upd
+0000efd0: 6174 6545 7869 7374 696e 673a 2069 6620  ateExisting: if 
+0000efe0: 4661 6c73 6520 6f6c 6420 7661 6c75 6573  False old values
+0000eff0: 2061 7265 2072 656d 6f76 6564 2c20 6f74   are removed, ot
+0000f000: 6865 7277 6973 6520 7468 6579 2061 7265  herwise they are
+0000f010: 2075 7064 6174 6564 2e0a 2020 2020 2020   updated..      
+0000f020: 2020 6865 6164 6572 4f6e 6c79 3a20 6966    headerOnly: if
+0000f030: 2054 7275 6520 6974 656d 7320 6d61 7920   True items may 
+0000f040: 6265 2065 6d70 7479 206c 6973 742e 0a20  be empty list.. 
+0000f050: 2020 2020 2020 2061 6c6c 6f77 5f6d 6973         allow_mis
+0000f060: 7369 6e67 5f72 6571 7569 7265 643a 2069  sing_required: i
+0000f070: 6620 5472 7565 2c20 6e6f 2065 7863 6570  f True, no excep
+0000f080: 7469 6f6e 2072 6973 656e 2069 6620 6120  tion risen if a 
+0000f090: 7265 7175 6972 6564 2066 6965 6c64 2069  required field i
+0000f0a0: 7320 6d69 7373 696e 672e 2020 2222 220a  s missing.  """.
+0000f0b0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000f0c0: 7570 6461 7465 4578 6973 7469 6e67 2061  updateExisting a
+0000f0d0: 6e64 206c 656e 2869 7465 6d73 2920 3d3d  nd len(items) ==
+0000f0e0: 2030 2061 6e64 206e 6f74 2068 6561 6465   0 and not heade
+0000f0f0: 724f 6e6c 793a 0a20 2020 2020 2020 2020  rOnly:.         
+0000f100: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+0000f110: 6f6e 2827 4e6f 2069 7465 6d20 696e 666f  on('No item info
+0000f120: 726d 6174 696f 6e20 6769 7665 6e27 290a  rmation given').
+0000f130: 0a20 2020 2020 2020 2069 6620 7570 6461  .        if upda
+0000f140: 7465 4578 6973 7469 6e67 3a0a 2020 2020  teExisting:.    
+0000f150: 2020 2020 2020 2020 2320 6865 6164 6572          # header
+0000f160: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000f170: 662e 7570 6461 7465 5f69 6664 6f5f 6865  f.update_ifdo_he
+0000f180: 6164 6572 5f66 6965 6c64 7328 6865 6164  ader_fields(head
+0000f190: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+0000f1a0: 2320 6974 656d 730a 2020 2020 2020 2020  # items.        
+0000f1b0: 2020 2020 2320 7570 6461 7465 2063 6f70      # update cop
+0000f1c0: 7920 6f66 2063 7572 7265 6e74 2069 7465  y of current ite
+0000f1d0: 6d73 2077 6974 6820 6e65 7720 6974 656d  ms with new item
+0000f1e0: 7320 6669 656c 6473 0a20 2020 2020 2020  s fields.       
+0000f1f0: 2020 2020 2069 6620 6e6f 7420 6865 6164       if not head
+0000f200: 6572 4f6e 6c79 3a0a 2020 2020 2020 2020  erOnly:.        
+0000f210: 2020 2020 2020 2020 6974 656d 7344 6963          itemsDic
+0000f220: 7420 3d20 6d69 7174 692e 6372 6561 7465  t = miqti.create
+0000f230: 496d 6167 6549 7465 6d73 4469 6374 4672  ImageItemsDictFr
+0000f240: 6f6d 496d 6167 6549 7465 6d73 4c69 7374  omImageItemsList
+0000f250: 2869 7465 6d73 290a 2020 2020 2020 2020  (items).        
+0000f260: 2020 2020 2020 2020 7570 6461 7465 6449          updatedI
+0000f270: 7465 6d73 5f63 6f70 7920 3d20 636f 7079  tems_copy = copy
+0000f280: 2e64 6565 7063 6f70 7928 7365 6c66 2e69  .deepcopy(self.i
+0000f290: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+0000f2a0: 6765 5365 7449 7465 6d73 4b65 795d 290a  geSetItemsKey]).
+0000f2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2c0: 6c6f 6720 3d20 6d69 7174 632e 7265 6375  log = miqtc.recu
+0000f2d0: 7273 6976 656c 7955 7064 6174 6544 6963  rsivelyUpdateDic
+0000f2e0: 7473 2875 7064 6174 6564 4974 656d 735f  ts(updatedItems_
+0000f2f0: 636f 7079 2c20 6974 656d 7344 6963 7429  copy, itemsDict)
+0000f300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f310: 2073 656c 662e 7072 6f76 2e6c 6f67 286c   self.prov.log(l
+0000f320: 6f67 2c64 6f6e 7453 686f 773d 5472 7565  og,dontShow=True
+0000f330: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000f340: 2020 6974 656d 7320 3d20 6d69 7174 692e    items = miqti.
+0000f350: 6372 6561 7465 496d 6167 6549 7465 6d73  createImageItems
+0000f360: 4c69 7374 4672 6f6d 496d 6167 6549 7465  ListFromImageIte
+0000f370: 6d73 4469 6374 2875 7064 6174 6564 4974  msDict(updatedIt
+0000f380: 656d 735f 636f 7079 290a 0a20 2020 2020  ems_copy)..     
+0000f390: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000f3a0: 2020 2020 2023 206f 7665 7277 7269 7465       # overwrite
+0000f3b0: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
+0000f3c0: 2020 2020 7365 6c66 2e73 6574 5f69 6664      self.set_ifd
+0000f3d0: 6f5f 6865 6164 6572 5f66 6965 6c64 7328  o_header_fields(
+0000f3e0: 6865 6164 6572 290a 2020 2020 2020 2020  header).        
+0000f3f0: 2020 2020 2320 636c 6561 7220 6974 656d      # clear item
+0000f400: 7320 7365 6374 696f 6e0a 2020 2020 2020  s section.      
+0000f410: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+0000f420: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0000f430: 7449 7465 6d73 4b65 795d 203d 207b 7d0a  tItemsKey] = {}.
+0000f440: 0a20 2020 2020 2020 2023 2050 6172 7365  .        # Parse
+0000f450: 2069 6d61 6765 2d61 6273 7472 6163 7420   image-abstract 
+0000f460: 616e 6420 6669 6c6c 2069 7473 2070 6c61  and fill its pla
+0000f470: 6365 686f 6c64 6572 7320 7769 7468 2069  ceholders with i
+0000f480: 6e66 6f72 6d61 7469 6f6e 0a20 2020 2020  nformation.     
+0000f490: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000f4a0: 2020 2020 7365 6c66 2e69 6664 6f5f 746d      self.ifdo_tm
+0000f4b0: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
+0000f4c0: 6561 6465 724b 6579 5d5b 2769 6d61 6765  eaderKey]['image
+0000f4d0: 2d61 6273 7472 6163 7427 5d20 3d20 6d69  -abstract'] = mi
+0000f4e0: 7174 732e 7061 7273 6552 6570 6c61 6365  qts.parseReplace
+0000f4f0: 5661 6c28 7365 6c66 2e69 6664 6f5f 746d  Val(self.ifdo_tm
+0000f500: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
+0000f510: 6561 6465 724b 6579 5d2c 2027 696d 6167  eaderKey], 'imag
+0000f520: 652d 6162 7374 7261 6374 2729 0a20 2020  e-abstract').   
+0000f530: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+0000f540: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
+0000f550: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0000f560: 6f76 2e6c 6f67 2822 436f 756c 6420 6e6f  ov.log("Could no
+0000f570: 7420 7265 706c 6163 6520 6b65 7973 2069  t replace keys i
+0000f580: 6e20 5c27 696d 6167 652d 6162 7374 7261  n \'image-abstra
+0000f590: 6374 5c27 3a20 2220 2b20 7374 7228 6578  ct\': " + str(ex
+0000f5a0: 2929 0a0a 0a20 2020 2020 2020 2023 2073  ))...        # s
+0000f5b0: 6574 2076 6572 7369 6f6e 2028 736f 2069  et version (so i
+0000f5c0: 7420 6361 6e6e 6f74 2062 6520 6368 616e  t cannot be chan
+0000f5d0: 6765 6420 6279 2075 7365 7229 0a20 2020  ged by user).   
+0000f5e0: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
+0000f5f0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+0000f600: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
+0000f610: 652d 7365 742d 6966 646f 2d76 6572 7369  e-set-ifdo-versi
+0000f620: 6f6e 275d 203d 206d 6971 7476 2e69 4644  on'] = miqtv.iFD
+0000f630: 4f5f 7665 7273 696f 6e0a 0a20 2020 2020  O_version..     
+0000f640: 2020 2023 2056 616c 6964 6174 6520 6974     # Validate it
+0000f650: 656d 2069 6e66 6f72 6d61 7469 6f6e 0a20  em information. 
+0000f660: 2020 2020 2020 2069 6d61 6765 5f73 6574         image_set
+0000f670: 5f69 7465 6d73 203d 207b 7d0a 2020 2020  _items = {}.    
+0000f680: 2020 2020 6966 2068 6561 6465 724f 6e6c      if headerOnl
+0000f690: 793a 0a20 2020 2020 2020 2020 2020 2073  y:.            s
+0000f6a0: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
+0000f6b0: 7574 696f 6e21 2069 4644 4f20 6372 6561  ution! iFDO crea
+0000f6c0: 7465 6420 696e 2068 6561 6465 725f 6f6e  ted in header_on
+0000f6d0: 6c79 2f69 676e 6f72 655f 696d 6167 655f  ly/ignore_image_
+0000f6e0: 6669 6c65 206d 6f64 652e 2049 6d61 6765  file mode. Image
+0000f6f0: 2069 7465 6d73 2061 7265 206e 6569 7468   items are neith
+0000f700: 6572 2075 7064 6174 6564 206e 6f72 2063  er updated nor c
+0000f710: 6865 636b 6564 2e22 290a 2020 2020 2020  hecked.").      
+0000f720: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000f730: 2020 2020 696e 7661 6c69 645f 6974 656d      invalid_item
+0000f740: 7320 3d20 300a 0a20 2020 2020 2020 2020  s = 0..         
+0000f750: 2020 2070 726f 6720 3d20 6d69 7174 632e     prog = miqtc.
+0000f760: 5072 696e 744b 6e6f 776e 5072 6f67 7265  PrintKnownProgre
+0000f770: 7373 4d73 6728 2243 6865 636b 696e 6720  ssMsg("Checking 
+0000f780: 6974 656d 7322 2c20 6c65 6e28 6974 656d  items", len(item
+0000f790: 7329 2c6d 6f64 756c 6f3d 3529 0a20 2020  s),modulo=5).   
+0000f7a0: 2020 2020 2020 2020 2066 6f72 2069 7465           for ite
+0000f7b0: 6d20 696e 2069 7465 6d73 3a0a 2020 2020  m in items:.    
+0000f7c0: 2020 2020 2020 2020 2020 2020 7072 6f67              prog
+0000f7d0: 2e70 726f 6772 6573 7328 290a 2020 2020  .progress().    
+0000f7e0: 2020 2020 2020 2020 2020 2020 2320 6368              # ch
+0000f7f0: 6563 6b20 6966 2061 6c6c 2063 6f72 6520  eck if all core 
+0000f800: 6669 656c 6473 2061 7265 2066 696c 6c65  fields are fille
+0000f810: 6420 616e 6420 6172 6520 6669 6c6c 6564  d and are filled
+0000f820: 2076 616c 6964 6c79 0a20 2020 2020 2020   validly.       
+0000f830: 2020 2020 2020 2020 2074 7279 3a0a 0a20           try:.. 
+0000f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f850: 2020 2023 2063 6865 636b 2069 7465 6d20     # check item 
+0000f860: 696d 6167 6520 6578 6973 7473 0a20 2020  image exists.   
+0000f870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f880: 2023 2069 6620 6974 656d 2069 7320 6120   # if item is a 
+0000f890: 6c69 7374 2028 7669 6465 6f29 2c20 6f6e  list (video), on
+0000f8a0: 6520 776f 756c 6420 6861 7665 2074 6f20  e would have to 
+0000f8b0: 6368 6563 6b20 6966 2065 6163 6820 656e  check if each en
+0000f8c0: 7472 7920 6973 2076 616c 6964 2067 6976  try is valid giv
+0000f8d0: 656e 2074 6865 2064 6566 6175 6c74 2076  en the default v
+0000f8e0: 616c 7565 7320 696e 2066 6972 7374 2065  alues in first e
+0000f8f0: 6e74 7279 2070 6c75 7320 6769 7665 6e20  ntry plus given 
+0000f900: 6465 6661 756c 7420 7661 6c75 6573 2069  default values i
+0000f910: 6e20 6865 6164 6572 0a20 2020 2020 2020  n header.       
+0000f920: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000f930: 6e6f 7420 6973 696e 7374 616e 6365 2869  not isinstance(i
+0000f940: 7465 6d2c 6c69 7374 293a 0a20 2020 2020  tem,list):.     
+0000f950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f960: 2020 2069 7465 6d20 3d20 5b69 7465 6d5d     item = [item]
+0000f970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f980: 2020 2020 2073 7562 4974 656d 4465 6661       subItemDefa
+0000f990: 756c 7420 3d20 6974 656d 5b30 5d20 0a20  ult = item[0] . 
+0000f9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f9b0: 2020 2066 6f72 2073 7562 4974 656d 2069     for subItem i
+0000f9c0: 6e20 6974 656d 3a0a 2020 2020 2020 2020  n item:.        
+0000f9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f9e0: 6669 6c65 5f6e 616d 6520 3d20 7375 6249  file_name = subI
+0000f9f0: 7465 6d5b 2769 6d61 6765 2d66 696c 656e  tem['image-filen
+0000fa00: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
+0000fa10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000fa20: 206e 6f74 2073 656c 662e 6967 6e6f 7265   not self.ignore
+0000fa30: 5f69 6d61 6765 5f66 696c 6573 2061 6e64  _image_files and
+0000fa40: 2066 696c 655f 6e61 6d65 206e 6f74 2069   file_name not i
+0000fa50: 6e20 7365 6c66 2e5f 696d 6167 654e 616d  n self._imageNam
+0000fa60: 6573 496d 6167 6573 4469 723a 0a20 2020  esImagesDir:.   
+0000fa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa80: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
+0000fa90: 7863 6570 7469 6f6e 2822 4974 656d 2027  xception("Item '
+0000faa0: 2220 2b20 6669 6c65 5f6e 616d 6520 2b20  " + file_name + 
+0000fab0: 2227 206e 6f74 2066 6f75 6e64 2069 6e20  "' not found in 
+0000fac0: 2f72 6177 2064 6972 6563 746f 7279 2e22  /raw directory."
+0000fad0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000fae0: 2020 2020 2020 2020 2020 2069 6620 7661             if va
+0000faf0: 6c69 6461 7465 5f73 696e 676c 655f 6974  lidate_single_it
+0000fb00: 656d 733a 0a20 2020 2020 2020 2020 2020  ems:.           
+0000fb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb20: 206d 6971 7474 2e61 7265 5f76 616c 6964   miqtt.are_valid
+0000fb30: 5f69 6664 6f5f 6669 656c 6473 2873 7562  _ifdo_fields(sub
+0000fb40: 4974 656d 290a 2020 2020 2020 2020 2020  Item).          
+0000fb50: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000fb60: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000fb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb80: 666f 7220 6669 656c 645f 6e61 6d65 2c66  for field_name,f
+0000fb90: 6965 6c64 5f76 616c 2069 6e20 7375 6249  ield_val in subI
+0000fba0: 7465 6d2e 6974 656d 7328 293a 0a20 2020  tem.items():.   
+0000fbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fbc0: 2020 2020 2020 2020 2020 2020 206d 6971               miq
+0000fbd0: 7474 2e69 6664 6f5f 6669 656c 645f 6164  tt.ifdo_field_ad
+0000fbe0: 6469 7469 6f6e 616c 5f63 6865 636b 7328  ditional_checks(
+0000fbf0: 6669 656c 645f 6e61 6d65 2c66 6965 6c64  field_name,field
+0000fc00: 5f76 616c 2920 2020 2020 2020 2020 2020  _val)           
+0000fc10: 2020 2020 2020 2020 2020 2020 200a 0a20               .. 
+0000fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc30: 2020 2069 6d61 6765 5f73 6574 5f69 7465     image_set_ite
+0000fc40: 6d73 5b73 7562 4974 656d 4465 6661 756c  ms[subItemDefaul
+0000fc50: 745b 2769 6d61 6765 2d66 696c 656e 616d  t['image-filenam
+0000fc60: 6527 5d5d 203d 205b 5d20 2320 636f 756c  e']] = [] # coul
+0000fc70: 6420 6d61 6b65 2061 6e20 6578 7472 6120  d make an extra 
+0000fc80: 6361 7365 2066 6f72 2069 6d61 6765 7320  case for images 
+0000fc90: 6f6d 6974 7469 6e67 2074 6865 206c 6973  omitting the lis
+0000fca0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0000fcb0: 2020 2020 2020 666f 7220 7375 6249 7465        for subIte
+0000fcc0: 6d20 696e 2069 7465 6d3a 0a20 2020 2020  m in item:.     
+0000fcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fce0: 2020 2073 7562 4974 656d 4469 6374 203d     subItemDict =
+0000fcf0: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
+0000fd00: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000fd10: 6974 2069 6e20 7375 6249 7465 6d3a 0a20  it in subItem:. 
+0000fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd30: 2020 2020 2020 2020 2020 2069 6620 6974             if it
+0000fd40: 2021 3d20 2769 6d61 6765 2d66 696c 656e   != 'image-filen
+0000fd50: 616d 6527 3a0a 2020 2020 2020 2020 2020  ame':.          
+0000fd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd70: 2020 2020 2020 7375 6249 7465 6d44 6963        subItemDic
+0000fd80: 745b 6974 5d20 3d20 7375 6249 7465 6d5b  t[it] = subItem[
+0000fd90: 6974 5d0a 2020 2020 2020 2020 2020 2020  it].            
+0000fda0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+0000fdb0: 655f 7365 745f 6974 656d 735b 7375 6249  e_set_items[subI
+0000fdc0: 7465 6d44 6566 6175 6c74 5b27 696d 6167  temDefault['imag
+0000fdd0: 652d 6669 6c65 6e61 6d65 275d 5d2e 6170  e-filename']].ap
+0000fde0: 7065 6e64 2873 7562 4974 656d 4469 6374  pend(subItemDict
+0000fdf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000fe00: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0000fe10: 2020 2065 7863 6570 7420 6d69 7174 632e     except miqtc.
+0000fe20: 4966 646f 4578 6365 7074 696f 6e20 6173  IfdoException as
+0000fe30: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0000fe40: 2020 2020 2020 2020 696e 7661 6c69 645f          invalid_
+0000fe50: 6974 656d 7320 2b3d 2031 0a20 2020 2020  items += 1.     
+0000fe60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000fe70: 656c 662e 7072 6f76 2e6c 6f67 2822 496e  elf.prov.log("In
+0000fe80: 7661 6c69 6420 696d 6167 6520 6974 656d  valid image item
+0000fe90: 3a20 222b 2073 7472 2869 7465 6d29 2c64  : "+ str(item),d
+0000fea0: 6f6e 7453 686f 773d 5472 7565 290a 2020  ontShow=True).  
+0000feb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fec0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+0000fed0: 2245 7863 6570 7469 6f6e 3a5c 6e22 2b20  "Exception:\n"+ 
+0000fee0: 7374 7228 652e 6172 6773 292c 646f 6e74  str(e.args),dont
+0000fef0: 5368 6f77 3d54 7275 6529 0a20 2020 2020  Show=True).     
+0000ff00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000ff10: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
+0000ff20: 7863 6570 7469 6f6e 2822 496e 7661 6c69  xception("Invali
+0000ff30: 6420 696d 6167 6520 6974 656d 2022 2b20  d image item "+ 
+0000ff40: 6669 6c65 5f6e 616d 6520 2b20 223a 5c6e  file_name + ":\n
+0000ff50: 4578 6365 7074 696f 6e3a 5c6e 222b 2073  Exception:\n"+ s
+0000ff60: 7472 2865 2e61 7267 7329 2920 2320 6f74  tr(e.args)) # ot
+0000ff70: 6865 7277 6973 652c 2069 6e20 6361 7365  herwise, in case
+0000ff80: 206f 6620 6d61 6e79 2069 6d61 6765 732c   of many images,
+0000ff90: 2069 7420 6d61 7920 6b65 6570 2072 756e   it may keep run
+0000ffa0: 6e69 6e67 2061 6e64 2074 6872 6f77 696e  ning and throwin
+0000ffb0: 6720 6572 726f 7273 2066 6f72 2071 7569  g errors for qui
+0000ffc0: 7420 736f 6d65 2074 696d 650a 2020 2020  t some time.    
+0000ffd0: 2020 2020 2020 2020 7072 6f67 2e63 6c65          prog.cle
+0000ffe0: 6172 2829 0a0a 2020 2020 2020 2020 2020  ar()..          
+0000fff0: 2020 6966 206c 656e 2869 7465 6d73 2920    if len(items) 
+00010000: 213d 2030 2061 6e64 2069 6e76 616c 6964  != 0 and invalid
+00010010: 5f69 7465 6d73 203d 3d20 6c65 6e28 6974  _items == len(it
+00010020: 656d 7329 3a0a 2020 2020 2020 2020 2020  ems):.          
+00010030: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+00010040: 7074 696f 6e28 2241 6c6c 2069 7465 6d73  ption("All items
+00010050: 2061 7265 2069 6e76 616c 6964 2229 0a20   are invalid"). 
+00010060: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00010070: 696e 7661 6c69 645f 6974 656d 7320 3e20  invalid_items > 
+00010080: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00010090: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+000100a0: 2822 4174 206c 6561 7374 2022 202b 2073  ("At least " + s
+000100b0: 7472 2869 6e76 616c 6964 5f69 7465 6d73  tr(invalid_items
+000100c0: 2920 2b20 2220 6974 656d 7320 7765 7265  ) + " items were
+000100d0: 2069 6e76 616c 6964 2028 6f66 2220 2b20   invalid (of" + 
+000100e0: 7374 7228 6c65 6e28 6974 656d 7329 292b  str(len(items))+
+000100f0: 2022 2922 290a 0a20 2020 2020 2020 2023   ")")..        #
+00010100: 2056 616c 6964 6174 6520 6865 6164 6572   Validate header
+00010110: 2069 6e66 6f72 6d61 7469 6f6e 0a20 2020   information.   
+00010120: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00010130: 2020 2020 2020 6d69 7174 742e 6172 655f        miqtt.are_
+00010140: 7661 6c69 645f 6966 646f 5f66 6965 6c64  valid_ifdo_field
+00010150: 7328 7365 6c66 2e69 6664 6f5f 746d 705b  s(self.ifdo_tmp[
+00010160: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+00010170: 6465 724b 6579 5d29 0a20 2020 2020 2020  derKey]).       
+00010180: 2065 7863 6570 7420 6d69 7174 632e 4966   except miqtc.If
+00010190: 646f 4578 6365 7074 696f 6e20 6173 2065  doException as e
+000101a0: 783a 0a20 2020 2020 2020 2020 2020 206d  x:.            m
+000101b0: 7367 203d 2022 496e 7661 6c69 6420 6865  sg = "Invalid he
+000101c0: 6164 6572 2066 6965 6c64 3a20 2220 2b20  ader field: " + 
+000101d0: 7374 7228 6578 290a 2020 2020 2020 2020  str(ex).        
+000101e0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+000101f0: 6728 2245 7863 6570 7469 6f6e 3a20 2220  g("Exception: " 
+00010200: 2b20 6d73 672c 2064 6f6e 7453 686f 773d  + msg, dontShow=
+00010210: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00010220: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+00010230: 646f 4578 6365 7074 696f 6e28 6d73 6729  doException(msg)
+00010240: 0a0a 2020 2020 2020 2020 2320 7075 7420  ..        # put 
+00010250: 6974 656d 2069 6e66 6f20 696e 746f 2073  item info into s
+00010260: 656c 662e 6966 646f 5f74 6d70 0a20 2020  elf.ifdo_tmp.   
+00010270: 2020 2020 2073 203d 206d 6971 7463 2e50       s = miqtc.P
+00010280: 7269 6e74 4c6f 6164 696e 674d 7367 2822  rintLoadingMsg("
+00010290: 5570 6461 7469 6e67 2229 0a20 2020 2020  Updating").     
+000102a0: 2020 206c 6f67 203d 206d 6971 7463 2e72     log = miqtc.r
+000102b0: 6563 7572 7369 7665 6c79 5570 6461 7465  ecursivelyUpdate
+000102c0: 4469 6374 7328 7365 6c66 2e69 6664 6f5f  Dicts(self.ifdo_
+000102d0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+000102e0: 7449 7465 6d73 4b65 795d 2c20 696d 6167  tItemsKey], imag
+000102f0: 655f 7365 745f 6974 656d 7329 0a20 2020  e_set_items).   
+00010300: 2020 2020 2073 2e73 746f 7028 290a 2020       s.stop().  
+00010310: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+00010320: 6c6f 6728 6c6f 6729 0a0a 2020 2020 2020  log(log)..      
+00010330: 2020 2320 7365 7420 6c61 7420 6c6f 6e20    # set lat lon 
+00010340: 626f 756e 6469 6e67 2062 6f78 0a20 2020  bounding box.   
+00010350: 2020 2020 2073 656c 662e 5f73 6574 5f6c       self._set_l
+00010360: 6174 5f6c 6f6e 5f62 6f75 6e64 696e 675f  at_lon_bounding_
+00010370: 626f 7828 7365 6c66 2e69 6664 6f5f 746d  box(self.ifdo_tm
+00010380: 7029 0a0a 2020 2020 2020 2020 2320 7365  p)..        # se
+00010390: 7420 7265 7072 6573 656e 7461 7469 7665  t representative
+000103a0: 2068 6561 6465 7220 6669 656c 6473 2064   header fields d
+000103b0: 6174 6574 696d 652c 206c 6174 2c20 6c6f  atetime, lat, lo
+000103c0: 6e2c 2061 6c74 0a20 2020 2020 2020 2073  n, alt.        s
+000103d0: 656c 662e 5f73 6574 5f72 6570 5f68 6561  elf._set_rep_hea
+000103e0: 6465 725f 6669 656c 6473 5f64 745f 6c61  der_fields_dt_la
+000103f0: 745f 6c6f 6e5f 616c 7428 7365 6c66 2e69  t_lon_alt(self.i
+00010400: 6664 6f5f 746d 7029 0a0a 2020 2020 2020  fdo_tmp)..      
+00010410: 2020 7365 6c66 2e5f 7365 745f 696d 6167    self._set_imag
+00010420: 655f 6974 656d 5f69 6465 6e74 6966 6963  e_item_identific
+00010430: 6174 696f 6e5f 7363 6865 6d65 2873 656c  ation_scheme(sel
+00010440: 662e 6966 646f 5f74 6d70 290a 0a20 2020  f.ifdo_tmp)..   
+00010450: 2020 2020 2023 2072 656d 6f76 6520 656d       # remove em
+00010460: 7470 7920 6669 656c 6473 0a20 2020 2020  tpy fields.     
+00010470: 2020 2073 203d 206d 6971 7463 2e50 7269     s = miqtc.Pri
+00010480: 6e74 4c6f 6164 696e 674d 7367 2822 5265  ntLoadingMsg("Re
+00010490: 6d6f 7669 6e67 2065 6d70 7479 2066 6965  moving empty fie
+000104a0: 6c64 7322 290a 2020 2020 2020 2020 7365  lds").        se
+000104b0: 6c66 2e69 6664 6f5f 746d 7020 3d20 6d69  lf.ifdo_tmp = mi
+000104c0: 7174 632e 7265 6375 7273 6976 656c 7952  qtc.recursivelyR
+000104d0: 656d 6f76 6545 6d70 7479 4669 656c 6473  emoveEmptyFields
+000104e0: 2873 656c 662e 6966 646f 5f74 6d70 290a  (self.ifdo_tmp).
+000104f0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00010500: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
+00010510: 734b 6579 2069 6e20 7365 6c66 2e69 6664  sKey in self.ifd
+00010520: 6f5f 746d 703a 0a20 2020 2020 2020 2020  o_tmp:.         
+00010530: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
+00010540: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
+00010550: 656d 734b 6579 5d20 3d20 5b5d 0a20 2020  emsKey] = [].   
+00010560: 2020 2020 2023 2072 656d 6f76 6520 6669       # remove fi
+00010570: 656c 6473 2074 6861 7420 636f 6e74 6169  elds that contai
+00010580: 6e20 2769 6d61 6765 2d64 6174 6574 696d  n 'image-datetim
+00010590: 6527 206f 6e6c 790a 2020 2020 2020 2020  e' only.        
+000105a0: 7365 6c66 2e72 656d 6f76 6549 7465 6d46  self.removeItemF
+000105b0: 6965 6c64 7357 6974 684f 6e6c 7944 6174  ieldsWithOnlyDat
+000105c0: 6554 696d 6528 290a 2020 2020 2020 2020  eTime().        
+000105d0: 732e 7374 6f70 2829 0a0a 2020 2020 2020  s.stop()..      
+000105e0: 2020 6966 206e 6f74 2073 656c 662e 6967    if not self.ig
+000105f0: 6e6f 7265 5f69 6d61 6765 5f66 696c 6573  nore_image_files
+00010600: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00010610: 6c66 2e63 6865 636b 416c 6c49 7465 6d48  lf.checkAllItemH
+00010620: 6173 6865 7328 290a 0a20 2020 2020 2020  ashes()..       
+00010630: 2023 2063 6865 636b 2061 6761 696e 7374   # check against
+00010640: 2073 6368 656d 610a 2020 2020 2020 2020   schema.        
+00010650: 7661 6c69 642c 206d 7367 203d 206d 6971  valid, msg = miq
+00010660: 7474 2e76 616c 6964 6174 655f 6966 646f  tt.validate_ifdo
+00010670: 2873 656c 662e 6966 646f 5f74 6d70 290a  (self.ifdo_tmp).
+00010680: 2020 2020 2020 2020 6966 206e 6f74 2076          if not v
+00010690: 616c 6964 2061 6e64 206e 6f74 2061 6c6c  alid and not all
+000106a0: 6f77 5f6d 6973 7369 6e67 5f72 6571 7569  ow_missing_requi
+000106b0: 7265 643a 0a20 2020 2020 2020 2020 2020  red:.           
+000106c0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+000106d0: 5761 726e 696e 6721 2069 4644 4f20 6e6f  Warning! iFDO no
+000106e0: 2076 616c 6964 2079 6574 3a20 2220 2b20   valid yet: " + 
+000106f0: 6d73 6729 0a20 2020 2020 2020 2020 2020  msg).           
+00010700: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
+00010710: 6f45 7863 6570 7469 6f6e 286d 7367 290a  oException(msg).
+00010720: 0a20 2020 2020 2020 2023 2073 6574 2066  .        # set f
+00010730: 696e 616c 206f 6e65 0a20 2020 2020 2020  inal one.       
+00010740: 2073 656c 662e 6966 646f 5f63 6865 636b   self.ifdo_check
+00010750: 6564 203d 2063 6f70 792e 6465 6570 636f  ed = copy.deepco
+00010760: 7079 2873 656c 662e 6966 646f 5f74 6d70  py(self.ifdo_tmp
+00010770: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00010780: 2073 656c 662e 6966 646f 5f63 6865 636b   self.ifdo_check
+00010790: 6564 0a0a 0a20 2020 2064 6566 205f 7365  ed...    def _se
+000107a0: 745f 696d 6167 655f 6974 656d 5f69 6465  t_image_item_ide
+000107b0: 6e74 6966 6963 6174 696f 6e5f 7363 6865  ntification_sche
+000107c0: 6d65 2873 656c 662c 6966 646f 3a64 6963  me(self,ifdo:dic
+000107d0: 7429 3a0a 2020 2020 2020 2020 2222 2220  t):.        """ 
+000107e0: 5365 7420 696d 6167 652d 6974 656d 2d69  Set image-item-i
+000107f0: 6465 6e74 6966 6963 6174 696f 6e2d 7363  dentification-sc
+00010800: 6865 6d65 2074 6f20 6069 6d61 6765 2d70  heme to `image-p
+00010810: 726f 6a65 6374 5f69 6d61 6765 2d65 7665  roject_image-eve
+00010820: 6e74 5f69 6d61 6765 2d73 656e 736f 725f  nt_image-sensor_
+00010830: 696d 6167 652d 6461 7465 7469 6d65 2e65  image-datetime.e
+00010840: 7874 6020 6966 2065 6d70 7479 2e20 2222  xt` if empty. ""
+00010850: 220a 2020 2020 2020 2020 6966 2066 696e  ".        if fin
+00010860: 6446 6965 6c64 2869 6664 6f5b 7365 6c66  dField(ifdo[self
+00010870: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+00010880: 6579 5d2c 2769 6d61 6765 2d69 7465 6d2d  ey],'image-item-
+00010890: 6964 656e 7469 6669 6361 7469 6f6e 2d73  identification-s
+000108a0: 6368 656d 6527 2920 3d3d 2022 223a 0a20  cheme') == "":. 
+000108b0: 2020 2020 2020 2020 2020 2069 6664 6f5b             ifdo[
+000108c0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+000108d0: 6465 724b 6579 5d5b 2769 6d61 6765 2d69  derKey]['image-i
+000108e0: 7465 6d2d 6964 656e 7469 6669 6361 7469  tem-identificati
+000108f0: 6f6e 2d73 6368 656d 6527 5d20 3d20 2027  on-scheme'] =  '
+00010900: 696d 6167 652d 7072 6f6a 6563 745f 696d  image-project_im
+00010910: 6167 652d 6576 656e 745f 696d 6167 652d  age-event_image-
+00010920: 7365 6e73 6f72 5f69 6d61 6765 2d64 6174  sensor_image-dat
+00010930: 6574 696d 652e 6578 7427 0a0a 0a20 2020  etime.ext'...   
+00010940: 2064 6566 205f 7365 745f 7265 705f 6865   def _set_rep_he
+00010950: 6164 6572 5f66 6965 6c64 735f 6474 5f6c  ader_fields_dt_l
+00010960: 6174 5f6c 6f6e 5f61 6c74 2873 656c 662c  at_lon_alt(self,
+00010970: 6966 646f 3a64 6963 7429 3a0a 2020 2020  ifdo:dict):.    
+00010980: 2020 2020 2222 2220 4669 6c6c 2068 6561      """ Fill hea
+00010990: 6465 7220 6669 656c 6473 2069 6d61 6765  der fields image
+000109a0: 2d64 6174 6574 696d 6520 616e 6420 2d6c  -datetime and -l
+000109b0: 6174 6974 7564 652c 202d 6c6f 6e67 6974  atitude, -longit
+000109c0: 7565 6465 2c20 2d61 6c74 6974 7564 652d  uede, -altitude-
+000109d0: 6d65 7465 7273 2c20 2d63 6f6f 7264 696e  meters, -coordin
+000109e0: 6174 652d 756e 6365 7274 6169 6e74 792d  ate-uncertainty-
+000109f0: 6d65 7465 7273 2c20 6966 2065 6d70 7479  meters, if empty
+00010a00: 2c0a 2020 2020 2020 2020 7265 7072 6573  ,.        repres
+00010a10: 656e 7461 7469 7665 6c79 2077 6974 6820  entatively with 
+00010a20: 6669 7273 7420 6974 656d 7320 656e 7472  first items entr
+00010a30: 7920 616e 6420 6d65 6469 616e 206f 6620  y and median of 
+00010a40: 616c 6c20 6974 656d 7320 7661 6c75 6573  all items values
+00010a50: 2c20 7265 7370 6563 7469 7665 6c79 2e20  , respectively. 
+00010a60: 2222 220a 0a20 2020 2020 2020 2023 2027  """..        # '
+00010a70: 696d 6167 652d 6461 7465 7469 6d65 270a  image-datetime'.
+00010a80: 2020 2020 2020 2020 6669 7273 745f 696d          first_im
+00010a90: 6167 6520 3d20 736f 7274 6564 2869 6664  age = sorted(ifd
+00010aa0: 6f5b 7365 6c66 2e69 6d61 6765 5365 7449  o[self.imageSetI
+00010ab0: 7465 6d73 4b65 795d 2e6b 6579 7328 2929  temsKey].keys())
+00010ac0: 5b30 5d0a 2020 2020 2020 2020 6669 656c  [0].        fiel
+00010ad0: 6420 3d20 2769 6d61 6765 2d64 6174 6574  d = 'image-datet
+00010ae0: 696d 6527 0a20 2020 2020 2020 2069 6620  ime'.        if 
+00010af0: 6669 6e64 4669 656c 6428 6966 646f 5b73  findField(ifdo[s
+00010b00: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+00010b10: 6572 4b65 795d 2c66 6965 6c64 2920 3d3d  erKey],field) ==
+00010b20: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
+00010b30: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00010b40: 2020 2020 2020 6966 646f 5b73 656c 662e        ifdo[self.
+00010b50: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+00010b60: 795d 5b66 6965 6c64 5d20 3d20 7365 6c66  y][field] = self
+00010b70: 2e5f 5f67 6574 4669 656c 6456 616c 7565  .__getFieldValue
+00010b80: 2869 6664 6f2c 5b66 6972 7374 5f69 6d61  (ifdo,[first_ima
+00010b90: 6765 2c66 6965 6c64 5d2c 6465 6661 756c  ge,field],defaul
+00010ba0: 745f 6f6e 6c79 3d54 7275 6529 0a20 2020  t_only=True).   
+00010bb0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00010bc0: 662e 7072 6f76 2e6c 6f67 2822 5365 7420  f.prov.log("Set 
+00010bd0: 7265 7072 6573 656e 7461 7469 7665 2068  representative h
+00010be0: 6561 6465 7220 6669 656c 6420 2722 202b  eader field '" +
+00010bf0: 2066 6965 6c64 202b 2022 2720 746f 2022   field + "' to "
+00010c00: 202b 2073 7472 2869 6664 6f5b 7365 6c66   + str(ifdo[self
+00010c10: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+00010c20: 6579 5d5b 6669 656c 645d 2920 2b20 2220  ey][field]) + " 
+00010c30: 6672 6f6d 2066 6972 7374 2069 6d61 6765  from first image
+00010c40: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00010c50: 6578 6365 7074 206d 6971 7463 2e49 6664  except miqtc.Ifd
+00010c60: 6f45 7863 6570 7469 6f6e 2061 7320 6578  oException as ex
+00010c70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010c80: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+00010c90: 2243 6f75 6c64 206e 6f74 2073 6574 2072  "Could not set r
+00010ca0: 6570 7265 7365 6e74 6174 6976 6520 6865  epresentative he
+00010cb0: 6164 6572 2066 6965 6c64 3a20 2220 2b20  ader field: " + 
+00010cc0: 7374 7228 6578 2929 0a20 2020 2020 2020  str(ex)).       
+00010cd0: 2020 2020 2020 2020 2070 6173 730a 0a20           pass.. 
+00010ce0: 2020 2020 2020 2023 2072 6573 740a 2020         # rest.  
+00010cf0: 2020 2020 2020 7265 705f 6865 6164 6572        rep_header
+00010d00: 5f66 6965 6c64 735f 6d65 6469 616e 203d  _fields_median =
+00010d10: 205b 2769 6d61 6765 2d6c 6174 6974 7564   ['image-latitud
+00010d20: 6527 2c27 696d 6167 652d 6c6f 6e67 6974  e','image-longit
+00010d30: 7564 6527 2c27 696d 6167 652d 616c 7469  ude','image-alti
+00010d40: 7475 6465 2d6d 6574 6572 7327 2c27 696d  tude-meters','im
+00010d50: 6167 652d 636f 6f72 6469 6e61 7465 2d75  age-coordinate-u
+00010d60: 6e63 6572 7461 696e 7479 2d6d 6574 6572  ncertainty-meter
+00010d70: 7327 5d0a 2020 2020 2020 2020 666f 7220  s'].        for 
+00010d80: 6669 656c 6420 696e 2072 6570 5f68 6561  field in rep_hea
+00010d90: 6465 725f 6669 656c 6473 5f6d 6564 6961  der_fields_media
+00010da0: 6e3a 0a20 2020 2020 2020 2020 2020 2069  n:.            i
+00010db0: 6620 6669 6e64 4669 656c 6428 6966 646f  f findField(ifdo
+00010dc0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+00010dd0: 6164 6572 4b65 795d 2c66 6965 6c64 2920  aderKey],field) 
+00010de0: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
+00010df0: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
+00010e00: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
+00010e10: 2020 2066 6f72 2069 6d61 6765 5f6e 616d     for image_nam
+00010e20: 6520 696e 2069 6664 6f5b 7365 6c66 2e69  e in ifdo[self.i
+00010e30: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
+00010e40: 2e6b 6579 7328 293a 0a20 2020 2020 2020  .keys():.       
+00010e50: 2020 2020 2020 2020 2020 2020 2074 7279               try
+00010e60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010e70: 2020 2020 2020 2020 2020 6974 656d 5f76            item_v
+00010e80: 616c 203d 2073 656c 662e 5f5f 6765 7446  al = self.__getF
+00010e90: 6965 6c64 5661 6c75 6528 6966 646f 2c5b  ieldValue(ifdo,[
+00010ea0: 696d 6167 655f 6e61 6d65 2c66 6965 6c64  image_name,field
+00010eb0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00010ec0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+00010ed0: 696e 7374 616e 6365 2869 7465 6d5f 7661  instance(item_va
+00010ee0: 6c2c 6469 6374 293a 0a20 2020 2020 2020  l,dict):.       
+00010ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f00: 2020 2020 2076 616c 7565 7320 2b3d 206c       values += l
+00010f10: 6973 7428 6974 656d 5f76 616c 2e76 616c  ist(item_val.val
+00010f20: 7565 7328 2929 0a20 2020 2020 2020 2020  ues()).         
+00010f30: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00010f40: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00010f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f60: 2076 616c 7565 732e 6170 7065 6e64 2869   values.append(i
+00010f70: 7465 6d5f 7661 6c29 0a20 2020 2020 2020  tem_val).       
+00010f80: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00010f90: 6570 7420 6d69 7174 632e 4966 646f 4578  ept miqtc.IfdoEx
+00010fa0: 6365 7074 696f 6e20 6173 2065 783a 0a20  ception as ex:. 
+00010fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010fc0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+00010fd0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+00010fe0: 6573 203d 205b 6920 666f 7220 6920 696e  es = [i for i in
+00010ff0: 2076 616c 7565 7320 6966 2069 2021 3d20   values if i != 
+00011000: 2727 5d0a 2020 2020 2020 2020 2020 2020  ''].            
+00011010: 2020 2020 6966 206c 656e 2876 616c 7565      if len(value
+00011020: 7329 203d 3d20 303a 0a20 2020 2020 2020  s) == 0:.       
+00011030: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00011040: 662e 7072 6f76 2e6c 6f67 2822 436f 756c  f.prov.log("Coul
+00011050: 6420 6e6f 7420 7365 7420 7265 7072 6573  d not set repres
+00011060: 656e 7461 7469 7665 2068 6561 6465 7220  entative header 
+00011070: 6669 656c 642c 206e 6f20 7661 6c75 6573  field, no values
+00011080: 2066 6f75 6e64 3a20 2220 2b20 6669 656c   found: " + fiel
+00011090: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
+000110a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000110b0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+000110c0: 676e 6f72 6520 756e 6b6e 6f6e 772c 2069  gnore unknonw, i
+000110d0: 2e65 2e20 302e 302c 2076 616c 7565 730a  .e. 0.0, values.
+000110e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000110f0: 2020 2020 7661 6c75 6573 203d 205b 6920      values = [i 
+00011100: 666f 7220 6920 696e 2076 616c 7565 7320  for i in values 
+00011110: 6966 2069 2021 3d20 302e 305d 0a20 2020  if i != 0.0].   
+00011120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011130: 2069 6620 6c65 6e28 7661 6c75 6573 2920   if len(values) 
+00011140: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00011150: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00011160: 6c75 6573 2e61 7070 656e 6428 302e 3029  lues.append(0.0)
+00011170: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00011180: 2020 2020 2020 6966 646f 5b73 656c 662e        ifdo[self.
+00011190: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+000111a0: 795d 5b66 6965 6c64 5d20 3d20 7374 6174  y][field] = stat
+000111b0: 6973 7469 6373 2e6d 6564 6961 6e28 7661  istics.median(va
+000111c0: 6c75 6573 290a 2020 2020 2020 2020 2020  lues).          
+000111d0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+000111e0: 726f 762e 6c6f 6728 2253 6574 2072 6570  rov.log("Set rep
+000111f0: 7265 7365 6e74 6174 6976 6520 6865 6164  resentative head
+00011200: 6572 2066 6965 6c64 2027 2220 2b20 6669  er field '" + fi
+00011210: 656c 6420 2b20 2227 2074 6f20 6d65 6469  eld + "' to medi
+00011220: 616e 3a20 2220 2b20 7374 7228 6966 646f  an: " + str(ifdo
+00011230: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+00011240: 6164 6572 4b65 795d 5b66 6965 6c64 5d29  aderKey][field])
+00011250: 202b 2022 2e22 290a 0a0a 2020 2020 6465   + ".")...    de
+00011260: 6620 5f73 6574 5f6c 6174 5f6c 6f6e 5f62  f _set_lat_lon_b
+00011270: 6f75 6e64 696e 675f 626f 7828 7365 6c66  ounding_box(self
+00011280: 2c69 6664 6f3a 6469 6374 293a 0a20 2020  ,ifdo:dict):.   
+00011290: 2020 2020 2022 2222 2053 6574 2069 6d61       """ Set ima
+000112a0: 6765 2d73 6574 2d5b 6d69 6e2c 6d61 785d  ge-set-[min,max]
+000112b0: 2d5b 6c61 7469 7475 6465 2c6c 6f6e 6769  -[latitude,longi
+000112c0: 7475 6465 5d2d 6465 6772 6565 7320 2222  tude]-degrees ""
+000112d0: 220a 2020 2020 2020 2020 6c61 745f 6d69  ".        lat_mi
+000112e0: 6e2c 206c 6174 5f6d 6178 2c20 6c6f 6e5f  n, lat_max, lon_
+000112f0: 6d69 6e2c 206c 6f6e 5f6d 6178 203d 2073  min, lon_max = s
+00011300: 656c 662e 5f67 6574 5f6c 6174 5f6c 6f6e  elf._get_lat_lon
+00011310: 5f62 6f75 6e64 696e 675f 626f 7828 6966  _bounding_box(if
+00011320: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
+00011330: 4974 656d 734b 6579 5d29 0a20 2020 2020  ItemsKey]).     
+00011340: 2020 2069 6620 6e6f 7420 4e6f 6e65 2069     if not None i
+00011350: 6e20 5b6c 6174 5f6d 696e 2c20 6c61 745f  n [lat_min, lat_
+00011360: 6d61 782c 206c 6f6e 5f6d 696e 2c20 6c6f  max, lon_min, lo
+00011370: 6e5f 6d61 785d 3a0a 2020 2020 2020 2020  n_max]:.        
+00011380: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
+00011390: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+000113a0: 5b27 696d 6167 652d 7365 742d 6d69 6e2d  ['image-set-min-
+000113b0: 6c61 7469 7475 6465 2d64 6567 7265 6573  latitude-degrees
+000113c0: 275d 203d 206c 6174 5f6d 696e 0a20 2020  '] = lat_min.   
+000113d0: 2020 2020 2020 2020 2069 6664 6f5b 7365           ifdo[se
+000113e0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+000113f0: 724b 6579 5d5b 2769 6d61 6765 2d73 6574  rKey]['image-set
+00011400: 2d6d 6178 2d6c 6174 6974 7564 652d 6465  -max-latitude-de
+00011410: 6772 6565 7327 5d20 3d20 6c61 745f 6d61  grees'] = lat_ma
+00011420: 780a 2020 2020 2020 2020 2020 2020 6966  x.            if
+00011430: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
+00011440: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
+00011450: 652d 7365 742d 6d69 6e2d 6c6f 6e67 6974  e-set-min-longit
+00011460: 7564 652d 6465 6772 6565 7327 5d20 3d20  ude-degrees'] = 
+00011470: 6c6f 6e5f 6d69 6e0a 2020 2020 2020 2020  lon_min.        
+00011480: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
+00011490: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+000114a0: 5b27 696d 6167 652d 7365 742d 6d61 782d  ['image-set-max-
+000114b0: 6c6f 6e67 6974 7564 652d 6465 6772 6565  longitude-degree
+000114c0: 7327 5d20 3d20 6c6f 6e5f 6d61 780a 0a0a  s'] = lon_max...
+000114d0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
+000114e0: 640a 2020 2020 6465 6620 5f67 6574 5f6c  d.    def _get_l
+000114f0: 6174 5f6c 6f6e 5f62 6f75 6e64 696e 675f  at_lon_bounding_
+00011500: 626f 7828 6974 656d 733a 6469 6374 293a  box(items:dict):
+00011510: 0a20 2020 2020 2020 2022 2222 2052 6574  .        """ Ret
+00011520: 7572 6e73 206c 6174 5f6d 696e 2c20 6c61  urns lat_min, la
+00011530: 745f 6d61 782c 206c 6f6e 5f6d 696e 2c20  t_max, lon_min, 
+00011540: 6c6f 6e5f 6d61 7820 2222 220a 2020 2020  lon_max """.    
+00011550: 2020 2020 6c61 745f 6d69 6e2c 206c 6174      lat_min, lat
+00011560: 5f6d 6178 2c20 6c6f 6e5f 6d69 6e2c 206c  _max, lon_min, l
+00011570: 6f6e 5f6d 6178 203d 204e 6f6e 652c 204e  on_max = None, N
+00011580: 6f6e 652c 204e 6f6e 652c 204e 6f6e 650a  one, None, None.
+00011590: 2020 2020 2020 2020 6920 3d20 300a 2020          i = 0.  
+000115a0: 2020 2020 2020 666f 7220 696d 6167 652c        for image,
+000115b0: 2064 6174 6120 696e 2069 7465 6d73 2e69   data in items.i
+000115c0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+000115d0: 2020 2020 2320 6d61 6b65 2069 6d61 6765      # make image
+000115e0: 2065 6e74 7279 206c 6973 7420 2861 6c73   entry list (als
+000115f0: 6f20 6966 2069 7473 2061 2070 6963 7475  o if its a pictu
+00011600: 7265 290a 2020 2020 2020 2020 2020 2020  re).            
+00011610: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00011620: 6528 6461 7461 2c20 6c69 7374 293a 0a20  e(data, list):. 
+00011630: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00011640: 6174 6120 3d20 5b64 6174 615d 0a20 2020  ata = [data].   
+00011650: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00011660: 2020 2020 2020 666f 7220 7469 6d65 706f        for timepo
+00011670: 696e 745f 6461 7461 2069 6e20 6461 7461  int_data in data
+00011680: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011690: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+000116a0: 2020 2020 2020 2020 2020 206c 6174 203d             lat =
+000116b0: 2074 696d 6570 6f69 6e74 5f64 6174 615b   timepoint_data[
+000116c0: 2769 6d61 6765 2d6c 6174 6974 7564 6527  'image-latitude'
+000116d0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000116e0: 2020 2020 2020 6c6f 6e20 3d20 7469 6d65        lon = time
+000116f0: 706f 696e 745f 6461 7461 5b27 696d 6167  point_data['imag
+00011700: 652d 6c6f 6e67 6974 7564 6527 5d0a 2020  e-longitude'].  
+00011710: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00011720: 6365 7074 204b 6579 4572 726f 7220 6173  cept KeyError as
+00011730: 2065 783a 0a20 2020 2020 2020 2020 2020   ex:.           
+00011740: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00011750: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
+00011760: 2020 2069 6620 6920 3d3d 2030 3a0a 2020     if i == 0:.  
+00011770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011780: 2020 6c61 745f 6d69 6e2c 206c 6174 5f6d    lat_min, lat_m
+00011790: 6178 203d 206c 6174 2c20 6c61 740a 2020  ax = lat, lat.  
+000117a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000117b0: 2020 6c6f 6e5f 6d69 6e2c 206c 6f6e 5f6d    lon_min, lon_m
+000117c0: 6178 203d 206c 6f6e 2c20 6c6f 6e0a 2020  ax = lon, lon.  
+000117d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000117e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000117f0: 2020 2020 2020 2020 6966 206c 6174 203c          if lat <
+00011800: 206c 6174 5f6d 696e 3a0a 2020 2020 2020   lat_min:.      
+00011810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011820: 2020 6c61 745f 6d69 6e20 3d20 6c61 740a    lat_min = lat.
+00011830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011840: 2020 2020 6966 206c 6174 203e 206c 6174      if lat > lat
+00011850: 5f6d 6178 3a0a 2020 2020 2020 2020 2020  _max:.          
+00011860: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00011870: 745f 6d61 7820 3d20 6c61 740a 2020 2020  t_max = lat.    
+00011880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011890: 6966 206c 6f6e 203c 206c 6f6e 5f6d 696e  if lon < lon_min
+000118a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000118b0: 2020 2020 2020 2020 2020 6c6f 6e5f 6d69            lon_mi
+000118c0: 6e20 3d20 6c6f 6e0a 2020 2020 2020 2020  n = lon.        
+000118d0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+000118e0: 6f6e 203e 206c 6f6e 5f6d 6178 3a0a 2020  on > lon_max:.  
+000118f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011900: 2020 2020 2020 6c6f 6e5f 6d61 7820 3d20        lon_max = 
+00011910: 6c6f 6e0a 2020 2020 2020 2020 2020 2020  lon.            
+00011920: 2020 2020 6920 2b3d 2031 0a20 2020 2020      i += 1.     
+00011930: 2020 2072 6574 7572 6e20 6c61 745f 6d69     return lat_mi
+00011940: 6e2c 206c 6174 5f6d 6178 2c20 6c6f 6e5f  n, lat_max, lon_
+00011950: 6d69 6e2c 206c 6f6e 5f6d 6178 0a0a 0a20  min, lon_max... 
+00011960: 2020 2064 6566 2072 656d 6f76 6549 7465     def removeIte
+00011970: 6d46 6965 6c64 7357 6974 684f 6e6c 7944  mFieldsWithOnlyD
+00011980: 6174 6554 696d 6528 7365 6c66 293a 0a20  ateTime(self):. 
+00011990: 2020 2020 2020 2022 2222 2069 7420 6361         """ it ca
+000119a0: 6e20 6861 7070 656e 2074 6861 7420 616e  n happen that an
+000119b0: 2069 6d61 6765 2074 696d 6573 7461 6d70   image timestamp
+000119c0: 2064 6f65 7320 6e6f 7420 636f 6e74 6169   does not contai
+000119d0: 6e20 616e 7920 6669 656c 6473 2062 7574  n any fields but
+000119e0: 2074 6865 2074 696d 6573 7461 6d70 2061   the timestamp a
+000119f0: 6e79 206d 6f72 652e 2054 686f 7365 2061  ny more. Those a
+00011a00: 7265 2072 656d 6f76 6564 2068 6572 652e  re removed here.
+00011a10: 2022 2222 200a 2020 2020 2020 2020 666f   """ .        fo
+00011a20: 7220 6974 656d 2069 6e20 7365 6c66 2e69  r item in self.i
+00011a30: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+00011a40: 6765 5365 7449 7465 6d73 4b65 795d 3a0a  geSetItemsKey]:.
+00011a50: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00011a60: 6f74 2069 7369 6e73 7461 6e63 6528 7365  ot isinstance(se
+00011a70: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00011a80: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+00011a90: 795d 5b69 7465 6d5d 2c6c 6973 7429 3a0a  y][item],list):.
+00011aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ab0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+00011ac0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+00011ad0: 4b65 795d 5b69 7465 6d5d 203d 205b 7365  Key][item] = [se
+00011ae0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00011af0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+00011b00: 795d 5b69 7465 6d5d 5d0a 2020 2020 2020  y][item]].      
+00011b10: 2020 2020 2020 746f 4265 5265 6d6f 7665        toBeRemove
+00011b20: 6420 3d20 5b5d 0a20 2020 2020 2020 2020  d = [].         
+00011b30: 2020 2066 6f72 2065 6e74 7279 2069 6e20     for entry in 
+00011b40: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+00011b50: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+00011b60: 4b65 795d 5b69 7465 6d5d 3a0a 2020 2020  Key][item]:.    
+00011b70: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
+00011b80: 6e74 2865 6e74 7279 290a 2020 2020 2020  nt(entry).      
+00011b90: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00011ba0: 2865 6e74 7279 2920 3d3d 2031 2061 6e64  (entry) == 1 and
+00011bb0: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
+00011bc0: 2720 696e 2065 6e74 7279 3a0a 2020 2020  ' in entry:.    
+00011bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011be0: 746f 4265 5265 6d6f 7665 642e 6170 7065  toBeRemoved.appe
+00011bf0: 6e64 2865 6e74 7279 290a 2020 2020 2020  nd(entry).      
+00011c00: 2020 2020 2020 666f 7220 656e 7472 7920        for entry 
+00011c10: 696e 2074 6f42 6552 656d 6f76 6564 3a0a  in toBeRemoved:.
+00011c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c30: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+00011c40: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+00011c50: 4b65 795d 5b69 7465 6d5d 2e72 656d 6f76  Key][item].remov
+00011c60: 6528 656e 7472 7929 200a 0a0a 2020 2020  e(entry) ...    
+00011c70: 6465 6620 6368 6563 6b41 6c6c 4974 656d  def checkAllItem
+00011c80: 4861 7368 6573 2873 656c 662c 2068 6172  Hashes(self, har
+00011c90: 643d 4661 6c73 652c 2072 6169 7365 4578  d=False, raiseEx
+00011ca0: 6365 7074 696f 6e20 3d20 5472 7565 293a  ception = True):
+00011cb0: 0a20 2020 2020 2020 2022 2222 200a 2020  .        """ .  
+00011cc0: 2020 2020 2020 4368 6563 6b73 2069 6620        Checks if 
+00011cd0: 6861 7368 6573 2069 6e20 6946 444f 206d  hashes in iFDO m
+00011ce0: 6174 6368 2068 6173 6865 7320 696e 2069  atch hashes in i
+00011cf0: 6e74 6572 6d65 6964 6174 6520 6861 7368  ntermeidate hash
+00011d00: 2066 696c 6520 6966 2074 6865 206c 6174   file if the lat
+00011d10: 7465 7220 7761 7320 6368 616e 6765 6420  ter was changed 
+00011d20: 6c61 7374 2061 6674 6572 2074 6865 2069  last after the i
+00011d30: 6d61 6765 7320 6861 7320 6368 616e 6765  mages has change
+00011d40: 642e 0a20 2020 2020 2020 204f 7468 6572  d..        Other
+00011d50: 7769 7365 206f 7220 6966 2068 6172 643d  wise or if hard=
+00011d60: 3d54 7275 6520 6974 2072 6564 6574 6572  =True it redeter
+00011d70: 6d69 6e65 7320 7468 6520 6163 7475 616c  mines the actual
+00011d80: 6c20 6669 6c65 2773 2068 6173 6820 616e  l file's hash an
+00011d90: 6420 636f 6d70 6172 6573 2074 6865 2069  d compares the i
+00011da0: 4644 4f20 6974 656d 2773 2068 6173 6820  FDO item's hash 
+00011db0: 7769 7468 2074 6861 742e 0a20 2020 2020  with that..     
+00011dc0: 2020 2049 6620 6861 7368 6573 2064 6f20     If hashes do 
+00011dd0: 6e6f 7420 6d61 7463 6820 6120 6d61 7269  not match a mari
+00011de0: 7174 2e63 6f72 652e 4966 646f 4578 6365  qt.core.IfdoExce
+00011df0: 7074 696f 6e20 6973 2072 6973 656e 2075  ption is risen u
+00011e00: 6e73 6c65 7373 2072 6169 7365 4578 6365  nsless raiseExce
+00011e10: 7074 696f 6e20 3d3d 2046 616c 7365 2c20  ption == False, 
+00011e20: 7468 656e 2061 206c 6973 7420 6f66 206c  then a list of l
+00011e30: 6973 7473 205b 3c66 696c 653e 2c3c 6578  ists [<file>,<ex
+00011e40: 6365 7074 696f 6e3e 5d20 6973 2072 6574  ception>] is ret
+00011e50: 7572 6e65 642e 0a20 2020 2020 2020 2022  urned..        "
+00011e60: 2222 0a20 2020 2020 2020 2068 6173 6865  "".        hashe
+00011e70: 7320 3d20 7b7d 0a20 2020 2020 2020 2068  s = {}.        h
+00011e80: 6173 6846 696c 654d 6f64 5469 6d65 203d  ashFileModTime =
+00011e90: 2031 3065 2b31 3030 0a20 2020 2020 2020   10e+100.       
+00011ea0: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
+00011eb0: 7473 2873 656c 662e 6765 745f 696e 745f  ts(self.get_int_
+00011ec0: 6861 7368 5f66 696c 6528 2929 3a0a 2020  hash_file()):.  
+00011ed0: 2020 2020 2020 2020 2020 6861 7368 6573            hashes
+00011ee0: 203d 206d 6971 7466 2e74 6162 4669 6c65   = miqtf.tabFile
+00011ef0: 4461 7461 2873 656c 662e 6765 745f 696e  Data(self.get_in
+00011f00: 745f 6861 7368 5f66 696c 6528 292c 205b  t_hash_file(), [
+00011f10: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00011f20: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+00011f30: 5d2c 206d 6971 7476 2e63 6f6c 5f68 6561  ], miqtv.col_hea
+00011f40: 6465 725b 276d 6172 6971 7427 5d5b 2768  der['mariqt']['h
+00011f50: 6173 6827 5d5d 2c20 6b65 795f 636f 6c3d  ash']], key_col=
+00011f60: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00011f70: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+00011f80: 5d29 0a20 2020 2020 2020 2020 2020 2068  ]).            h
+00011f90: 6173 6846 696c 654d 6f64 5469 6d65 203d  ashFileModTime =
+00011fa0: 206f 732e 7061 7468 2e67 6574 6d74 696d   os.path.getmtim
+00011fb0: 6528 7365 6c66 2e67 6574 5f69 6e74 5f68  e(self.get_int_h
+00011fc0: 6173 685f 6669 6c65 2829 290a 0a20 2020  ash_file())..   
+00011fd0: 2020 2020 2065 7863 6570 7469 6f6e 4c69       exceptionLi
+00011fe0: 7374 203d 205b 5d0a 0a20 2020 2020 2020  st = []..       
+00011ff0: 2068 6173 6855 6e63 6865 636b 496d 6167   hashUncheckImag
+00012000: 6573 496e 5261 7720 3d20 7365 6c66 2e69  esInRaw = self.i
+00012010: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
+00012020: 2829 0a20 2020 2020 2020 2070 726f 6720  ().        prog 
+00012030: 3d20 6d69 7174 632e 5072 696e 744b 6e6f  = miqtc.PrintKno
+00012040: 776e 5072 6f67 7265 7373 4d73 6728 2243  wnProgressMsg("C
+00012050: 6865 636b 696e 6720 6974 656d 2068 6173  hecking item has
+00012060: 6865 7322 2c20 6c65 6e28 7365 6c66 2e69  hes", len(self.i
+00012070: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+00012080: 6765 5365 7449 7465 6d73 4b65 795d 2929  geSetItemsKey]))
+00012090: 0a20 2020 2020 2020 2066 6f72 2069 7465  .        for ite
+000120a0: 6d20 696e 2073 656c 662e 6966 646f 5f74  m in self.ifdo_t
+000120b0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+000120c0: 4974 656d 734b 6579 5d3a 0a20 2020 2020  ItemsKey]:.     
+000120d0: 2020 2020 2020 2070 726f 672e 7072 6f67         prog.prog
+000120e0: 7265 7373 2829 0a0a 2020 2020 2020 2020  ress()..        
+000120f0: 2020 2020 666f 756e 6420 3d20 4661 6c73      found = Fals
+00012100: 650a 2020 2020 2020 2020 2020 2020 666f  e.            fo
+00012110: 7220 696d 6167 6520 696e 2068 6173 6855  r image in hashU
+00012120: 6e63 6865 636b 496d 6167 6573 496e 5261  ncheckImagesInRa
+00012130: 773a 0a20 2020 2020 2020 2020 2020 2020  w:.             
+00012140: 2020 2066 696c 654e 616d 6520 3d20 6f73     fileName = os
+00012150: 2e70 6174 682e 6261 7365 6e61 6d65 2869  .path.basename(i
+00012160: 6d61 6765 290a 2020 2020 2020 2020 2020  mage).          
+00012170: 2020 2020 2020 6966 2066 696c 654e 616d        if fileNam
+00012180: 6520 3d3d 2069 7465 6d3a 0a20 2020 2020  e == item:.     
+00012190: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000121a0: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
+000121b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121c0: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
+000121d0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+000121e0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+000121f0: 795d 5b69 7465 6d5d 2c6c 6973 7429 3a20  y][item],list): 
+00012200: 2320 696e 2063 6173 6520 6f66 2076 6964  # in case of vid
+00012210: 656f 2077 6974 6820 6974 656d 2061 7320  eo with item as 
+00012220: 6c69 7374 2074 6865 2066 6972 7374 2065  list the first e
+00012230: 6e74 7279 2068 6f6c 6473 2074 6865 2064  ntry holds the d
+00012240: 6566 6175 6c74 2061 6e64 2074 6865 2068  efault and the h
+00012250: 6173 6820 6361 6e6e 6f74 2076 6172 7920  ash cannot vary 
+00012260: 666f 7220 7468 6520 7361 6d65 2069 6d61  for the same ima
+00012270: 6765 0a20 2020 2020 2020 2020 2020 2020  ge.             
+00012280: 2020 2020 2020 2020 2020 2069 7465 6d45             itemE
+00012290: 6e74 7279 203d 2073 656c 662e 6966 646f  ntry = self.ifdo
+000122a0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+000122b0: 6574 4974 656d 734b 6579 5d5b 6974 656d  etItemsKey][item
+000122c0: 5d5b 305d 200a 2020 2020 2020 2020 2020  ][0] .          
+000122d0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000122e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122f0: 2020 2020 2020 2020 6974 656d 456e 7472          itemEntr
+00012300: 7920 3d20 7365 6c66 2e69 6664 6f5f 746d  y = self.ifdo_tm
+00012310: 705b 7365 6c66 2e69 6d61 6765 5365 7449  p[self.imageSetI
+00012320: 7465 6d73 4b65 795d 5b69 7465 6d5d 0a0a  temsKey][item]..
+00012330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012340: 2020 2020 696d 6167 654d 6f64 5469 6d65      imageModTime
+00012350: 203d 206f 732e 7061 7468 2e67 6574 6d74   = os.path.getmt
+00012360: 696d 6528 696d 6167 6529 0a20 2020 2020  ime(image).     
+00012370: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00012380: 6620 6e6f 7420 6861 7264 2061 6e64 2069  f not hard and i
+00012390: 6d61 6765 4d6f 6454 696d 6520 3c20 6861  mageModTime < ha
+000123a0: 7368 4669 6c65 4d6f 6454 696d 653a 0a20  shFileModTime:. 
+000123b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123c0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
+000123d0: 2e70 6174 682e 6261 7365 6e61 6d65 2869  .path.basename(i
+000123e0: 6d61 6765 2920 696e 2068 6173 6865 733a  mage) in hashes:
+000123f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012400: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00012410: 7261 6973 6545 7863 6570 7469 6f6e 3a0a  raiseException:.
 00012420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012430: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
-00012440: 4578 6365 7074 696f 6e28 6974 656d 2c20  Exception(item, 
-00012450: 226e 6f74 2066 6f75 6e64 2069 6e20 696e  "not found in in
-00012460: 7465 726d 6569 6461 7465 2068 6173 6820  termeidate hash 
-00012470: 6669 6c65 222c 7365 6c66 2e67 6574 5f69  file",self.get_i
-00012480: 6e74 5f68 6173 685f 6669 6c65 2829 2c22  nt_hash_file(),"
-00012490: 2072 756e 2063 7265 6174 655f 696d 6167   run create_imag
-000124a0: 655f 7368 6132 3536 5f66 696c 6528 2920  e_sha256_file() 
-000124b0: 6669 7273 7422 2920 0a20 2020 2020 2020  first") .       
-000124c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000124d0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000124e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000124f0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00012500: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
-00012510: 5b66 696c 654e 616d 652c 226e 6f74 2066  [fileName,"not f
-00012520: 6f75 6e64 2069 6e20 696e 7465 726d 6569  ound in intermei
-00012530: 6461 7465 2068 6173 6820 6669 6c65 2022  date hash file "
-00012540: 202b 2073 7472 2873 656c 662e 6765 745f   + str(self.get_
-00012550: 696e 745f 6861 7368 5f66 696c 6528 2929  int_hash_file())
-00012560: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00012570: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00012580: 7420 6974 656d 456e 7472 795b 2769 6d61  t itemEntry['ima
-00012590: 6765 2d68 6173 682d 7368 6132 3536 275d  ge-hash-sha256']
-000125a0: 203d 3d20 6861 7368 6573 5b6f 732e 7061   == hashes[os.pa
-000125b0: 7468 2e62 6173 656e 616d 6528 696d 6167  th.basename(imag
-000125c0: 6529 5d5b 2769 6d61 6765 2d68 6173 682d  e)]['image-hash-
-000125d0: 7368 6132 3536 275d 3a0a 2020 2020 2020  sha256']:.      
-000125e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000125f0: 2020 2020 2020 6966 2072 6169 7365 4578        if raiseEx
-00012600: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-00012610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012620: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-00012630: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-00012640: 6f6e 2869 7465 6d2c 2022 696e 636f 7272  on(item, "incorr
-00012650: 6563 7420 7368 6132 3536 2068 6173 6822  ect sha256 hash"
-00012660: 2c20 6974 656d 456e 7472 795b 2769 6d61  , itemEntry['ima
-00012670: 6765 2d68 6173 682d 7368 6132 3536 275d  ge-hash-sha256']
-00012680: 2c22 666f 7220 6669 6c65 222c 6669 6c65  ,"for file",file
-00012690: 4e61 6d65 2c22 2072 756e 2063 7265 6174  Name," run creat
-000126a0: 655f 696d 6167 655f 7368 6132 3536 5f66  e_image_sha256_f
-000126b0: 696c 6528 2920 6669 7273 7422 290a 2020  ile() first").  
-000126c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126d0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000126e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012440: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
+00012450: 4578 6365 7074 696f 6e28 6974 656d 2c20  Exception(item, 
+00012460: 226e 6f74 2066 6f75 6e64 2069 6e20 696e  "not found in in
+00012470: 7465 726d 6569 6461 7465 2068 6173 6820  termeidate hash 
+00012480: 6669 6c65 222c 7365 6c66 2e67 6574 5f69  file",self.get_i
+00012490: 6e74 5f68 6173 685f 6669 6c65 2829 2c22  nt_hash_file(),"
+000124a0: 2072 756e 2063 7265 6174 655f 696d 6167   run create_imag
+000124b0: 655f 7368 6132 3536 5f66 696c 6528 2920  e_sha256_file() 
+000124c0: 6669 7273 7422 2920 0a20 2020 2020 2020  first") .       
+000124d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000124e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000124f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012500: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00012510: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
+00012520: 5b66 696c 654e 616d 652c 226e 6f74 2066  [fileName,"not f
+00012530: 6f75 6e64 2069 6e20 696e 7465 726d 6569  ound in intermei
+00012540: 6461 7465 2068 6173 6820 6669 6c65 2022  date hash file "
+00012550: 202b 2073 7472 2873 656c 662e 6765 745f   + str(self.get_
+00012560: 696e 745f 6861 7368 5f66 696c 6528 2929  int_hash_file())
+00012570: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00012580: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00012590: 7420 6974 656d 456e 7472 795b 2769 6d61  t itemEntry['ima
+000125a0: 6765 2d68 6173 682d 7368 6132 3536 275d  ge-hash-sha256']
+000125b0: 203d 3d20 6861 7368 6573 5b6f 732e 7061   == hashes[os.pa
+000125c0: 7468 2e62 6173 656e 616d 6528 696d 6167  th.basename(imag
+000125d0: 6529 5d5b 2769 6d61 6765 2d68 6173 682d  e)]['image-hash-
+000125e0: 7368 6132 3536 275d 3a0a 2020 2020 2020  sha256']:.      
+000125f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012600: 2020 2020 2020 6966 2072 6169 7365 4578        if raiseEx
+00012610: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+00012620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012630: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
+00012640: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+00012650: 6f6e 2869 7465 6d2c 2022 696e 636f 7272  on(item, "incorr
+00012660: 6563 7420 7368 6132 3536 2068 6173 6822  ect sha256 hash"
+00012670: 2c20 6974 656d 456e 7472 795b 2769 6d61  , itemEntry['ima
+00012680: 6765 2d68 6173 682d 7368 6132 3536 275d  ge-hash-sha256']
+00012690: 2c22 666f 7220 6669 6c65 222c 6669 6c65  ,"for file",file
+000126a0: 4e61 6d65 2c22 2072 756e 2063 7265 6174  Name," run creat
+000126b0: 655f 696d 6167 655f 7368 6132 3536 5f66  e_image_sha256_f
+000126c0: 696c 6528 2920 6669 7273 7422 290a 2020  ile() first").  
+000126d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126e0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
 000126f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012700: 6578 6365 7074 696f 6e4c 6973 742e 6170  exceptionList.ap
-00012710: 7065 6e64 285b 6669 6c65 4e61 6d65 2c22  pend([fileName,"
-00012720: 696e 636f 7272 6563 7420 7368 6132 3536  incorrect sha256
-00012730: 2068 6173 6822 5d29 0a20 2020 2020 2020   hash"]).       
-00012740: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-00012750: 6620 6e6f 7420 6974 656d 456e 7472 795b  f not itemEntry[
-00012760: 2769 6d61 6765 2d68 6173 682d 7368 6132  'image-hash-sha2
-00012770: 3536 275d 203d 3d20 6d69 7174 632e 7368  56'] == miqtc.sh
-00012780: 6132 3536 4861 7368 4669 6c65 2869 6d61  a256HashFile(ima
-00012790: 6765 293a 0a20 2020 2020 2020 2020 2020  ge):.           
-000127a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000127b0: 7261 6973 6545 7863 6570 7469 6f6e 3a0a  raiseException:.
-000127c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000127d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000127e0: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
-000127f0: 7074 696f 6e28 6974 656d 2c20 2269 6e63  ption(item, "inc
-00012800: 6f72 7265 6374 2073 6861 3235 3620 6861  orrect sha256 ha
-00012810: 7368 222c 2069 7465 6d45 6e74 7279 5b27  sh", itemEntry['
-00012820: 696d 6167 652d 6861 7368 2d73 6861 3235  image-hash-sha25
-00012830: 3627 5d2c 2266 6f72 2066 696c 6522 2c66  6'],"for file",f
-00012840: 696c 654e 616d 652c 2220 7275 6e20 6372  ileName," run cr
-00012850: 6561 7465 5f69 6d61 6765 5f73 6861 3235  eate_image_sha25
-00012860: 365f 6669 6c65 2829 2066 6972 7374 2229  6_file() first")
-00012870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012880: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00012890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000128a0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-000128b0: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
-000128c0: 5b66 696c 654e 616d 652c 2269 6e63 6f72  [fileName,"incor
-000128d0: 7265 6374 2073 6861 3235 3620 6861 7368  rect sha256 hash
-000128e0: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
-000128f0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-00012900: 2020 2020 2020 2020 2020 6966 2066 6f75            if fou
-00012910: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
-00012920: 2020 2020 6465 6c20 6861 7368 556e 6368      del hashUnch
-00012930: 6563 6b49 6d61 6765 7349 6e52 6177 5b69  eckImagesInRaw[i
-00012940: 6d61 6765 5d0a 2020 2020 2020 2020 2020  mage].          
-00012950: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00012960: 2020 2020 2020 2020 6966 2072 6169 7365          if raise
-00012970: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
-00012980: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00012990: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
-000129a0: 7863 6570 7469 6f6e 2820 2269 6d61 6765  xception( "image
-000129b0: 222c 2069 7465 6d2c 2022 6e6f 7420 666f  ", item, "not fo
-000129c0: 756e 6420 696e 2064 6972 6563 746f 7279  und in directory
-000129d0: 2773 2072 6177 2066 6f6c 6465 7221 2229  's raw folder!")
-000129e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000129f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00012a00: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00012a10: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
-00012a20: 5b66 696c 654e 616d 652c 2266 696c 6520  [fileName,"file 
-00012a30: 6e6f 7420 666f 756e 6422 5d29 0a20 2020  not found"]).   
-00012a40: 2020 2020 2070 726f 672e 636c 6561 7228       prog.clear(
-00012a50: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-00012a60: 2072 6169 7365 4578 6365 7074 696f 6e3a   raiseException:
-00012a70: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00012a80: 7572 6e20 6578 6365 7074 696f 6e4c 6973  urn exceptionLis
-00012a90: 740a 0a0a 2020 2020 6465 6620 6372 6561  t...    def crea
-00012aa0: 7465 5f75 7569 645f 6669 6c65 2873 656c  te_uuid_file(sel
-00012ab0: 662c 636c 6561 6e3d 5472 7565 293a 0a20  f,clean=True):. 
-00012ac0: 2020 2020 2020 2022 2222 2043 7265 6174         """ Creat
-00012ad0: 6573 2069 6e20 2f69 6e74 6572 6d65 6469  es in /intermedi
-00012ae0: 6174 6520 6120 7465 7874 2066 696c 6520  ate a text file 
-00012af0: 636f 6e74 6169 6e69 6e67 2070 6572 2069  containing per i
-00012b00: 6d61 6765 2061 2063 7265 6174 6564 2075  mage a created u
-00012b10: 7569 6420 2876 6572 7369 6f6e 2034 292e  uid (version 4).
-00012b20: 0a0a 2020 2020 2020 2020 5468 6520 5555  ..        The UU
-00012b30: 4944 2069 7320 6f6e 6c79 202a 7461 6b65  ID is only *take
-00012b40: 6e2a 2066 726f 6d20 7468 6520 6d65 7461  n* from the meta
-00012b50: 6461 7461 206f 6620 7468 6520 696d 6167  data of the imag
-00012b60: 6573 2e20 4974 2064 6f65 7320 6e6f 7420  es. It does not 
-00012b70: 7772 6974 6520 5555 4944 7320 746f 2074  write UUIDs to t
-00012b80: 6865 206d 6574 6164 6174 6120 696e 2063  he metadata in c
-00012b90: 6173 6520 736f 6d65 2066 696c 6573 2061  ase some files a
-00012ba0: 7265 206d 6973 7369 6e67 2069 742e 0a20  re missing it.. 
-00012bb0: 2020 2020 2020 2042 7574 2c20 6974 2063         But, it c
-00012bc0: 7265 6174 6573 2061 2043 5356 2066 696c  reates a CSV fil
-00012bd0: 6520 696e 2074 6861 7420 6361 7365 2074  e in that case t
-00012be0: 6861 7420 796f 7520 6361 6e20 7573 6520  hat you can use 
-00012bf0: 746f 6765 7468 6572 2077 6974 6820 6578  together with ex
-00012c00: 6966 746f 6f6c 2074 6f20 6164 6420 7468  iftool to add th
-00012c10: 6520 5555 4944 2074 6f20 796f 7572 2064  e UUID to your d
-00012c20: 6174 612e 2042 6577 6172 6521 2074 6869  ata. Beware! thi
-00012c30: 7320 6361 6e20 6465 7374 726f 7920 796f  s can destroy yo
-00012c40: 7572 2069 6d61 6765 730a 2020 2020 2020  ur images.      
-00012c50: 2020 6966 206e 6f74 2064 6f6e 6520 7072    if not done pr
-00012c60: 6f70 6572 6c79 2120 4e6f 2067 7561 7261  operly! No guara
-00012c70: 6e74 6565 2069 7320 6769 7665 6e20 6974  ntee is given it
-00012c80: 2077 696c 6c20 776f 726b 2e20 4265 2063   will work. Be c
-00012c90: 6172 6566 756c 210a 0a20 2020 2020 2020  areful!..       
-00012ca0: 2055 7365 2063 6c65 616e 3d46 616c 7365   Use clean=False
-00012cb0: 2074 6f20 6e6f 7420 6368 6563 6b20 7468   to not check th
-00012cc0: 6f73 6520 6669 6c65 7320 6167 6169 6e20  ose files again 
-00012cd0: 7768 6963 6820 6172 6520 616c 7265 6164  which are alread
-00012ce0: 7920 666f 756e 6420 696e 2069 6e74 6572  y found in inter
-00012cf0: 6d65 6469 6174 6520 7575 6964 2066 696c  mediate uuid fil
-00012d00: 650a 2020 2020 2020 2020 2222 220a 0a20  e.        """.. 
-00012d10: 2020 2020 2020 2075 7569 6473 203d 207b         uuids = {
-00012d20: 7d0a 2020 2020 2020 2020 2320 4368 6563  }.        # Chec
-00012d30: 6b20 7768 6574 6865 7220 6120 6669 6c65  k whether a file
-00012d40: 2077 6974 6820 5555 4944 7320 6578 6973   with UUIDs exis
-00012d50: 7473 2c20 7468 656e 2072 6561 6420 6974  ts, then read it
-00012d60: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00012d70: 636c 6561 6e20 616e 6420 6f73 2e70 6174  clean and os.pat
-00012d80: 682e 6578 6973 7473 2873 656c 662e 6765  h.exists(self.ge
-00012d90: 745f 696e 745f 7575 6964 5f66 696c 6528  t_int_uuid_file(
-00012da0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-00012db0: 7575 6964 7320 3d20 6d69 7174 662e 7461  uuids = miqtf.ta
-00012dc0: 6246 696c 6544 6174 6128 7365 6c66 2e67  bFileData(self.g
-00012dd0: 6574 5f69 6e74 5f75 7569 645f 6669 6c65  et_int_uuid_file
-00012de0: 2829 2c20 5b6d 6971 7476 2e63 6f6c 5f68  (), [miqtv.col_h
-00012df0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00012e00: 2769 6d67 275d 2c20 6d69 7174 762e 636f  'img'], miqtv.co
-00012e10: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00012e20: 275d 5b27 7575 6964 275d 5d2c 206b 6579  ']['uuid']], key
-00012e30: 5f63 6f6c 3d6d 6971 7476 2e63 6f6c 5f68  _col=miqtv.col_h
-00012e40: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00012e50: 2769 6d67 275d 290a 2020 2020 2020 2020  'img']).        
-00012e60: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
-00012e70: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
-00012e80: 656c 662e 696d 6167 6573 4469 7229 3a0a  elf.imagesDir):.
-00012e90: 0a20 2020 2020 2020 2020 2020 206d 6973  .            mis
-00012ea0: 7369 6e67 5f75 7569 6473 203d 207b 7d0a  sing_uuids = {}.
-00012eb0: 2020 2020 2020 2020 2020 2020 6164 6465              adde
-00012ec0: 645f 7575 6964 7320 3d20 300a 0a20 2020  d_uuids = 0..   
-00012ed0: 2020 2020 2020 2020 2075 6e6b 6e6f 776e           unknown
-00012ee0: 4669 6c65 7320 3d20 5b5d 0a20 2020 2020  Files = [].     
-00012ef0: 2020 2020 2020 2066 6f72 2066 696c 6520         for file 
-00012f00: 696e 2073 656c 662e 696d 6167 6573 496e  in self.imagesIn
-00012f10: 496d 6167 6573 4469 7228 293a 0a20 2020  ImagesDir():.   
-00012f20: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00012f30: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
-00012f40: 2e62 6173 656e 616d 6528 6669 6c65 290a  .basename(file).
-00012f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f60: 6966 2066 696c 655f 6e61 6d65 206e 6f74  if file_name not
-00012f70: 2069 6e20 7575 6964 733a 0a20 2020 2020   in uuids:.     
-00012f80: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00012f90: 6e6b 6e6f 776e 4669 6c65 732e 6170 7065  nknownFiles.appe
-00012fa0: 6e64 2866 696c 6529 0a20 2020 2020 2020  nd(file).       
-00012fb0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00012fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fd0: 2020 2075 7569 6473 5b66 696c 655f 6e61     uuids[file_na
-00012fe0: 6d65 5d20 3d20 7575 6964 735b 6669 6c65  me] = uuids[file
-00012ff0: 5f6e 616d 655d 5b6d 6971 7476 2e63 6f6c  _name][miqtv.col
-00013000: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00013010: 5d5b 2775 7569 6427 5d5d 0a0a 2020 2020  ]['uuid']]..    
-00013020: 2020 2020 2020 2020 756e 6b6e 6f77 6e46          unknownF
-00013030: 696c 6573 5555 4944 7320 3d20 6d69 7174  ilesUUIDs = miqt
-00013040: 692e 696d 6167 6573 436f 6e74 6169 6e56  i.imagesContainV
-00013050: 616c 6964 5555 4944 2875 6e6b 6e6f 776e  alidUUID(unknown
-00013060: 4669 6c65 7329 0a20 2020 2020 2020 2020  Files).         
-00013070: 2020 2066 6f72 2066 696c 6520 696e 2075     for file in u
-00013080: 6e6b 6e6f 776e 4669 6c65 7355 5549 4473  nknownFilesUUIDs
-00013090: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000130a0: 2020 6669 6c65 5f6e 616d 6520 3d20 6f73    file_name = os
-000130b0: 2e70 6174 682e 6261 7365 6e61 6d65 2866  .path.basename(f
-000130c0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
-000130d0: 2020 2020 2069 6620 6e6f 7420 756e 6b6e       if not unkn
-000130e0: 6f77 6e46 696c 6573 5555 4944 735b 6669  ownFilesUUIDs[fi
-000130f0: 6c65 5d5b 2776 616c 6964 275d 3a0a 2020  le]['valid']:.  
-00013100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013110: 2020 7575 6964 203d 206d 6971 7463 2e75    uuid = miqtc.u
-00013120: 7569 6434 2829 0a20 2020 2020 2020 2020  uid4().         
-00013130: 2020 2020 2020 2020 2020 206d 6973 7369             missi
-00013140: 6e67 5f75 7569 6473 5b66 696c 655d 203d  ng_uuids[file] =
-00013150: 2075 7569 640a 2020 2020 2020 2020 2020   uuid.          
-00013160: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00013170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013180: 7575 6964 735b 6669 6c65 5f6e 616d 655d  uuids[file_name]
-00013190: 203d 2075 6e6b 6e6f 776e 4669 6c65 7355   = unknownFilesU
-000131a0: 5549 4473 5b66 696c 655d 5b27 7575 6964  UIDs[file]['uuid
-000131b0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-000131c0: 2020 2020 2020 2061 6464 6564 5f75 7569         added_uui
-000131d0: 6473 202b 3d20 310a 0a20 2020 2020 2020  ds += 1..       
-000131e0: 2020 2020 2023 2049 6620 7072 6576 696f       # If previo
-000131f0: 7573 6c79 2075 6e6b 6e6f 776e 2055 5549  usly unknown UUI
-00013200: 4473 2077 6572 6520 666f 756e 6420 696e  Ds were found in
-00013210: 2074 6865 2066 696c 6520 6865 6164 6572   the file header
-00013220: 732c 2061 6464 2074 6865 6d20 746f 2074  s, add them to t
-00013230: 6865 2055 5549 4420 6669 6c65 0a20 2020  he UUID file.   
-00013240: 2020 2020 2020 2020 2069 6620 6164 6465           if adde
-00013250: 645f 7575 6964 7320 3e20 303a 0a20 2020  d_uuids > 0:.   
-00013260: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00013270: 203d 206f 7065 6e28 7365 6c66 2e67 6574   = open(self.get
-00013280: 5f69 6e74 5f75 7569 645f 6669 6c65 2829  _int_uuid_file()
-00013290: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
-000132a0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-000132b0: 286d 6971 7476 2e63 6f6c 5f68 6561 6465  (miqtv.col_heade
-000132c0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-000132d0: 275d 202b 225c 7422 2b6d 6971 7476 2e63  '] +"\t"+miqtv.c
-000132e0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-000132f0: 7427 5d5b 2775 7569 6427 5d2b 225c 6e22  t']['uuid']+"\n"
-00013300: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00013310: 2020 6669 6c65 735f 736f 7274 6564 203d    files_sorted =
-00013320: 206c 6973 7428 7575 6964 732e 6b65 7973   list(uuids.keys
-00013330: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
-00013340: 2020 2020 6669 6c65 735f 736f 7274 6564      files_sorted
-00013350: 2e73 6f72 7428 290a 2020 2020 2020 2020  .sort().        
-00013360: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
-00013370: 2069 6e20 6669 6c65 735f 736f 7274 6564   in files_sorted
-00013380: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013390: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
-000133a0: 6669 6c65 2b22 5c74 222b 7374 7228 7575  file+"\t"+str(uu
-000133b0: 6964 735b 6669 6c65 5d29 2b22 5c6e 2229  ids[file])+"\n")
-000133c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000133d0: 2072 6573 2e63 6c6f 7365 2829 0a0a 2020   res.close()..  
-000133e0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-000133f0: 286d 6973 7369 6e67 5f75 7569 6473 2920  (missing_uuids) 
-00013400: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-00013410: 2020 2020 2065 6373 765f 7061 7468 203d       ecsv_path =
-00013420: 2073 656c 662e 5f5f 6765 745f 696e 745f   self.__get_int_
-00013430: 6669 6c65 5f70 7265 6669 7828 2920 2b20  file_prefix() + 
-00013440: 225f 6578 6966 2d61 6464 2d75 7569 642e  "_exif-add-uuid.
-00013450: 6373 7622 0a20 2020 2020 2020 2020 2020  csv".           
-00013460: 2020 2020 2063 7376 203d 206f 7065 6e28       csv = open(
-00013470: 6563 7376 5f70 6174 682c 2022 7722 290a  ecsv_path, "w").
-00013480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013490: 6373 762e 7772 6974 6528 6d69 7174 762e  csv.write(miqtv.
-000134a0: 636f 6c5f 6865 6164 6572 5b27 6578 6966  col_header['exif
-000134b0: 275d 5b27 696d 6727 5d20 2b0a 2020 2020  ']['img'] +.    
-000134c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134d0: 2020 2020 2020 222c 222b 6d69 7174 762e        ","+miqtv.
-000134e0: 636f 6c5f 6865 6164 6572 5b27 6578 6966  col_header['exif
-000134f0: 275d 5b27 7575 6964 275d 2b22 5c6e 2229  ']['uuid']+"\n")
-00013500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013510: 2064 6966 6665 7265 6e74 5f70 6174 6873   different_paths
-00013520: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-00013530: 2020 2020 2020 666f 7220 696d 6720 696e        for img in
-00013540: 206d 6973 7369 6e67 5f75 7569 6473 3a0a   missing_uuids:.
-00013550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013560: 2020 2020 6966 206f 732e 7061 7468 2e62      if os.path.b
-00013570: 6173 656e 616d 6528 696d 6729 206e 6f74  asename(img) not
-00013580: 2069 6e20 6469 6666 6572 656e 745f 7061   in different_pa
-00013590: 7468 733a 0a20 2020 2020 2020 2020 2020  ths:.           
-000135a0: 2020 2020 2020 2020 2020 2020 2064 6966               dif
-000135b0: 6665 7265 6e74 5f70 6174 6873 2e61 7070  ferent_paths.app
-000135c0: 656e 6428 6f73 2e70 6174 682e 6261 7365  end(os.path.base
-000135d0: 6e61 6d65 2869 6d67 2929 0a20 2020 2020  name(img)).     
-000135e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000135f0: 7376 2e77 7269 7465 2869 6d67 2b22 2c22  sv.write(img+","
-00013600: 2b73 7472 286d 6973 7369 6e67 5f75 7569  +str(missing_uui
-00013610: 6473 5b69 6d67 5d29 2b22 5c6e 2229 0a20  ds[img])+"\n"). 
-00013620: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00013630: 7265 7475 726e 2046 616c 7365 2c20 2265  return False, "e
-00013640: 7869 6674 6f6f 6c20 2d63 7376 3d22 2b65  xiftool -csv="+e
-00013650: 6373 765f 7061 7468 2b22 2022 2b22 2022  csv_path+" "+" "
-00013660: 2e6a 6f69 6e28 6469 6666 6572 656e 745f  .join(different_
-00013670: 7061 7468 7329 0a20 2020 2020 2020 2020  paths).         
-00013680: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00013690: 6c73 652c 2022 4e6f 7420 616c 6c20 696d  lse, "Not all im
-000136a0: 6167 6573 2068 6176 6520 7661 6c69 6420  ages have valid 
-000136b0: 5555 4944 732e 204d 6973 7369 6e67 2066  UUIDs. Missing f
-000136c0: 6f72 2066 6f6c 6c6f 7769 6e67 2066 696c  or following fil
-000136d0: 6573 3a5c 6e22 2b22 5cc5 8622 2e6a 6f69  es:\n"+"\..".joi
-000136e0: 6e28 6469 6666 6572 656e 745f 7061 7468  n(different_path
-000136f0: 7329 0a20 2020 2020 2020 2020 2020 200a  s).            .
-00013700: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00013710: 2e5f 5f61 6c6c 5555 4944 7343 6865 636b  .__allUUIDsCheck
-00013720: 6564 203d 2054 7275 650a 2020 2020 2020  ed = True.      
-00013730: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-00013740: 652c 2022 416c 6c20 696d 6167 6573 2068  e, "All images h
-00013750: 6176 6520 6120 5555 4944 220a 2020 2020  ave a UUID".    
-00013760: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00013770: 2c20 2250 6174 6820 222b 7365 6c66 2e69  , "Path "+self.i
-00013780: 6d61 6765 7344 6972 202b 2022 206e 6f74  magesDir + " not
-00013790: 2066 6f75 6e64 2e22 0a0a 2020 2020 6465   found."..    de
-000137a0: 6620 6372 6561 7465 5555 4944 4669 6c65  f createUUIDFile
-000137b0: 2873 656c 662c 636c 6561 6e3d 5472 7565  (self,clean=True
-000137c0: 293a 0a20 2020 2020 2020 2022 2222 2044  ):.        """ D
-000137d0: 6570 7265 6361 7465 6420 2d20 7573 6520  eprecated - use 
-000137e0: 6372 6561 7465 5f75 7569 645f 6669 6c65  create_uuid_file
-000137f0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-00013800: 7572 6e20 7365 6c66 2e63 7265 6174 655f  urn self.create_
-00013810: 7575 6964 5f66 696c 6528 636c 6561 6e29  uuid_file(clean)
-00013820: 0a0a 0a20 2020 2064 6566 2073 6574 5f69  ...    def set_i
-00013830: 6d61 6765 5f73 6574 5f61 7474 6974 7564  mage_set_attitud
-00013840: 6528 7365 6c66 2c79 6177 5f66 7261 6d65  e(self,yaw_frame
-00013850: 3a66 6c6f 6174 2c70 6974 6368 5f66 7261  :float,pitch_fra
-00013860: 6d65 3a66 6c6f 6174 2c72 6f6c 6c5f 6672  me:float,roll_fr
-00013870: 616d 653a 666c 6f61 742c 7961 775f 6361  ame:float,yaw_ca
-00013880: 6d32 6672 616d 653a 666c 6f61 742c 7069  m2frame:float,pi
-00013890: 7463 685f 6361 6d32 6672 616d 653a 666c  tch_cam2frame:fl
-000138a0: 6f61 742c 726f 6c6c 5f63 616d 3266 7261  oat,roll_cam2fra
-000138b0: 6d65 3a66 6c6f 6174 293a 0a20 2020 2020  me:float):.     
-000138c0: 2020 2022 2222 2063 616c 6375 6c61 7465     """ calculate
-000138d0: 7320 7468 6520 7468 6520 6361 6d65 7261  s the the camera
-000138e0: 7320 6162 736f 6c75 7465 2061 7474 6974  s absolute attit
-000138f0: 7564 6520 616e 6420 7365 7473 2069 7420  ude and sets it 
-00013900: 746f 2069 6d61 6765 2073 6574 2068 6561  to image set hea
-00013910: 6465 722e 2041 6c6c 2061 6e67 6c65 7320  der. All angles 
-00013920: 6172 6520 6578 7065 6374 6564 2069 6e20  are expected in 
-00013930: 6465 6772 6565 732e 200a 2020 2020 2020  degrees. .      
-00013940: 2020 6361 6d65 7261 3266 7261 6d65 2061    camera2frame a
-00013950: 6e67 6c65 733a 2072 6f74 6174 696f 6e20  ngles: rotation 
-00013960: 6f66 2063 616d 6572 6120 636f 6f72 6469  of camera coordi
-00013970: 6e61 7465 7320 2878 2c79 2c7a 203d 2074  nates (x,y,z = t
-00013980: 6f70 2c20 7269 6768 742c 206c 696e 6520  op, right, line 
-00013990: 6f66 2073 6967 6874 2920 7769 7468 2072  of sight) with r
-000139a0: 6573 7065 6374 2074 6f20 7665 6869 636c  espect to vehicl
-000139b0: 6520 636f 6f72 6469 6e61 7465 7320 2878  e coordinates (x
-000139c0: 2c79 2c7a 203d 2066 6f72 7761 7264 2c72  ,y,z = forward,r
-000139d0: 6967 6874 2c64 6f77 6e29 200a 2020 2020  ight,down) .    
-000139e0: 2020 2020 696e 2061 6363 6f72 6461 6e63      in accordanc
-000139f0: 6520 7769 7468 2074 6865 2079 6177 2c70  e with the yaw,p
-00013a00: 6974 6368 2c72 6f6c 6c20 726f 7461 7469  itch,roll rotati
-00013a10: 6f6e 206f 7264 6572 2063 6f6e 7665 6e74  on order convent
-00013a20: 696f 6e3a 0a0a 2020 2020 2020 2020 312e  ion:..        1.
-00013a30: 2079 6177 2061 726f 756e 6420 7a2c 0a20   yaw around z,. 
-00013a40: 2020 2020 2020 2032 2e20 7069 7463 6820         2. pitch 
-00013a50: 6172 6f75 6e64 2072 6f74 6174 6564 2079  around rotated y
-00013a60: 2c0a 2020 2020 2020 2020 332e 2072 6f6c  ,.        3. rol
-00013a70: 6c20 6172 6f75 6e64 2072 6f74 6174 6564  l around rotated
-00013a80: 2078 0a0a 2020 2020 2020 2020 526f 7461   x..        Rota
-00013a90: 7469 6f6e 2064 6972 6563 7469 6f6e 7320  tion directions 
-00013aa0: 6163 636f 7264 696e 6720 746f 205c 2772  according to \'r
-00013ab0: 6967 6874 2d68 616e 6420 7275 6c65 5c27  ight-hand rule\'
-00013ac0: 2e0a 0a20 2020 2020 2020 2049 2e65 2e20  ...        I.e. 
-00013ad0: 6361 6d65 7261 3246 7261 6d65 2061 6e67  camera2Frame ang
-00013ae0: 6c65 7320 3d20 302c 302c 3020 6361 6d65  les = 0,0,0 came
-00013af0: 7261 2069 7320 6661 6369 6e67 2064 6f77  ra is facing dow
-00013b00: 6e77 6172 6420 7769 7468 2074 6f70 2073  nward with top s
-00013b10: 6964 6520 746f 7761 7264 7320 7665 6869  ide towards vehi
-00013b20: 636c 6527 7320 666f 7277 6172 6420 6469  cle's forward di
-00013b30: 7265 6374 696f 6e27 2022 2222 0a0a 2020  rection' """..  
-00013b40: 2020 2020 2020 525f 6672 616d 6532 6e65        R_frame2ne
-00013b50: 6420 3d20 6d69 7174 672e 525f 5961 7750  d = miqtg.R_YawP
-00013b60: 6974 6368 526f 6c6c 2879 6177 5f66 7261  itchRoll(yaw_fra
-00013b70: 6d65 2c70 6974 6368 5f66 7261 6d65 2c72  me,pitch_frame,r
-00013b80: 6f6c 6c5f 6672 616d 6529 0a20 2020 2020  oll_frame).     
-00013b90: 2020 2052 5f63 616d 3266 7261 6d65 203d     R_cam2frame =
-00013ba0: 206d 6971 7467 2e52 5f59 6177 5069 7463   miqtg.R_YawPitc
-00013bb0: 6852 6f6c 6c28 7961 775f 6361 6d32 6672  hRoll(yaw_cam2fr
-00013bc0: 616d 652c 7069 7463 685f 6361 6d32 6672  ame,pitch_cam2fr
-00013bd0: 616d 652c 726f 6c6c 5f63 616d 3266 7261  ame,roll_cam2fra
-00013be0: 6d65 290a 2020 2020 2020 2020 525f 6361  me).        R_ca
-00013bf0: 6d32 6e65 6420 3d20 525f 6672 616d 6532  m2ned = R_frame2
-00013c00: 6e65 642e 646f 7428 525f 6361 6d32 6672  ned.dot(R_cam2fr
-00013c10: 616d 6529 0a20 2020 2020 2020 2079 6177  ame).        yaw
-00013c20: 2c70 6974 6368 2c72 6f6c 6c20 3d20 6d69  ,pitch,roll = mi
-00013c30: 7174 672e 7961 7750 6974 6368 526f 6c6c  qtg.yawPitchRoll
-00013c40: 2852 5f63 616d 326e 6564 290a 0a20 2020  (R_cam2ned)..   
-00013c50: 2020 2020 2023 2070 6f73 6520 6d61 7472       # pose matr
-00013c60: 6978 2063 616d 3275 746d 0a20 2020 2020  ix cam2utm.     
-00013c70: 2020 2052 5f63 616d 5374 6432 7574 6d20     R_camStd2utm 
-00013c80: 3d20 7365 6c66 2e67 6574 5f52 5f63 616d  = self.get_R_cam
-00013c90: 5374 6432 7574 6d28 525f 6361 6d32 6672  Std2utm(R_cam2fr
-00013ca0: 616d 652c 525f 6672 616d 6532 6e65 6429  ame,R_frame2ned)
-00013cb0: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00013cc0: 2020 2020 2020 7820 3d20 6e70 2e61 7272        x = np.arr
-00013cd0: 6179 285b 312c 302c 305d 290a 2020 2020  ay([1,0,0]).    
-00013ce0: 2020 2020 7920 3d20 6e70 2e61 7272 6179      y = np.array
-00013cf0: 285b 302c 312c 305d 290a 2020 2020 2020  ([0,1,0]).      
-00013d00: 2020 7a20 3d20 6e70 2e61 7272 6179 285b    z = np.array([
-00013d10: 302c 302c 315d 290a 2020 2020 2020 2020  0,0,1]).        
-00013d20: 7072 696e 7428 2778 272c 525f 6361 6d53  print('x',R_camS
-00013d30: 7464 3275 746d 2e64 6f74 2878 292e 726f  td2utm.dot(x).ro
-00013d40: 756e 6428 3529 290a 2020 2020 2020 2020  und(5)).        
-00013d50: 7072 696e 7428 2779 272c 525f 6361 6d53  print('y',R_camS
-00013d60: 7464 3275 746d 2e64 6f74 2879 292e 726f  td2utm.dot(y).ro
-00013d70: 756e 6428 3529 290a 2020 2020 2020 2020  und(5)).        
-00013d80: 7072 696e 7428 277a 272c 525f 6361 6d53  print('z',R_camS
-00013d90: 7464 3275 746d 2e64 6f74 287a 292e 726f  td2utm.dot(z).ro
-00013da0: 756e 6428 3529 290a 2020 2020 2020 2020  und(5)).        
-00013db0: 2222 220a 0a20 2020 2020 2020 2068 6561  """..        hea
-00013dc0: 6465 7255 7064 6174 6520 3d20 7b0a 2020  derUpdate = {.  
-00013dd0: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
-00013de0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00013df0: 7174 275d 5b27 7961 7727 5d3a 7961 772c  qt']['yaw']:yaw,
-00013e00: 0a20 2020 2020 2020 2020 2020 206d 6971  .            miq
-00013e10: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00013e20: 6172 6971 7427 5d5b 2770 6974 6368 275d  ariqt']['pitch']
-00013e30: 3a70 6974 6368 2c0a 2020 2020 2020 2020  :pitch,.        
-00013e40: 2020 2020 6d69 7174 762e 636f 6c5f 6865      miqtv.col_he
-00013e50: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00013e60: 726f 6c6c 275d 3a72 6f6c 6c2c 0a20 2020  roll']:roll,.   
-00013e70: 2020 2020 2020 2020 206d 6971 7476 2e63           miqtv.c
-00013e80: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00013e90: 7427 5d5b 2770 6f73 6527 5d3a 7b27 706f  t']['pose']:{'po
-00013ea0: 7365 2d61 6273 6f6c 7574 652d 6f72 6965  se-absolute-orie
-00013eb0: 6e74 6174 696f 6e2d 7574 6d2d 6d61 7472  ntation-utm-matr
-00013ec0: 6978 273a 525f 6361 6d53 7464 3275 746d  ix':R_camStd2utm
-00013ed0: 2e66 6c61 7474 656e 2829 2e74 6f6c 6973  .flatten().tolis
-00013ee0: 7428 297d 0a20 2020 2020 2020 207d 0a20  t()}.        }. 
-00013ef0: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
-00013f00: 7465 5f69 6664 6f5f 6865 6164 6572 5f66  te_ifdo_header_f
-00013f10: 6965 6c64 7328 6865 6164 6572 5570 6461  ields(headerUpda
-00013f20: 7465 290a 0a20 2020 2064 6566 2073 6574  te)..    def set
-00013f30: 496d 6167 6553 6574 4174 7469 7475 6465  ImageSetAttitude
-00013f40: 2873 656c 662c 7961 775f 6672 616d 653a  (self,yaw_frame:
-00013f50: 666c 6f61 742c 7069 7463 685f 6672 616d  float,pitch_fram
-00013f60: 653a 666c 6f61 742c 726f 6c6c 5f66 7261  e:float,roll_fra
-00013f70: 6d65 3a66 6c6f 6174 2c79 6177 5f63 616d  me:float,yaw_cam
-00013f80: 3266 7261 6d65 3a66 6c6f 6174 2c70 6974  2frame:float,pit
-00013f90: 6368 5f63 616d 3266 7261 6d65 3a66 6c6f  ch_cam2frame:flo
-00013fa0: 6174 2c72 6f6c 6c5f 6361 6d32 6672 616d  at,roll_cam2fram
-00013fb0: 653a 666c 6f61 7429 3a0a 2020 2020 2020  e:float):.      
-00013fc0: 2020 2222 2220 4465 7072 6563 6174 6564    """ Deprecated
-00013fd0: 202d 2075 7365 2073 6574 5f69 6d61 6765   - use set_image
-00013fe0: 5f73 6574 5f61 7474 6974 7564 6520 2222  _set_attitude ""
-00013ff0: 220a 2020 2020 2020 2020 7365 6c66 2e73  ".        self.s
-00014000: 6574 5f69 6d61 6765 5f73 6574 5f61 7474  et_image_set_att
-00014010: 6974 7564 6528 7961 775f 6672 616d 652c  itude(yaw_frame,
-00014020: 2070 6974 6368 5f66 7261 6d65 2c20 726f   pitch_frame, ro
-00014030: 6c6c 5f66 7261 6d65 2c20 7961 775f 6361  ll_frame, yaw_ca
-00014040: 6d32 6672 616d 652c 2070 6974 6368 5f63  m2frame, pitch_c
-00014050: 616d 3266 7261 6d65 2c20 726f 6c6c 5f63  am2frame, roll_c
-00014060: 616d 3266 7261 6d65 290a 0a0a 2020 2020  am2frame)...    
-00014070: 6465 6620 6372 6561 7465 5f69 6d61 6765  def create_image
-00014080: 5f61 7474 6974 7564 655f 6669 6c65 2873  _attitude_file(s
-00014090: 656c 662c 2061 7474 5f70 6174 683a 7374  elf, att_path:st
-000140a0: 722c 2066 7261 6d65 5f61 7474 5f68 6561  r, frame_att_hea
-000140b0: 6465 723a 6469 6374 2c20 6361 6d65 7261  der:dict, camera
-000140c0: 3246 7261 6d65 5f79 6177 3a66 6c6f 6174  2Frame_yaw:float
-000140d0: 2c63 616d 6572 6132 4672 616d 655f 7069  ,camera2Frame_pi
-000140e0: 7463 683a 666c 6f61 742c 6361 6d65 7261  tch:float,camera
-000140f0: 3246 7261 6d65 5f72 6f6c 6c3a 666c 6f61  2Frame_roll:floa
-00014100: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-00014110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014120: 2020 2064 6174 655f 666f 726d 6174 3d6d     date_format=m
-00014130: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
-00014140: 735b 2770 616e 6761 6561 275d 2c20 636f  s['pangaea'], co
-00014150: 6e73 745f 7661 6c75 6573 203d 207b 7d2c  nst_values = {},
-00014160: 206f 7665 7277 7269 7465 3d46 616c 7365   overwrite=False
-00014170: 2c20 636f 6c5f 7365 7061 7261 746f 7220  , col_separator 
-00014180: 3d20 225c 7422 2c0a 2020 2020 2020 2020  = "\t",.        
-00014190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141a0: 2020 2020 2020 2020 6174 745f 7061 7468          att_path
-000141b0: 5f61 6e67 6c65 735f 696e 5f72 6164 203d  _angles_in_rad =
-000141c0: 2046 616c 7365 2c20 7669 6465 6f53 616d   False, videoSam
-000141d0: 706c 6553 6563 6f6e 6473 3d31 2c72 6563  pleSeconds=1,rec
-000141e0: 6f72 6473 3262 6549 6e76 6572 7465 643d  ords2beInverted=
-000141f0: 5b5d 293a 0a20 2020 2020 2020 2022 2222  []):.        """
-00014200: 2043 7265 6174 6573 2069 6e20 2f69 6e74   Creates in /int
-00014210: 6572 6d65 6469 6174 6520 6120 7465 7874  ermediate a text
-00014220: 2066 696c 6520 7769 7468 2063 616d 6572   file with camer
-00014230: 6120 6174 7469 7475 6465 2064 6174 6120  a attitude data 
-00014240: 666f 7220 6561 6368 2069 6d61 6765 2e20  for each image. 
-00014250: 416c 6c20 616e 676c 6573 2061 7265 2065  All angles are e
-00014260: 7870 6563 7465 6420 696e 2064 6567 7265  xpected in degre
-00014270: 6573 2e20 5573 6520 6174 745f 7061 7468  es. Use att_path
-00014280: 5f61 6e67 6c65 735f 696e 5f72 6164 2069  _angles_in_rad i
-00014290: 6620 6e65 6365 7373 6172 792e 200a 2020  f necessary. .  
-000142a0: 2020 2020 2020 6361 6d65 7261 3246 7261        camera2Fra
-000142b0: 6d65 2061 6e67 6c65 733a 2072 6f74 6174  me angles: rotat
-000142c0: 696f 6e20 6f66 2063 616d 6572 6120 636f  ion of camera co
-000142d0: 6f72 6469 6e61 7465 7320 2878 2c79 2c7a  ordinates (x,y,z
-000142e0: 203d 2074 6f70 2c20 7269 6768 742c 206c   = top, right, l
-000142f0: 696e 6520 6f66 2073 6967 6874 2920 7769  ine of sight) wi
-00014300: 7468 2072 6573 7065 6374 2074 6f20 7665  th respect to ve
-00014310: 6869 636c 6520 636f 6f72 6469 6e61 7465  hicle coordinate
-00014320: 7320 2878 2c79 2c7a 203d 2066 6f72 7761  s (x,y,z = forwa
-00014330: 7264 2c72 6967 6874 2c64 6f77 6e29 200a  rd,right,down) .
-00014340: 2020 2020 2020 2020 696e 2061 6363 6f72          in accor
-00014350: 6461 6e63 6520 7769 7468 2074 6865 2079  dance with the y
-00014360: 6177 2c70 6974 6368 2c72 6f6c 6c20 726f  aw,pitch,roll ro
-00014370: 7461 7469 6f6e 206f 7264 6572 2063 6f6e  tation order con
-00014380: 7665 6e74 696f 6e3a 0a20 2020 2020 2020  vention:.       
-00014390: 2031 2e20 7961 7720 6172 6f75 6e64 207a   1. yaw around z
-000143a0: 2c0a 2020 2020 2020 2020 322e 2070 6974  ,.        2. pit
-000143b0: 6368 2061 726f 756e 6420 726f 7461 7465  ch around rotate
-000143c0: 6420 792c 0a20 2020 2020 2020 2033 2e20  d y,.        3. 
-000143d0: 726f 6c6c 2061 726f 756e 6420 726f 7461  roll around rota
-000143e0: 7465 6420 780a 0a20 2020 2020 2020 2052  ted x..        R
-000143f0: 6f74 6174 696f 6e20 6469 7265 6374 696f  otation directio
-00014400: 6e73 2061 6363 6f72 6469 6e67 2074 6f20  ns according to 
-00014410: 5c27 7269 6768 742d 6861 6e64 2072 756c  \'right-hand rul
-00014420: 655c 272e 0a0a 2020 2020 2020 2020 492e  e\'...        I.
-00014430: 652e 2063 616d 6572 6132 4672 616d 6520  e. camera2Frame 
-00014440: 616e 676c 6573 203d 2030 2c30 2c30 2063  angles = 0,0,0 c
-00014450: 616d 6572 6120 6973 2066 6163 696e 6720  amera is facing 
-00014460: 646f 776e 7761 7264 2077 6974 6820 746f  downward with to
-00014470: 7020 7369 6465 2074 6f77 6172 6473 2076  p side towards v
-00014480: 6568 6963 6c65 2773 2066 6f72 7761 7264  ehicle's forward
-00014490: 2064 6972 6563 7469 6f6e 2720 2222 220a   direction' """.
-000144a0: 0a20 2020 2020 2020 2069 6e74 5f61 7474  .        int_att
-000144b0: 7574 7564 655f 6669 6c65 203d 2073 656c  utude_file = sel
-000144c0: 662e 5f5f 6765 745f 696e 745f 6669 6c65  f.__get_int_file
-000144d0: 5f70 7265 6669 7828 2920 2b20 275f 696d  _prefix() + '_im
-000144e0: 6167 652d 6174 7469 7475 6465 2e74 7874  age-attitude.txt
-000144f0: 270a 2020 2020 2020 2020 6f75 7470 7574  '.        output
-00014500: 5f68 6561 6465 725f 6174 7420 3d20 7b20  _header_att = { 
-00014510: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
-00014520: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
-00014530: 6727 5d3a 2020 6d69 7174 762e 636f 6c5f  g']:  miqtv.col_
-00014540: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00014550: 5b27 696d 6727 5d2c 0a20 2020 2020 2020  ['img'],.       
-00014560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014570: 2020 2020 2020 2020 206d 6971 7476 2e63           miqtv.c
-00014580: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00014590: 7427 5d5b 2775 7463 275d 3a6d 6971 7476  t']['utc']:miqtv
-000145a0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-000145b0: 6971 7427 5d5b 2775 7463 275d 2c0a 2020  iqt']['utc'],.  
-000145c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145d0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-000145e0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-000145f0: 6d61 7269 7174 275d 5b27 7961 7727 5d3a  mariqt']['yaw']:
-00014600: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00014610: 5b27 6d61 7269 7174 275d 5b27 7961 7727  ['mariqt']['yaw'
-00014620: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00014630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014640: 2020 206d 6971 7476 2e63 6f6c 5f68 6561     miqtv.col_hea
-00014650: 6465 725b 276d 6172 6971 7427 5d5b 2770  der['mariqt']['p
-00014660: 6974 6368 275d 3a6d 6971 7476 2e63 6f6c  itch']:miqtv.col
-00014670: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00014680: 5d5b 2770 6974 6368 275d 2c0a 2020 2020  ]['pitch'],.    
-00014690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146a0: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
-000146b0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-000146c0: 7269 7174 275d 5b27 726f 6c6c 275d 3a6d  riqt']['roll']:m
-000146d0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-000146e0: 276d 6172 6971 7427 5d5b 2772 6f6c 6c27  'mariqt']['roll'
-000146f0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00014700: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00014710: 0a0a 2020 2020 2020 2020 696e 745f 706f  ..        int_po
-00014720: 7365 5f66 696c 6520 3d20 7365 6c66 2e5f  se_file = self._
-00014730: 5f67 6574 5f69 6e74 5f66 696c 655f 7072  _get_int_file_pr
-00014740: 6566 6978 2829 202b 2027 5f69 6d61 6765  efix() + '_image
-00014750: 2d63 616d 6572 612d 706f 7365 2e74 7874  -camera-pose.txt
-00014760: 270a 2020 2020 2020 2020 6f75 7470 7574  '.        output
-00014770: 5f68 6561 6465 725f 706f 7365 203d 207b  _header_pose = {
-00014780: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
-00014790: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
-000147a0: 6727 5d3a 6d69 7174 762e 636f 6c5f 6865  g']:miqtv.col_he
-000147b0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-000147c0: 696d 6727 5d2c 0a20 2020 2020 2020 2020  img'],.         
-000147d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147e0: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
-000147f0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00014800: 5d5b 2775 7463 275d 3a6d 6971 7476 2e63  ]['utc']:miqtv.c
-00014810: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00014820: 7427 5d5b 2775 7463 275d 2c0a 2020 2020  t']['utc'],.    
-00014830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014840: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
-00014850: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00014860: 7269 7174 275d 5b27 706f 7365 275d 3a6d  riqt']['pose']:m
-00014870: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00014880: 276d 6172 6971 7427 5d5b 2770 6f73 6527  'mariqt']['pose'
-00014890: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-000148a0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-000148b0: 0a0a 2020 2020 2020 2020 6966 206f 732e  ..        if os.
-000148c0: 7061 7468 2e65 7869 7374 7328 696e 745f  path.exists(int_
-000148d0: 6174 7475 7475 6465 5f66 696c 6529 2061  attutude_file) a
-000148e0: 6e64 206e 6f74 206f 7665 7277 7269 7465  nd not overwrite
-000148f0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00014900: 6c66 2e61 6464 5f69 7465 6d5f 696e 666f  lf.add_item_info
-00014910: 5f74 6162 5f66 696c 6528 696e 745f 6174  _tab_file(int_at
-00014920: 7475 7475 6465 5f66 696c 652c 225c 7422  tutude_file,"\t"
-00014930: 2c6f 7574 7075 745f 6865 6164 6572 5f61  ,output_header_a
-00014940: 7474 290a 2020 2020 2020 2020 2020 2020  tt).            
-00014950: 6578 7472 615f 6d73 6720 3d20 2222 0a20  extra_msg = "". 
-00014960: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
-00014970: 2e70 6174 682e 6578 6973 7473 2869 6e74  .path.exists(int
-00014980: 5f70 6f73 655f 6669 6c65 293a 0a20 2020  _pose_file):.   
-00014990: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000149a0: 662e 6164 645f 6974 656d 5f69 6e66 6f5f  f.add_item_info_
-000149b0: 7461 625f 6669 6c65 2869 6e74 5f70 6f73  tab_file(int_pos
-000149c0: 655f 6669 6c65 2c22 5c74 222c 6f75 7470  e_file,"\t",outp
-000149d0: 7574 5f68 6561 6465 725f 706f 7365 290a  ut_header_pose).
-000149e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149f0: 6578 7472 615f 6d73 6720 3d20 222c 2022  extra_msg = ", "
-00014a00: 202b 2069 6e74 5f70 6f73 655f 6669 6c65   + int_pose_file
-00014a10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00014a20: 7572 6e20 5472 7565 2c20 224f 7574 7075  urn True, "Outpu
-00014a30: 7420 6669 6c65 2065 7869 7374 733a 2022  t file exists: "
-00014a40: 2b69 6e74 5f61 7474 7574 7564 655f 6669  +int_attutude_fi
-00014a50: 6c65 202b 2065 7874 7261 5f6d 7367 0a0a  le + extra_msg..
-00014a60: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-00014a70: 732e 7061 7468 2e65 7869 7374 7328 6174  s.path.exists(at
-00014a80: 745f 7061 7468 293a 0a20 2020 2020 2020  t_path):.       
-00014a90: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00014aa0: 652c 2022 4174 7469 7475 6465 2066 696c  e, "Attitude fil
-00014ab0: 6520 6e6f 7420 666f 756e 643a 2022 2b61  e not found: "+a
-00014ac0: 7474 5f70 6174 680a 0a20 2020 2020 2020  tt_path..       
-00014ad0: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-00014ae0: 6578 6973 7473 2873 656c 662e 696d 6167  exists(self.imag
-00014af0: 6573 4469 7229 3a0a 2020 2020 2020 2020  esDir):.        
-00014b00: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00014b10: 2c20 2249 6d61 6765 2066 6f6c 6465 7220  , "Image folder 
-00014b20: 6e6f 7420 666f 756e 643a 2022 2b20 7365  not found: "+ se
-00014b30: 6c66 2e69 6d61 6765 7344 6972 0a0a 2020  lf.imagesDir..  
-00014b40: 2020 2020 2020 7320 3d20 6d69 7174 632e        s = miqtc.
-00014b50: 5072 696e 744c 6f61 6469 6e67 4d73 6728  PrintLoadingMsg(
-00014b60: 2243 7265 6174 696e 6720 6974 656d 7327  "Creating items'
-00014b70: 2061 7474 6974 7564 6520 6461 7461 2229   attitude data")
-00014b80: 0a0a 2020 2020 2020 2020 2320 6c6f 6164  ..        # load
-00014b90: 2066 7261 6d65 2061 7474 6974 7564 6520   frame attitude 
-00014ba0: 6461 7461 2066 726f 6d20 6669 6c65 0a20  data from file. 
-00014bb0: 2020 2020 2020 2061 7474 5f64 6174 612c         att_data,
-00014bc0: 2070 6172 7365 4d73 6720 3d20 6d69 7174   parseMsg = miqt
-00014bd0: 6e2e 7265 6164 416c 6c41 7474 6974 7564  n.readAllAttitud
-00014be0: 6573 4672 6f6d 4669 6c65 5061 7468 2861  esFromFilePath(a
-00014bf0: 7474 5f70 6174 682c 2066 7261 6d65 5f61  tt_path, frame_a
-00014c00: 7474 5f68 6561 6465 722c 2064 6174 655f  tt_header, date_
-00014c10: 666f 726d 6174 2c63 6f6c 5f73 6570 6172  format,col_separ
-00014c20: 6174 6f72 3d63 6f6c 5f73 6570 6172 6174  ator=col_separat
-00014c30: 6f72 2c63 6f6e 7374 5f76 616c 7565 733d  or,const_values=
-00014c40: 636f 6e73 745f 7661 6c75 6573 2c61 6e67  const_values,ang
-00014c50: 6c65 7349 6e52 6164 3d61 7474 5f70 6174  lesInRad=att_pat
-00014c60: 685f 616e 676c 6573 5f69 6e5f 7261 6429  h_angles_in_rad)
-00014c70: 0a20 2020 2020 2020 2069 6620 7061 7273  .        if pars
-00014c80: 654d 7367 2021 3d20 2222 3a0a 2020 2020  eMsg != "":.    
-00014c90: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-00014ca0: 762e 6c6f 6728 7061 7273 654d 7367 2c64  v.log(parseMsg,d
-00014cb0: 6f6e 7453 686f 773d 5472 7565 290a 2020  ontShow=True).  
-00014cc0: 2020 2020 2020 2020 2020 7061 7273 654d            parseM
-00014cd0: 7367 203d 2022 5c6e 2220 2b20 7061 7273  sg = "\n" + pars
-00014ce0: 654d 7367 0a0a 2020 2020 2020 2020 2320  eMsg..        # 
-00014cf0: 6669 6e64 2066 6f72 2065 6163 6820 696d  find for each im
-00014d00: 6167 6520 7468 6520 7265 7370 6563 7469  age the respecti
-00014d10: 7665 206e 6176 6967 6174 696f 6e20 6461  ve navigation da
-00014d20: 7461 0a20 2020 2020 2020 2073 2e73 746f  ta.        s.sto
-00014d30: 7028 290a 2020 2020 2020 2020 7375 6363  p().        succ
-00014d40: 6573 732c 2069 6d61 6765 5f64 7473 2c20  ess, image_dts, 
-00014d50: 6d73 6720 3d20 7365 6c66 2e66 696e 644e  msg = self.findN
-00014d60: 6176 4461 7461 466f 7249 6d61 6765 2861  avDataForImage(a
-00014d70: 7474 5f64 6174 612c 7669 6465 6f53 616d  tt_data,videoSam
-00014d80: 706c 6553 6563 6f6e 6473 290a 2020 2020  pleSeconds).    
-00014d90: 2020 2020 6966 206e 6f74 2073 7563 6365      if not succe
-00014da0: 7373 3a0a 2020 2020 2020 2020 2020 2020  ss:.            
-00014db0: 7265 7475 726e 2046 616c 7365 2c20 6d73  return False, ms
-00014dc0: 6720 2b20 7061 7273 654d 7367 0a20 2020  g + parseMsg.   
-00014dd0: 2020 2020 2073 203d 206d 6971 7463 2e50       s = miqtc.P
-00014de0: 7269 6e74 4c6f 6164 696e 674d 7367 2822  rintLoadingMsg("
-00014df0: 4372 6561 7469 6e67 2069 7465 6d73 2720  Creating items' 
-00014e00: 6174 7469 7475 6465 2064 6174 6122 290a  attitude data").
-00014e10: 0a20 2020 2020 2020 2023 2069 6e76 6572  .        # inver
-00014e20: 7420 7661 6c75 6573 2028 6966 206e 6565  t values (if nee
-00014e30: 6465 6429 2062 6566 6f72 6520 6c65 7665  ded) before leve
-00014e40: 7261 726d 2063 6f6d 7065 6e73 6174 696f  rarm compensatio
-00014e50: 6e0a 2020 2020 2020 2020 6966 2072 6563  n.        if rec
-00014e60: 6f72 6473 3262 6549 6e76 6572 7465 6420  ords2beInverted 
-00014e70: 213d 205b 5d3a 0a20 2020 2020 2020 2020  != []:.         
-00014e80: 2020 2066 6f72 2066 696c 6520 696e 2069     for file in i
-00014e90: 6d61 6765 5f64 7473 3a0a 2020 2020 2020  mage_dts:.      
-00014ea0: 2020 2020 2020 2020 2020 6174 7469 7475            attitu
-00014eb0: 6465 7320 3d20 696d 6167 655f 6474 735b  des = image_dts[
-00014ec0: 6669 6c65 5d0a 2020 2020 2020 2020 2020  file].          
-00014ed0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00014ee0: 616e 6765 286c 656e 2861 7474 6974 7564  ange(len(attitud
-00014ef0: 6573 2929 3a0a 2020 2020 2020 2020 2020  es)):.          
-00014f00: 2020 2020 2020 2020 2020 6966 2027 7961            if 'ya
-00014f10: 7727 2069 6e20 2072 6563 6f72 6473 3262  w' in  records2b
-00014f20: 6549 6e76 6572 7465 643a 0a20 2020 2020  eInverted:.     
-00014f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f40: 2020 2061 7474 6974 7564 6573 5b69 5d2e     attitudes[i].
-00014f50: 7961 7720 2a3d 202d 310a 2020 2020 2020  yaw *= -1.      
-00014f60: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00014f70: 2027 7069 7463 6827 2069 6e20 2072 6563   'pitch' in  rec
-00014f80: 6f72 6473 3262 6549 6e76 6572 7465 643a  ords2beInverted:
-00014f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014fa0: 2020 2020 2020 2020 2061 7474 6974 7564           attitud
-00014fb0: 6573 5b69 5d2e 7069 7463 6820 2a3d 202d  es[i].pitch *= -
-00014fc0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00014fd0: 2020 2020 2020 6966 2027 726f 6c6c 2720        if 'roll' 
-00014fe0: 696e 2020 7265 636f 7264 7332 6265 496e  in  records2beIn
-00014ff0: 7665 7274 6564 3a0a 2020 2020 2020 2020  verted:.        
-00015000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015010: 6174 7469 7475 6465 735b 695d 2e72 6f6c  attitudes[i].rol
-00015020: 6c20 2a3d 202d 310a 0a0a 2020 2020 2020  l *= -1...      
-00015030: 2020 2320 6164 6420 6361 6d65 7261 3246    # add camera2F
-00015040: 7261 6d65 2061 6e67 6c65 730a 2020 2020  rame angles.    
-00015050: 2020 2020 525f 6361 6d32 6672 616d 6520      R_cam2frame 
-00015060: 3d20 6d69 7174 672e 525f 5961 7750 6974  = miqtg.R_YawPit
-00015070: 6368 526f 6c6c 2863 616d 6572 6132 4672  chRoll(camera2Fr
-00015080: 616d 655f 7961 772c 6361 6d65 7261 3246  ame_yaw,camera2F
-00015090: 7261 6d65 5f70 6974 6368 2c63 616d 6572  rame_pitch,camer
-000150a0: 6132 4672 616d 655f 726f 6c6c 290a 2020  a2Frame_roll).  
-000150b0: 2020 2020 2020 525f 6361 6d32 7574 6d5f        R_cam2utm_
-000150c0: 6c69 7374 203d 205b 5d0a 2020 2020 2020  list = [].      
-000150d0: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
-000150e0: 6167 655f 6474 733a 0a20 2020 2020 2020  age_dts:.       
-000150f0: 2020 2020 2066 6f72 2074 696d 6570 6f69       for timepoi
-00015100: 6e74 2069 6e20 696d 6167 655f 6474 735b  nt in image_dts[
-00015110: 6669 6c65 5d3a 0a20 2020 2020 2020 2020  file]:.         
-00015120: 2020 2020 2020 2061 7474 6974 7564 6520         attitude 
-00015130: 3d20 7469 6d65 706f 696e 740a 2020 2020  = timepoint.    
-00015140: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00015150: 7474 6974 7564 652e 7961 7720 6973 204e  ttitude.yaw is N
-00015160: 6f6e 6520 6f72 2061 7474 6974 7564 652e  one or attitude.
-00015170: 7069 7463 6820 6973 204e 6f6e 6520 6f72  pitch is None or
-00015180: 2061 7474 6974 7564 652e 726f 6c6c 2069   attitude.roll i
-00015190: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-000151a0: 2020 2020 2020 2020 2020 2020 525f 6361              R_ca
-000151b0: 6d32 7574 6d5f 6c69 7374 2e61 7070 656e  m2utm_list.appen
-000151c0: 6428 2222 290a 2020 2020 2020 2020 2020  d("").          
-000151d0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-000151e0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-000151f0: 2020 2052 5f66 7261 6d65 326e 6564 203d     R_frame2ned =
-00015200: 206d 6971 7467 2e52 5f59 6177 5069 7463   miqtg.R_YawPitc
-00015210: 6852 6f6c 6c28 6174 7469 7475 6465 2e79  hRoll(attitude.y
-00015220: 6177 2c61 7474 6974 7564 652e 7069 7463  aw,attitude.pitc
-00015230: 682c 6174 7469 7475 6465 2e72 6f6c 6c29  h,attitude.roll)
-00015240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015250: 2052 5f63 616d 326e 6564 203d 2052 5f66   R_cam2ned = R_f
-00015260: 7261 6d65 326e 6564 2e64 6f74 2852 5f63  rame2ned.dot(R_c
-00015270: 616d 3266 7261 6d65 290a 2020 2020 2020  am2frame).      
-00015280: 2020 2020 2020 2020 2020 7961 772c 7069            yaw,pi
-00015290: 7463 682c 726f 6c6c 203d 206d 6971 7467  tch,roll = miqtg
-000152a0: 2e79 6177 5069 7463 6852 6f6c 6c28 525f  .yawPitchRoll(R_
-000152b0: 6361 6d32 6e65 6429 0a20 2020 2020 2020  cam2ned).       
-000152c0: 2020 2020 2020 2020 2061 7474 6974 7564           attitud
-000152d0: 652e 7961 7720 3d20 7961 770a 2020 2020  e.yaw = yaw.    
-000152e0: 2020 2020 2020 2020 2020 2020 6174 7469              atti
-000152f0: 7475 6465 2e70 6974 6368 203d 2070 6974  tude.pitch = pit
-00015300: 6368 0a20 2020 2020 2020 2020 2020 2020  ch.             
-00015310: 2020 2061 7474 6974 7564 652e 726f 6c6c     attitude.roll
-00015320: 203d 2072 6f6c 6c0a 0a20 2020 2020 2020   = roll..       
-00015330: 2020 2020 2020 2020 2052 5f63 616d 5374           R_camSt
-00015340: 6432 7574 6d20 3d20 7365 6c66 2e67 6574  d2utm = self.get
-00015350: 5f52 5f63 616d 5374 6432 7574 6d28 525f  _R_camStd2utm(R_
-00015360: 6361 6d32 6672 616d 652c 525f 6672 616d  cam2frame,R_fram
-00015370: 6532 6e65 6429 0a20 2020 2020 2020 2020  e2ned).         
-00015380: 2020 2020 2020 2052 5f63 616d 3275 746d         R_cam2utm
-00015390: 5f6c 6973 742e 6170 7065 6e64 2852 5f63  _list.append(R_c
-000153a0: 616d 5374 6432 7574 6d2e 666c 6174 7465  amStd2utm.flatte
-000153b0: 6e28 292e 746f 6c69 7374 2829 290a 0a20  n().tolist()).. 
-000153c0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-000153d0: 2e6c 6f67 2822 6170 706c 6965 6420 6672  .log("applied fr
-000153e0: 616d 6520 746f 2063 616d 6572 6120 726f  ame to camera ro
-000153f0: 7461 7469 6f6e 2079 6177 2c70 6974 6368  tation yaw,pitch
-00015400: 2c72 6f6c 6c20 3d20 2220 2b20 7374 7228  ,roll = " + str(
-00015410: 6361 6d65 7261 3246 7261 6d65 5f79 6177  camera2Frame_yaw
-00015420: 2920 2b20 222c 2220 2b20 7374 7228 6361  ) + "," + str(ca
-00015430: 6d65 7261 3246 7261 6d65 5f70 6974 6368  mera2Frame_pitch
-00015440: 2920 2b20 222c 2220 2b20 7374 7228 6361  ) + "," + str(ca
-00015450: 6d65 7261 3246 7261 6d65 5f72 6f6c 6c29  mera2Frame_roll)
-00015460: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
-00015470: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00015480: 696d 6167 655f 6474 7329 203e 2030 3a0a  image_dts) > 0:.
-00015490: 0a20 2020 2020 2020 2020 2020 2023 2057  .            # W
-000154a0: 7269 7465 2074 6f20 6e61 7669 6761 7469  rite to navigati
-000154b0: 6f6e 2074 7874 2066 696c 650a 2020 2020  on txt file.    
-000154c0: 2020 2020 2020 2020 2320 6865 6164 6572          # header
-000154d0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000154e0: 203d 206f 7065 6e28 696e 745f 6174 7475   = open(int_attu
-000154f0: 7475 6465 5f66 696c 652c 2022 7722 290a  tude_file, "w").
-00015500: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00015510: 7772 6974 6528 6d69 7174 762e 636f 6c5f  write(miqtv.col_
-00015520: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00015530: 5b27 696d 6727 5d2b 225c 7422 2b6d 6971  ['img']+"\t"+miq
-00015540: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00015550: 6172 6971 7427 5d5b 2775 7463 275d 290a  ariqt']['utc']).
-00015560: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00015570: 7772 6974 6528 225c 7422 2b6d 6971 7476  write("\t"+miqtv
-00015580: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00015590: 6971 7427 5d5b 2779 6177 275d 290a 2020  iqt']['yaw']).  
-000155a0: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-000155b0: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
-000155c0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-000155d0: 7427 5d5b 2770 6974 6368 275d 290a 2020  t']['pitch']).  
-000155e0: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-000155f0: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
-00015600: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00015610: 7427 5d5b 2772 6f6c 6c27 5d29 0a0a 2020  t']['roll'])..  
-00015620: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00015630: 6974 6528 225c 6e22 290a 2020 2020 2020  ite("\n").      
-00015640: 2020 2020 2020 2320 6461 7461 206c 696e        # data lin
-00015650: 6573 0a20 2020 2020 2020 2020 2020 2066  es.            f
-00015660: 6f72 2066 696c 6520 696e 2069 6d61 6765  or file in image
-00015670: 5f64 7473 3a0a 2020 2020 2020 2020 2020  _dts:.          
-00015680: 2020 2020 2020 666f 7220 7469 6d65 706f        for timepo
-00015690: 696e 7420 696e 2069 6d61 6765 5f64 7473  int in image_dts
-000156a0: 5b66 696c 655d 3a0a 2020 2020 2020 2020  [file]:.        
-000156b0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-000156c0: 7772 6974 6528 6669 6c65 2b22 5c74 222b  write(file+"\t"+
-000156d0: 7469 6d65 706f 696e 742e 6461 7465 5469  timepoint.dateTi
-000156e0: 6d65 2829 2e73 7472 6674 696d 6528 6d69  me().strftime(mi
-000156f0: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
-00015700: 5b27 6d61 7269 7174 275d 2929 200a 2020  ['mariqt'])) .  
-00015710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015720: 2020 7661 6c20 3d20 7469 6d65 706f 696e    val = timepoin
-00015730: 742e 7961 770a 2020 2020 2020 2020 2020  t.yaw.          
-00015740: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00015750: 6974 6528 225c 7422 2b73 7472 2876 616c  ite("\t"+str(val
-00015760: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00015770: 2020 2020 2020 2076 616c 203d 2074 696d         val = tim
-00015780: 6570 6f69 6e74 2e70 6974 6368 0a20 2020  epoint.pitch.   
-00015790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000157a0: 2072 6573 2e77 7269 7465 2822 5c74 222b   res.write("\t"+
-000157b0: 7374 7228 7661 6c29 290a 2020 2020 2020  str(val)).      
-000157c0: 2020 2020 2020 2020 2020 2020 2020 7661                va
-000157d0: 6c20 3d20 7469 6d65 706f 696e 742e 726f  l = timepoint.ro
-000157e0: 6c6c 0a20 2020 2020 2020 2020 2020 2020  ll.             
-000157f0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00015800: 2822 5c74 222b 7374 7228 7661 6c29 290a  ("\t"+str(val)).
-00015810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015820: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
-00015830: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
-00015840: 7265 732e 636c 6f73 6528 290a 0a20 2020  res.close()..   
-00015850: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00015860: 6f76 2e61 6464 4172 6775 6d65 6e74 2822  ov.addArgument("
-00015870: 696e 7075 7441 7474 6974 7564 6546 696c  inputAttitudeFil
-00015880: 6522 2c61 7474 5f70 6174 682c 6f76 6572  e",att_path,over
-00015890: 7772 6974 653d 5472 7565 290a 2020 2020  write=True).    
-000158a0: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-000158b0: 762e 6c6f 6728 2270 6172 7365 6420 6672  v.log("parsed fr
-000158c0: 6f6d 2069 6e70 7574 4174 7469 7475 6465  om inputAttitude
-000158d0: 4669 6c65 3a20 2220 2b20 7374 7228 6672  File: " + str(fr
-000158e0: 616d 655f 6174 745f 6865 6164 6572 292c  ame_att_header),
-000158f0: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
-00015900: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00015910: 6164 645f 6974 656d 5f69 6e66 6f5f 7461  add_item_info_ta
-00015920: 625f 6669 6c65 2869 6e74 5f61 7474 7574  b_file(int_attut
-00015930: 7564 655f 6669 6c65 2c22 5c74 222c 6f75  ude_file,"\t",ou
-00015940: 7470 7574 5f68 6561 6465 725f 6174 7429  tput_header_att)
-00015950: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00015960: 5772 6974 6520 746f 2070 6f73 6520 7478  Write to pose tx
-00015970: 7420 6669 6c65 0a20 2020 2020 2020 2020  t file.         
-00015980: 2020 2023 2068 6561 6465 720a 2020 2020     # header.    
-00015990: 2020 2020 2020 2020 7265 7320 3d20 6f70          res = op
-000159a0: 656e 2869 6e74 5f70 6f73 655f 6669 6c65  en(int_pose_file
-000159b0: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
-000159c0: 2020 2072 6573 2e77 7269 7465 286d 6971     res.write(miq
-000159d0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-000159e0: 6172 6971 7427 5d5b 2769 6d67 275d 2b22  ariqt']['img']+"
-000159f0: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
-00015a00: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00015a10: 7574 6327 5d29 0a20 2020 2020 2020 2020  utc']).         
-00015a20: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
-00015a30: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
-00015a40: 6572 5b27 6d61 7269 7174 275d 5b27 706f  er['mariqt']['po
-00015a50: 7365 275d 290a 2020 2020 2020 2020 2020  se']).          
-00015a60: 2020 7265 732e 7772 6974 6528 225c 6e22    res.write("\n"
-00015a70: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-00015a80: 6461 7461 206c 696e 6573 0a20 2020 2020  data lines.     
-00015a90: 2020 2020 2020 2069 203d 2030 0a20 2020         i = 0.   
-00015aa0: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
-00015ab0: 6520 696e 2069 6d61 6765 5f64 7473 3a0a  e in image_dts:.
-00015ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ad0: 666f 7220 7469 6d65 706f 696e 7420 696e  for timepoint in
-00015ae0: 2069 6d61 6765 5f64 7473 5b66 696c 655d   image_dts[file]
-00015af0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015b00: 2020 2020 2020 6966 2052 5f63 616d 3275        if R_cam2u
-00015b10: 746d 5f6c 6973 745b 695d 203d 3d20 2222  tm_list[i] == ""
-00015b20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015b30: 2020 2020 2020 2020 2020 6920 2b3d 2031            i += 1
-00015b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015b50: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00015b60: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00015b70: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
-00015b80: 6669 6c65 2b22 5c74 222b 7469 6d65 706f  file+"\t"+timepo
-00015b90: 696e 742e 6461 7465 5469 6d65 2829 2e73  int.dateTime().s
-00015ba0: 7472 6674 696d 6528 6d69 7174 762e 6461  trftime(miqtv.da
-00015bb0: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
-00015bc0: 7174 275d 2929 200a 2020 2020 2020 2020  qt'])) .        
-00015bd0: 2020 2020 2020 2020 2020 2020 656e 7472              entr
-00015be0: 7920 3d20 7374 7228 7b27 706f 7365 2d61  y = str({'pose-a
-00015bf0: 6273 6f6c 7574 652d 6f72 6965 6e74 6174  bsolute-orientat
-00015c00: 696f 6e2d 7574 6d2d 6d61 7472 6978 273a  ion-utm-matrix':
-00015c10: 525f 6361 6d32 7574 6d5f 6c69 7374 5b69  R_cam2utm_list[i
-00015c20: 5d7d 292e 7265 706c 6163 6528 275c 6e27  ]}).replace('\n'
-00015c30: 2c27 2729 0a20 2020 2020 2020 2020 2020  ,'').           
-00015c40: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-00015c50: 7465 2822 5c74 222b 656e 7472 7929 0a20  te("\t"+entry). 
-00015c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c70: 2020 2069 202b 3d20 310a 2020 2020 2020     i += 1.      
-00015c80: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00015c90: 732e 7772 6974 6528 225c 6e22 290a 2020  s.write("\n").  
-00015ca0: 2020 2020 2020 2020 2020 7265 732e 636c            res.cl
-00015cb0: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
-00015cc0: 2020 7365 6c66 2e61 6464 5f69 7465 6d5f    self.add_item_
-00015cd0: 696e 666f 5f74 6162 5f66 696c 6528 696e  info_tab_file(in
-00015ce0: 745f 706f 7365 5f66 696c 652c 225c 7422  t_pose_file,"\t"
-00015cf0: 2c6f 7574 7075 745f 6865 6164 6572 5f70  ,output_header_p
-00015d00: 6f73 6529 0a20 2020 2020 2020 2020 2020  ose).           
-00015d10: 2073 2e73 746f 7028 290a 2020 2020 2020   s.stop().      
-00015d20: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-00015d30: 652c 2022 4174 7469 7475 6465 2064 6174  e, "Attitude dat
-00015d40: 6120 6372 6561 7465 6422 202b 2070 6172  a created" + par
-00015d50: 7365 4d73 670a 2020 2020 2020 2020 656c  seMsg.        el
-00015d60: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00015d70: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
-00015d80: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00015d90: 652c 2022 4e6f 2069 6d61 6765 2061 7474  e, "No image att
-00015da0: 6974 7564 6573 2066 6f75 6e64 2220 2b20  itudes found" + 
-00015db0: 7061 7273 654d 7367 0a20 2020 2020 2020  parseMsg.       
-00015dc0: 200a 2020 2020 2020 2020 0a20 2020 2064   .        .    d
-00015dd0: 6566 2063 7265 6174 6549 6d61 6765 4174  ef createImageAt
-00015de0: 7469 7475 6465 4669 6c65 2873 656c 662c  titudeFile(self,
-00015df0: 2061 7474 5f70 6174 683a 7374 722c 2066   att_path:str, f
-00015e00: 7261 6d65 5f61 7474 5f68 6561 6465 723a  rame_att_header:
-00015e10: 6469 6374 2c20 6361 6d65 7261 3246 7261  dict, camera2Fra
-00015e20: 6d65 5f79 6177 3a66 6c6f 6174 2c63 616d  me_yaw:float,cam
-00015e30: 6572 6132 4672 616d 655f 7069 7463 683a  era2Frame_pitch:
-00015e40: 666c 6f61 742c 6361 6d65 7261 3246 7261  float,camera2Fra
-00015e50: 6d65 5f72 6f6c 6c3a 666c 6f61 742c 0a20  me_roll:float,. 
-00015e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e70: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00015e80: 6174 655f 666f 726d 6174 3d6d 6971 7476  ate_format=miqtv
-00015e90: 2e64 6174 655f 666f 726d 6174 735b 2770  .date_formats['p
-00015ea0: 616e 6761 6561 275d 2c20 636f 6e73 745f  angaea'], const_
-00015eb0: 7661 6c75 6573 203d 207b 7d2c 206f 7665  values = {}, ove
-00015ec0: 7277 7269 7465 3d46 616c 7365 2c20 636f  rwrite=False, co
-00015ed0: 6c5f 7365 7061 7261 746f 7220 3d20 225c  l_separator = "\
-00015ee0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
-00015ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f00: 2020 2020 6174 745f 7061 7468 5f61 6e67      att_path_ang
-00015f10: 6c65 735f 696e 5f72 6164 203d 2046 616c  les_in_rad = Fal
-00015f20: 7365 2c20 7669 6465 6f53 616d 706c 6553  se, videoSampleS
-00015f30: 6563 6f6e 6473 3d31 2c72 6563 6f72 6473  econds=1,records
-00015f40: 3262 6549 6e76 6572 7465 643d 5b5d 293a  2beInverted=[]):
-00015f50: 0a20 2020 2020 2020 2022 2222 2044 6570  .        """ Dep
-00015f60: 7265 6361 7464 6520 2d20 7573 6520 6372  recatde - use cr
-00015f70: 6561 7465 5f69 6d61 6765 5f61 7474 6974  eate_image_attit
-00015f80: 7564 655f 6669 6c65 2022 2222 0a20 2020  ude_file """.   
-00015f90: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00015fa0: 2e63 7265 6174 655f 696d 6167 655f 6174  .create_image_at
-00015fb0: 7469 7475 6465 5f66 696c 6528 6174 745f  titude_file(att_
-00015fc0: 7061 7468 2c20 6672 616d 655f 6174 745f  path, frame_att_
-00015fd0: 6865 6164 6572 2c20 6361 6d65 7261 3246  header, camera2F
-00015fe0: 7261 6d65 5f79 6177 2c20 6361 6d65 7261  rame_yaw, camera
-00015ff0: 3246 7261 6d65 5f70 6974 6368 2c20 6361  2Frame_pitch, ca
-00016000: 6d65 7261 3246 7261 6d65 5f72 6f6c 6c2c  mera2Frame_roll,
-00016010: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00016020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012710: 6578 6365 7074 696f 6e4c 6973 742e 6170  exceptionList.ap
+00012720: 7065 6e64 285b 6669 6c65 4e61 6d65 2c22  pend([fileName,"
+00012730: 696e 636f 7272 6563 7420 7368 6132 3536  incorrect sha256
+00012740: 2068 6173 6822 5d29 0a20 2020 2020 2020   hash"]).       
+00012750: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+00012760: 6620 6e6f 7420 6974 656d 456e 7472 795b  f not itemEntry[
+00012770: 2769 6d61 6765 2d68 6173 682d 7368 6132  'image-hash-sha2
+00012780: 3536 275d 203d 3d20 6d69 7174 632e 7368  56'] == miqtc.sh
+00012790: 6132 3536 4861 7368 4669 6c65 2869 6d61  a256HashFile(ima
+000127a0: 6765 293a 0a20 2020 2020 2020 2020 2020  ge):.           
+000127b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000127c0: 7261 6973 6545 7863 6570 7469 6f6e 3a0a  raiseException:.
+000127d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000127f0: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
+00012800: 7074 696f 6e28 6974 656d 2c20 2269 6e63  ption(item, "inc
+00012810: 6f72 7265 6374 2073 6861 3235 3620 6861  orrect sha256 ha
+00012820: 7368 222c 2069 7465 6d45 6e74 7279 5b27  sh", itemEntry['
+00012830: 696d 6167 652d 6861 7368 2d73 6861 3235  image-hash-sha25
+00012840: 3627 5d2c 2266 6f72 2066 696c 6522 2c66  6'],"for file",f
+00012850: 696c 654e 616d 652c 2220 7275 6e20 6372  ileName," run cr
+00012860: 6561 7465 5f69 6d61 6765 5f73 6861 3235  eate_image_sha25
+00012870: 365f 6669 6c65 2829 2066 6972 7374 2229  6_file() first")
+00012880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012890: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000128a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000128b0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+000128c0: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
+000128d0: 5b66 696c 654e 616d 652c 2269 6e63 6f72  [fileName,"incor
+000128e0: 7265 6374 2073 6861 3235 3620 6861 7368  rect sha256 hash
+000128f0: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
+00012900: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+00012910: 2020 2020 2020 2020 2020 6966 2066 6f75            if fou
+00012920: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
+00012930: 2020 2020 6465 6c20 6861 7368 556e 6368      del hashUnch
+00012940: 6563 6b49 6d61 6765 7349 6e52 6177 5b69  eckImagesInRaw[i
+00012950: 6d61 6765 5d0a 2020 2020 2020 2020 2020  mage].          
+00012960: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00012970: 2020 2020 2020 2020 6966 2072 6169 7365          if raise
+00012980: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+00012990: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000129a0: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
+000129b0: 7863 6570 7469 6f6e 2820 2269 6d61 6765  xception( "image
+000129c0: 222c 2069 7465 6d2c 2022 6e6f 7420 666f  ", item, "not fo
+000129d0: 756e 6420 696e 2064 6972 6563 746f 7279  und in directory
+000129e0: 2773 2072 6177 2066 6f6c 6465 7221 2229  's raw folder!")
+000129f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012a00: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00012a10: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00012a20: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
+00012a30: 5b66 696c 654e 616d 652c 2266 696c 6520  [fileName,"file 
+00012a40: 6e6f 7420 666f 756e 6422 5d29 0a20 2020  not found"]).   
+00012a50: 2020 2020 2070 726f 672e 636c 6561 7228       prog.clear(
+00012a60: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+00012a70: 2072 6169 7365 4578 6365 7074 696f 6e3a   raiseException:
+00012a80: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00012a90: 7572 6e20 6578 6365 7074 696f 6e4c 6973  urn exceptionLis
+00012aa0: 740a 0a0a 2020 2020 6465 6620 6372 6561  t...    def crea
+00012ab0: 7465 5f75 7569 645f 6669 6c65 2873 656c  te_uuid_file(sel
+00012ac0: 662c 636c 6561 6e3d 5472 7565 293a 0a20  f,clean=True):. 
+00012ad0: 2020 2020 2020 2022 2222 2043 7265 6174         """ Creat
+00012ae0: 6573 2069 6e20 2f69 6e74 6572 6d65 6469  es in /intermedi
+00012af0: 6174 6520 6120 7465 7874 2066 696c 6520  ate a text file 
+00012b00: 636f 6e74 6169 6e69 6e67 2070 6572 2069  containing per i
+00012b10: 6d61 6765 2061 2063 7265 6174 6564 2075  mage a created u
+00012b20: 7569 6420 2876 6572 7369 6f6e 2034 292e  uid (version 4).
+00012b30: 0a0a 2020 2020 2020 2020 5468 6520 5555  ..        The UU
+00012b40: 4944 2069 7320 6f6e 6c79 202a 7461 6b65  ID is only *take
+00012b50: 6e2a 2066 726f 6d20 7468 6520 6d65 7461  n* from the meta
+00012b60: 6461 7461 206f 6620 7468 6520 696d 6167  data of the imag
+00012b70: 6573 2e20 4974 2064 6f65 7320 6e6f 7420  es. It does not 
+00012b80: 7772 6974 6520 5555 4944 7320 746f 2074  write UUIDs to t
+00012b90: 6865 206d 6574 6164 6174 6120 696e 2063  he metadata in c
+00012ba0: 6173 6520 736f 6d65 2066 696c 6573 2061  ase some files a
+00012bb0: 7265 206d 6973 7369 6e67 2069 742e 0a20  re missing it.. 
+00012bc0: 2020 2020 2020 2042 7574 2c20 6974 2063         But, it c
+00012bd0: 7265 6174 6573 2061 2043 5356 2066 696c  reates a CSV fil
+00012be0: 6520 696e 2074 6861 7420 6361 7365 2074  e in that case t
+00012bf0: 6861 7420 796f 7520 6361 6e20 7573 6520  hat you can use 
+00012c00: 746f 6765 7468 6572 2077 6974 6820 6578  together with ex
+00012c10: 6966 746f 6f6c 2074 6f20 6164 6420 7468  iftool to add th
+00012c20: 6520 5555 4944 2074 6f20 796f 7572 2064  e UUID to your d
+00012c30: 6174 612e 2042 6577 6172 6521 2074 6869  ata. Beware! thi
+00012c40: 7320 6361 6e20 6465 7374 726f 7920 796f  s can destroy yo
+00012c50: 7572 2069 6d61 6765 730a 2020 2020 2020  ur images.      
+00012c60: 2020 6966 206e 6f74 2064 6f6e 6520 7072    if not done pr
+00012c70: 6f70 6572 6c79 2120 4e6f 2067 7561 7261  operly! No guara
+00012c80: 6e74 6565 2069 7320 6769 7665 6e20 6974  ntee is given it
+00012c90: 2077 696c 6c20 776f 726b 2e20 4265 2063   will work. Be c
+00012ca0: 6172 6566 756c 210a 0a20 2020 2020 2020  areful!..       
+00012cb0: 2055 7365 2063 6c65 616e 3d46 616c 7365   Use clean=False
+00012cc0: 2074 6f20 6e6f 7420 6368 6563 6b20 7468   to not check th
+00012cd0: 6f73 6520 6669 6c65 7320 6167 6169 6e20  ose files again 
+00012ce0: 7768 6963 6820 6172 6520 616c 7265 6164  which are alread
+00012cf0: 7920 666f 756e 6420 696e 2069 6e74 6572  y found in inter
+00012d00: 6d65 6469 6174 6520 7575 6964 2066 696c  mediate uuid fil
+00012d10: 650a 2020 2020 2020 2020 2222 220a 0a20  e.        """.. 
+00012d20: 2020 2020 2020 2075 7569 6473 203d 207b         uuids = {
+00012d30: 7d0a 2020 2020 2020 2020 2320 4368 6563  }.        # Chec
+00012d40: 6b20 7768 6574 6865 7220 6120 6669 6c65  k whether a file
+00012d50: 2077 6974 6820 5555 4944 7320 6578 6973   with UUIDs exis
+00012d60: 7473 2c20 7468 656e 2072 6561 6420 6974  ts, then read it
+00012d70: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00012d80: 636c 6561 6e20 616e 6420 6f73 2e70 6174  clean and os.pat
+00012d90: 682e 6578 6973 7473 2873 656c 662e 6765  h.exists(self.ge
+00012da0: 745f 696e 745f 7575 6964 5f66 696c 6528  t_int_uuid_file(
+00012db0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00012dc0: 7575 6964 7320 3d20 6d69 7174 662e 7461  uuids = miqtf.ta
+00012dd0: 6246 696c 6544 6174 6128 7365 6c66 2e67  bFileData(self.g
+00012de0: 6574 5f69 6e74 5f75 7569 645f 6669 6c65  et_int_uuid_file
+00012df0: 2829 2c20 5b6d 6971 7476 2e63 6f6c 5f68  (), [miqtv.col_h
+00012e00: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00012e10: 2769 6d67 275d 2c20 6d69 7174 762e 636f  'img'], miqtv.co
+00012e20: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00012e30: 275d 5b27 7575 6964 275d 5d2c 206b 6579  ']['uuid']], key
+00012e40: 5f63 6f6c 3d6d 6971 7476 2e63 6f6c 5f68  _col=miqtv.col_h
+00012e50: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00012e60: 2769 6d67 275d 290a 2020 2020 2020 2020  'img']).        
+00012e70: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
+00012e80: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
+00012e90: 656c 662e 696d 6167 6573 4469 7229 3a0a  elf.imagesDir):.
+00012ea0: 0a20 2020 2020 2020 2020 2020 206d 6973  .            mis
+00012eb0: 7369 6e67 5f75 7569 6473 203d 207b 7d0a  sing_uuids = {}.
+00012ec0: 2020 2020 2020 2020 2020 2020 6164 6465              adde
+00012ed0: 645f 7575 6964 7320 3d20 300a 0a20 2020  d_uuids = 0..   
+00012ee0: 2020 2020 2020 2020 2075 6e6b 6e6f 776e           unknown
+00012ef0: 4669 6c65 7320 3d20 5b5d 0a20 2020 2020  Files = [].     
+00012f00: 2020 2020 2020 2066 6f72 2066 696c 6520         for file 
+00012f10: 696e 2073 656c 662e 696d 6167 6573 496e  in self.imagesIn
+00012f20: 496d 6167 6573 4469 7228 293a 0a20 2020  ImagesDir():.   
+00012f30: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00012f40: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
+00012f50: 2e62 6173 656e 616d 6528 6669 6c65 290a  .basename(file).
+00012f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f70: 6966 2066 696c 655f 6e61 6d65 206e 6f74  if file_name not
+00012f80: 2069 6e20 7575 6964 733a 0a20 2020 2020   in uuids:.     
+00012f90: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00012fa0: 6e6b 6e6f 776e 4669 6c65 732e 6170 7065  nknownFiles.appe
+00012fb0: 6e64 2866 696c 6529 0a20 2020 2020 2020  nd(file).       
+00012fc0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00012fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fe0: 2020 2075 7569 6473 5b66 696c 655f 6e61     uuids[file_na
+00012ff0: 6d65 5d20 3d20 7575 6964 735b 6669 6c65  me] = uuids[file
+00013000: 5f6e 616d 655d 5b6d 6971 7476 2e63 6f6c  _name][miqtv.col
+00013010: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00013020: 5d5b 2775 7569 6427 5d5d 0a0a 2020 2020  ]['uuid']]..    
+00013030: 2020 2020 2020 2020 756e 6b6e 6f77 6e46          unknownF
+00013040: 696c 6573 5555 4944 7320 3d20 6d69 7174  ilesUUIDs = miqt
+00013050: 692e 696d 6167 6573 436f 6e74 6169 6e56  i.imagesContainV
+00013060: 616c 6964 5555 4944 2875 6e6b 6e6f 776e  alidUUID(unknown
+00013070: 4669 6c65 7329 0a20 2020 2020 2020 2020  Files).         
+00013080: 2020 2066 6f72 2066 696c 6520 696e 2075     for file in u
+00013090: 6e6b 6e6f 776e 4669 6c65 7355 5549 4473  nknownFilesUUIDs
+000130a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000130b0: 2020 6669 6c65 5f6e 616d 6520 3d20 6f73    file_name = os
+000130c0: 2e70 6174 682e 6261 7365 6e61 6d65 2866  .path.basename(f
+000130d0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+000130e0: 2020 2020 2069 6620 6e6f 7420 756e 6b6e       if not unkn
+000130f0: 6f77 6e46 696c 6573 5555 4944 735b 6669  ownFilesUUIDs[fi
+00013100: 6c65 5d5b 2776 616c 6964 275d 3a0a 2020  le]['valid']:.  
+00013110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013120: 2020 7575 6964 203d 206d 6971 7463 2e75    uuid = miqtc.u
+00013130: 7569 6434 2829 0a20 2020 2020 2020 2020  uid4().         
+00013140: 2020 2020 2020 2020 2020 206d 6973 7369             missi
+00013150: 6e67 5f75 7569 6473 5b66 696c 655d 203d  ng_uuids[file] =
+00013160: 2075 7569 640a 2020 2020 2020 2020 2020   uuid.          
+00013170: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00013180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013190: 7575 6964 735b 6669 6c65 5f6e 616d 655d  uuids[file_name]
+000131a0: 203d 2075 6e6b 6e6f 776e 4669 6c65 7355   = unknownFilesU
+000131b0: 5549 4473 5b66 696c 655d 5b27 7575 6964  UIDs[file]['uuid
+000131c0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+000131d0: 2020 2020 2020 2061 6464 6564 5f75 7569         added_uui
+000131e0: 6473 202b 3d20 310a 0a20 2020 2020 2020  ds += 1..       
+000131f0: 2020 2020 2023 2049 6620 7072 6576 696f       # If previo
+00013200: 7573 6c79 2075 6e6b 6e6f 776e 2055 5549  usly unknown UUI
+00013210: 4473 2077 6572 6520 666f 756e 6420 696e  Ds were found in
+00013220: 2074 6865 2066 696c 6520 6865 6164 6572   the file header
+00013230: 732c 2061 6464 2074 6865 6d20 746f 2074  s, add them to t
+00013240: 6865 2055 5549 4420 6669 6c65 0a20 2020  he UUID file.   
+00013250: 2020 2020 2020 2020 2069 6620 6164 6465           if adde
+00013260: 645f 7575 6964 7320 3e20 303a 0a20 2020  d_uuids > 0:.   
+00013270: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00013280: 203d 206f 7065 6e28 7365 6c66 2e67 6574   = open(self.get
+00013290: 5f69 6e74 5f75 7569 645f 6669 6c65 2829  _int_uuid_file()
+000132a0: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
+000132b0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+000132c0: 286d 6971 7476 2e63 6f6c 5f68 6561 6465  (miqtv.col_heade
+000132d0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
+000132e0: 275d 202b 225c 7422 2b6d 6971 7476 2e63  '] +"\t"+miqtv.c
+000132f0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00013300: 7427 5d5b 2775 7569 6427 5d2b 225c 6e22  t']['uuid']+"\n"
+00013310: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00013320: 2020 6669 6c65 735f 736f 7274 6564 203d    files_sorted =
+00013330: 206c 6973 7428 7575 6964 732e 6b65 7973   list(uuids.keys
+00013340: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
+00013350: 2020 2020 6669 6c65 735f 736f 7274 6564      files_sorted
+00013360: 2e73 6f72 7428 290a 2020 2020 2020 2020  .sort().        
+00013370: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+00013380: 2069 6e20 6669 6c65 735f 736f 7274 6564   in files_sorted
+00013390: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000133a0: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+000133b0: 6669 6c65 2b22 5c74 222b 7374 7228 7575  file+"\t"+str(uu
+000133c0: 6964 735b 6669 6c65 5d29 2b22 5c6e 2229  ids[file])+"\n")
+000133d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000133e0: 2072 6573 2e63 6c6f 7365 2829 0a0a 2020   res.close()..  
+000133f0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00013400: 286d 6973 7369 6e67 5f75 7569 6473 2920  (missing_uuids) 
+00013410: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+00013420: 2020 2020 2065 6373 765f 7061 7468 203d       ecsv_path =
+00013430: 2073 656c 662e 5f5f 6765 745f 696e 745f   self.__get_int_
+00013440: 6669 6c65 5f70 7265 6669 7828 2920 2b20  file_prefix() + 
+00013450: 225f 6578 6966 2d61 6464 2d75 7569 642e  "_exif-add-uuid.
+00013460: 6373 7622 0a20 2020 2020 2020 2020 2020  csv".           
+00013470: 2020 2020 2063 7376 203d 206f 7065 6e28       csv = open(
+00013480: 6563 7376 5f70 6174 682c 2022 7722 290a  ecsv_path, "w").
+00013490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000134a0: 6373 762e 7772 6974 6528 6d69 7174 762e  csv.write(miqtv.
+000134b0: 636f 6c5f 6865 6164 6572 5b27 6578 6966  col_header['exif
+000134c0: 275d 5b27 696d 6727 5d20 2b0a 2020 2020  ']['img'] +.    
+000134d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000134e0: 2020 2020 2020 222c 222b 6d69 7174 762e        ","+miqtv.
+000134f0: 636f 6c5f 6865 6164 6572 5b27 6578 6966  col_header['exif
+00013500: 275d 5b27 7575 6964 275d 2b22 5c6e 2229  ']['uuid']+"\n")
+00013510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013520: 2064 6966 6665 7265 6e74 5f70 6174 6873   different_paths
+00013530: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+00013540: 2020 2020 2020 666f 7220 696d 6720 696e        for img in
+00013550: 206d 6973 7369 6e67 5f75 7569 6473 3a0a   missing_uuids:.
+00013560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013570: 2020 2020 6966 206f 732e 7061 7468 2e62      if os.path.b
+00013580: 6173 656e 616d 6528 696d 6729 206e 6f74  asename(img) not
+00013590: 2069 6e20 6469 6666 6572 656e 745f 7061   in different_pa
+000135a0: 7468 733a 0a20 2020 2020 2020 2020 2020  ths:.           
+000135b0: 2020 2020 2020 2020 2020 2020 2064 6966               dif
+000135c0: 6665 7265 6e74 5f70 6174 6873 2e61 7070  ferent_paths.app
+000135d0: 656e 6428 6f73 2e70 6174 682e 6261 7365  end(os.path.base
+000135e0: 6e61 6d65 2869 6d67 2929 0a20 2020 2020  name(img)).     
+000135f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00013600: 7376 2e77 7269 7465 2869 6d67 2b22 2c22  sv.write(img+","
+00013610: 2b73 7472 286d 6973 7369 6e67 5f75 7569  +str(missing_uui
+00013620: 6473 5b69 6d67 5d29 2b22 5c6e 2229 0a20  ds[img])+"\n"). 
+00013630: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00013640: 7265 7475 726e 2046 616c 7365 2c20 2265  return False, "e
+00013650: 7869 6674 6f6f 6c20 2d63 7376 3d22 2b65  xiftool -csv="+e
+00013660: 6373 765f 7061 7468 2b22 2022 2b22 2022  csv_path+" "+" "
+00013670: 2e6a 6f69 6e28 6469 6666 6572 656e 745f  .join(different_
+00013680: 7061 7468 7329 0a20 2020 2020 2020 2020  paths).         
+00013690: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+000136a0: 6c73 652c 2022 4e6f 7420 616c 6c20 696d  lse, "Not all im
+000136b0: 6167 6573 2068 6176 6520 7661 6c69 6420  ages have valid 
+000136c0: 5555 4944 732e 204d 6973 7369 6e67 2066  UUIDs. Missing f
+000136d0: 6f72 2066 6f6c 6c6f 7769 6e67 2066 696c  or following fil
+000136e0: 6573 3a5c 6e22 2b22 5cc5 8622 2e6a 6f69  es:\n"+"\..".joi
+000136f0: 6e28 6469 6666 6572 656e 745f 7061 7468  n(different_path
+00013700: 7329 0a20 2020 2020 2020 2020 2020 200a  s).            .
+00013710: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00013720: 2e5f 5f61 6c6c 5555 4944 7343 6865 636b  .__allUUIDsCheck
+00013730: 6564 203d 2054 7275 650a 2020 2020 2020  ed = True.      
+00013740: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00013750: 652c 2022 416c 6c20 696d 6167 6573 2068  e, "All images h
+00013760: 6176 6520 6120 5555 4944 220a 2020 2020  ave a UUID".    
+00013770: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00013780: 2c20 2250 6174 6820 222b 7365 6c66 2e69  , "Path "+self.i
+00013790: 6d61 6765 7344 6972 202b 2022 206e 6f74  magesDir + " not
+000137a0: 2066 6f75 6e64 2e22 0a0a 2020 2020 6465   found."..    de
+000137b0: 6620 6372 6561 7465 5555 4944 4669 6c65  f createUUIDFile
+000137c0: 2873 656c 662c 636c 6561 6e3d 5472 7565  (self,clean=True
+000137d0: 293a 0a20 2020 2020 2020 2022 2222 2044  ):.        """ D
+000137e0: 6570 7265 6361 7465 6420 2d20 7573 6520  eprecated - use 
+000137f0: 6372 6561 7465 5f75 7569 645f 6669 6c65  create_uuid_file
+00013800: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+00013810: 7572 6e20 7365 6c66 2e63 7265 6174 655f  urn self.create_
+00013820: 7575 6964 5f66 696c 6528 636c 6561 6e29  uuid_file(clean)
+00013830: 0a0a 0a20 2020 2064 6566 2073 6574 5f69  ...    def set_i
+00013840: 6d61 6765 5f73 6574 5f61 7474 6974 7564  mage_set_attitud
+00013850: 6528 7365 6c66 2c79 6177 5f66 7261 6d65  e(self,yaw_frame
+00013860: 3a66 6c6f 6174 2c70 6974 6368 5f66 7261  :float,pitch_fra
+00013870: 6d65 3a66 6c6f 6174 2c72 6f6c 6c5f 6672  me:float,roll_fr
+00013880: 616d 653a 666c 6f61 742c 7961 775f 6361  ame:float,yaw_ca
+00013890: 6d32 6672 616d 653a 666c 6f61 742c 7069  m2frame:float,pi
+000138a0: 7463 685f 6361 6d32 6672 616d 653a 666c  tch_cam2frame:fl
+000138b0: 6f61 742c 726f 6c6c 5f63 616d 3266 7261  oat,roll_cam2fra
+000138c0: 6d65 3a66 6c6f 6174 293a 0a20 2020 2020  me:float):.     
+000138d0: 2020 2022 2222 2063 616c 6375 6c61 7465     """ calculate
+000138e0: 7320 7468 6520 7468 6520 6361 6d65 7261  s the the camera
+000138f0: 7320 6162 736f 6c75 7465 2061 7474 6974  s absolute attit
+00013900: 7564 6520 616e 6420 7365 7473 2069 7420  ude and sets it 
+00013910: 746f 2069 6d61 6765 2073 6574 2068 6561  to image set hea
+00013920: 6465 722e 2041 6c6c 2061 6e67 6c65 7320  der. All angles 
+00013930: 6172 6520 6578 7065 6374 6564 2069 6e20  are expected in 
+00013940: 6465 6772 6565 732e 200a 2020 2020 2020  degrees. .      
+00013950: 2020 6361 6d65 7261 3266 7261 6d65 2061    camera2frame a
+00013960: 6e67 6c65 733a 2072 6f74 6174 696f 6e20  ngles: rotation 
+00013970: 6f66 2063 616d 6572 6120 636f 6f72 6469  of camera coordi
+00013980: 6e61 7465 7320 2878 2c79 2c7a 203d 2074  nates (x,y,z = t
+00013990: 6f70 2c20 7269 6768 742c 206c 696e 6520  op, right, line 
+000139a0: 6f66 2073 6967 6874 2920 7769 7468 2072  of sight) with r
+000139b0: 6573 7065 6374 2074 6f20 7665 6869 636c  espect to vehicl
+000139c0: 6520 636f 6f72 6469 6e61 7465 7320 2878  e coordinates (x
+000139d0: 2c79 2c7a 203d 2066 6f72 7761 7264 2c72  ,y,z = forward,r
+000139e0: 6967 6874 2c64 6f77 6e29 200a 2020 2020  ight,down) .    
+000139f0: 2020 2020 696e 2061 6363 6f72 6461 6e63      in accordanc
+00013a00: 6520 7769 7468 2074 6865 2079 6177 2c70  e with the yaw,p
+00013a10: 6974 6368 2c72 6f6c 6c20 726f 7461 7469  itch,roll rotati
+00013a20: 6f6e 206f 7264 6572 2063 6f6e 7665 6e74  on order convent
+00013a30: 696f 6e3a 0a0a 2020 2020 2020 2020 312e  ion:..        1.
+00013a40: 2079 6177 2061 726f 756e 6420 7a2c 0a20   yaw around z,. 
+00013a50: 2020 2020 2020 2032 2e20 7069 7463 6820         2. pitch 
+00013a60: 6172 6f75 6e64 2072 6f74 6174 6564 2079  around rotated y
+00013a70: 2c0a 2020 2020 2020 2020 332e 2072 6f6c  ,.        3. rol
+00013a80: 6c20 6172 6f75 6e64 2072 6f74 6174 6564  l around rotated
+00013a90: 2078 0a0a 2020 2020 2020 2020 526f 7461   x..        Rota
+00013aa0: 7469 6f6e 2064 6972 6563 7469 6f6e 7320  tion directions 
+00013ab0: 6163 636f 7264 696e 6720 746f 205c 2772  according to \'r
+00013ac0: 6967 6874 2d68 616e 6420 7275 6c65 5c27  ight-hand rule\'
+00013ad0: 2e0a 0a20 2020 2020 2020 2049 2e65 2e20  ...        I.e. 
+00013ae0: 6361 6d65 7261 3246 7261 6d65 2061 6e67  camera2Frame ang
+00013af0: 6c65 7320 3d20 302c 302c 3020 6361 6d65  les = 0,0,0 came
+00013b00: 7261 2069 7320 6661 6369 6e67 2064 6f77  ra is facing dow
+00013b10: 6e77 6172 6420 7769 7468 2074 6f70 2073  nward with top s
+00013b20: 6964 6520 746f 7761 7264 7320 7665 6869  ide towards vehi
+00013b30: 636c 6527 7320 666f 7277 6172 6420 6469  cle's forward di
+00013b40: 7265 6374 696f 6e27 2022 2222 0a0a 2020  rection' """..  
+00013b50: 2020 2020 2020 525f 6672 616d 6532 6e65        R_frame2ne
+00013b60: 6420 3d20 6d69 7174 672e 525f 5961 7750  d = miqtg.R_YawP
+00013b70: 6974 6368 526f 6c6c 2879 6177 5f66 7261  itchRoll(yaw_fra
+00013b80: 6d65 2c70 6974 6368 5f66 7261 6d65 2c72  me,pitch_frame,r
+00013b90: 6f6c 6c5f 6672 616d 6529 0a20 2020 2020  oll_frame).     
+00013ba0: 2020 2052 5f63 616d 3266 7261 6d65 203d     R_cam2frame =
+00013bb0: 206d 6971 7467 2e52 5f59 6177 5069 7463   miqtg.R_YawPitc
+00013bc0: 6852 6f6c 6c28 7961 775f 6361 6d32 6672  hRoll(yaw_cam2fr
+00013bd0: 616d 652c 7069 7463 685f 6361 6d32 6672  ame,pitch_cam2fr
+00013be0: 616d 652c 726f 6c6c 5f63 616d 3266 7261  ame,roll_cam2fra
+00013bf0: 6d65 290a 2020 2020 2020 2020 525f 6361  me).        R_ca
+00013c00: 6d32 6e65 6420 3d20 525f 6672 616d 6532  m2ned = R_frame2
+00013c10: 6e65 642e 646f 7428 525f 6361 6d32 6672  ned.dot(R_cam2fr
+00013c20: 616d 6529 0a20 2020 2020 2020 2079 6177  ame).        yaw
+00013c30: 2c70 6974 6368 2c72 6f6c 6c20 3d20 6d69  ,pitch,roll = mi
+00013c40: 7174 672e 7961 7750 6974 6368 526f 6c6c  qtg.yawPitchRoll
+00013c50: 2852 5f63 616d 326e 6564 290a 0a20 2020  (R_cam2ned)..   
+00013c60: 2020 2020 2023 2070 6f73 6520 6d61 7472       # pose matr
+00013c70: 6978 2063 616d 3275 746d 0a20 2020 2020  ix cam2utm.     
+00013c80: 2020 2052 5f63 616d 5374 6432 7574 6d20     R_camStd2utm 
+00013c90: 3d20 7365 6c66 2e67 6574 5f52 5f63 616d  = self.get_R_cam
+00013ca0: 5374 6432 7574 6d28 525f 6361 6d32 6672  Std2utm(R_cam2fr
+00013cb0: 616d 652c 525f 6672 616d 6532 6e65 6429  ame,R_frame2ned)
+00013cc0: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00013cd0: 2020 2020 2020 7820 3d20 6e70 2e61 7272        x = np.arr
+00013ce0: 6179 285b 312c 302c 305d 290a 2020 2020  ay([1,0,0]).    
+00013cf0: 2020 2020 7920 3d20 6e70 2e61 7272 6179      y = np.array
+00013d00: 285b 302c 312c 305d 290a 2020 2020 2020  ([0,1,0]).      
+00013d10: 2020 7a20 3d20 6e70 2e61 7272 6179 285b    z = np.array([
+00013d20: 302c 302c 315d 290a 2020 2020 2020 2020  0,0,1]).        
+00013d30: 7072 696e 7428 2778 272c 525f 6361 6d53  print('x',R_camS
+00013d40: 7464 3275 746d 2e64 6f74 2878 292e 726f  td2utm.dot(x).ro
+00013d50: 756e 6428 3529 290a 2020 2020 2020 2020  und(5)).        
+00013d60: 7072 696e 7428 2779 272c 525f 6361 6d53  print('y',R_camS
+00013d70: 7464 3275 746d 2e64 6f74 2879 292e 726f  td2utm.dot(y).ro
+00013d80: 756e 6428 3529 290a 2020 2020 2020 2020  und(5)).        
+00013d90: 7072 696e 7428 277a 272c 525f 6361 6d53  print('z',R_camS
+00013da0: 7464 3275 746d 2e64 6f74 287a 292e 726f  td2utm.dot(z).ro
+00013db0: 756e 6428 3529 290a 2020 2020 2020 2020  und(5)).        
+00013dc0: 2222 220a 0a20 2020 2020 2020 2068 6561  """..        hea
+00013dd0: 6465 7255 7064 6174 6520 3d20 7b0a 2020  derUpdate = {.  
+00013de0: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
+00013df0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00013e00: 7174 275d 5b27 7961 7727 5d3a 7961 772c  qt']['yaw']:yaw,
+00013e10: 0a20 2020 2020 2020 2020 2020 206d 6971  .            miq
+00013e20: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00013e30: 6172 6971 7427 5d5b 2770 6974 6368 275d  ariqt']['pitch']
+00013e40: 3a70 6974 6368 2c0a 2020 2020 2020 2020  :pitch,.        
+00013e50: 2020 2020 6d69 7174 762e 636f 6c5f 6865      miqtv.col_he
+00013e60: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00013e70: 726f 6c6c 275d 3a72 6f6c 6c2c 0a20 2020  roll']:roll,.   
+00013e80: 2020 2020 2020 2020 206d 6971 7476 2e63           miqtv.c
+00013e90: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00013ea0: 7427 5d5b 2770 6f73 6527 5d3a 7b27 706f  t']['pose']:{'po
+00013eb0: 7365 2d61 6273 6f6c 7574 652d 6f72 6965  se-absolute-orie
+00013ec0: 6e74 6174 696f 6e2d 7574 6d2d 6d61 7472  ntation-utm-matr
+00013ed0: 6978 273a 525f 6361 6d53 7464 3275 746d  ix':R_camStd2utm
+00013ee0: 2e66 6c61 7474 656e 2829 2e74 6f6c 6973  .flatten().tolis
+00013ef0: 7428 297d 0a20 2020 2020 2020 207d 0a20  t()}.        }. 
+00013f00: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
+00013f10: 7465 5f69 6664 6f5f 6865 6164 6572 5f66  te_ifdo_header_f
+00013f20: 6965 6c64 7328 6865 6164 6572 5570 6461  ields(headerUpda
+00013f30: 7465 290a 0a20 2020 2064 6566 2073 6574  te)..    def set
+00013f40: 496d 6167 6553 6574 4174 7469 7475 6465  ImageSetAttitude
+00013f50: 2873 656c 662c 7961 775f 6672 616d 653a  (self,yaw_frame:
+00013f60: 666c 6f61 742c 7069 7463 685f 6672 616d  float,pitch_fram
+00013f70: 653a 666c 6f61 742c 726f 6c6c 5f66 7261  e:float,roll_fra
+00013f80: 6d65 3a66 6c6f 6174 2c79 6177 5f63 616d  me:float,yaw_cam
+00013f90: 3266 7261 6d65 3a66 6c6f 6174 2c70 6974  2frame:float,pit
+00013fa0: 6368 5f63 616d 3266 7261 6d65 3a66 6c6f  ch_cam2frame:flo
+00013fb0: 6174 2c72 6f6c 6c5f 6361 6d32 6672 616d  at,roll_cam2fram
+00013fc0: 653a 666c 6f61 7429 3a0a 2020 2020 2020  e:float):.      
+00013fd0: 2020 2222 2220 4465 7072 6563 6174 6564    """ Deprecated
+00013fe0: 202d 2075 7365 2073 6574 5f69 6d61 6765   - use set_image
+00013ff0: 5f73 6574 5f61 7474 6974 7564 6520 2222  _set_attitude ""
+00014000: 220a 2020 2020 2020 2020 7365 6c66 2e73  ".        self.s
+00014010: 6574 5f69 6d61 6765 5f73 6574 5f61 7474  et_image_set_att
+00014020: 6974 7564 6528 7961 775f 6672 616d 652c  itude(yaw_frame,
+00014030: 2070 6974 6368 5f66 7261 6d65 2c20 726f   pitch_frame, ro
+00014040: 6c6c 5f66 7261 6d65 2c20 7961 775f 6361  ll_frame, yaw_ca
+00014050: 6d32 6672 616d 652c 2070 6974 6368 5f63  m2frame, pitch_c
+00014060: 616d 3266 7261 6d65 2c20 726f 6c6c 5f63  am2frame, roll_c
+00014070: 616d 3266 7261 6d65 290a 0a0a 2020 2020  am2frame)...    
+00014080: 6465 6620 6372 6561 7465 5f69 6d61 6765  def create_image
+00014090: 5f61 7474 6974 7564 655f 6669 6c65 2873  _attitude_file(s
+000140a0: 656c 662c 2061 7474 5f70 6174 683a 7374  elf, att_path:st
+000140b0: 722c 2066 7261 6d65 5f61 7474 5f68 6561  r, frame_att_hea
+000140c0: 6465 723a 6469 6374 2c20 6361 6d65 7261  der:dict, camera
+000140d0: 3246 7261 6d65 5f79 6177 3a66 6c6f 6174  2Frame_yaw:float
+000140e0: 2c63 616d 6572 6132 4672 616d 655f 7069  ,camera2Frame_pi
+000140f0: 7463 683a 666c 6f61 742c 6361 6d65 7261  tch:float,camera
+00014100: 3246 7261 6d65 5f72 6f6c 6c3a 666c 6f61  2Frame_roll:floa
+00014110: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+00014120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014130: 2020 2064 6174 655f 666f 726d 6174 3d6d     date_format=m
+00014140: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
+00014150: 735b 2770 616e 6761 6561 275d 2c20 636f  s['pangaea'], co
+00014160: 6e73 745f 7661 6c75 6573 203d 207b 7d2c  nst_values = {},
+00014170: 206f 7665 7277 7269 7465 3d46 616c 7365   overwrite=False
+00014180: 2c20 636f 6c5f 7365 7061 7261 746f 7220  , col_separator 
+00014190: 3d20 225c 7422 2c0a 2020 2020 2020 2020  = "\t",.        
+000141a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141b0: 2020 2020 2020 2020 6174 745f 7061 7468          att_path
+000141c0: 5f61 6e67 6c65 735f 696e 5f72 6164 203d  _angles_in_rad =
+000141d0: 2046 616c 7365 2c20 7669 6465 6f53 616d   False, videoSam
+000141e0: 706c 6553 6563 6f6e 6473 3d31 2c72 6563  pleSeconds=1,rec
+000141f0: 6f72 6473 3262 6549 6e76 6572 7465 643d  ords2beInverted=
+00014200: 5b5d 293a 0a20 2020 2020 2020 2022 2222  []):.        """
+00014210: 2043 7265 6174 6573 2069 6e20 2f69 6e74   Creates in /int
+00014220: 6572 6d65 6469 6174 6520 6120 7465 7874  ermediate a text
+00014230: 2066 696c 6520 7769 7468 2063 616d 6572   file with camer
+00014240: 6120 6174 7469 7475 6465 2064 6174 6120  a attitude data 
+00014250: 666f 7220 6561 6368 2069 6d61 6765 2e20  for each image. 
+00014260: 416c 6c20 616e 676c 6573 2061 7265 2065  All angles are e
+00014270: 7870 6563 7465 6420 696e 2064 6567 7265  xpected in degre
+00014280: 6573 2e20 5573 6520 6174 745f 7061 7468  es. Use att_path
+00014290: 5f61 6e67 6c65 735f 696e 5f72 6164 2069  _angles_in_rad i
+000142a0: 6620 6e65 6365 7373 6172 792e 200a 2020  f necessary. .  
+000142b0: 2020 2020 2020 6361 6d65 7261 3246 7261        camera2Fra
+000142c0: 6d65 2061 6e67 6c65 733a 2072 6f74 6174  me angles: rotat
+000142d0: 696f 6e20 6f66 2063 616d 6572 6120 636f  ion of camera co
+000142e0: 6f72 6469 6e61 7465 7320 2878 2c79 2c7a  ordinates (x,y,z
+000142f0: 203d 2074 6f70 2c20 7269 6768 742c 206c   = top, right, l
+00014300: 696e 6520 6f66 2073 6967 6874 2920 7769  ine of sight) wi
+00014310: 7468 2072 6573 7065 6374 2074 6f20 7665  th respect to ve
+00014320: 6869 636c 6520 636f 6f72 6469 6e61 7465  hicle coordinate
+00014330: 7320 2878 2c79 2c7a 203d 2066 6f72 7761  s (x,y,z = forwa
+00014340: 7264 2c72 6967 6874 2c64 6f77 6e29 200a  rd,right,down) .
+00014350: 2020 2020 2020 2020 696e 2061 6363 6f72          in accor
+00014360: 6461 6e63 6520 7769 7468 2074 6865 2079  dance with the y
+00014370: 6177 2c70 6974 6368 2c72 6f6c 6c20 726f  aw,pitch,roll ro
+00014380: 7461 7469 6f6e 206f 7264 6572 2063 6f6e  tation order con
+00014390: 7665 6e74 696f 6e3a 0a20 2020 2020 2020  vention:.       
+000143a0: 2031 2e20 7961 7720 6172 6f75 6e64 207a   1. yaw around z
+000143b0: 2c0a 2020 2020 2020 2020 322e 2070 6974  ,.        2. pit
+000143c0: 6368 2061 726f 756e 6420 726f 7461 7465  ch around rotate
+000143d0: 6420 792c 0a20 2020 2020 2020 2033 2e20  d y,.        3. 
+000143e0: 726f 6c6c 2061 726f 756e 6420 726f 7461  roll around rota
+000143f0: 7465 6420 780a 0a20 2020 2020 2020 2052  ted x..        R
+00014400: 6f74 6174 696f 6e20 6469 7265 6374 696f  otation directio
+00014410: 6e73 2061 6363 6f72 6469 6e67 2074 6f20  ns according to 
+00014420: 5c27 7269 6768 742d 6861 6e64 2072 756c  \'right-hand rul
+00014430: 655c 272e 0a0a 2020 2020 2020 2020 492e  e\'...        I.
+00014440: 652e 2063 616d 6572 6132 4672 616d 6520  e. camera2Frame 
+00014450: 616e 676c 6573 203d 2030 2c30 2c30 2063  angles = 0,0,0 c
+00014460: 616d 6572 6120 6973 2066 6163 696e 6720  amera is facing 
+00014470: 646f 776e 7761 7264 2077 6974 6820 746f  downward with to
+00014480: 7020 7369 6465 2074 6f77 6172 6473 2076  p side towards v
+00014490: 6568 6963 6c65 2773 2066 6f72 7761 7264  ehicle's forward
+000144a0: 2064 6972 6563 7469 6f6e 2720 2222 220a   direction' """.
+000144b0: 0a20 2020 2020 2020 2069 6e74 5f61 7474  .        int_att
+000144c0: 7574 7564 655f 6669 6c65 203d 2073 656c  utude_file = sel
+000144d0: 662e 5f5f 6765 745f 696e 745f 6669 6c65  f.__get_int_file
+000144e0: 5f70 7265 6669 7828 2920 2b20 275f 696d  _prefix() + '_im
+000144f0: 6167 652d 6174 7469 7475 6465 2e74 7874  age-attitude.txt
+00014500: 270a 2020 2020 2020 2020 6f75 7470 7574  '.        output
+00014510: 5f68 6561 6465 725f 6174 7420 3d20 7b20  _header_att = { 
+00014520: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
+00014530: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
+00014540: 6727 5d3a 2020 6d69 7174 762e 636f 6c5f  g']:  miqtv.col_
+00014550: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00014560: 5b27 696d 6727 5d2c 0a20 2020 2020 2020  ['img'],.       
+00014570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014580: 2020 2020 2020 2020 206d 6971 7476 2e63           miqtv.c
+00014590: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+000145a0: 7427 5d5b 2775 7463 275d 3a6d 6971 7476  t']['utc']:miqtv
+000145b0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+000145c0: 6971 7427 5d5b 2775 7463 275d 2c0a 2020  iqt']['utc'],.  
+000145d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145e0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+000145f0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00014600: 6d61 7269 7174 275d 5b27 7961 7727 5d3a  mariqt']['yaw']:
+00014610: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00014620: 5b27 6d61 7269 7174 275d 5b27 7961 7727  ['mariqt']['yaw'
+00014630: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00014640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014650: 2020 206d 6971 7476 2e63 6f6c 5f68 6561     miqtv.col_hea
+00014660: 6465 725b 276d 6172 6971 7427 5d5b 2770  der['mariqt']['p
+00014670: 6974 6368 275d 3a6d 6971 7476 2e63 6f6c  itch']:miqtv.col
+00014680: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00014690: 5d5b 2770 6974 6368 275d 2c0a 2020 2020  ]['pitch'],.    
+000146a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000146b0: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
+000146c0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+000146d0: 7269 7174 275d 5b27 726f 6c6c 275d 3a6d  riqt']['roll']:m
+000146e0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+000146f0: 276d 6172 6971 7427 5d5b 2772 6f6c 6c27  'mariqt']['roll'
+00014700: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00014710: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00014720: 0a0a 2020 2020 2020 2020 696e 745f 706f  ..        int_po
+00014730: 7365 5f66 696c 6520 3d20 7365 6c66 2e5f  se_file = self._
+00014740: 5f67 6574 5f69 6e74 5f66 696c 655f 7072  _get_int_file_pr
+00014750: 6566 6978 2829 202b 2027 5f69 6d61 6765  efix() + '_image
+00014760: 2d63 616d 6572 612d 706f 7365 2e74 7874  -camera-pose.txt
+00014770: 270a 2020 2020 2020 2020 6f75 7470 7574  '.        output
+00014780: 5f68 6561 6465 725f 706f 7365 203d 207b  _header_pose = {
+00014790: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
+000147a0: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
+000147b0: 6727 5d3a 6d69 7174 762e 636f 6c5f 6865  g']:miqtv.col_he
+000147c0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+000147d0: 696d 6727 5d2c 0a20 2020 2020 2020 2020  img'],.         
+000147e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147f0: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
+00014800: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00014810: 5d5b 2775 7463 275d 3a6d 6971 7476 2e63  ]['utc']:miqtv.c
+00014820: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00014830: 7427 5d5b 2775 7463 275d 2c0a 2020 2020  t']['utc'],.    
+00014840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014850: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
+00014860: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00014870: 7269 7174 275d 5b27 706f 7365 275d 3a6d  riqt']['pose']:m
+00014880: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00014890: 276d 6172 6971 7427 5d5b 2770 6f73 6527  'mariqt']['pose'
+000148a0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+000148b0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+000148c0: 0a0a 2020 2020 2020 2020 6966 206f 732e  ..        if os.
+000148d0: 7061 7468 2e65 7869 7374 7328 696e 745f  path.exists(int_
+000148e0: 6174 7475 7475 6465 5f66 696c 6529 2061  attutude_file) a
+000148f0: 6e64 206e 6f74 206f 7665 7277 7269 7465  nd not overwrite
+00014900: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00014910: 6c66 2e61 6464 5f69 7465 6d5f 696e 666f  lf.add_item_info
+00014920: 5f74 6162 5f66 696c 6528 696e 745f 6174  _tab_file(int_at
+00014930: 7475 7475 6465 5f66 696c 652c 225c 7422  tutude_file,"\t"
+00014940: 2c6f 7574 7075 745f 6865 6164 6572 5f61  ,output_header_a
+00014950: 7474 290a 2020 2020 2020 2020 2020 2020  tt).            
+00014960: 6578 7472 615f 6d73 6720 3d20 2222 0a20  extra_msg = "". 
+00014970: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
+00014980: 2e70 6174 682e 6578 6973 7473 2869 6e74  .path.exists(int
+00014990: 5f70 6f73 655f 6669 6c65 293a 0a20 2020  _pose_file):.   
+000149a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000149b0: 662e 6164 645f 6974 656d 5f69 6e66 6f5f  f.add_item_info_
+000149c0: 7461 625f 6669 6c65 2869 6e74 5f70 6f73  tab_file(int_pos
+000149d0: 655f 6669 6c65 2c22 5c74 222c 6f75 7470  e_file,"\t",outp
+000149e0: 7574 5f68 6561 6465 725f 706f 7365 290a  ut_header_pose).
+000149f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a00: 6578 7472 615f 6d73 6720 3d20 222c 2022  extra_msg = ", "
+00014a10: 202b 2069 6e74 5f70 6f73 655f 6669 6c65   + int_pose_file
+00014a20: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00014a30: 7572 6e20 5472 7565 2c20 224f 7574 7075  urn True, "Outpu
+00014a40: 7420 6669 6c65 2065 7869 7374 733a 2022  t file exists: "
+00014a50: 2b69 6e74 5f61 7474 7574 7564 655f 6669  +int_attutude_fi
+00014a60: 6c65 202b 2065 7874 7261 5f6d 7367 0a0a  le + extra_msg..
+00014a70: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+00014a80: 732e 7061 7468 2e65 7869 7374 7328 6174  s.path.exists(at
+00014a90: 745f 7061 7468 293a 0a20 2020 2020 2020  t_path):.       
+00014aa0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00014ab0: 652c 2022 4174 7469 7475 6465 2066 696c  e, "Attitude fil
+00014ac0: 6520 6e6f 7420 666f 756e 643a 2022 2b61  e not found: "+a
+00014ad0: 7474 5f70 6174 680a 0a20 2020 2020 2020  tt_path..       
+00014ae0: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+00014af0: 6578 6973 7473 2873 656c 662e 696d 6167  exists(self.imag
+00014b00: 6573 4469 7229 3a0a 2020 2020 2020 2020  esDir):.        
+00014b10: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00014b20: 2c20 2249 6d61 6765 2066 6f6c 6465 7220  , "Image folder 
+00014b30: 6e6f 7420 666f 756e 643a 2022 2b20 7365  not found: "+ se
+00014b40: 6c66 2e69 6d61 6765 7344 6972 0a0a 2020  lf.imagesDir..  
+00014b50: 2020 2020 2020 7320 3d20 6d69 7174 632e        s = miqtc.
+00014b60: 5072 696e 744c 6f61 6469 6e67 4d73 6728  PrintLoadingMsg(
+00014b70: 2243 7265 6174 696e 6720 6974 656d 7327  "Creating items'
+00014b80: 2061 7474 6974 7564 6520 6461 7461 2229   attitude data")
+00014b90: 0a0a 2020 2020 2020 2020 2320 6c6f 6164  ..        # load
+00014ba0: 2066 7261 6d65 2061 7474 6974 7564 6520   frame attitude 
+00014bb0: 6461 7461 2066 726f 6d20 6669 6c65 0a20  data from file. 
+00014bc0: 2020 2020 2020 2061 7474 5f64 6174 612c         att_data,
+00014bd0: 2070 6172 7365 4d73 6720 3d20 6d69 7174   parseMsg = miqt
+00014be0: 6e2e 7265 6164 416c 6c41 7474 6974 7564  n.readAllAttitud
+00014bf0: 6573 4672 6f6d 4669 6c65 5061 7468 2861  esFromFilePath(a
+00014c00: 7474 5f70 6174 682c 2066 7261 6d65 5f61  tt_path, frame_a
+00014c10: 7474 5f68 6561 6465 722c 2064 6174 655f  tt_header, date_
+00014c20: 666f 726d 6174 2c63 6f6c 5f73 6570 6172  format,col_separ
+00014c30: 6174 6f72 3d63 6f6c 5f73 6570 6172 6174  ator=col_separat
+00014c40: 6f72 2c63 6f6e 7374 5f76 616c 7565 733d  or,const_values=
+00014c50: 636f 6e73 745f 7661 6c75 6573 2c61 6e67  const_values,ang
+00014c60: 6c65 7349 6e52 6164 3d61 7474 5f70 6174  lesInRad=att_pat
+00014c70: 685f 616e 676c 6573 5f69 6e5f 7261 6429  h_angles_in_rad)
+00014c80: 0a20 2020 2020 2020 2069 6620 7061 7273  .        if pars
+00014c90: 654d 7367 2021 3d20 2222 3a0a 2020 2020  eMsg != "":.    
+00014ca0: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+00014cb0: 762e 6c6f 6728 7061 7273 654d 7367 2c64  v.log(parseMsg,d
+00014cc0: 6f6e 7453 686f 773d 5472 7565 290a 2020  ontShow=True).  
+00014cd0: 2020 2020 2020 2020 2020 7061 7273 654d            parseM
+00014ce0: 7367 203d 2022 5c6e 2220 2b20 7061 7273  sg = "\n" + pars
+00014cf0: 654d 7367 0a0a 2020 2020 2020 2020 2320  eMsg..        # 
+00014d00: 6669 6e64 2066 6f72 2065 6163 6820 696d  find for each im
+00014d10: 6167 6520 7468 6520 7265 7370 6563 7469  age the respecti
+00014d20: 7665 206e 6176 6967 6174 696f 6e20 6461  ve navigation da
+00014d30: 7461 0a20 2020 2020 2020 2073 2e73 746f  ta.        s.sto
+00014d40: 7028 290a 2020 2020 2020 2020 7375 6363  p().        succ
+00014d50: 6573 732c 2069 6d61 6765 5f64 7473 2c20  ess, image_dts, 
+00014d60: 6d73 6720 3d20 7365 6c66 2e66 696e 644e  msg = self.findN
+00014d70: 6176 4461 7461 466f 7249 6d61 6765 2861  avDataForImage(a
+00014d80: 7474 5f64 6174 612c 7669 6465 6f53 616d  tt_data,videoSam
+00014d90: 706c 6553 6563 6f6e 6473 290a 2020 2020  pleSeconds).    
+00014da0: 2020 2020 6966 206e 6f74 2073 7563 6365      if not succe
+00014db0: 7373 3a0a 2020 2020 2020 2020 2020 2020  ss:.            
+00014dc0: 7265 7475 726e 2046 616c 7365 2c20 6d73  return False, ms
+00014dd0: 6720 2b20 7061 7273 654d 7367 0a20 2020  g + parseMsg.   
+00014de0: 2020 2020 2073 203d 206d 6971 7463 2e50       s = miqtc.P
+00014df0: 7269 6e74 4c6f 6164 696e 674d 7367 2822  rintLoadingMsg("
+00014e00: 4372 6561 7469 6e67 2069 7465 6d73 2720  Creating items' 
+00014e10: 6174 7469 7475 6465 2064 6174 6122 290a  attitude data").
+00014e20: 0a20 2020 2020 2020 2023 2069 6e76 6572  .        # inver
+00014e30: 7420 7661 6c75 6573 2028 6966 206e 6565  t values (if nee
+00014e40: 6465 6429 2062 6566 6f72 6520 6c65 7665  ded) before leve
+00014e50: 7261 726d 2063 6f6d 7065 6e73 6174 696f  rarm compensatio
+00014e60: 6e0a 2020 2020 2020 2020 6966 2072 6563  n.        if rec
+00014e70: 6f72 6473 3262 6549 6e76 6572 7465 6420  ords2beInverted 
+00014e80: 213d 205b 5d3a 0a20 2020 2020 2020 2020  != []:.         
+00014e90: 2020 2066 6f72 2066 696c 6520 696e 2069     for file in i
+00014ea0: 6d61 6765 5f64 7473 3a0a 2020 2020 2020  mage_dts:.      
+00014eb0: 2020 2020 2020 2020 2020 6174 7469 7475            attitu
+00014ec0: 6465 7320 3d20 696d 6167 655f 6474 735b  des = image_dts[
+00014ed0: 6669 6c65 5d0a 2020 2020 2020 2020 2020  file].          
+00014ee0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00014ef0: 616e 6765 286c 656e 2861 7474 6974 7564  ange(len(attitud
+00014f00: 6573 2929 3a0a 2020 2020 2020 2020 2020  es)):.          
+00014f10: 2020 2020 2020 2020 2020 6966 2027 7961            if 'ya
+00014f20: 7727 2069 6e20 2072 6563 6f72 6473 3262  w' in  records2b
+00014f30: 6549 6e76 6572 7465 643a 0a20 2020 2020  eInverted:.     
+00014f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f50: 2020 2061 7474 6974 7564 6573 5b69 5d2e     attitudes[i].
+00014f60: 7961 7720 2a3d 202d 310a 2020 2020 2020  yaw *= -1.      
+00014f70: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00014f80: 2027 7069 7463 6827 2069 6e20 2072 6563   'pitch' in  rec
+00014f90: 6f72 6473 3262 6549 6e76 6572 7465 643a  ords2beInverted:
+00014fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014fb0: 2020 2020 2020 2020 2061 7474 6974 7564           attitud
+00014fc0: 6573 5b69 5d2e 7069 7463 6820 2a3d 202d  es[i].pitch *= -
+00014fd0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00014fe0: 2020 2020 2020 6966 2027 726f 6c6c 2720        if 'roll' 
+00014ff0: 696e 2020 7265 636f 7264 7332 6265 496e  in  records2beIn
+00015000: 7665 7274 6564 3a0a 2020 2020 2020 2020  verted:.        
+00015010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015020: 6174 7469 7475 6465 735b 695d 2e72 6f6c  attitudes[i].rol
+00015030: 6c20 2a3d 202d 310a 0a0a 2020 2020 2020  l *= -1...      
+00015040: 2020 2320 6164 6420 6361 6d65 7261 3246    # add camera2F
+00015050: 7261 6d65 2061 6e67 6c65 730a 2020 2020  rame angles.    
+00015060: 2020 2020 525f 6361 6d32 6672 616d 6520      R_cam2frame 
+00015070: 3d20 6d69 7174 672e 525f 5961 7750 6974  = miqtg.R_YawPit
+00015080: 6368 526f 6c6c 2863 616d 6572 6132 4672  chRoll(camera2Fr
+00015090: 616d 655f 7961 772c 6361 6d65 7261 3246  ame_yaw,camera2F
+000150a0: 7261 6d65 5f70 6974 6368 2c63 616d 6572  rame_pitch,camer
+000150b0: 6132 4672 616d 655f 726f 6c6c 290a 2020  a2Frame_roll).  
+000150c0: 2020 2020 2020 525f 6361 6d32 7574 6d5f        R_cam2utm_
+000150d0: 6c69 7374 203d 205b 5d0a 2020 2020 2020  list = [].      
+000150e0: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
+000150f0: 6167 655f 6474 733a 0a20 2020 2020 2020  age_dts:.       
+00015100: 2020 2020 2066 6f72 2074 696d 6570 6f69       for timepoi
+00015110: 6e74 2069 6e20 696d 6167 655f 6474 735b  nt in image_dts[
+00015120: 6669 6c65 5d3a 0a20 2020 2020 2020 2020  file]:.         
+00015130: 2020 2020 2020 2061 7474 6974 7564 6520         attitude 
+00015140: 3d20 7469 6d65 706f 696e 740a 2020 2020  = timepoint.    
+00015150: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+00015160: 7474 6974 7564 652e 7961 7720 6973 204e  ttitude.yaw is N
+00015170: 6f6e 6520 6f72 2061 7474 6974 7564 652e  one or attitude.
+00015180: 7069 7463 6820 6973 204e 6f6e 6520 6f72  pitch is None or
+00015190: 2061 7474 6974 7564 652e 726f 6c6c 2069   attitude.roll i
+000151a0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+000151b0: 2020 2020 2020 2020 2020 2020 525f 6361              R_ca
+000151c0: 6d32 7574 6d5f 6c69 7374 2e61 7070 656e  m2utm_list.appen
+000151d0: 6428 2222 290a 2020 2020 2020 2020 2020  d("").          
+000151e0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+000151f0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00015200: 2020 2052 5f66 7261 6d65 326e 6564 203d     R_frame2ned =
+00015210: 206d 6971 7467 2e52 5f59 6177 5069 7463   miqtg.R_YawPitc
+00015220: 6852 6f6c 6c28 6174 7469 7475 6465 2e79  hRoll(attitude.y
+00015230: 6177 2c61 7474 6974 7564 652e 7069 7463  aw,attitude.pitc
+00015240: 682c 6174 7469 7475 6465 2e72 6f6c 6c29  h,attitude.roll)
+00015250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015260: 2052 5f63 616d 326e 6564 203d 2052 5f66   R_cam2ned = R_f
+00015270: 7261 6d65 326e 6564 2e64 6f74 2852 5f63  rame2ned.dot(R_c
+00015280: 616d 3266 7261 6d65 290a 2020 2020 2020  am2frame).      
+00015290: 2020 2020 2020 2020 2020 7961 772c 7069            yaw,pi
+000152a0: 7463 682c 726f 6c6c 203d 206d 6971 7467  tch,roll = miqtg
+000152b0: 2e79 6177 5069 7463 6852 6f6c 6c28 525f  .yawPitchRoll(R_
+000152c0: 6361 6d32 6e65 6429 0a20 2020 2020 2020  cam2ned).       
+000152d0: 2020 2020 2020 2020 2061 7474 6974 7564           attitud
+000152e0: 652e 7961 7720 3d20 7961 770a 2020 2020  e.yaw = yaw.    
+000152f0: 2020 2020 2020 2020 2020 2020 6174 7469              atti
+00015300: 7475 6465 2e70 6974 6368 203d 2070 6974  tude.pitch = pit
+00015310: 6368 0a20 2020 2020 2020 2020 2020 2020  ch.             
+00015320: 2020 2061 7474 6974 7564 652e 726f 6c6c     attitude.roll
+00015330: 203d 2072 6f6c 6c0a 0a20 2020 2020 2020   = roll..       
+00015340: 2020 2020 2020 2020 2052 5f63 616d 5374           R_camSt
+00015350: 6432 7574 6d20 3d20 7365 6c66 2e67 6574  d2utm = self.get
+00015360: 5f52 5f63 616d 5374 6432 7574 6d28 525f  _R_camStd2utm(R_
+00015370: 6361 6d32 6672 616d 652c 525f 6672 616d  cam2frame,R_fram
+00015380: 6532 6e65 6429 0a20 2020 2020 2020 2020  e2ned).         
+00015390: 2020 2020 2020 2052 5f63 616d 3275 746d         R_cam2utm
+000153a0: 5f6c 6973 742e 6170 7065 6e64 2852 5f63  _list.append(R_c
+000153b0: 616d 5374 6432 7574 6d2e 666c 6174 7465  amStd2utm.flatte
+000153c0: 6e28 292e 746f 6c69 7374 2829 290a 0a20  n().tolist()).. 
+000153d0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+000153e0: 2e6c 6f67 2822 6170 706c 6965 6420 6672  .log("applied fr
+000153f0: 616d 6520 746f 2063 616d 6572 6120 726f  ame to camera ro
+00015400: 7461 7469 6f6e 2079 6177 2c70 6974 6368  tation yaw,pitch
+00015410: 2c72 6f6c 6c20 3d20 2220 2b20 7374 7228  ,roll = " + str(
+00015420: 6361 6d65 7261 3246 7261 6d65 5f79 6177  camera2Frame_yaw
+00015430: 2920 2b20 222c 2220 2b20 7374 7228 6361  ) + "," + str(ca
+00015440: 6d65 7261 3246 7261 6d65 5f70 6974 6368  mera2Frame_pitch
+00015450: 2920 2b20 222c 2220 2b20 7374 7228 6361  ) + "," + str(ca
+00015460: 6d65 7261 3246 7261 6d65 5f72 6f6c 6c29  mera2Frame_roll)
+00015470: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
+00015480: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+00015490: 696d 6167 655f 6474 7329 203e 2030 3a0a  image_dts) > 0:.
+000154a0: 0a20 2020 2020 2020 2020 2020 2023 2057  .            # W
+000154b0: 7269 7465 2074 6f20 6e61 7669 6761 7469  rite to navigati
+000154c0: 6f6e 2074 7874 2066 696c 650a 2020 2020  on txt file.    
+000154d0: 2020 2020 2020 2020 2320 6865 6164 6572          # header
+000154e0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+000154f0: 203d 206f 7065 6e28 696e 745f 6174 7475   = open(int_attu
+00015500: 7475 6465 5f66 696c 652c 2022 7722 290a  tude_file, "w").
+00015510: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00015520: 7772 6974 6528 6d69 7174 762e 636f 6c5f  write(miqtv.col_
+00015530: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00015540: 5b27 696d 6727 5d2b 225c 7422 2b6d 6971  ['img']+"\t"+miq
+00015550: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00015560: 6172 6971 7427 5d5b 2775 7463 275d 290a  ariqt']['utc']).
+00015570: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00015580: 7772 6974 6528 225c 7422 2b6d 6971 7476  write("\t"+miqtv
+00015590: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+000155a0: 6971 7427 5d5b 2779 6177 275d 290a 2020  iqt']['yaw']).  
+000155b0: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+000155c0: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
+000155d0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+000155e0: 7427 5d5b 2770 6974 6368 275d 290a 2020  t']['pitch']).  
+000155f0: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00015600: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
+00015610: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00015620: 7427 5d5b 2772 6f6c 6c27 5d29 0a0a 2020  t']['roll'])..  
+00015630: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00015640: 6974 6528 225c 6e22 290a 2020 2020 2020  ite("\n").      
+00015650: 2020 2020 2020 2320 6461 7461 206c 696e        # data lin
+00015660: 6573 0a20 2020 2020 2020 2020 2020 2066  es.            f
+00015670: 6f72 2066 696c 6520 696e 2069 6d61 6765  or file in image
+00015680: 5f64 7473 3a0a 2020 2020 2020 2020 2020  _dts:.          
+00015690: 2020 2020 2020 666f 7220 7469 6d65 706f        for timepo
+000156a0: 696e 7420 696e 2069 6d61 6765 5f64 7473  int in image_dts
+000156b0: 5b66 696c 655d 3a0a 2020 2020 2020 2020  [file]:.        
+000156c0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+000156d0: 7772 6974 6528 6669 6c65 2b22 5c74 222b  write(file+"\t"+
+000156e0: 7469 6d65 706f 696e 742e 6461 7465 5469  timepoint.dateTi
+000156f0: 6d65 2829 2e73 7472 6674 696d 6528 6d69  me().strftime(mi
+00015700: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
+00015710: 5b27 6d61 7269 7174 275d 2929 200a 2020  ['mariqt'])) .  
+00015720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015730: 2020 7661 6c20 3d20 7469 6d65 706f 696e    val = timepoin
+00015740: 742e 7961 770a 2020 2020 2020 2020 2020  t.yaw.          
+00015750: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00015760: 6974 6528 225c 7422 2b73 7472 2876 616c  ite("\t"+str(val
+00015770: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00015780: 2020 2020 2020 2076 616c 203d 2074 696d         val = tim
+00015790: 6570 6f69 6e74 2e70 6974 6368 0a20 2020  epoint.pitch.   
+000157a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000157b0: 2072 6573 2e77 7269 7465 2822 5c74 222b   res.write("\t"+
+000157c0: 7374 7228 7661 6c29 290a 2020 2020 2020  str(val)).      
+000157d0: 2020 2020 2020 2020 2020 2020 2020 7661                va
+000157e0: 6c20 3d20 7469 6d65 706f 696e 742e 726f  l = timepoint.ro
+000157f0: 6c6c 0a20 2020 2020 2020 2020 2020 2020  ll.             
+00015800: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00015810: 2822 5c74 222b 7374 7228 7661 6c29 290a  ("\t"+str(val)).
+00015820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015830: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
+00015840: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+00015850: 7265 732e 636c 6f73 6528 290a 0a20 2020  res.close()..   
+00015860: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+00015870: 6f76 2e61 6464 4172 6775 6d65 6e74 2822  ov.addArgument("
+00015880: 696e 7075 7441 7474 6974 7564 6546 696c  inputAttitudeFil
+00015890: 6522 2c61 7474 5f70 6174 682c 6f76 6572  e",att_path,over
+000158a0: 7772 6974 653d 5472 7565 290a 2020 2020  write=True).    
+000158b0: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+000158c0: 762e 6c6f 6728 2270 6172 7365 6420 6672  v.log("parsed fr
+000158d0: 6f6d 2069 6e70 7574 4174 7469 7475 6465  om inputAttitude
+000158e0: 4669 6c65 3a20 2220 2b20 7374 7228 6672  File: " + str(fr
+000158f0: 616d 655f 6174 745f 6865 6164 6572 292c  ame_att_header),
+00015900: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
+00015910: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00015920: 6164 645f 6974 656d 5f69 6e66 6f5f 7461  add_item_info_ta
+00015930: 625f 6669 6c65 2869 6e74 5f61 7474 7574  b_file(int_attut
+00015940: 7564 655f 6669 6c65 2c22 5c74 222c 6f75  ude_file,"\t",ou
+00015950: 7470 7574 5f68 6561 6465 725f 6174 7429  tput_header_att)
+00015960: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00015970: 5772 6974 6520 746f 2070 6f73 6520 7478  Write to pose tx
+00015980: 7420 6669 6c65 0a20 2020 2020 2020 2020  t file.         
+00015990: 2020 2023 2068 6561 6465 720a 2020 2020     # header.    
+000159a0: 2020 2020 2020 2020 7265 7320 3d20 6f70          res = op
+000159b0: 656e 2869 6e74 5f70 6f73 655f 6669 6c65  en(int_pose_file
+000159c0: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
+000159d0: 2020 2072 6573 2e77 7269 7465 286d 6971     res.write(miq
+000159e0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+000159f0: 6172 6971 7427 5d5b 2769 6d67 275d 2b22  ariqt']['img']+"
+00015a00: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
+00015a10: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00015a20: 7574 6327 5d29 0a20 2020 2020 2020 2020  utc']).         
+00015a30: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
+00015a40: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
+00015a50: 6572 5b27 6d61 7269 7174 275d 5b27 706f  er['mariqt']['po
+00015a60: 7365 275d 290a 2020 2020 2020 2020 2020  se']).          
+00015a70: 2020 7265 732e 7772 6974 6528 225c 6e22    res.write("\n"
+00015a80: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+00015a90: 6461 7461 206c 696e 6573 0a20 2020 2020  data lines.     
+00015aa0: 2020 2020 2020 2069 203d 2030 0a20 2020         i = 0.   
+00015ab0: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
+00015ac0: 6520 696e 2069 6d61 6765 5f64 7473 3a0a  e in image_dts:.
+00015ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015ae0: 666f 7220 7469 6d65 706f 696e 7420 696e  for timepoint in
+00015af0: 2069 6d61 6765 5f64 7473 5b66 696c 655d   image_dts[file]
+00015b00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015b10: 2020 2020 2020 6966 2052 5f63 616d 3275        if R_cam2u
+00015b20: 746d 5f6c 6973 745b 695d 203d 3d20 2222  tm_list[i] == ""
+00015b30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015b40: 2020 2020 2020 2020 2020 6920 2b3d 2031            i += 1
+00015b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015b60: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00015b70: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00015b80: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00015b90: 6669 6c65 2b22 5c74 222b 7469 6d65 706f  file+"\t"+timepo
+00015ba0: 696e 742e 6461 7465 5469 6d65 2829 2e73  int.dateTime().s
+00015bb0: 7472 6674 696d 6528 6d69 7174 762e 6461  trftime(miqtv.da
+00015bc0: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
+00015bd0: 7174 275d 2929 200a 2020 2020 2020 2020  qt'])) .        
+00015be0: 2020 2020 2020 2020 2020 2020 656e 7472              entr
+00015bf0: 7920 3d20 7374 7228 7b27 706f 7365 2d61  y = str({'pose-a
+00015c00: 6273 6f6c 7574 652d 6f72 6965 6e74 6174  bsolute-orientat
+00015c10: 696f 6e2d 7574 6d2d 6d61 7472 6978 273a  ion-utm-matrix':
+00015c20: 525f 6361 6d32 7574 6d5f 6c69 7374 5b69  R_cam2utm_list[i
+00015c30: 5d7d 292e 7265 706c 6163 6528 275c 6e27  ]}).replace('\n'
+00015c40: 2c27 2729 0a20 2020 2020 2020 2020 2020  ,'').           
+00015c50: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
+00015c60: 7465 2822 5c74 222b 656e 7472 7929 0a20  te("\t"+entry). 
+00015c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c80: 2020 2069 202b 3d20 310a 2020 2020 2020     i += 1.      
+00015c90: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00015ca0: 732e 7772 6974 6528 225c 6e22 290a 2020  s.write("\n").  
+00015cb0: 2020 2020 2020 2020 2020 7265 732e 636c            res.cl
+00015cc0: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
+00015cd0: 2020 7365 6c66 2e61 6464 5f69 7465 6d5f    self.add_item_
+00015ce0: 696e 666f 5f74 6162 5f66 696c 6528 696e  info_tab_file(in
+00015cf0: 745f 706f 7365 5f66 696c 652c 225c 7422  t_pose_file,"\t"
+00015d00: 2c6f 7574 7075 745f 6865 6164 6572 5f70  ,output_header_p
+00015d10: 6f73 6529 0a20 2020 2020 2020 2020 2020  ose).           
+00015d20: 2073 2e73 746f 7028 290a 2020 2020 2020   s.stop().      
+00015d30: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00015d40: 652c 2022 4174 7469 7475 6465 2064 6174  e, "Attitude dat
+00015d50: 6120 6372 6561 7465 6422 202b 2070 6172  a created" + par
+00015d60: 7365 4d73 670a 2020 2020 2020 2020 656c  seMsg.        el
+00015d70: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00015d80: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
+00015d90: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00015da0: 652c 2022 4e6f 2069 6d61 6765 2061 7474  e, "No image att
+00015db0: 6974 7564 6573 2066 6f75 6e64 2220 2b20  itudes found" + 
+00015dc0: 7061 7273 654d 7367 0a20 2020 2020 2020  parseMsg.       
+00015dd0: 200a 2020 2020 2020 2020 0a20 2020 2064   .        .    d
+00015de0: 6566 2063 7265 6174 6549 6d61 6765 4174  ef createImageAt
+00015df0: 7469 7475 6465 4669 6c65 2873 656c 662c  titudeFile(self,
+00015e00: 2061 7474 5f70 6174 683a 7374 722c 2066   att_path:str, f
+00015e10: 7261 6d65 5f61 7474 5f68 6561 6465 723a  rame_att_header:
+00015e20: 6469 6374 2c20 6361 6d65 7261 3246 7261  dict, camera2Fra
+00015e30: 6d65 5f79 6177 3a66 6c6f 6174 2c63 616d  me_yaw:float,cam
+00015e40: 6572 6132 4672 616d 655f 7069 7463 683a  era2Frame_pitch:
+00015e50: 666c 6f61 742c 6361 6d65 7261 3246 7261  float,camera2Fra
+00015e60: 6d65 5f72 6f6c 6c3a 666c 6f61 742c 0a20  me_roll:float,. 
+00015e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e80: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00015e90: 6174 655f 666f 726d 6174 3d6d 6971 7476  ate_format=miqtv
+00015ea0: 2e64 6174 655f 666f 726d 6174 735b 2770  .date_formats['p
+00015eb0: 616e 6761 6561 275d 2c20 636f 6e73 745f  angaea'], const_
+00015ec0: 7661 6c75 6573 203d 207b 7d2c 206f 7665  values = {}, ove
+00015ed0: 7277 7269 7465 3d46 616c 7365 2c20 636f  rwrite=False, co
+00015ee0: 6c5f 7365 7061 7261 746f 7220 3d20 225c  l_separator = "\
+00015ef0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
+00015f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f10: 2020 2020 6174 745f 7061 7468 5f61 6e67      att_path_ang
+00015f20: 6c65 735f 696e 5f72 6164 203d 2046 616c  les_in_rad = Fal
+00015f30: 7365 2c20 7669 6465 6f53 616d 706c 6553  se, videoSampleS
+00015f40: 6563 6f6e 6473 3d31 2c72 6563 6f72 6473  econds=1,records
+00015f50: 3262 6549 6e76 6572 7465 643d 5b5d 293a  2beInverted=[]):
+00015f60: 0a20 2020 2020 2020 2022 2222 2044 6570  .        """ Dep
+00015f70: 7265 6361 7464 6520 2d20 7573 6520 6372  recatde - use cr
+00015f80: 6561 7465 5f69 6d61 6765 5f61 7474 6974  eate_image_attit
+00015f90: 7564 655f 6669 6c65 2022 2222 0a20 2020  ude_file """.   
+00015fa0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00015fb0: 2e63 7265 6174 655f 696d 6167 655f 6174  .create_image_at
+00015fc0: 7469 7475 6465 5f66 696c 6528 6174 745f  titude_file(att_
+00015fd0: 7061 7468 2c20 6672 616d 655f 6174 745f  path, frame_att_
+00015fe0: 6865 6164 6572 2c20 6361 6d65 7261 3246  header, camera2F
+00015ff0: 7261 6d65 5f79 6177 2c20 6361 6d65 7261  rame_yaw, camera
+00016000: 3246 7261 6d65 5f70 6974 6368 2c20 6361  2Frame_pitch, ca
+00016010: 6d65 7261 3246 7261 6d65 5f72 6f6c 6c2c  mera2Frame_roll,
+00016020: 200a 2020 2020 2020 2020 2020 2020 2020   .              
 00016030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016040: 2064 6174 655f 666f 726d 6174 2c20 636f   date_format, co
-00016050: 6e73 745f 7661 6c75 6573 2c20 6f76 6572  nst_values, over
-00016060: 7772 6974 652c 2063 6f6c 5f73 6570 6172  write, col_separ
-00016070: 6174 6f72 2c20 6174 745f 7061 7468 5f61  ator, att_path_a
-00016080: 6e67 6c65 735f 696e 5f72 6164 2c20 7669  ngles_in_rad, vi
-00016090: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
-000160a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000160b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016050: 2064 6174 655f 666f 726d 6174 2c20 636f   date_format, co
+00016060: 6e73 745f 7661 6c75 6573 2c20 6f76 6572  nst_values, over
+00016070: 7772 6974 652c 2063 6f6c 5f73 6570 6172  write, col_separ
+00016080: 6174 6f72 2c20 6174 745f 7061 7468 5f61  ator, att_path_a
+00016090: 6e67 6c65 735f 696e 5f72 6164 2c20 7669  ngles_in_rad, vi
+000160a0: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
+000160b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 000160c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000160d0: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
-000160e0: 7465 6429 0a20 2020 2020 2020 200a 0a20  ted).        .. 
-000160f0: 2020 2064 6566 2067 6574 5f52 5f63 616d     def get_R_cam
-00016100: 5374 6432 7574 6d28 7365 6c66 2c52 5f63  Std2utm(self,R_c
-00016110: 616d 3266 7261 6d65 3a6e 702e 6172 7261  am2frame:np.arra
-00016120: 792c 525f 6672 616d 6532 6e65 643a 6e70  y,R_frame2ned:np
-00016130: 2e61 7272 6179 293a 0a20 2020 2020 2020  .array):.       
-00016140: 2022 2222 2072 6574 7275 6e20 726f 7461   """ retrun rota
-00016150: 7469 6f6e 206d 6174 7269 7820 5220 7472  tion matrix R tr
-00016160: 616e 666f 726d 696e 6720 6672 6f6d 2063  anforming from c
-00016170: 616d 5374 643a 2028 782c 792c 7a20 3d20  amStd: (x,y,z = 
-00016180: 7269 6768 742c 6275 7474 6f6d 2c6c 696e  right,buttom,lin
-00016190: 6520 6f66 2073 6967 6874 2920 746f 2075  e of sight) to u
-000161a0: 746d 2028 782c 792c 7a20 3d20 6561 7374  tm (x,y,z = east
-000161b0: 696e 672c 6e6f 7274 6869 6e67 2c75 7029  ing,northing,up)
-000161c0: 2022 2222 0a20 2020 2020 2020 2052 5f63   """.        R_c
-000161d0: 616d 6946 444f 3263 616d 5374 6420 3d20  amiFDO2camStd = 
-000161e0: 6d69 7174 672e 525f 5961 7750 6974 6368  miqtg.R_YawPitch
-000161f0: 526f 6c6c 2839 302c 302c 3029 2023 2069  Roll(90,0,0) # i
-00016200: 6e20 6946 444f 2063 616d 3a20 2878 2c79  n iFDO cam: (x,y
-00016210: 2c7a 203d 2074 6f70 2c72 6967 6874 2c6c  ,z = top,right,l
-00016220: 696e 6520 6f66 2073 6967 6874 2920 6275  ine of sight) bu
-00016230: 7420 666f 7220 706f 7365 2074 6865 2027  t for pose the '
-00016240: 7374 616e 6461 7264 2720 6361 6d53 7464  standard' camStd
-00016250: 3a20 2878 2c79 2c7a 203d 2072 6967 6874  : (x,y,z = right
-00016260: 2c62 7574 746f 6d2c 6c69 6e65 206f 6620  ,buttom,line of 
-00016270: 7369 6768 7429 2069 7320 6578 7065 6374  sight) is expect
-00016280: 6564 0a20 2020 2020 2020 2052 5f63 616d  ed.        R_cam
-00016290: 5374 6432 6672 616d 6520 3d20 525f 6361  Std2frame = R_ca
-000162a0: 6d32 6672 616d 652e 646f 7428 525f 6361  m2frame.dot(R_ca
-000162b0: 6d69 4644 4f32 6361 6d53 7464 290a 2020  miFDO2camStd).  
-000162c0: 2020 2020 2020 525f 6361 6d53 7464 326e        R_camStd2n
-000162d0: 6564 203d 2052 5f66 7261 6d65 326e 6564  ed = R_frame2ned
-000162e0: 2e64 6f74 2852 5f63 616d 5374 6432 6672  .dot(R_camStd2fr
-000162f0: 616d 6529 0a20 2020 2020 2020 2052 5f6e  ame).        R_n
-00016300: 6564 3275 746d 203d 206d 6971 7467 2e52  ed2utm = miqtg.R
-00016310: 5f58 595a 2831 3830 2c30 2c39 3029 2023  _XYZ(180,0,90) #
-00016320: 2077 6974 6820 7574 6d20 782c 792c 7a20   with utm x,y,z 
-00016330: 3d20 6561 7374 696e 672c 6e6f 7274 6869  = easting,northi
-00016340: 6e67 2c75 700a 2020 2020 2020 2020 525f  ng,up.        R_
-00016350: 6361 6d53 7464 3275 746d 203d 2052 5f6e  camStd2utm = R_n
-00016360: 6564 3275 746d 2e64 6f74 2852 5f63 616d  ed2utm.dot(R_cam
-00016370: 5374 6432 6e65 6429 2e72 6f75 6e64 2835  Std2ned).round(5
-00016380: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00016390: 2052 5f63 616d 5374 6432 7574 6d0a 0a0a   R_camStd2utm...
-000163a0: 2020 2020 6465 6620 6669 6e64 4e61 7644      def findNavD
-000163b0: 6174 6146 6f72 496d 6167 6528 7365 6c66  ataForImage(self
-000163c0: 2c64 6174 613a 6d69 7174 672e 4e75 6d44  ,data:miqtg.NumD
-000163d0: 6174 6154 696d 6553 7461 6d70 6564 2c76  ataTimeStamped,v
-000163e0: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
-000163f0: 733d 3129 3a0a 2020 2020 2020 2020 2222  s=1):.        ""
-00016400: 2220 6372 6561 7465 7320 6120 6469 6374  " creates a dict
-00016410: 2028 696d 6167 655f 6474 7329 2077 6974   (image_dts) wit
-00016420: 6820 6669 6c65 206e 616d 6520 6173 206b  h file name as k
-00016430: 6579 2061 6e64 2061 206c 6973 7420 6f66  ey and a list of
-00016440: 2064 6174 6120 656c 656d 656e 7473 2061   data elements a
-00016450: 7320 7661 6c75 652e 200a 2020 2020 2020  s value. .      
-00016460: 2020 2020 2020 496e 2063 6173 6520 6f66        In case of
-00016470: 2070 686f 746f 7320 7468 6520 6c69 7374   photos the list
-00016480: 2068 6173 206f 6e6c 7920 6120 7369 6e67   has only a sing
-00016490: 6c65 2065 6e74 7279 2c20 666f 7220 7669  le entry, for vi
-000164a0: 6465 6f73 2069 7420 6861 7320 7669 6465  deos it has vide
-000164b0: 6f20 6475 7261 7469 6f6e 205b 7365 635d  o duration [sec]
-000164c0: 202f 2076 6964 656f 5361 6d70 6c65 5365   / videoSampleSe
-000164d0: 636f 6e64 7320 656e 7472 6965 732e 0a20  conds entries.. 
-000164e0: 2020 2020 2020 2020 2020 2052 6574 7572             Retur
-000164f0: 6e73 2073 7563 6365 7373 2c20 696d 6167  ns success, imag
-00016500: 655f 6474 732c 206d 7367 2022 2222 0a0a  e_dts, msg """..
-00016510: 2020 2020 2020 2020 6966 2076 6964 656f          if video
-00016520: 5361 6d70 6c65 5365 636f 6e64 7320 3c3d  SampleSeconds <=
-00016530: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00016540: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-00016550: 2266 696e 644e 6176 4461 7461 466f 7249  "findNavDataForI
-00016560: 6d61 6765 3a20 7669 6465 6f53 616d 706c  mage: videoSampl
-00016570: 6553 6563 6f6e 6473 206d 7573 7420 6265  eSeconds must be
-00016580: 2067 7265 6174 6572 2030 2229 0a0a 2020   greater 0")..  
-00016590: 2020 2020 2020 2320 6372 6561 7465 2073        # create s
-000165a0: 6f72 7465 6420 7469 6d65 2070 6f69 6e74  orted time point
-000165b0: 730a 2020 2020 2020 2020 7469 6d65 5f70  s.        time_p
-000165c0: 6f69 6e74 7320 3d20 6c69 7374 2864 6174  oints = list(dat
-000165d0: 612e 6b65 7973 2829 290a 2020 2020 2020  a.keys()).      
-000165e0: 2020 7469 6d65 5f70 6f69 6e74 732e 736f    time_points.so
-000165f0: 7274 2829 0a20 2020 2020 2020 2075 6e6d  rt().        unm
-00016600: 6174 6368 6564 5469 6d65 506f 696e 7473  atchedTimePoints
-00016610: 203d 205b 5d0a 2020 2020 2020 2020 696d   = [].        im
-00016620: 6167 655f 6474 7320 3d20 7b7d 0a20 2020  age_dts = {}.   
-00016630: 2020 2020 2073 7461 7274 5365 6172 6368       startSearch
-00016640: 496e 6465 7820 3d20 300a 2020 2020 2020  Index = 0.      
-00016650: 2020 696d 6167 6573 496e 5261 7720 3d20    imagesInRaw = 
-00016660: 2073 656c 662e 696d 6167 6573 496e 496d   self.imagesInIm
-00016670: 6167 6573 4469 7228 290a 2020 2020 2020  agesDir().      
-00016680: 2020 696d 6167 6573 496e 5261 7753 6f72    imagesInRawSor
-00016690: 7465 644c 6973 7420 3d20 7365 6c66 2e69  tedList = self.i
-000166a0: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
-000166b0: 536f 7274 6564 4c69 7374 2829 0a20 2020  SortedList().   
-000166c0: 2020 2020 2070 726f 6720 3d20 6d69 7174       prog = miqt
-000166d0: 632e 5072 696e 744b 6e6f 776e 5072 6f67  c.PrintKnownProg
-000166e0: 7265 7373 4d73 6728 2249 6e74 6572 706f  ressMsg("Interpo
-000166f0: 6c61 7469 6e67 206e 6176 6967 6174 696f  lating navigatio
-00016700: 6e20 666f 7220 696d 6167 6522 2c20 6c65  n for image", le
-00016710: 6e28 696d 6167 6573 496e 5261 7729 2c6d  n(imagesInRaw),m
-00016720: 6f64 756c 6f3d 3129 0a20 2020 2020 2020  odulo=1).       
-00016730: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
-00016740: 6765 7349 6e52 6177 536f 7274 6564 4c69  gesInRawSortedLi
-00016750: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-00016760: 7072 6f67 2e70 726f 6772 6573 7328 290a  prog.progress().
-00016770: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00016780: 5f6e 616d 6520 3d20 6f73 2e70 6174 682e  _name = os.path.
-00016790: 6261 7365 6e61 6d65 2866 696c 6529 0a0a  basename(file)..
-000167a0: 2020 2020 2020 2020 2020 2020 6474 5f69              dt_i
-000167b0: 6d61 6765 203d 206d 6971 7463 2e70 6172  mage = miqtc.par
-000167c0: 7365 4669 6c65 4461 7465 5469 6d65 4173  seFileDateTimeAs
-000167d0: 5554 4328 6669 6c65 5f6e 616d 6529 0a20  UTC(file_name). 
-000167e0: 2020 2020 2020 2020 2020 2064 745f 696d             dt_im
-000167f0: 6167 655f 7473 203d 2069 6e74 2864 745f  age_ts = int(dt_
-00016800: 696d 6167 652e 7469 6d65 7374 616d 7028  image.timestamp(
-00016810: 2920 2a20 3130 3030 290a 0a20 2020 2020  ) * 1000)..     
-00016820: 2020 2020 2020 2072 756e 5469 6d65 203d         runTime =
-00016830: 2069 6d61 6765 7349 6e52 6177 5b66 696c   imagesInRaw[fil
-00016840: 655d 5b31 5d20 2320 2d31 2066 6f72 2070  e][1] # -1 for p
-00016850: 686f 746f 730a 2020 2020 2020 2020 2020  hotos.          
-00016860: 2020 2320 7669 6465 6f0a 2020 2020 2020    # video.      
-00016870: 2020 2020 2020 6966 2069 6d61 6765 7349        if imagesI
-00016880: 6e52 6177 5b66 696c 655d 5b32 5d20 696e  nRaw[file][2] in
-00016890: 206d 6971 7476 2e76 6964 656f 5f74 7970   miqtv.video_typ
-000168a0: 6573 2061 6e64 2072 756e 5469 6d65 203c  es and runTime <
-000168b0: 3d20 303a 2023 2065 7874 0a20 2020 2020  = 0: # ext.     
-000168c0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000168d0: 2822 4361 7574 696f 6e21 2043 6f75 6c64  ("Caution! Could
-000168e0: 206e 6f74 2072 6561 6420 7669 6465 6f20   not read video 
-000168f0: 7275 6e20 7469 6d65 2066 726f 6d20 6669  run time from fi
-00016900: 6c65 222c 6669 6c65 2920 2320 544f 444f  le",file) # TODO
-00016910: 2064 6f65 7320 7468 6973 2068 6170 7065   does this happe
-00016920: 6e3f 2048 616e 646c 6520 6265 7474 6572  n? Handle better
-00016930: 3f0a 0a20 2020 2020 2020 2020 2020 2073  ?..            s
-00016940: 616d 706c 6554 696d 6553 6563 7320 3d20  ampleTimeSecs = 
-00016950: 300a 2020 2020 2020 2020 2020 2020 706f  0.            po
-00016960: 735f 6c69 7374 203d 205b 5d0a 2020 2020  s_list = [].    
-00016970: 2020 2020 2020 2020 676f 203d 2054 7275          go = Tru
-00016980: 650a 2020 2020 2020 2020 2020 2020 7768  e.            wh
-00016990: 696c 6520 676f 3a0a 2020 2020 2020 2020  ile go:.        
-000169a0: 2020 2020 2020 2020 7472 793a 2020 2020          try:    
-000169b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000169c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000169d0: 2020 2020 2070 6f73 2c20 7374 6172 7453       pos, startS
-000169e0: 6561 7263 6849 6e64 6578 203d 2064 6174  earchIndex = dat
-000169f0: 612e 696e 7465 7270 6f6c 6174 6541 7454  a.interpolateAtT
-00016a00: 696d 6528 6474 5f69 6d61 6765 5f74 7320  ime(dt_image_ts 
-00016a10: 2b20 7361 6d70 6c65 5469 6d65 5365 6373  + sampleTimeSecs
-00016a20: 202a 2031 3030 302c 7469 6d65 5f70 6f69   * 1000,time_poi
-00016a30: 6e74 732c 7374 6172 7453 6561 7263 6849  nts,startSearchI
-00016a40: 6e64 6578 290a 2020 2020 2020 2020 2020  ndex).          
-00016a50: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00016a60: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00016a70: 2069 6e74 6572 706f 6c61 7465 4174 5469   interpolateAtTi
-00016a80: 6d65 2072 6574 7572 6e73 204e 6f6e 6520  me returns None 
-00016a90: 7661 6c75 6573 2069 6620 7469 6d65 206f  values if time o
-00016aa0: 7574 206f 6620 7261 6e67 650a 2020 2020  ut of range.    
-00016ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ac0: 6966 2070 6f73 2e63 6f74 6169 6e73 4e6f  if pos.cotainsNo
-00016ad0: 6e65 5661 6c75 6573 496e 5265 7175 6972  neValuesInRequir
-00016ae0: 6564 4669 656c 6473 2829 3a0a 2020 2020  edFields():.    
-00016af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b00: 2020 2020 756e 6d61 7463 6865 6454 696d      unmatchedTim
-00016b10: 6550 6f69 6e74 732e 6170 7065 6e64 2828  ePoints.append((
-00016b20: 6474 5f69 6d61 6765 5f74 7320 2b20 7361  dt_image_ts + sa
-00016b30: 6d70 6c65 5469 6d65 5365 6373 202a 2031  mpleTimeSecs * 1
-00016b40: 3030 3029 2f31 3030 3029 0a20 2020 2020  000)/1000).     
-00016b50: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00016b60: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00016b70: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
-00016b80: 5f6c 6973 742e 6170 7065 6e64 2870 6f73  _list.append(pos
-00016b90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00016ba0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-00016bb0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-00016bc0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00016bd0: 7572 6e20 4661 6c73 652c 2069 6d61 6765  urn False, image
-00016be0: 5f64 7473 2c20 2243 6f75 6c64 206e 6f74  _dts, "Could not
-00016bf0: 2066 696e 6420 696d 6167 6520 7469 6d65   find image time
-00016c00: 2022 2b20 6461 7465 7469 6d65 2e64 6174   "+ datetime.dat
-00016c10: 6574 696d 652e 7574 6366 726f 6d74 696d  etime.utcfromtim
-00016c20: 6573 7461 6d70 2828 6474 5f69 6d61 6765  estamp((dt_image
-00016c30: 5f74 7320 2b20 7361 6d70 6c65 5469 6d65  _ts + sampleTime
-00016c40: 5365 6373 202a 2031 3030 3029 2f31 3030  Secs * 1000)/100
-00016c50: 3029 2e73 7472 6674 696d 6528 6d69 7174  0).strftime(miqt
-00016c60: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-00016c70: 6d61 7269 7174 275d 2920 2b22 2069 6e20  mariqt']) +" in 
-00016c80: 222b 7374 7228 6461 7461 2e6c 656e 2829  "+str(data.len()
-00016c90: 292b 2220 6461 7461 2070 6f73 6974 696f  )+" data positio
-00016ca0: 6e73 2220 2b20 7374 7228 652e 6172 6773  ns" + str(e.args
-00016cb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00016cc0: 2020 7361 6d70 6c65 5469 6d65 5365 6373    sampleTimeSecs
-00016cd0: 202b 3d20 7669 6465 6f53 616d 706c 6553   += videoSampleS
-00016ce0: 6563 6f6e 6473 0a20 2020 2020 2020 2020  econds.         
-00016cf0: 2020 2020 2020 2069 6620 7361 6d70 6c65         if sample
-00016d00: 5469 6d65 5365 6373 203e 2072 756e 5469  TimeSecs > runTi
-00016d10: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
-00016d20: 2020 2020 2020 2020 676f 203d 2046 616c          go = Fal
-00016d30: 7365 0a20 2020 2020 2020 2020 2020 200a  se.            .
-00016d40: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-00016d50: 655f 6474 735b 6669 6c65 5f6e 616d 655d  e_dts[file_name]
-00016d60: 203d 2070 6f73 5f6c 6973 740a 2020 2020   = pos_list.    
-00016d70: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
-00016d80: 0a20 2020 2020 2020 2072 6574 7572 6e4d  .        returnM
-00016d90: 7367 203d 2022 220a 2020 2020 2020 2020  sg = "".        
-00016da0: 6966 206c 656e 2875 6e6d 6174 6368 6564  if len(unmatched
-00016db0: 5469 6d65 506f 696e 7473 2920 213d 2030  TimePoints) != 0
-00016dc0: 3a0a 2020 2020 2020 2020 2020 2020 756e  :.            un
-00016dd0: 6d61 7463 6865 6454 696d 6550 6f69 6e74  matchedTimePoint
-00016de0: 732e 736f 7274 2829 0a20 2020 2020 2020  s.sort().       
-00016df0: 2020 2020 2075 6e6d 6174 6368 6564 5469       unmatchedTi
-00016e00: 6d65 506f 696e 7473 203d 205b 6461 7465  mePoints = [date
-00016e10: 7469 6d65 2e64 6174 6574 696d 652e 7574  time.datetime.ut
-00016e20: 6366 726f 6d74 696d 6573 7461 6d70 2874  cfromtimestamp(t
-00016e30: 7329 2e73 7472 6674 696d 6528 6d69 7174  s).strftime(miqt
-00016e40: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-00016e50: 6d61 7269 7174 275d 2920 666f 7220 7473  mariqt']) for ts
-00016e60: 2069 6e20 756e 6d61 7463 6865 6454 696d   in unmatchedTim
-00016e70: 6550 6f69 6e74 735d 0a20 2020 2020 2020  ePoints].       
-00016e80: 2020 2020 2072 6574 7572 6e4d 7367 203d       returnMsg =
-00016e90: 2022 4361 7574 696f 6e21 204e 6176 6967   "Caution! Navig
-00016ea0: 6174 696f 6e20 6e6f 7420 666f 756e 6420  ation not found 
-00016eb0: 666f 7220 7468 6520 666f 6c6c 6f77 696e  for the followin
-00016ec0: 6720 696d 6167 6520 7469 6d65 2070 6f69  g image time poi
-00016ed0: 6e74 732e 2044 6f75 626c 6520 6368 6563  nts. Double chec
-00016ee0: 6b20 6f72 2070 726f 7669 6465 2061 7420  k or provide at 
-00016ef0: 6c65 6173 7420 7374 6174 6963 2064 6566  least static def
-00016f00: 6175 6c74 206e 6176 6967 6174 696f 6e20  ault navigation 
-00016f10: 696e 2068 6561 6465 7220 6669 656c 6473  in header fields
-00016f20: 2e22 0a20 2020 2020 2020 2020 2020 2072  .".            r
-00016f30: 6574 7572 6e4d 7367 202b 3d20 225c 6e22  eturnMsg += "\n"
-00016f40: 202b 2022 5c6e 222e 6a6f 696e 2875 6e6d   + "\n".join(unm
-00016f50: 6174 6368 6564 5469 6d65 506f 696e 7473  atchedTimePoints
-00016f60: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00016f70: 2054 7275 652c 2069 6d61 6765 5f64 7473   True, image_dts
-00016f80: 2c20 7265 7475 726e 4d73 670a 0a0a 2020  , returnMsg...  
-00016f90: 2020 6465 6620 6372 6561 7465 5f69 6d61    def create_ima
-00016fa0: 6765 5f6e 6176 6967 6174 696f 6e5f 6669  ge_navigation_fi
-00016fb0: 6c65 2873 656c 662c 206e 6176 5f70 6174  le(self, nav_pat
-00016fc0: 683a 2073 7472 2c20 6e61 765f 6865 6164  h: str, nav_head
-00016fd0: 6572 3d6d 6971 7476 2e70 6f73 5f68 6561  er=miqtv.pos_hea
-00016fe0: 6465 725b 2770 616e 6761 6561 275d 2c20  der['pangaea'], 
-00016ff0: 6461 7465 5f66 6f72 6d61 743d 6d69 7174  date_format=miqt
-00017000: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-00017010: 7061 6e67 6165 6127 5d2c 206f 7665 7277  pangaea'], overw
-00017020: 7269 7465 3d46 616c 7365 2c20 636f 6c5f  rite=False, col_
-00017030: 7365 7061 7261 746f 7220 3d20 225c 7422  separator = "\t"
-00017040: 2c20 7669 6465 6f53 616d 706c 6553 6563  , videoSampleSec
-00017050: 6f6e 6473 3d31 2c0a 2020 2020 2020 2020  onds=1,.        
-00017060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017070: 2020 2020 2020 2020 2020 2020 6f66 6673              offs
-00017080: 6574 5f78 3d30 2c20 6f66 6673 6574 5f79  et_x=0, offset_y
-00017090: 3d30 2c20 6f66 6673 6574 5f7a 3d30 2c61  =0, offset_z=0,a
-000170a0: 6e67 6c65 735f 696e 5f72 6164 203d 2046  ngles_in_rad = F
-000170b0: 616c 7365 2c20 7265 636f 7264 7332 6265  alse, records2be
-000170c0: 496e 7665 7274 6564 3d5b 5d29 3a0a 2020  Inverted=[]):.  
-000170d0: 2020 2020 2020 2222 2220 4372 6561 7465        """ Create
-000170e0: 7320 696e 202f 696e 7465 726d 6564 6961  s in /intermedia
-000170f0: 7465 2061 2074 6578 7420 6669 6c65 2077  te a text file w
-00017100: 6974 6820 342e 3544 206e 6176 6967 6174  ith 4.5D navigat
-00017110: 696f 6e20 6461 7461 2066 6f72 2065 6163  ion data for eac
-00017120: 6820 696d 6167 652c 2069 2e65 2e20 6120  h image, i.e. a 
-00017130: 7369 6e67 6c65 2072 6f77 2070 6572 2070  single row per p
-00017140: 686f 746f 2c20 7669 6465 6f20 6475 7261  hoto, video dura
-00017150: 7469 6f6e 205b 7365 635d 202f 2076 6964  tion [sec] / vid
-00017160: 656f 5361 6d70 6c65 5365 636f 6e64 7320  eoSampleSeconds 
-00017170: 726f 7773 2070 6572 2076 6964 656f 2e0a  rows per video..
-00017180: 2020 2020 2020 2020 2020 2020 6e61 765f              nav_
-00017190: 6865 6164 6572 206d 7573 7420 6265 2064  header must be d
-000171a0: 6963 7420 636f 6e74 6169 6e69 6e67 2074  ict containing t
-000171b0: 6865 206b 6579 7320 2775 7463 272c 276c  he keys 'utc','l
-000171c0: 6174 272c 276c 6f6e 272c 2764 6570 2728  at','lon','dep'(
-000171d0: 6f72 2027 616c 7427 292c 206f 7074 696f  or 'alt'), optio
-000171e0: 6e61 6c3a 2027 6867 7427 2c27 756e 6365  nal: 'hgt','unce
-000171f0: 7274 2720 7769 7468 2074 6865 2072 6573  rt' with the res
-00017200: 7065 6374 6976 6520 636f 6c75 6d6e 2068  pective column h
-00017210: 6561 6465 7273 2061 7320 7661 6c75 6573  eaders as values
-00017220: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
-00017230: 206f 6e65 206f 6620 7468 6520 7665 6869   one of the vehi
-00017240: 636c 6520 782c 792c 7a20 6f66 6673 6574  cle x,y,z offset
-00017250: 7320 5b6d 5d20 6973 206e 6f74 2030 2061  s [m] is not 0 a
-00017260: 6e64 206e 6176 5f68 6561 6465 7220 616c  nd nav_header al
-00017270: 736f 2063 6f6e 7461 696e 7320 2779 6177  so contains 'yaw
-00017280: 272c 2770 6974 6368 272c 2772 6f6c 6c27  ','pitch','roll'
-00017290: 206c 6576 6572 6172 6d20 6f66 6673 6574   leverarm offset
-000172a0: 7320 6172 6520 636f 6d70 656e 7361 7465  s are compensate
-000172b0: 6420 666f 7220 2222 220a 0a20 2020 2020  d for """..     
-000172c0: 2020 2069 6620 7365 6c66 2e69 6e74 6572     if self.inter
-000172d0: 6d65 6469 6174 654e 6176 4669 6c65 4578  mediateNavFileEx
-000172e0: 6973 7473 2829 2061 6e64 206e 6f74 206f  ists() and not o
-000172f0: 7665 7277 7269 7465 3a0a 2020 2020 2020  verwrite:.      
-00017300: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-00017310: 652c 2022 4f75 7470 7574 2066 696c 6520  e, "Output file 
-00017320: 6578 6973 7473 3a20 222b 7365 6c66 2e67  exists: "+self.g
-00017330: 6574 5f69 6e74 5f6e 6176 5f66 696c 6528  et_int_nav_file(
-00017340: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
-00017350: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-00017360: 286e 6176 5f70 6174 6829 3a0a 2020 2020  (nav_path):.    
-00017370: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00017380: 616c 7365 2c20 224e 6176 6967 6174 696f  alse, "Navigatio
-00017390: 6e20 6669 6c65 206e 6f74 2066 6f75 6e64  n file not found
-000173a0: 3a20 222b 6e61 765f 7061 7468 0a0a 2020  : "+nav_path..  
-000173b0: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
-000173c0: 7061 7468 2e65 7869 7374 7328 7365 6c66  path.exists(self
-000173d0: 2e69 6d61 6765 7344 6972 293a 0a20 2020  .imagesDir):.   
-000173e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000173f0: 4661 6c73 652c 2022 496d 6167 6520 666f  False, "Image fo
-00017400: 6c64 6572 206e 6f74 2066 6f75 6e64 3a20  lder not found: 
-00017410: 222b 2073 656c 662e 696d 6167 6573 4469  "+ self.imagesDi
-00017420: 720a 0a20 2020 2020 2020 2073 203d 206d  r..        s = m
-00017430: 6971 7463 2e50 7269 6e74 4c6f 6164 696e  iqtc.PrintLoadin
-00017440: 674d 7367 2822 4372 6561 7469 6e67 2069  gMsg("Creating i
-00017450: 7465 6d73 2720 6e61 7669 6761 7469 6f6e  tems' navigation
-00017460: 2064 6174 6122 290a 2020 2020 2020 2020   data").        
-00017470: 7265 7475 726e 4d73 6720 3d20 2222 0a20  returnMsg = "". 
-00017480: 2020 2020 2020 2063 6f6d 7065 6e73 6174         compensat
-00017490: 4f66 6673 6574 7320 3d20 4661 6c73 650a  Offsets = False.
-000174a0: 2020 2020 2020 2020 6966 2028 6f66 6673          if (offs
-000174b0: 6574 5f78 213d 3020 6f72 206f 6666 7365  et_x!=0 or offse
-000174c0: 745f 7921 3d30 206f 7220 6f66 6673 6574  t_y!=0 or offset
-000174d0: 5f7a 213d 3029 2061 6e64 2027 7961 7727  _z!=0) and 'yaw'
-000174e0: 2069 6e20 6e61 765f 6865 6164 6572 2061   in nav_header a
-000174f0: 6e64 2027 7069 7463 6827 2069 6e20 6e61  nd 'pitch' in na
-00017500: 765f 6865 6164 6572 2061 6e64 2027 726f  v_header and 'ro
-00017510: 6c6c 2720 696e 206e 6176 5f68 6561 6465  ll' in nav_heade
-00017520: 723a 0a20 2020 2020 2020 2020 2020 2063  r:.            c
-00017530: 6f6d 7065 6e73 6174 4f66 6673 6574 7320  ompensatOffsets 
-00017540: 3d20 5472 7565 0a0a 2020 2020 2020 2020  = True..        
-00017550: 2320 6368 6563 6b20 6966 2066 6f72 206d  # check if for m
-00017560: 6973 7369 6e67 2066 6965 6c64 7320 7468  issing fields th
-00017570: 6572 6520 6172 6520 636f 6e73 7420 7661  ere are const va
-00017580: 6c75 6573 2069 6e20 6865 6164 6572 0a20  lues in header. 
-00017590: 2020 2020 2020 2063 6f6e 7374 5f76 616c         const_val
-000175a0: 7565 7320 3d20 7b7d 0a20 2020 2020 2020  ues = {}.       
-000175b0: 2066 6f72 206e 6176 4669 656c 6420 696e   for navField in
-000175c0: 206d 6971 7476 2e70 6f73 5f68 6561 6465   miqtv.pos_heade
-000175d0: 725b 276d 6172 6971 7427 5d3a 0a20 2020  r['mariqt']:.   
-000175e0: 2020 2020 2020 2020 2072 6573 7065 6374           respect
-000175f0: 6976 6548 6561 6465 7246 6965 6c64 203d  iveHeaderField =
-00017600: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
-00017610: 725b 226d 6172 6971 7422 5d5b 6e61 7646  r["mariqt"][navF
-00017620: 6965 6c64 5d0a 2020 2020 2020 2020 2020  ield].          
-00017630: 2020 6966 206e 6176 4669 656c 6420 6e6f    if navField no
-00017640: 7420 696e 206e 6176 5f68 6561 6465 7220  t in nav_header 
-00017650: 616e 6420 2872 6573 7065 6374 6976 6548  and (respectiveH
-00017660: 6561 6465 7246 6965 6c64 2069 6e20 7365  eaderField in se
-00017670: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00017680: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-00017690: 6579 5d20 616e 6420 7365 6c66 2e66 696e  ey] and self.fin
-000176a0: 6454 6d70 4669 656c 6432 2872 6573 7065  dTmpField2(respe
-000176b0: 6374 6976 6548 6561 6465 7246 6965 6c64  ctiveHeaderField
-000176c0: 2920 213d 2022 2229 3a20 0a20 2020 2020  ) != ""): .     
-000176d0: 2020 2020 2020 2020 2020 2063 6f6e 7374             const
-000176e0: 5f76 616c 7565 735b 6e61 7646 6965 6c64  _values[navField
-000176f0: 5d20 3d20 7365 6c66 2e66 696e 6454 6d70  ] = self.findTmp
-00017700: 4669 656c 6428 7265 7370 6563 7469 7665  Field(respective
-00017710: 4865 6164 6572 4669 656c 6429 0a0a 2020  HeaderField)..  
-00017720: 2020 2020 2020 2023 2068 616e 646c 6520         # handle 
-00017730: 616c 7420 7673 2064 6570 0a20 2020 2020  alt vs dep.     
-00017740: 2020 2069 6620 2761 6c74 2720 696e 206e     if 'alt' in n
-00017750: 6176 5f68 6561 6465 7220 616e 6420 2764  av_header and 'd
-00017760: 6570 2720 696e 206e 6176 5f68 6561 6465  ep' in nav_heade
-00017770: 723a 0a20 2020 2020 2020 2020 2020 2072  r:.            r
-00017780: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
-00017790: 7863 6570 7469 6f6e 2822 2761 6c74 2720  xception("'alt' 
-000177a0: 616e 6420 2764 6570 2720 7072 6f76 6964  and 'dep' provid
-000177b0: 6564 2e20 5265 6475 6e64 616e 742c 2061  ed. Redundant, a
-000177c0: 6c74 203d 202d 2064 6570 2e20 5072 6f76  lt = - dep. Prov
-000177d0: 6964 6564 206f 6e6c 7920 6f6e 6520 6f66  ided only one of
-000177e0: 2062 6f74 682e 2229 0a20 2020 2020 2020   both.").       
-000177f0: 200a 2020 2020 2020 2020 2320 4c6f 6164   .        # Load
-00017800: 206e 6176 6967 6174 696f 6e20 6461 7461   navigation data
-00017810: 2028 6966 2027 616c 7427 2069 6e73 7465   (if 'alt' inste
-00017820: 6164 206f 6620 2764 6570 272c 2069 7473  ad of 'dep', its
-00017830: 2061 7574 6f6d 6174 6963 616c 6c79 2069   automatically i
-00017840: 6e76 6572 7465 6429 0a20 2020 2020 2020  nverted).       
-00017850: 206e 6176 5f64 6174 612c 2070 6172 7365   nav_data, parse
-00017860: 4d73 6720 3d20 6d69 7174 6e2e 7265 6164  Msg = miqtn.read
-00017870: 416c 6c50 6f73 6974 696f 6e73 4672 6f6d  AllPositionsFrom
-00017880: 4669 6c65 5061 7468 286e 6176 5f70 6174  FilePath(nav_pat
-00017890: 682c 206e 6176 5f68 6561 6465 722c 2064  h, nav_header, d
-000178a0: 6174 655f 666f 726d 6174 2c63 6f6c 5f73  ate_format,col_s
-000178b0: 6570 6172 6174 6f72 3d63 6f6c 5f73 6570  eparator=col_sep
-000178c0: 6172 6174 6f72 2c63 6f6e 7374 5f76 616c  arator,const_val
-000178d0: 7565 733d 636f 6e73 745f 7661 6c75 6573  ues=const_values
-000178e0: 290a 2020 2020 2020 2020 6966 2070 6172  ).        if par
-000178f0: 7365 4d73 6720 213d 2022 223a 0a20 2020  seMsg != "":.   
-00017900: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00017910: 6f76 2e6c 6f67 2870 6172 7365 4d73 672c  ov.log(parseMsg,
-00017920: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
-00017930: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00017940: 6e4d 7367 203d 2022 5c6e 2220 2b20 7061  nMsg = "\n" + pa
-00017950: 7273 654d 7367 0a0a 2020 2020 2020 2020  rseMsg..        
-00017960: 2320 6669 6e64 2066 6f72 2065 6163 6820  # find for each 
-00017970: 696d 6167 6520 7468 6520 7265 7370 6563  image the respec
-00017980: 7469 7665 206e 6176 6967 6174 696f 6e20  tive navigation 
-00017990: 6461 7461 0a20 2020 2020 2020 2073 2e73  data.        s.s
-000179a0: 746f 7028 290a 2020 2020 2020 2020 7375  top().        su
-000179b0: 6363 6573 732c 2069 6d61 6765 5f64 7473  ccess, image_dts
-000179c0: 2c20 6d73 6720 3d20 7365 6c66 2e66 696e  , msg = self.fin
-000179d0: 644e 6176 4461 7461 466f 7249 6d61 6765  dNavDataForImage
-000179e0: 286e 6176 5f64 6174 612c 7669 6465 6f53  (nav_data,videoS
-000179f0: 616d 706c 6553 6563 6f6e 6473 290a 2020  ampleSeconds).  
-00017a00: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-00017a10: 6c6f 6728 6d73 672c 646f 6e74 5368 6f77  log(msg,dontShow
-00017a20: 3d54 7275 6529 0a20 2020 2020 2020 2069  =True).        i
-00017a30: 6620 6d73 6720 213d 2022 223a 0a20 2020  f msg != "":.   
-00017a40: 2020 2020 2020 2020 2072 6574 7572 6e4d           returnM
-00017a50: 7367 202b 3d20 225c 6e22 202b 206d 7367  sg += "\n" + msg
-00017a60: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00017a70: 7375 6363 6573 733a 0a20 2020 2020 2020  success:.       
-00017a80: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00017a90: 652c 2072 6574 7572 6e4d 7367 0a20 2020  e, returnMsg.   
-00017aa0: 2020 2020 2073 203d 206d 6971 7463 2e50       s = miqtc.P
-00017ab0: 7269 6e74 4c6f 6164 696e 674d 7367 2822  rintLoadingMsg("
-00017ac0: 4372 6561 7469 6e67 2069 7465 6d73 2720  Creating items' 
-00017ad0: 6e61 7669 6761 7469 6f6e 2064 6174 6122  navigation data"
-00017ae0: 290a 0a20 2020 2020 2020 2023 2069 6e76  )..        # inv
-00017af0: 6572 7420 7661 6c75 6573 2028 6966 206e  ert values (if n
-00017b00: 6565 6465 6429 2062 6566 6f72 6520 6c65  eeded) before le
-00017b10: 7665 7261 726d 2063 6f6d 7065 6e73 6174  verarm compensat
-00017b20: 696f 6e0a 2020 2020 2020 2020 6966 2072  ion.        if r
-00017b30: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
-00017b40: 6420 213d 205b 5d3a 0a20 2020 2020 2020  d != []:.       
-00017b50: 2020 2020 2066 6f72 2066 696c 6520 696e       for file in
-00017b60: 2069 6d61 6765 5f64 7473 3a0a 2020 2020   image_dts:.    
-00017b70: 2020 2020 2020 2020 2020 2020 706f 7369              posi
-00017b80: 7469 6f6e 7320 3d20 696d 6167 655f 6474  tions = image_dt
-00017b90: 735b 6669 6c65 5d0a 2020 2020 2020 2020  s[file].        
-00017ba0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-00017bb0: 2072 616e 6765 286c 656e 2870 6f73 6974   range(len(posit
-00017bc0: 696f 6e73 2929 3a0a 2020 2020 2020 2020  ions)):.        
-00017bd0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00017be0: 6c61 7427 2069 6e20 7265 636f 7264 7332  lat' in records2
-00017bf0: 6265 496e 7665 7274 6564 3a0a 2020 2020  beInverted:.    
-00017c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c10: 2020 2020 706f 7369 7469 6f6e 735b 695d      positions[i]
-00017c20: 2e6c 6174 202a 3d20 2d31 0a20 2020 2020  .lat *= -1.     
-00017c30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017c40: 6620 276c 6f6e 2720 696e 2072 6563 6f72  f 'lon' in recor
-00017c50: 6473 3262 6549 6e76 6572 7465 643a 0a20  ds2beInverted:. 
-00017c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c70: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
-00017c80: 5b69 5d2e 6c6f 6e20 2a3d 202d 310a 2020  [i].lon *= -1.  
-00017c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ca0: 2020 6966 2028 2764 6570 2720 696e 2072    if ('dep' in r
-00017cb0: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
-00017cc0: 6420 616e 6420 2764 6570 2720 696e 206e  d and 'dep' in n
-00017cd0: 6176 5f68 6561 6465 7229 206f 7220 2827  av_header) or ('
-00017ce0: 616c 7427 2069 6e20 7265 636f 7264 7332  alt' in records2
-00017cf0: 6265 496e 7665 7274 6564 2061 6e64 2027  beInverted and '
-00017d00: 616c 7427 2069 6e20 6e61 765f 6865 6164  alt' in nav_head
-00017d10: 6572 293a 0a20 2020 2020 2020 2020 2020  er):.           
-00017d20: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
-00017d30: 6974 696f 6e73 5b69 5d2e 6465 7020 2a3d  itions[i].dep *=
-00017d40: 202d 310a 2020 2020 2020 2020 2020 2020   -1.            
-00017d50: 2020 2020 2020 2020 6966 2027 6867 7427          if 'hgt'
-00017d60: 2069 6e20 7265 636f 7264 7332 6265 496e   in records2beIn
-00017d70: 7665 7274 6564 3a0a 2020 2020 2020 2020  verted:.        
-00017d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d90: 706f 7369 7469 6f6e 735b 695d 2e68 6774  positions[i].hgt
-00017da0: 202a 3d20 2d31 0a0a 0a20 2020 2020 2020   *= -1...       
-00017db0: 2023 2063 6f6d 7065 6e73 6174 6520 6c65   # compensate le
-00017dc0: 7665 7261 726d 206f 6666 7365 7473 0a20  verarm offsets. 
-00017dd0: 2020 2020 2020 2069 6620 636f 6d70 656e         if compen
-00017de0: 7361 744f 6666 7365 7473 3a0a 0a20 2020  satOffsets:..   
-00017df0: 2020 2020 2020 2020 2023 206c 6f61 6420           # load 
-00017e00: 6672 616d 6520 6174 7469 7475 6465 2064  frame attitude d
-00017e10: 6174 6120 6672 6f6d 2066 696c 650a 2020  ata from file.  
-00017e20: 2020 2020 2020 2020 2020 6174 745f 6461            att_da
-00017e30: 7461 2c20 7061 7273 654d 7367 203d 206d  ta, parseMsg = m
-00017e40: 6971 746e 2e72 6561 6441 6c6c 4174 7469  iqtn.readAllAtti
-00017e50: 7475 6465 7346 726f 6d46 696c 6550 6174  tudesFromFilePat
-00017e60: 6828 6e61 765f 7061 7468 2c20 6e61 765f  h(nav_path, nav_
-00017e70: 6865 6164 6572 2c20 6461 7465 5f66 6f72  header, date_for
-00017e80: 6d61 742c 636f 6c5f 7365 7061 7261 746f  mat,col_separato
-00017e90: 723d 636f 6c5f 7365 7061 7261 746f 722c  r=col_separator,
-00017ea0: 636f 6e73 745f 7661 6c75 6573 3d63 6f6e  const_values=con
-00017eb0: 7374 5f76 616c 7565 732c 616e 676c 6573  st_values,angles
-00017ec0: 496e 5261 643d 616e 676c 6573 5f69 6e5f  InRad=angles_in_
-00017ed0: 7261 6429 0a20 2020 2020 2020 2020 2020  rad).           
-00017ee0: 2069 6620 7061 7273 654d 7367 2021 3d20   if parseMsg != 
-00017ef0: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
-00017f00: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-00017f10: 6728 7061 7273 654d 7367 2c64 6f6e 7453  g(parseMsg,dontS
-00017f20: 686f 773d 5472 7565 290a 2020 2020 2020  how=True).      
-00017f30: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00017f40: 4d73 6720 2b3d 2022 5c6e 2220 2b20 7061  Msg += "\n" + pa
-00017f50: 7273 654d 7367 0a0a 2020 2020 2020 2020  rseMsg..        
-00017f60: 2020 2020 6966 2072 6563 6f72 6473 3262      if records2b
-00017f70: 6549 6e76 6572 7465 6420 213d 205b 5d3a  eInverted != []:
-00017f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017f90: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
-00017fa0: 6765 5f64 7473 3a0a 2020 2020 2020 2020  ge_dts:.        
-00017fb0: 2020 2020 2020 2020 2020 2020 6174 7469              atti
-00017fc0: 7475 6465 7320 3d20 696d 6167 655f 6474  tudes = image_dt
-00017fd0: 735f 6174 745b 6669 6c65 5d0a 2020 2020  s_att[file].    
-00017fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ff0: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
-00018000: 656e 2870 6f73 6974 696f 6e73 2929 3a0a  en(positions)):.
-00018010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018020: 2020 2020 2020 2020 6966 2027 7961 7727          if 'yaw'
-00018030: 2069 6e20 2072 6563 6f72 6473 3262 6549   in  records2beI
-00018040: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
-00018050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018060: 2020 2020 2061 7474 6974 7564 6573 5b69       attitudes[i
-00018070: 5d2e 7961 7720 2a3d 202d 310a 2020 2020  ].yaw *= -1.    
-00018080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018090: 2020 2020 6966 2027 7069 7463 6827 2069      if 'pitch' i
-000180a0: 6e20 2072 6563 6f72 6473 3262 6549 6e76  n  records2beInv
-000180b0: 6572 7465 643a 0a20 2020 2020 2020 2020  erted:.         
-000180c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000180d0: 2020 2061 7474 6974 7564 6573 5b69 5d2e     attitudes[i].
-000180e0: 7069 7463 6820 2a3d 202d 310a 2020 2020  pitch *= -1.    
-000180f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018100: 2020 2020 6966 2027 726f 6c6c 2720 696e      if 'roll' in
-00018110: 2020 7265 636f 7264 7332 6265 496e 7665    records2beInve
-00018120: 7274 6564 3a0a 2020 2020 2020 2020 2020  rted:.          
-00018130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018140: 2020 6174 7469 7475 6465 735b 695d 2e72    attitudes[i].r
-00018150: 6f6c 6c20 2a3d 202d 310a 0a20 2020 2020  oll *= -1..     
-00018160: 2020 2020 2020 2023 2066 696e 6420 666f         # find fo
-00018170: 7220 6561 6368 2069 6d61 6765 2074 6865  r each image the
-00018180: 2072 6573 7065 6374 6976 6520 6e61 7669   respective navi
-00018190: 6761 7469 6f6e 2064 6174 610a 2020 2020  gation data.    
-000181a0: 2020 2020 2020 2020 7375 6363 6573 732c          success,
-000181b0: 2069 6d61 6765 5f64 7473 5f61 7474 2c20   image_dts_att, 
-000181c0: 6d73 6720 3d20 7365 6c66 2e66 696e 644e  msg = self.findN
-000181d0: 6176 4461 7461 466f 7249 6d61 6765 2861  avDataForImage(a
-000181e0: 7474 5f64 6174 612c 7669 6465 6f53 616d  tt_data,videoSam
-000181f0: 706c 6553 6563 6f6e 6473 290a 2020 2020  pleSeconds).    
-00018200: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-00018210: 762e 6c6f 6728 6d73 672c 646f 6e74 5368  v.log(msg,dontSh
-00018220: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
-00018230: 2020 2020 2069 6620 6d73 6720 213d 2022       if msg != "
-00018240: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00018250: 2020 2072 6574 7572 6e4d 7367 202b 3d20     returnMsg += 
-00018260: 225c 6e22 202b 206d 7367 0a20 2020 2020  "\n" + msg.     
-00018270: 2020 2020 2020 2069 6620 6e6f 7420 7375         if not su
-00018280: 6363 6573 733a 0a20 2020 2020 2020 2020  ccess:.         
-00018290: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-000182a0: 6c73 652c 2072 6574 7572 6e4d 7367 0a0a  lse, returnMsg..
-000182b0: 2020 2020 2020 2020 2020 2020 2320 636f              # co
-000182c0: 6d70 656e 7361 7465 0a20 2020 2020 2020  mpensate.       
-000182d0: 2020 2020 2066 6f72 2066 696c 6520 696e       for file in
-000182e0: 2069 6d61 6765 5f64 7473 3a0a 2020 2020   image_dts:.    
-000182f0: 2020 2020 2020 2020 2020 2020 706f 7369              posi
-00018300: 7469 6f6e 7320 3d20 696d 6167 655f 6474  tions = image_dt
-00018310: 735b 6669 6c65 5d0a 2020 2020 2020 2020  s[file].        
-00018320: 2020 2020 2020 2020 6174 7469 7475 6465          attitude
-00018330: 7320 3d20 696d 6167 655f 6474 735f 6174  s = image_dts_at
-00018340: 745b 6669 6c65 5d0a 2020 2020 2020 2020  t[file].        
-00018350: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-00018360: 2072 616e 6765 286c 656e 2870 6f73 6974   range(len(posit
-00018370: 696f 6e73 2929 3a0a 2020 2020 2020 2020  ions)):.        
-00018380: 2020 2020 2020 2020 2020 2020 6c61 7420              lat 
-00018390: 3d20 706f 7369 7469 6f6e 735b 695d 2e6c  = positions[i].l
-000183a0: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
-000183b0: 2020 2020 2020 206c 6f6e 203d 2070 6f73         lon = pos
-000183c0: 6974 696f 6e73 5b69 5d2e 6c6f 6e0a 2020  itions[i].lon.  
-000183d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183e0: 2020 6465 7020 3d20 706f 7369 7469 6f6e    dep = position
-000183f0: 735b 695d 2e64 6570 0a20 2020 2020 2020  s[i].dep.       
-00018400: 2020 2020 2020 2020 2020 2020 2068 6774               hgt
-00018410: 203d 2070 6f73 6974 696f 6e73 5b69 5d2e   = positions[i].
-00018420: 6867 740a 2020 2020 2020 2020 2020 2020  hgt.            
-00018430: 2020 2020 2020 2020 7961 7720 3d20 6174          yaw = at
-00018440: 7469 7475 6465 735b 695d 2e79 6177 0a20  titudes[i].yaw. 
-00018450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018460: 2020 2070 6974 6368 203d 2061 7474 6974     pitch = attit
-00018470: 7564 6573 5b69 5d2e 7069 7463 680a 2020  udes[i].pitch.  
-00018480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018490: 2020 726f 6c6c 203d 2061 7474 6974 7564    roll = attitud
-000184a0: 6573 5b69 5d2e 726f 6c6c 0a20 2020 2020  es[i].roll.     
-000184b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000184c0: 6620 7961 7720 6973 204e 6f6e 6520 6f72  f yaw is None or
-000184d0: 2070 6974 6368 2069 7320 4e6f 6e65 206f   pitch is None o
-000184e0: 7220 726f 6c6c 2069 7320 4e6f 6e65 3a0a  r roll is None:.
-000184f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018500: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00018510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018520: 2020 2020 206e 6577 5f6c 6174 2c6e 6577       new_lat,new
-00018530: 5f6c 6f6e 2c6e 6577 5f64 6570 2c6e 6577  _lon,new_dep,new
-00018540: 5f68 6774 203d 206d 6971 7467 2e61 6464  _hgt = miqtg.add
-00018550: 4c65 7665 7261 726d 7332 4c61 744c 6f6e  Leverarms2LatLon
-00018560: 4465 7041 6c74 286c 6174 2c6c 6f6e 2c64  DepAlt(lat,lon,d
-00018570: 6570 2c68 6774 2c6f 6666 7365 745f 782c  ep,hgt,offset_x,
-00018580: 6f66 6673 6574 5f79 2c6f 6666 7365 745f  offset_y,offset_
-00018590: 7a2c 7961 772c 7069 7463 682c 726f 6c6c  z,yaw,pitch,roll
-000185a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000185b0: 2020 2020 2020 706f 7369 7469 6f6e 735b        positions[
-000185c0: 695d 2e6c 6174 203d 206e 6577 5f6c 6174  i].lat = new_lat
-000185d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000185e0: 2020 2020 2070 6f73 6974 696f 6e73 5b69       positions[i
-000185f0: 5d2e 6c6f 6e20 3d20 6e65 775f 6c6f 6e0a  ].lon = new_lon.
-00018600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018610: 2020 2020 706f 7369 7469 6f6e 735b 695d      positions[i]
-00018620: 2e64 6570 203d 206e 6577 5f64 6570 0a20  .dep = new_dep. 
-00018630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018640: 2020 2070 6f73 6974 696f 6e73 5b69 5d2e     positions[i].
-00018650: 6867 7420 3d20 6e65 775f 6867 740a 0a20  hgt = new_hgt.. 
-00018660: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00018670: 7072 6f76 2e6c 6f67 2822 6170 706c 6965  prov.log("applie
-00018680: 6420 6c65 7665 7220 6172 6d20 636f 6d70  d lever arm comp
-00018690: 656e 7361 7469 6f6e 2078 2c79 2c7a 203d  ensation x,y,z =
-000186a0: 2022 202b 2073 7472 286f 6666 7365 745f   " + str(offset_
-000186b0: 7829 202b 2022 2c22 202b 2073 7472 286f  x) + "," + str(o
-000186c0: 6666 7365 745f 7929 202b 2022 2c22 202b  ffset_y) + "," +
-000186d0: 2073 7472 286f 6666 7365 745f 7a29 2c64   str(offset_z),d
-000186e0: 6f6e 7453 686f 773d 5472 7565 290a 0a20  ontShow=True).. 
-000186f0: 2020 2020 2020 2069 6620 6c65 6e28 696d         if len(im
-00018700: 6167 655f 6474 7329 203e 2030 3a0a 2020  age_dts) > 0:.  
-00018710: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
-00018720: 6b20 7768 6574 6865 7220 6465 7074 6820  k whether depth 
-00018730: 616e 6420 6865 6967 6874 2061 7265 2073  and height are s
-00018740: 6574 0a20 2020 2020 2020 2020 2020 206c  et.            l
-00018750: 6174 5f69 6465 6e74 6963 616c 2c20 6c6f  at_identical, lo
-00018760: 6e5f 6964 656e 7469 6361 6c2c 2064 6570  n_identical, dep
-00018770: 5f69 6465 6e74 6963 616c 2c20 6867 745f  _identical, hgt_
-00018780: 6964 656e 7469 6361 6c2c 2064 6570 5f6e  identical, dep_n
-00018790: 6f74 5f7a 6572 6f2c 2068 6774 5f6e 6f74  ot_zero, hgt_not
-000187a0: 5f7a 6572 6f2c 756e 6365 7274 5f6e 6f74  _zero,uncert_not
-000187b0: 5f7a 6572 6f20 3d20 6e61 765f 6461 7461  _zero = nav_data
-000187c0: 2e63 6865 636b 506f 7369 7469 6f6e 7343  .checkPositionsC
-000187d0: 6f6e 7465 6e74 2829 0a0a 2020 2020 2020  ontent()..      
-000187e0: 2020 2020 2020 2320 5772 6974 6520 746f        # Write to
-000187f0: 206e 6176 6967 6174 696f 6e20 7478 7420   navigation txt 
-00018800: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
-00018810: 2023 2068 6561 6465 720a 2020 2020 2020   # header.      
-00018820: 2020 2020 2020 7265 7320 3d20 6f70 656e        res = open
-00018830: 2873 656c 662e 6765 745f 696e 745f 6e61  (self.get_int_na
-00018840: 765f 6669 6c65 2829 2c20 2277 2229 0a20  v_file(), "w"). 
-00018850: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
-00018860: 7269 7465 286d 6971 7476 2e63 6f6c 5f68  rite(miqtv.col_h
-00018870: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00018880: 2769 6d67 275d 2b22 5c74 222b 6d69 7174  'img']+"\t"+miqt
-00018890: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-000188a0: 7269 7174 275d 5b27 7574 6327 5d29 0a0a  riqt']['utc'])..
-000188b0: 2020 2020 2020 2020 2020 2020 6861 735f              has_
-000188c0: 616c 7420 3d20 5472 7565 2069 6620 6465  alt = True if de
-000188d0: 705f 6e6f 745f 7a65 726f 2061 6e64 2028  p_not_zero and (
-000188e0: 2027 6465 7027 2069 6e20 6e61 765f 6865   'dep' in nav_he
-000188f0: 6164 6572 206f 7220 2761 6c74 2720 696e  ader or 'alt' in
-00018900: 206e 6176 5f68 6561 6465 7220 2920 656c   nav_header ) el
-00018910: 7365 2046 616c 7365 0a0a 2020 2020 2020  se False..      
-00018920: 2020 2020 2020 6966 2027 6c61 7427 2069        if 'lat' i
-00018930: 6e20 6e61 765f 6865 6164 6572 3a0a 2020  n nav_header:.  
-00018940: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00018950: 732e 7772 6974 6528 225c 7422 2b6d 6971  s.write("\t"+miq
-00018960: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00018970: 6172 6971 7427 5d5b 276c 6174 275d 290a  ariqt']['lat']).
-00018980: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00018990: 6c6f 6e27 2069 6e20 6e61 765f 6865 6164  lon' in nav_head
-000189a0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-000189b0: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
-000189c0: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
-000189d0: 6465 725b 276d 6172 6971 7427 5d5b 276c  der['mariqt']['l
-000189e0: 6f6e 275d 290a 2020 2020 2020 2020 2020  on']).          
-000189f0: 2020 6966 2068 6173 5f61 6c74 3a0a 2020    if has_alt:.  
-00018a00: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00018a10: 732e 7772 6974 6528 225c 7422 2b6d 6971  s.write("\t"+miq
-00018a20: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00018a30: 6172 6971 7427 5d5b 2761 6c74 275d 290a  ariqt']['alt']).
-00018a40: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-00018a50: 6774 5f6e 6f74 5f7a 6572 6f20 616e 6420  gt_not_zero and 
-00018a60: 2768 6774 2720 696e 206e 6176 5f68 6561  'hgt' in nav_hea
-00018a70: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
-00018a80: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00018a90: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
-00018aa0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00018ab0: 6867 7427 5d29 0a20 2020 2020 2020 2020  hgt']).         
-00018ac0: 2020 2069 6620 756e 6365 7274 5f6e 6f74     if uncert_not
-00018ad0: 5f7a 6572 6f20 616e 6420 2775 6e63 6572  _zero and 'uncer
-00018ae0: 7427 2069 6e20 6e61 765f 6865 6164 6572  t' in nav_header
-00018af0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018b00: 2020 7265 732e 7772 6974 6528 225c 7422    res.write("\t"
-00018b10: 2b6d 6971 7476 2e63 6f6c 5f68 6561 6465  +miqtv.col_heade
-00018b20: 725b 276d 6172 6971 7427 5d5b 2775 6e63  r['mariqt']['unc
-00018b30: 6572 7427 5d29 0a20 2020 2020 2020 2020  ert']).         
-00018b40: 2020 2072 6573 2e77 7269 7465 2822 5c6e     res.write("\n
-00018b50: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
-00018b60: 2064 6174 6120 6c69 6e65 730a 2020 2020   data lines.    
-00018b70: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
-00018b80: 2069 6e20 696d 6167 655f 6474 733a 0a20   in image_dts:. 
-00018b90: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00018ba0: 6f72 2074 696d 6570 6f69 6e74 2069 6e20  or timepoint in 
-00018bb0: 696d 6167 655f 6474 735b 6669 6c65 5d3a  image_dts[file]:
-00018bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018bd0: 2020 2020 2072 6573 2e77 7269 7465 2866       res.write(f
-00018be0: 696c 652b 225c 7422 2b74 696d 6570 6f69  ile+"\t"+timepoi
-00018bf0: 6e74 2e64 6174 6554 696d 6528 292e 7374  nt.dateTime().st
-00018c00: 7266 7469 6d65 286d 6971 7476 2e64 6174  rftime(miqtv.dat
-00018c10: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
-00018c20: 7427 5d29 2920 0a20 2020 2020 2020 2020  t'])) .         
-00018c30: 2020 2020 2020 2020 2020 2069 6620 276c             if 'l
-00018c40: 6174 2720 696e 206e 6176 5f68 6561 6465  at' in nav_heade
-00018c50: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00018c60: 2020 2020 2020 2020 2020 2076 616c 203d             val =
-00018c70: 2074 696d 6570 6f69 6e74 2e6c 6174 0a20   timepoint.lat. 
-00018c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c90: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00018ca0: 2822 5c74 222b 7374 7228 7661 6c29 290a  ("\t"+str(val)).
-00018cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018cc0: 2020 2020 6966 2027 6c6f 6e27 2069 6e20      if 'lon' in 
-00018cd0: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
-00018ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018cf0: 2020 2020 7661 6c20 3d20 7469 6d65 706f      val = timepo
-00018d00: 696e 742e 6c6f 6e0a 2020 2020 2020 2020  int.lon.        
-00018d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d20: 7265 732e 7772 6974 6528 225c 7422 2b73  res.write("\t"+s
-00018d30: 7472 2876 616c 2929 0a20 2020 2020 2020  tr(val)).       
-00018d40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00018d50: 6861 735f 616c 743a 0a20 2020 2020 2020  has_alt:.       
-00018d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d70: 2076 616c 203d 2074 696d 6570 6f69 6e74   val = timepoint
-00018d80: 2e64 6570 0a20 2020 2020 2020 2020 2020  .dep.           
-00018d90: 2020 2020 2020 2020 2020 2020 2023 2064               # d
-00018da0: 6570 2074 6f20 616c 740a 2020 2020 2020  ep to alt.      
-00018db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018dc0: 2020 7661 6c20 2a3d 202d 310a 2020 2020    val *= -1.    
-00018dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018de0: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
-00018df0: 7422 2b73 7472 2876 616c 2929 0a20 2020  t"+str(val)).   
-00018e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e10: 2069 6620 6867 745f 6e6f 745f 7a65 726f   if hgt_not_zero
-00018e20: 2061 6e64 2027 6867 7427 2069 6e20 6e61   and 'hgt' in na
-00018e30: 765f 6865 6164 6572 3a0a 2020 2020 2020  v_header:.      
-00018e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e50: 2020 7661 6c20 3d20 7469 6d65 706f 696e    val = timepoin
-00018e60: 742e 6867 740a 2020 2020 2020 2020 2020  t.hgt.          
-00018e70: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00018e80: 732e 7772 6974 6528 225c 7422 2b73 7472  s.write("\t"+str
-00018e90: 2876 616c 2929 0a20 2020 2020 2020 2020  (val)).         
-00018ea0: 2020 2020 2020 2020 2020 2069 6620 756e             if un
-00018eb0: 6365 7274 5f6e 6f74 5f7a 6572 6f20 616e  cert_not_zero an
-00018ec0: 6420 2775 6e63 6572 7427 2069 6e20 6e61  d 'uncert' in na
-00018ed0: 765f 6865 6164 6572 3a0a 2020 2020 2020  v_header:.      
-00018ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ef0: 2020 7661 6c20 3d20 7469 6d65 706f 696e    val = timepoin
-00018f00: 742e 756e 6365 7274 0a20 2020 2020 2020  t.uncert.       
-00018f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f20: 2072 6573 2e77 7269 7465 2822 5c74 222b   res.write("\t"+
-00018f30: 7374 7228 7661 6c29 290a 2020 2020 2020  str(val)).      
-00018f40: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00018f50: 732e 7772 6974 6528 225c 6e22 290a 2020  s.write("\n").  
-00018f60: 2020 2020 2020 2020 2020 7265 732e 636c            res.cl
-00018f70: 6f73 6528 290a 0a20 2020 2020 2020 2020  ose()..         
-00018f80: 2020 2023 2057 7269 7465 2074 6f20 6765     # Write to ge
-00018f90: 6f6a 736f 6e20 6669 6c65 0a20 2020 2020  ojson file.     
-00018fa0: 2020 2020 2020 2067 656f 6a73 6f6e 203d         geojson =
-00018fb0: 207b 2774 7970 6527 3a20 2746 6561 7475   {'type': 'Featu
-00018fc0: 7265 436f 6c6c 6563 7469 6f6e 272c 2027  reCollection', '
-00018fd0: 6e61 6d65 273a 2073 656c 662e 6469 722e  name': self.dir.
-00018fe0: 6576 656e 7428 292b 225f 222b 7365 6c66  event()+"_"+self
-00018ff0: 2e64 6972 2e73 656e 736f 7228 292b 225f  .dir.sensor()+"_
-00019000: 696d 6167 652d 6e61 7669 6761 7469 6f6e  image-navigation
-00019010: 222c 2027 6665 6174 7572 6573 273a 205b  ", 'features': [
-00019020: 5d7d 0a20 2020 2020 2020 2020 2020 2066  ]}.            f
-00019030: 6f72 2066 696c 6520 696e 2069 6d61 6765  or file in image
-00019040: 5f64 7473 3a0a 2020 2020 2020 2020 2020  _dts:.          
-00019050: 2020 2020 2020 2320 7068 6f74 6f0a 2020        # photo.  
-00019060: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00019070: 206c 656e 2869 6d61 6765 5f64 7473 5b66   len(image_dts[f
-00019080: 696c 655d 2920 3d3d 2031 3a0a 2020 2020  ile]) == 1:.    
-00019090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190a0: 6966 2064 6570 5f6e 6f74 5f7a 6572 6f3a  if dep_not_zero:
-000190b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000190c0: 2020 2020 2020 2020 2067 656f 6d65 7472           geometr
-000190d0: 7920 3d20 207b 2774 7970 6527 3a20 2250  y =  {'type': "P
-000190e0: 6f69 6e74 222c 2027 636f 6f72 6469 6e61  oint", 'coordina
-000190f0: 7465 7327 3a20 0a20 2020 2020 2020 2020  tes': .         
-00019100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019110: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00019120: 666c 6f61 7428 696d 6167 655f 6474 735b  float(image_dts[
-00019130: 6669 6c65 5d5b 305d 2e6c 6f6e 292c 2066  file][0].lon), f
-00019140: 6c6f 6174 2869 6d61 6765 5f64 7473 5b66  loat(image_dts[f
-00019150: 696c 655d 5b30 5d2e 6c61 7429 2c20 2d31  ile][0].lat), -1
-00019160: 2a66 6c6f 6174 2869 6d61 6765 5f64 7473  *float(image_dts
-00019170: 5b66 696c 655d 5b30 5d2e 6465 7029 5d0a  [file][0].dep)].
-00019180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000160d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000160e0: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
+000160f0: 7465 6429 0a20 2020 2020 2020 200a 0a20  ted).        .. 
+00016100: 2020 2064 6566 2067 6574 5f52 5f63 616d     def get_R_cam
+00016110: 5374 6432 7574 6d28 7365 6c66 2c52 5f63  Std2utm(self,R_c
+00016120: 616d 3266 7261 6d65 3a6e 702e 6172 7261  am2frame:np.arra
+00016130: 792c 525f 6672 616d 6532 6e65 643a 6e70  y,R_frame2ned:np
+00016140: 2e61 7272 6179 293a 0a20 2020 2020 2020  .array):.       
+00016150: 2022 2222 2072 6574 7275 6e20 726f 7461   """ retrun rota
+00016160: 7469 6f6e 206d 6174 7269 7820 5220 7472  tion matrix R tr
+00016170: 616e 666f 726d 696e 6720 6672 6f6d 2063  anforming from c
+00016180: 616d 5374 643a 2028 782c 792c 7a20 3d20  amStd: (x,y,z = 
+00016190: 7269 6768 742c 6275 7474 6f6d 2c6c 696e  right,buttom,lin
+000161a0: 6520 6f66 2073 6967 6874 2920 746f 2075  e of sight) to u
+000161b0: 746d 2028 782c 792c 7a20 3d20 6561 7374  tm (x,y,z = east
+000161c0: 696e 672c 6e6f 7274 6869 6e67 2c75 7029  ing,northing,up)
+000161d0: 2022 2222 0a20 2020 2020 2020 2052 5f63   """.        R_c
+000161e0: 616d 6946 444f 3263 616d 5374 6420 3d20  amiFDO2camStd = 
+000161f0: 6d69 7174 672e 525f 5961 7750 6974 6368  miqtg.R_YawPitch
+00016200: 526f 6c6c 2839 302c 302c 3029 2023 2069  Roll(90,0,0) # i
+00016210: 6e20 6946 444f 2063 616d 3a20 2878 2c79  n iFDO cam: (x,y
+00016220: 2c7a 203d 2074 6f70 2c72 6967 6874 2c6c  ,z = top,right,l
+00016230: 696e 6520 6f66 2073 6967 6874 2920 6275  ine of sight) bu
+00016240: 7420 666f 7220 706f 7365 2074 6865 2027  t for pose the '
+00016250: 7374 616e 6461 7264 2720 6361 6d53 7464  standard' camStd
+00016260: 3a20 2878 2c79 2c7a 203d 2072 6967 6874  : (x,y,z = right
+00016270: 2c62 7574 746f 6d2c 6c69 6e65 206f 6620  ,buttom,line of 
+00016280: 7369 6768 7429 2069 7320 6578 7065 6374  sight) is expect
+00016290: 6564 0a20 2020 2020 2020 2052 5f63 616d  ed.        R_cam
+000162a0: 5374 6432 6672 616d 6520 3d20 525f 6361  Std2frame = R_ca
+000162b0: 6d32 6672 616d 652e 646f 7428 525f 6361  m2frame.dot(R_ca
+000162c0: 6d69 4644 4f32 6361 6d53 7464 290a 2020  miFDO2camStd).  
+000162d0: 2020 2020 2020 525f 6361 6d53 7464 326e        R_camStd2n
+000162e0: 6564 203d 2052 5f66 7261 6d65 326e 6564  ed = R_frame2ned
+000162f0: 2e64 6f74 2852 5f63 616d 5374 6432 6672  .dot(R_camStd2fr
+00016300: 616d 6529 0a20 2020 2020 2020 2052 5f6e  ame).        R_n
+00016310: 6564 3275 746d 203d 206d 6971 7467 2e52  ed2utm = miqtg.R
+00016320: 5f58 595a 2831 3830 2c30 2c39 3029 2023  _XYZ(180,0,90) #
+00016330: 2077 6974 6820 7574 6d20 782c 792c 7a20   with utm x,y,z 
+00016340: 3d20 6561 7374 696e 672c 6e6f 7274 6869  = easting,northi
+00016350: 6e67 2c75 700a 2020 2020 2020 2020 525f  ng,up.        R_
+00016360: 6361 6d53 7464 3275 746d 203d 2052 5f6e  camStd2utm = R_n
+00016370: 6564 3275 746d 2e64 6f74 2852 5f63 616d  ed2utm.dot(R_cam
+00016380: 5374 6432 6e65 6429 2e72 6f75 6e64 2835  Std2ned).round(5
+00016390: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000163a0: 2052 5f63 616d 5374 6432 7574 6d0a 0a0a   R_camStd2utm...
+000163b0: 2020 2020 6465 6620 6669 6e64 4e61 7644      def findNavD
+000163c0: 6174 6146 6f72 496d 6167 6528 7365 6c66  ataForImage(self
+000163d0: 2c64 6174 613a 6d69 7174 672e 4e75 6d44  ,data:miqtg.NumD
+000163e0: 6174 6154 696d 6553 7461 6d70 6564 2c76  ataTimeStamped,v
+000163f0: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
+00016400: 733d 3129 3a0a 2020 2020 2020 2020 2222  s=1):.        ""
+00016410: 2220 6372 6561 7465 7320 6120 6469 6374  " creates a dict
+00016420: 2028 696d 6167 655f 6474 7329 2077 6974   (image_dts) wit
+00016430: 6820 6669 6c65 206e 616d 6520 6173 206b  h file name as k
+00016440: 6579 2061 6e64 2061 206c 6973 7420 6f66  ey and a list of
+00016450: 2064 6174 6120 656c 656d 656e 7473 2061   data elements a
+00016460: 7320 7661 6c75 652e 200a 2020 2020 2020  s value. .      
+00016470: 2020 2020 2020 496e 2063 6173 6520 6f66        In case of
+00016480: 2070 686f 746f 7320 7468 6520 6c69 7374   photos the list
+00016490: 2068 6173 206f 6e6c 7920 6120 7369 6e67   has only a sing
+000164a0: 6c65 2065 6e74 7279 2c20 666f 7220 7669  le entry, for vi
+000164b0: 6465 6f73 2069 7420 6861 7320 7669 6465  deos it has vide
+000164c0: 6f20 6475 7261 7469 6f6e 205b 7365 635d  o duration [sec]
+000164d0: 202f 2076 6964 656f 5361 6d70 6c65 5365   / videoSampleSe
+000164e0: 636f 6e64 7320 656e 7472 6965 732e 0a20  conds entries.. 
+000164f0: 2020 2020 2020 2020 2020 2052 6574 7572             Retur
+00016500: 6e73 2073 7563 6365 7373 2c20 696d 6167  ns success, imag
+00016510: 655f 6474 732c 206d 7367 2022 2222 0a0a  e_dts, msg """..
+00016520: 2020 2020 2020 2020 6966 2076 6964 656f          if video
+00016530: 5361 6d70 6c65 5365 636f 6e64 7320 3c3d  SampleSeconds <=
+00016540: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00016550: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+00016560: 2266 696e 644e 6176 4461 7461 466f 7249  "findNavDataForI
+00016570: 6d61 6765 3a20 7669 6465 6f53 616d 706c  mage: videoSampl
+00016580: 6553 6563 6f6e 6473 206d 7573 7420 6265  eSeconds must be
+00016590: 2067 7265 6174 6572 2030 2229 0a0a 2020   greater 0")..  
+000165a0: 2020 2020 2020 2320 6372 6561 7465 2073        # create s
+000165b0: 6f72 7465 6420 7469 6d65 2070 6f69 6e74  orted time point
+000165c0: 730a 2020 2020 2020 2020 7469 6d65 5f70  s.        time_p
+000165d0: 6f69 6e74 7320 3d20 6c69 7374 2864 6174  oints = list(dat
+000165e0: 612e 6b65 7973 2829 290a 2020 2020 2020  a.keys()).      
+000165f0: 2020 7469 6d65 5f70 6f69 6e74 732e 736f    time_points.so
+00016600: 7274 2829 0a20 2020 2020 2020 2075 6e6d  rt().        unm
+00016610: 6174 6368 6564 5469 6d65 506f 696e 7473  atchedTimePoints
+00016620: 203d 205b 5d0a 2020 2020 2020 2020 696d   = [].        im
+00016630: 6167 655f 6474 7320 3d20 7b7d 0a20 2020  age_dts = {}.   
+00016640: 2020 2020 2073 7461 7274 5365 6172 6368       startSearch
+00016650: 496e 6465 7820 3d20 300a 2020 2020 2020  Index = 0.      
+00016660: 2020 696d 6167 6573 496e 5261 7720 3d20    imagesInRaw = 
+00016670: 2073 656c 662e 696d 6167 6573 496e 496d   self.imagesInIm
+00016680: 6167 6573 4469 7228 290a 2020 2020 2020  agesDir().      
+00016690: 2020 696d 6167 6573 496e 5261 7753 6f72    imagesInRawSor
+000166a0: 7465 644c 6973 7420 3d20 7365 6c66 2e69  tedList = self.i
+000166b0: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
+000166c0: 536f 7274 6564 4c69 7374 2829 0a20 2020  SortedList().   
+000166d0: 2020 2020 2070 726f 6720 3d20 6d69 7174       prog = miqt
+000166e0: 632e 5072 696e 744b 6e6f 776e 5072 6f67  c.PrintKnownProg
+000166f0: 7265 7373 4d73 6728 2249 6e74 6572 706f  ressMsg("Interpo
+00016700: 6c61 7469 6e67 206e 6176 6967 6174 696f  lating navigatio
+00016710: 6e20 666f 7220 696d 6167 6522 2c20 6c65  n for image", le
+00016720: 6e28 696d 6167 6573 496e 5261 7729 2c6d  n(imagesInRaw),m
+00016730: 6f64 756c 6f3d 3129 0a20 2020 2020 2020  odulo=1).       
+00016740: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
+00016750: 6765 7349 6e52 6177 536f 7274 6564 4c69  gesInRawSortedLi
+00016760: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
+00016770: 7072 6f67 2e70 726f 6772 6573 7328 290a  prog.progress().
+00016780: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+00016790: 5f6e 616d 6520 3d20 6f73 2e70 6174 682e  _name = os.path.
+000167a0: 6261 7365 6e61 6d65 2866 696c 6529 0a0a  basename(file)..
+000167b0: 2020 2020 2020 2020 2020 2020 6474 5f69              dt_i
+000167c0: 6d61 6765 203d 206d 6971 7463 2e70 6172  mage = miqtc.par
+000167d0: 7365 4669 6c65 4461 7465 5469 6d65 4173  seFileDateTimeAs
+000167e0: 5554 4328 6669 6c65 5f6e 616d 6529 0a20  UTC(file_name). 
+000167f0: 2020 2020 2020 2020 2020 2064 745f 696d             dt_im
+00016800: 6167 655f 7473 203d 2069 6e74 2864 745f  age_ts = int(dt_
+00016810: 696d 6167 652e 7469 6d65 7374 616d 7028  image.timestamp(
+00016820: 2920 2a20 3130 3030 290a 0a20 2020 2020  ) * 1000)..     
+00016830: 2020 2020 2020 2072 756e 5469 6d65 203d         runTime =
+00016840: 2069 6d61 6765 7349 6e52 6177 5b66 696c   imagesInRaw[fil
+00016850: 655d 5b31 5d20 2320 2d31 2066 6f72 2070  e][1] # -1 for p
+00016860: 686f 746f 730a 2020 2020 2020 2020 2020  hotos.          
+00016870: 2020 2320 7669 6465 6f0a 2020 2020 2020    # video.      
+00016880: 2020 2020 2020 6966 2069 6d61 6765 7349        if imagesI
+00016890: 6e52 6177 5b66 696c 655d 5b32 5d20 696e  nRaw[file][2] in
+000168a0: 206d 6971 7476 2e76 6964 656f 5f74 7970   miqtv.video_typ
+000168b0: 6573 2061 6e64 2072 756e 5469 6d65 203c  es and runTime <
+000168c0: 3d20 303a 2023 2065 7874 0a20 2020 2020  = 0: # ext.     
+000168d0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000168e0: 2822 4361 7574 696f 6e21 2043 6f75 6c64  ("Caution! Could
+000168f0: 206e 6f74 2072 6561 6420 7669 6465 6f20   not read video 
+00016900: 7275 6e20 7469 6d65 2066 726f 6d20 6669  run time from fi
+00016910: 6c65 222c 6669 6c65 2920 2320 544f 444f  le",file) # TODO
+00016920: 2064 6f65 7320 7468 6973 2068 6170 7065   does this happe
+00016930: 6e3f 2048 616e 646c 6520 6265 7474 6572  n? Handle better
+00016940: 3f0a 0a20 2020 2020 2020 2020 2020 2073  ?..            s
+00016950: 616d 706c 6554 696d 6553 6563 7320 3d20  ampleTimeSecs = 
+00016960: 300a 2020 2020 2020 2020 2020 2020 706f  0.            po
+00016970: 735f 6c69 7374 203d 205b 5d0a 2020 2020  s_list = [].    
+00016980: 2020 2020 2020 2020 676f 203d 2054 7275          go = Tru
+00016990: 650a 2020 2020 2020 2020 2020 2020 7768  e.            wh
+000169a0: 696c 6520 676f 3a0a 2020 2020 2020 2020  ile go:.        
+000169b0: 2020 2020 2020 2020 7472 793a 2020 2020          try:    
+000169c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000169e0: 2020 2020 2070 6f73 2c20 7374 6172 7453       pos, startS
+000169f0: 6561 7263 6849 6e64 6578 203d 2064 6174  earchIndex = dat
+00016a00: 612e 696e 7465 7270 6f6c 6174 6541 7454  a.interpolateAtT
+00016a10: 696d 6528 6474 5f69 6d61 6765 5f74 7320  ime(dt_image_ts 
+00016a20: 2b20 7361 6d70 6c65 5469 6d65 5365 6373  + sampleTimeSecs
+00016a30: 202a 2031 3030 302c 7469 6d65 5f70 6f69   * 1000,time_poi
+00016a40: 6e74 732c 7374 6172 7453 6561 7263 6849  nts,startSearchI
+00016a50: 6e64 6578 290a 2020 2020 2020 2020 2020  ndex).          
+00016a60: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00016a70: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00016a80: 2069 6e74 6572 706f 6c61 7465 4174 5469   interpolateAtTi
+00016a90: 6d65 2072 6574 7572 6e73 204e 6f6e 6520  me returns None 
+00016aa0: 7661 6c75 6573 2069 6620 7469 6d65 206f  values if time o
+00016ab0: 7574 206f 6620 7261 6e67 650a 2020 2020  ut of range.    
+00016ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ad0: 6966 2070 6f73 2e63 6f74 6169 6e73 4e6f  if pos.cotainsNo
+00016ae0: 6e65 5661 6c75 6573 496e 5265 7175 6972  neValuesInRequir
+00016af0: 6564 4669 656c 6473 2829 3a0a 2020 2020  edFields():.    
+00016b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b10: 2020 2020 756e 6d61 7463 6865 6454 696d      unmatchedTim
+00016b20: 6550 6f69 6e74 732e 6170 7065 6e64 2828  ePoints.append((
+00016b30: 6474 5f69 6d61 6765 5f74 7320 2b20 7361  dt_image_ts + sa
+00016b40: 6d70 6c65 5469 6d65 5365 6373 202a 2031  mpleTimeSecs * 1
+00016b50: 3030 3029 2f31 3030 3029 0a20 2020 2020  000)/1000).     
+00016b60: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00016b70: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00016b80: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
+00016b90: 5f6c 6973 742e 6170 7065 6e64 2870 6f73  _list.append(pos
+00016ba0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00016bb0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00016bc0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+00016bd0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00016be0: 7572 6e20 4661 6c73 652c 2069 6d61 6765  urn False, image
+00016bf0: 5f64 7473 2c20 2243 6f75 6c64 206e 6f74  _dts, "Could not
+00016c00: 2066 696e 6420 696d 6167 6520 7469 6d65   find image time
+00016c10: 2022 2b20 6461 7465 7469 6d65 2e64 6174   "+ datetime.dat
+00016c20: 6574 696d 652e 7574 6366 726f 6d74 696d  etime.utcfromtim
+00016c30: 6573 7461 6d70 2828 6474 5f69 6d61 6765  estamp((dt_image
+00016c40: 5f74 7320 2b20 7361 6d70 6c65 5469 6d65  _ts + sampleTime
+00016c50: 5365 6373 202a 2031 3030 3029 2f31 3030  Secs * 1000)/100
+00016c60: 3029 2e73 7472 6674 696d 6528 6d69 7174  0).strftime(miqt
+00016c70: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
+00016c80: 6d61 7269 7174 275d 2920 2b22 2069 6e20  mariqt']) +" in 
+00016c90: 222b 7374 7228 6461 7461 2e6c 656e 2829  "+str(data.len()
+00016ca0: 292b 2220 6461 7461 2070 6f73 6974 696f  )+" data positio
+00016cb0: 6e73 2220 2b20 7374 7228 652e 6172 6773  ns" + str(e.args
+00016cc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00016cd0: 2020 7361 6d70 6c65 5469 6d65 5365 6373    sampleTimeSecs
+00016ce0: 202b 3d20 7669 6465 6f53 616d 706c 6553   += videoSampleS
+00016cf0: 6563 6f6e 6473 0a20 2020 2020 2020 2020  econds.         
+00016d00: 2020 2020 2020 2069 6620 7361 6d70 6c65         if sample
+00016d10: 5469 6d65 5365 6373 203e 2072 756e 5469  TimeSecs > runTi
+00016d20: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+00016d30: 2020 2020 2020 2020 676f 203d 2046 616c          go = Fal
+00016d40: 7365 0a20 2020 2020 2020 2020 2020 200a  se.            .
+00016d50: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+00016d60: 655f 6474 735b 6669 6c65 5f6e 616d 655d  e_dts[file_name]
+00016d70: 203d 2070 6f73 5f6c 6973 740a 2020 2020   = pos_list.    
+00016d80: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
+00016d90: 0a20 2020 2020 2020 2072 6574 7572 6e4d  .        returnM
+00016da0: 7367 203d 2022 220a 2020 2020 2020 2020  sg = "".        
+00016db0: 6966 206c 656e 2875 6e6d 6174 6368 6564  if len(unmatched
+00016dc0: 5469 6d65 506f 696e 7473 2920 213d 2030  TimePoints) != 0
+00016dd0: 3a0a 2020 2020 2020 2020 2020 2020 756e  :.            un
+00016de0: 6d61 7463 6865 6454 696d 6550 6f69 6e74  matchedTimePoint
+00016df0: 732e 736f 7274 2829 0a20 2020 2020 2020  s.sort().       
+00016e00: 2020 2020 2075 6e6d 6174 6368 6564 5469       unmatchedTi
+00016e10: 6d65 506f 696e 7473 203d 205b 6461 7465  mePoints = [date
+00016e20: 7469 6d65 2e64 6174 6574 696d 652e 7574  time.datetime.ut
+00016e30: 6366 726f 6d74 696d 6573 7461 6d70 2874  cfromtimestamp(t
+00016e40: 7329 2e73 7472 6674 696d 6528 6d69 7174  s).strftime(miqt
+00016e50: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
+00016e60: 6d61 7269 7174 275d 2920 666f 7220 7473  mariqt']) for ts
+00016e70: 2069 6e20 756e 6d61 7463 6865 6454 696d   in unmatchedTim
+00016e80: 6550 6f69 6e74 735d 0a20 2020 2020 2020  ePoints].       
+00016e90: 2020 2020 2072 6574 7572 6e4d 7367 203d       returnMsg =
+00016ea0: 2022 4361 7574 696f 6e21 204e 6176 6967   "Caution! Navig
+00016eb0: 6174 696f 6e20 6e6f 7420 666f 756e 6420  ation not found 
+00016ec0: 666f 7220 7468 6520 666f 6c6c 6f77 696e  for the followin
+00016ed0: 6720 696d 6167 6520 7469 6d65 2070 6f69  g image time poi
+00016ee0: 6e74 732e 2044 6f75 626c 6520 6368 6563  nts. Double chec
+00016ef0: 6b20 6f72 2070 726f 7669 6465 2061 7420  k or provide at 
+00016f00: 6c65 6173 7420 7374 6174 6963 2064 6566  least static def
+00016f10: 6175 6c74 206e 6176 6967 6174 696f 6e20  ault navigation 
+00016f20: 696e 2068 6561 6465 7220 6669 656c 6473  in header fields
+00016f30: 2e22 0a20 2020 2020 2020 2020 2020 2072  .".            r
+00016f40: 6574 7572 6e4d 7367 202b 3d20 225c 6e22  eturnMsg += "\n"
+00016f50: 202b 2022 5c6e 222e 6a6f 696e 2875 6e6d   + "\n".join(unm
+00016f60: 6174 6368 6564 5469 6d65 506f 696e 7473  atchedTimePoints
+00016f70: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00016f80: 2054 7275 652c 2069 6d61 6765 5f64 7473   True, image_dts
+00016f90: 2c20 7265 7475 726e 4d73 670a 0a0a 2020  , returnMsg...  
+00016fa0: 2020 6465 6620 6372 6561 7465 5f69 6d61    def create_ima
+00016fb0: 6765 5f6e 6176 6967 6174 696f 6e5f 6669  ge_navigation_fi
+00016fc0: 6c65 2873 656c 662c 206e 6176 5f70 6174  le(self, nav_pat
+00016fd0: 683a 2073 7472 2c20 6e61 765f 6865 6164  h: str, nav_head
+00016fe0: 6572 3d6d 6971 7476 2e70 6f73 5f68 6561  er=miqtv.pos_hea
+00016ff0: 6465 725b 2770 616e 6761 6561 275d 2c20  der['pangaea'], 
+00017000: 6461 7465 5f66 6f72 6d61 743d 6d69 7174  date_format=miqt
+00017010: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
+00017020: 7061 6e67 6165 6127 5d2c 206f 7665 7277  pangaea'], overw
+00017030: 7269 7465 3d46 616c 7365 2c20 636f 6c5f  rite=False, col_
+00017040: 7365 7061 7261 746f 7220 3d20 225c 7422  separator = "\t"
+00017050: 2c20 7669 6465 6f53 616d 706c 6553 6563  , videoSampleSec
+00017060: 6f6e 6473 3d31 2c0a 2020 2020 2020 2020  onds=1,.        
+00017070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017080: 2020 2020 2020 2020 2020 2020 6f66 6673              offs
+00017090: 6574 5f78 3d30 2c20 6f66 6673 6574 5f79  et_x=0, offset_y
+000170a0: 3d30 2c20 6f66 6673 6574 5f7a 3d30 2c61  =0, offset_z=0,a
+000170b0: 6e67 6c65 735f 696e 5f72 6164 203d 2046  ngles_in_rad = F
+000170c0: 616c 7365 2c20 7265 636f 7264 7332 6265  alse, records2be
+000170d0: 496e 7665 7274 6564 3d5b 5d29 3a0a 2020  Inverted=[]):.  
+000170e0: 2020 2020 2020 2222 2220 4372 6561 7465        """ Create
+000170f0: 7320 696e 202f 696e 7465 726d 6564 6961  s in /intermedia
+00017100: 7465 2061 2074 6578 7420 6669 6c65 2077  te a text file w
+00017110: 6974 6820 342e 3544 206e 6176 6967 6174  ith 4.5D navigat
+00017120: 696f 6e20 6461 7461 2066 6f72 2065 6163  ion data for eac
+00017130: 6820 696d 6167 652c 2069 2e65 2e20 6120  h image, i.e. a 
+00017140: 7369 6e67 6c65 2072 6f77 2070 6572 2070  single row per p
+00017150: 686f 746f 2c20 7669 6465 6f20 6475 7261  hoto, video dura
+00017160: 7469 6f6e 205b 7365 635d 202f 2076 6964  tion [sec] / vid
+00017170: 656f 5361 6d70 6c65 5365 636f 6e64 7320  eoSampleSeconds 
+00017180: 726f 7773 2070 6572 2076 6964 656f 2e0a  rows per video..
+00017190: 2020 2020 2020 2020 2020 2020 6e61 765f              nav_
+000171a0: 6865 6164 6572 206d 7573 7420 6265 2064  header must be d
+000171b0: 6963 7420 636f 6e74 6169 6e69 6e67 2074  ict containing t
+000171c0: 6865 206b 6579 7320 2775 7463 272c 276c  he keys 'utc','l
+000171d0: 6174 272c 276c 6f6e 272c 2764 6570 2728  at','lon','dep'(
+000171e0: 6f72 2027 616c 7427 292c 206f 7074 696f  or 'alt'), optio
+000171f0: 6e61 6c3a 2027 6867 7427 2c27 756e 6365  nal: 'hgt','unce
+00017200: 7274 2720 7769 7468 2074 6865 2072 6573  rt' with the res
+00017210: 7065 6374 6976 6520 636f 6c75 6d6e 2068  pective column h
+00017220: 6561 6465 7273 2061 7320 7661 6c75 6573  eaders as values
+00017230: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
+00017240: 206f 6e65 206f 6620 7468 6520 7665 6869   one of the vehi
+00017250: 636c 6520 782c 792c 7a20 6f66 6673 6574  cle x,y,z offset
+00017260: 7320 5b6d 5d20 6973 206e 6f74 2030 2061  s [m] is not 0 a
+00017270: 6e64 206e 6176 5f68 6561 6465 7220 616c  nd nav_header al
+00017280: 736f 2063 6f6e 7461 696e 7320 2779 6177  so contains 'yaw
+00017290: 272c 2770 6974 6368 272c 2772 6f6c 6c27  ','pitch','roll'
+000172a0: 206c 6576 6572 6172 6d20 6f66 6673 6574   leverarm offset
+000172b0: 7320 6172 6520 636f 6d70 656e 7361 7465  s are compensate
+000172c0: 6420 666f 7220 2222 220a 0a20 2020 2020  d for """..     
+000172d0: 2020 2069 6620 7365 6c66 2e69 6e74 6572     if self.inter
+000172e0: 6d65 6469 6174 654e 6176 4669 6c65 4578  mediateNavFileEx
+000172f0: 6973 7473 2829 2061 6e64 206e 6f74 206f  ists() and not o
+00017300: 7665 7277 7269 7465 3a0a 2020 2020 2020  verwrite:.      
+00017310: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00017320: 652c 2022 4f75 7470 7574 2066 696c 6520  e, "Output file 
+00017330: 6578 6973 7473 3a20 222b 7365 6c66 2e67  exists: "+self.g
+00017340: 6574 5f69 6e74 5f6e 6176 5f66 696c 6528  et_int_nav_file(
+00017350: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+00017360: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
+00017370: 286e 6176 5f70 6174 6829 3a0a 2020 2020  (nav_path):.    
+00017380: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00017390: 616c 7365 2c20 224e 6176 6967 6174 696f  alse, "Navigatio
+000173a0: 6e20 6669 6c65 206e 6f74 2066 6f75 6e64  n file not found
+000173b0: 3a20 222b 6e61 765f 7061 7468 0a0a 2020  : "+nav_path..  
+000173c0: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
+000173d0: 7061 7468 2e65 7869 7374 7328 7365 6c66  path.exists(self
+000173e0: 2e69 6d61 6765 7344 6972 293a 0a20 2020  .imagesDir):.   
+000173f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00017400: 4661 6c73 652c 2022 496d 6167 6520 666f  False, "Image fo
+00017410: 6c64 6572 206e 6f74 2066 6f75 6e64 3a20  lder not found: 
+00017420: 222b 2073 656c 662e 696d 6167 6573 4469  "+ self.imagesDi
+00017430: 720a 0a20 2020 2020 2020 2073 203d 206d  r..        s = m
+00017440: 6971 7463 2e50 7269 6e74 4c6f 6164 696e  iqtc.PrintLoadin
+00017450: 674d 7367 2822 4372 6561 7469 6e67 2069  gMsg("Creating i
+00017460: 7465 6d73 2720 6e61 7669 6761 7469 6f6e  tems' navigation
+00017470: 2064 6174 6122 290a 2020 2020 2020 2020   data").        
+00017480: 7265 7475 726e 4d73 6720 3d20 2222 0a20  returnMsg = "". 
+00017490: 2020 2020 2020 2063 6f6d 7065 6e73 6174         compensat
+000174a0: 4f66 6673 6574 7320 3d20 4661 6c73 650a  Offsets = False.
+000174b0: 2020 2020 2020 2020 6966 2028 6f66 6673          if (offs
+000174c0: 6574 5f78 213d 3020 6f72 206f 6666 7365  et_x!=0 or offse
+000174d0: 745f 7921 3d30 206f 7220 6f66 6673 6574  t_y!=0 or offset
+000174e0: 5f7a 213d 3029 2061 6e64 2027 7961 7727  _z!=0) and 'yaw'
+000174f0: 2069 6e20 6e61 765f 6865 6164 6572 2061   in nav_header a
+00017500: 6e64 2027 7069 7463 6827 2069 6e20 6e61  nd 'pitch' in na
+00017510: 765f 6865 6164 6572 2061 6e64 2027 726f  v_header and 'ro
+00017520: 6c6c 2720 696e 206e 6176 5f68 6561 6465  ll' in nav_heade
+00017530: 723a 0a20 2020 2020 2020 2020 2020 2063  r:.            c
+00017540: 6f6d 7065 6e73 6174 4f66 6673 6574 7320  ompensatOffsets 
+00017550: 3d20 5472 7565 0a0a 2020 2020 2020 2020  = True..        
+00017560: 2320 6368 6563 6b20 6966 2066 6f72 206d  # check if for m
+00017570: 6973 7369 6e67 2066 6965 6c64 7320 7468  issing fields th
+00017580: 6572 6520 6172 6520 636f 6e73 7420 7661  ere are const va
+00017590: 6c75 6573 2069 6e20 6865 6164 6572 0a20  lues in header. 
+000175a0: 2020 2020 2020 2063 6f6e 7374 5f76 616c         const_val
+000175b0: 7565 7320 3d20 7b7d 0a20 2020 2020 2020  ues = {}.       
+000175c0: 2066 6f72 206e 6176 4669 656c 6420 696e   for navField in
+000175d0: 206d 6971 7476 2e70 6f73 5f68 6561 6465   miqtv.pos_heade
+000175e0: 725b 276d 6172 6971 7427 5d3a 0a20 2020  r['mariqt']:.   
+000175f0: 2020 2020 2020 2020 2072 6573 7065 6374           respect
+00017600: 6976 6548 6561 6465 7246 6965 6c64 203d  iveHeaderField =
+00017610: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
+00017620: 725b 226d 6172 6971 7422 5d5b 6e61 7646  r["mariqt"][navF
+00017630: 6965 6c64 5d0a 2020 2020 2020 2020 2020  ield].          
+00017640: 2020 6966 206e 6176 4669 656c 6420 6e6f    if navField no
+00017650: 7420 696e 206e 6176 5f68 6561 6465 7220  t in nav_header 
+00017660: 616e 6420 2872 6573 7065 6374 6976 6548  and (respectiveH
+00017670: 6561 6465 7246 6965 6c64 2069 6e20 7365  eaderField in se
+00017680: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00017690: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+000176a0: 6579 5d20 616e 6420 7365 6c66 2e66 696e  ey] and self.fin
+000176b0: 6454 6d70 4669 656c 6432 2872 6573 7065  dTmpField2(respe
+000176c0: 6374 6976 6548 6561 6465 7246 6965 6c64  ctiveHeaderField
+000176d0: 2920 213d 2022 2229 3a20 0a20 2020 2020  ) != ""): .     
+000176e0: 2020 2020 2020 2020 2020 2063 6f6e 7374             const
+000176f0: 5f76 616c 7565 735b 6e61 7646 6965 6c64  _values[navField
+00017700: 5d20 3d20 7365 6c66 2e66 696e 6454 6d70  ] = self.findTmp
+00017710: 4669 656c 6428 7265 7370 6563 7469 7665  Field(respective
+00017720: 4865 6164 6572 4669 656c 6429 0a0a 2020  HeaderField)..  
+00017730: 2020 2020 2020 2023 2068 616e 646c 6520         # handle 
+00017740: 616c 7420 7673 2064 6570 0a20 2020 2020  alt vs dep.     
+00017750: 2020 2069 6620 2761 6c74 2720 696e 206e     if 'alt' in n
+00017760: 6176 5f68 6561 6465 7220 616e 6420 2764  av_header and 'd
+00017770: 6570 2720 696e 206e 6176 5f68 6561 6465  ep' in nav_heade
+00017780: 723a 0a20 2020 2020 2020 2020 2020 2072  r:.            r
+00017790: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
+000177a0: 7863 6570 7469 6f6e 2822 2761 6c74 2720  xception("'alt' 
+000177b0: 616e 6420 2764 6570 2720 7072 6f76 6964  and 'dep' provid
+000177c0: 6564 2e20 5265 6475 6e64 616e 742c 2061  ed. Redundant, a
+000177d0: 6c74 203d 202d 2064 6570 2e20 5072 6f76  lt = - dep. Prov
+000177e0: 6964 6564 206f 6e6c 7920 6f6e 6520 6f66  ided only one of
+000177f0: 2062 6f74 682e 2229 0a20 2020 2020 2020   both.").       
+00017800: 200a 2020 2020 2020 2020 2320 4c6f 6164   .        # Load
+00017810: 206e 6176 6967 6174 696f 6e20 6461 7461   navigation data
+00017820: 2028 6966 2027 616c 7427 2069 6e73 7465   (if 'alt' inste
+00017830: 6164 206f 6620 2764 6570 272c 2069 7473  ad of 'dep', its
+00017840: 2061 7574 6f6d 6174 6963 616c 6c79 2069   automatically i
+00017850: 6e76 6572 7465 6429 0a20 2020 2020 2020  nverted).       
+00017860: 206e 6176 5f64 6174 612c 2070 6172 7365   nav_data, parse
+00017870: 4d73 6720 3d20 6d69 7174 6e2e 7265 6164  Msg = miqtn.read
+00017880: 416c 6c50 6f73 6974 696f 6e73 4672 6f6d  AllPositionsFrom
+00017890: 4669 6c65 5061 7468 286e 6176 5f70 6174  FilePath(nav_pat
+000178a0: 682c 206e 6176 5f68 6561 6465 722c 2064  h, nav_header, d
+000178b0: 6174 655f 666f 726d 6174 2c63 6f6c 5f73  ate_format,col_s
+000178c0: 6570 6172 6174 6f72 3d63 6f6c 5f73 6570  eparator=col_sep
+000178d0: 6172 6174 6f72 2c63 6f6e 7374 5f76 616c  arator,const_val
+000178e0: 7565 733d 636f 6e73 745f 7661 6c75 6573  ues=const_values
+000178f0: 290a 2020 2020 2020 2020 6966 2070 6172  ).        if par
+00017900: 7365 4d73 6720 213d 2022 223a 0a20 2020  seMsg != "":.   
+00017910: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+00017920: 6f76 2e6c 6f67 2870 6172 7365 4d73 672c  ov.log(parseMsg,
+00017930: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
+00017940: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00017950: 6e4d 7367 203d 2022 5c6e 2220 2b20 7061  nMsg = "\n" + pa
+00017960: 7273 654d 7367 0a0a 2020 2020 2020 2020  rseMsg..        
+00017970: 2320 6669 6e64 2066 6f72 2065 6163 6820  # find for each 
+00017980: 696d 6167 6520 7468 6520 7265 7370 6563  image the respec
+00017990: 7469 7665 206e 6176 6967 6174 696f 6e20  tive navigation 
+000179a0: 6461 7461 0a20 2020 2020 2020 2073 2e73  data.        s.s
+000179b0: 746f 7028 290a 2020 2020 2020 2020 7375  top().        su
+000179c0: 6363 6573 732c 2069 6d61 6765 5f64 7473  ccess, image_dts
+000179d0: 2c20 6d73 6720 3d20 7365 6c66 2e66 696e  , msg = self.fin
+000179e0: 644e 6176 4461 7461 466f 7249 6d61 6765  dNavDataForImage
+000179f0: 286e 6176 5f64 6174 612c 7669 6465 6f53  (nav_data,videoS
+00017a00: 616d 706c 6553 6563 6f6e 6473 290a 2020  ampleSeconds).  
+00017a10: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+00017a20: 6c6f 6728 6d73 672c 646f 6e74 5368 6f77  log(msg,dontShow
+00017a30: 3d54 7275 6529 0a20 2020 2020 2020 2069  =True).        i
+00017a40: 6620 6d73 6720 213d 2022 223a 0a20 2020  f msg != "":.   
+00017a50: 2020 2020 2020 2020 2072 6574 7572 6e4d           returnM
+00017a60: 7367 202b 3d20 225c 6e22 202b 206d 7367  sg += "\n" + msg
+00017a70: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00017a80: 7375 6363 6573 733a 0a20 2020 2020 2020  success:.       
+00017a90: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00017aa0: 652c 2072 6574 7572 6e4d 7367 0a20 2020  e, returnMsg.   
+00017ab0: 2020 2020 2073 203d 206d 6971 7463 2e50       s = miqtc.P
+00017ac0: 7269 6e74 4c6f 6164 696e 674d 7367 2822  rintLoadingMsg("
+00017ad0: 4372 6561 7469 6e67 2069 7465 6d73 2720  Creating items' 
+00017ae0: 6e61 7669 6761 7469 6f6e 2064 6174 6122  navigation data"
+00017af0: 290a 0a20 2020 2020 2020 2023 2069 6e76  )..        # inv
+00017b00: 6572 7420 7661 6c75 6573 2028 6966 206e  ert values (if n
+00017b10: 6565 6465 6429 2062 6566 6f72 6520 6c65  eeded) before le
+00017b20: 7665 7261 726d 2063 6f6d 7065 6e73 6174  verarm compensat
+00017b30: 696f 6e0a 2020 2020 2020 2020 6966 2072  ion.        if r
+00017b40: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
+00017b50: 6420 213d 205b 5d3a 0a20 2020 2020 2020  d != []:.       
+00017b60: 2020 2020 2066 6f72 2066 696c 6520 696e       for file in
+00017b70: 2069 6d61 6765 5f64 7473 3a0a 2020 2020   image_dts:.    
+00017b80: 2020 2020 2020 2020 2020 2020 706f 7369              posi
+00017b90: 7469 6f6e 7320 3d20 696d 6167 655f 6474  tions = image_dt
+00017ba0: 735b 6669 6c65 5d0a 2020 2020 2020 2020  s[file].        
+00017bb0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+00017bc0: 2072 616e 6765 286c 656e 2870 6f73 6974   range(len(posit
+00017bd0: 696f 6e73 2929 3a0a 2020 2020 2020 2020  ions)):.        
+00017be0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00017bf0: 6c61 7427 2069 6e20 7265 636f 7264 7332  lat' in records2
+00017c00: 6265 496e 7665 7274 6564 3a0a 2020 2020  beInverted:.    
+00017c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c20: 2020 2020 706f 7369 7469 6f6e 735b 695d      positions[i]
+00017c30: 2e6c 6174 202a 3d20 2d31 0a20 2020 2020  .lat *= -1.     
+00017c40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00017c50: 6620 276c 6f6e 2720 696e 2072 6563 6f72  f 'lon' in recor
+00017c60: 6473 3262 6549 6e76 6572 7465 643a 0a20  ds2beInverted:. 
+00017c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c80: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
+00017c90: 5b69 5d2e 6c6f 6e20 2a3d 202d 310a 2020  [i].lon *= -1.  
+00017ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017cb0: 2020 6966 2028 2764 6570 2720 696e 2072    if ('dep' in r
+00017cc0: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
+00017cd0: 6420 616e 6420 2764 6570 2720 696e 206e  d and 'dep' in n
+00017ce0: 6176 5f68 6561 6465 7229 206f 7220 2827  av_header) or ('
+00017cf0: 616c 7427 2069 6e20 7265 636f 7264 7332  alt' in records2
+00017d00: 6265 496e 7665 7274 6564 2061 6e64 2027  beInverted and '
+00017d10: 616c 7427 2069 6e20 6e61 765f 6865 6164  alt' in nav_head
+00017d20: 6572 293a 0a20 2020 2020 2020 2020 2020  er):.           
+00017d30: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
+00017d40: 6974 696f 6e73 5b69 5d2e 6465 7020 2a3d  itions[i].dep *=
+00017d50: 202d 310a 2020 2020 2020 2020 2020 2020   -1.            
+00017d60: 2020 2020 2020 2020 6966 2027 6867 7427          if 'hgt'
+00017d70: 2069 6e20 7265 636f 7264 7332 6265 496e   in records2beIn
+00017d80: 7665 7274 6564 3a0a 2020 2020 2020 2020  verted:.        
+00017d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017da0: 706f 7369 7469 6f6e 735b 695d 2e68 6774  positions[i].hgt
+00017db0: 202a 3d20 2d31 0a0a 0a20 2020 2020 2020   *= -1...       
+00017dc0: 2023 2063 6f6d 7065 6e73 6174 6520 6c65   # compensate le
+00017dd0: 7665 7261 726d 206f 6666 7365 7473 0a20  verarm offsets. 
+00017de0: 2020 2020 2020 2069 6620 636f 6d70 656e         if compen
+00017df0: 7361 744f 6666 7365 7473 3a0a 0a20 2020  satOffsets:..   
+00017e00: 2020 2020 2020 2020 2023 206c 6f61 6420           # load 
+00017e10: 6672 616d 6520 6174 7469 7475 6465 2064  frame attitude d
+00017e20: 6174 6120 6672 6f6d 2066 696c 650a 2020  ata from file.  
+00017e30: 2020 2020 2020 2020 2020 6174 745f 6461            att_da
+00017e40: 7461 2c20 7061 7273 654d 7367 203d 206d  ta, parseMsg = m
+00017e50: 6971 746e 2e72 6561 6441 6c6c 4174 7469  iqtn.readAllAtti
+00017e60: 7475 6465 7346 726f 6d46 696c 6550 6174  tudesFromFilePat
+00017e70: 6828 6e61 765f 7061 7468 2c20 6e61 765f  h(nav_path, nav_
+00017e80: 6865 6164 6572 2c20 6461 7465 5f66 6f72  header, date_for
+00017e90: 6d61 742c 636f 6c5f 7365 7061 7261 746f  mat,col_separato
+00017ea0: 723d 636f 6c5f 7365 7061 7261 746f 722c  r=col_separator,
+00017eb0: 636f 6e73 745f 7661 6c75 6573 3d63 6f6e  const_values=con
+00017ec0: 7374 5f76 616c 7565 732c 616e 676c 6573  st_values,angles
+00017ed0: 496e 5261 643d 616e 676c 6573 5f69 6e5f  InRad=angles_in_
+00017ee0: 7261 6429 0a20 2020 2020 2020 2020 2020  rad).           
+00017ef0: 2069 6620 7061 7273 654d 7367 2021 3d20   if parseMsg != 
+00017f00: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
+00017f10: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+00017f20: 6728 7061 7273 654d 7367 2c64 6f6e 7453  g(parseMsg,dontS
+00017f30: 686f 773d 5472 7565 290a 2020 2020 2020  how=True).      
+00017f40: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00017f50: 4d73 6720 2b3d 2022 5c6e 2220 2b20 7061  Msg += "\n" + pa
+00017f60: 7273 654d 7367 0a0a 2020 2020 2020 2020  rseMsg..        
+00017f70: 2020 2020 6966 2072 6563 6f72 6473 3262      if records2b
+00017f80: 6549 6e76 6572 7465 6420 213d 205b 5d3a  eInverted != []:
+00017f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017fa0: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
+00017fb0: 6765 5f64 7473 3a0a 2020 2020 2020 2020  ge_dts:.        
+00017fc0: 2020 2020 2020 2020 2020 2020 6174 7469              atti
+00017fd0: 7475 6465 7320 3d20 696d 6167 655f 6474  tudes = image_dt
+00017fe0: 735f 6174 745b 6669 6c65 5d0a 2020 2020  s_att[file].    
+00017ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018000: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
+00018010: 656e 2870 6f73 6974 696f 6e73 2929 3a0a  en(positions)):.
+00018020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018030: 2020 2020 2020 2020 6966 2027 7961 7727          if 'yaw'
+00018040: 2069 6e20 2072 6563 6f72 6473 3262 6549   in  records2beI
+00018050: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
+00018060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018070: 2020 2020 2061 7474 6974 7564 6573 5b69       attitudes[i
+00018080: 5d2e 7961 7720 2a3d 202d 310a 2020 2020  ].yaw *= -1.    
+00018090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000180a0: 2020 2020 6966 2027 7069 7463 6827 2069      if 'pitch' i
+000180b0: 6e20 2072 6563 6f72 6473 3262 6549 6e76  n  records2beInv
+000180c0: 6572 7465 643a 0a20 2020 2020 2020 2020  erted:.         
+000180d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000180e0: 2020 2061 7474 6974 7564 6573 5b69 5d2e     attitudes[i].
+000180f0: 7069 7463 6820 2a3d 202d 310a 2020 2020  pitch *= -1.    
+00018100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018110: 2020 2020 6966 2027 726f 6c6c 2720 696e      if 'roll' in
+00018120: 2020 7265 636f 7264 7332 6265 496e 7665    records2beInve
+00018130: 7274 6564 3a0a 2020 2020 2020 2020 2020  rted:.          
+00018140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018150: 2020 6174 7469 7475 6465 735b 695d 2e72    attitudes[i].r
+00018160: 6f6c 6c20 2a3d 202d 310a 0a20 2020 2020  oll *= -1..     
+00018170: 2020 2020 2020 2023 2066 696e 6420 666f         # find fo
+00018180: 7220 6561 6368 2069 6d61 6765 2074 6865  r each image the
+00018190: 2072 6573 7065 6374 6976 6520 6e61 7669   respective navi
+000181a0: 6761 7469 6f6e 2064 6174 610a 2020 2020  gation data.    
+000181b0: 2020 2020 2020 2020 7375 6363 6573 732c          success,
+000181c0: 2069 6d61 6765 5f64 7473 5f61 7474 2c20   image_dts_att, 
+000181d0: 6d73 6720 3d20 7365 6c66 2e66 696e 644e  msg = self.findN
+000181e0: 6176 4461 7461 466f 7249 6d61 6765 2861  avDataForImage(a
+000181f0: 7474 5f64 6174 612c 7669 6465 6f53 616d  tt_data,videoSam
+00018200: 706c 6553 6563 6f6e 6473 290a 2020 2020  pleSeconds).    
+00018210: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+00018220: 762e 6c6f 6728 6d73 672c 646f 6e74 5368  v.log(msg,dontSh
+00018230: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
+00018240: 2020 2020 2069 6620 6d73 6720 213d 2022       if msg != "
+00018250: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00018260: 2020 2072 6574 7572 6e4d 7367 202b 3d20     returnMsg += 
+00018270: 225c 6e22 202b 206d 7367 0a20 2020 2020  "\n" + msg.     
+00018280: 2020 2020 2020 2069 6620 6e6f 7420 7375         if not su
+00018290: 6363 6573 733a 0a20 2020 2020 2020 2020  ccess:.         
+000182a0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+000182b0: 6c73 652c 2072 6574 7572 6e4d 7367 0a0a  lse, returnMsg..
+000182c0: 2020 2020 2020 2020 2020 2020 2320 636f              # co
+000182d0: 6d70 656e 7361 7465 0a20 2020 2020 2020  mpensate.       
+000182e0: 2020 2020 2066 6f72 2066 696c 6520 696e       for file in
+000182f0: 2069 6d61 6765 5f64 7473 3a0a 2020 2020   image_dts:.    
+00018300: 2020 2020 2020 2020 2020 2020 706f 7369              posi
+00018310: 7469 6f6e 7320 3d20 696d 6167 655f 6474  tions = image_dt
+00018320: 735b 6669 6c65 5d0a 2020 2020 2020 2020  s[file].        
+00018330: 2020 2020 2020 2020 6174 7469 7475 6465          attitude
+00018340: 7320 3d20 696d 6167 655f 6474 735f 6174  s = image_dts_at
+00018350: 745b 6669 6c65 5d0a 2020 2020 2020 2020  t[file].        
+00018360: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+00018370: 2072 616e 6765 286c 656e 2870 6f73 6974   range(len(posit
+00018380: 696f 6e73 2929 3a0a 2020 2020 2020 2020  ions)):.        
+00018390: 2020 2020 2020 2020 2020 2020 6c61 7420              lat 
+000183a0: 3d20 706f 7369 7469 6f6e 735b 695d 2e6c  = positions[i].l
+000183b0: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
+000183c0: 2020 2020 2020 206c 6f6e 203d 2070 6f73         lon = pos
+000183d0: 6974 696f 6e73 5b69 5d2e 6c6f 6e0a 2020  itions[i].lon.  
+000183e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000183f0: 2020 6465 7020 3d20 706f 7369 7469 6f6e    dep = position
+00018400: 735b 695d 2e64 6570 0a20 2020 2020 2020  s[i].dep.       
+00018410: 2020 2020 2020 2020 2020 2020 2068 6774               hgt
+00018420: 203d 2070 6f73 6974 696f 6e73 5b69 5d2e   = positions[i].
+00018430: 6867 740a 2020 2020 2020 2020 2020 2020  hgt.            
+00018440: 2020 2020 2020 2020 7961 7720 3d20 6174          yaw = at
+00018450: 7469 7475 6465 735b 695d 2e79 6177 0a20  titudes[i].yaw. 
+00018460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018470: 2020 2070 6974 6368 203d 2061 7474 6974     pitch = attit
+00018480: 7564 6573 5b69 5d2e 7069 7463 680a 2020  udes[i].pitch.  
+00018490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184a0: 2020 726f 6c6c 203d 2061 7474 6974 7564    roll = attitud
+000184b0: 6573 5b69 5d2e 726f 6c6c 0a20 2020 2020  es[i].roll.     
+000184c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000184d0: 6620 7961 7720 6973 204e 6f6e 6520 6f72  f yaw is None or
+000184e0: 2070 6974 6368 2069 7320 4e6f 6e65 206f   pitch is None o
+000184f0: 7220 726f 6c6c 2069 7320 4e6f 6e65 3a0a  r roll is None:.
+00018500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018510: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00018520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018530: 2020 2020 206e 6577 5f6c 6174 2c6e 6577       new_lat,new
+00018540: 5f6c 6f6e 2c6e 6577 5f64 6570 2c6e 6577  _lon,new_dep,new
+00018550: 5f68 6774 203d 206d 6971 7467 2e61 6464  _hgt = miqtg.add
+00018560: 4c65 7665 7261 726d 7332 4c61 744c 6f6e  Leverarms2LatLon
+00018570: 4465 7041 6c74 286c 6174 2c6c 6f6e 2c64  DepAlt(lat,lon,d
+00018580: 6570 2c68 6774 2c6f 6666 7365 745f 782c  ep,hgt,offset_x,
+00018590: 6f66 6673 6574 5f79 2c6f 6666 7365 745f  offset_y,offset_
+000185a0: 7a2c 7961 772c 7069 7463 682c 726f 6c6c  z,yaw,pitch,roll
+000185b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000185c0: 2020 2020 2020 706f 7369 7469 6f6e 735b        positions[
+000185d0: 695d 2e6c 6174 203d 206e 6577 5f6c 6174  i].lat = new_lat
+000185e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000185f0: 2020 2020 2070 6f73 6974 696f 6e73 5b69       positions[i
+00018600: 5d2e 6c6f 6e20 3d20 6e65 775f 6c6f 6e0a  ].lon = new_lon.
+00018610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018620: 2020 2020 706f 7369 7469 6f6e 735b 695d      positions[i]
+00018630: 2e64 6570 203d 206e 6577 5f64 6570 0a20  .dep = new_dep. 
+00018640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018650: 2020 2070 6f73 6974 696f 6e73 5b69 5d2e     positions[i].
+00018660: 6867 7420 3d20 6e65 775f 6867 740a 0a20  hgt = new_hgt.. 
+00018670: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00018680: 7072 6f76 2e6c 6f67 2822 6170 706c 6965  prov.log("applie
+00018690: 6420 6c65 7665 7220 6172 6d20 636f 6d70  d lever arm comp
+000186a0: 656e 7361 7469 6f6e 2078 2c79 2c7a 203d  ensation x,y,z =
+000186b0: 2022 202b 2073 7472 286f 6666 7365 745f   " + str(offset_
+000186c0: 7829 202b 2022 2c22 202b 2073 7472 286f  x) + "," + str(o
+000186d0: 6666 7365 745f 7929 202b 2022 2c22 202b  ffset_y) + "," +
+000186e0: 2073 7472 286f 6666 7365 745f 7a29 2c64   str(offset_z),d
+000186f0: 6f6e 7453 686f 773d 5472 7565 290a 0a20  ontShow=True).. 
+00018700: 2020 2020 2020 2069 6620 6c65 6e28 696d         if len(im
+00018710: 6167 655f 6474 7329 203e 2030 3a0a 2020  age_dts) > 0:.  
+00018720: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
+00018730: 6b20 7768 6574 6865 7220 6465 7074 6820  k whether depth 
+00018740: 616e 6420 6865 6967 6874 2061 7265 2073  and height are s
+00018750: 6574 0a20 2020 2020 2020 2020 2020 206c  et.            l
+00018760: 6174 5f69 6465 6e74 6963 616c 2c20 6c6f  at_identical, lo
+00018770: 6e5f 6964 656e 7469 6361 6c2c 2064 6570  n_identical, dep
+00018780: 5f69 6465 6e74 6963 616c 2c20 6867 745f  _identical, hgt_
+00018790: 6964 656e 7469 6361 6c2c 2064 6570 5f6e  identical, dep_n
+000187a0: 6f74 5f7a 6572 6f2c 2068 6774 5f6e 6f74  ot_zero, hgt_not
+000187b0: 5f7a 6572 6f2c 756e 6365 7274 5f6e 6f74  _zero,uncert_not
+000187c0: 5f7a 6572 6f20 3d20 6e61 765f 6461 7461  _zero = nav_data
+000187d0: 2e63 6865 636b 506f 7369 7469 6f6e 7343  .checkPositionsC
+000187e0: 6f6e 7465 6e74 2829 0a0a 2020 2020 2020  ontent()..      
+000187f0: 2020 2020 2020 2320 5772 6974 6520 746f        # Write to
+00018800: 206e 6176 6967 6174 696f 6e20 7478 7420   navigation txt 
+00018810: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
+00018820: 2023 2068 6561 6465 720a 2020 2020 2020   # header.      
+00018830: 2020 2020 2020 7265 7320 3d20 6f70 656e        res = open
+00018840: 2873 656c 662e 6765 745f 696e 745f 6e61  (self.get_int_na
+00018850: 765f 6669 6c65 2829 2c20 2277 2229 0a20  v_file(), "w"). 
+00018860: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
+00018870: 7269 7465 286d 6971 7476 2e63 6f6c 5f68  rite(miqtv.col_h
+00018880: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00018890: 2769 6d67 275d 2b22 5c74 222b 6d69 7174  'img']+"\t"+miqt
+000188a0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+000188b0: 7269 7174 275d 5b27 7574 6327 5d29 0a0a  riqt']['utc'])..
+000188c0: 2020 2020 2020 2020 2020 2020 6861 735f              has_
+000188d0: 616c 7420 3d20 5472 7565 2069 6620 6465  alt = True if de
+000188e0: 705f 6e6f 745f 7a65 726f 2061 6e64 2028  p_not_zero and (
+000188f0: 2027 6465 7027 2069 6e20 6e61 765f 6865   'dep' in nav_he
+00018900: 6164 6572 206f 7220 2761 6c74 2720 696e  ader or 'alt' in
+00018910: 206e 6176 5f68 6561 6465 7220 2920 656c   nav_header ) el
+00018920: 7365 2046 616c 7365 0a0a 2020 2020 2020  se False..      
+00018930: 2020 2020 2020 6966 2027 6c61 7427 2069        if 'lat' i
+00018940: 6e20 6e61 765f 6865 6164 6572 3a0a 2020  n nav_header:.  
+00018950: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00018960: 732e 7772 6974 6528 225c 7422 2b6d 6971  s.write("\t"+miq
+00018970: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00018980: 6172 6971 7427 5d5b 276c 6174 275d 290a  ariqt']['lat']).
+00018990: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+000189a0: 6c6f 6e27 2069 6e20 6e61 765f 6865 6164  lon' in nav_head
+000189b0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+000189c0: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
+000189d0: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
+000189e0: 6465 725b 276d 6172 6971 7427 5d5b 276c  der['mariqt']['l
+000189f0: 6f6e 275d 290a 2020 2020 2020 2020 2020  on']).          
+00018a00: 2020 6966 2068 6173 5f61 6c74 3a0a 2020    if has_alt:.  
+00018a10: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00018a20: 732e 7772 6974 6528 225c 7422 2b6d 6971  s.write("\t"+miq
+00018a30: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00018a40: 6172 6971 7427 5d5b 2761 6c74 275d 290a  ariqt']['alt']).
+00018a50: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+00018a60: 6774 5f6e 6f74 5f7a 6572 6f20 616e 6420  gt_not_zero and 
+00018a70: 2768 6774 2720 696e 206e 6176 5f68 6561  'hgt' in nav_hea
+00018a80: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
+00018a90: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00018aa0: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
+00018ab0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00018ac0: 6867 7427 5d29 0a20 2020 2020 2020 2020  hgt']).         
+00018ad0: 2020 2069 6620 756e 6365 7274 5f6e 6f74     if uncert_not
+00018ae0: 5f7a 6572 6f20 616e 6420 2775 6e63 6572  _zero and 'uncer
+00018af0: 7427 2069 6e20 6e61 765f 6865 6164 6572  t' in nav_header
+00018b00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018b10: 2020 7265 732e 7772 6974 6528 225c 7422    res.write("\t"
+00018b20: 2b6d 6971 7476 2e63 6f6c 5f68 6561 6465  +miqtv.col_heade
+00018b30: 725b 276d 6172 6971 7427 5d5b 2775 6e63  r['mariqt']['unc
+00018b40: 6572 7427 5d29 0a20 2020 2020 2020 2020  ert']).         
+00018b50: 2020 2072 6573 2e77 7269 7465 2822 5c6e     res.write("\n
+00018b60: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
+00018b70: 2064 6174 6120 6c69 6e65 730a 2020 2020   data lines.    
+00018b80: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+00018b90: 2069 6e20 696d 6167 655f 6474 733a 0a20   in image_dts:. 
+00018ba0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00018bb0: 6f72 2074 696d 6570 6f69 6e74 2069 6e20  or timepoint in 
+00018bc0: 696d 6167 655f 6474 735b 6669 6c65 5d3a  image_dts[file]:
+00018bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018be0: 2020 2020 2072 6573 2e77 7269 7465 2866       res.write(f
+00018bf0: 696c 652b 225c 7422 2b74 696d 6570 6f69  ile+"\t"+timepoi
+00018c00: 6e74 2e64 6174 6554 696d 6528 292e 7374  nt.dateTime().st
+00018c10: 7266 7469 6d65 286d 6971 7476 2e64 6174  rftime(miqtv.dat
+00018c20: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
+00018c30: 7427 5d29 2920 0a20 2020 2020 2020 2020  t'])) .         
+00018c40: 2020 2020 2020 2020 2020 2069 6620 276c             if 'l
+00018c50: 6174 2720 696e 206e 6176 5f68 6561 6465  at' in nav_heade
+00018c60: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00018c70: 2020 2020 2020 2020 2020 2076 616c 203d             val =
+00018c80: 2074 696d 6570 6f69 6e74 2e6c 6174 0a20   timepoint.lat. 
+00018c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ca0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00018cb0: 2822 5c74 222b 7374 7228 7661 6c29 290a  ("\t"+str(val)).
+00018cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018cd0: 2020 2020 6966 2027 6c6f 6e27 2069 6e20      if 'lon' in 
+00018ce0: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
+00018cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d00: 2020 2020 7661 6c20 3d20 7469 6d65 706f      val = timepo
+00018d10: 696e 742e 6c6f 6e0a 2020 2020 2020 2020  int.lon.        
+00018d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d30: 7265 732e 7772 6974 6528 225c 7422 2b73  res.write("\t"+s
+00018d40: 7472 2876 616c 2929 0a20 2020 2020 2020  tr(val)).       
+00018d50: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00018d60: 6861 735f 616c 743a 0a20 2020 2020 2020  has_alt:.       
+00018d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d80: 2076 616c 203d 2074 696d 6570 6f69 6e74   val = timepoint
+00018d90: 2e64 6570 0a20 2020 2020 2020 2020 2020  .dep.           
+00018da0: 2020 2020 2020 2020 2020 2020 2023 2064               # d
+00018db0: 6570 2074 6f20 616c 740a 2020 2020 2020  ep to alt.      
+00018dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018dd0: 2020 7661 6c20 2a3d 202d 310a 2020 2020    val *= -1.    
+00018de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018df0: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
+00018e00: 7422 2b73 7472 2876 616c 2929 0a20 2020  t"+str(val)).   
+00018e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018e20: 2069 6620 6867 745f 6e6f 745f 7a65 726f   if hgt_not_zero
+00018e30: 2061 6e64 2027 6867 7427 2069 6e20 6e61   and 'hgt' in na
+00018e40: 765f 6865 6164 6572 3a0a 2020 2020 2020  v_header:.      
+00018e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018e60: 2020 7661 6c20 3d20 7469 6d65 706f 696e    val = timepoin
+00018e70: 742e 6867 740a 2020 2020 2020 2020 2020  t.hgt.          
+00018e80: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00018e90: 732e 7772 6974 6528 225c 7422 2b73 7472  s.write("\t"+str
+00018ea0: 2876 616c 2929 0a20 2020 2020 2020 2020  (val)).         
+00018eb0: 2020 2020 2020 2020 2020 2069 6620 756e             if un
+00018ec0: 6365 7274 5f6e 6f74 5f7a 6572 6f20 616e  cert_not_zero an
+00018ed0: 6420 2775 6e63 6572 7427 2069 6e20 6e61  d 'uncert' in na
+00018ee0: 765f 6865 6164 6572 3a0a 2020 2020 2020  v_header:.      
+00018ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018f00: 2020 7661 6c20 3d20 7469 6d65 706f 696e    val = timepoin
+00018f10: 742e 756e 6365 7274 0a20 2020 2020 2020  t.uncert.       
+00018f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018f30: 2072 6573 2e77 7269 7465 2822 5c74 222b   res.write("\t"+
+00018f40: 7374 7228 7661 6c29 290a 2020 2020 2020  str(val)).      
+00018f50: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00018f60: 732e 7772 6974 6528 225c 6e22 290a 2020  s.write("\n").  
+00018f70: 2020 2020 2020 2020 2020 7265 732e 636c            res.cl
+00018f80: 6f73 6528 290a 0a20 2020 2020 2020 2020  ose()..         
+00018f90: 2020 2023 2057 7269 7465 2074 6f20 6765     # Write to ge
+00018fa0: 6f6a 736f 6e20 6669 6c65 0a20 2020 2020  ojson file.     
+00018fb0: 2020 2020 2020 2067 656f 6a73 6f6e 203d         geojson =
+00018fc0: 207b 2774 7970 6527 3a20 2746 6561 7475   {'type': 'Featu
+00018fd0: 7265 436f 6c6c 6563 7469 6f6e 272c 2027  reCollection', '
+00018fe0: 6e61 6d65 273a 2073 656c 662e 6469 722e  name': self.dir.
+00018ff0: 6576 656e 7428 292b 225f 222b 7365 6c66  event()+"_"+self
+00019000: 2e64 6972 2e73 656e 736f 7228 292b 225f  .dir.sensor()+"_
+00019010: 696d 6167 652d 6e61 7669 6761 7469 6f6e  image-navigation
+00019020: 222c 2027 6665 6174 7572 6573 273a 205b  ", 'features': [
+00019030: 5d7d 0a20 2020 2020 2020 2020 2020 2066  ]}.            f
+00019040: 6f72 2066 696c 6520 696e 2069 6d61 6765  or file in image
+00019050: 5f64 7473 3a0a 2020 2020 2020 2020 2020  _dts:.          
+00019060: 2020 2020 2020 2320 7068 6f74 6f0a 2020        # photo.  
+00019070: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00019080: 206c 656e 2869 6d61 6765 5f64 7473 5b66   len(image_dts[f
+00019090: 696c 655d 2920 3d3d 2031 3a0a 2020 2020  ile]) == 1:.    
+000190a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190b0: 6966 2064 6570 5f6e 6f74 5f7a 6572 6f3a  if dep_not_zero:
+000190c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000190d0: 2020 2020 2020 2020 2067 656f 6d65 7472           geometr
+000190e0: 7920 3d20 207b 2774 7970 6527 3a20 2250  y =  {'type': "P
+000190f0: 6f69 6e74 222c 2027 636f 6f72 6469 6e61  oint", 'coordina
+00019100: 7465 7327 3a20 0a20 2020 2020 2020 2020  tes': .         
+00019110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019120: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00019130: 666c 6f61 7428 696d 6167 655f 6474 735b  float(image_dts[
+00019140: 6669 6c65 5d5b 305d 2e6c 6f6e 292c 2066  file][0].lon), f
+00019150: 6c6f 6174 2869 6d61 6765 5f64 7473 5b66  loat(image_dts[f
+00019160: 696c 655d 5b30 5d2e 6c61 7429 2c20 2d31  ile][0].lat), -1
+00019170: 2a66 6c6f 6174 2869 6d61 6765 5f64 7473  *float(image_dts
+00019180: 5b66 696c 655d 5b30 5d2e 6465 7029 5d0a  [file][0].dep)].
 00019190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191a0: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-000191b0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000191c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191d0: 2020 2020 2020 2020 6765 6f6d 6574 7279          geometry
-000191e0: 203d 2020 7b27 7479 7065 273a 2022 506f   =  {'type': "Po
-000191f0: 696e 7422 2c20 2763 6f6f 7264 696e 6174  int", 'coordinat
-00019200: 6573 273a 200a 2020 2020 2020 2020 2020  es': .          
-00019210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019220: 2020 2020 2020 2020 2020 2020 2020 5b66                [f
-00019230: 6c6f 6174 2869 6d61 6765 5f64 7473 5b66  loat(image_dts[f
-00019240: 696c 655d 5b30 5d2e 6c6f 6e29 2c20 666c  ile][0].lon), fl
-00019250: 6f61 7428 696d 6167 655f 6474 735b 6669  oat(image_dts[fi
-00019260: 6c65 5d5b 305d 2e6c 6174 295d 0a20 2020  le][0].lat)].   
-00019270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191b0: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+000191c0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000191d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191e0: 2020 2020 2020 2020 6765 6f6d 6574 7279          geometry
+000191f0: 203d 2020 7b27 7479 7065 273a 2022 506f   =  {'type': "Po
+00019200: 696e 7422 2c20 2763 6f6f 7264 696e 6174  int", 'coordinat
+00019210: 6573 273a 200a 2020 2020 2020 2020 2020  es': .          
+00019220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019230: 2020 2020 2020 2020 2020 2020 2020 5b66                [f
+00019240: 6c6f 6174 2869 6d61 6765 5f64 7473 5b66  loat(image_dts[f
+00019250: 696c 655d 5b30 5d2e 6c6f 6e29 2c20 666c  ile][0].lon), fl
+00019260: 6f61 7428 696d 6167 655f 6474 735b 6669  oat(image_dts[fi
+00019270: 6c65 5d5b 305d 2e6c 6174 295d 0a20 2020  le][0].lat)].   
 00019280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019290: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
-000192a0: 2020 2020 2020 2069 6620 5472 7565 2069         if True i
-000192b0: 6e20 5b6d 6174 682e 6973 6e61 6e28 7829  n [math.isnan(x)
-000192c0: 2066 6f72 2078 2069 6e20 6765 6f6d 6574   for x in geomet
-000192d0: 7279 5b27 636f 6f72 6469 6e61 7465 7327  ry['coordinates'
-000192e0: 5d5d 3a0a 2020 2020 2020 2020 2020 2020  ]]:.            
-000192f0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00019300: 696e 7565 0a0a 2020 2020 2020 2020 2020  inue..          
-00019310: 2020 2020 2020 2320 7669 6465 6f0a 2020        # video.  
-00019320: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00019330: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00019340: 2020 2020 2020 2020 6966 2064 6570 5f6e          if dep_n
-00019350: 6f74 5f7a 6572 6f3a 0a20 2020 2020 2020  ot_zero:.       
-00019360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019370: 2067 656f 6d65 7472 7920 3d20 207b 2774   geometry =  {'t
-00019380: 7970 6527 3a20 224d 756c 7469 506f 696e  ype': "MultiPoin
-00019390: 7422 2c20 2763 6f6f 7264 696e 6174 6573  t", 'coordinates
-000193a0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-000193b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193c0: 2020 2020 2020 2020 2020 205b 5b66 6c6f             [[flo
-000193d0: 6174 2864 2e6c 6f6e 292c 2066 6c6f 6174  at(d.lon), float
-000193e0: 2864 2e6c 6174 292c 202d 312a 666c 6f61  (d.lat), -1*floa
-000193f0: 7428 642e 6465 7029 5d20 666f 7220 6420  t(d.dep)] for d 
-00019400: 696e 2069 6d61 6765 5f64 7473 5b66 696c  in image_dts[fil
-00019410: 655d 5d0a 2020 2020 2020 2020 2020 2020  e]].            
-00019420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019430: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00019440: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00019450: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00019460: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
-00019470: 6574 7279 203d 2020 7b27 7479 7065 273a  etry =  {'type':
-00019480: 2022 4d75 6c74 6950 6f69 6e74 222c 2027   "MultiPoint", '
-00019490: 636f 6f72 6469 6e61 7465 7327 3a0a 2020  coordinates':.  
-000194a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192a0: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
+000192b0: 2020 2020 2020 2069 6620 5472 7565 2069         if True i
+000192c0: 6e20 5b6d 6174 682e 6973 6e61 6e28 7829  n [math.isnan(x)
+000192d0: 2066 6f72 2078 2069 6e20 6765 6f6d 6574   for x in geomet
+000192e0: 7279 5b27 636f 6f72 6469 6e61 7465 7327  ry['coordinates'
+000192f0: 5d5d 3a0a 2020 2020 2020 2020 2020 2020  ]]:.            
+00019300: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00019310: 696e 7565 0a0a 2020 2020 2020 2020 2020  inue..          
+00019320: 2020 2020 2020 2320 7669 6465 6f0a 2020        # video.  
+00019330: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00019340: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00019350: 2020 2020 2020 2020 6966 2064 6570 5f6e          if dep_n
+00019360: 6f74 5f7a 6572 6f3a 0a20 2020 2020 2020  ot_zero:.       
+00019370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019380: 2067 656f 6d65 7472 7920 3d20 207b 2774   geometry =  {'t
+00019390: 7970 6527 3a20 224d 756c 7469 506f 696e  ype': "MultiPoin
+000193a0: 7422 2c20 2763 6f6f 7264 696e 6174 6573  t", 'coordinates
+000193b0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+000193c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193d0: 2020 2020 2020 2020 2020 205b 5b66 6c6f             [[flo
+000193e0: 6174 2864 2e6c 6f6e 292c 2066 6c6f 6174  at(d.lon), float
+000193f0: 2864 2e6c 6174 292c 202d 312a 666c 6f61  (d.lat), -1*floa
+00019400: 7428 642e 6465 7029 5d20 666f 7220 6420  t(d.dep)] for d 
+00019410: 696e 2069 6d61 6765 5f64 7473 5b66 696c  in image_dts[fil
+00019420: 655d 5d0a 2020 2020 2020 2020 2020 2020  e]].            
+00019430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019440: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00019450: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00019460: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00019470: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
+00019480: 6574 7279 203d 2020 7b27 7479 7065 273a  etry =  {'type':
+00019490: 2022 4d75 6c74 6950 6f69 6e74 222c 2027   "MultiPoint", '
+000194a0: 636f 6f72 6469 6e61 7465 7327 3a0a 2020  coordinates':.  
 000194b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194c0: 2020 2020 2020 5b5b 666c 6f61 7428 642e        [[float(d.
-000194d0: 6c6f 6e29 2c20 666c 6f61 7428 642e 6c61  lon), float(d.la
-000194e0: 7429 5d20 666f 7220 6420 696e 2069 6d61  t)] for d in ima
-000194f0: 6765 5f64 7473 5b66 696c 655d 5d0a 2020  ge_dts[file]].  
-00019500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194d0: 2020 2020 2020 5b5b 666c 6f61 7428 642e        [[float(d.
+000194e0: 6c6f 6e29 2c20 666c 6f61 7428 642e 6c61  lon), float(d.la
+000194f0: 7429 5d20 666f 7220 6420 696e 2069 6d61  t)] for d in ima
+00019500: 6765 5f64 7473 5b66 696c 655d 5d0a 2020  ge_dts[file]].  
 00019510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019520: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
-00019530: 2020 2020 2020 2020 6966 2054 7275 6520          if True 
-00019540: 696e 205b 6d61 7468 2e69 736e 616e 2878  in [math.isnan(x
-00019550: 2920 666f 7220 7820 696e 205b 6974 656d  ) for x in [item
-00019560: 2066 6f72 2073 7562 6c69 7374 2069 6e20   for sublist in 
-00019570: 6765 6f6d 6574 7279 5b27 636f 6f72 6469  geometry['coordi
-00019580: 6e61 7465 7327 5d20 666f 7220 6974 656d  nates'] for item
-00019590: 2069 6e20 7375 626c 6973 745d 5d3a 0a20   in sublist]]:. 
-000195a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195b0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-000195c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000195d0: 2067 656f 6a73 6f6e 5b27 6665 6174 7572   geojson['featur
-000195e0: 6573 275d 2e61 7070 656e 6428 7b27 7479  es'].append({'ty
-000195f0: 7065 273a 2027 4665 6174 7572 6527 2c20  pe': 'Feature', 
-00019600: 2770 726f 7065 7274 6965 7327 3a20 7b27  'properties': {'
-00019610: 6964 273a 2066 696c 657d 2c20 2767 656f  id': file}, 'geo
-00019620: 6d65 7472 7927 3a20 6765 6f6d 6574 7279  metry': geometry
-00019630: 207d 290a 2020 2020 2020 2020 2020 2020   }).            
-00019640: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-00019650: 206f 203d 206f 7065 6e28 7365 6c66 2e67   o = open(self.g
-00019660: 6574 5f69 6e74 5f6e 6176 5f66 696c 6528  et_int_nav_file(
-00019670: 292e 7265 706c 6163 6528 222e 7478 7422  ).replace(".txt"
-00019680: 2c20 222e 6765 6f6a 736f 6e22 292c 0a20  , ".geojson"),. 
-00019690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196a0: 2020 2020 2277 222c 2065 7272 6f72 733d      "w", errors=
-000196b0: 2269 676e 6f72 6522 2c20 656e 636f 6469  "ignore", encodi
-000196c0: 6e67 3d27 7574 662d 3827 290a 2020 2020  ng='utf-8').    
-000196d0: 2020 2020 2020 2020 6a73 6f6e 2e64 756d          json.dum
-000196e0: 7028 6765 6f6a 736f 6e2c 206f 2c20 656e  p(geojson, o, en
-000196f0: 7375 7265 5f61 7363 6969 3d46 616c 7365  sure_ascii=False
-00019700: 2c20 696e 6465 6e74 3d34 290a 2020 2020  , indent=4).    
-00019710: 2020 2020 2020 2020 6f2e 636c 6f73 6528          o.close(
-00019720: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00019730: 656c 662e 7072 6f76 2e61 6464 4172 6775  elf.prov.addArgu
-00019740: 6d65 6e74 2822 696e 7075 744e 6176 6967  ment("inputNavig
-00019750: 6174 696f 6e46 696c 6522 2c6e 6176 5f70  ationFile",nav_p
-00019760: 6174 682c 6f76 6572 7772 6974 653d 5472  ath,overwrite=Tr
-00019770: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00019780: 7365 6c66 2e70 726f 762e 6c6f 6728 2270  self.prov.log("p
-00019790: 6172 7365 6420 6672 6f6d 2069 6e70 7574  arsed from input
-000197a0: 4e61 7669 6761 7469 6f6e 4669 6c65 3a20  NavigationFile: 
-000197b0: 2220 2b20 7374 7228 6e61 765f 6865 6164  " + str(nav_head
-000197c0: 6572 292c 646f 6e74 5368 6f77 3d54 7275  er),dontShow=Tru
-000197d0: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
-000197e0: 2e73 746f 7028 290a 2020 2020 2020 2020  .stop().        
-000197f0: 2020 2020 7265 7475 726e 2054 7275 652c      return True,
-00019800: 2022 4e61 7669 6761 7469 6f6e 2064 6174   "Navigation dat
-00019810: 6120 6372 6561 7465 6422 202b 2072 6574  a created" + ret
-00019820: 7572 6e4d 7367 0a20 2020 2020 2020 2065  urnMsg.        e
-00019830: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00019840: 2073 2e73 746f 7028 290a 2020 2020 2020   s.stop().      
-00019850: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00019860: 7365 2c20 224e 6f20 696d 6167 6520 636f  se, "No image co
-00019870: 6f72 6469 6e61 7465 7320 666f 756e 6422  ordinates found"
-00019880: 202b 2072 6574 7572 6e4d 7367 0a0a 2020   + returnMsg..  
-00019890: 2020 6465 6620 6372 6561 7465 496d 6167    def createImag
-000198a0: 654e 6176 6967 6174 696f 6e46 696c 6528  eNavigationFile(
-000198b0: 7365 6c66 2c20 6e61 765f 7061 7468 3a20  self, nav_path: 
-000198c0: 7374 722c 206e 6176 5f68 6561 6465 723d  str, nav_header=
-000198d0: 6d69 7174 762e 706f 735f 6865 6164 6572  miqtv.pos_header
-000198e0: 5b27 7061 6e67 6165 6127 5d2c 2064 6174  ['pangaea'], dat
-000198f0: 655f 666f 726d 6174 3d6d 6971 7476 2e64  e_format=miqtv.d
-00019900: 6174 655f 666f 726d 6174 735b 2770 616e  ate_formats['pan
-00019910: 6761 6561 275d 2c20 6f76 6572 7772 6974  gaea'], overwrit
-00019920: 653d 4661 6c73 652c 2063 6f6c 5f73 6570  e=False, col_sep
-00019930: 6172 6174 6f72 203d 2022 5c74 222c 2076  arator = "\t", v
-00019940: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
-00019950: 733d 312c 0a20 2020 2020 2020 2020 2020  s=1,.           
-00019960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019970: 2020 2020 2020 2020 206f 6666 7365 745f           offset_
-00019980: 783d 302c 206f 6666 7365 745f 793d 302c  x=0, offset_y=0,
-00019990: 206f 6666 7365 745f 7a3d 302c 616e 676c   offset_z=0,angl
-000199a0: 6573 5f69 6e5f 7261 6420 3d20 4661 6c73  es_in_rad = Fals
-000199b0: 652c 2072 6563 6f72 6473 3262 6549 6e76  e, records2beInv
-000199c0: 6572 7465 643d 5b5d 293a 0a20 2020 2020  erted=[]):.     
-000199d0: 2020 2022 2222 2044 6570 7265 6361 7465     """ Deprecate
-000199e0: 6420 2d20 7573 6520 6372 6561 7465 5f69  d - use create_i
-000199f0: 6d61 6765 5f6e 6176 6967 6174 696f 6e5f  mage_navigation_
-00019a00: 6669 6c65 2022 2222 0a20 2020 2020 2020  file """.       
-00019a10: 2072 6574 7572 6e20 7365 6c66 2e63 7265   return self.cre
-00019a20: 6174 655f 696d 6167 655f 6e61 7669 6761  ate_image_naviga
-00019a30: 7469 6f6e 5f66 696c 6528 6e61 765f 7061  tion_file(nav_pa
-00019a40: 7468 2c20 6e61 765f 6865 6164 6572 2c20  th, nav_header, 
-00019a50: 6461 7465 5f66 6f72 6d61 742c 206f 7665  date_format, ove
-00019a60: 7277 7269 7465 2c20 636f 6c5f 7365 7061  rwrite, col_sepa
-00019a70: 7261 746f 722c 2076 6964 656f 5361 6d70  rator, videoSamp
-00019a80: 6c65 5365 636f 6e64 732c 206f 6666 7365  leSeconds, offse
-00019a90: 745f 782c 206f 6666 7365 745f 792c 206f  t_x, offset_y, o
-00019aa0: 6666 7365 745f 7a2c 2061 6e67 6c65 735f  ffset_z, angles_
-00019ab0: 696e 5f72 6164 2c20 7265 636f 7264 7332  in_rad, records2
-00019ac0: 6265 496e 7665 7274 6564 290a 0a0a 2020  beInverted)...  
-00019ad0: 2020 6465 6620 6372 6561 7465 5f69 6d61    def create_ima
-00019ae0: 6765 5f73 6861 3235 365f 6669 6c65 2873  ge_sha256_file(s
-00019af0: 656c 662c 7265 5265 6164 416c 6c3d 5472  elf,reReadAll=Tr
-00019b00: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
-00019b10: 2043 7265 6174 6573 2069 6e20 2f69 6e74   Creates in /int
-00019b20: 6572 6d65 6469 6174 6520 6120 7465 7874  ermediate a text
-00019b30: 2066 696c 6520 636f 6e74 6169 6e69 6e67   file containing
-00019b40: 2070 6572 2069 6d61 6765 2069 7473 2053   per image its S
-00019b50: 4841 3235 3620 6861 7368 2e0a 2020 2020  HA256 hash..    
-00019b60: 2020 2020 2020 2020 4966 2072 6552 6561          If reRea
-00019b70: 6441 6c6c 2069 7320 5472 7565 2061 6c6c  dAll is True all
-00019b80: 2069 6d61 6765 7327 2068 6173 6865 7320   images' hashes 
-00019b90: 6172 6520 6465 7465 726d 696e 6564 2e20  are determined. 
-00019ba0: 4f74 6865 7277 6973 6520 6f6e 6c79 2066  Otherwise only f
-00019bb0: 6f72 2074 686f 7365 2066 696c 6573 0a20  or those files. 
-00019bc0: 2020 2020 2020 2020 2020 2077 6869 6368             which
-00019bd0: 2061 7265 206e 6f74 2079 6574 2069 6e20   are not yet in 
-00019be0: 7468 6520 696e 7465 726d 6564 6961 7465  the intermediate
-00019bf0: 2066 696c 6520 636f 6e74 6169 6e69 6e67   file containing
-00019c00: 2074 6865 2069 6d61 6765 2068 6173 6865   the image hashe
-00019c10: 7320 2022 2222 0a20 2020 2020 2020 2068  s  """.        h
-00019c20: 6173 6865 7320 3d20 7b7d 0a20 2020 2020  ashes = {}.     
-00019c30: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-00019c40: 6973 7473 2873 656c 662e 6765 745f 696e  ists(self.get_in
-00019c50: 745f 6861 7368 5f66 696c 6528 2929 3a0a  t_hash_file()):.
-00019c60: 2020 2020 2020 2020 2020 2020 6861 7368              hash
-00019c70: 6573 203d 206d 6971 7466 2e74 6162 4669  es = miqtf.tabFi
-00019c80: 6c65 4461 7461 2873 656c 662e 6765 745f  leData(self.get_
-00019c90: 696e 745f 6861 7368 5f66 696c 6528 292c  int_hash_file(),
-00019ca0: 205b 6d69 7174 762e 636f 6c5f 6865 6164   [miqtv.col_head
-00019cb0: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
-00019cc0: 6727 5d2c 206d 6971 7476 2e63 6f6c 5f68  g'], miqtv.col_h
-00019cd0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00019ce0: 2768 6173 6827 5d5d 2c20 6b65 795f 636f  'hash']], key_co
-00019cf0: 6c3d 6d69 7174 762e 636f 6c5f 6865 6164  l=miqtv.col_head
-00019d00: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
-00019d10: 6727 5d29 0a0a 2020 2020 2020 2020 696d  g'])..        im
-00019d20: 6167 6573 496e 5261 7720 3d20 7365 6c66  agesInRaw = self
-00019d30: 2e69 6d61 6765 7349 6e49 6d61 6765 7344  .imagesInImagesD
-00019d40: 6972 2829 0a20 2020 2020 2020 2069 6620  ir().        if 
-00019d50: 6c65 6e28 696d 6167 6573 496e 5261 7729  len(imagesInRaw)
-00019d60: 203e 2030 3a0a 0a20 2020 2020 2020 2020   > 0:..         
-00019d70: 2020 2061 6464 6564 5f68 6173 6865 7320     added_hashes 
-00019d80: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-00019d90: 7072 6f67 203d 206d 6971 7463 2e50 7269  prog = miqtc.Pri
-00019da0: 6e74 4b6e 6f77 6e50 726f 6772 6573 734d  ntKnownProgressM
-00019db0: 7367 2822 4368 6563 6b69 6e67 2068 6173  sg("Checking has
-00019dc0: 6865 7322 2c20 6c65 6e28 696d 6167 6573  hes", len(images
-00019dd0: 496e 5261 7729 2c6d 6f64 756c 6f3d 3529  InRaw),modulo=5)
-00019de0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00019df0: 2066 696c 6520 696e 2069 6d61 6765 7349   file in imagesI
-00019e00: 6e52 6177 3a0a 2020 2020 2020 2020 2020  nRaw:.          
-00019e10: 2020 2020 2020 7072 6f67 2e70 726f 6772        prog.progr
-00019e20: 6573 7328 290a 0a20 2020 2020 2020 2020  ess()..         
-00019e30: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00019e40: 6c66 2e5f 5f61 6c6c 5555 4944 7343 6865  lf.__allUUIDsChe
-00019e50: 636b 6564 2061 6e64 206e 6f74 206d 6971  cked and not miq
-00019e60: 7469 2e69 6d61 6765 436f 6e74 6169 6e73  ti.imageContains
-00019e70: 5661 6c69 6455 5549 4428 6669 6c65 295b  ValidUUID(file)[
-00019e80: 305d 3a0a 2020 2020 2020 2020 2020 2020  0]:.            
-00019e90: 2020 2020 2020 2020 2320 7265 6d6f 7665          # remove
-00019ea0: 2066 726f 6d20 7575 6964 2066 696c 650a   from uuid file.
-00019eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ec0: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
-00019ed0: 7869 7374 7328 7365 6c66 2e67 6574 5f69  xists(self.get_i
-00019ee0: 6e74 5f75 7569 645f 6669 6c65 2829 293a  nt_uuid_file()):
-00019ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019f00: 2020 2020 2020 2020 2072 6573 203d 206f           res = o
-00019f10: 7065 6e28 7365 6c66 2e67 6574 5f69 6e74  pen(self.get_int
-00019f20: 5f75 7569 645f 6669 6c65 2829 2c20 2272  _uuid_file(), "r
-00019f30: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00019f40: 2020 2020 2020 2020 2020 206c 696e 6573             lines
-00019f50: 203d 2072 6573 2e72 6561 646c 696e 6573   = res.readlines
-00019f60: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00019f70: 2020 2020 2020 2020 2020 2072 6573 2e63             res.c
-00019f80: 6c6f 7365 2829 0a20 2020 2020 2020 2020  lose().         
-00019f90: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00019fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019fb0: 2020 2020 2020 2020 206c 696e 6573 203d           lines =
-00019fc0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-00019fd0: 2020 2020 2020 2020 6920 3d20 300a 2020          i = 0.  
-00019fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ff0: 2020 6c69 6e65 4e72 203d 2069 0a20 2020    lineNr = i.   
-0001a000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a010: 2066 6f72 206c 696e 6520 696e 206c 696e   for line in lin
-0001a020: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0001a030: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-0001a040: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-0001a050: 6669 6c65 2920 696e 206c 696e 653a 0a20  file) in line:. 
-0001a060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a070: 2020 2020 2020 2020 2020 206c 696e 654e             lineN
-0001a080: 7220 3d20 690a 2020 2020 2020 2020 2020  r = i.          
-0001a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a0a0: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-0001a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a0c0: 6920 2b3d 2031 0a20 2020 2020 2020 2020  i += 1.         
-0001a0d0: 2020 2020 2020 2020 2020 2069 6620 6c69             if li
-0001a0e0: 6e65 4e72 2021 3d20 303a 0a20 2020 2020  neNr != 0:.     
-0001a0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a100: 2020 2064 656c 206c 696e 6573 5b6c 696e     del lines[lin
-0001a110: 654e 725d 0a20 2020 2020 2020 2020 2020  eNr].           
-0001a120: 2020 2020 2020 2020 2020 2020 2072 6573               res
-0001a130: 203d 206f 7065 6e28 7365 6c66 2e67 6574   = open(self.get
-0001a140: 5f69 6e74 5f75 7569 645f 6669 6c65 2829  _int_uuid_file()
-0001a150: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
-0001a160: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001a170: 6573 2e77 7269 7465 6c69 6e65 7328 6c69  es.writelines(li
-0001a180: 6e65 7329 0a20 2020 2020 2020 2020 2020  nes).           
-0001a190: 2020 2020 2020 2020 2020 2020 2072 6573               res
-0001a1a0: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
-0001a1b0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0001a1c0: 7365 2045 7863 6570 7469 6f6e 2820 2246  se Exception( "F
-0001a1d0: 696c 6520 2220 2b20 6669 6c65 202b 2022  ile " + file + "
-0001a1e0: 2064 6f65 7320 6e6f 7420 636f 7461 696e   does not cotain
-0001a1f0: 2061 2076 616c 6964 2055 5549 442e 2052   a valid UUID. R
-0001a200: 756e 2063 7265 6174 655f 7575 6964 5f66  un create_uuid_f
-0001a210: 696c 6528 2920 6669 7273 7421 2229 0a0a  ile() first!")..
-0001a220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a230: 6669 6c65 5f6e 616d 6520 3d20 6f73 2e70  file_name = os.p
-0001a240: 6174 682e 6261 7365 6e61 6d65 2866 696c  ath.basename(fil
-0001a250: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0001a260: 2020 2069 6620 6e6f 7420 7265 5265 6164     if not reRead
-0001a270: 416c 6c20 616e 6420 6669 6c65 5f6e 616d  All and file_nam
-0001a280: 6520 696e 2068 6173 6865 733a 0a20 2020  e in hashes:.   
-0001a290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a2a0: 2068 6173 6865 735b 6669 6c65 5f6e 616d   hashes[file_nam
-0001a2b0: 655d 203d 2068 6173 6865 735b 6669 6c65  e] = hashes[file
-0001a2c0: 5f6e 616d 655d 5b6d 6971 7476 2e63 6f6c  _name][miqtv.col
-0001a2d0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-0001a2e0: 5d5b 2768 6173 6827 5d5d 0a20 2020 2020  ]['hash']].     
-0001a2f0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001a300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a310: 2020 2020 2068 6173 6865 735b 6669 6c65       hashes[file
-0001a320: 5f6e 616d 655d 203d 206d 6971 7463 2e73  _name] = miqtc.s
-0001a330: 6861 3235 3648 6173 6846 696c 6528 6669  ha256HashFile(fi
-0001a340: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
-0001a350: 2020 2020 2020 2020 6164 6465 645f 6861          added_ha
-0001a360: 7368 6573 202b 3d20 310a 2020 2020 2020  shes += 1.      
-0001a370: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
-0001a380: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-0001a390: 6966 2072 6552 6561 6441 6c6c 206f 7220  if reReadAll or 
-0001a3a0: 6164 6465 645f 6861 7368 6573 203e 2030  added_hashes > 0
-0001a3b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a3c0: 2020 6861 7368 5f66 696c 6520 3d20 6f70    hash_file = op
-0001a3d0: 656e 2873 656c 662e 6765 745f 696e 745f  en(self.get_int_
-0001a3e0: 6861 7368 5f66 696c 6528 292c 2022 7722  hash_file(), "w"
-0001a3f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001a400: 2020 6861 7368 5f66 696c 652e 7772 6974    hash_file.writ
-0001a410: 6528 206d 6971 7476 2e63 6f6c 5f68 6561  e( miqtv.col_hea
-0001a420: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
-0001a430: 6d67 275d 2b22 5c74 222b 6d69 7174 762e  mg']+"\t"+miqtv.
-0001a440: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-0001a450: 7174 275d 5b27 6861 7368 275d 2b22 5c6e  qt']['hash']+"\n
-0001a460: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001a470: 2020 2066 696c 6573 5f73 6f72 7465 6420     files_sorted 
-0001a480: 3d20 6c69 7374 2868 6173 6865 732e 6b65  = list(hashes.ke
-0001a490: 7973 2829 290a 2020 2020 2020 2020 2020  ys()).          
-0001a4a0: 2020 2020 2020 6669 6c65 735f 736f 7274        files_sort
-0001a4b0: 6564 2e73 6f72 7428 290a 2020 2020 2020  ed.sort().      
-0001a4c0: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
-0001a4d0: 6c65 5f6e 616d 6520 696e 2066 696c 6573  le_name in files
-0001a4e0: 5f73 6f72 7465 643a 0a20 2020 2020 2020  _sorted:.       
-0001a4f0: 2020 2020 2020 2020 2020 2020 2068 6173               has
-0001a500: 685f 6669 6c65 2e77 7269 7465 2866 696c  h_file.write(fil
-0001a510: 655f 6e61 6d65 2b22 5c74 222b 6861 7368  e_name+"\t"+hash
-0001a520: 6573 5b66 696c 655f 6e61 6d65 5d2b 225c  es[file_name]+"\
-0001a530: 6e22 290a 0a20 2020 2020 2020 2020 2020  n")..           
-0001a540: 2020 2020 2068 6173 685f 6669 6c65 2e63       hash_file.c
-0001a550: 6c6f 7365 2829 0a20 2020 2020 2020 2020  lose().         
-0001a560: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-0001a570: 7565 2c20 2241 6464 6564 2022 2b73 7472  ue, "Added "+str
-0001a580: 2861 6464 6564 5f68 6173 6865 7329 2b22  (added_hashes)+"
-0001a590: 2068 6173 6865 7320 746f 2068 6173 6820   hashes to hash 
-0001a5a0: 6669 6c65 220a 2020 2020 2020 2020 2020  file".          
-0001a5b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001a5c0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-0001a5d0: 7275 652c 2022 416c 6c20 6861 7368 6573  rue, "All hashes
-0001a5e0: 2065 7869 7374 220a 0a20 2020 2020 2020   exist"..       
-0001a5f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001a600: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
-0001a610: 2022 4e6f 2069 6d61 6765 7320 666f 756e   "No images foun
-0001a620: 6420 746f 2068 6173 6822 0a20 2020 2020  d to hash".     
-0001a630: 2020 200a 2020 2020 6465 6620 6372 6561     .    def crea
-0001a640: 7465 496d 6167 6553 4841 3235 3646 696c  teImageSHA256Fil
-0001a650: 6528 7365 6c66 2c72 6552 6561 6441 6c6c  e(self,reReadAll
-0001a660: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
-0001a670: 2222 2220 4465 7072 6563 6174 6564 202d  """ Deprecated -
-0001a680: 2075 7365 2063 7265 6174 655f 696d 6167   use create_imag
-0001a690: 655f 7368 6132 3536 5f66 696c 6520 2222  e_sha256_file ""
-0001a6a0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-0001a6b0: 2073 656c 662e 6372 6561 7465 5f69 6d61   self.create_ima
-0001a6c0: 6765 5f73 6861 3235 365f 6669 6c65 2872  ge_sha256_file(r
-0001a6d0: 6552 6561 6441 6c6c 290a 0a0a 2020 2020  eReadAll)...    
-0001a6e0: 6465 6620 6372 6561 7465 5f73 7461 7274  def create_start
-0001a6f0: 5f74 696d 655f 6669 6c65 2873 656c 6629  _time_file(self)
-0001a700: 3a0a 2020 2020 2020 2020 2222 2220 4372  :.        """ Cr
-0001a710: 6561 7465 7320 696e 202f 696e 7465 726d  eates in /interm
-0001a720: 6564 6961 7465 2061 2074 6578 7420 6669  ediate a text fi
-0001a730: 6c65 2063 6f6e 7461 696e 696e 6720 7065  le containing pe
-0001a740: 7220 696d 6167 6520 6974 7320 7374 6172  r image its star
-0001a750: 7420 7469 6d65 2070 6172 7365 6420 6672  t time parsed fr
-0001a760: 6f6d 2074 6865 2066 696c 6520 6e61 6d65  om the file name
-0001a770: 2022 2222 0a0a 2020 2020 2020 2020 7320   """..        s 
-0001a780: 3d20 6d69 7174 632e 5072 696e 744c 6f61  = miqtc.PrintLoa
-0001a790: 6469 6e67 4d73 6728 2243 7265 6174 696e  dingMsg("Creatin
-0001a7a0: 6720 696e 7465 726d 6564 6961 7465 2073  g intermediate s
-0001a7b0: 7461 7274 7469 6d65 2066 696c 6520 2229  tarttime file ")
-0001a7c0: 0a20 2020 2020 2020 2069 6d61 6765 7349  .        imagesI
-0001a7d0: 6e52 6177 203d 2073 656c 662e 696d 6167  nRaw = self.imag
-0001a7e0: 6573 496e 496d 6167 6573 4469 7253 6f72  esInImagesDirSor
-0001a7f0: 7465 644c 6973 7428 290a 2020 2020 2020  tedList().      
-0001a800: 2020 6966 206c 656e 2869 6d61 6765 7349    if len(imagesI
-0001a810: 6e52 6177 2920 3e20 303a 0a0a 2020 2020  nRaw) > 0:..    
-0001a820: 2020 2020 2020 2020 6f20 3d20 6f70 656e          o = open
-0001a830: 2873 656c 662e 6765 745f 696e 745f 7374  (self.get_int_st
-0001a840: 6172 7454 696d 6573 5f66 696c 6528 292c  artTimes_file(),
-0001a850: 2022 7722 290a 2020 2020 2020 2020 2020   "w").          
-0001a860: 2020 6f2e 7772 6974 6528 6d69 7174 762e    o.write(miqtv.
-0001a870: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-0001a880: 7174 275d 5b27 696d 6727 5d20 2b0a 2020  qt']['img'] +.  
-0001a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8a0: 2020 225c 7422 2b6d 6971 7476 2e63 6f6c    "\t"+miqtv.col
-0001a8b0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-0001a8c0: 5d5b 2775 7463 275d 2b22 5c6e 2229 0a0a  ]['utc']+"\n")..
-0001a8d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001a8e0: 6669 6c65 2069 6e20 696d 6167 6573 496e  file in imagesIn
-0001a8f0: 5261 773a 0a20 2020 2020 2020 2020 2020  Raw:.           
-0001a900: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
-0001a910: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
-0001a920: 6528 6669 6c65 290a 0a20 2020 2020 2020  e(file)..       
-0001a930: 2020 2020 2020 2020 2064 7420 3d20 6d69           dt = mi
-0001a940: 7174 632e 7061 7273 6546 696c 6544 6174  qtc.parseFileDat
-0001a950: 6554 696d 6541 7355 5443 2866 696c 655f  eTimeAsUTC(file_
-0001a960: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-0001a970: 2020 2020 2020 6f2e 7772 6974 6528 6669        o.write(fi
-0001a980: 6c65 5f6e 616d 652b 225c 7422 202b 2064  le_name+"\t" + d
-0001a990: 742e 7374 7266 7469 6d65 286d 6971 7476  t.strftime(miqtv
-0001a9a0: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
-0001a9b0: 6172 6971 7427 5d29 2b22 5c6e 2229 0a0a  ariqt'])+"\n")..
-0001a9c0: 2020 2020 2020 2020 2020 2020 6f2e 636c              o.cl
-0001a9d0: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
-0001a9e0: 2020 732e 7374 6f70 2829 0a20 2020 2020    s.stop().     
-0001a9f0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-0001aa00: 7565 2c20 2243 7265 6174 6564 2073 7461  ue, "Created sta
-0001aa10: 7274 2074 696d 6520 6669 6c65 220a 2020  rt time file".  
-0001aa20: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001aa30: 2020 2020 2020 2020 732e 7374 6f70 2829          s.stop()
-0001aa40: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001aa50: 7572 6e20 4661 6c73 652c 2022 4e6f 2069  urn False, "No i
-0001aa60: 6d61 6765 7320 666f 756e 6420 746f 2072  mages found to r
-0001aa70: 6561 6420 7374 6172 7420 7469 6d65 7322  ead start times"
-0001aa80: 0a20 2020 2020 2020 200a 2020 2020 6465  .        .    de
-0001aa90: 6620 6372 6561 7465 5374 6172 7454 696d  f createStartTim
-0001aaa0: 6546 696c 6528 7365 6c66 293a 0a20 2020  eFile(self):.   
-0001aab0: 2020 2020 2022 2222 2044 6570 7265 6361       """ Depreca
-0001aac0: 7465 6420 2d20 7573 6520 6372 6561 7465  ted - use create
-0001aad0: 5f73 7461 7274 5f74 696d 655f 6669 6c65  _start_time_file
-0001aae0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-0001aaf0: 7572 6e20 7365 6c66 2e63 7265 6174 655f  urn self.create_
-0001ab00: 7374 6172 745f 7469 6d65 5f66 696c 6528  start_time_file(
-0001ab10: 290a 0a0a 2020 2020 6465 6620 6372 6561  )...    def crea
-0001ab20: 7465 4163 7175 6973 6974 696f 6e53 6574  teAcquisitionSet
-0001ab30: 7469 6e67 7345 5849 4646 696c 6528 7365  tingsEXIFFile(se
-0001ab40: 6c66 2c6f 7665 7272 6964 653d 4661 6c73  lf,override=Fals
-0001ab50: 6529 3a0a 2020 2020 2020 2020 2222 2220  e):.        """ 
-0001ab60: 4465 7072 6563 6174 6564 2e20 5573 6520  Deprecated. Use 
-0001ab70: 6372 6561 7465 5f61 6371 7569 7369 7469  create_acquisiti
-0001ab80: 6f6e 5f73 6574 7469 6e67 735f 6578 6966  on_settings_exif
-0001ab90: 5f66 696c 6528 2920 696e 7374 6561 642e  _file() instead.
-0001aba0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-0001abb0: 7572 6e20 7365 6c66 2e63 7265 6174 655f  urn self.create_
-0001abc0: 6163 7175 6973 6974 696f 6e5f 7365 7474  acquisition_sett
-0001abd0: 696e 6773 5f65 7869 665f 6669 6c65 286f  ings_exif_file(o
-0001abe0: 7665 7272 6964 653d 6f76 6572 7269 6465  verride=override
-0001abf0: 290a 0a20 2020 2064 6566 2063 7265 6174  )..    def creat
-0001ac00: 655f 6163 7175 6973 6974 696f 6e5f 7365  e_acquisition_se
-0001ac10: 7474 696e 6773 5f65 7869 665f 6669 6c65  ttings_exif_file
-0001ac20: 2873 656c 662c 6f76 6572 7269 6465 3d46  (self,override=F
-0001ac30: 616c 7365 293a 0a20 2020 2020 2020 2022  alse):.        "
-0001ac40: 2222 2043 7265 6174 6573 2069 6e20 2f69  "" Creates in /i
-0001ac50: 6e74 6572 6d65 6469 6174 6520 6120 7465  ntermediate a te
-0001ac60: 7874 2066 696c 6520 636f 6e74 6169 6e69  xt file containi
-0001ac70: 6e67 2070 6572 2069 6d61 6765 2061 2064  ng per image a d
-0001ac80: 6963 7420 6f66 2065 7869 6620 7461 6773  ict of exif tags
-0001ac90: 2061 6e64 2074 6865 6972 2076 616c 7565   and their value
-0001aca0: 7320 7061 7273 6564 2066 726f 6d20 7468  s parsed from th
-0001acb0: 6520 696d 6167 6520 2222 220a 0a20 2020  e image """..   
-0001acc0: 2020 2020 2069 6e74 5f61 6371 7569 7369       int_acquisi
-0001acd0: 7469 6f6e 5365 7474 696e 675f 6669 6c65  tionSetting_file
-0001ace0: 203d 2073 656c 662e 5f5f 6765 745f 696e   = self.__get_in
-0001acf0: 745f 6669 6c65 5f70 7265 6669 7828 2920  t_file_prefix() 
-0001ad00: 2b20 275f 696d 6167 652d 6163 7175 6973  + '_image-acquis
-0001ad10: 6974 696f 6e2d 7365 7474 696e 6773 2e74  ition-settings.t
-0001ad20: 7874 270a 2020 2020 2020 2020 6865 6164  xt'.        head
-0001ad30: 6572 203d 207b 2020 6d69 7174 762e 636f  er = {  miqtv.co
-0001ad40: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-0001ad50: 275d 5b27 696d 6727 5d3a 2020 6d69 7174  ']['img']:  miqt
-0001ad60: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-0001ad70: 7269 7174 275d 5b27 696d 6727 5d2c 0a20  riqt']['img'],. 
-0001ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad90: 2020 206d 6971 7476 2e63 6f6c 5f68 6561     miqtv.col_hea
-0001ada0: 6465 725b 276d 6172 6971 7427 5d5b 2761  der['mariqt']['a
-0001adb0: 6371 7569 275d 3a6d 6971 7476 2e63 6f6c  cqui']:miqtv.col
-0001adc0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-0001add0: 5d5b 2761 6371 7569 275d 7d0a 2020 2020  ]['acqui']}.    
-0001ade0: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
-0001adf0: 7869 7374 7328 696e 745f 6163 7175 6973  xists(int_acquis
-0001ae00: 6974 696f 6e53 6574 7469 6e67 5f66 696c  itionSetting_fil
-0001ae10: 6529 2061 6e64 206e 6f74 206f 7665 7272  e) and not overr
-0001ae20: 6964 653a 0a20 2020 2020 2020 2020 2020  ide:.           
-0001ae30: 2073 656c 662e 6164 645f 6974 656d 5f69   self.add_item_i
-0001ae40: 6e66 6f5f 7461 625f 6669 6c65 2869 6e74  nfo_tab_file(int
-0001ae50: 5f61 6371 7569 7369 7469 6f6e 5365 7474  _acquisitionSett
-0001ae60: 696e 675f 6669 6c65 2c22 5c74 222c 6865  ing_file,"\t",he
-0001ae70: 6164 6572 290a 2020 2020 2020 2020 2020  ader).          
-0001ae80: 2020 7265 7475 726e 2054 7275 652c 2022    return True, "
-0001ae90: 5265 7375 6c74 2066 696c 6520 6578 6973  Result file exis
-0001aea0: 7473 220a 0a20 2020 2020 2020 2069 6d61  ts"..        ima
-0001aeb0: 6765 7349 6e52 6177 203d 2073 656c 662e  gesInRaw = self.
-0001aec0: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
-0001aed0: 7253 6f72 7465 644c 6973 7428 290a 2020  rSortedList().  
-0001aee0: 2020 2020 2020 6966 206c 656e 2869 6d61        if len(ima
-0001aef0: 6765 7349 6e52 6177 2920 3e20 303a 0a0a  gesInRaw) > 0:..
-0001af00: 2020 2020 2020 2020 2020 2020 6f20 3d20              o = 
-0001af10: 6f70 656e 2869 6e74 5f61 6371 7569 7369  open(int_acquisi
-0001af20: 7469 6f6e 5365 7474 696e 675f 6669 6c65  tionSetting_file
-0001af30: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
-0001af40: 2020 206f 2e77 7269 7465 286d 6971 7476     o.write(miqtv
-0001af50: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-0001af60: 6971 7427 5d5b 2769 6d67 275d 202b 2022  iqt']['img'] + "
-0001af70: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
-0001af80: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-0001af90: 6163 7175 6927 5d2b 225c 6e22 290a 200a  acqui']+"\n"). .
-0001afa0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-0001afb0: 6573 4578 6966 7320 3d20 6d69 7174 692e  esExifs = miqti.
-0001afc0: 6765 7449 6d61 6765 7341 6c6c 4578 6966  getImagesAllExif
-0001afd0: 5661 6c75 6573 2869 6d61 6765 7349 6e52  Values(imagesInR
-0001afe0: 6177 2c73 656c 662e 7072 6f76 290a 2020  aw,self.prov).  
-0001aff0: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
-0001b000: 6c65 2069 6e20 696d 6167 6573 4578 6966  le in imagesExif
-0001b010: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001b020: 2020 2066 696c 655f 6e61 6d65 203d 206f     file_name = o
-0001b030: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-0001b040: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
-0001b050: 2020 2020 2020 6f2e 7772 6974 6528 6669        o.write(fi
-0001b060: 6c65 5f6e 616d 652b 225c 7422 2b73 7472  le_name+"\t"+str
-0001b070: 2869 6d61 6765 7345 7869 6673 5b66 696c  (imagesExifs[fil
-0001b080: 655d 292b 225c 6e22 290a 0a20 2020 2020  e])+"\n")..     
-0001b090: 2020 2020 2020 206f 2e63 6c6f 7365 2829         o.close()
-0001b0a0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0001b0b0: 6c66 2e61 6464 5f69 7465 6d5f 696e 666f  lf.add_item_info
-0001b0c0: 5f74 6162 5f66 696c 6528 696e 745f 6163  _tab_file(int_ac
-0001b0d0: 7175 6973 6974 696f 6e53 6574 7469 6e67  quisitionSetting
-0001b0e0: 5f66 696c 652c 225c 7422 2c68 6561 6465  _file,"\t",heade
-0001b0f0: 7229 0a20 2020 2020 2020 2020 2020 2072  r).            r
-0001b100: 6574 7572 6e20 5472 7565 2c20 2243 7265  eturn True, "Cre
-0001b110: 6174 6564 2061 6371 7569 7369 7469 6f6e  ated acquisition
-0001b120: 2073 6574 7469 6e67 7320 6669 6c65 220a   settings file".
-0001b130: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001b140: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001b150: 2046 616c 7365 2c20 224e 6f20 696d 6167   False, "No imag
-0001b160: 6573 2066 6f75 6e64 220a 0a0a 2020 2020  es found"...    
-0001b170: 6465 6620 696d 6167 6573 496e 496d 6167  def imagesInImag
-0001b180: 6573 4469 7228 7365 6c66 293a 0a20 2020  esDir(self):.   
-0001b190: 2020 2020 2072 6574 7572 6e20 636f 7079       return copy
-0001b1a0: 2e64 6565 7063 6f70 7928 7365 6c66 2e5f  .deepcopy(self._
-0001b1b0: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
-0001b1c0: 7229 0a0a 2020 2020 6465 6620 696d 6167  r)..    def imag
-0001b1d0: 6573 496e 496d 6167 6573 4469 7253 6f72  esInImagesDirSor
-0001b1e0: 7465 644c 6973 7428 7365 6c66 293a 0a20  tedList(self):. 
-0001b1f0: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
-0001b200: 7079 2e64 6565 7063 6f70 7928 7365 6c66  py.deepcopy(self
-0001b210: 2e5f 696d 6167 6573 496e 496d 6167 6573  ._imagesInImages
-0001b220: 4469 7253 6f72 7465 644c 6973 7429 0a0a  DirSortedList)..
-0001b230: 0a20 2020 2064 6566 2070 6172 7365 4974  .    def parseIt
-0001b240: 656d 4461 7461 6672 6f6d 5461 6246 696c  emDatafromTabFil
-0001b250: 6544 6174 6128 7365 6c66 2c20 6974 656d  eData(self, item
-0001b260: 733a 2064 6963 742c 2066 696c 653a 2073  s: dict, file: s
-0001b270: 7472 2c20 636f 6c73 3a20 6c69 7374 2c20  tr, cols: list, 
-0001b280: 6f70 7469 6f6e 616c 3a20 6c69 7374 203d  optional: list =
-0001b290: 205b 5d2c 2064 6174 6574 696d 655f 666f   [], datetime_fo
-0001b2a0: 726d 6174 3a73 7472 3d6d 6971 7476 2e64  rmat:str=miqtv.d
-0001b2b0: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
-0001b2c0: 6971 7427 5d29 3a0a 2020 2020 2020 2020  iqt']):.        
-0001b2d0: 2222 2220 7061 7273 6573 2064 6174 6120  """ parses data 
-0001b2e0: 6672 6f6d 2063 6f6c 756d 6e73 2069 6e20  from columns in 
-0001b2f0: 636f 6c73 2061 6e64 2077 7269 7465 7320  cols and writes 
-0001b300: 696e 666f 2074 6f20 6974 656d 732e 2043  info to items. C
-0001b310: 6f6c 756d 6e20 2769 6d61 6765 2d66 696c  olumn 'image-fil
-0001b320: 656e 616d 6527 206d 7573 7420 6265 2069  ename' must be i
-0001b330: 6e20 6669 6c65 2061 6e64 2064 6f65 7320  n file and does 
-0001b340: 6e6f 7420 6e65 6564 2074 6f20 6265 2070  not need to be p
-0001b350: 6173 7365 6420 696e 2063 6f6c 732e 200a  assed in cols. .
-0001b360: 2020 2020 2020 2020 2020 2020 4669 6c65              File
-0001b370: 206d 7573 7420 6265 2074 6162 2073 6570   must be tab sep
-0001b380: 6172 6174 6564 2061 6e64 2063 6f6c 756d  arated and colum
-0001b390: 6e73 206e 616d 6573 206d 7573 7420 6571  ns names must eq
-0001b3a0: 7561 6c20 6974 656d 2066 6965 6c64 206e  ual item field n
-0001b3b0: 616d 6573 2222 220a 2020 2020 2020 2020  ames""".        
-0001b3c0: 746d 705f 6461 7461 203d 206d 6971 7466  tmp_data = miqtf
-0001b3d0: 2e74 6162 4669 6c65 4461 7461 2866 696c  .tabFileData(fil
-0001b3e0: 652c 2063 6f6c 732b 5b27 696d 6167 652d  e, cols+['image-
-0001b3f0: 6669 6c65 6e61 6d65 275d 2b6f 7074 696f  filename']+optio
-0001b400: 6e61 6c2c 206b 6579 5f63 6f6c 3d27 696d  nal, key_col='im
-0001b410: 6167 652d 6669 6c65 6e61 6d65 272c 206f  age-filename', o
-0001b420: 7074 696f 6e61 6c3d 6f70 7469 6f6e 616c  ptional=optional
-0001b430: 2c63 6f6e 7665 7274 3d54 7275 6529 0a20  ,convert=True). 
-0001b440: 2020 2020 2020 2073 656c 662e 7772 6974         self.writ
-0001b450: 6550 6172 7365 6444 6174 6154 6f49 7465  eParsedDataToIte
-0001b460: 6d73 2874 6d70 5f64 6174 612c 6974 656d  ms(tmp_data,item
-0001b470: 732c 7365 6c66 2e69 6664 6f5f 746d 705b  s,self.ifdo_tmp[
-0001b480: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
-0001b490: 6865 6164 6572 5f6b 6579 5d2c 2064 6174  header_key], dat
-0001b4a0: 6574 696d 655f 666f 726d 6174 3d64 6174  etime_format=dat
-0001b4b0: 6574 696d 655f 666f 726d 6174 290a 0a0a  etime_format)...
-0001b4c0: 2020 2020 6465 6620 7072 6173 6549 7465      def praseIte
-0001b4d0: 6d44 6174 6146 726f 6d46 696c 6528 7365  mDataFromFile(se
-0001b4e0: 6c66 2c69 7465 6d73 3a64 6963 742c 6669  lf,items:dict,fi
-0001b4f0: 6c65 3a73 7472 2c73 6570 6172 6174 6f72  le:str,separator
-0001b500: 3a73 7472 2c68 6561 6465 723a 6469 6374  :str,header:dict
-0001b510: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
-0001b520: 743a 7374 723d 6d69 7174 762e 6461 7465  t:str=miqtv.date
-0001b530: 5f66 6f72 6d61 7473 5b27 6d61 7269 7174  _formats['mariqt
-0001b540: 275d 293a 0a20 2020 2020 2020 2022 2222  ']):.        """
-0001b550: 2070 6172 7365 7320 6461 7461 2066 726f   parses data fro
-0001b560: 6d20 6672 6f6d 2066 696c 6520 746f 2069  m from file to i
-0001b570: 7465 6d73 2e20 6865 6164 6572 2064 6963  tems. header dic
-0001b580: 7420 6d75 7374 2062 6520 6f66 2073 7472  t must be of str
-0001b590: 7563 7475 7265 3a20 7b3c 6974 656d 2d66  ucture: {<item-f
-0001b5a0: 6965 6c64 2d6e 616d 653e 3a3c 636f 6c75  ield-name>:<colu
-0001b5b0: 6d6e 2d6e 616d 653e 7d0a 2020 2020 2020  mn-name>}.      
-0001b5c0: 2020 2020 2020 616e 6420 6d75 7374 2063        and must c
-0001b5d0: 6f6e 7461 696e 2065 6e74 7279 2027 696d  ontain entry 'im
-0001b5e0: 6167 652d 6669 6c65 6e61 6d65 2720 2222  age-filename' ""
-0001b5f0: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
-0001b600: 2027 696d 6167 652d 6669 6c65 6e61 6d65   'image-filename
-0001b610: 2720 696e 2068 6561 6465 723a 0a20 2020  ' in header:.   
-0001b620: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
-0001b630: 7863 6570 7469 6f6e 2822 6865 6164 6572  xception("header
-0001b640: 2064 6f65 7320 6e6f 7420 636f 6e74 6169   does not contai
-0001b650: 6e20 2769 6d61 6765 2d66 696c 656e 616d  n 'image-filenam
-0001b660: 6527 2229 0a20 2020 2020 2020 200a 2020  e'").        .  
-0001b670: 2020 2020 2020 746d 705f 6461 7461 203d        tmp_data =
-0001b680: 206d 6971 7466 2e74 6162 4669 6c65 4461   miqtf.tabFileDa
-0001b690: 7461 2866 696c 652c 2068 6561 6465 722c  ta(file, header,
-0001b6a0: 636f 6c5f 7365 7061 7261 746f 723d 7365  col_separator=se
-0001b6b0: 7061 7261 746f 722c 206b 6579 5f63 6f6c  parator, key_col
-0001b6c0: 3d27 696d 6167 652d 6669 6c65 6e61 6d65  ='image-filename
-0001b6d0: 272c 636f 6e76 6572 743d 5472 7565 290a  ',convert=True).
-0001b6e0: 2020 2020 2020 2020 7365 6c66 2e77 7269          self.wri
-0001b6f0: 7465 5061 7273 6564 4461 7461 546f 4974  teParsedDataToIt
-0001b700: 656d 7328 746d 705f 6461 7461 2c69 7465  ems(tmp_data,ite
-0001b710: 6d73 2c73 656c 662e 6966 646f 5f74 6d70  ms,self.ifdo_tmp
-0001b720: 5b6d 6971 7476 2e69 6d61 6765 5f73 6574  [miqtv.image_set
-0001b730: 5f68 6561 6465 725f 6b65 795d 2c20 6461  _header_key], da
-0001b740: 7465 7469 6d65 5f66 6f72 6d61 743d 6461  tetime_format=da
-0001b750: 7465 7469 6d65 5f66 6f72 6d61 7429 0a0a  tetime_format)..
-0001b760: 0a20 2020 2064 6566 2077 7269 7465 5061  .    def writePa
-0001b770: 7273 6564 4461 7461 546f 4974 656d 7328  rsedDataToItems(
-0001b780: 7365 6c66 2c64 6174 613a 6469 6374 2c69  self,data:dict,i
-0001b790: 7465 6d73 3a64 6963 742c 6865 6164 6572  tems:dict,header
-0001b7a0: 3a64 6963 742c 2064 6174 6574 696d 655f  :dict, datetime_
-0001b7b0: 666f 726d 6174 3a73 7472 3d6d 6971 7476  format:str=miqtv
-0001b7c0: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
-0001b7d0: 6172 6971 7427 5d29 3a0a 0a20 2020 2020  ariqt']):..     
-0001b7e0: 2020 2023 2065 7661 6c20 7374 7269 6e67     # eval string
-0001b7f0: 7320 6173 2064 6963 7420 6f72 206c 6973  s as dict or lis
-0001b800: 740a 2020 2020 2020 2020 6d69 7174 632e  t.        miqtc.
-0001b810: 7265 6375 7273 6976 6545 7661 6c28 6461  recursiveEval(da
-0001b820: 7461 290a 0a20 2020 2020 2020 2064 6174  ta)..        dat
-0001b830: 6120 3d20 6d69 7174 632e 7265 6375 7273  a = miqtc.recurs
-0001b840: 6976 656c 7952 656d 6f76 6545 6d70 7479  ivelyRemoveEmpty
-0001b850: 4669 656c 6473 2864 6174 612c 636f 6e74  Fields(data,cont
-0001b860: 656e 7432 6265 5265 6d6f 7665 643d 4e6f  ent2beRemoved=No
-0001b870: 6e65 290a 0a20 2020 2020 2020 2023 2070  ne)..        # p
-0001b880: 6f74 656e 7461 696c 6c79 2072 656d 6f76  otentailly remov
-0001b890: 6520 636f 6e73 7420 6461 7461 2066 726f  e const data fro
-0001b8a0: 6d20 6974 656d 7320 616e 6420 7075 7420  m items and put 
-0001b8b0: 696e 2068 6561 6465 720a 2020 2020 2020  in header.      
-0001b8c0: 2020 7365 6c66 2e65 7874 7261 6374 436f    self.extractCo
-0001b8d0: 6e73 7444 6174 6156 616c 7565 7328 6461  nstDataValues(da
-0001b8e0: 7461 2c68 6561 6465 7229 0a0a 2020 2020  ta,header)..    
-0001b8f0: 2020 2020 2320 6164 6420 2769 6d61 6765      # add 'image
-0001b900: 2d66 696c 656e 616d 6527 2066 6965 6c64  -filename' field
-0001b910: 0a20 2020 2020 2020 2066 6f72 2069 6d67  .        for img
-0001b920: 2c20 656e 7472 7920 696e 2064 6174 612e  , entry in data.
-0001b930: 6974 656d 7328 293a 0a0a 2020 2020 2020  items():..      
-0001b940: 2020 2020 2020 2320 6c69 7374 0a20 2020        # list.   
-0001b950: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-0001b960: 7374 616e 6365 2865 6e74 7279 2c6c 6973  stance(entry,lis
-0001b970: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0001b980: 2020 2020 666f 7220 6c69 7374 4974 656d      for listItem
-0001b990: 2069 6e20 656e 7472 793a 0a20 2020 2020   in entry:.     
-0001b9a0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0001b9b0: 6973 7449 7465 6d5b 2769 6d61 6765 2d66  istItem['image-f
-0001b9c0: 696c 656e 616d 6527 5d20 3d20 696d 670a  ilename'] = img.
-0001b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9e0: 2020 2020 2320 636f 7665 7274 2064 6174      # covert dat
-0001b9f0: 6574 696d 6520 7374 7269 6e67 0a20 2020  etime string.   
-0001ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba10: 2069 6620 2769 6d61 6765 2d64 6174 6574   if 'image-datet
-0001ba20: 696d 6527 2069 6e20 6c69 7374 4974 656d  ime' in listItem
-0001ba30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001ba40: 2020 2020 2020 2020 2020 6474 203d 2064            dt = d
-0001ba50: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
-0001ba60: 2e73 7472 7074 696d 6528 6c69 7374 4974  .strptime(listIt
-0001ba70: 656d 5b27 696d 6167 652d 6461 7465 7469  em['image-dateti
-0001ba80: 6d65 275d 2c20 6461 7465 7469 6d65 5f66  me'], datetime_f
-0001ba90: 6f72 6d61 7429 0a20 2020 2020 2020 2020  ormat).         
-0001baa0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0001bab0: 6973 7449 7465 6d5b 2769 6d61 6765 2d64  istItem['image-d
-0001bac0: 6174 6574 696d 6527 5d20 3d20 6474 2e73  atetime'] = dt.s
-0001bad0: 7472 6674 696d 6528 6d69 7174 762e 6461  trftime(miqtv.da
-0001bae0: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
-0001baf0: 7174 275d 290a 2020 2020 2020 2020 2020  qt']).          
-0001bb00: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-0001bb10: 6528 656e 7472 792c 6469 6374 293a 0a20  e(entry,dict):. 
-0001bb20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001bb30: 6e74 7279 5b27 696d 6167 652d 6669 6c65  ntry['image-file
-0001bb40: 6e61 6d65 275d 203d 2069 6d67 0a20 2020  name'] = img.   
-0001bb50: 2020 2020 2020 2020 2020 2020 2023 2063               # c
-0001bb60: 6f76 6572 7420 6461 7465 7469 6d65 2073  overt datetime s
-0001bb70: 7472 696e 670a 2020 2020 2020 2020 2020  tring.          
-0001bb80: 2020 2020 2020 6966 2027 696d 6167 652d        if 'image-
-0001bb90: 6461 7465 7469 6d65 2720 696e 2065 6e74  datetime' in ent
-0001bba0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0001bbb0: 2020 2020 2020 2020 6474 203d 2064 6174          dt = dat
-0001bbc0: 6574 696d 652e 6461 7465 7469 6d65 2e73  etime.datetime.s
-0001bbd0: 7472 7074 696d 6528 656e 7472 795b 2769  trptime(entry['i
-0001bbe0: 6d61 6765 2d64 6174 6574 696d 6527 5d2c  mage-datetime'],
-0001bbf0: 2064 6174 6574 696d 655f 666f 726d 6174   datetime_format
-0001bc00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001bc10: 2020 2020 2020 656e 7472 795b 2769 6d61        entry['ima
-0001bc20: 6765 2d64 6174 6574 696d 6527 5d20 3d20  ge-datetime'] = 
-0001bc30: 6474 2e73 7472 6674 696d 6528 6d69 7174  dt.strftime(miqt
-0001bc40: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-0001bc50: 6d61 7269 7174 275d 290a 2020 2020 2020  mariqt']).      
-0001bc60: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001bc70: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001bc80: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
-0001bc90: 7074 696f 6e28 2264 6174 6120 656e 7472  ption("data entr
-0001bca0: 6965 7320 6d75 7374 2062 6520 6469 6374  ies must be dict
-0001bcb0: 206f 7220 6c69 7374 2069 6620 6469 6374   or list if dict
-0001bcc0: 7322 290a 0a20 2020 2020 2020 206d 6971  s")..        miq
-0001bcd0: 7463 2e72 6563 7572 7369 7665 6c79 5570  tc.recursivelyUp
-0001bce0: 6461 7465 4469 6374 7328 6974 656d 732c  dateDicts(items,
-0001bcf0: 6461 7461 290a 0a0a 2020 2020 4073 7461  data)...    @sta
-0001bd00: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
-0001bd10: 6620 6578 7472 6163 7443 6f6e 7374 4461  f extractConstDa
-0001bd20: 7461 5661 6c75 6573 2864 6174 613a 6469  taValues(data:di
-0001bd30: 6374 2c68 6561 6465 723a 6469 6374 293a  ct,header:dict):
-0001bd40: 0a20 2020 2020 2020 2022 2222 2052 656d  .        """ Rem
-0001bd50: 6f76 6573 2066 6965 6c64 7320 7468 6174  oves fields that
-0001bd60: 2061 7265 2063 6f6e 7374 616e 7420 666f   are constant fo
-0001bd70: 7220 616c 6c20 656e 7472 6965 7320 6672  r all entries fr
-0001bd80: 6f6d 2064 6174 6120 6469 6374 2061 6e64  om data dict and
-0001bd90: 2070 7574 2074 6865 6d20 696e 2068 6561   put them in hea
-0001bda0: 6465 7220 6469 6374 2e20 0a20 2020 2020  der dict. .     
-0001bdb0: 2020 2020 2020 2045 6163 6820 656e 7472         Each entr
-0001bdc0: 7920 6f66 2064 6174 6120 6d75 7374 2062  y of data must b
-0001bdd0: 6520 6120 6469 6374 2077 6974 6820 7468  e a dict with th
-0001bde0: 6520 7361 6d65 2073 6574 206f 6620 6b65  e same set of ke
-0001bdf0: 7973 2e20 2222 220a 2020 2020 0a20 2020  ys. """.    .   
-0001be00: 2020 2020 2023 2073 6b69 7020 6966 2074       # skip if t
-0001be10: 6865 7265 2069 7320 6f6e 6c79 206f 6e65  here is only one
-0001be20: 2069 7465 6d0a 2020 2020 2020 2020 6966   item.        if
-0001be30: 206c 656e 286c 6973 7428 6461 7461 2e6b   len(list(data.k
-0001be40: 6579 7328 2929 2920 3d3d 2031 3a0a 2020  eys())) == 1:.  
-0001be50: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001be60: 0a0a 2020 2020 2020 2020 6669 656c 6473  ..        fields
-0001be70: 546f 4967 6e6f 7265 203d 205b 2769 6d61  ToIgnore = ['ima
-0001be80: 6765 2d64 6174 6574 696d 6527 5d0a 2020  ge-datetime'].  
-0001be90: 2020 2020 2020 636f 6e73 7444 6174 6120        constData 
-0001bea0: 3d20 7b7d 0a20 2020 2020 2020 2066 6972  = {}.        fir
-0001beb0: 7374 496d 6167 6520 3d20 5472 7565 0a20  stImage = True. 
-0001bec0: 2020 2020 2020 2066 6f72 2069 6d61 6765         for image
-0001bed0: 2c69 6d61 6765 5f64 6174 6120 696e 2064  ,image_data in d
-0001bee0: 6174 612e 6974 656d 7328 293a 0a20 2020  ata.items():.   
-0001bef0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0001bf00: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-0001bf10: 6e73 7461 6e63 6528 696d 6167 655f 6461  nstance(image_da
-0001bf20: 7461 2c6c 6973 7429 3a0a 2020 2020 2020  ta,list):.      
-0001bf30: 2020 2020 2020 2020 2020 696d 6167 655f            image_
-0001bf40: 6461 7461 203d 205b 696d 6167 655f 6461  data = [image_da
-0001bf50: 7461 5d0a 0a20 2020 2020 2020 2020 2020  ta]..           
-0001bf60: 2069 6620 6e6f 7420 6669 7273 7449 6d61   if not firstIma
-0001bf70: 6765 2061 6e64 2063 6f6e 7374 4461 7461  ge and constData
-0001bf80: 203d 3d20 7b7d 3a0a 2020 2020 2020 2020   == {}:.        
-0001bf90: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-0001bfa0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0001bfb0: 2020 2020 2020 2066 6972 7374 5469 6d65         firstTime
-0001bfc0: 506f 696e 7420 3d20 5472 7565 0a20 2020  Point = True.   
-0001bfd0: 2020 2020 2020 2020 2066 6f72 2069 6d61           for ima
-0001bfe0: 6765 5f74 705f 6461 7461 2069 6e20 696d  ge_tp_data in im
-0001bff0: 6167 655f 6461 7461 3a0a 2020 2020 2020  age_data:.      
-0001c000: 2020 2020 2020 2020 2020 2320 7665 7279            # very
-0001c010: 2066 6972 7374 2064 6174 6120 666f 7220   first data for 
-0001c020: 636f 6d70 6172 6973 6f6e 0a20 2020 2020  comparison.     
-0001c030: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
-0001c040: 7273 7449 6d61 6765 2061 6e64 2066 6972  rstImage and fir
-0001c050: 7374 5469 6d65 506f 696e 743a 0a20 2020  stTimePoint:.   
-0001c060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c070: 2063 6f6e 7374 4461 7461 203d 2063 6f70   constData = cop
-0001c080: 792e 6465 6570 636f 7079 2869 6d61 6765  y.deepcopy(image
-0001c090: 5f74 705f 6461 7461 290a 2020 2020 2020  _tp_data).      
-0001c0a0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0001c0b0: 7220 6669 656c 6420 696e 2066 6965 6c64  r field in field
-0001c0c0: 7354 6f49 676e 6f72 653a 0a20 2020 2020  sToIgnore:.     
-0001c0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0e0: 2020 2069 6620 6669 656c 6420 696e 2063     if field in c
-0001c0f0: 6f6e 7374 4461 7461 3a0a 2020 2020 2020  onstData:.      
-0001c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c110: 2020 2020 2020 6465 6c20 636f 6e73 7444        del constD
-0001c120: 6174 615b 6669 656c 645d 0a20 2020 2020  ata[field].     
-0001c130: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001c140: 6972 7374 5469 6d65 506f 696e 7420 3d20  irstTimePoint = 
-0001c150: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0001c160: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-0001c170: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
-0001c180: 2020 2020 636f 6e73 7444 6174 6120 3d20      constData = 
-0001c190: 6d69 7174 632e 6669 6e64 436f 6d6d 6f6e  miqtc.findCommon
-0001c1a0: 4469 6374 456c 656d 656e 7473 2869 6d61  DictElements(ima
-0001c1b0: 6765 5f74 705f 6461 7461 2c63 6f6e 7374  ge_tp_data,const
-0001c1c0: 4461 7461 290a 0a20 2020 2020 2020 2020  Data)..         
-0001c1d0: 2020 2066 6972 7374 496d 6167 6520 3d20     firstImage = 
-0001c1e0: 4661 6c73 650a 0a20 2020 2020 2020 2023  False..        #
-0001c1f0: 2054 4f44 4f20 6368 6563 6b20 7769 7468   TODO check with
-0001c200: 696e 2069 6d61 6765 2074 696d 6573 202d  in image times -
-0001c210: 3e20 746f 2069 6d61 6765 2064 6566 6175  > to image defau
-0001c220: 6c74 2e20 2874 7269 636b 7920 7369 6e63  lt. (tricky sinc
-0001c230: 6520 7765 2064 6f6e 2774 2068 6176 6520  e we don't have 
-0001c240: 7468 6520 6461 6661 756c 7420 696e 6465  the dafault inde
-0001c250: 7820 6865 7265 2e20 4f6e 6c79 2061 2073  x here. Only a s
-0001c260: 7562 7365 7420 6d69 6768 7420 6265 2075  ubset might be u
-0001c270: 7064 6174 6520 6865 7265 290a 2020 2020  pdate here).    
-0001c280: 2020 2020 2320 6368 6563 6b20 7769 7468      # check with
-0001c290: 696e 2069 6d61 6765 2069 7465 6d73 202d  in image items -
-0001c2a0: 3e20 6865 6164 6572 0a20 2020 2020 2020  > header.       
-0001c2b0: 2068 6561 6465 7255 7064 6174 6520 3d20   headerUpdate = 
-0001c2c0: 636f 7079 2e64 6565 7063 6f70 7928 636f  copy.deepcopy(co
-0001c2d0: 6e73 7444 6174 6129 0a20 2020 2020 2020  nstData).       
-0001c2e0: 2068 6561 6465 7255 7064 6174 6564 5465   headerUpdatedTe
-0001c2f0: 7374 203d 2063 6f70 792e 6465 6570 636f  st = copy.deepco
-0001c300: 7079 2868 6561 6465 7229 0a20 2020 2020  py(header).     
-0001c310: 2020 206d 6971 7463 2e72 6563 7572 7369     miqtc.recursi
-0001c320: 7665 6c79 5570 6461 7465 4469 6374 7328  velyUpdateDicts(
-0001c330: 6865 6164 6572 5570 6461 7465 6454 6573  headerUpdatedTes
-0001c340: 742c 6865 6164 6572 5570 6461 7465 290a  t,headerUpdate).
-0001c350: 2020 2020 2020 2020 7570 6461 7465 4469          updateDi
-0001c360: 6666 203d 2044 6565 7044 6966 6628 6865  ff = DeepDiff(he
-0001c370: 6164 6572 2c68 6561 6465 7255 7064 6174  ader,headerUpdat
-0001c380: 6564 5465 7374 290a 2020 2020 2020 2020  edTest).        
-0001c390: 2320 6368 6563 6b20 6966 2068 6561 6465  # check if heade
-0001c3a0: 7255 7064 6174 6520 776f 756c 6420 6f76  rUpdate would ov
-0001c3b0: 6572 7772 6974 6520 616e 7974 6869 6e67  erwrite anything
-0001c3c0: 2066 726f 6d20 6375 7272 656e 7420 6865   from current he
-0001c3d0: 6164 6572 2028 7368 6f75 6c64 206e 6f74  ader (should not
-0001c3e0: 2068 6170 7065 6e29 2c20 6966 2073 6f20   happen), if so 
-0001c3f0: 646f 6e74 2072 656d 6f76 6520 6672 6f6d  dont remove from
-0001c400: 2069 7465 6d73 0a20 2020 2020 2020 2069   items.        i
-0001c410: 6620 6e6f 7420 2776 616c 7565 735f 6368  f not 'values_ch
-0001c420: 616e 6765 6427 2069 6e20 7570 6461 7465  anged' in update
-0001c430: 4469 6666 2061 6e64 206e 6f74 2027 7479  Diff and not 'ty
-0001c440: 7065 5f63 6861 6e67 6573 2720 696e 2075  pe_changes' in u
-0001c450: 7064 6174 6544 6966 6620 616e 6420 6e6f  pdateDiff and no
-0001c460: 7420 2764 6963 7469 6f6e 6172 795f 6974  t 'dictionary_it
-0001c470: 656d 5f72 656d 6f76 6564 2720 696e 2075  em_removed' in u
-0001c480: 7064 6174 6544 6966 663a 0a20 2020 2020  pdateDiff:.     
-0001c490: 2020 2020 2020 2068 6561 6465 722e 636c         header.cl
-0001c4a0: 6561 7228 290a 2020 2020 2020 2020 2020  ear().          
-0001c4b0: 2020 6865 6164 6572 2e75 7064 6174 6528    header.update(
-0001c4c0: 6865 6164 6572 5570 6461 7465 6454 6573  headerUpdatedTes
-0001c4d0: 7429 0a0a 2020 2020 2020 2020 2020 2020  t)..            
-0001c4e0: 2320 7265 6d6f 7665 2063 6f6e 7374 2076  # remove const v
-0001c4f0: 616c 7565 7320 6672 6f6d 2064 6174 610a  alues from data.
-0001c500: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
-0001c510: 632e 7265 6375 7273 6976 654d 616b 654e  c.recursiveMakeN
-0001c520: 6f6e 6544 6963 7446 6965 6c64 7345 6d70  oneDictFieldsEmp
-0001c530: 7479 5374 7228 636f 6e73 7444 6174 6129  tyStr(constData)
-0001c540: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0001c550: 2069 6d61 6765 2c69 6d61 6765 5f64 6174   image,image_dat
-0001c560: 6120 696e 2064 6174 612e 6974 656d 7328  a in data.items(
-0001c570: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001c580: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-0001c590: 616e 6365 2869 6d61 6765 5f64 6174 612c  ance(image_data,
-0001c5a0: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
-0001c5b0: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-0001c5c0: 5f64 6174 6120 3d20 5b69 6d61 6765 5f64  _data = [image_d
-0001c5d0: 6174 615d 0a20 2020 2020 2020 2020 2020  ata].           
-0001c5e0: 2020 2020 2066 6f72 2069 6d61 6765 5f74       for image_t
-0001c5f0: 705f 6461 7461 2069 6e20 696d 6167 655f  p_data in image_
-0001c600: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-0001c610: 2020 2020 2020 2020 2020 6d69 7174 632e            miqtc.
-0001c620: 7265 6375 7273 6976 656c 7955 7064 6174  recursivelyUpdat
-0001c630: 6544 6963 7473 2869 6d61 6765 5f74 705f  eDicts(image_tp_
-0001c640: 6461 7461 2c63 6f6e 7374 4461 7461 2920  data,constData) 
-0001c650: 2020 2020 2020 2020 200a 0a20 2020 2020           ..     
-0001c660: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001c670: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-0001c680: 2020 2020 2020 2320 544f 444f 206c 6f67        # TODO log
-0001c690: 3f0a 0a0a 2020 2020 4073 7461 7469 636d  ?...    @staticm
-0001c6a0: 6574 686f 640a 2020 2020 6465 6620 6765  ethod.    def ge
-0001c6b0: 745f 6865 6164 6572 5f65 7175 6970 6d65  t_header_equipme
-0001c6c0: 6e74 5f75 7269 5f74 6f5f 6571 7569 706d  nt_uri_to_equipm
-0001c6d0: 656e 745f 6769 745f 7572 6c28 6966 646f  ent_git_url(ifdo
-0001c6e0: 3a64 6963 742c 2069 6664 6f5f 6669 656c  :dict, ifdo_fiel
-0001c6f0: 643a 7374 722c 2070 726f 763a 6d69 7174  d:str, prov:miqt
-0001c700: 702e 5072 6f76 656e 616e 6365 3d4e 6f6e  p.Provenance=Non
-0001c710: 6529 3a0a 2020 2020 2020 2020 2222 2220  e):.        """ 
-0001c720: 436f 6e73 7472 7563 7473 2061 6e64 2072  Constructs and r
-0001c730: 6574 7572 6e73 2065 7175 6970 6d65 6e74  eturns equipment
-0001c740: 2075 726c 2066 726f 6d20 6966 646f 5f66   url from ifdo_f
-0001c750: 6965 6c64 5b27 6e61 6d65 275d 2e20 5265  ield['name']. Re
-0001c760: 7475 726e 7320 2222 2069 6620 6661 696c  turns "" if fail
-0001c770: 732e 2044 6f65 7320 6e6f 7420 6368 6563  s. Does not chec
-0001c780: 6b20 6973 2073 6974 6520 6973 2075 702e  k is site is up.
-0001c790: 2022 2222 0a0a 2020 2020 2020 2020 6465   """..        de
-0001c7a0: 6620 5f6c 6f67 286d 7367 3a73 7472 293a  f _log(msg:str):
-0001c7b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001c7c0: 7072 6f76 2069 7320 6e6f 7420 4e6f 6e65  prov is not None
-0001c7d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c7e0: 2020 7072 6f76 2e6c 6f67 286d 7367 290a    prov.log(msg).
-0001c7f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0001c800: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c810: 2020 7072 696e 7428 6d73 6729 0a0a 2020    print(msg)..  
-0001c820: 2020 2020 2020 696d 6167 655f 6669 656c        image_fiel
-0001c830: 6420 3d20 6946 444f 2e66 696e 645f 6669  d = iFDO.find_fi
-0001c840: 656c 645f 7374 7228 6966 646f 2c69 6664  eld_str(ifdo,ifd
-0001c850: 6f5f 6669 656c 6429 0a20 2020 2020 2020  o_field).       
-0001c860: 2069 6620 696d 6167 655f 6669 656c 6420   if image_field 
-0001c870: 3d3d 2022 2220 6f72 2027 6e61 6d65 2720  == "" or 'name' 
-0001c880: 6e6f 7420 696e 2069 6d61 6765 5f66 6965  not in image_fie
-0001c890: 6c64 206f 7220 696d 6167 655f 6669 656c  ld or image_fiel
-0001c8a0: 645b 276e 616d 6527 5d20 3d3d 2022 223a  d['name'] == "":
-0001c8b0: 0a20 2020 2020 2020 2020 2020 205f 6c6f  .            _lo
-0001c8c0: 6728 2245 7272 6f72 2120 4361 6e27 7420  g("Error! Can't 
-0001c8d0: 636f 6e73 7472 7563 7420 2220 202b 2069  construct "  + i
-0001c8e0: 6664 6f5f 6669 656c 6420 2b20 2220 7572  fdo_field + " ur
-0001c8f0: 692c 206e 616d 6520 6e6f 7420 6669 6c6c  i, name not fill
-0001c900: 6564 2e22 290a 2020 2020 2020 2020 2020  ed.").          
-0001c910: 2020 7265 7475 726e 2022 220a 0a20 2020    return ""..   
-0001c920: 2020 2020 2065 7169 705f 7572 6c20 3d20       eqip_url = 
-0001c930: 6d69 7174 6571 7569 702e 6571 7569 706d  miqtequip.equipm
-0001c940: 656e 745f 7572 6c28 696d 6167 655f 6669  ent_url(image_fi
-0001c950: 656c 645b 276e 616d 6527 5d29 0a20 2020  eld['name']).   
-0001c960: 2020 2020 2072 6574 7572 6e20 6571 6970       return eqip
-0001c970: 5f75 726c 0a20 2020 200a 2020 2020 6465  _url.    .    de
-0001c980: 6620 7365 745f 6865 6164 6572 5f65 7175  f set_header_equ
-0001c990: 6970 6d65 6e74 5f75 7269 5f74 6f5f 6571  ipment_uri_to_eq
-0001c9a0: 7569 706d 656e 745f 6769 745f 7572 6c28  uipment_git_url(
-0001c9b0: 7365 6c66 2c69 6664 6f5f 6669 656c 643a  self,ifdo_field:
-0001c9c0: 7374 722c 206f 7665 7272 6964 653a 626f  str, override:bo
-0001c9d0: 6f6c 203d 2046 616c 7365 2c20 6967 6e6f  ol = False, igno
-0001c9e0: 7265 5f6f 6666 6c69 6e65 3a62 6f6f 6c20  re_offline:bool 
-0001c9f0: 3d20 4661 6c73 6529 3a0a 2020 2020 2020  = False):.      
-0001ca00: 2020 2222 2220 436f 6e73 7472 7563 7473    """ Constructs
-0001ca10: 2065 7175 6970 6d65 6e74 2075 726c 2066   equipment url f
-0001ca20: 726f 6d20 6966 646f 5f66 6965 6c64 5b27  rom ifdo_field['
-0001ca30: 6e61 6d65 275d 2061 6e64 2077 7269 7465  name'] and write
-0001ca40: 2069 7420 746f 2069 6664 6f5f 6669 656c   it to ifdo_fiel
-0001ca50: 645b 2775 7269 275d 2e0a 2020 2020 2020  d['uri']..      
-0001ca60: 2020 5061 7261 6d73 3a0a 2020 2020 2020    Params:.      
-0001ca70: 2020 2020 2020 6f76 6572 7269 6465 3a20        override: 
-0001ca80: 6966 2046 616c 7365 2073 6574 206f 6e6c  if False set onl
-0001ca90: 7920 6966 2075 7269 2069 7320 656d 7074  y if uri is empt
-0001caa0: 7920 6f72 2064 6f65 7320 6e6f 7420 6578  y or does not ex
-0001cab0: 6973 742e 0a20 2020 2020 2020 2020 2020  ist..           
-0001cac0: 2069 676e 6f72 655f 6f66 666c 696e 653a   ignore_offline:
-0001cad0: 2077 7269 7465 2074 6f20 6966 646f 5f66   write to ifdo_f
-0001cae0: 6965 6c64 5b27 7572 6927 5d20 6576 656e  ield['uri'] even
-0001caf0: 2069 6620 636f 6e73 7472 7563 7465 6420   if constructed 
-0001cb00: 7572 6c20 6973 206e 6f74 2072 6561 6368  url is not reach
-0001cb10: 6162 6c65 2e20 2222 220a 2020 2020 2020  able. """.      
-0001cb20: 2020 0a20 2020 2020 2020 2069 6620 6e6f    .        if no
-0001cb30: 7420 6f76 6572 7269 6465 2061 6e64 2073  t override and s
-0001cb40: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
-0001cb50: 3228 6966 646f 5f66 6965 6c64 2b27 3a75  2(ifdo_field+':u
-0001cb60: 7269 2729 2021 3d20 2222 3a0a 2020 2020  ri') != "":.    
-0001cb70: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-0001cb80: 762e 6c6f 6728 2243 6175 7469 6f6e 2120  v.log("Caution! 
-0001cb90: 2220 2b20 6966 646f 5f66 6965 6c64 202b  " + ifdo_field +
-0001cba0: 2022 3a75 7269 2061 6c72 6561 6479 2065   ":uri already e
-0001cbb0: 7869 7374 7320 616e 6420 6973 206e 6f74  xists and is not
-0001cbc0: 206f 7665 7272 6964 6465 6e3a 2022 202b   overridden: " +
-0001cbd0: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
-0001cbe0: 6c64 3228 6966 646f 5f66 6965 6c64 2b20  ld2(ifdo_field+ 
-0001cbf0: 273a 7572 6927 2929 0a20 2020 2020 2020  ':uri')).       
-0001cc00: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-0001cc10: 2020 2020 0a20 2020 2020 2020 2065 7169      .        eqi
-0001cc20: 705f 7572 6c20 3d20 7365 6c66 2e67 6574  p_url = self.get
-0001cc30: 5f68 6561 6465 725f 6571 7569 706d 656e  _header_equipmen
-0001cc40: 745f 7572 695f 746f 5f65 7175 6970 6d65  t_uri_to_equipme
-0001cc50: 6e74 5f67 6974 5f75 726c 2873 656c 662e  nt_git_url(self.
-0001cc60: 6966 646f 5f74 6d70 2c69 6664 6f5f 6669  ifdo_tmp,ifdo_fi
-0001cc70: 656c 642c 7365 6c66 2e70 726f 7629 0a20  eld,self.prov). 
-0001cc80: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0001cc90: 2020 2020 2020 2020 7265 7420 3d20 7265          ret = re
-0001cca0: 7175 6573 7473 2e68 6561 6428 6571 6970  quests.head(eqip
-0001ccb0: 5f75 726c 2c20 7469 6d65 6f75 743d 3529  _url, timeout=5)
-0001ccc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001ccd0: 7265 742e 7374 6174 7573 5f63 6f64 6520  ret.status_code 
-0001cce0: 213d 2032 3030 3a0a 2020 2020 2020 2020  != 200:.        
-0001ccf0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-0001cd00: 6365 7074 696f 6e28 290a 2020 2020 2020  ception().      
-0001cd10: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-0001cd20: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-0001cd30: 6966 206e 6f74 2069 676e 6f72 655f 6f66  if not ignore_of
-0001cd40: 666c 696e 653a 0a20 2020 2020 2020 2020  fline:.         
-0001cd50: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-0001cd60: 2e6c 6f67 2822 4572 726f 7221 2022 202b  .log("Error! " +
-0001cd70: 2069 6664 6f5f 6669 656c 6420 2b20 223a   ifdo_field + ":
-0001cd80: 7572 6920 6967 6e6f 7265 642c 206e 6f74  uri ignored, not
-0001cd90: 2072 6561 6368 6162 6c65 3a20 2220 2b20   reachable: " + 
-0001cda0: 6571 6970 5f75 726c 290a 2020 2020 2020  eqip_url).      
-0001cdb0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001cdc0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0001cdd0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001cde0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-0001cdf0: 2822 4361 7574 696f 6e21 2022 202b 2069  ("Caution! " + i
-0001ce00: 6664 6f5f 6669 656c 6420 2b20 223a 7572  fdo_field + ":ur
-0001ce10: 6920 7365 7420 6275 7420 6e6f 7420 7265  i set but not re
-0001ce20: 6163 6861 626c 6520 2220 2b20 6571 6970  achable " + eqip
-0001ce30: 5f75 726c 290a 0a20 2020 2020 2020 2073  _url)..        s
-0001ce40: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0001ce50: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-0001ce60: 4b65 795d 5b69 6664 6f5f 6669 656c 645d  Key][ifdo_field]
-0001ce70: 5b27 7572 6927 5d20 3d20 6571 6970 5f75  ['uri'] = eqip_u
-0001ce80: 726c 0a20 2020 2020 2020 2073 656c 662e  rl.        self.
-0001ce90: 7072 6f76 2e6c 6f67 2869 6664 6f5f 6669  prov.log(ifdo_fi
-0001cea0: 656c 6420 2b20 223a 7572 6920 7365 7420  eld + ":uri set 
-0001ceb0: 746f 2022 202b 2065 7169 705f 7572 6c29  to " + eqip_url)
-0001cec0: 0a0a 0a20 2020 2040 7374 6174 6963 6d65  ...    @staticme
-0001ced0: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
-0001cee0: 5f68 6561 6465 725f 696d 6167 655f 7072  _header_image_pr
-0001cef0: 6f6a 6563 745f 7572 695f 746f 5f6f 7369  oject_uri_to_osi
-0001cf00: 735f 6578 7065 6469 7469 6f6e 5f75 726c  s_expedition_url
-0001cf10: 2869 6664 6f3a 6469 6374 2c70 726f 763a  (ifdo:dict,prov:
-0001cf20: 6d69 7174 702e 5072 6f76 656e 616e 6365  miqtp.Provenance
-0001cf30: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0001cf40: 2222 2220 5265 7475 726e 7320 6865 6164  """ Returns head
-0001cf50: 6572 2069 6d61 6765 2d70 726f 6a65 6374  er image-project
-0001cf60: 2075 7269 2061 7320 6f73 6973 2065 7870   uri as osis exp
-0001cf70: 6564 6974 696f 6e20 7572 6c20 7061 7273  edition url pars
-0001cf80: 6564 2066 726f 6d20 696d 6167 652d 7072  ed from image-pr
-0001cf90: 6f6a 6563 745b 276e 616d 6527 5d2e 2222  oject['name'].""
-0001cfa0: 220a 0a20 2020 2020 2020 2064 6566 205f  "..        def _
-0001cfb0: 6c6f 6728 6d73 673a 7374 7229 3a0a 2020  log(msg:str):.  
-0001cfc0: 2020 2020 2020 2020 2020 6966 2070 726f            if pro
-0001cfd0: 7620 6973 206e 6f74 204e 6f6e 653a 0a20  v is not None:. 
-0001cfe0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001cff0: 726f 762e 6c6f 6728 6d73 6729 0a20 2020  rov.log(msg).   
-0001d000: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001d010: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001d020: 7269 6e74 286d 7367 290a 0a20 2020 2020  rint(msg)..     
-0001d030: 2020 2069 6d61 6765 5f70 726f 6a65 6374     image_project
-0001d040: 203d 2069 4644 4f2e 6669 6e64 5f66 6965   = iFDO.find_fie
-0001d050: 6c64 5f73 7472 2869 6664 6f2c 2769 6d61  ld_str(ifdo,'ima
-0001d060: 6765 2d70 726f 6a65 6374 2729 0a20 2020  ge-project').   
-0001d070: 2020 2020 2069 6620 696d 6167 655f 7072       if image_pr
-0001d080: 6f6a 6563 7420 3d3d 2022 2220 6f72 2027  oject == "" or '
-0001d090: 6e61 6d65 2720 6e6f 7420 696e 2069 6d61  name' not in ima
-0001d0a0: 6765 5f70 726f 6a65 6374 206f 7220 696d  ge_project or im
-0001d0b0: 6167 655f 7072 6f6a 6563 745b 276e 616d  age_project['nam
-0001d0c0: 6527 5d20 3d3d 2022 223a 0a20 2020 2020  e'] == "":.     
-0001d0d0: 2020 2020 2020 205f 6c6f 6728 2245 7272         _log("Err
-0001d0e0: 6f72 2120 4361 6e27 7420 636f 6e73 7472  or! Can't constr
-0001d0f0: 7563 7420 696d 6167 652d 7072 6f6a 6563  uct image-projec
-0001d100: 7420 7572 692c 2069 6d61 6765 2d70 726f  t uri, image-pro
-0001d110: 6a65 6374 206e 6f74 2066 696c 6c65 642e  ject not filled.
-0001d120: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
-0001d130: 6574 7572 6e20 2222 0a20 2020 2020 2020  eturn "".       
-0001d140: 200a 2020 2020 2020 2020 2320 6765 7420   .        # get 
-0001d150: 6578 7065 6469 7469 6f6e 2069 640a 2020  expedition id.  
-0001d160: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0001d170: 2020 2020 2020 2065 7870 6564 6974 696f         expeditio
-0001d180: 6e5f 6964 203d 206d 6971 746f 7369 732e  n_id = miqtosis.
-0001d190: 6765 745f 6578 7065 6469 7469 6f6e 5f69  get_expedition_i
-0001d1a0: 645f 6672 6f6d 5f6c 6162 656c 2869 6d61  d_from_label(ima
-0001d1b0: 6765 5f70 726f 6a65 6374 5b27 6e61 6d65  ge_project['name
-0001d1c0: 275d 290a 2020 2020 2020 2020 6578 6365  ']).        exce
-0001d1d0: 7074 2056 616c 7565 4572 726f 723a 0a20  pt ValueError:. 
-0001d1e0: 2020 2020 2020 2020 2020 205f 6c6f 6728             _log(
-0001d1f0: 2245 7272 6f72 2120 4361 6e27 7420 6765  "Error! Can't ge
-0001d200: 7420 6f73 6973 2065 7870 6564 6974 696f  t osis expeditio
-0001d210: 6e20 6964 2066 726f 6d20 696d 6167 652d  n id from image-
-0001d220: 7072 6f6a 6563 7420 2220 2b20 7374 7228  project " + str(
-0001d230: 696d 6167 655f 7072 6f6a 6563 7429 290a  image_project)).
-0001d240: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001d250: 726e 2022 220a 0a20 2020 2020 2020 2065  rn ""..        e
-0001d260: 7870 6564 6974 696f 6e5f 7572 6c20 3d20  xpedition_url = 
-0001d270: 6d69 7174 6f73 6973 2e67 6574 5f65 7870  miqtosis.get_exp
-0001d280: 6564 6974 696f 6e5f 7572 6c28 6578 7065  edition_url(expe
-0001d290: 6469 7469 6f6e 5f69 6429 0a20 2020 2020  dition_id).     
-0001d2a0: 2020 2072 6574 7572 6e20 6578 7065 6469     return expedi
-0001d2b0: 7469 6f6e 5f75 726c 0a0a 0a20 2020 2064  tion_url...    d
-0001d2c0: 6566 2073 6574 5f68 6561 6465 725f 696d  ef set_header_im
-0001d2d0: 6167 655f 7072 6f6a 6563 745f 7572 695f  age_project_uri_
-0001d2e0: 746f 5f6f 7369 735f 6578 7065 6469 7469  to_osis_expediti
-0001d2f0: 6f6e 5f75 726c 2873 656c 662c 6f76 6572  on_url(self,over
-0001d300: 7269 6465 3a62 6f6f 6c20 3d20 4661 6c73  ride:bool = Fals
-0001d310: 6529 3a0a 2020 2020 2020 2020 2222 2220  e):.        """ 
-0001d320: 5365 7473 2068 6561 6465 7220 696d 6167  Sets header imag
-0001d330: 652d 7072 6f6a 6563 7420 7572 6920 746f  e-project uri to
-0001d340: 206f 7369 7320 6578 7065 6469 7469 6f6e   osis expedition
-0001d350: 2075 726c 2070 6172 7365 6420 6672 6f6d   url parsed from
-0001d360: 2069 6d61 6765 2d70 726f 6a65 6374 5b27   image-project['
-0001d370: 6e61 6d65 275d 2e0a 2020 2020 2020 2020  name']..        
-0001d380: 5061 7261 6d73 3a0a 2020 2020 2020 2020  Params:.        
-0001d390: 2020 2020 6f76 6572 7269 6465 3a20 6966      override: if
-0001d3a0: 2046 616c 7365 2073 6574 206f 6e6c 7920   False set only 
-0001d3b0: 6966 2075 7269 2069 7320 656d 7074 7920  if uri is empty 
-0001d3c0: 6f72 2064 6f65 7320 6e6f 7420 6578 6973  or does not exis
-0001d3d0: 742e 2022 2222 0a0a 2020 2020 2020 2020  t. """..        
-0001d3e0: 6966 206e 6f74 206f 7665 7272 6964 6520  if not override 
-0001d3f0: 616e 6420 7365 6c66 2e66 696e 6454 6d70  and self.findTmp
-0001d400: 4669 656c 6432 2827 696d 6167 652d 7072  Field2('image-pr
-0001d410: 6f6a 6563 743a 7572 6927 2920 213d 2022  oject:uri') != "
-0001d420: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
-0001d430: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
-0001d440: 7574 696f 6e21 2069 6d61 6765 2d70 726f  ution! image-pro
-0001d450: 6a65 6374 3a75 7269 2061 6c72 6561 6479  ject:uri already
-0001d460: 2065 7869 7374 7320 616e 6420 6973 206e   exists and is n
-0001d470: 6f74 206f 7665 7272 6964 6465 6e3a 2022  ot overridden: "
-0001d480: 202b 2073 656c 662e 6669 6e64 546d 7046   + self.findTmpF
-0001d490: 6965 6c64 3228 2769 6d61 6765 2d70 726f  ield2('image-pro
-0001d4a0: 6a65 6374 3a75 7269 2729 290a 2020 2020  ject:uri')).    
-0001d4b0: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-0001d4c0: 2020 2020 2020 2020 6578 7065 6469 7469          expediti
-0001d4d0: 6f6e 5f75 726c 203d 2073 656c 662e 6765  on_url = self.ge
-0001d4e0: 745f 6865 6164 6572 5f69 6d61 6765 5f70  t_header_image_p
-0001d4f0: 726f 6a65 6374 5f75 7269 5f74 6f5f 6f73  roject_uri_to_os
-0001d500: 6973 5f65 7870 6564 6974 696f 6e5f 7572  is_expedition_ur
-0001d510: 6c28 7365 6c66 2e69 6664 6f5f 746d 702c  l(self.ifdo_tmp,
-0001d520: 7365 6c66 2e70 726f 7629 0a20 2020 2020  self.prov).     
-0001d530: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0001d540: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0001d550: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
-0001d560: 7072 6f6a 6563 7427 5d5b 2775 7269 275d  project']['uri']
-0001d570: 203d 2065 7870 6564 6974 696f 6e5f 7572   = expedition_ur
-0001d580: 6c0a 2020 2020 2020 2020 7472 793a 0a20  l.        try:. 
-0001d590: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
-0001d5a0: 2072 6571 7565 7374 732e 6865 6164 2865   requests.head(e
-0001d5b0: 7870 6564 6974 696f 6e5f 7572 6c29 0a20  xpedition_url). 
-0001d5c0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-0001d5d0: 742e 7374 6174 7573 5f63 6f64 6520 213d  t.status_code !=
-0001d5e0: 2032 3030 3a0a 2020 2020 2020 2020 2020   200:.          
-0001d5f0: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-0001d600: 7074 696f 6e28 290a 2020 2020 2020 2020  ption().        
-0001d610: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-0001d620: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0001d630: 6c66 2e70 726f 762e 6c6f 6728 2243 6175  lf.prov.log("Cau
-0001d640: 7469 6f6e 2120 696d 6167 652d 7072 6f6a  tion! image-proj
-0001d650: 6563 743a 7572 6920 7365 7420 6275 7420  ect:uri set but 
-0001d660: 6e6f 7420 7265 6163 6861 626c 6520 2220  not reachable " 
-0001d670: 2b20 6578 7065 6469 7469 6f6e 5f75 726c  + expedition_url
-0001d680: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
-0001d690: 726f 762e 6c6f 6728 2269 6d61 6765 2d70  rov.log("image-p
-0001d6a0: 726f 6a65 6374 3a75 7269 2073 6574 2074  roject:uri set t
-0001d6b0: 6f20 2220 2b20 6578 7065 6469 7469 6f6e  o " + expedition
-0001d6c0: 5f75 726c 290a 0a0a 2020 2020 4073 7461  _url)...    @sta
-0001d6d0: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
-0001d6e0: 6620 6765 745f 6865 6164 6572 5f69 6d61  f get_header_ima
-0001d6f0: 6765 5f65 7665 6e74 5f75 7269 5f74 6f5f  ge_event_uri_to_
-0001d700: 6f73 6973 5f65 7665 6e74 5f75 726c 2869  osis_event_url(i
-0001d710: 6664 6f3a 6469 6374 2c70 726f 763a 6d69  fdo:dict,prov:mi
-0001d720: 7174 702e 5072 6f76 656e 616e 6365 3d4e  qtp.Provenance=N
-0001d730: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-0001d740: 2220 5265 7475 726e 7320 6865 6164 6572  " Returns header
-0001d750: 2069 6d61 6765 2d65 7665 6e74 2075 7269   image-event uri
-0001d760: 2061 7320 6f73 6973 2065 7665 6e74 2075   as osis event u
-0001d770: 726c 2070 6172 7365 6420 6672 6f6d 2069  rl parsed from i
-0001d780: 6d61 6765 2d70 726f 6a65 6374 2061 6e64  mage-project and
-0001d790: 2069 6d61 6765 2d65 7665 6e74 5b27 6e61   image-event['na
-0001d7a0: 6d65 275d 206f 7220 0a20 2020 2020 2020  me'] or .       
-0001d7b0: 2069 6d61 6765 2d65 7665 6e74 5b27 7572   image-event['ur
-0001d7c0: 6927 5d20 6966 2069 7420 7265 6665 7273  i'] if it refers
-0001d7d0: 2074 6f20 6f73 6973 2e20 5265 7475 726e   to osis. Return
-0001d7e0: 7320 656d 7074 7920 7374 7269 6e67 2069  s empty string i
-0001d7f0: 6620 6661 696c 732e 2022 2222 0a0a 2020  f fails. """..  
-0001d800: 2020 2020 2020 6465 6620 5f6c 6f67 286d        def _log(m
-0001d810: 7367 3a73 7472 293a 0a20 2020 2020 2020  sg:str):.       
-0001d820: 2020 2020 2069 6620 7072 6f76 2069 7320       if prov is 
-0001d830: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0001d840: 2020 2020 2020 2020 2020 7072 6f76 2e6c            prov.l
-0001d850: 6f67 286d 7367 290a 2020 2020 2020 2020  og(msg).        
-0001d860: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001d870: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001d880: 6d73 6729 0a0a 2020 2020 2020 2020 696d  msg)..        im
-0001d890: 6167 655f 7072 6f6a 6563 7420 3d20 6946  age_project = iF
-0001d8a0: 444f 2e66 696e 645f 6669 656c 645f 7374  DO.find_field_st
-0001d8b0: 7228 6966 646f 2c20 2769 6d61 6765 2d70  r(ifdo, 'image-p
-0001d8c0: 726f 6a65 6374 2729 0a20 2020 2020 2020  roject').       
-0001d8d0: 2069 6620 696d 6167 655f 7072 6f6a 6563   if image_projec
-0001d8e0: 7420 3d3d 2022 2220 6f72 2027 6e61 6d65  t == "" or 'name
-0001d8f0: 2720 6e6f 7420 696e 2069 6d61 6765 5f70  ' not in image_p
-0001d900: 726f 6a65 6374 206f 7220 696d 6167 655f  roject or image_
-0001d910: 7072 6f6a 6563 745b 276e 616d 6527 5d20  project['name'] 
-0001d920: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
-0001d930: 2020 205f 6c6f 6728 2245 7272 6f72 2120     _log("Error! 
-0001d940: 4361 6e27 7420 636f 6e73 7472 7563 7420  Can't construct 
-0001d950: 696d 6167 652d 6576 656e 7420 7572 692c  image-event uri,
-0001d960: 2069 6d61 6765 2d70 726f 6a65 6374 206e   image-project n
-0001d970: 6f74 2066 696c 6c65 642e 2229 0a20 2020  ot filled.").   
-0001d980: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001d990: 2222 0a0a 2020 2020 2020 2020 2320 6765  ""..        # ge
-0001d9a0: 7420 6578 7065 6469 7469 6f6e 2069 640a  t expedition id.
-0001d9b0: 2020 2020 2020 2020 2323 2074 7279 2070          ## try p
-0001d9c0: 6172 7365 2065 7870 6564 6974 696f 6e20  arse expedition 
-0001d9d0: 6964 2066 726f 6d20 7072 6f6a 6563 7420  id from project 
-0001d9e0: 6f73 6973 2075 7269 0a20 2020 2020 2020  osis uri.       
-0001d9f0: 2069 6620 2775 7269 2720 696e 2069 6d61   if 'uri' in ima
-0001da00: 6765 5f70 726f 6a65 6374 2061 6e64 2069  ge_project and i
-0001da10: 6d61 6765 5f70 726f 6a65 6374 5b27 7572  mage_project['ur
-0001da20: 6927 5d20 213d 2022 223a 0a20 2020 2020  i'] != "":.     
-0001da30: 2020 2020 2020 2065 7870 6564 6974 696f         expeditio
-0001da40: 6e5f 6964 203d 206d 6971 746f 7369 732e  n_id = miqtosis.
-0001da50: 6765 745f 6578 7065 6469 7469 6f6e 5f69  get_expedition_i
-0001da60: 645f 6672 6f6d 5f75 726c 2869 6d61 6765  d_from_url(image
-0001da70: 5f70 726f 6a65 6374 5b27 7572 6927 5d29  _project['uri'])
-0001da80: 0a20 2020 2020 2020 2023 2067 6574 2065  .        # get e
-0001da90: 7870 6564 6974 696f 6e20 6964 2066 726f  xpedition id fro
-0001daa0: 6d20 6f73 6973 2061 7069 2062 7920 6578  m osis api by ex
-0001dab0: 7065 6469 7469 6f6e 206e 616d 650a 2020  pedition name.  
-0001dac0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001dad0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0001dae0: 2020 2020 2020 2020 2020 2020 2065 7870               exp
-0001daf0: 6564 6974 696f 6e5f 6964 203d 206d 6971  edition_id = miq
-0001db00: 746f 7369 732e 6765 745f 6578 7065 6469  tosis.get_expedi
-0001db10: 7469 6f6e 5f69 645f 6672 6f6d 5f6c 6162  tion_id_from_lab
-0001db20: 656c 2869 6d61 6765 5f70 726f 6a65 6374  el(image_project
-0001db30: 5b27 6e61 6d65 275d 290a 2020 2020 2020  ['name']).      
-0001db40: 2020 2020 2020 6578 6365 7074 2056 616c        except Val
-0001db50: 7565 4572 726f 723a 0a20 2020 2020 2020  ueError:.       
-0001db60: 2020 2020 2020 2020 205f 6c6f 6728 2245           _log("E
-0001db70: 7272 6f72 2120 4361 6e27 7420 6765 7420  rror! Can't get 
-0001db80: 6f73 6973 2065 7870 6564 6974 696f 6e20  osis expedition 
-0001db90: 6964 2066 726f 6d20 696d 6167 652d 7072  id from image-pr
-0001dba0: 6f6a 6563 7420 2220 2b20 7374 7228 696d  oject " + str(im
-0001dbb0: 6167 655f 7072 6f6a 6563 7429 290a 2020  age_project)).  
-0001dbc0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001dbd0: 7475 726e 2022 220a 0a20 2020 2020 2020  turn ""..       
-0001dbe0: 2023 2074 7279 2070 6172 7365 2065 7665   # try parse eve
-0001dbf0: 6e74 2069 640a 2020 2020 2020 2020 6576  nt id.        ev
-0001dc00: 656e 745f 6e61 6d65 203d 2069 4644 4f2e  ent_name = iFDO.
-0001dc10: 6669 6e64 5f66 6965 6c64 5f73 7472 2869  find_field_str(i
-0001dc20: 6664 6f2c 2027 696d 6167 652d 6576 656e  fdo, 'image-even
-0001dc30: 743a 6e61 6d65 2729 0a20 2020 2020 2020  t:name').       
-0001dc40: 2069 6620 6576 656e 745f 6e61 6d65 203d   if event_name =
-0001dc50: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
-0001dc60: 2020 5f6c 6f67 2822 4572 726f 7221 2043    _log("Error! C
-0001dc70: 616e 2774 2063 6f6e 7374 7275 6374 2069  an't construct i
-0001dc80: 6d61 6765 2d65 7665 6e74 2075 7269 2c20  mage-event uri, 
-0001dc90: 696d 6167 652d 6576 656e 743a 6e61 6d65  image-event:name
-0001dca0: 206e 6f74 2066 696c 6c65 642e 2229 0a20   not filled."). 
-0001dcb0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001dcc0: 6e20 2222 0a0a 2020 2020 2020 2020 6f73  n ""..        os
-0001dcd0: 6973 5f75 726c 203d 2069 4644 4f2e 6765  is_url = iFDO.ge
-0001dce0: 745f 6f73 6973 5f65 7665 6e74 5f75 726c  t_osis_event_url
-0001dcf0: 2865 7870 6564 6974 696f 6e5f 6964 2c20  (expedition_id, 
-0001dd00: 6576 656e 745f 6e61 6d65 290a 0a20 2020  event_name)..   
-0001dd10: 2020 2020 2069 6620 6f73 6973 5f75 726c       if osis_url
-0001dd20: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
-0001dd30: 2020 2020 5f6c 6f67 2822 4572 726f 7221      _log("Error!
-0001dd40: 2043 616e 2774 2063 6f6e 7374 7275 6374   Can't construct
-0001dd50: 2069 6d61 6765 2d65 7665 6e74 2075 7269   image-event uri
-0001dd60: 2066 726f 6d20 6578 7065 6469 7469 6f6e   from expedition
-0001dd70: 5f69 6420 616e 6420 6576 656e 745f 6e61  _id and event_na
-0001dd80: 6d65 3a20 2220 2b20 7374 7228 6578 7065  me: " + str(expe
-0001dd90: 6469 7469 6f6e 5f69 6429 202b 2022 2c20  dition_id) + ", 
-0001dda0: 2220 2b20 6576 656e 745f 6e61 6d65 290a  " + event_name).
-0001ddb0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001ddc0: 726e 2022 220a 0a20 2020 2020 2020 2072  rn ""..        r
-0001ddd0: 6574 7572 6e20 6f73 6973 5f75 726c 0a0a  eturn osis_url..
-0001dde0: 0a20 2020 2064 6566 2073 6574 5f68 6561  .    def set_hea
-0001ddf0: 6465 725f 696d 6167 655f 6576 656e 745f  der_image_event_
-0001de00: 7572 695f 746f 5f6f 7369 735f 6576 656e  uri_to_osis_even
-0001de10: 745f 7572 6c28 7365 6c66 2c6f 7665 7272  t_url(self,overr
-0001de20: 6964 653a 626f 6f6c 203d 2046 616c 7365  ide:bool = False
-0001de30: 293a 0a20 2020 2020 2020 2022 2222 2053  ):.        """ S
-0001de40: 6574 7320 6865 6164 6572 2069 6d61 6765  ets header image
-0001de50: 2d65 7665 6e74 2075 7269 2074 6f20 6f73  -event uri to os
-0001de60: 6973 2065 7665 6e74 2075 726c 2070 6172  is event url par
-0001de70: 7365 6420 6672 6f6d 2069 6d61 6765 2d70  sed from image-p
-0001de80: 726f 6a65 6374 2061 6e64 2069 6d61 6765  roject and image
-0001de90: 2d65 7665 6e74 5b27 6e61 6d65 275d 206f  -event['name'] o
-0001dea0: 7220 0a20 2020 2020 2020 2069 6d61 6765  r .        image
-0001deb0: 2d65 7665 6e74 5b27 7572 6927 5d20 6966  -event['uri'] if
-0001dec0: 2069 7420 7265 6665 7273 2074 6f20 6f73   it refers to os
-0001ded0: 6973 2e0a 2020 2020 2020 2020 5061 7261  is..        Para
-0001dee0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-0001def0: 6f76 6572 7269 6465 3a20 6966 2046 616c  override: if Fal
-0001df00: 7365 2073 6574 206f 6e6c 7920 6966 2075  se set only if u
-0001df10: 7269 2069 7320 656d 7074 7920 6f72 2064  ri is empty or d
-0001df20: 6f65 7320 6e6f 7420 6578 6973 742e 2022  oes not exist. "
-0001df30: 2222 0a0a 2020 2020 2020 2020 6966 206e  ""..        if n
-0001df40: 6f74 206f 7665 7272 6964 6520 616e 6420  ot override and 
-0001df50: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-0001df60: 6432 2827 696d 6167 652d 6576 656e 743a  d2('image-event:
-0001df70: 7572 6927 2920 213d 2022 223a 0a20 2020  uri') != "":.   
-0001df80: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-0001df90: 6f76 2e6c 6f67 2822 4361 7574 696f 6e21  ov.log("Caution!
-0001dfa0: 2069 6d61 6765 2d65 7665 6e74 3a75 7269   image-event:uri
-0001dfb0: 2061 6c72 6561 6479 2065 7869 7374 7320   already exists 
-0001dfc0: 616e 6420 6973 206e 6f74 206f 7665 7272  and is not overr
-0001dfd0: 6964 6465 6e3a 2022 202b 2073 656c 662e  idden: " + self.
-0001dfe0: 6669 6e64 546d 7046 6965 6c64 3228 2769  findTmpField2('i
-0001dff0: 6d61 6765 2d65 7665 6e74 3a75 7269 2729  mage-event:uri')
-0001e000: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0001e010: 7475 726e 0a0a 2020 2020 2020 2020 6f73  turn..        os
-0001e020: 6973 5f75 726c 203d 2073 656c 662e 6765  is_url = self.ge
-0001e030: 745f 6865 6164 6572 5f69 6d61 6765 5f65  t_header_image_e
-0001e040: 7665 6e74 5f75 7269 5f74 6f5f 6f73 6973  vent_uri_to_osis
-0001e050: 5f65 7665 6e74 5f75 726c 2873 656c 662e  _event_url(self.
-0001e060: 6966 646f 5f74 6d70 2c73 656c 662e 7072  ifdo_tmp,self.pr
-0001e070: 6f76 290a 2020 2020 2020 2020 6966 206f  ov).        if o
-0001e080: 7369 735f 7572 6c20 3d3d 2022 223a 0a20  sis_url == "":. 
-0001e090: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001e0a0: 6e0a 2020 2020 2020 2020 7365 6c66 2e69  n.        self.i
-0001e0b0: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-0001e0c0: 6765 5365 7448 6561 6465 724b 6579 5d5b  geSetHeaderKey][
-0001e0d0: 2769 6d61 6765 2d65 7665 6e74 275d 5b27  'image-event']['
-0001e0e0: 7572 6927 5d20 3d20 6f73 6973 5f75 726c  uri'] = osis_url
-0001e0f0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0001e100: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
-0001e110: 7265 7175 6573 7473 2e68 6561 6428 6f73  requests.head(os
-0001e120: 6973 5f75 726c 290a 2020 2020 2020 2020  is_url).        
-0001e130: 2020 2020 6966 2072 6574 2e73 7461 7475      if ret.statu
-0001e140: 735f 636f 6465 2021 3d20 3230 303a 0a20  s_code != 200:. 
-0001e150: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001e160: 6169 7365 2045 7863 6570 7469 6f6e 2829  aise Exception()
-0001e170: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0001e180: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
-0001e190: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-0001e1a0: 2e6c 6f67 2822 4361 7574 696f 6e21 2069  .log("Caution! i
-0001e1b0: 6d61 6765 2d65 7665 6e74 3a75 7269 2073  mage-event:uri s
-0001e1c0: 6574 2062 7574 206e 6f74 2072 6561 6368  et but not reach
-0001e1d0: 6162 6c65 2022 202b 206f 7369 735f 7572  able " + osis_ur
-0001e1e0: 6c29 0a20 2020 2020 2020 2073 656c 662e  l).        self.
-0001e1f0: 7072 6f76 2e6c 6f67 2822 696d 6167 652d  prov.log("image-
-0001e200: 6576 656e 743a 7572 6920 7365 7420 746f  event:uri set to
-0001e210: 2022 202b 206f 7369 735f 7572 6c29 0a0a   " + osis_url)..
-0001e220: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
-0001e230: 6f64 0a20 2020 2064 6566 2067 6574 5f6f  od.    def get_o
-0001e240: 7369 735f 6576 656e 745f 7572 6c28 6578  sis_event_url(ex
-0001e250: 7065 6469 7469 6f6e 5f69 643a 696e 742c  pedition_id:int,
-0001e260: 2065 7665 6e74 5f6e 616d 653a 7374 7229   event_name:str)
-0001e270: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
-0001e280: 7475 726e 7320 6f73 6973 2065 7665 6e74  turns osis event
-0001e290: 2075 726c 2069 6620 6f73 6973 2065 7665   url if osis eve
-0001e2a0: 6e74 2069 6420 6361 6e20 6265 2073 7563  nt id can be suc
-0001e2b0: 6365 7373 6675 6c6c 7920 7265 7472 6965  cessfully retrie
-0001e2c0: 7665 6420 6672 6f6d 2065 7665 6e74 5f6e  ved from event_n
-0001e2d0: 616d 652e 0a20 2020 2020 2020 2052 6574  ame..        Ret
-0001e2e0: 7572 6e73 2022 2220 6966 206e 6f74 2073  urns "" if not s
-0001e2f0: 7563 6365 7373 7366 756c 2e20 2222 220a  uccesssful. """.
-0001e300: 2020 2020 2020 2020 6576 656e 745f 7572          event_ur
-0001e310: 6c20 3d20 2222 0a20 2020 2020 2020 2065  l = "".        e
-0001e320: 7665 6e74 5f69 6473 203d 206d 6971 746f  vent_ids = miqto
-0001e330: 7369 732e 6765 745f 6578 7065 6469 7469  sis.get_expediti
-0001e340: 6f6e 5f65 7665 6e74 5f69 6473 2865 7870  on_event_ids(exp
-0001e350: 6564 6974 696f 6e5f 6964 290a 0a20 2020  edition_id)..   
-0001e360: 2020 2020 2065 7665 6e74 5f6e 616d 655f       event_name_
-0001e370: 6f70 7469 6f6e 7320 3d20 5b65 7665 6e74  options = [event
-0001e380: 5f6e 616d 655d 0a20 2020 2020 2020 2065  _name].        e
-0001e390: 7665 6e74 5f6e 616d 655f 6f70 7469 6f6e  vent_name_option
-0001e3a0: 732e 6170 7065 6e64 2865 7665 6e74 5f6e  s.append(event_n
-0001e3b0: 616d 6529 0a20 2020 2020 2020 2023 2065  ame).        # e
-0001e3c0: 2e67 2e20 4d31 3832 5f30 3430 2d31 5f58  .g. M182_040-1_X
-0001e3d0: 4f46 4f53 0a20 2020 2020 2020 206e 616d  OFOS.        nam
-0001e3e0: 655f 7370 6c69 7420 3d20 6576 656e 745f  e_split = event_
-0001e3f0: 6e61 6d65 2e73 706c 6974 2827 5f27 290a  name.split('_').
-0001e400: 2020 2020 2020 2020 6966 206c 656e 286e          if len(n
-0001e410: 616d 655f 7370 6c69 7429 203e 3d20 323a  ame_split) >= 2:
-0001e420: 0a20 2020 2020 2020 2020 2020 2065 7665  .            eve
-0001e430: 6e74 5f6e 616d 655f 6f70 7469 6f6e 732e  nt_name_options.
-0001e440: 6170 7065 6e64 286e 616d 655f 7370 6c69  append(name_spli
-0001e450: 745b 315d 290a 2020 2020 2020 2020 2320  t[1]).        # 
-0001e460: 652e 672e 204d 534d 3936 5f30 3033 5f41  e.g. MSM96_003_A
-0001e470: 5556 2d30 310a 2020 2020 2020 2020 6966  UV-01.        if
-0001e480: 206c 656e 286e 616d 655f 7370 6c69 7429   len(name_split)
-0001e490: 203e 3d20 333a 0a20 2020 2020 2020 2020   >= 3:.         
-0001e4a0: 2020 2065 7874 5f73 706c 6974 203d 206e     ext_split = n
-0001e4b0: 616d 655f 7370 6c69 745b 325d 2e73 706c  ame_split[2].spl
-0001e4c0: 6974 2827 2d27 290a 2020 2020 2020 2020  it('-').        
-0001e4d0: 2020 2020 6966 206c 656e 2865 7874 5f73      if len(ext_s
-0001e4e0: 706c 6974 2920 3d3d 2032 3a0a 2020 2020  plit) == 2:.    
-0001e4f0: 2020 2020 2020 2020 2020 2020 6576 656e              even
-0001e500: 745f 6e61 6d65 5f6f 7074 696f 6e73 2e61  t_name_options.a
-0001e510: 7070 656e 6428 6e61 6d65 5f73 706c 6974  ppend(name_split
-0001e520: 5b31 5d20 2b20 272d 2720 2b20 6578 745f  [1] + '-' + ext_
-0001e530: 7370 6c69 745b 315d 290a 2020 2020 2020  split[1]).      
-0001e540: 2020 6576 656e 745f 6e61 6d65 5f6f 7074    event_name_opt
-0001e550: 696f 6e73 5f30 7374 7269 7020 3d20 5b5d  ions_0strip = []
-0001e560: 0a20 2020 2020 2020 2066 6f72 206e 616d  .        for nam
-0001e570: 6520 696e 2065 7665 6e74 5f6e 616d 655f  e in event_name_
-0001e580: 6f70 7469 6f6e 733a 0a20 2020 2020 2020  options:.       
-0001e590: 2020 2020 2064 6173 685f 7370 6c69 7420       dash_split 
-0001e5a0: 3d20 6e61 6d65 2e73 706c 6974 2827 2d27  = name.split('-'
-0001e5b0: 290a 2020 2020 2020 2020 2020 2020 6576  ).            ev
-0001e5c0: 656e 745f 6e61 6d65 5f6f 7074 696f 6e73  ent_name_options
-0001e5d0: 5f30 7374 7269 702e 6170 7065 6e64 2827  _0strip.append('
-0001e5e0: 2d27 2e6a 6f69 6e28 5b65 2e6c 7374 7269  -'.join([e.lstri
-0001e5f0: 7028 2730 2729 2066 6f72 2065 2069 6e20  p('0') for e in 
-0001e600: 6461 7368 5f73 706c 6974 5d29 290a 2020  dash_split])).  
-0001e610: 2020 2020 2020 6576 656e 745f 6e61 6d65        event_name
-0001e620: 5f6f 7074 696f 6e73 202b 3d20 6576 656e  _options += even
-0001e630: 745f 6e61 6d65 5f6f 7074 696f 6e73 5f30  t_name_options_0
-0001e640: 7374 7269 700a 2020 2020 2020 2020 666f  strip.        fo
-0001e650: 7220 6576 656e 745f 6e61 6d65 2069 6e20  r event_name in 
-0001e660: 6576 656e 745f 6e61 6d65 5f6f 7074 696f  event_name_optio
-0001e670: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-0001e680: 6966 2065 7665 6e74 5f6e 616d 6520 696e  if event_name in
-0001e690: 2065 7665 6e74 5f69 6473 3a0a 2020 2020   event_ids:.    
-0001e6a0: 2020 2020 2020 2020 2020 2020 6576 656e              even
-0001e6b0: 745f 7572 6c20 3d20 6d69 7174 6f73 6973  t_url = miqtosis
-0001e6c0: 2e67 6574 5f65 7665 6e74 5f75 726c 2865  .get_event_url(e
-0001e6d0: 7870 6564 6974 696f 6e5f 6964 2c65 7665  xpedition_id,eve
-0001e6e0: 6e74 5f69 6473 5b65 7665 6e74 5f6e 616d  nt_ids[event_nam
-0001e6f0: 655d 290a 2020 2020 2020 2020 2020 2020  e]).            
-0001e700: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-0001e710: 2020 0a20 2020 2020 2020 2072 6574 7572    .        retur
-0001e720: 6e20 6576 656e 745f 7572 6c0a 0a0a 2020  n event_url...  
-0001e730: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
-0001e740: 2020 2020 6465 6620 6765 745f 6c69 6365      def get_lice
-0001e750: 6e73 655f 7572 6928 6c69 6365 6e63 655f  nse_uri(licence_
-0001e760: 6e61 6d65 3a73 7472 293a 0a20 2020 2020  name:str):.     
-0001e770: 2020 2022 2222 2054 7269 6573 2074 6f20     """ Tries to 
-0001e780: 6775 6573 7320 6c69 6365 6e63 6520 7572  guess licence ur
-0001e790: 6c20 6672 6f6d 206c 6963 656e 7365 206e  l from license n
-0001e7a0: 616d 6520 616e 6420 7265 7475 726e 7320  ame and returns 
-0001e7b0: 6974 2e20 5265 7475 726e 7320 2222 2069  it. Returns "" i
-0001e7c0: 6620 6661 696c 732e 2022 2222 0a20 2020  f fails. """.   
-0001e7d0: 2020 2020 206c 6963 656e 7365 735f 6469       licenses_di
-0001e7e0: 6374 203d 207b 0a20 2020 2020 2020 2020  ct = {.         
-0001e7f0: 2020 2022 6363 6279 223a 2022 6874 7470     "ccby": "http
-0001e800: 733a 2f2f 6372 6561 7469 7665 636f 6d6d  s://creativecomm
-0001e810: 6f6e 732e 6f72 672f 6c69 6365 6e73 6573  ons.org/licenses
-0001e820: 2f62 792f 342e 302f 6c65 6761 6c63 6f64  /by/4.0/legalcod
-0001e830: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-0001e840: 2263 6330 223a 2022 6874 7470 733a 2f2f  "cc0": "https://
-0001e850: 6372 6561 7469 7665 636f 6d6d 6f6e 732e  creativecommons.
-0001e860: 6f72 672f 7075 626c 6963 646f 6d61 696e  org/publicdomain
-0001e870: 2f7a 6572 6f2f 312e 302f 6c65 6761 6c63  /zero/1.0/legalc
-0001e880: 6f64 6522 0a20 2020 2020 2020 207d 0a20  ode".        }. 
-0001e890: 2020 2020 2020 2063 6c65 616e 645f 6c69         cleand_li
-0001e8a0: 6365 6e73 6520 3d20 6c69 6365 6e63 655f  cense = licence_
-0001e8b0: 6e61 6d65 2e73 7472 6970 2829 2e6c 6f77  name.strip().low
-0001e8c0: 6572 2829 2e72 6570 6c61 6365 2827 2d27  er().replace('-'
-0001e8d0: 2c20 2727 290a 2020 2020 2020 2020 6966  , '').        if
-0001e8e0: 2063 6c65 616e 645f 6c69 6365 6e73 6520   cleand_license 
-0001e8f0: 696e 206c 6963 656e 7365 735f 6469 6374  in licenses_dict
-0001e900: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001e910: 7475 726e 206c 6963 656e 7365 735f 6469  turn licenses_di
-0001e920: 6374 5b63 6c65 616e 645f 6c69 6365 6e73  ct[cleand_licens
-0001e930: 655d 0a20 2020 2020 2020 2065 6c73 653a  e].        else:
-0001e940: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001e950: 7572 6e20 2222 0a0a 0a20 2020 2040 7374  urn ""...    @st
-0001e960: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-0001e970: 6566 2067 6574 5f6c 6963 656e 7365 5f75  ef get_license_u
-0001e980: 7269 5f74 6f5f 6c69 6365 6e73 6528 6966  ri_to_license(if
-0001e990: 646f 3a64 6963 7429 3a0a 2020 2020 2020  do:dict):.      
-0001e9a0: 2020 2222 2220 5265 7475 726e 7320 6865    """ Returns he
-0001e9b0: 6164 6572 2069 6d61 6765 2d6c 6963 656e  ader image-licen
-0001e9c0: 7365 2075 7269 2067 7565 7373 6564 2066  se uri guessed f
-0001e9d0: 726f 6d20 6c69 6365 6e73 6520 6e61 6d65  rom license name
-0001e9e0: 2e20 5265 7475 726e 7320 656d 7074 7920  . Returns empty 
-0001e9f0: 7374 7269 6e67 2069 6620 6661 696c 732e  string if fails.
-0001ea00: 2022 2222 0a20 2020 2020 2020 2069 6d61   """.        ima
-0001ea10: 6765 5f6c 6963 656e 7365 203d 2069 4644  ge_license = iFD
-0001ea20: 4f2e 6669 6e64 5f66 6965 6c64 5f73 7472  O.find_field_str
-0001ea30: 2869 6664 6f2c 2027 696d 6167 652d 6c69  (ifdo, 'image-li
-0001ea40: 6365 6e73 6527 290a 2020 2020 2020 2020  cense').        
-0001ea50: 6966 2069 7369 6e73 7461 6e63 6528 696d  if isinstance(im
-0001ea60: 6167 655f 6c69 6365 6e73 652c 2064 6963  age_license, dic
-0001ea70: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0001ea80: 7265 7475 726e 2069 4644 4f2e 6765 745f  return iFDO.get_
-0001ea90: 6c69 6365 6e73 655f 7572 6928 696d 6167  license_uri(imag
-0001eaa0: 655f 6c69 6365 6e73 655b 276e 616d 6527  e_license['name'
-0001eab0: 5d29 0a20 2020 2020 2020 2065 6c73 653a  ]).        else:
-0001eac0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001ead0: 7572 6e20 6946 444f 2e67 6574 5f6c 6963  urn iFDO.get_lic
-0001eae0: 656e 7365 5f75 7269 2869 6d61 6765 5f6c  ense_uri(image_l
-0001eaf0: 6963 656e 7365 290a 0a0a 2020 2020 6465  icense)...    de
-0001eb00: 6620 7365 745f 6c69 6365 6e73 655f 7572  f set_license_ur
-0001eb10: 695f 6672 6f6d 5f6c 6963 656e 7365 5f6e  i_from_license_n
-0001eb20: 616d 6528 7365 6c66 2c20 6f76 6572 7269  ame(self, overri
-0001eb30: 6465 3a62 6f6f 6c20 3d20 4661 6c73 6529  de:bool = False)
-0001eb40: 3a0a 2020 2020 2020 2020 2222 2220 5365  :.        """ Se
-0001eb50: 7473 2068 6561 6465 7220 696d 6167 652d  ts header image-
-0001eb60: 6c69 6365 6e73 6520 7572 6920 746f 2075  license uri to u
-0001eb70: 726c 2067 7565 7373 6564 2066 726f 6d20  rl guessed from 
-0001eb80: 696d 6167 652d 6c69 6365 6e73 652e 0a20  image-license.. 
-0001eb90: 2020 2020 2020 2050 6172 616d 733a 0a20         Params:. 
-0001eba0: 2020 2020 2020 2020 2020 206f 7665 7272             overr
-0001ebb0: 6964 653a 2069 6620 4661 6c73 6520 7365  ide: if False se
-0001ebc0: 7420 6f6e 6c79 2069 6620 7572 6920 6973  t only if uri is
-0001ebd0: 2065 6d70 7479 206f 7220 646f 6573 206e   empty or does n
-0001ebe0: 6f74 2065 7869 7374 2e20 2222 220a 2020  ot exist. """.  
-0001ebf0: 2020 2020 2020 0a20 2020 2020 2020 2069        .        i
-0001ec00: 6620 6e6f 7420 6f76 6572 7269 6465 2061  f not override a
-0001ec10: 6e64 2073 656c 662e 6669 6e64 546d 7046  nd self.findTmpF
-0001ec20: 6965 6c64 3228 2769 6d61 6765 2d6c 6963  ield2('image-lic
-0001ec30: 656e 7365 3a75 7269 2729 2021 3d20 2222  ense:uri') != ""
-0001ec40: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0001ec50: 6c66 2e70 726f 762e 6c6f 6728 2243 6175  lf.prov.log("Cau
-0001ec60: 7469 6f6e 2120 696d 6167 652d 6c69 6365  tion! image-lice
-0001ec70: 6e73 653a 7572 6920 616c 7265 6164 7920  nse:uri already 
-0001ec80: 6578 6973 7473 2061 6e64 2069 7320 6e6f  exists and is no
-0001ec90: 7420 6f76 6572 7269 6464 656e 3a20 2220  t overridden: " 
-0001eca0: 2b20 7365 6c66 2e66 696e 6454 6d70 4669  + self.findTmpFi
-0001ecb0: 656c 6432 2827 696d 6167 652d 6c69 6365  eld2('image-lice
-0001ecc0: 6e73 653a 7572 6927 2929 0a20 2020 2020  nse:uri')).     
-0001ecd0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-0001ece0: 2020 2020 2020 0a20 2020 2020 2020 206c        .        l
-0001ecf0: 6963 656e 7365 5f75 726c 203d 2073 656c  icense_url = sel
-0001ed00: 662e 6765 745f 6c69 6365 6e73 655f 7572  f.get_license_ur
-0001ed10: 695f 746f 5f6c 6963 656e 7365 2873 656c  i_to_license(sel
-0001ed20: 662e 6966 646f 5f74 6d70 290a 2020 2020  f.ifdo_tmp).    
-0001ed30: 2020 2020 6966 206c 6963 656e 7365 5f75      if license_u
-0001ed40: 726c 203d 3d20 2222 3a0a 2020 2020 2020  rl == "":.      
-0001ed50: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-0001ed60: 6c6f 6728 2257 6172 6e69 6e67 2120 4361  log("Warning! Ca
-0001ed70: 6e27 7420 6775 6573 7320 696d 6167 652d  n't guess image-
-0001ed80: 6c69 6365 6e73 653a 7572 6920 6672 6f6d  license:uri from
-0001ed90: 206e 616d 6522 290a 2020 2020 2020 2020   name").        
-0001eda0: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-0001edb0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0001edc0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0001edd0: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
-0001ede0: 6c69 6365 6e73 6527 5d5b 2775 7269 275d  license']['uri']
-0001edf0: 203d 206c 6963 656e 7365 5f75 726c 0a20   = license_url. 
-0001ee00: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0001ee10: 2020 2020 2020 2020 7265 7420 3d20 7265          ret = re
-0001ee20: 7175 6573 7473 2e68 6561 6428 6c69 6365  quests.head(lice
-0001ee30: 6e73 655f 7572 6c29 0a20 2020 2020 2020  nse_url).       
-0001ee40: 2020 2020 2069 6620 7265 742e 7374 6174       if ret.stat
-0001ee50: 7573 5f63 6f64 6520 213d 2032 3030 3a0a  us_code != 200:.
-0001ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee70: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-0001ee80: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-0001ee90: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
-0001eea0: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-0001eeb0: 762e 6c6f 6728 2243 6175 7469 6f6e 2120  v.log("Caution! 
-0001eec0: 696d 6167 652d 6c69 6365 6e73 653a 7572  image-license:ur
-0001eed0: 6920 7365 7420 6275 7420 6e6f 7420 7265  i set but not re
-0001eee0: 6163 6861 626c 6520 2220 2b20 6c69 6365  achable " + lice
-0001eef0: 6e73 655f 7572 6c29 0a20 2020 2020 2020  nse_url).       
-0001ef00: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-0001ef10: 696d 6167 652d 6c69 6365 6e73 653a 7572  image-license:ur
-0001ef20: 6920 7365 7420 746f 2022 202b 206c 6963  i set to " + lic
-0001ef30: 656e 7365 5f75 726c 290a 0a0a 2020 2020  ense_url)...    
-0001ef40: 6465 6620 696e 7465 726d 6564 6961 7465  def intermediate
-0001ef50: 4e61 7646 696c 6545 7869 7374 7328 7365  NavFileExists(se
-0001ef60: 6c66 293a 0a20 2020 2020 2020 2069 6620  lf):.        if 
-0001ef70: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
-0001ef80: 656c 662e 6765 745f 696e 745f 6e61 765f  elf.get_int_nav_
-0001ef90: 6669 6c65 2829 293a 0a20 2020 2020 2020  file()):.       
-0001efa0: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-0001efb0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0001efc0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001efd0: 6e20 4661 6c73 650a 0a0a 2020 2020 6465  n False...    de
-0001efe0: 6620 6865 6164 6572 4669 656c 6446 696c  f headerFieldFil
-0001eff0: 6c65 6428 7365 6c66 2c66 6965 6c64 3a73  led(self,field:s
-0001f000: 7472 293a 0a20 2020 2020 2020 2069 6620  tr):.        if 
-0001f010: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-0001f020: 6432 2866 6965 6c64 2920 3d3d 2022 223a  d2(field) == "":
-0001f030: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001f040: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-0001f050: 2020 7265 7475 726e 2054 7275 650a 0a20    return True.. 
-0001f060: 2020 2064 6566 2063 6f6e 7665 7274 546f     def convertTo
-0001f070: 4465 6661 756c 7444 6174 6554 696d 6546  DefaultDateTimeF
-0001f080: 6f72 6d61 7428 7365 6c66 2c69 6664 6f29  ormat(self,ifdo)
-0001f090: 3a0a 2020 2020 2020 2020 2222 2220 4368  :.        """ Ch
-0001f0a0: 6563 6b73 2069 6620 616c 6c20 6974 656d  ecks if all item
-0001f0b0: 7327 2027 696d 6167 652d 6461 7465 7469  s' 'image-dateti
-0001f0c0: 6d65 2720 6669 656c 6473 206d 6174 6368  me' fields match
-0001f0d0: 2064 6566 6175 6c74 2064 6174 6574 696d   default datetim
-0001f0e0: 6520 666f 726d 6174 206f 7220 6120 6375  e format or a cu
-0001f0f0: 7374 6f6d 206f 6e65 2064 6566 696e 6564  stom one defined
-0001f100: 2069 6e20 2769 6d61 6765 2d64 6174 6574   in 'image-datet
-0001f110: 696d 652d 666f 726d 6174 270a 2020 2020  ime-format'.    
-0001f120: 2020 2020 2020 2020 616e 6420 636f 6e76          and conv
-0001f130: 6572 7473 2074 6f20 6465 6661 756c 7420  erts to default 
-0001f140: 666f 726d 6174 2e20 5468 726f 7773 2065  format. Throws e
-0001f150: 7863 6570 7469 6f6e 2069 6620 6461 7465  xception if date
-0001f160: 7469 6d65 2063 616e 6e6f 7420 6265 2070  time cannot be p
-0001f170: 6172 7365 6420 2222 220a 2020 2020 2020  arsed """.      
-0001f180: 2020 6375 7374 6f6d 4461 7465 5469 6d65    customDateTime
-0001f190: 466f 726d 6174 466f 756e 6420 3d20 4661  FormatFound = Fa
-0001f1a0: 6c73 650a 2020 2020 2020 2020 6865 6164  lse.        head
-0001f1b0: 6572 4375 7374 6f6d 4461 7465 5469 6d65  erCustomDateTime
-0001f1c0: 466f 726d 6174 203d 2066 696e 6446 6965  Format = findFie
-0001f1d0: 6c64 2869 6664 6f5b 7365 6c66 2e69 6d61  ld(ifdo[self.ima
-0001f1e0: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
-0001f1f0: 2769 6d61 6765 2d64 6174 6574 696d 652d  'image-datetime-
-0001f200: 666f 726d 6174 2729 0a20 2020 2020 2020  format').       
-0001f210: 2069 6620 6865 6164 6572 4375 7374 6f6d   if headerCustom
-0001f220: 4461 7465 5469 6d65 466f 726d 6174 2021  DateTimeFormat !
-0001f230: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
-0001f240: 2020 6966 646f 5b73 656c 662e 696d 6167    ifdo[self.imag
-0001f250: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
-0001f260: 696d 6167 652d 6461 7465 7469 6d65 2d66  image-datetime-f
-0001f270: 6f72 6d61 7427 5d20 3d20 2222 2023 2072  ormat'] = "" # r
-0001f280: 656d 6f76 6520 6375 7374 6f6d 2066 6f72  emove custom for
-0001f290: 6d61 740a 2020 2020 2020 2020 2020 2020  mat.            
-0001f2a0: 6375 7374 6f6d 4461 7465 5469 6d65 466f  customDateTimeFo
-0001f2b0: 726d 6174 466f 756e 6420 3d20 5472 7565  rmatFound = True
-0001f2c0: 0a20 2020 2020 2020 2070 726f 6720 3d20  .        prog = 
-0001f2d0: 6d69 7174 632e 5072 696e 744b 6e6f 776e  miqtc.PrintKnown
-0001f2e0: 5072 6f67 7265 7373 4d73 6728 2243 6865  ProgressMsg("Che
-0001f2f0: 636b 696e 6720 6461 7465 7469 6d65 2066  cking datetime f
-0001f300: 6f72 6d61 7422 2c20 6c65 6e28 6966 646f  ormat", len(ifdo
-0001f310: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
-0001f320: 656d 734b 6579 5d29 2c6d 6f64 756c 6f3d  emsKey]),modulo=
-0001f330: 3130 290a 2020 2020 2020 2020 666f 7220  10).        for 
-0001f340: 6669 6c65 2c69 7465 6d20 696e 2069 6664  file,item in ifd
-0001f350: 6f5b 7365 6c66 2e69 6d61 6765 5365 7449  o[self.imageSetI
-0001f360: 7465 6d73 4b65 795d 2e69 7465 6d73 2829  temsKey].items()
-0001f370: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-0001f380: 6f67 2e70 726f 6772 6573 7328 290a 2020  og.progress().  
-0001f390: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0001f3a0: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
-0001f3b0: 2c6c 6973 7429 3a0a 2020 2020 2020 2020  ,list):.        
-0001f3c0: 2020 2020 2020 2020 2020 2020 6974 656d              item
-0001f3d0: 203d 205b 6974 656d 5d0a 2020 2020 2020   = [item].      
-0001f3e0: 2020 2020 2020 7375 6249 7465 6d44 6566        subItemDef
-0001f3f0: 6175 6c74 203d 2069 7465 6d5b 305d 0a20  ault = item[0]. 
-0001f400: 2020 2020 2020 2020 2020 2069 7465 6d43             itemC
-0001f410: 7573 746f 6d44 6174 6554 696d 6546 6f72  ustomDateTimeFor
-0001f420: 6d61 7420 3d20 2222 0a20 2020 2020 2020  mat = "".       
-0001f430: 2020 2020 2069 6620 2769 6d61 6765 2d64       if 'image-d
-0001f440: 6174 6574 696d 652d 666f 726d 6174 2720  atetime-format' 
-0001f450: 696e 2073 7562 4974 656d 4465 6661 756c  in subItemDefaul
-0001f460: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-0001f470: 2020 2069 7465 6d43 7573 746f 6d44 6174     itemCustomDat
-0001f480: 6554 696d 6546 6f72 6d61 7420 3d20 7375  eTimeFormat = su
-0001f490: 6249 7465 6d44 6566 6175 6c74 5b27 696d  bItemDefault['im
-0001f4a0: 6167 652d 6461 7465 7469 6d65 2d66 6f72  age-datetime-for
-0001f4b0: 6d61 7427 5d0a 2020 2020 2020 2020 2020  mat'].          
-0001f4c0: 2020 2020 2020 7375 6249 7465 6d44 6566        subItemDef
-0001f4d0: 6175 6c74 5b27 696d 6167 652d 6461 7465  ault['image-date
-0001f4e0: 7469 6d65 2d66 6f72 6d61 7427 5d20 3d20  time-format'] = 
-0001f4f0: 2222 2023 2072 656d 6f76 6520 6375 7374  "" # remove cust
-0001f500: 6f6d 2066 6f72 6d61 740a 2020 2020 2020  om format.      
-0001f510: 2020 2020 2020 2020 2020 6375 7374 6f6d            custom
-0001f520: 4461 7465 5469 6d65 466f 726d 6174 466f  DateTimeFormatFo
-0001f530: 756e 6420 3d20 5472 7565 0a20 2020 2020  und = True.     
-0001f540: 2020 2020 2020 2066 6f72 2073 7562 4974         for subIt
-0001f550: 656d 2069 6e20 6974 656d 3a0a 2020 2020  em in item:.    
-0001f560: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-0001f570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f580: 2020 2020 2066 6f72 6d61 7420 3d20 6d69       format = mi
-0001f590: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
-0001f5a0: 5b27 6d61 7269 7174 275d 0a20 2020 2020  ['mariqt'].     
-0001f5b0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001f5c0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
-0001f5d0: 2e73 7472 7074 696d 6528 7375 6249 7465  .strptime(subIte
-0001f5e0: 6d5b 2769 6d61 6765 2d64 6174 6574 696d  m['image-datetim
-0001f5f0: 6527 5d2c 666f 726d 6174 290a 2020 2020  e'],format).    
-0001f600: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0001f610: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
-0001f620: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0001f630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f640: 2020 2020 2066 6f72 6d61 7420 3d20 6865       format = he
-0001f650: 6164 6572 4375 7374 6f6d 4461 7465 5469  aderCustomDateTi
-0001f660: 6d65 466f 726d 6174 0a20 2020 2020 2020  meFormat.       
-0001f670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f680: 2064 7420 3d20 6461 7465 7469 6d65 2e64   dt = datetime.d
-0001f690: 6174 6574 696d 652e 7374 7270 7469 6d65  atetime.strptime
-0001f6a0: 2873 7562 4974 656d 5b27 696d 6167 652d  (subItem['image-
-0001f6b0: 6461 7465 7469 6d65 275d 2c66 6f72 6d61  datetime'],forma
-0001f6c0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-0001f6d0: 2020 2020 2020 2020 2020 2073 7562 4974             subIt
-0001f6e0: 656d 5b27 696d 6167 652d 6461 7465 7469  em['image-dateti
-0001f6f0: 6d65 275d 203d 2064 6174 6574 696d 652e  me'] = datetime.
-0001f700: 6461 7465 7469 6d65 2e73 7472 6674 696d  datetime.strftim
-0001f710: 6528 6474 2c6d 6971 7476 2e64 6174 655f  e(dt,miqtv.date_
-0001f720: 666f 726d 6174 735b 276d 6172 6971 7427  formats['mariqt'
-0001f730: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0001f740: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
-0001f750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f760: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0001f770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f780: 2020 2020 2020 2020 666f 726d 6174 203d          format =
-0001f790: 2069 7465 6d43 7573 746f 6d44 6174 6554   itemCustomDateT
-0001f7a0: 696d 6546 6f72 6d61 740a 2020 2020 2020  imeFormat.      
-0001f7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f7c0: 2020 2020 2020 6474 203d 2064 6174 6574        dt = datet
-0001f7d0: 696d 652e 6461 7465 7469 6d65 2e73 7472  ime.datetime.str
-0001f7e0: 7074 696d 6528 7375 6249 7465 6d5b 2769  ptime(subItem['i
-0001f7f0: 6d61 6765 2d64 6174 6574 696d 6527 5d2c  mage-datetime'],
-0001f800: 666f 726d 6174 290a 2020 2020 2020 2020  format).        
-0001f810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f820: 2020 2020 7375 6249 7465 6d5b 2769 6d61      subItem['ima
-0001f830: 6765 2d64 6174 6574 696d 6527 5d20 3d20  ge-datetime'] = 
-0001f840: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
-0001f850: 652e 7374 7266 7469 6d65 2864 742c 6d69  e.strftime(dt,mi
-0001f860: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
-0001f870: 5b27 6d61 7269 7174 275d 290a 2020 2020  ['mariqt']).    
-0001f880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f890: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
-0001f8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f8b0: 2020 2020 2020 2020 7072 6f67 2e63 6c65          prog.cle
-0001f8c0: 6172 2829 0a20 2020 2020 2020 2020 2020  ar().           
-0001f8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f8e0: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
-0001f8f0: 6f45 7863 6570 7469 6f6e 2827 496e 7661  oException('Inva
-0001f900: 6c69 6420 6461 7465 7469 6d65 2076 616c  lid datetime val
-0001f910: 7565 272c 7375 6249 7465 6d5b 2769 6d61  ue',subItem['ima
-0001f920: 6765 2d64 6174 6574 696d 6527 5d2c 2022  ge-datetime'], "
-0001f930: 646f 6573 206e 6f74 206d 6174 6368 2066  does not match f
-0001f940: 6f72 6d61 7420 6465 6661 756c 7420 6f72  ormat default or
-0001f950: 2063 7573 746f 6d20 666f 726d 6174 2229   custom format")
-0001f960: 0a20 2020 2020 2020 2069 6620 6375 7374  .        if cust
-0001f970: 6f6d 4461 7465 5469 6d65 466f 726d 6174  omDateTimeFormat
-0001f980: 466f 756e 643a 0a20 2020 2020 2020 2020  Found:.         
-0001f990: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-0001f9a0: 2822 4375 7374 6f6d 2064 6174 6574 696d  ("Custom datetim
-0001f9b0: 6520 666f 726d 6174 7320 666f 756e 642e  e formats found.
-0001f9c0: 2054 6865 7920 7769 6c6c 2062 6520 7265   They will be re
-0001f9d0: 706c 6163 6564 2062 7920 7468 6520 6465  placed by the de
-0001f9e0: 6661 756c 7420 666f 726d 6174 2e22 2920  fault format.") 
-0001f9f0: 2020 0a20 2020 2020 2020 2070 726f 672e    .        prog.
-0001fa00: 636c 6561 7228 2920 2020 200a 0a0a 2020  clear()    ...  
-0001fa10: 2020 6465 6620 5f5f 696e 6974 496e 7465    def __initInte
-0001fa20: 726d 6564 6961 7465 4669 6c65 7328 7365  rmediateFiles(se
-0001fa30: 6c66 293a 0a20 2020 2020 2020 2073 656c  lf):.        sel
-0001fa40: 662e 696e 7465 726d 6564 6961 7465 4669  f.intermediateFi
-0001fa50: 6c65 7344 6566 5f63 6f72 6520 3d20 7b0a  lesDef_core = {.
-0001fa60: 2020 2020 2020 2020 2020 2020 2768 6173              'has
-0001fa70: 6865 7327 3a20 7b0a 2020 2020 2020 2020  hes': {.        
-0001fa80: 2020 2020 2020 2020 2763 7265 6174 696f          'creatio
-0001fa90: 6e46 6374 273a 2027 6372 6561 7465 5f69  nFct': 'create_i
-0001faa0: 6d61 6765 5f73 6861 3235 365f 6669 6c65  mage_sha256_file
-0001fab0: 2829 272c 0a20 2020 2020 2020 2020 2020  ()',.           
-0001fac0: 2020 2020 2027 7375 6666 6978 273a 2027       'suffix': '
-0001fad0: 5f69 6d61 6765 2d68 6173 6865 732e 7478  _image-hashes.tx
-0001fae0: 7427 2c0a 2020 2020 2020 2020 2020 2020  t',.            
-0001faf0: 2020 2020 2763 6f6c 7327 3a20 5b6d 6971      'cols': [miq
-0001fb00: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-0001fb10: 6172 6971 7427 5d5b 2768 6173 6827 5d5d  ariqt']['hash']]
-0001fb20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001fb30: 2020 276f 7074 696f 6e61 6c27 3a20 5b5d    'optional': []
-0001fb40: 7d2c 0a20 2020 2020 2020 2020 2020 2027  },.            '
-0001fb50: 7575 6964 7327 3a20 7b0a 2020 2020 2020  uuids': {.      
-0001fb60: 2020 2020 2020 2020 2020 2763 7265 6174            'creat
-0001fb70: 696f 6e46 6374 273a 2027 6372 6561 7465  ionFct': 'create
-0001fb80: 5f75 7569 645f 6669 6c65 2829 272c 0a20  _uuid_file()',. 
-0001fb90: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001fba0: 7375 6666 6978 273a 2027 5f69 6d61 6765  suffix': '_image
-0001fbb0: 2d75 7569 6473 2e74 7874 272c 0a20 2020  -uuids.txt',.   
-0001fbc0: 2020 2020 2020 2020 2020 2020 2027 636f               'co
-0001fbd0: 6c73 273a 205b 6d69 7174 762e 636f 6c5f  ls': [miqtv.col_
-0001fbe0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-0001fbf0: 5b27 7575 6964 275d 5d2c 0a20 2020 2020  ['uuid']],.     
-0001fc00: 2020 2020 2020 2020 2020 2027 6f70 7469             'opti
-0001fc10: 6f6e 616c 273a 205b 5d7d 2c0a 2020 2020  onal': []},.    
-0001fc20: 2020 2020 2020 2020 2764 6174 6574 696d          'datetim
-0001fc30: 6527 3a20 7b0a 2020 2020 2020 2020 2020  e': {.          
-0001fc40: 2020 2020 2020 2763 7265 6174 696f 6e46        'creationF
-0001fc50: 6374 273a 2027 6372 6561 7465 5f73 7461  ct': 'create_sta
-0001fc60: 7274 5f74 696d 655f 6669 6c65 2829 272c  rt_time_file()',
-0001fc70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fc80: 2027 7375 6666 6978 273a 2027 5f69 6d61   'suffix': '_ima
-0001fc90: 6765 2d73 7461 7274 2d74 696d 6573 2e74  ge-start-times.t
-0001fca0: 7874 272c 0a20 2020 2020 2020 2020 2020  xt',.           
-0001fcb0: 2020 2020 2027 636f 6c73 273a 205b 6d69       'cols': [mi
-0001fcc0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-0001fcd0: 6d61 7269 7174 275d 5b27 7574 6327 5d5d  mariqt']['utc']]
-0001fce0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001fcf0: 2020 276f 7074 696f 6e61 6c27 3a20 5b5d    'optional': []
-0001fd00: 7d2c 0a20 2020 2020 2020 2020 2020 2027  },.            '
-0001fd10: 6e61 7669 6761 7469 6f6e 273a 207b 0a20  navigation': {. 
-0001fd20: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001fd30: 6372 6561 7469 6f6e 4663 7427 3a20 2763  creationFct': 'c
-0001fd40: 7265 6174 655f 696d 6167 655f 6e61 7669  reate_image_navi
-0001fd50: 6761 7469 6f6e 5f66 696c 6528 2927 2c0a  gation_file()',.
-0001fd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fd70: 2773 7566 6669 7827 3a20 275f 696d 6167  'suffix': '_imag
-0001fd80: 652d 6e61 7669 6761 7469 6f6e 2e74 7874  e-navigation.txt
-0001fd90: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0001fda0: 2020 2027 636f 6c73 273a 205b 6d69 7174     'cols': [miqt
-0001fdb0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-0001fdc0: 7269 7174 275d 5b27 7574 6327 5d5d 2c0a  riqt']['utc']],.
-0001fdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fde0: 276f 7074 696f 6e61 6c27 3a20 5b6d 6971  'optional': [miq
-0001fdf0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-0001fe00: 6172 6971 7427 5d5b 276c 6f6e 275d 2c20  ariqt']['lon'], 
-0001fe10: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-0001fe20: 5b27 6d61 7269 7174 275d 5b27 6c61 7427  ['mariqt']['lat'
-0001fe30: 5d2c 206d 6971 7476 2e63 6f6c 5f68 6561  ], miqtv.col_hea
-0001fe40: 6465 725b 276d 6172 6971 7427 5d5b 2761  der['mariqt']['a
-0001fe50: 6c74 275d 2c20 6d69 7174 762e 636f 6c5f  lt'], miqtv.col_
-0001fe60: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-0001fe70: 5b27 6867 7427 5d2c 206d 6971 7476 2e63  ['hgt'], miqtv.c
-0001fe80: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-0001fe90: 7427 5d5b 2775 6e63 6572 7427 5d5d 7d2c  t']['uncert']]},
-0001fea0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
-0001feb0: 2020 2020 7365 6c66 2e6e 6f6e 436f 7265      self.nonCore
-0001fec0: 4669 656c 6449 6e74 6572 6d65 6469 6174  FieldIntermediat
-0001fed0: 6549 7465 6d49 6e66 6f46 696c 6573 203d  eItemInfoFiles =
-0001fee0: 205b 5d0a 0a20 2020 2064 6566 205f 5f67   []..    def __g
-0001fef0: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
-0001ff00: 6978 2873 656c 6629 3a0a 2020 2020 2020  ix(self):.      
-0001ff10: 2020 2222 2220 6465 7065 6e64 7320 6f6e    """ depends on
-0001ff20: 2027 696d 6167 652d 6576 656e 7427 2061   'image-event' a
-0001ff30: 6e64 2027 696d 6167 652d 7365 6e73 6f72  nd 'image-sensor
-0001ff40: 2720 736f 2069 7420 6361 6e20 6368 616e  ' so it can chan
-0001ff50: 6765 2064 7572 696e 6720 7570 6174 6520  ge during upate 
-0001ff60: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0001ff70: 726e 206f 732e 7061 7468 2e6a 6f69 6e28  rn os.path.join(
-0001ff80: 7365 6c66 2e64 6972 2e74 6f28 7365 6c66  self.dir.to(self
-0001ff90: 2e64 6972 2e64 742e 696e 7465 726d 6564  .dir.dt.intermed
-0001ffa0: 6961 7465 292c 2073 656c 662e 6669 6e64  iate), self.find
-0001ffb0: 546d 7046 6965 6c64 2827 696d 6167 652d  TmpField('image-
-0001ffc0: 7365 742d 6e61 6d65 2729 290a 0a20 2020  set-name'))..   
-0001ffd0: 2064 6566 2067 6574 5f69 6e74 5f68 6173   def get_int_has
-0001ffe0: 685f 6669 6c65 2873 656c 6629 3a0a 2020  h_file(self):.  
-0001fff0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00020000: 662e 5f5f 6765 745f 696e 745f 6669 6c65  f.__get_int_file
-00020010: 5f70 7265 6669 7828 2920 2b20 7365 6c66  _prefix() + self
-00020020: 2e69 6e74 6572 6d65 6469 6174 6546 696c  .intermediateFil
-00020030: 6573 4465 665f 636f 7265 5b27 6861 7368  esDef_core['hash
-00020040: 6573 275d 5b27 7375 6666 6978 275d 0a0a  es']['suffix']..
-00020050: 2020 2020 6465 6620 6765 745f 696e 745f      def get_int_
-00020060: 7575 6964 5f66 696c 6528 7365 6c66 293a  uuid_file(self):
-00020070: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00020080: 7365 6c66 2e5f 5f67 6574 5f69 6e74 5f66  self.__get_int_f
-00020090: 696c 655f 7072 6566 6978 2829 202b 2073  ile_prefix() + s
-000200a0: 656c 662e 696e 7465 726d 6564 6961 7465  elf.intermediate
-000200b0: 4669 6c65 7344 6566 5f63 6f72 655b 2775  FilesDef_core['u
-000200c0: 7569 6473 275d 5b27 7375 6666 6978 275d  uids']['suffix']
-000200d0: 0a0a 2020 2020 6465 6620 6765 745f 696e  ..    def get_in
-000200e0: 745f 7374 6172 7454 696d 6573 5f66 696c  t_startTimes_fil
-000200f0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-00020100: 2072 6574 7572 6e20 7365 6c66 2e5f 5f67   return self.__g
-00020110: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
-00020120: 6978 2829 202b 2073 656c 662e 696e 7465  ix() + self.inte
-00020130: 726d 6564 6961 7465 4669 6c65 7344 6566  rmediateFilesDef
-00020140: 5f63 6f72 655b 2764 6174 6574 696d 6527  _core['datetime'
-00020150: 5d5b 2773 7566 6669 7827 5d0a 0a20 2020  ]['suffix']..   
-00020160: 2064 6566 2067 6574 5f69 6e74 5f6e 6176   def get_int_nav
-00020170: 5f66 696c 6528 7365 6c66 293a 0a20 2020  _file(self):.   
-00020180: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00020190: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
-000201a0: 7072 6566 6978 2829 202b 2073 656c 662e  prefix() + self.
-000201b0: 696e 7465 726d 6564 6961 7465 4669 6c65  intermediateFile
-000201c0: 7344 6566 5f63 6f72 655b 276e 6176 6967  sDef_core['navig
-000201d0: 6174 696f 6e27 5d5b 2773 7566 6669 7827  ation']['suffix'
-000201e0: 5d0a 0a                                  ]..
+00019520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019530: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
+00019540: 2020 2020 2020 2020 6966 2054 7275 6520          if True 
+00019550: 696e 205b 6d61 7468 2e69 736e 616e 2878  in [math.isnan(x
+00019560: 2920 666f 7220 7820 696e 205b 6974 656d  ) for x in [item
+00019570: 2066 6f72 2073 7562 6c69 7374 2069 6e20   for sublist in 
+00019580: 6765 6f6d 6574 7279 5b27 636f 6f72 6469  geometry['coordi
+00019590: 6e61 7465 7327 5d20 666f 7220 6974 656d  nates'] for item
+000195a0: 2069 6e20 7375 626c 6973 745d 5d3a 0a20   in sublist]]:. 
+000195b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195c0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+000195d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000195e0: 2067 656f 6a73 6f6e 5b27 6665 6174 7572   geojson['featur
+000195f0: 6573 275d 2e61 7070 656e 6428 7b27 7479  es'].append({'ty
+00019600: 7065 273a 2027 4665 6174 7572 6527 2c20  pe': 'Feature', 
+00019610: 2770 726f 7065 7274 6965 7327 3a20 7b27  'properties': {'
+00019620: 6964 273a 2066 696c 657d 2c20 2767 656f  id': file}, 'geo
+00019630: 6d65 7472 7927 3a20 6765 6f6d 6574 7279  metry': geometry
+00019640: 207d 290a 2020 2020 2020 2020 2020 2020   }).            
+00019650: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00019660: 206f 203d 206f 7065 6e28 7365 6c66 2e67   o = open(self.g
+00019670: 6574 5f69 6e74 5f6e 6176 5f66 696c 6528  et_int_nav_file(
+00019680: 292e 7265 706c 6163 6528 222e 7478 7422  ).replace(".txt"
+00019690: 2c20 222e 6765 6f6a 736f 6e22 292c 0a20  , ".geojson"),. 
+000196a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196b0: 2020 2020 2277 222c 2065 7272 6f72 733d      "w", errors=
+000196c0: 2269 676e 6f72 6522 2c20 656e 636f 6469  "ignore", encodi
+000196d0: 6e67 3d27 7574 662d 3827 290a 2020 2020  ng='utf-8').    
+000196e0: 2020 2020 2020 2020 6a73 6f6e 2e64 756d          json.dum
+000196f0: 7028 6765 6f6a 736f 6e2c 206f 2c20 656e  p(geojson, o, en
+00019700: 7375 7265 5f61 7363 6969 3d46 616c 7365  sure_ascii=False
+00019710: 2c20 696e 6465 6e74 3d34 290a 2020 2020  , indent=4).    
+00019720: 2020 2020 2020 2020 6f2e 636c 6f73 6528          o.close(
+00019730: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00019740: 656c 662e 7072 6f76 2e61 6464 4172 6775  elf.prov.addArgu
+00019750: 6d65 6e74 2822 696e 7075 744e 6176 6967  ment("inputNavig
+00019760: 6174 696f 6e46 696c 6522 2c6e 6176 5f70  ationFile",nav_p
+00019770: 6174 682c 6f76 6572 7772 6974 653d 5472  ath,overwrite=Tr
+00019780: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00019790: 7365 6c66 2e70 726f 762e 6c6f 6728 2270  self.prov.log("p
+000197a0: 6172 7365 6420 6672 6f6d 2069 6e70 7574  arsed from input
+000197b0: 4e61 7669 6761 7469 6f6e 4669 6c65 3a20  NavigationFile: 
+000197c0: 2220 2b20 7374 7228 6e61 765f 6865 6164  " + str(nav_head
+000197d0: 6572 292c 646f 6e74 5368 6f77 3d54 7275  er),dontShow=Tru
+000197e0: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
+000197f0: 2e73 746f 7028 290a 2020 2020 2020 2020  .stop().        
+00019800: 2020 2020 7265 7475 726e 2054 7275 652c      return True,
+00019810: 2022 4e61 7669 6761 7469 6f6e 2064 6174   "Navigation dat
+00019820: 6120 6372 6561 7465 6422 202b 2072 6574  a created" + ret
+00019830: 7572 6e4d 7367 0a20 2020 2020 2020 2065  urnMsg.        e
+00019840: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00019850: 2073 2e73 746f 7028 290a 2020 2020 2020   s.stop().      
+00019860: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00019870: 7365 2c20 224e 6f20 696d 6167 6520 636f  se, "No image co
+00019880: 6f72 6469 6e61 7465 7320 666f 756e 6422  ordinates found"
+00019890: 202b 2072 6574 7572 6e4d 7367 0a0a 2020   + returnMsg..  
+000198a0: 2020 6465 6620 6372 6561 7465 496d 6167    def createImag
+000198b0: 654e 6176 6967 6174 696f 6e46 696c 6528  eNavigationFile(
+000198c0: 7365 6c66 2c20 6e61 765f 7061 7468 3a20  self, nav_path: 
+000198d0: 7374 722c 206e 6176 5f68 6561 6465 723d  str, nav_header=
+000198e0: 6d69 7174 762e 706f 735f 6865 6164 6572  miqtv.pos_header
+000198f0: 5b27 7061 6e67 6165 6127 5d2c 2064 6174  ['pangaea'], dat
+00019900: 655f 666f 726d 6174 3d6d 6971 7476 2e64  e_format=miqtv.d
+00019910: 6174 655f 666f 726d 6174 735b 2770 616e  ate_formats['pan
+00019920: 6761 6561 275d 2c20 6f76 6572 7772 6974  gaea'], overwrit
+00019930: 653d 4661 6c73 652c 2063 6f6c 5f73 6570  e=False, col_sep
+00019940: 6172 6174 6f72 203d 2022 5c74 222c 2076  arator = "\t", v
+00019950: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
+00019960: 733d 312c 0a20 2020 2020 2020 2020 2020  s=1,.           
+00019970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019980: 2020 2020 2020 2020 206f 6666 7365 745f           offset_
+00019990: 783d 302c 206f 6666 7365 745f 793d 302c  x=0, offset_y=0,
+000199a0: 206f 6666 7365 745f 7a3d 302c 616e 676c   offset_z=0,angl
+000199b0: 6573 5f69 6e5f 7261 6420 3d20 4661 6c73  es_in_rad = Fals
+000199c0: 652c 2072 6563 6f72 6473 3262 6549 6e76  e, records2beInv
+000199d0: 6572 7465 643d 5b5d 293a 0a20 2020 2020  erted=[]):.     
+000199e0: 2020 2022 2222 2044 6570 7265 6361 7465     """ Deprecate
+000199f0: 6420 2d20 7573 6520 6372 6561 7465 5f69  d - use create_i
+00019a00: 6d61 6765 5f6e 6176 6967 6174 696f 6e5f  mage_navigation_
+00019a10: 6669 6c65 2022 2222 0a20 2020 2020 2020  file """.       
+00019a20: 2072 6574 7572 6e20 7365 6c66 2e63 7265   return self.cre
+00019a30: 6174 655f 696d 6167 655f 6e61 7669 6761  ate_image_naviga
+00019a40: 7469 6f6e 5f66 696c 6528 6e61 765f 7061  tion_file(nav_pa
+00019a50: 7468 2c20 6e61 765f 6865 6164 6572 2c20  th, nav_header, 
+00019a60: 6461 7465 5f66 6f72 6d61 742c 206f 7665  date_format, ove
+00019a70: 7277 7269 7465 2c20 636f 6c5f 7365 7061  rwrite, col_sepa
+00019a80: 7261 746f 722c 2076 6964 656f 5361 6d70  rator, videoSamp
+00019a90: 6c65 5365 636f 6e64 732c 206f 6666 7365  leSeconds, offse
+00019aa0: 745f 782c 206f 6666 7365 745f 792c 206f  t_x, offset_y, o
+00019ab0: 6666 7365 745f 7a2c 2061 6e67 6c65 735f  ffset_z, angles_
+00019ac0: 696e 5f72 6164 2c20 7265 636f 7264 7332  in_rad, records2
+00019ad0: 6265 496e 7665 7274 6564 290a 0a0a 2020  beInverted)...  
+00019ae0: 2020 6465 6620 6372 6561 7465 5f69 6d61    def create_ima
+00019af0: 6765 5f73 6861 3235 365f 6669 6c65 2873  ge_sha256_file(s
+00019b00: 656c 662c 7265 5265 6164 416c 6c3d 5472  elf,reReadAll=Tr
+00019b10: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
+00019b20: 2043 7265 6174 6573 2069 6e20 2f69 6e74   Creates in /int
+00019b30: 6572 6d65 6469 6174 6520 6120 7465 7874  ermediate a text
+00019b40: 2066 696c 6520 636f 6e74 6169 6e69 6e67   file containing
+00019b50: 2070 6572 2069 6d61 6765 2069 7473 2053   per image its S
+00019b60: 4841 3235 3620 6861 7368 2e0a 2020 2020  HA256 hash..    
+00019b70: 2020 2020 2020 2020 4966 2072 6552 6561          If reRea
+00019b80: 6441 6c6c 2069 7320 5472 7565 2061 6c6c  dAll is True all
+00019b90: 2069 6d61 6765 7327 2068 6173 6865 7320   images' hashes 
+00019ba0: 6172 6520 6465 7465 726d 696e 6564 2e20  are determined. 
+00019bb0: 4f74 6865 7277 6973 6520 6f6e 6c79 2066  Otherwise only f
+00019bc0: 6f72 2074 686f 7365 2066 696c 6573 0a20  or those files. 
+00019bd0: 2020 2020 2020 2020 2020 2077 6869 6368             which
+00019be0: 2061 7265 206e 6f74 2079 6574 2069 6e20   are not yet in 
+00019bf0: 7468 6520 696e 7465 726d 6564 6961 7465  the intermediate
+00019c00: 2066 696c 6520 636f 6e74 6169 6e69 6e67   file containing
+00019c10: 2074 6865 2069 6d61 6765 2068 6173 6865   the image hashe
+00019c20: 7320 2022 2222 0a20 2020 2020 2020 2068  s  """.        h
+00019c30: 6173 6865 7320 3d20 7b7d 0a20 2020 2020  ashes = {}.     
+00019c40: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
+00019c50: 6973 7473 2873 656c 662e 6765 745f 696e  ists(self.get_in
+00019c60: 745f 6861 7368 5f66 696c 6528 2929 3a0a  t_hash_file()):.
+00019c70: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+00019c80: 6573 203d 206d 6971 7466 2e74 6162 4669  es = miqtf.tabFi
+00019c90: 6c65 4461 7461 2873 656c 662e 6765 745f  leData(self.get_
+00019ca0: 696e 745f 6861 7368 5f66 696c 6528 292c  int_hash_file(),
+00019cb0: 205b 6d69 7174 762e 636f 6c5f 6865 6164   [miqtv.col_head
+00019cc0: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
+00019cd0: 6727 5d2c 206d 6971 7476 2e63 6f6c 5f68  g'], miqtv.col_h
+00019ce0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00019cf0: 2768 6173 6827 5d5d 2c20 6b65 795f 636f  'hash']], key_co
+00019d00: 6c3d 6d69 7174 762e 636f 6c5f 6865 6164  l=miqtv.col_head
+00019d10: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
+00019d20: 6727 5d29 0a0a 2020 2020 2020 2020 696d  g'])..        im
+00019d30: 6167 6573 496e 5261 7720 3d20 7365 6c66  agesInRaw = self
+00019d40: 2e69 6d61 6765 7349 6e49 6d61 6765 7344  .imagesInImagesD
+00019d50: 6972 2829 0a20 2020 2020 2020 2069 6620  ir().        if 
+00019d60: 6c65 6e28 696d 6167 6573 496e 5261 7729  len(imagesInRaw)
+00019d70: 203e 2030 3a0a 0a20 2020 2020 2020 2020   > 0:..         
+00019d80: 2020 2061 6464 6564 5f68 6173 6865 7320     added_hashes 
+00019d90: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+00019da0: 7072 6f67 203d 206d 6971 7463 2e50 7269  prog = miqtc.Pri
+00019db0: 6e74 4b6e 6f77 6e50 726f 6772 6573 734d  ntKnownProgressM
+00019dc0: 7367 2822 4368 6563 6b69 6e67 2068 6173  sg("Checking has
+00019dd0: 6865 7322 2c20 6c65 6e28 696d 6167 6573  hes", len(images
+00019de0: 496e 5261 7729 2c6d 6f64 756c 6f3d 3529  InRaw),modulo=5)
+00019df0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00019e00: 2066 696c 6520 696e 2069 6d61 6765 7349   file in imagesI
+00019e10: 6e52 6177 3a0a 2020 2020 2020 2020 2020  nRaw:.          
+00019e20: 2020 2020 2020 7072 6f67 2e70 726f 6772        prog.progr
+00019e30: 6573 7328 290a 0a20 2020 2020 2020 2020  ess()..         
+00019e40: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+00019e50: 6c66 2e5f 5f61 6c6c 5555 4944 7343 6865  lf.__allUUIDsChe
+00019e60: 636b 6564 2061 6e64 206e 6f74 206d 6971  cked and not miq
+00019e70: 7469 2e69 6d61 6765 436f 6e74 6169 6e73  ti.imageContains
+00019e80: 5661 6c69 6455 5549 4428 6669 6c65 295b  ValidUUID(file)[
+00019e90: 305d 3a0a 2020 2020 2020 2020 2020 2020  0]:.            
+00019ea0: 2020 2020 2020 2020 2320 7265 6d6f 7665          # remove
+00019eb0: 2066 726f 6d20 7575 6964 2066 696c 650a   from uuid file.
+00019ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ed0: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+00019ee0: 7869 7374 7328 7365 6c66 2e67 6574 5f69  xists(self.get_i
+00019ef0: 6e74 5f75 7569 645f 6669 6c65 2829 293a  nt_uuid_file()):
+00019f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019f10: 2020 2020 2020 2020 2072 6573 203d 206f           res = o
+00019f20: 7065 6e28 7365 6c66 2e67 6574 5f69 6e74  pen(self.get_int
+00019f30: 5f75 7569 645f 6669 6c65 2829 2c20 2272  _uuid_file(), "r
+00019f40: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00019f50: 2020 2020 2020 2020 2020 206c 696e 6573             lines
+00019f60: 203d 2072 6573 2e72 6561 646c 696e 6573   = res.readlines
+00019f70: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00019f80: 2020 2020 2020 2020 2020 2072 6573 2e63             res.c
+00019f90: 6c6f 7365 2829 0a20 2020 2020 2020 2020  lose().         
+00019fa0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00019fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019fc0: 2020 2020 2020 2020 206c 696e 6573 203d           lines =
+00019fd0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00019fe0: 2020 2020 2020 2020 6920 3d20 300a 2020          i = 0.  
+00019ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a000: 2020 6c69 6e65 4e72 203d 2069 0a20 2020    lineNr = i.   
+0001a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a020: 2066 6f72 206c 696e 6520 696e 206c 696e   for line in lin
+0001a030: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0001a040: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+0001a050: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+0001a060: 6669 6c65 2920 696e 206c 696e 653a 0a20  file) in line:. 
+0001a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a080: 2020 2020 2020 2020 2020 206c 696e 654e             lineN
+0001a090: 7220 3d20 690a 2020 2020 2020 2020 2020  r = i.          
+0001a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0b0: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
+0001a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0d0: 6920 2b3d 2031 0a20 2020 2020 2020 2020  i += 1.         
+0001a0e0: 2020 2020 2020 2020 2020 2069 6620 6c69             if li
+0001a0f0: 6e65 4e72 2021 3d20 303a 0a20 2020 2020  neNr != 0:.     
+0001a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a110: 2020 2064 656c 206c 696e 6573 5b6c 696e     del lines[lin
+0001a120: 654e 725d 0a20 2020 2020 2020 2020 2020  eNr].           
+0001a130: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0001a140: 203d 206f 7065 6e28 7365 6c66 2e67 6574   = open(self.get
+0001a150: 5f69 6e74 5f75 7569 645f 6669 6c65 2829  _int_uuid_file()
+0001a160: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
+0001a170: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001a180: 6573 2e77 7269 7465 6c69 6e65 7328 6c69  es.writelines(li
+0001a190: 6e65 7329 0a20 2020 2020 2020 2020 2020  nes).           
+0001a1a0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0001a1b0: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
+0001a1c0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0001a1d0: 7365 2045 7863 6570 7469 6f6e 2820 2246  se Exception( "F
+0001a1e0: 696c 6520 2220 2b20 6669 6c65 202b 2022  ile " + file + "
+0001a1f0: 2064 6f65 7320 6e6f 7420 636f 7461 696e   does not cotain
+0001a200: 2061 2076 616c 6964 2055 5549 442e 2052   a valid UUID. R
+0001a210: 756e 2063 7265 6174 655f 7575 6964 5f66  un create_uuid_f
+0001a220: 696c 6528 2920 6669 7273 7421 2229 0a0a  ile() first!")..
+0001a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a240: 6669 6c65 5f6e 616d 6520 3d20 6f73 2e70  file_name = os.p
+0001a250: 6174 682e 6261 7365 6e61 6d65 2866 696c  ath.basename(fil
+0001a260: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0001a270: 2020 2069 6620 6e6f 7420 7265 5265 6164     if not reRead
+0001a280: 416c 6c20 616e 6420 6669 6c65 5f6e 616d  All and file_nam
+0001a290: 6520 696e 2068 6173 6865 733a 0a20 2020  e in hashes:.   
+0001a2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a2b0: 2068 6173 6865 735b 6669 6c65 5f6e 616d   hashes[file_nam
+0001a2c0: 655d 203d 2068 6173 6865 735b 6669 6c65  e] = hashes[file
+0001a2d0: 5f6e 616d 655d 5b6d 6971 7476 2e63 6f6c  _name][miqtv.col
+0001a2e0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+0001a2f0: 5d5b 2768 6173 6827 5d5d 0a20 2020 2020  ]['hash']].     
+0001a300: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001a310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a320: 2020 2020 2068 6173 6865 735b 6669 6c65       hashes[file
+0001a330: 5f6e 616d 655d 203d 206d 6971 7463 2e73  _name] = miqtc.s
+0001a340: 6861 3235 3648 6173 6846 696c 6528 6669  ha256HashFile(fi
+0001a350: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
+0001a360: 2020 2020 2020 2020 6164 6465 645f 6861          added_ha
+0001a370: 7368 6573 202b 3d20 310a 2020 2020 2020  shes += 1.      
+0001a380: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
+0001a390: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+0001a3a0: 6966 2072 6552 6561 6441 6c6c 206f 7220  if reReadAll or 
+0001a3b0: 6164 6465 645f 6861 7368 6573 203e 2030  added_hashes > 0
+0001a3c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a3d0: 2020 6861 7368 5f66 696c 6520 3d20 6f70    hash_file = op
+0001a3e0: 656e 2873 656c 662e 6765 745f 696e 745f  en(self.get_int_
+0001a3f0: 6861 7368 5f66 696c 6528 292c 2022 7722  hash_file(), "w"
+0001a400: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001a410: 2020 6861 7368 5f66 696c 652e 7772 6974    hash_file.writ
+0001a420: 6528 206d 6971 7476 2e63 6f6c 5f68 6561  e( miqtv.col_hea
+0001a430: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
+0001a440: 6d67 275d 2b22 5c74 222b 6d69 7174 762e  mg']+"\t"+miqtv.
+0001a450: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+0001a460: 7174 275d 5b27 6861 7368 275d 2b22 5c6e  qt']['hash']+"\n
+0001a470: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001a480: 2020 2066 696c 6573 5f73 6f72 7465 6420     files_sorted 
+0001a490: 3d20 6c69 7374 2868 6173 6865 732e 6b65  = list(hashes.ke
+0001a4a0: 7973 2829 290a 2020 2020 2020 2020 2020  ys()).          
+0001a4b0: 2020 2020 2020 6669 6c65 735f 736f 7274        files_sort
+0001a4c0: 6564 2e73 6f72 7428 290a 2020 2020 2020  ed.sort().      
+0001a4d0: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
+0001a4e0: 6c65 5f6e 616d 6520 696e 2066 696c 6573  le_name in files
+0001a4f0: 5f73 6f72 7465 643a 0a20 2020 2020 2020  _sorted:.       
+0001a500: 2020 2020 2020 2020 2020 2020 2068 6173               has
+0001a510: 685f 6669 6c65 2e77 7269 7465 2866 696c  h_file.write(fil
+0001a520: 655f 6e61 6d65 2b22 5c74 222b 6861 7368  e_name+"\t"+hash
+0001a530: 6573 5b66 696c 655f 6e61 6d65 5d2b 225c  es[file_name]+"\
+0001a540: 6e22 290a 0a20 2020 2020 2020 2020 2020  n")..           
+0001a550: 2020 2020 2068 6173 685f 6669 6c65 2e63       hash_file.c
+0001a560: 6c6f 7365 2829 0a20 2020 2020 2020 2020  lose().         
+0001a570: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+0001a580: 7565 2c20 2241 6464 6564 2022 2b73 7472  ue, "Added "+str
+0001a590: 2861 6464 6564 5f68 6173 6865 7329 2b22  (added_hashes)+"
+0001a5a0: 2068 6173 6865 7320 746f 2068 6173 6820   hashes to hash 
+0001a5b0: 6669 6c65 220a 2020 2020 2020 2020 2020  file".          
+0001a5c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001a5d0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+0001a5e0: 7275 652c 2022 416c 6c20 6861 7368 6573  rue, "All hashes
+0001a5f0: 2065 7869 7374 220a 0a20 2020 2020 2020   exist"..       
+0001a600: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001a610: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
+0001a620: 2022 4e6f 2069 6d61 6765 7320 666f 756e   "No images foun
+0001a630: 6420 746f 2068 6173 6822 0a20 2020 2020  d to hash".     
+0001a640: 2020 200a 2020 2020 6465 6620 6372 6561     .    def crea
+0001a650: 7465 496d 6167 6553 4841 3235 3646 696c  teImageSHA256Fil
+0001a660: 6528 7365 6c66 2c72 6552 6561 6441 6c6c  e(self,reReadAll
+0001a670: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
+0001a680: 2222 2220 4465 7072 6563 6174 6564 202d  """ Deprecated -
+0001a690: 2075 7365 2063 7265 6174 655f 696d 6167   use create_imag
+0001a6a0: 655f 7368 6132 3536 5f66 696c 6520 2222  e_sha256_file ""
+0001a6b0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+0001a6c0: 2073 656c 662e 6372 6561 7465 5f69 6d61   self.create_ima
+0001a6d0: 6765 5f73 6861 3235 365f 6669 6c65 2872  ge_sha256_file(r
+0001a6e0: 6552 6561 6441 6c6c 290a 0a0a 2020 2020  eReadAll)...    
+0001a6f0: 6465 6620 6372 6561 7465 5f73 7461 7274  def create_start
+0001a700: 5f74 696d 655f 6669 6c65 2873 656c 6629  _time_file(self)
+0001a710: 3a0a 2020 2020 2020 2020 2222 2220 4372  :.        """ Cr
+0001a720: 6561 7465 7320 696e 202f 696e 7465 726d  eates in /interm
+0001a730: 6564 6961 7465 2061 2074 6578 7420 6669  ediate a text fi
+0001a740: 6c65 2063 6f6e 7461 696e 696e 6720 7065  le containing pe
+0001a750: 7220 696d 6167 6520 6974 7320 7374 6172  r image its star
+0001a760: 7420 7469 6d65 2070 6172 7365 6420 6672  t time parsed fr
+0001a770: 6f6d 2074 6865 2066 696c 6520 6e61 6d65  om the file name
+0001a780: 2022 2222 0a0a 2020 2020 2020 2020 7320   """..        s 
+0001a790: 3d20 6d69 7174 632e 5072 696e 744c 6f61  = miqtc.PrintLoa
+0001a7a0: 6469 6e67 4d73 6728 2243 7265 6174 696e  dingMsg("Creatin
+0001a7b0: 6720 696e 7465 726d 6564 6961 7465 2073  g intermediate s
+0001a7c0: 7461 7274 7469 6d65 2066 696c 6520 2229  tarttime file ")
+0001a7d0: 0a20 2020 2020 2020 2069 6d61 6765 7349  .        imagesI
+0001a7e0: 6e52 6177 203d 2073 656c 662e 696d 6167  nRaw = self.imag
+0001a7f0: 6573 496e 496d 6167 6573 4469 7253 6f72  esInImagesDirSor
+0001a800: 7465 644c 6973 7428 290a 2020 2020 2020  tedList().      
+0001a810: 2020 6966 206c 656e 2869 6d61 6765 7349    if len(imagesI
+0001a820: 6e52 6177 2920 3e20 303a 0a0a 2020 2020  nRaw) > 0:..    
+0001a830: 2020 2020 2020 2020 6f20 3d20 6f70 656e          o = open
+0001a840: 2873 656c 662e 6765 745f 696e 745f 7374  (self.get_int_st
+0001a850: 6172 7454 696d 6573 5f66 696c 6528 292c  artTimes_file(),
+0001a860: 2022 7722 290a 2020 2020 2020 2020 2020   "w").          
+0001a870: 2020 6f2e 7772 6974 6528 6d69 7174 762e    o.write(miqtv.
+0001a880: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+0001a890: 7174 275d 5b27 696d 6727 5d20 2b0a 2020  qt']['img'] +.  
+0001a8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8b0: 2020 225c 7422 2b6d 6971 7476 2e63 6f6c    "\t"+miqtv.col
+0001a8c0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+0001a8d0: 5d5b 2775 7463 275d 2b22 5c6e 2229 0a0a  ]['utc']+"\n")..
+0001a8e0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001a8f0: 6669 6c65 2069 6e20 696d 6167 6573 496e  file in imagesIn
+0001a900: 5261 773a 0a20 2020 2020 2020 2020 2020  Raw:.           
+0001a910: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
+0001a920: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
+0001a930: 6528 6669 6c65 290a 0a20 2020 2020 2020  e(file)..       
+0001a940: 2020 2020 2020 2020 2064 7420 3d20 6d69           dt = mi
+0001a950: 7174 632e 7061 7273 6546 696c 6544 6174  qtc.parseFileDat
+0001a960: 6554 696d 6541 7355 5443 2866 696c 655f  eTimeAsUTC(file_
+0001a970: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+0001a980: 2020 2020 2020 6f2e 7772 6974 6528 6669        o.write(fi
+0001a990: 6c65 5f6e 616d 652b 225c 7422 202b 2064  le_name+"\t" + d
+0001a9a0: 742e 7374 7266 7469 6d65 286d 6971 7476  t.strftime(miqtv
+0001a9b0: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
+0001a9c0: 6172 6971 7427 5d29 2b22 5c6e 2229 0a0a  ariqt'])+"\n")..
+0001a9d0: 2020 2020 2020 2020 2020 2020 6f2e 636c              o.cl
+0001a9e0: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
+0001a9f0: 2020 732e 7374 6f70 2829 0a20 2020 2020    s.stop().     
+0001aa00: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+0001aa10: 7565 2c20 2243 7265 6174 6564 2073 7461  ue, "Created sta
+0001aa20: 7274 2074 696d 6520 6669 6c65 220a 2020  rt time file".  
+0001aa30: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001aa40: 2020 2020 2020 2020 732e 7374 6f70 2829          s.stop()
+0001aa50: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001aa60: 7572 6e20 4661 6c73 652c 2022 4e6f 2069  urn False, "No i
+0001aa70: 6d61 6765 7320 666f 756e 6420 746f 2072  mages found to r
+0001aa80: 6561 6420 7374 6172 7420 7469 6d65 7322  ead start times"
+0001aa90: 0a20 2020 2020 2020 200a 2020 2020 6465  .        .    de
+0001aaa0: 6620 6372 6561 7465 5374 6172 7454 696d  f createStartTim
+0001aab0: 6546 696c 6528 7365 6c66 293a 0a20 2020  eFile(self):.   
+0001aac0: 2020 2020 2022 2222 2044 6570 7265 6361       """ Depreca
+0001aad0: 7465 6420 2d20 7573 6520 6372 6561 7465  ted - use create
+0001aae0: 5f73 7461 7274 5f74 696d 655f 6669 6c65  _start_time_file
+0001aaf0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+0001ab00: 7572 6e20 7365 6c66 2e63 7265 6174 655f  urn self.create_
+0001ab10: 7374 6172 745f 7469 6d65 5f66 696c 6528  start_time_file(
+0001ab20: 290a 0a0a 2020 2020 6465 6620 6372 6561  )...    def crea
+0001ab30: 7465 4163 7175 6973 6974 696f 6e53 6574  teAcquisitionSet
+0001ab40: 7469 6e67 7345 5849 4646 696c 6528 7365  tingsEXIFFile(se
+0001ab50: 6c66 2c6f 7665 7272 6964 653d 4661 6c73  lf,override=Fals
+0001ab60: 6529 3a0a 2020 2020 2020 2020 2222 2220  e):.        """ 
+0001ab70: 4465 7072 6563 6174 6564 2e20 5573 6520  Deprecated. Use 
+0001ab80: 6372 6561 7465 5f61 6371 7569 7369 7469  create_acquisiti
+0001ab90: 6f6e 5f73 6574 7469 6e67 735f 6578 6966  on_settings_exif
+0001aba0: 5f66 696c 6528 2920 696e 7374 6561 642e  _file() instead.
+0001abb0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+0001abc0: 7572 6e20 7365 6c66 2e63 7265 6174 655f  urn self.create_
+0001abd0: 6163 7175 6973 6974 696f 6e5f 7365 7474  acquisition_sett
+0001abe0: 696e 6773 5f65 7869 665f 6669 6c65 286f  ings_exif_file(o
+0001abf0: 7665 7272 6964 653d 6f76 6572 7269 6465  verride=override
+0001ac00: 290a 0a20 2020 2064 6566 2063 7265 6174  )..    def creat
+0001ac10: 655f 6163 7175 6973 6974 696f 6e5f 7365  e_acquisition_se
+0001ac20: 7474 696e 6773 5f65 7869 665f 6669 6c65  ttings_exif_file
+0001ac30: 2873 656c 662c 6f76 6572 7269 6465 3d46  (self,override=F
+0001ac40: 616c 7365 293a 0a20 2020 2020 2020 2022  alse):.        "
+0001ac50: 2222 2043 7265 6174 6573 2069 6e20 2f69  "" Creates in /i
+0001ac60: 6e74 6572 6d65 6469 6174 6520 6120 7465  ntermediate a te
+0001ac70: 7874 2066 696c 6520 636f 6e74 6169 6e69  xt file containi
+0001ac80: 6e67 2070 6572 2069 6d61 6765 2061 2064  ng per image a d
+0001ac90: 6963 7420 6f66 2065 7869 6620 7461 6773  ict of exif tags
+0001aca0: 2061 6e64 2074 6865 6972 2076 616c 7565   and their value
+0001acb0: 7320 7061 7273 6564 2066 726f 6d20 7468  s parsed from th
+0001acc0: 6520 696d 6167 6520 2222 220a 0a20 2020  e image """..   
+0001acd0: 2020 2020 2069 6e74 5f61 6371 7569 7369       int_acquisi
+0001ace0: 7469 6f6e 5365 7474 696e 675f 6669 6c65  tionSetting_file
+0001acf0: 203d 2073 656c 662e 5f5f 6765 745f 696e   = self.__get_in
+0001ad00: 745f 6669 6c65 5f70 7265 6669 7828 2920  t_file_prefix() 
+0001ad10: 2b20 275f 696d 6167 652d 6163 7175 6973  + '_image-acquis
+0001ad20: 6974 696f 6e2d 7365 7474 696e 6773 2e74  ition-settings.t
+0001ad30: 7874 270a 2020 2020 2020 2020 6865 6164  xt'.        head
+0001ad40: 6572 203d 207b 2020 6d69 7174 762e 636f  er = {  miqtv.co
+0001ad50: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+0001ad60: 275d 5b27 696d 6727 5d3a 2020 6d69 7174  ']['img']:  miqt
+0001ad70: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+0001ad80: 7269 7174 275d 5b27 696d 6727 5d2c 0a20  riqt']['img'],. 
+0001ad90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ada0: 2020 206d 6971 7476 2e63 6f6c 5f68 6561     miqtv.col_hea
+0001adb0: 6465 725b 276d 6172 6971 7427 5d5b 2761  der['mariqt']['a
+0001adc0: 6371 7569 275d 3a6d 6971 7476 2e63 6f6c  cqui']:miqtv.col
+0001add0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+0001ade0: 5d5b 2761 6371 7569 275d 7d0a 2020 2020  ]['acqui']}.    
+0001adf0: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+0001ae00: 7869 7374 7328 696e 745f 6163 7175 6973  xists(int_acquis
+0001ae10: 6974 696f 6e53 6574 7469 6e67 5f66 696c  itionSetting_fil
+0001ae20: 6529 2061 6e64 206e 6f74 206f 7665 7272  e) and not overr
+0001ae30: 6964 653a 0a20 2020 2020 2020 2020 2020  ide:.           
+0001ae40: 2073 656c 662e 6164 645f 6974 656d 5f69   self.add_item_i
+0001ae50: 6e66 6f5f 7461 625f 6669 6c65 2869 6e74  nfo_tab_file(int
+0001ae60: 5f61 6371 7569 7369 7469 6f6e 5365 7474  _acquisitionSett
+0001ae70: 696e 675f 6669 6c65 2c22 5c74 222c 6865  ing_file,"\t",he
+0001ae80: 6164 6572 290a 2020 2020 2020 2020 2020  ader).          
+0001ae90: 2020 7265 7475 726e 2054 7275 652c 2022    return True, "
+0001aea0: 5265 7375 6c74 2066 696c 6520 6578 6973  Result file exis
+0001aeb0: 7473 220a 0a20 2020 2020 2020 2069 6d61  ts"..        ima
+0001aec0: 6765 7349 6e52 6177 203d 2073 656c 662e  gesInRaw = self.
+0001aed0: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
+0001aee0: 7253 6f72 7465 644c 6973 7428 290a 2020  rSortedList().  
+0001aef0: 2020 2020 2020 6966 206c 656e 2869 6d61        if len(ima
+0001af00: 6765 7349 6e52 6177 2920 3e20 303a 0a0a  gesInRaw) > 0:..
+0001af10: 2020 2020 2020 2020 2020 2020 6f20 3d20              o = 
+0001af20: 6f70 656e 2869 6e74 5f61 6371 7569 7369  open(int_acquisi
+0001af30: 7469 6f6e 5365 7474 696e 675f 6669 6c65  tionSetting_file
+0001af40: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
+0001af50: 2020 206f 2e77 7269 7465 286d 6971 7476     o.write(miqtv
+0001af60: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+0001af70: 6971 7427 5d5b 2769 6d67 275d 202b 2022  iqt']['img'] + "
+0001af80: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
+0001af90: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+0001afa0: 6163 7175 6927 5d2b 225c 6e22 290a 200a  acqui']+"\n"). .
+0001afb0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+0001afc0: 6573 4578 6966 7320 3d20 6d69 7174 692e  esExifs = miqti.
+0001afd0: 6765 7449 6d61 6765 7341 6c6c 4578 6966  getImagesAllExif
+0001afe0: 5661 6c75 6573 2869 6d61 6765 7349 6e52  Values(imagesInR
+0001aff0: 6177 2c73 656c 662e 7072 6f76 290a 2020  aw,self.prov).  
+0001b000: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
+0001b010: 6c65 2069 6e20 696d 6167 6573 4578 6966  le in imagesExif
+0001b020: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0001b030: 2020 2066 696c 655f 6e61 6d65 203d 206f     file_name = o
+0001b040: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+0001b050: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
+0001b060: 2020 2020 2020 6f2e 7772 6974 6528 6669        o.write(fi
+0001b070: 6c65 5f6e 616d 652b 225c 7422 2b73 7472  le_name+"\t"+str
+0001b080: 2869 6d61 6765 7345 7869 6673 5b66 696c  (imagesExifs[fil
+0001b090: 655d 292b 225c 6e22 290a 0a20 2020 2020  e])+"\n")..     
+0001b0a0: 2020 2020 2020 206f 2e63 6c6f 7365 2829         o.close()
+0001b0b0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0001b0c0: 6c66 2e61 6464 5f69 7465 6d5f 696e 666f  lf.add_item_info
+0001b0d0: 5f74 6162 5f66 696c 6528 696e 745f 6163  _tab_file(int_ac
+0001b0e0: 7175 6973 6974 696f 6e53 6574 7469 6e67  quisitionSetting
+0001b0f0: 5f66 696c 652c 225c 7422 2c68 6561 6465  _file,"\t",heade
+0001b100: 7229 0a20 2020 2020 2020 2020 2020 2072  r).            r
+0001b110: 6574 7572 6e20 5472 7565 2c20 2243 7265  eturn True, "Cre
+0001b120: 6174 6564 2061 6371 7569 7369 7469 6f6e  ated acquisition
+0001b130: 2073 6574 7469 6e67 7320 6669 6c65 220a   settings file".
+0001b140: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0001b150: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001b160: 2046 616c 7365 2c20 224e 6f20 696d 6167   False, "No imag
+0001b170: 6573 2066 6f75 6e64 220a 0a0a 2020 2020  es found"...    
+0001b180: 6465 6620 696d 6167 6573 496e 496d 6167  def imagesInImag
+0001b190: 6573 4469 7228 7365 6c66 293a 0a20 2020  esDir(self):.   
+0001b1a0: 2020 2020 2072 6574 7572 6e20 636f 7079       return copy
+0001b1b0: 2e64 6565 7063 6f70 7928 7365 6c66 2e5f  .deepcopy(self._
+0001b1c0: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
+0001b1d0: 7229 0a0a 2020 2020 6465 6620 696d 6167  r)..    def imag
+0001b1e0: 6573 496e 496d 6167 6573 4469 7253 6f72  esInImagesDirSor
+0001b1f0: 7465 644c 6973 7428 7365 6c66 293a 0a20  tedList(self):. 
+0001b200: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+0001b210: 7079 2e64 6565 7063 6f70 7928 7365 6c66  py.deepcopy(self
+0001b220: 2e5f 696d 6167 6573 496e 496d 6167 6573  ._imagesInImages
+0001b230: 4469 7253 6f72 7465 644c 6973 7429 0a0a  DirSortedList)..
+0001b240: 0a20 2020 2064 6566 2070 6172 7365 4974  .    def parseIt
+0001b250: 656d 4461 7461 6672 6f6d 5461 6246 696c  emDatafromTabFil
+0001b260: 6544 6174 6128 7365 6c66 2c20 6974 656d  eData(self, item
+0001b270: 733a 2064 6963 742c 2066 696c 653a 2073  s: dict, file: s
+0001b280: 7472 2c20 636f 6c73 3a20 6c69 7374 2c20  tr, cols: list, 
+0001b290: 6f70 7469 6f6e 616c 3a20 6c69 7374 203d  optional: list =
+0001b2a0: 205b 5d2c 2064 6174 6574 696d 655f 666f   [], datetime_fo
+0001b2b0: 726d 6174 3a73 7472 3d6d 6971 7476 2e64  rmat:str=miqtv.d
+0001b2c0: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
+0001b2d0: 6971 7427 5d29 3a0a 2020 2020 2020 2020  iqt']):.        
+0001b2e0: 2222 2220 7061 7273 6573 2064 6174 6120  """ parses data 
+0001b2f0: 6672 6f6d 2063 6f6c 756d 6e73 2069 6e20  from columns in 
+0001b300: 636f 6c73 2061 6e64 2077 7269 7465 7320  cols and writes 
+0001b310: 696e 666f 2074 6f20 6974 656d 732e 2043  info to items. C
+0001b320: 6f6c 756d 6e20 2769 6d61 6765 2d66 696c  olumn 'image-fil
+0001b330: 656e 616d 6527 206d 7573 7420 6265 2069  ename' must be i
+0001b340: 6e20 6669 6c65 2061 6e64 2064 6f65 7320  n file and does 
+0001b350: 6e6f 7420 6e65 6564 2074 6f20 6265 2070  not need to be p
+0001b360: 6173 7365 6420 696e 2063 6f6c 732e 200a  assed in cols. .
+0001b370: 2020 2020 2020 2020 2020 2020 4669 6c65              File
+0001b380: 206d 7573 7420 6265 2074 6162 2073 6570   must be tab sep
+0001b390: 6172 6174 6564 2061 6e64 2063 6f6c 756d  arated and colum
+0001b3a0: 6e73 206e 616d 6573 206d 7573 7420 6571  ns names must eq
+0001b3b0: 7561 6c20 6974 656d 2066 6965 6c64 206e  ual item field n
+0001b3c0: 616d 6573 2222 220a 2020 2020 2020 2020  ames""".        
+0001b3d0: 746d 705f 6461 7461 203d 206d 6971 7466  tmp_data = miqtf
+0001b3e0: 2e74 6162 4669 6c65 4461 7461 2866 696c  .tabFileData(fil
+0001b3f0: 652c 2063 6f6c 732b 5b27 696d 6167 652d  e, cols+['image-
+0001b400: 6669 6c65 6e61 6d65 275d 2b6f 7074 696f  filename']+optio
+0001b410: 6e61 6c2c 206b 6579 5f63 6f6c 3d27 696d  nal, key_col='im
+0001b420: 6167 652d 6669 6c65 6e61 6d65 272c 206f  age-filename', o
+0001b430: 7074 696f 6e61 6c3d 6f70 7469 6f6e 616c  ptional=optional
+0001b440: 2c63 6f6e 7665 7274 3d54 7275 6529 0a20  ,convert=True). 
+0001b450: 2020 2020 2020 2073 656c 662e 7772 6974         self.writ
+0001b460: 6550 6172 7365 6444 6174 6154 6f49 7465  eParsedDataToIte
+0001b470: 6d73 2874 6d70 5f64 6174 612c 6974 656d  ms(tmp_data,item
+0001b480: 732c 7365 6c66 2e69 6664 6f5f 746d 705b  s,self.ifdo_tmp[
+0001b490: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
+0001b4a0: 6865 6164 6572 5f6b 6579 5d2c 2064 6174  header_key], dat
+0001b4b0: 6574 696d 655f 666f 726d 6174 3d64 6174  etime_format=dat
+0001b4c0: 6574 696d 655f 666f 726d 6174 290a 0a0a  etime_format)...
+0001b4d0: 2020 2020 6465 6620 7072 6173 6549 7465      def praseIte
+0001b4e0: 6d44 6174 6146 726f 6d46 696c 6528 7365  mDataFromFile(se
+0001b4f0: 6c66 2c69 7465 6d73 3a64 6963 742c 6669  lf,items:dict,fi
+0001b500: 6c65 3a73 7472 2c73 6570 6172 6174 6f72  le:str,separator
+0001b510: 3a73 7472 2c68 6561 6465 723a 6469 6374  :str,header:dict
+0001b520: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
+0001b530: 743a 7374 723d 6d69 7174 762e 6461 7465  t:str=miqtv.date
+0001b540: 5f66 6f72 6d61 7473 5b27 6d61 7269 7174  _formats['mariqt
+0001b550: 275d 293a 0a20 2020 2020 2020 2022 2222  ']):.        """
+0001b560: 2070 6172 7365 7320 6461 7461 2066 726f   parses data fro
+0001b570: 6d20 6672 6f6d 2066 696c 6520 746f 2069  m from file to i
+0001b580: 7465 6d73 2e20 6865 6164 6572 2064 6963  tems. header dic
+0001b590: 7420 6d75 7374 2062 6520 6f66 2073 7472  t must be of str
+0001b5a0: 7563 7475 7265 3a20 7b3c 6974 656d 2d66  ucture: {<item-f
+0001b5b0: 6965 6c64 2d6e 616d 653e 3a3c 636f 6c75  ield-name>:<colu
+0001b5c0: 6d6e 2d6e 616d 653e 7d0a 2020 2020 2020  mn-name>}.      
+0001b5d0: 2020 2020 2020 616e 6420 6d75 7374 2063        and must c
+0001b5e0: 6f6e 7461 696e 2065 6e74 7279 2027 696d  ontain entry 'im
+0001b5f0: 6167 652d 6669 6c65 6e61 6d65 2720 2222  age-filename' ""
+0001b600: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
+0001b610: 2027 696d 6167 652d 6669 6c65 6e61 6d65   'image-filename
+0001b620: 2720 696e 2068 6561 6465 723a 0a20 2020  ' in header:.   
+0001b630: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
+0001b640: 7863 6570 7469 6f6e 2822 6865 6164 6572  xception("header
+0001b650: 2064 6f65 7320 6e6f 7420 636f 6e74 6169   does not contai
+0001b660: 6e20 2769 6d61 6765 2d66 696c 656e 616d  n 'image-filenam
+0001b670: 6527 2229 0a20 2020 2020 2020 200a 2020  e'").        .  
+0001b680: 2020 2020 2020 746d 705f 6461 7461 203d        tmp_data =
+0001b690: 206d 6971 7466 2e74 6162 4669 6c65 4461   miqtf.tabFileDa
+0001b6a0: 7461 2866 696c 652c 2068 6561 6465 722c  ta(file, header,
+0001b6b0: 636f 6c5f 7365 7061 7261 746f 723d 7365  col_separator=se
+0001b6c0: 7061 7261 746f 722c 206b 6579 5f63 6f6c  parator, key_col
+0001b6d0: 3d27 696d 6167 652d 6669 6c65 6e61 6d65  ='image-filename
+0001b6e0: 272c 636f 6e76 6572 743d 5472 7565 290a  ',convert=True).
+0001b6f0: 2020 2020 2020 2020 7365 6c66 2e77 7269          self.wri
+0001b700: 7465 5061 7273 6564 4461 7461 546f 4974  teParsedDataToIt
+0001b710: 656d 7328 746d 705f 6461 7461 2c69 7465  ems(tmp_data,ite
+0001b720: 6d73 2c73 656c 662e 6966 646f 5f74 6d70  ms,self.ifdo_tmp
+0001b730: 5b6d 6971 7476 2e69 6d61 6765 5f73 6574  [miqtv.image_set
+0001b740: 5f68 6561 6465 725f 6b65 795d 2c20 6461  _header_key], da
+0001b750: 7465 7469 6d65 5f66 6f72 6d61 743d 6461  tetime_format=da
+0001b760: 7465 7469 6d65 5f66 6f72 6d61 7429 0a0a  tetime_format)..
+0001b770: 0a20 2020 2064 6566 2077 7269 7465 5061  .    def writePa
+0001b780: 7273 6564 4461 7461 546f 4974 656d 7328  rsedDataToItems(
+0001b790: 7365 6c66 2c64 6174 613a 6469 6374 2c69  self,data:dict,i
+0001b7a0: 7465 6d73 3a64 6963 742c 6865 6164 6572  tems:dict,header
+0001b7b0: 3a64 6963 742c 2064 6174 6574 696d 655f  :dict, datetime_
+0001b7c0: 666f 726d 6174 3a73 7472 3d6d 6971 7476  format:str=miqtv
+0001b7d0: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
+0001b7e0: 6172 6971 7427 5d29 3a0a 0a20 2020 2020  ariqt']):..     
+0001b7f0: 2020 2023 2065 7661 6c20 7374 7269 6e67     # eval string
+0001b800: 7320 6173 2064 6963 7420 6f72 206c 6973  s as dict or lis
+0001b810: 740a 2020 2020 2020 2020 6d69 7174 632e  t.        miqtc.
+0001b820: 7265 6375 7273 6976 6545 7661 6c28 6461  recursiveEval(da
+0001b830: 7461 290a 0a20 2020 2020 2020 2064 6174  ta)..        dat
+0001b840: 6120 3d20 6d69 7174 632e 7265 6375 7273  a = miqtc.recurs
+0001b850: 6976 656c 7952 656d 6f76 6545 6d70 7479  ivelyRemoveEmpty
+0001b860: 4669 656c 6473 2864 6174 612c 636f 6e74  Fields(data,cont
+0001b870: 656e 7432 6265 5265 6d6f 7665 643d 4e6f  ent2beRemoved=No
+0001b880: 6e65 290a 0a20 2020 2020 2020 2023 2070  ne)..        # p
+0001b890: 6f74 656e 7461 696c 6c79 2072 656d 6f76  otentailly remov
+0001b8a0: 6520 636f 6e73 7420 6461 7461 2066 726f  e const data fro
+0001b8b0: 6d20 6974 656d 7320 616e 6420 7075 7420  m items and put 
+0001b8c0: 696e 2068 6561 6465 720a 2020 2020 2020  in header.      
+0001b8d0: 2020 7365 6c66 2e65 7874 7261 6374 436f    self.extractCo
+0001b8e0: 6e73 7444 6174 6156 616c 7565 7328 6461  nstDataValues(da
+0001b8f0: 7461 2c68 6561 6465 7229 0a0a 2020 2020  ta,header)..    
+0001b900: 2020 2020 2320 6164 6420 2769 6d61 6765      # add 'image
+0001b910: 2d66 696c 656e 616d 6527 2066 6965 6c64  -filename' field
+0001b920: 0a20 2020 2020 2020 2066 6f72 2069 6d67  .        for img
+0001b930: 2c20 656e 7472 7920 696e 2064 6174 612e  , entry in data.
+0001b940: 6974 656d 7328 293a 0a0a 2020 2020 2020  items():..      
+0001b950: 2020 2020 2020 2320 6c69 7374 0a20 2020        # list.   
+0001b960: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+0001b970: 7374 616e 6365 2865 6e74 7279 2c6c 6973  stance(entry,lis
+0001b980: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0001b990: 2020 2020 666f 7220 6c69 7374 4974 656d      for listItem
+0001b9a0: 2069 6e20 656e 7472 793a 0a20 2020 2020   in entry:.     
+0001b9b0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0001b9c0: 6973 7449 7465 6d5b 2769 6d61 6765 2d66  istItem['image-f
+0001b9d0: 696c 656e 616d 6527 5d20 3d20 696d 670a  ilename'] = img.
+0001b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b9f0: 2020 2020 2320 636f 7665 7274 2064 6174      # covert dat
+0001ba00: 6574 696d 6520 7374 7269 6e67 0a20 2020  etime string.   
+0001ba10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba20: 2069 6620 2769 6d61 6765 2d64 6174 6574   if 'image-datet
+0001ba30: 696d 6527 2069 6e20 6c69 7374 4974 656d  ime' in listItem
+0001ba40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ba50: 2020 2020 2020 2020 2020 6474 203d 2064            dt = d
+0001ba60: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
+0001ba70: 2e73 7472 7074 696d 6528 6c69 7374 4974  .strptime(listIt
+0001ba80: 656d 5b27 696d 6167 652d 6461 7465 7469  em['image-dateti
+0001ba90: 6d65 275d 2c20 6461 7465 7469 6d65 5f66  me'], datetime_f
+0001baa0: 6f72 6d61 7429 0a20 2020 2020 2020 2020  ormat).         
+0001bab0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0001bac0: 6973 7449 7465 6d5b 2769 6d61 6765 2d64  istItem['image-d
+0001bad0: 6174 6574 696d 6527 5d20 3d20 6474 2e73  atetime'] = dt.s
+0001bae0: 7472 6674 696d 6528 6d69 7174 762e 6461  trftime(miqtv.da
+0001baf0: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
+0001bb00: 7174 275d 290a 2020 2020 2020 2020 2020  qt']).          
+0001bb10: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+0001bb20: 6528 656e 7472 792c 6469 6374 293a 0a20  e(entry,dict):. 
+0001bb30: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001bb40: 6e74 7279 5b27 696d 6167 652d 6669 6c65  ntry['image-file
+0001bb50: 6e61 6d65 275d 203d 2069 6d67 0a20 2020  name'] = img.   
+0001bb60: 2020 2020 2020 2020 2020 2020 2023 2063               # c
+0001bb70: 6f76 6572 7420 6461 7465 7469 6d65 2073  overt datetime s
+0001bb80: 7472 696e 670a 2020 2020 2020 2020 2020  tring.          
+0001bb90: 2020 2020 2020 6966 2027 696d 6167 652d        if 'image-
+0001bba0: 6461 7465 7469 6d65 2720 696e 2065 6e74  datetime' in ent
+0001bbb0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0001bbc0: 2020 2020 2020 2020 6474 203d 2064 6174          dt = dat
+0001bbd0: 6574 696d 652e 6461 7465 7469 6d65 2e73  etime.datetime.s
+0001bbe0: 7472 7074 696d 6528 656e 7472 795b 2769  trptime(entry['i
+0001bbf0: 6d61 6765 2d64 6174 6574 696d 6527 5d2c  mage-datetime'],
+0001bc00: 2064 6174 6574 696d 655f 666f 726d 6174   datetime_format
+0001bc10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001bc20: 2020 2020 2020 656e 7472 795b 2769 6d61        entry['ima
+0001bc30: 6765 2d64 6174 6574 696d 6527 5d20 3d20  ge-datetime'] = 
+0001bc40: 6474 2e73 7472 6674 696d 6528 6d69 7174  dt.strftime(miqt
+0001bc50: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
+0001bc60: 6d61 7269 7174 275d 290a 2020 2020 2020  mariqt']).      
+0001bc70: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001bc80: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0001bc90: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
+0001bca0: 7074 696f 6e28 2264 6174 6120 656e 7472  ption("data entr
+0001bcb0: 6965 7320 6d75 7374 2062 6520 6469 6374  ies must be dict
+0001bcc0: 206f 7220 6c69 7374 2069 6620 6469 6374   or list if dict
+0001bcd0: 7322 290a 0a20 2020 2020 2020 206d 6971  s")..        miq
+0001bce0: 7463 2e72 6563 7572 7369 7665 6c79 5570  tc.recursivelyUp
+0001bcf0: 6461 7465 4469 6374 7328 6974 656d 732c  dateDicts(items,
+0001bd00: 6461 7461 290a 0a0a 2020 2020 4073 7461  data)...    @sta
+0001bd10: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
+0001bd20: 6620 6578 7472 6163 7443 6f6e 7374 4461  f extractConstDa
+0001bd30: 7461 5661 6c75 6573 2864 6174 613a 6469  taValues(data:di
+0001bd40: 6374 2c68 6561 6465 723a 6469 6374 293a  ct,header:dict):
+0001bd50: 0a20 2020 2020 2020 2022 2222 2052 656d  .        """ Rem
+0001bd60: 6f76 6573 2066 6965 6c64 7320 7468 6174  oves fields that
+0001bd70: 2061 7265 2063 6f6e 7374 616e 7420 666f   are constant fo
+0001bd80: 7220 616c 6c20 656e 7472 6965 7320 6672  r all entries fr
+0001bd90: 6f6d 2064 6174 6120 6469 6374 2061 6e64  om data dict and
+0001bda0: 2070 7574 2074 6865 6d20 696e 2068 6561   put them in hea
+0001bdb0: 6465 7220 6469 6374 2e20 0a20 2020 2020  der dict. .     
+0001bdc0: 2020 2020 2020 2045 6163 6820 656e 7472         Each entr
+0001bdd0: 7920 6f66 2064 6174 6120 6d75 7374 2062  y of data must b
+0001bde0: 6520 6120 6469 6374 2077 6974 6820 7468  e a dict with th
+0001bdf0: 6520 7361 6d65 2073 6574 206f 6620 6b65  e same set of ke
+0001be00: 7973 2e20 2222 220a 2020 2020 0a20 2020  ys. """.    .   
+0001be10: 2020 2020 2023 2073 6b69 7020 6966 2074       # skip if t
+0001be20: 6865 7265 2069 7320 6f6e 6c79 206f 6e65  here is only one
+0001be30: 2069 7465 6d0a 2020 2020 2020 2020 6966   item.        if
+0001be40: 206c 656e 286c 6973 7428 6461 7461 2e6b   len(list(data.k
+0001be50: 6579 7328 2929 2920 3d3d 2031 3a0a 2020  eys())) == 1:.  
+0001be60: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001be70: 0a0a 2020 2020 2020 2020 6669 656c 6473  ..        fields
+0001be80: 546f 4967 6e6f 7265 203d 205b 2769 6d61  ToIgnore = ['ima
+0001be90: 6765 2d64 6174 6574 696d 6527 5d0a 2020  ge-datetime'].  
+0001bea0: 2020 2020 2020 636f 6e73 7444 6174 6120        constData 
+0001beb0: 3d20 7b7d 0a20 2020 2020 2020 2066 6972  = {}.        fir
+0001bec0: 7374 496d 6167 6520 3d20 5472 7565 0a20  stImage = True. 
+0001bed0: 2020 2020 2020 2066 6f72 2069 6d61 6765         for image
+0001bee0: 2c69 6d61 6765 5f64 6174 6120 696e 2064  ,image_data in d
+0001bef0: 6174 612e 6974 656d 7328 293a 0a20 2020  ata.items():.   
+0001bf00: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0001bf10: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0001bf20: 6e73 7461 6e63 6528 696d 6167 655f 6461  nstance(image_da
+0001bf30: 7461 2c6c 6973 7429 3a0a 2020 2020 2020  ta,list):.      
+0001bf40: 2020 2020 2020 2020 2020 696d 6167 655f            image_
+0001bf50: 6461 7461 203d 205b 696d 6167 655f 6461  data = [image_da
+0001bf60: 7461 5d0a 0a20 2020 2020 2020 2020 2020  ta]..           
+0001bf70: 2069 6620 6e6f 7420 6669 7273 7449 6d61   if not firstIma
+0001bf80: 6765 2061 6e64 2063 6f6e 7374 4461 7461  ge and constData
+0001bf90: 203d 3d20 7b7d 3a0a 2020 2020 2020 2020   == {}:.        
+0001bfa0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+0001bfb0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+0001bfc0: 2020 2020 2020 2066 6972 7374 5469 6d65         firstTime
+0001bfd0: 506f 696e 7420 3d20 5472 7565 0a20 2020  Point = True.   
+0001bfe0: 2020 2020 2020 2020 2066 6f72 2069 6d61           for ima
+0001bff0: 6765 5f74 705f 6461 7461 2069 6e20 696d  ge_tp_data in im
+0001c000: 6167 655f 6461 7461 3a0a 2020 2020 2020  age_data:.      
+0001c010: 2020 2020 2020 2020 2020 2320 7665 7279            # very
+0001c020: 2066 6972 7374 2064 6174 6120 666f 7220   first data for 
+0001c030: 636f 6d70 6172 6973 6f6e 0a20 2020 2020  comparison.     
+0001c040: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+0001c050: 7273 7449 6d61 6765 2061 6e64 2066 6972  rstImage and fir
+0001c060: 7374 5469 6d65 506f 696e 743a 0a20 2020  stTimePoint:.   
+0001c070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c080: 2063 6f6e 7374 4461 7461 203d 2063 6f70   constData = cop
+0001c090: 792e 6465 6570 636f 7079 2869 6d61 6765  y.deepcopy(image
+0001c0a0: 5f74 705f 6461 7461 290a 2020 2020 2020  _tp_data).      
+0001c0b0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001c0c0: 7220 6669 656c 6420 696e 2066 6965 6c64  r field in field
+0001c0d0: 7354 6f49 676e 6f72 653a 0a20 2020 2020  sToIgnore:.     
+0001c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c0f0: 2020 2069 6620 6669 656c 6420 696e 2063     if field in c
+0001c100: 6f6e 7374 4461 7461 3a0a 2020 2020 2020  onstData:.      
+0001c110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c120: 2020 2020 2020 6465 6c20 636f 6e73 7444        del constD
+0001c130: 6174 615b 6669 656c 645d 0a20 2020 2020  ata[field].     
+0001c140: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001c150: 6972 7374 5469 6d65 506f 696e 7420 3d20  irstTimePoint = 
+0001c160: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0001c170: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+0001c180: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
+0001c190: 2020 2020 636f 6e73 7444 6174 6120 3d20      constData = 
+0001c1a0: 6d69 7174 632e 6669 6e64 436f 6d6d 6f6e  miqtc.findCommon
+0001c1b0: 4469 6374 456c 656d 656e 7473 2869 6d61  DictElements(ima
+0001c1c0: 6765 5f74 705f 6461 7461 2c63 6f6e 7374  ge_tp_data,const
+0001c1d0: 4461 7461 290a 0a20 2020 2020 2020 2020  Data)..         
+0001c1e0: 2020 2066 6972 7374 496d 6167 6520 3d20     firstImage = 
+0001c1f0: 4661 6c73 650a 0a20 2020 2020 2020 2023  False..        #
+0001c200: 2054 4f44 4f20 6368 6563 6b20 7769 7468   TODO check with
+0001c210: 696e 2069 6d61 6765 2074 696d 6573 202d  in image times -
+0001c220: 3e20 746f 2069 6d61 6765 2064 6566 6175  > to image defau
+0001c230: 6c74 2e20 2874 7269 636b 7920 7369 6e63  lt. (tricky sinc
+0001c240: 6520 7765 2064 6f6e 2774 2068 6176 6520  e we don't have 
+0001c250: 7468 6520 6461 6661 756c 7420 696e 6465  the dafault inde
+0001c260: 7820 6865 7265 2e20 4f6e 6c79 2061 2073  x here. Only a s
+0001c270: 7562 7365 7420 6d69 6768 7420 6265 2075  ubset might be u
+0001c280: 7064 6174 6520 6865 7265 290a 2020 2020  pdate here).    
+0001c290: 2020 2020 2320 6368 6563 6b20 7769 7468      # check with
+0001c2a0: 696e 2069 6d61 6765 2069 7465 6d73 202d  in image items -
+0001c2b0: 3e20 6865 6164 6572 0a20 2020 2020 2020  > header.       
+0001c2c0: 2068 6561 6465 7255 7064 6174 6520 3d20   headerUpdate = 
+0001c2d0: 636f 7079 2e64 6565 7063 6f70 7928 636f  copy.deepcopy(co
+0001c2e0: 6e73 7444 6174 6129 0a20 2020 2020 2020  nstData).       
+0001c2f0: 2068 6561 6465 7255 7064 6174 6564 5465   headerUpdatedTe
+0001c300: 7374 203d 2063 6f70 792e 6465 6570 636f  st = copy.deepco
+0001c310: 7079 2868 6561 6465 7229 0a20 2020 2020  py(header).     
+0001c320: 2020 206d 6971 7463 2e72 6563 7572 7369     miqtc.recursi
+0001c330: 7665 6c79 5570 6461 7465 4469 6374 7328  velyUpdateDicts(
+0001c340: 6865 6164 6572 5570 6461 7465 6454 6573  headerUpdatedTes
+0001c350: 742c 6865 6164 6572 5570 6461 7465 290a  t,headerUpdate).
+0001c360: 2020 2020 2020 2020 7570 6461 7465 4469          updateDi
+0001c370: 6666 203d 2044 6565 7044 6966 6628 6865  ff = DeepDiff(he
+0001c380: 6164 6572 2c68 6561 6465 7255 7064 6174  ader,headerUpdat
+0001c390: 6564 5465 7374 290a 2020 2020 2020 2020  edTest).        
+0001c3a0: 2320 6368 6563 6b20 6966 2068 6561 6465  # check if heade
+0001c3b0: 7255 7064 6174 6520 776f 756c 6420 6f76  rUpdate would ov
+0001c3c0: 6572 7772 6974 6520 616e 7974 6869 6e67  erwrite anything
+0001c3d0: 2066 726f 6d20 6375 7272 656e 7420 6865   from current he
+0001c3e0: 6164 6572 2028 7368 6f75 6c64 206e 6f74  ader (should not
+0001c3f0: 2068 6170 7065 6e29 2c20 6966 2073 6f20   happen), if so 
+0001c400: 646f 6e74 2072 656d 6f76 6520 6672 6f6d  dont remove from
+0001c410: 2069 7465 6d73 0a20 2020 2020 2020 2069   items.        i
+0001c420: 6620 6e6f 7420 2776 616c 7565 735f 6368  f not 'values_ch
+0001c430: 616e 6765 6427 2069 6e20 7570 6461 7465  anged' in update
+0001c440: 4469 6666 2061 6e64 206e 6f74 2027 7479  Diff and not 'ty
+0001c450: 7065 5f63 6861 6e67 6573 2720 696e 2075  pe_changes' in u
+0001c460: 7064 6174 6544 6966 6620 616e 6420 6e6f  pdateDiff and no
+0001c470: 7420 2764 6963 7469 6f6e 6172 795f 6974  t 'dictionary_it
+0001c480: 656d 5f72 656d 6f76 6564 2720 696e 2075  em_removed' in u
+0001c490: 7064 6174 6544 6966 663a 0a20 2020 2020  pdateDiff:.     
+0001c4a0: 2020 2020 2020 2068 6561 6465 722e 636c         header.cl
+0001c4b0: 6561 7228 290a 2020 2020 2020 2020 2020  ear().          
+0001c4c0: 2020 6865 6164 6572 2e75 7064 6174 6528    header.update(
+0001c4d0: 6865 6164 6572 5570 6461 7465 6454 6573  headerUpdatedTes
+0001c4e0: 7429 0a0a 2020 2020 2020 2020 2020 2020  t)..            
+0001c4f0: 2320 7265 6d6f 7665 2063 6f6e 7374 2076  # remove const v
+0001c500: 616c 7565 7320 6672 6f6d 2064 6174 610a  alues from data.
+0001c510: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
+0001c520: 632e 7265 6375 7273 6976 654d 616b 654e  c.recursiveMakeN
+0001c530: 6f6e 6544 6963 7446 6965 6c64 7345 6d70  oneDictFieldsEmp
+0001c540: 7479 5374 7228 636f 6e73 7444 6174 6129  tyStr(constData)
+0001c550: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0001c560: 2069 6d61 6765 2c69 6d61 6765 5f64 6174   image,image_dat
+0001c570: 6120 696e 2064 6174 612e 6974 656d 7328  a in data.items(
+0001c580: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001c590: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
+0001c5a0: 616e 6365 2869 6d61 6765 5f64 6174 612c  ance(image_data,
+0001c5b0: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
+0001c5c0: 2020 2020 2020 2020 2020 2069 6d61 6765             image
+0001c5d0: 5f64 6174 6120 3d20 5b69 6d61 6765 5f64  _data = [image_d
+0001c5e0: 6174 615d 0a20 2020 2020 2020 2020 2020  ata].           
+0001c5f0: 2020 2020 2066 6f72 2069 6d61 6765 5f74       for image_t
+0001c600: 705f 6461 7461 2069 6e20 696d 6167 655f  p_data in image_
+0001c610: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+0001c620: 2020 2020 2020 2020 2020 6d69 7174 632e            miqtc.
+0001c630: 7265 6375 7273 6976 656c 7955 7064 6174  recursivelyUpdat
+0001c640: 6544 6963 7473 2869 6d61 6765 5f74 705f  eDicts(image_tp_
+0001c650: 6461 7461 2c63 6f6e 7374 4461 7461 2920  data,constData) 
+0001c660: 2020 2020 2020 2020 200a 0a20 2020 2020           ..     
+0001c670: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001c680: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0001c690: 2020 2020 2020 2320 544f 444f 206c 6f67        # TODO log
+0001c6a0: 3f0a 0a0a 2020 2020 4073 7461 7469 636d  ?...    @staticm
+0001c6b0: 6574 686f 640a 2020 2020 6465 6620 6765  ethod.    def ge
+0001c6c0: 745f 6571 7569 706d 656e 745f 6861 6e64  t_equipment_hand
+0001c6d0: 6c65 5f75 726c 2869 6664 6f3a 6469 6374  le_url(ifdo:dict
+0001c6e0: 2c20 6966 646f 5f66 6965 6c64 3a73 7472  , ifdo_field:str
+0001c6f0: 2c20 6861 6e64 6c65 5f70 7265 6669 783a  , handle_prefix:
+0001c700: 7374 722c 2070 726f 763a 6d69 7174 702e  str, prov:miqtp.
+0001c710: 5072 6f76 656e 616e 6365 3d4e 6f6e 6520  Provenance=None 
+0001c720: 293a 0a20 2020 2020 2020 2022 2222 2043  ):.        """ C
+0001c730: 6f6e 7374 7275 6374 7320 616e 6420 7265  onstructs and re
+0001c740: 7475 726e 7320 6861 6e64 6c65 2075 726c  turns handle url
+0001c750: 2066 726f 6d20 6571 6970 6d65 6e74 2069   from eqipment i
+0001c760: 6420 696e 2069 6664 6f5f 6669 656c 645b  d in ifdo_field[
+0001c770: 276e 616d 6527 5d2e 2052 6574 7572 6e73  'name']. Returns
+0001c780: 2022 2220 6966 2066 6169 6c73 2e20 446f   "" if fails. Do
+0001c790: 6573 206e 6f74 2063 6865 636b 2069 7320  es not check is 
+0001c7a0: 7369 7465 2069 7320 7570 2e20 0a20 2020  site is up. .   
+0001c7b0: 2020 2020 2020 2020 2068 616e 646c 655f           handle_
+0001c7c0: 7072 6566 6978 2070 7265 6669 7820 6d75  prefix prefix mu
+0001c7d0: 7374 2062 6520 6f66 2066 6f72 6d20 652e  st be of form e.
+0001c7e0: 672e 2068 7474 7073 3a2f 2f68 646c 2e68  g. https://hdl.h
+0001c7f0: 616e 646c 652e 6e65 742f 3230 2e35 3030  andle.net/20.500
+0001c800: 2e31 3230 3835 200a 2020 2020 2020 2020  .12085 .        
+0001c810: 2222 220a 2020 2020 2020 2020 6465 6620  """.        def 
+0001c820: 5f6c 6f67 286d 7367 3a73 7472 293a 0a20  _log(msg:str):. 
+0001c830: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
+0001c840: 6f76 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ov is not None:.
+0001c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c860: 7072 6f76 2e6c 6f67 286d 7367 290a 2020  prov.log(msg).  
+0001c870: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0001c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c890: 7072 696e 7428 6d73 6729 0a20 2020 2020  print(msg).     
+0001c8a0: 2020 2069 6d61 6765 5f66 6965 6c64 203d     image_field =
+0001c8b0: 2069 4644 4f2e 6669 6e64 5f66 6965 6c64   iFDO.find_field
+0001c8c0: 5f73 7472 2869 6664 6f2c 6966 646f 5f66  _str(ifdo,ifdo_f
+0001c8d0: 6965 6c64 290a 2020 2020 2020 2020 6966  ield).        if
+0001c8e0: 2069 6d61 6765 5f66 6965 6c64 203d 3d20   image_field == 
+0001c8f0: 2222 206f 7220 276e 616d 6527 206e 6f74  "" or 'name' not
+0001c900: 2069 6e20 696d 6167 655f 6669 656c 6420   in image_field 
+0001c910: 6f72 2069 6d61 6765 5f66 6965 6c64 5b27  or image_field['
+0001c920: 6e61 6d65 275d 203d 3d20 2222 3a0a 2020  name'] == "":.  
+0001c930: 2020 2020 2020 2020 2020 5f6c 6f67 2822            _log("
+0001c940: 4572 726f 7221 2043 616e 2774 2063 6f6e  Error! Can't con
+0001c950: 7374 7275 6374 2022 2020 2b20 6966 646f  struct "  + ifdo
+0001c960: 5f66 6965 6c64 202b 2022 2075 7269 2c20  _field + " uri, 
+0001c970: 6e61 6d65 206e 6f74 2066 696c 6c65 642e  name not filled.
+0001c980: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+0001c990: 6574 7572 6e20 2222 0a20 2020 2020 2020  eturn "".       
+0001c9a0: 2072 6574 7572 6e20 6d69 7174 632e 6173   return miqtc.as
+0001c9b0: 7365 7274 536c 6173 6828 6861 6e64 6c65  sertSlash(handle
+0001c9c0: 5f70 7265 6669 7829 202b 206d 6971 7465  _prefix) + miqte
+0001c9d0: 7175 6970 2e65 7175 6970 6d65 6e74 5368  quip.equipmentSh
+0001c9e0: 6f72 744e 616d 6528 696d 6167 655f 6669  ortName(image_fi
+0001c9f0: 656c 645b 276e 616d 6527 5d29 0a0a 0a20  eld['name'])... 
+0001ca00: 2020 2064 6566 2073 6574 5f68 6561 6465     def set_heade
+0001ca10: 725f 6571 7569 706d 656e 745f 7572 695f  r_equipment_uri_
+0001ca20: 746f 5f68 616e 646c 655f 7572 6c28 7365  to_handle_url(se
+0001ca30: 6c66 2c69 6664 6f5f 6669 656c 643a 7374  lf,ifdo_field:st
+0001ca40: 722c 206f 7665 7272 6964 653a 626f 6f6c  r, override:bool
+0001ca50: 203d 2046 616c 7365 2c20 6967 6e6f 7265   = False, ignore
+0001ca60: 5f6f 6666 6c69 6e65 3a62 6f6f 6c20 3d20  _offline:bool = 
+0001ca70: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+0001ca80: 2222 2220 436f 6e73 7472 7563 7473 2065  """ Constructs e
+0001ca90: 7175 6970 6d65 6e74 2068 616e 646c 6520  quipment handle 
+0001caa0: 7572 6c20 6672 6f6d 2069 6664 6f5f 6669  url from ifdo_fi
+0001cab0: 656c 645b 276e 616d 6527 5d20 616e 6420  eld['name'] and 
+0001cac0: 7772 6974 6520 6974 2074 6f20 6966 646f  write it to ifdo
+0001cad0: 5f66 6965 6c64 5b27 7572 6927 5d2e 0a20  _field['uri'].. 
+0001cae0: 2020 2020 2020 2050 6172 616d 733a 0a20         Params:. 
+0001caf0: 2020 2020 2020 2020 2020 206f 7665 7272             overr
+0001cb00: 6964 653a 2069 6620 4661 6c73 6520 7365  ide: if False se
+0001cb10: 7420 6f6e 6c79 2069 6620 7572 6920 6973  t only if uri is
+0001cb20: 2065 6d70 7479 206f 7220 646f 6573 206e   empty or does n
+0001cb30: 6f74 2065 7869 7374 2e0a 2020 2020 2020  ot exist..      
+0001cb40: 2020 2020 2020 6967 6e6f 7265 5f6f 6666        ignore_off
+0001cb50: 6c69 6e65 3a20 7772 6974 6520 746f 2069  line: write to i
+0001cb60: 6664 6f5f 6669 656c 645b 2775 7269 275d  fdo_field['uri']
+0001cb70: 2065 7665 6e20 6966 2063 6f6e 7374 7275   even if constru
+0001cb80: 6374 6564 2075 726c 2069 7320 6e6f 7420  cted url is not 
+0001cb90: 7265 6163 6861 626c 652e 2022 2222 0a20  reachable. """. 
+0001cba0: 2020 2020 2020 2069 6620 6e6f 7420 6f76         if not ov
+0001cbb0: 6572 7269 6465 2061 6e64 2073 656c 662e  erride and self.
+0001cbc0: 6669 6e64 546d 7046 6965 6c64 3228 6966  findTmpField2(if
+0001cbd0: 646f 5f66 6965 6c64 2b27 3a75 7269 2729  do_field+':uri')
+0001cbe0: 2021 3d20 2222 3a0a 2020 2020 2020 2020   != "":.        
+0001cbf0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+0001cc00: 6728 2243 6175 7469 6f6e 2120 2220 2b20  g("Caution! " + 
+0001cc10: 6966 646f 5f66 6965 6c64 202b 2022 3a75  ifdo_field + ":u
+0001cc20: 7269 2061 6c72 6561 6479 2065 7869 7374  ri already exist
+0001cc30: 7320 616e 6420 6973 206e 6f74 206f 7665  s and is not ove
+0001cc40: 7272 6964 6465 6e3a 2022 202b 2073 656c  rridden: " + sel
+0001cc50: 662e 6669 6e64 546d 7046 6965 6c64 3228  f.findTmpField2(
+0001cc60: 6966 646f 5f66 6965 6c64 2b20 273a 7572  ifdo_field+ ':ur
+0001cc70: 6927 2929 0a20 2020 2020 2020 2020 2020  i')).           
+0001cc80: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
+0001cc90: 0a20 2020 2020 2020 2065 7169 705f 7572  .        eqip_ur
+0001cca0: 6c20 3d20 7365 6c66 2e67 6574 5f65 7175  l = self.get_equ
+0001ccb0: 6970 6d65 6e74 5f68 616e 646c 655f 7572  ipment_handle_ur
+0001ccc0: 6c28 7365 6c66 2e69 6664 6f5f 746d 702c  l(self.ifdo_tmp,
+0001ccd0: 2069 6664 6f5f 6669 656c 642c 2073 656c   ifdo_field, sel
+0001cce0: 662e 6861 6e64 6c65 5f70 7265 6669 782c  f.handle_prefix,
+0001ccf0: 2073 656c 662e 7072 6f76 290a 2020 2020   self.prov).    
+0001cd00: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001cd10: 2020 2020 2072 6574 203d 2072 6571 7565       ret = reque
+0001cd20: 7374 732e 6865 6164 2865 7169 705f 7572  sts.head(eqip_ur
+0001cd30: 6c20 2b20 273f 6e6f 7265 6469 7265 6374  l + '?noredirect
+0001cd40: 272c 2074 696d 656f 7574 3d35 2920 2320  ', timeout=5) # 
+0001cd50: 7365 656d 7320 6e6f 7420 776f 726b 2077  seems not work w
+0001cd60: 6974 686f 7574 203f 6e6f 7265 6469 7265  ithout ?noredire
+0001cd70: 6374 0a20 2020 2020 2020 2020 2020 2069  ct.            i
+0001cd80: 6620 7265 742e 7374 6174 7573 5f63 6f64  f ret.status_cod
+0001cd90: 6520 213d 2032 3030 3a0a 2020 2020 2020  e != 200:.      
+0001cda0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001cdb0: 4578 6365 7074 696f 6e28 290a 2020 2020  Exception().    
+0001cdc0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+0001cdd0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+0001cde0: 2020 6966 206e 6f74 2069 676e 6f72 655f    if not ignore_
+0001cdf0: 6f66 666c 696e 653a 0a20 2020 2020 2020  offline:.       
+0001ce00: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0001ce10: 6f76 2e6c 6f67 2822 4572 726f 7221 2022  ov.log("Error! "
+0001ce20: 202b 2069 6664 6f5f 6669 656c 6420 2b20   + ifdo_field + 
+0001ce30: 223a 7572 6920 6967 6e6f 7265 642c 206e  ":uri ignored, n
+0001ce40: 6f74 2072 6561 6368 6162 6c65 3a20 2220  ot reachable: " 
+0001ce50: 2b20 6571 6970 5f75 726c 290a 2020 2020  + eqip_url).    
+0001ce60: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001ce70: 726e 0a20 2020 2020 2020 2020 2020 2065  rn.            e
+0001ce80: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001ce90: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+0001cea0: 6f67 2822 4361 7574 696f 6e21 2022 202b  og("Caution! " +
+0001ceb0: 2069 6664 6f5f 6669 656c 6420 2b20 223a   ifdo_field + ":
+0001cec0: 7572 6920 7365 7420 6275 7420 6e6f 7420  uri set but not 
+0001ced0: 7265 6163 6861 626c 6520 2220 2b20 6571  reachable " + eq
+0001cee0: 6970 5f75 726c 290a 0a20 2020 2020 2020  ip_url)..       
+0001cef0: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+0001cf00: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0001cf10: 6572 4b65 795d 5b69 6664 6f5f 6669 656c  erKey][ifdo_fiel
+0001cf20: 645d 5b27 7572 6927 5d20 3d20 6571 6970  d]['uri'] = eqip
+0001cf30: 5f75 726c 0a20 2020 2020 2020 2073 656c  _url.        sel
+0001cf40: 662e 7072 6f76 2e6c 6f67 2869 6664 6f5f  f.prov.log(ifdo_
+0001cf50: 6669 656c 6420 2b20 223a 7572 6920 7365  field + ":uri se
+0001cf60: 7420 746f 2022 202b 2065 7169 705f 7572  t to " + eqip_ur
+0001cf70: 6c29 0a20 2020 2020 2020 200a 0a20 2020  l).        ..   
+0001cf80: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
+0001cf90: 2020 2064 6566 2067 6574 5f68 6561 6465     def get_heade
+0001cfa0: 725f 6571 7569 706d 656e 745f 7572 695f  r_equipment_uri_
+0001cfb0: 746f 5f65 7175 6970 6d65 6e74 5f67 6974  to_equipment_git
+0001cfc0: 5f75 726c 2869 6664 6f3a 6469 6374 2c20  _url(ifdo:dict, 
+0001cfd0: 6966 646f 5f66 6965 6c64 3a73 7472 2c20  ifdo_field:str, 
+0001cfe0: 7072 6f76 3a6d 6971 7470 2e50 726f 7665  prov:miqtp.Prove
+0001cff0: 6e61 6e63 653d 4e6f 6e65 293a 0a20 2020  nance=None):.   
+0001d000: 2020 2020 2022 2222 2044 4550 5245 4341       """ DEPRECA
+0001d010: 5445 443a 2052 6174 6865 7220 7573 6520  TED: Rather use 
+0001d020: 6765 745f 6571 7569 706d 656e 745f 6861  get_equipment_ha
+0001d030: 6e64 6c65 5f75 726c 2829 2069 6e73 7465  ndle_url() inste
+0001d040: 6164 2e0a 2020 2020 2020 2020 436f 6e73  ad..        Cons
+0001d050: 7472 7563 7473 2061 6e64 2072 6574 7572  tructs and retur
+0001d060: 6e73 2065 7175 6970 6d65 6e74 2075 726c  ns equipment url
+0001d070: 2066 726f 6d20 6966 646f 5f66 6965 6c64   from ifdo_field
+0001d080: 5b27 6e61 6d65 275d 2e20 5265 7475 726e  ['name']. Return
+0001d090: 7320 2222 2069 6620 6661 696c 732e 2044  s "" if fails. D
+0001d0a0: 6f65 7320 6e6f 7420 6368 6563 6b20 6973  oes not check is
+0001d0b0: 2073 6974 6520 6973 2075 702e 2022 2222   site is up. """
+0001d0c0: 0a20 2020 2020 2020 2077 6172 6e69 6e67  .        warning
+0001d0d0: 732e 7761 726e 2827 5468 6973 206d 6574  s.warn('This met
+0001d0e0: 686f 6420 6973 2064 6570 7265 6361 7465  hod is deprecate
+0001d0f0: 642e 2052 6174 6865 7220 7573 6520 6765  d. Rather use ge
+0001d100: 745f 6571 7569 706d 656e 745f 6861 6e64  t_equipment_hand
+0001d110: 6c65 5f75 726c 2829 2069 6e73 7465 6164  le_url() instead
+0001d120: 2e27 2c20 4465 7072 6563 6174 696f 6e57  .', DeprecationW
+0001d130: 6172 6e69 6e67 2c20 7374 6163 6b6c 6576  arning, stacklev
+0001d140: 656c 3d32 290a 2020 2020 2020 2020 6465  el=2).        de
+0001d150: 6620 5f6c 6f67 286d 7367 3a73 7472 293a  f _log(msg:str):
+0001d160: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001d170: 7072 6f76 2069 7320 6e6f 7420 4e6f 6e65  prov is not None
+0001d180: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d190: 2020 7072 6f76 2e6c 6f67 286d 7367 290a    prov.log(msg).
+0001d1a0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001d1b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d1c0: 2020 7072 696e 7428 6d73 6729 0a0a 2020    print(msg)..  
+0001d1d0: 2020 2020 2020 696d 6167 655f 6669 656c        image_fiel
+0001d1e0: 6420 3d20 6946 444f 2e66 696e 645f 6669  d = iFDO.find_fi
+0001d1f0: 656c 645f 7374 7228 6966 646f 2c69 6664  eld_str(ifdo,ifd
+0001d200: 6f5f 6669 656c 6429 0a20 2020 2020 2020  o_field).       
+0001d210: 2069 6620 696d 6167 655f 6669 656c 6420   if image_field 
+0001d220: 3d3d 2022 2220 6f72 2027 6e61 6d65 2720  == "" or 'name' 
+0001d230: 6e6f 7420 696e 2069 6d61 6765 5f66 6965  not in image_fie
+0001d240: 6c64 206f 7220 696d 6167 655f 6669 656c  ld or image_fiel
+0001d250: 645b 276e 616d 6527 5d20 3d3d 2022 223a  d['name'] == "":
+0001d260: 0a20 2020 2020 2020 2020 2020 205f 6c6f  .            _lo
+0001d270: 6728 2245 7272 6f72 2120 4361 6e27 7420  g("Error! Can't 
+0001d280: 636f 6e73 7472 7563 7420 2220 202b 2069  construct "  + i
+0001d290: 6664 6f5f 6669 656c 6420 2b20 2220 7572  fdo_field + " ur
+0001d2a0: 692c 206e 616d 6520 6e6f 7420 6669 6c6c  i, name not fill
+0001d2b0: 6564 2e22 290a 2020 2020 2020 2020 2020  ed.").          
+0001d2c0: 2020 7265 7475 726e 2022 220a 0a20 2020    return ""..   
+0001d2d0: 2020 2020 2065 7169 705f 7572 6c20 3d20       eqip_url = 
+0001d2e0: 6d69 7174 6571 7569 702e 6571 7569 706d  miqtequip.equipm
+0001d2f0: 656e 745f 7572 6c28 696d 6167 655f 6669  ent_url(image_fi
+0001d300: 656c 645b 276e 616d 6527 5d29 0a20 2020  eld['name']).   
+0001d310: 2020 2020 2072 6574 7572 6e20 6571 6970       return eqip
+0001d320: 5f75 726c 0a20 2020 200a 0a20 2020 2064  _url.    ..    d
+0001d330: 6566 2073 6574 5f68 6561 6465 725f 6571  ef set_header_eq
+0001d340: 7569 706d 656e 745f 7572 695f 746f 5f65  uipment_uri_to_e
+0001d350: 7175 6970 6d65 6e74 5f67 6974 5f75 726c  quipment_git_url
+0001d360: 2873 656c 662c 6966 646f 5f66 6965 6c64  (self,ifdo_field
+0001d370: 3a73 7472 2c20 6f76 6572 7269 6465 3a62  :str, override:b
+0001d380: 6f6f 6c20 3d20 4661 6c73 652c 2069 676e  ool = False, ign
+0001d390: 6f72 655f 6f66 666c 696e 653a 626f 6f6c  ore_offline:bool
+0001d3a0: 203d 2046 616c 7365 293a 0a20 2020 2020   = False):.     
+0001d3b0: 2020 2022 2222 2044 4550 5245 4341 5445     """ DEPRECATE
+0001d3c0: 443a 2052 6174 6865 7220 7573 6520 7365  D: Rather use se
+0001d3d0: 745f 6865 6164 6572 5f65 7175 6970 6d65  t_header_equipme
+0001d3e0: 6e74 5f75 7269 5f74 6f5f 6861 6e64 6c65  nt_uri_to_handle
+0001d3f0: 5f75 726c 2829 2069 6e73 7465 6164 2e0a  _url() instead..
+0001d400: 2020 2020 2020 2020 436f 6e73 7472 7563          Construc
+0001d410: 7473 2065 7175 6970 6d65 6e74 2075 726c  ts equipment url
+0001d420: 2066 726f 6d20 6966 646f 5f66 6965 6c64   from ifdo_field
+0001d430: 5b27 6e61 6d65 275d 2061 6e64 2077 7269  ['name'] and wri
+0001d440: 7465 2069 7420 746f 2069 6664 6f5f 6669  te it to ifdo_fi
+0001d450: 656c 645b 2775 7269 275d 2e0a 2020 2020  eld['uri']..    
+0001d460: 2020 2020 5061 7261 6d73 3a0a 2020 2020      Params:.    
+0001d470: 2020 2020 2020 2020 6f76 6572 7269 6465          override
+0001d480: 3a20 6966 2046 616c 7365 2073 6574 206f  : if False set o
+0001d490: 6e6c 7920 6966 2075 7269 2069 7320 656d  nly if uri is em
+0001d4a0: 7074 7920 6f72 2064 6f65 7320 6e6f 7420  pty or does not 
+0001d4b0: 6578 6973 742e 0a20 2020 2020 2020 2020  exist..         
+0001d4c0: 2020 2069 676e 6f72 655f 6f66 666c 696e     ignore_offlin
+0001d4d0: 653a 2077 7269 7465 2074 6f20 6966 646f  e: write to ifdo
+0001d4e0: 5f66 6965 6c64 5b27 7572 6927 5d20 6576  _field['uri'] ev
+0001d4f0: 656e 2069 6620 636f 6e73 7472 7563 7465  en if constructe
+0001d500: 6420 7572 6c20 6973 206e 6f74 2072 6561  d url is not rea
+0001d510: 6368 6162 6c65 2e20 2222 220a 2020 2020  chable. """.    
+0001d520: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
+0001d530: 6e28 2754 6869 7320 6d65 7468 6f64 2069  n('This method i
+0001d540: 7320 6465 7072 6563 6174 6564 2e20 5261  s deprecated. Ra
+0001d550: 7468 6572 2075 7365 2073 6574 5f68 6561  ther use set_hea
+0001d560: 6465 725f 6571 7569 706d 656e 745f 7572  der_equipment_ur
+0001d570: 695f 746f 5f68 616e 646c 655f 7572 6c28  i_to_handle_url(
+0001d580: 2920 696e 7374 6561 642e 272c 2044 6570  ) instead.', Dep
+0001d590: 7265 6361 7469 6f6e 5761 726e 696e 672c  recationWarning,
+0001d5a0: 2073 7461 636b 6c65 7665 6c3d 3229 0a20   stacklevel=2). 
+0001d5b0: 2020 2020 2020 2069 6620 6e6f 7420 6f76         if not ov
+0001d5c0: 6572 7269 6465 2061 6e64 2073 656c 662e  erride and self.
+0001d5d0: 6669 6e64 546d 7046 6965 6c64 3228 6966  findTmpField2(if
+0001d5e0: 646f 5f66 6965 6c64 2b27 3a75 7269 2729  do_field+':uri')
+0001d5f0: 2021 3d20 2222 3a0a 2020 2020 2020 2020   != "":.        
+0001d600: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+0001d610: 6728 2243 6175 7469 6f6e 2120 2220 2b20  g("Caution! " + 
+0001d620: 6966 646f 5f66 6965 6c64 202b 2022 3a75  ifdo_field + ":u
+0001d630: 7269 2061 6c72 6561 6479 2065 7869 7374  ri already exist
+0001d640: 7320 616e 6420 6973 206e 6f74 206f 7665  s and is not ove
+0001d650: 7272 6964 6465 6e3a 2022 202b 2073 656c  rridden: " + sel
+0001d660: 662e 6669 6e64 546d 7046 6965 6c64 3228  f.findTmpField2(
+0001d670: 6966 646f 5f66 6965 6c64 2b20 273a 7572  ifdo_field+ ':ur
+0001d680: 6927 2929 0a20 2020 2020 2020 2020 2020  i')).           
+0001d690: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
+0001d6a0: 0a20 2020 2020 2020 2065 7169 705f 7572  .        eqip_ur
+0001d6b0: 6c20 3d20 7365 6c66 2e67 6574 5f68 6561  l = self.get_hea
+0001d6c0: 6465 725f 6571 7569 706d 656e 745f 7572  der_equipment_ur
+0001d6d0: 695f 746f 5f65 7175 6970 6d65 6e74 5f67  i_to_equipment_g
+0001d6e0: 6974 5f75 726c 2873 656c 662e 6966 646f  it_url(self.ifdo
+0001d6f0: 5f74 6d70 2c69 6664 6f5f 6669 656c 642c  _tmp,ifdo_field,
+0001d700: 7365 6c66 2e70 726f 7629 0a20 2020 2020  self.prov).     
+0001d710: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001d720: 2020 2020 7265 7420 3d20 7265 7175 6573      ret = reques
+0001d730: 7473 2e68 6561 6428 6571 6970 5f75 726c  ts.head(eqip_url
+0001d740: 2c20 7469 6d65 6f75 743d 3529 0a20 2020  , timeout=5).   
+0001d750: 2020 2020 2020 2020 2069 6620 7265 742e           if ret.
+0001d760: 7374 6174 7573 5f63 6f64 6520 213d 2032  status_code != 2
+0001d770: 3030 3a0a 2020 2020 2020 2020 2020 2020  00:.            
+0001d780: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+0001d790: 696f 6e28 290a 2020 2020 2020 2020 6578  ion().        ex
+0001d7a0: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
+0001d7b0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001d7c0: 6f74 2069 676e 6f72 655f 6f66 666c 696e  ot ignore_offlin
+0001d7d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001d7e0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+0001d7f0: 2822 4572 726f 7221 2022 202b 2069 6664  ("Error! " + ifd
+0001d800: 6f5f 6669 656c 6420 2b20 223a 7572 6920  o_field + ":uri 
+0001d810: 6967 6e6f 7265 642c 206e 6f74 2072 6561  ignored, not rea
+0001d820: 6368 6162 6c65 3a20 2220 2b20 6571 6970  chable: " + eqip
+0001d830: 5f75 726c 290a 2020 2020 2020 2020 2020  _url).          
+0001d840: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+0001d850: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001d860: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001d870: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
+0001d880: 7574 696f 6e21 2022 202b 2069 6664 6f5f  ution! " + ifdo_
+0001d890: 6669 656c 6420 2b20 223a 7572 6920 7365  field + ":uri se
+0001d8a0: 7420 6275 7420 6e6f 7420 7265 6163 6861  t but not reacha
+0001d8b0: 626c 6520 2220 2b20 6571 6970 5f75 726c  ble " + eqip_url
+0001d8c0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0001d8d0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+0001d8e0: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+0001d8f0: 5b69 6664 6f5f 6669 656c 645d 5b27 7572  [ifdo_field]['ur
+0001d900: 6927 5d20 3d20 6571 6970 5f75 726c 0a20  i'] = eqip_url. 
+0001d910: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+0001d920: 2e6c 6f67 2869 6664 6f5f 6669 656c 6420  .log(ifdo_field 
+0001d930: 2b20 223a 7572 6920 7365 7420 746f 2022  + ":uri set to "
+0001d940: 202b 2065 7169 705f 7572 6c29 0a0a 0a20   + eqip_url)... 
+0001d950: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+0001d960: 0a20 2020 2064 6566 2067 6574 5f68 6561  .    def get_hea
+0001d970: 6465 725f 696d 6167 655f 7072 6f6a 6563  der_image_projec
+0001d980: 745f 7572 695f 746f 5f6f 7369 735f 6578  t_uri_to_osis_ex
+0001d990: 7065 6469 7469 6f6e 5f75 726c 2869 6664  pedition_url(ifd
+0001d9a0: 6f3a 6469 6374 2c70 726f 763a 6d69 7174  o:dict,prov:miqt
+0001d9b0: 702e 5072 6f76 656e 616e 6365 3d4e 6f6e  p.Provenance=Non
+0001d9c0: 6529 3a0a 2020 2020 2020 2020 2222 2220  e):.        """ 
+0001d9d0: 5265 7475 726e 7320 6865 6164 6572 2069  Returns header i
+0001d9e0: 6d61 6765 2d70 726f 6a65 6374 2075 7269  mage-project uri
+0001d9f0: 2061 7320 6f73 6973 2065 7870 6564 6974   as osis expedit
+0001da00: 696f 6e20 7572 6c20 7061 7273 6564 2066  ion url parsed f
+0001da10: 726f 6d20 696d 6167 652d 7072 6f6a 6563  rom image-projec
+0001da20: 745b 276e 616d 6527 5d2e 2222 220a 0a20  t['name'].""".. 
+0001da30: 2020 2020 2020 2064 6566 205f 6c6f 6728         def _log(
+0001da40: 6d73 673a 7374 7229 3a0a 2020 2020 2020  msg:str):.      
+0001da50: 2020 2020 2020 6966 2070 726f 7620 6973        if prov is
+0001da60: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0001da70: 2020 2020 2020 2020 2020 2070 726f 762e             prov.
+0001da80: 6c6f 6728 6d73 6729 0a20 2020 2020 2020  log(msg).       
+0001da90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001daa0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0001dab0: 286d 7367 290a 0a20 2020 2020 2020 2069  (msg)..        i
+0001dac0: 6d61 6765 5f70 726f 6a65 6374 203d 2069  mage_project = i
+0001dad0: 4644 4f2e 6669 6e64 5f66 6965 6c64 5f73  FDO.find_field_s
+0001dae0: 7472 2869 6664 6f2c 2769 6d61 6765 2d70  tr(ifdo,'image-p
+0001daf0: 726f 6a65 6374 2729 0a20 2020 2020 2020  roject').       
+0001db00: 2069 6620 696d 6167 655f 7072 6f6a 6563   if image_projec
+0001db10: 7420 3d3d 2022 2220 6f72 2027 6e61 6d65  t == "" or 'name
+0001db20: 2720 6e6f 7420 696e 2069 6d61 6765 5f70  ' not in image_p
+0001db30: 726f 6a65 6374 206f 7220 696d 6167 655f  roject or image_
+0001db40: 7072 6f6a 6563 745b 276e 616d 6527 5d20  project['name'] 
+0001db50: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
+0001db60: 2020 205f 6c6f 6728 2245 7272 6f72 2120     _log("Error! 
+0001db70: 4361 6e27 7420 636f 6e73 7472 7563 7420  Can't construct 
+0001db80: 696d 6167 652d 7072 6f6a 6563 7420 7572  image-project ur
+0001db90: 692c 2069 6d61 6765 2d70 726f 6a65 6374  i, image-project
+0001dba0: 206e 6f74 2066 696c 6c65 642e 2229 0a20   not filled."). 
+0001dbb0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001dbc0: 6e20 2222 0a20 2020 2020 2020 200a 2020  n "".        .  
+0001dbd0: 2020 2020 2020 2320 6765 7420 6578 7065        # get expe
+0001dbe0: 6469 7469 6f6e 2069 640a 2020 2020 2020  dition id.      
+0001dbf0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0001dc00: 2020 2065 7870 6564 6974 696f 6e5f 6964     expedition_id
+0001dc10: 203d 206d 6971 746f 7369 732e 6765 745f   = miqtosis.get_
+0001dc20: 6578 7065 6469 7469 6f6e 5f69 645f 6672  expedition_id_fr
+0001dc30: 6f6d 5f6c 6162 656c 2869 6d61 6765 5f70  om_label(image_p
+0001dc40: 726f 6a65 6374 5b27 6e61 6d65 275d 290a  roject['name']).
+0001dc50: 2020 2020 2020 2020 6578 6365 7074 2056          except V
+0001dc60: 616c 7565 4572 726f 723a 0a20 2020 2020  alueError:.     
+0001dc70: 2020 2020 2020 205f 6c6f 6728 2245 7272         _log("Err
+0001dc80: 6f72 2120 4361 6e27 7420 6765 7420 6f73  or! Can't get os
+0001dc90: 6973 2065 7870 6564 6974 696f 6e20 6964  is expedition id
+0001dca0: 2066 726f 6d20 696d 6167 652d 7072 6f6a   from image-proj
+0001dcb0: 6563 7420 2220 2b20 7374 7228 696d 6167  ect " + str(imag
+0001dcc0: 655f 7072 6f6a 6563 7429 290a 2020 2020  e_project)).    
+0001dcd0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
+0001dce0: 220a 0a20 2020 2020 2020 2065 7870 6564  "..        exped
+0001dcf0: 6974 696f 6e5f 7572 6c20 3d20 6d69 7174  ition_url = miqt
+0001dd00: 6f73 6973 2e67 6574 5f65 7870 6564 6974  osis.get_expedit
+0001dd10: 696f 6e5f 7572 6c28 6578 7065 6469 7469  ion_url(expediti
+0001dd20: 6f6e 5f69 6429 0a20 2020 2020 2020 2072  on_id).        r
+0001dd30: 6574 7572 6e20 6578 7065 6469 7469 6f6e  eturn expedition
+0001dd40: 5f75 726c 0a0a 0a20 2020 2064 6566 2073  _url...    def s
+0001dd50: 6574 5f68 6561 6465 725f 696d 6167 655f  et_header_image_
+0001dd60: 7072 6f6a 6563 745f 7572 695f 746f 5f6f  project_uri_to_o
+0001dd70: 7369 735f 6578 7065 6469 7469 6f6e 5f75  sis_expedition_u
+0001dd80: 726c 2873 656c 662c 6f76 6572 7269 6465  rl(self,override
+0001dd90: 3a62 6f6f 6c20 3d20 4661 6c73 6529 3a0a  :bool = False):.
+0001dda0: 2020 2020 2020 2020 2222 2220 5365 7473          """ Sets
+0001ddb0: 2068 6561 6465 7220 696d 6167 652d 7072   header image-pr
+0001ddc0: 6f6a 6563 7420 7572 6920 746f 206f 7369  oject uri to osi
+0001ddd0: 7320 6578 7065 6469 7469 6f6e 2075 726c  s expedition url
+0001dde0: 2070 6172 7365 6420 6672 6f6d 2069 6d61   parsed from ima
+0001ddf0: 6765 2d70 726f 6a65 6374 5b27 6e61 6d65  ge-project['name
+0001de00: 275d 2e0a 2020 2020 2020 2020 5061 7261  ']..        Para
+0001de10: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+0001de20: 6f76 6572 7269 6465 3a20 6966 2046 616c  override: if Fal
+0001de30: 7365 2073 6574 206f 6e6c 7920 6966 2075  se set only if u
+0001de40: 7269 2069 7320 656d 7074 7920 6f72 2064  ri is empty or d
+0001de50: 6f65 7320 6e6f 7420 6578 6973 742e 2022  oes not exist. "
+0001de60: 2222 0a0a 2020 2020 2020 2020 6966 206e  ""..        if n
+0001de70: 6f74 206f 7665 7272 6964 6520 616e 6420  ot override and 
+0001de80: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+0001de90: 6432 2827 696d 6167 652d 7072 6f6a 6563  d2('image-projec
+0001dea0: 743a 7572 6927 2920 213d 2022 223a 0a20  t:uri') != "":. 
+0001deb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001dec0: 7072 6f76 2e6c 6f67 2822 4361 7574 696f  prov.log("Cautio
+0001ded0: 6e21 2069 6d61 6765 2d70 726f 6a65 6374  n! image-project
+0001dee0: 3a75 7269 2061 6c72 6561 6479 2065 7869  :uri already exi
+0001def0: 7374 7320 616e 6420 6973 206e 6f74 206f  sts and is not o
+0001df00: 7665 7272 6964 6465 6e3a 2022 202b 2073  verridden: " + s
+0001df10: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
+0001df20: 3228 2769 6d61 6765 2d70 726f 6a65 6374  2('image-project
+0001df30: 3a75 7269 2729 290a 2020 2020 2020 2020  :uri')).        
+0001df40: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+0001df50: 2020 2020 6578 7065 6469 7469 6f6e 5f75      expedition_u
+0001df60: 726c 203d 2073 656c 662e 6765 745f 6865  rl = self.get_he
+0001df70: 6164 6572 5f69 6d61 6765 5f70 726f 6a65  ader_image_proje
+0001df80: 6374 5f75 7269 5f74 6f5f 6f73 6973 5f65  ct_uri_to_osis_e
+0001df90: 7870 6564 6974 696f 6e5f 7572 6c28 7365  xpedition_url(se
+0001dfa0: 6c66 2e69 6664 6f5f 746d 702c 7365 6c66  lf.ifdo_tmp,self
+0001dfb0: 2e70 726f 7629 0a20 2020 2020 2020 2073  .prov).        s
+0001dfc0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+0001dfd0: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0001dfe0: 4b65 795d 5b27 696d 6167 652d 7072 6f6a  Key]['image-proj
+0001dff0: 6563 7427 5d5b 2775 7269 275d 203d 2065  ect']['uri'] = e
+0001e000: 7870 6564 6974 696f 6e5f 7572 6c0a 2020  xpedition_url.  
+0001e010: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001e020: 2020 2020 2020 2072 6574 203d 2072 6571         ret = req
+0001e030: 7565 7374 732e 6865 6164 2865 7870 6564  uests.head(exped
+0001e040: 6974 696f 6e5f 7572 6c29 0a20 2020 2020  ition_url).     
+0001e050: 2020 2020 2020 2069 6620 7265 742e 7374         if ret.st
+0001e060: 6174 7573 5f63 6f64 6520 213d 2032 3030  atus_code != 200
+0001e070: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001e080: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+0001e090: 6e28 290a 2020 2020 2020 2020 6578 6365  n().        exce
+0001e0a0: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
+0001e0b0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0001e0c0: 726f 762e 6c6f 6728 2243 6175 7469 6f6e  rov.log("Caution
+0001e0d0: 2120 696d 6167 652d 7072 6f6a 6563 743a  ! image-project:
+0001e0e0: 7572 6920 7365 7420 6275 7420 6e6f 7420  uri set but not 
+0001e0f0: 7265 6163 6861 626c 6520 2220 2b20 6578  reachable " + ex
+0001e100: 7065 6469 7469 6f6e 5f75 726c 290a 2020  pedition_url).  
+0001e110: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+0001e120: 6c6f 6728 2269 6d61 6765 2d70 726f 6a65  log("image-proje
+0001e130: 6374 3a75 7269 2073 6574 2074 6f20 2220  ct:uri set to " 
+0001e140: 2b20 6578 7065 6469 7469 6f6e 5f75 726c  + expedition_url
+0001e150: 290a 0a0a 2020 2020 4073 7461 7469 636d  )...    @staticm
+0001e160: 6574 686f 640a 2020 2020 6465 6620 6765  ethod.    def ge
+0001e170: 745f 6865 6164 6572 5f69 6d61 6765 5f65  t_header_image_e
+0001e180: 7665 6e74 5f75 7269 5f74 6f5f 6f73 6973  vent_uri_to_osis
+0001e190: 5f65 7665 6e74 5f75 726c 2869 6664 6f3a  _event_url(ifdo:
+0001e1a0: 6469 6374 2c70 726f 763a 6d69 7174 702e  dict,prov:miqtp.
+0001e1b0: 5072 6f76 656e 616e 6365 3d4e 6f6e 6529  Provenance=None)
+0001e1c0: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
+0001e1d0: 7475 726e 7320 6865 6164 6572 2069 6d61  turns header ima
+0001e1e0: 6765 2d65 7665 6e74 2075 7269 2061 7320  ge-event uri as 
+0001e1f0: 6f73 6973 2065 7665 6e74 2075 726c 2070  osis event url p
+0001e200: 6172 7365 6420 6672 6f6d 2069 6d61 6765  arsed from image
+0001e210: 2d70 726f 6a65 6374 2061 6e64 2069 6d61  -project and ima
+0001e220: 6765 2d65 7665 6e74 5b27 6e61 6d65 275d  ge-event['name']
+0001e230: 206f 7220 0a20 2020 2020 2020 2069 6d61   or .        ima
+0001e240: 6765 2d65 7665 6e74 5b27 7572 6927 5d20  ge-event['uri'] 
+0001e250: 6966 2069 7420 7265 6665 7273 2074 6f20  if it refers to 
+0001e260: 6f73 6973 2e20 5265 7475 726e 7320 656d  osis. Returns em
+0001e270: 7074 7920 7374 7269 6e67 2069 6620 6661  pty string if fa
+0001e280: 696c 732e 2022 2222 0a0a 2020 2020 2020  ils. """..      
+0001e290: 2020 6465 6620 5f6c 6f67 286d 7367 3a73    def _log(msg:s
+0001e2a0: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
+0001e2b0: 2069 6620 7072 6f76 2069 7320 6e6f 7420   if prov is not 
+0001e2c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0001e2d0: 2020 2020 2020 7072 6f76 2e6c 6f67 286d        prov.log(m
+0001e2e0: 7367 290a 2020 2020 2020 2020 2020 2020  sg).            
+0001e2f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001e300: 2020 2020 2020 7072 696e 7428 6d73 6729        print(msg)
+0001e310: 0a0a 2020 2020 2020 2020 696d 6167 655f  ..        image_
+0001e320: 7072 6f6a 6563 7420 3d20 6946 444f 2e66  project = iFDO.f
+0001e330: 696e 645f 6669 656c 645f 7374 7228 6966  ind_field_str(if
+0001e340: 646f 2c20 2769 6d61 6765 2d70 726f 6a65  do, 'image-proje
+0001e350: 6374 2729 0a20 2020 2020 2020 2069 6620  ct').        if 
+0001e360: 696d 6167 655f 7072 6f6a 6563 7420 3d3d  image_project ==
+0001e370: 2022 2220 6f72 2027 6e61 6d65 2720 6e6f   "" or 'name' no
+0001e380: 7420 696e 2069 6d61 6765 5f70 726f 6a65  t in image_proje
+0001e390: 6374 206f 7220 696d 6167 655f 7072 6f6a  ct or image_proj
+0001e3a0: 6563 745b 276e 616d 6527 5d20 3d3d 2022  ect['name'] == "
+0001e3b0: 223a 0a20 2020 2020 2020 2020 2020 205f  ":.            _
+0001e3c0: 6c6f 6728 2245 7272 6f72 2120 4361 6e27  log("Error! Can'
+0001e3d0: 7420 636f 6e73 7472 7563 7420 696d 6167  t construct imag
+0001e3e0: 652d 6576 656e 7420 7572 692c 2069 6d61  e-event uri, ima
+0001e3f0: 6765 2d70 726f 6a65 6374 206e 6f74 2066  ge-project not f
+0001e400: 696c 6c65 642e 2229 0a20 2020 2020 2020  illed.").       
+0001e410: 2020 2020 2072 6574 7572 6e20 2222 0a0a       return ""..
+0001e420: 2020 2020 2020 2020 2320 6765 7420 6578          # get ex
+0001e430: 7065 6469 7469 6f6e 2069 640a 2020 2020  pedition id.    
+0001e440: 2020 2020 2323 2074 7279 2070 6172 7365      ## try parse
+0001e450: 2065 7870 6564 6974 696f 6e20 6964 2066   expedition id f
+0001e460: 726f 6d20 7072 6f6a 6563 7420 6f73 6973  rom project osis
+0001e470: 2075 7269 0a20 2020 2020 2020 2069 6620   uri.        if 
+0001e480: 2775 7269 2720 696e 2069 6d61 6765 5f70  'uri' in image_p
+0001e490: 726f 6a65 6374 2061 6e64 2069 6d61 6765  roject and image
+0001e4a0: 5f70 726f 6a65 6374 5b27 7572 6927 5d20  _project['uri'] 
+0001e4b0: 213d 2022 223a 0a20 2020 2020 2020 2020  != "":.         
+0001e4c0: 2020 2065 7870 6564 6974 696f 6e5f 6964     expedition_id
+0001e4d0: 203d 206d 6971 746f 7369 732e 6765 745f   = miqtosis.get_
+0001e4e0: 6578 7065 6469 7469 6f6e 5f69 645f 6672  expedition_id_fr
+0001e4f0: 6f6d 5f75 726c 2869 6d61 6765 5f70 726f  om_url(image_pro
+0001e500: 6a65 6374 5b27 7572 6927 5d29 0a20 2020  ject['uri']).   
+0001e510: 2020 2020 2023 2067 6574 2065 7870 6564       # get exped
+0001e520: 6974 696f 6e20 6964 2066 726f 6d20 6f73  ition id from os
+0001e530: 6973 2061 7069 2062 7920 6578 7065 6469  is api by expedi
+0001e540: 7469 6f6e 206e 616d 650a 2020 2020 2020  tion name.      
+0001e550: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001e560: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001e570: 2020 2020 2020 2020 2065 7870 6564 6974           expedit
+0001e580: 696f 6e5f 6964 203d 206d 6971 746f 7369  ion_id = miqtosi
+0001e590: 732e 6765 745f 6578 7065 6469 7469 6f6e  s.get_expedition
+0001e5a0: 5f69 645f 6672 6f6d 5f6c 6162 656c 2869  _id_from_label(i
+0001e5b0: 6d61 6765 5f70 726f 6a65 6374 5b27 6e61  mage_project['na
+0001e5c0: 6d65 275d 290a 2020 2020 2020 2020 2020  me']).          
+0001e5d0: 2020 6578 6365 7074 2056 616c 7565 4572    except ValueEr
+0001e5e0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+0001e5f0: 2020 2020 205f 6c6f 6728 2245 7272 6f72       _log("Error
+0001e600: 2120 4361 6e27 7420 6765 7420 6f73 6973  ! Can't get osis
+0001e610: 2065 7870 6564 6974 696f 6e20 6964 2066   expedition id f
+0001e620: 726f 6d20 696d 6167 652d 7072 6f6a 6563  rom image-projec
+0001e630: 7420 2220 2b20 7374 7228 696d 6167 655f  t " + str(image_
+0001e640: 7072 6f6a 6563 7429 290a 2020 2020 2020  project)).      
+0001e650: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001e660: 2022 220a 0a20 2020 2020 2020 2023 2074   ""..        # t
+0001e670: 7279 2070 6172 7365 2065 7665 6e74 2069  ry parse event i
+0001e680: 640a 2020 2020 2020 2020 6576 656e 745f  d.        event_
+0001e690: 6e61 6d65 203d 2069 4644 4f2e 6669 6e64  name = iFDO.find
+0001e6a0: 5f66 6965 6c64 5f73 7472 2869 6664 6f2c  _field_str(ifdo,
+0001e6b0: 2027 696d 6167 652d 6576 656e 743a 6e61   'image-event:na
+0001e6c0: 6d65 2729 0a20 2020 2020 2020 2069 6620  me').        if 
+0001e6d0: 6576 656e 745f 6e61 6d65 203d 3d20 2222  event_name == ""
+0001e6e0: 3a0a 2020 2020 2020 2020 2020 2020 5f6c  :.            _l
+0001e6f0: 6f67 2822 4572 726f 7221 2043 616e 2774  og("Error! Can't
+0001e700: 2063 6f6e 7374 7275 6374 2069 6d61 6765   construct image
+0001e710: 2d65 7665 6e74 2075 7269 2c20 696d 6167  -event uri, imag
+0001e720: 652d 6576 656e 743a 6e61 6d65 206e 6f74  e-event:name not
+0001e730: 2066 696c 6c65 642e 2229 0a20 2020 2020   filled.").     
+0001e740: 2020 2020 2020 2072 6574 7572 6e20 2222         return ""
+0001e750: 0a0a 2020 2020 2020 2020 6f73 6973 5f75  ..        osis_u
+0001e760: 726c 203d 2069 4644 4f2e 6765 745f 6f73  rl = iFDO.get_os
+0001e770: 6973 5f65 7665 6e74 5f75 726c 2865 7870  is_event_url(exp
+0001e780: 6564 6974 696f 6e5f 6964 2c20 6576 656e  edition_id, even
+0001e790: 745f 6e61 6d65 290a 0a20 2020 2020 2020  t_name)..       
+0001e7a0: 2069 6620 6f73 6973 5f75 726c 203d 3d20   if osis_url == 
+0001e7b0: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
+0001e7c0: 5f6c 6f67 2822 4572 726f 7221 2043 616e  _log("Error! Can
+0001e7d0: 2774 2063 6f6e 7374 7275 6374 2069 6d61  't construct ima
+0001e7e0: 6765 2d65 7665 6e74 2075 7269 2066 726f  ge-event uri fro
+0001e7f0: 6d20 6578 7065 6469 7469 6f6e 5f69 6420  m expedition_id 
+0001e800: 616e 6420 6576 656e 745f 6e61 6d65 3a20  and event_name: 
+0001e810: 2220 2b20 7374 7228 6578 7065 6469 7469  " + str(expediti
+0001e820: 6f6e 5f69 6429 202b 2022 2c20 2220 2b20  on_id) + ", " + 
+0001e830: 6576 656e 745f 6e61 6d65 290a 2020 2020  event_name).    
+0001e840: 2020 2020 2020 2020 7265 7475 726e 2022          return "
+0001e850: 220a 0a20 2020 2020 2020 2072 6574 7572  "..        retur
+0001e860: 6e20 6f73 6973 5f75 726c 0a0a 0a20 2020  n osis_url...   
+0001e870: 2064 6566 2073 6574 5f68 6561 6465 725f   def set_header_
+0001e880: 696d 6167 655f 6576 656e 745f 7572 695f  image_event_uri_
+0001e890: 746f 5f6f 7369 735f 6576 656e 745f 7572  to_osis_event_ur
+0001e8a0: 6c28 7365 6c66 2c6f 7665 7272 6964 653a  l(self,override:
+0001e8b0: 626f 6f6c 203d 2046 616c 7365 293a 0a20  bool = False):. 
+0001e8c0: 2020 2020 2020 2022 2222 2053 6574 7320         """ Sets 
+0001e8d0: 6865 6164 6572 2069 6d61 6765 2d65 7665  header image-eve
+0001e8e0: 6e74 2075 7269 2074 6f20 6f73 6973 2065  nt uri to osis e
+0001e8f0: 7665 6e74 2075 726c 2070 6172 7365 6420  vent url parsed 
+0001e900: 6672 6f6d 2069 6d61 6765 2d70 726f 6a65  from image-proje
+0001e910: 6374 2061 6e64 2069 6d61 6765 2d65 7665  ct and image-eve
+0001e920: 6e74 5b27 6e61 6d65 275d 206f 7220 0a20  nt['name'] or . 
+0001e930: 2020 2020 2020 2069 6d61 6765 2d65 7665         image-eve
+0001e940: 6e74 5b27 7572 6927 5d20 6966 2069 7420  nt['uri'] if it 
+0001e950: 7265 6665 7273 2074 6f20 6f73 6973 2e0a  refers to osis..
+0001e960: 2020 2020 2020 2020 5061 7261 6d73 3a0a          Params:.
+0001e970: 2020 2020 2020 2020 2020 2020 6f76 6572              over
+0001e980: 7269 6465 3a20 6966 2046 616c 7365 2073  ride: if False s
+0001e990: 6574 206f 6e6c 7920 6966 2075 7269 2069  et only if uri i
+0001e9a0: 7320 656d 7074 7920 6f72 2064 6f65 7320  s empty or does 
+0001e9b0: 6e6f 7420 6578 6973 742e 2022 2222 0a0a  not exist. """..
+0001e9c0: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+0001e9d0: 7665 7272 6964 6520 616e 6420 7365 6c66  verride and self
+0001e9e0: 2e66 696e 6454 6d70 4669 656c 6432 2827  .findTmpField2('
+0001e9f0: 696d 6167 652d 6576 656e 743a 7572 6927  image-event:uri'
+0001ea00: 2920 213d 2022 223a 0a20 2020 2020 2020  ) != "":.       
+0001ea10: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+0001ea20: 6f67 2822 4361 7574 696f 6e21 2069 6d61  og("Caution! ima
+0001ea30: 6765 2d65 7665 6e74 3a75 7269 2061 6c72  ge-event:uri alr
+0001ea40: 6561 6479 2065 7869 7374 7320 616e 6420  eady exists and 
+0001ea50: 6973 206e 6f74 206f 7665 7272 6964 6465  is not overridde
+0001ea60: 6e3a 2022 202b 2073 656c 662e 6669 6e64  n: " + self.find
+0001ea70: 546d 7046 6965 6c64 3228 2769 6d61 6765  TmpField2('image
+0001ea80: 2d65 7665 6e74 3a75 7269 2729 290a 2020  -event:uri')).  
+0001ea90: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001eaa0: 0a0a 2020 2020 2020 2020 6f73 6973 5f75  ..        osis_u
+0001eab0: 726c 203d 2073 656c 662e 6765 745f 6865  rl = self.get_he
+0001eac0: 6164 6572 5f69 6d61 6765 5f65 7665 6e74  ader_image_event
+0001ead0: 5f75 7269 5f74 6f5f 6f73 6973 5f65 7665  _uri_to_osis_eve
+0001eae0: 6e74 5f75 726c 2873 656c 662e 6966 646f  nt_url(self.ifdo
+0001eaf0: 5f74 6d70 2c73 656c 662e 7072 6f76 290a  _tmp,self.prov).
+0001eb00: 2020 2020 2020 2020 6966 206f 7369 735f          if osis_
+0001eb10: 7572 6c20 3d3d 2022 223a 0a20 2020 2020  url == "":.     
+0001eb20: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+0001eb30: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+0001eb40: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0001eb50: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
+0001eb60: 6765 2d65 7665 6e74 275d 5b27 7572 6927  ge-event']['uri'
+0001eb70: 5d20 3d20 6f73 6973 5f75 726c 0a20 2020  ] = osis_url.   
+0001eb80: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0001eb90: 2020 2020 2020 7265 7420 3d20 7265 7175        ret = requ
+0001eba0: 6573 7473 2e68 6561 6428 6f73 6973 5f75  ests.head(osis_u
+0001ebb0: 726c 290a 2020 2020 2020 2020 2020 2020  rl).            
+0001ebc0: 6966 2072 6574 2e73 7461 7475 735f 636f  if ret.status_co
+0001ebd0: 6465 2021 3d20 3230 303a 0a20 2020 2020  de != 200:.     
+0001ebe0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001ebf0: 2045 7863 6570 7469 6f6e 2829 0a20 2020   Exception().   
+0001ec00: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+0001ec10: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
+0001ec20: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+0001ec30: 2822 4361 7574 696f 6e21 2069 6d61 6765  ("Caution! image
+0001ec40: 2d65 7665 6e74 3a75 7269 2073 6574 2062  -event:uri set b
+0001ec50: 7574 206e 6f74 2072 6561 6368 6162 6c65  ut not reachable
+0001ec60: 2022 202b 206f 7369 735f 7572 6c29 0a20   " + osis_url). 
+0001ec70: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+0001ec80: 2e6c 6f67 2822 696d 6167 652d 6576 656e  .log("image-even
+0001ec90: 743a 7572 6920 7365 7420 746f 2022 202b  t:uri set to " +
+0001eca0: 206f 7369 735f 7572 6c29 0a0a 0a20 2020   osis_url)...   
+0001ecb0: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
+0001ecc0: 2020 2064 6566 2067 6574 5f6f 7369 735f     def get_osis_
+0001ecd0: 6576 656e 745f 7572 6c28 6578 7065 6469  event_url(expedi
+0001ece0: 7469 6f6e 5f69 643a 696e 742c 2065 7665  tion_id:int, eve
+0001ecf0: 6e74 5f6e 616d 653a 7374 7229 3a0a 2020  nt_name:str):.  
+0001ed00: 2020 2020 2020 2222 2220 5265 7475 726e        """ Return
+0001ed10: 7320 6f73 6973 2065 7665 6e74 2075 726c  s osis event url
+0001ed20: 2069 6620 6f73 6973 2065 7665 6e74 2069   if osis event i
+0001ed30: 6420 6361 6e20 6265 2073 7563 6365 7373  d can be success
+0001ed40: 6675 6c6c 7920 7265 7472 6965 7665 6420  fully retrieved 
+0001ed50: 6672 6f6d 2065 7665 6e74 5f6e 616d 652e  from event_name.
+0001ed60: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+0001ed70: 2022 2220 6966 206e 6f74 2073 7563 6365   "" if not succe
+0001ed80: 7373 7366 756c 2e20 2222 220a 2020 2020  sssful. """.    
+0001ed90: 2020 2020 6576 656e 745f 7572 6c20 3d20      event_url = 
+0001eda0: 2222 0a20 2020 2020 2020 2065 7665 6e74  "".        event
+0001edb0: 5f69 6473 203d 206d 6971 746f 7369 732e  _ids = miqtosis.
+0001edc0: 6765 745f 6578 7065 6469 7469 6f6e 5f65  get_expedition_e
+0001edd0: 7665 6e74 5f69 6473 2865 7870 6564 6974  vent_ids(expedit
+0001ede0: 696f 6e5f 6964 290a 0a20 2020 2020 2020  ion_id)..       
+0001edf0: 2065 7665 6e74 5f6e 616d 655f 6f70 7469   event_name_opti
+0001ee00: 6f6e 7320 3d20 5b65 7665 6e74 5f6e 616d  ons = [event_nam
+0001ee10: 655d 0a20 2020 2020 2020 2065 7665 6e74  e].        event
+0001ee20: 5f6e 616d 655f 6f70 7469 6f6e 732e 6170  _name_options.ap
+0001ee30: 7065 6e64 2865 7665 6e74 5f6e 616d 6529  pend(event_name)
+0001ee40: 0a20 2020 2020 2020 2023 2065 2e67 2e20  .        # e.g. 
+0001ee50: 4d31 3832 5f30 3430 2d31 5f58 4f46 4f53  M182_040-1_XOFOS
+0001ee60: 0a20 2020 2020 2020 206e 616d 655f 7370  .        name_sp
+0001ee70: 6c69 7420 3d20 6576 656e 745f 6e61 6d65  lit = event_name
+0001ee80: 2e73 706c 6974 2827 5f27 290a 2020 2020  .split('_').    
+0001ee90: 2020 2020 6966 206c 656e 286e 616d 655f      if len(name_
+0001eea0: 7370 6c69 7429 203e 3d20 323a 0a20 2020  split) >= 2:.   
+0001eeb0: 2020 2020 2020 2020 2065 7665 6e74 5f6e           event_n
+0001eec0: 616d 655f 6f70 7469 6f6e 732e 6170 7065  ame_options.appe
+0001eed0: 6e64 286e 616d 655f 7370 6c69 745b 315d  nd(name_split[1]
+0001eee0: 290a 2020 2020 2020 2020 2320 652e 672e  ).        # e.g.
+0001eef0: 204d 534d 3936 5f30 3033 5f41 5556 2d30   MSM96_003_AUV-0
+0001ef00: 310a 2020 2020 2020 2020 6966 206c 656e  1.        if len
+0001ef10: 286e 616d 655f 7370 6c69 7429 203e 3d20  (name_split) >= 
+0001ef20: 333a 0a20 2020 2020 2020 2020 2020 2065  3:.            e
+0001ef30: 7874 5f73 706c 6974 203d 206e 616d 655f  xt_split = name_
+0001ef40: 7370 6c69 745b 325d 2e73 706c 6974 2827  split[2].split('
+0001ef50: 2d27 290a 2020 2020 2020 2020 2020 2020  -').            
+0001ef60: 6966 206c 656e 2865 7874 5f73 706c 6974  if len(ext_split
+0001ef70: 2920 3d3d 2032 3a0a 2020 2020 2020 2020  ) == 2:.        
+0001ef80: 2020 2020 2020 2020 6576 656e 745f 6e61          event_na
+0001ef90: 6d65 5f6f 7074 696f 6e73 2e61 7070 656e  me_options.appen
+0001efa0: 6428 6e61 6d65 5f73 706c 6974 5b31 5d20  d(name_split[1] 
+0001efb0: 2b20 272d 2720 2b20 6578 745f 7370 6c69  + '-' + ext_spli
+0001efc0: 745b 315d 290a 2020 2020 2020 2020 6576  t[1]).        ev
+0001efd0: 656e 745f 6e61 6d65 5f6f 7074 696f 6e73  ent_name_options
+0001efe0: 5f30 7374 7269 7020 3d20 5b5d 0a20 2020  _0strip = [].   
+0001eff0: 2020 2020 2066 6f72 206e 616d 6520 696e       for name in
+0001f000: 2065 7665 6e74 5f6e 616d 655f 6f70 7469   event_name_opti
+0001f010: 6f6e 733a 0a20 2020 2020 2020 2020 2020  ons:.           
+0001f020: 2064 6173 685f 7370 6c69 7420 3d20 6e61   dash_split = na
+0001f030: 6d65 2e73 706c 6974 2827 2d27 290a 2020  me.split('-').  
+0001f040: 2020 2020 2020 2020 2020 6576 656e 745f            event_
+0001f050: 6e61 6d65 5f6f 7074 696f 6e73 5f30 7374  name_options_0st
+0001f060: 7269 702e 6170 7065 6e64 2827 2d27 2e6a  rip.append('-'.j
+0001f070: 6f69 6e28 5b65 2e6c 7374 7269 7028 2730  oin([e.lstrip('0
+0001f080: 2729 2066 6f72 2065 2069 6e20 6461 7368  ') for e in dash
+0001f090: 5f73 706c 6974 5d29 290a 2020 2020 2020  _split])).      
+0001f0a0: 2020 6576 656e 745f 6e61 6d65 5f6f 7074    event_name_opt
+0001f0b0: 696f 6e73 202b 3d20 6576 656e 745f 6e61  ions += event_na
+0001f0c0: 6d65 5f6f 7074 696f 6e73 5f30 7374 7269  me_options_0stri
+0001f0d0: 700a 2020 2020 2020 2020 666f 7220 6576  p.        for ev
+0001f0e0: 656e 745f 6e61 6d65 2069 6e20 6576 656e  ent_name in even
+0001f0f0: 745f 6e61 6d65 5f6f 7074 696f 6e73 3a0a  t_name_options:.
+0001f100: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+0001f110: 7665 6e74 5f6e 616d 6520 696e 2065 7665  vent_name in eve
+0001f120: 6e74 5f69 6473 3a0a 2020 2020 2020 2020  nt_ids:.        
+0001f130: 2020 2020 2020 2020 6576 656e 745f 7572          event_ur
+0001f140: 6c20 3d20 6d69 7174 6f73 6973 2e67 6574  l = miqtosis.get
+0001f150: 5f65 7665 6e74 5f75 726c 2865 7870 6564  _event_url(exped
+0001f160: 6974 696f 6e5f 6964 2c65 7665 6e74 5f69  ition_id,event_i
+0001f170: 6473 5b65 7665 6e74 5f6e 616d 655d 290a  ds[event_name]).
+0001f180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f190: 6272 6561 6b0a 2020 2020 2020 2020 0a20  break.        . 
+0001f1a0: 2020 2020 2020 2072 6574 7572 6e20 6576         return ev
+0001f1b0: 656e 745f 7572 6c0a 0a0a 2020 2020 4073  ent_url...    @s
+0001f1c0: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
+0001f1d0: 6465 6620 6765 745f 6c69 6365 6e73 655f  def get_license_
+0001f1e0: 7572 6928 6c69 6365 6e63 655f 6e61 6d65  uri(licence_name
+0001f1f0: 3a73 7472 293a 0a20 2020 2020 2020 2022  :str):.        "
+0001f200: 2222 2054 7269 6573 2074 6f20 6775 6573  "" Tries to gues
+0001f210: 7320 6c69 6365 6e63 6520 7572 6c20 6672  s licence url fr
+0001f220: 6f6d 206c 6963 656e 7365 206e 616d 6520  om license name 
+0001f230: 616e 6420 7265 7475 726e 7320 6974 2e20  and returns it. 
+0001f240: 5265 7475 726e 7320 2222 2069 6620 6661  Returns "" if fa
+0001f250: 696c 732e 2022 2222 0a20 2020 2020 2020  ils. """.       
+0001f260: 206c 6963 656e 7365 735f 6469 6374 203d   licenses_dict =
+0001f270: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
+0001f280: 6363 6279 223a 2022 6874 7470 733a 2f2f  ccby": "https://
+0001f290: 6372 6561 7469 7665 636f 6d6d 6f6e 732e  creativecommons.
+0001f2a0: 6f72 672f 6c69 6365 6e73 6573 2f62 792f  org/licenses/by/
+0001f2b0: 342e 302f 6c65 6761 6c63 6f64 6522 2c0a  4.0/legalcode",.
+0001f2c0: 2020 2020 2020 2020 2020 2020 2263 6330              "cc0
+0001f2d0: 223a 2022 6874 7470 733a 2f2f 6372 6561  ": "https://crea
+0001f2e0: 7469 7665 636f 6d6d 6f6e 732e 6f72 672f  tivecommons.org/
+0001f2f0: 7075 626c 6963 646f 6d61 696e 2f7a 6572  publicdomain/zer
+0001f300: 6f2f 312e 302f 6c65 6761 6c63 6f64 6522  o/1.0/legalcode"
+0001f310: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
+0001f320: 2020 2063 6c65 616e 645f 6c69 6365 6e73     cleand_licens
+0001f330: 6520 3d20 6c69 6365 6e63 655f 6e61 6d65  e = licence_name
+0001f340: 2e73 7472 6970 2829 2e6c 6f77 6572 2829  .strip().lower()
+0001f350: 2e72 6570 6c61 6365 2827 2d27 2c20 2727  .replace('-', ''
+0001f360: 290a 2020 2020 2020 2020 6966 2063 6c65  ).        if cle
+0001f370: 616e 645f 6c69 6365 6e73 6520 696e 206c  and_license in l
+0001f380: 6963 656e 7365 735f 6469 6374 3a0a 2020  icenses_dict:.  
+0001f390: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001f3a0: 206c 6963 656e 7365 735f 6469 6374 5b63   licenses_dict[c
+0001f3b0: 6c65 616e 645f 6c69 6365 6e73 655d 0a20  leand_license]. 
+0001f3c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001f3d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001f3e0: 2222 0a0a 0a20 2020 2040 7374 6174 6963  ""...    @static
+0001f3f0: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
+0001f400: 6574 5f6c 6963 656e 7365 5f75 7269 5f74  et_license_uri_t
+0001f410: 6f5f 6c69 6365 6e73 6528 6966 646f 3a64  o_license(ifdo:d
+0001f420: 6963 7429 3a0a 2020 2020 2020 2020 2222  ict):.        ""
+0001f430: 2220 5265 7475 726e 7320 6865 6164 6572  " Returns header
+0001f440: 2069 6d61 6765 2d6c 6963 656e 7365 2075   image-license u
+0001f450: 7269 2067 7565 7373 6564 2066 726f 6d20  ri guessed from 
+0001f460: 6c69 6365 6e73 6520 6e61 6d65 2e20 5265  license name. Re
+0001f470: 7475 726e 7320 656d 7074 7920 7374 7269  turns empty stri
+0001f480: 6e67 2069 6620 6661 696c 732e 2022 2222  ng if fails. """
+0001f490: 0a20 2020 2020 2020 2069 6d61 6765 5f6c  .        image_l
+0001f4a0: 6963 656e 7365 203d 2069 4644 4f2e 6669  icense = iFDO.fi
+0001f4b0: 6e64 5f66 6965 6c64 5f73 7472 2869 6664  nd_field_str(ifd
+0001f4c0: 6f2c 2027 696d 6167 652d 6c69 6365 6e73  o, 'image-licens
+0001f4d0: 6527 290a 2020 2020 2020 2020 6966 2069  e').        if i
+0001f4e0: 7369 6e73 7461 6e63 6528 696d 6167 655f  sinstance(image_
+0001f4f0: 6c69 6365 6e73 652c 2064 6963 7429 3a0a  license, dict):.
+0001f500: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001f510: 726e 2069 4644 4f2e 6765 745f 6c69 6365  rn iFDO.get_lice
+0001f520: 6e73 655f 7572 6928 696d 6167 655f 6c69  nse_uri(image_li
+0001f530: 6365 6e73 655b 276e 616d 6527 5d29 0a20  cense['name']). 
+0001f540: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001f550: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001f560: 6946 444f 2e67 6574 5f6c 6963 656e 7365  iFDO.get_license
+0001f570: 5f75 7269 2869 6d61 6765 5f6c 6963 656e  _uri(image_licen
+0001f580: 7365 290a 0a0a 2020 2020 6465 6620 7365  se)...    def se
+0001f590: 745f 6c69 6365 6e73 655f 7572 695f 6672  t_license_uri_fr
+0001f5a0: 6f6d 5f6c 6963 656e 7365 5f6e 616d 6528  om_license_name(
+0001f5b0: 7365 6c66 2c20 6f76 6572 7269 6465 3a62  self, override:b
+0001f5c0: 6f6f 6c20 3d20 4661 6c73 6529 3a0a 2020  ool = False):.  
+0001f5d0: 2020 2020 2020 2222 2220 5365 7473 2068        """ Sets h
+0001f5e0: 6561 6465 7220 696d 6167 652d 6c69 6365  eader image-lice
+0001f5f0: 6e73 6520 7572 6920 746f 2075 726c 2067  nse uri to url g
+0001f600: 7565 7373 6564 2066 726f 6d20 696d 6167  uessed from imag
+0001f610: 652d 6c69 6365 6e73 652e 0a20 2020 2020  e-license..     
+0001f620: 2020 2050 6172 616d 733a 0a20 2020 2020     Params:.     
+0001f630: 2020 2020 2020 206f 7665 7272 6964 653a         override:
+0001f640: 2069 6620 4661 6c73 6520 7365 7420 6f6e   if False set on
+0001f650: 6c79 2069 6620 7572 6920 6973 2065 6d70  ly if uri is emp
+0001f660: 7479 206f 7220 646f 6573 206e 6f74 2065  ty or does not e
+0001f670: 7869 7374 2e20 2222 220a 2020 2020 2020  xist. """.      
+0001f680: 2020 0a20 2020 2020 2020 2069 6620 6e6f    .        if no
+0001f690: 7420 6f76 6572 7269 6465 2061 6e64 2073  t override and s
+0001f6a0: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
+0001f6b0: 3228 2769 6d61 6765 2d6c 6963 656e 7365  2('image-license
+0001f6c0: 3a75 7269 2729 2021 3d20 2222 3a0a 2020  :uri') != "":.  
+0001f6d0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0001f6e0: 726f 762e 6c6f 6728 2243 6175 7469 6f6e  rov.log("Caution
+0001f6f0: 2120 696d 6167 652d 6c69 6365 6e73 653a  ! image-license:
+0001f700: 7572 6920 616c 7265 6164 7920 6578 6973  uri already exis
+0001f710: 7473 2061 6e64 2069 7320 6e6f 7420 6f76  ts and is not ov
+0001f720: 6572 7269 6464 656e 3a20 2220 2b20 7365  erridden: " + se
+0001f730: 6c66 2e66 696e 6454 6d70 4669 656c 6432  lf.findTmpField2
+0001f740: 2827 696d 6167 652d 6c69 6365 6e73 653a  ('image-license:
+0001f750: 7572 6927 2929 0a20 2020 2020 2020 2020  uri')).         
+0001f760: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+0001f770: 2020 0a20 2020 2020 2020 206c 6963 656e    .        licen
+0001f780: 7365 5f75 726c 203d 2073 656c 662e 6765  se_url = self.ge
+0001f790: 745f 6c69 6365 6e73 655f 7572 695f 746f  t_license_uri_to
+0001f7a0: 5f6c 6963 656e 7365 2873 656c 662e 6966  _license(self.if
+0001f7b0: 646f 5f74 6d70 290a 2020 2020 2020 2020  do_tmp).        
+0001f7c0: 6966 206c 6963 656e 7365 5f75 726c 203d  if license_url =
+0001f7d0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
+0001f7e0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+0001f7f0: 2257 6172 6e69 6e67 2120 4361 6e27 7420  "Warning! Can't 
+0001f800: 6775 6573 7320 696d 6167 652d 6c69 6365  guess image-lice
+0001f810: 6e73 653a 7572 6920 6672 6f6d 206e 616d  nse:uri from nam
+0001f820: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
+0001f830: 7265 7475 726e 0a20 2020 2020 2020 2073  return.        s
+0001f840: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+0001f850: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0001f860: 4b65 795d 5b27 696d 6167 652d 6c69 6365  Key]['image-lice
+0001f870: 6e73 6527 5d5b 2775 7269 275d 203d 206c  nse']['uri'] = l
+0001f880: 6963 656e 7365 5f75 726c 0a20 2020 2020  icense_url.     
+0001f890: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001f8a0: 2020 2020 7265 7420 3d20 7265 7175 6573      ret = reques
+0001f8b0: 7473 2e68 6561 6428 6c69 6365 6e73 655f  ts.head(license_
+0001f8c0: 7572 6c29 0a20 2020 2020 2020 2020 2020  url).           
+0001f8d0: 2069 6620 7265 742e 7374 6174 7573 5f63   if ret.status_c
+0001f8e0: 6f64 6520 213d 2032 3030 3a0a 2020 2020  ode != 200:.    
+0001f8f0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0001f900: 6520 4578 6365 7074 696f 6e28 290a 2020  e Exception().  
+0001f910: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+0001f920: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+0001f930: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+0001f940: 6728 2243 6175 7469 6f6e 2120 696d 6167  g("Caution! imag
+0001f950: 652d 6c69 6365 6e73 653a 7572 6920 7365  e-license:uri se
+0001f960: 7420 6275 7420 6e6f 7420 7265 6163 6861  t but not reacha
+0001f970: 626c 6520 2220 2b20 6c69 6365 6e73 655f  ble " + license_
+0001f980: 7572 6c29 0a20 2020 2020 2020 2073 656c  url).        sel
+0001f990: 662e 7072 6f76 2e6c 6f67 2822 696d 6167  f.prov.log("imag
+0001f9a0: 652d 6c69 6365 6e73 653a 7572 6920 7365  e-license:uri se
+0001f9b0: 7420 746f 2022 202b 206c 6963 656e 7365  t to " + license
+0001f9c0: 5f75 726c 290a 0a0a 2020 2020 6465 6620  _url)...    def 
+0001f9d0: 696e 7465 726d 6564 6961 7465 4e61 7646  intermediateNavF
+0001f9e0: 696c 6545 7869 7374 7328 7365 6c66 293a  ileExists(self):
+0001f9f0: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
+0001fa00: 6174 682e 6578 6973 7473 2873 656c 662e  ath.exists(self.
+0001fa10: 6765 745f 696e 745f 6e61 765f 6669 6c65  get_int_nav_file
+0001fa20: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
+0001fa30: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
+0001fa40: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001fa50: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+0001fa60: 6c73 650a 0a0a 2020 2020 6465 6620 6865  lse...    def he
+0001fa70: 6164 6572 4669 656c 6446 696c 6c65 6428  aderFieldFilled(
+0001fa80: 7365 6c66 2c66 6965 6c64 3a73 7472 293a  self,field:str):
+0001fa90: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0001faa0: 2e66 696e 6454 6d70 4669 656c 6432 2866  .findTmpField2(f
+0001fab0: 6965 6c64 2920 3d3d 2022 223a 0a20 2020  ield) == "":.   
+0001fac0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001fad0: 4661 6c73 650a 2020 2020 2020 2020 7265  False.        re
+0001fae0: 7475 726e 2054 7275 650a 0a20 2020 2064  turn True..    d
+0001faf0: 6566 2063 6f6e 7665 7274 546f 4465 6661  ef convertToDefa
+0001fb00: 756c 7444 6174 6554 696d 6546 6f72 6d61  ultDateTimeForma
+0001fb10: 7428 7365 6c66 2c69 6664 6f29 3a0a 2020  t(self,ifdo):.  
+0001fb20: 2020 2020 2020 2222 2220 4368 6563 6b73        """ Checks
+0001fb30: 2069 6620 616c 6c20 6974 656d 7327 2027   if all items' '
+0001fb40: 696d 6167 652d 6461 7465 7469 6d65 2720  image-datetime' 
+0001fb50: 6669 656c 6473 206d 6174 6368 2064 6566  fields match def
+0001fb60: 6175 6c74 2064 6174 6574 696d 6520 666f  ault datetime fo
+0001fb70: 726d 6174 206f 7220 6120 6375 7374 6f6d  rmat or a custom
+0001fb80: 206f 6e65 2064 6566 696e 6564 2069 6e20   one defined in 
+0001fb90: 2769 6d61 6765 2d64 6174 6574 696d 652d  'image-datetime-
+0001fba0: 666f 726d 6174 270a 2020 2020 2020 2020  format'.        
+0001fbb0: 2020 2020 616e 6420 636f 6e76 6572 7473      and converts
+0001fbc0: 2074 6f20 6465 6661 756c 7420 666f 726d   to default form
+0001fbd0: 6174 2e20 5468 726f 7773 2065 7863 6570  at. Throws excep
+0001fbe0: 7469 6f6e 2069 6620 6461 7465 7469 6d65  tion if datetime
+0001fbf0: 2063 616e 6e6f 7420 6265 2070 6172 7365   cannot be parse
+0001fc00: 6420 2222 220a 2020 2020 2020 2020 6375  d """.        cu
+0001fc10: 7374 6f6d 4461 7465 5469 6d65 466f 726d  stomDateTimeForm
+0001fc20: 6174 466f 756e 6420 3d20 4661 6c73 650a  atFound = False.
+0001fc30: 2020 2020 2020 2020 6865 6164 6572 4375          headerCu
+0001fc40: 7374 6f6d 4461 7465 5469 6d65 466f 726d  stomDateTimeForm
+0001fc50: 6174 203d 2066 696e 6446 6965 6c64 2869  at = findField(i
+0001fc60: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
+0001fc70: 7448 6561 6465 724b 6579 5d2c 2769 6d61  tHeaderKey],'ima
+0001fc80: 6765 2d64 6174 6574 696d 652d 666f 726d  ge-datetime-form
+0001fc90: 6174 2729 0a20 2020 2020 2020 2069 6620  at').        if 
+0001fca0: 6865 6164 6572 4375 7374 6f6d 4461 7465  headerCustomDate
+0001fcb0: 5469 6d65 466f 726d 6174 2021 3d20 2222  TimeFormat != ""
+0001fcc0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0001fcd0: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
+0001fce0: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
+0001fcf0: 652d 6461 7465 7469 6d65 2d66 6f72 6d61  e-datetime-forma
+0001fd00: 7427 5d20 3d20 2222 2023 2072 656d 6f76  t'] = "" # remov
+0001fd10: 6520 6375 7374 6f6d 2066 6f72 6d61 740a  e custom format.
+0001fd20: 2020 2020 2020 2020 2020 2020 6375 7374              cust
+0001fd30: 6f6d 4461 7465 5469 6d65 466f 726d 6174  omDateTimeFormat
+0001fd40: 466f 756e 6420 3d20 5472 7565 0a20 2020  Found = True.   
+0001fd50: 2020 2020 2070 726f 6720 3d20 6d69 7174       prog = miqt
+0001fd60: 632e 5072 696e 744b 6e6f 776e 5072 6f67  c.PrintKnownProg
+0001fd70: 7265 7373 4d73 6728 2243 6865 636b 696e  ressMsg("Checkin
+0001fd80: 6720 6461 7465 7469 6d65 2066 6f72 6d61  g datetime forma
+0001fd90: 7422 2c20 6c65 6e28 6966 646f 5b73 656c  t", len(ifdo[sel
+0001fda0: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
+0001fdb0: 6579 5d29 2c6d 6f64 756c 6f3d 3130 290a  ey]),modulo=10).
+0001fdc0: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+0001fdd0: 2c69 7465 6d20 696e 2069 6664 6f5b 7365  ,item in ifdo[se
+0001fde0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+0001fdf0: 4b65 795d 2e69 7465 6d73 2829 3a0a 2020  Key].items():.  
+0001fe00: 2020 2020 2020 2020 2020 7072 6f67 2e70            prog.p
+0001fe10: 726f 6772 6573 7328 290a 2020 2020 2020  rogress().      
+0001fe20: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0001fe30: 6e73 7461 6e63 6528 6974 656d 2c6c 6973  nstance(item,lis
+0001fe40: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0001fe50: 2020 2020 2020 2020 6974 656d 203d 205b          item = [
+0001fe60: 6974 656d 5d0a 2020 2020 2020 2020 2020  item].          
+0001fe70: 2020 7375 6249 7465 6d44 6566 6175 6c74    subItemDefault
+0001fe80: 203d 2069 7465 6d5b 305d 0a20 2020 2020   = item[0].     
+0001fe90: 2020 2020 2020 2069 7465 6d43 7573 746f         itemCusto
+0001fea0: 6d44 6174 6554 696d 6546 6f72 6d61 7420  mDateTimeFormat 
+0001feb0: 3d20 2222 0a20 2020 2020 2020 2020 2020  = "".           
+0001fec0: 2069 6620 2769 6d61 6765 2d64 6174 6574   if 'image-datet
+0001fed0: 696d 652d 666f 726d 6174 2720 696e 2073  ime-format' in s
+0001fee0: 7562 4974 656d 4465 6661 756c 743a 0a20  ubItemDefault:. 
+0001fef0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001ff00: 7465 6d43 7573 746f 6d44 6174 6554 696d  temCustomDateTim
+0001ff10: 6546 6f72 6d61 7420 3d20 7375 6249 7465  eFormat = subIte
+0001ff20: 6d44 6566 6175 6c74 5b27 696d 6167 652d  mDefault['image-
+0001ff30: 6461 7465 7469 6d65 2d66 6f72 6d61 7427  datetime-format'
+0001ff40: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001ff50: 2020 7375 6249 7465 6d44 6566 6175 6c74    subItemDefault
+0001ff60: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
+0001ff70: 2d66 6f72 6d61 7427 5d20 3d20 2222 2023  -format'] = "" #
+0001ff80: 2072 656d 6f76 6520 6375 7374 6f6d 2066   remove custom f
+0001ff90: 6f72 6d61 740a 2020 2020 2020 2020 2020  ormat.          
+0001ffa0: 2020 2020 2020 6375 7374 6f6d 4461 7465        customDate
+0001ffb0: 5469 6d65 466f 726d 6174 466f 756e 6420  TimeFormatFound 
+0001ffc0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+0001ffd0: 2020 2066 6f72 2073 7562 4974 656d 2069     for subItem i
+0001ffe0: 6e20 6974 656d 3a0a 2020 2020 2020 2020  n item:.        
+0001fff0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00020000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020010: 2066 6f72 6d61 7420 3d20 6d69 7174 762e   format = miqtv.
+00020020: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
+00020030: 7269 7174 275d 0a20 2020 2020 2020 2020  riqt'].         
+00020040: 2020 2020 2020 2020 2020 2064 6174 6574             datet
+00020050: 696d 652e 6461 7465 7469 6d65 2e73 7472  ime.datetime.str
+00020060: 7074 696d 6528 7375 6249 7465 6d5b 2769  ptime(subItem['i
+00020070: 6d61 6765 2d64 6174 6574 696d 6527 5d2c  mage-datetime'],
+00020080: 666f 726d 6174 290a 2020 2020 2020 2020  format).        
+00020090: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
+000200a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000200b0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+000200c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000200d0: 2066 6f72 6d61 7420 3d20 6865 6164 6572   format = header
+000200e0: 4375 7374 6f6d 4461 7465 5469 6d65 466f  CustomDateTimeFo
+000200f0: 726d 6174 0a20 2020 2020 2020 2020 2020  rmat.           
+00020100: 2020 2020 2020 2020 2020 2020 2064 7420               dt 
+00020110: 3d20 6461 7465 7469 6d65 2e64 6174 6574  = datetime.datet
+00020120: 696d 652e 7374 7270 7469 6d65 2873 7562  ime.strptime(sub
+00020130: 4974 656d 5b27 696d 6167 652d 6461 7465  Item['image-date
+00020140: 7469 6d65 275d 2c66 6f72 6d61 7429 0a20  time'],format). 
+00020150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020160: 2020 2020 2020 2073 7562 4974 656d 5b27         subItem['
+00020170: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
+00020180: 203d 2064 6174 6574 696d 652e 6461 7465   = datetime.date
+00020190: 7469 6d65 2e73 7472 6674 696d 6528 6474  time.strftime(dt
+000201a0: 2c6d 6971 7476 2e64 6174 655f 666f 726d  ,miqtv.date_form
+000201b0: 6174 735b 276d 6172 6971 7427 5d29 0a20  ats['mariqt']). 
+000201c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000201d0: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
+000201e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000201f0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00020200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020210: 2020 2020 666f 726d 6174 203d 2069 7465      format = ite
+00020220: 6d43 7573 746f 6d44 6174 6554 696d 6546  mCustomDateTimeF
+00020230: 6f72 6d61 740a 2020 2020 2020 2020 2020  ormat.          
+00020240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020250: 2020 6474 203d 2064 6174 6574 696d 652e    dt = datetime.
+00020260: 6461 7465 7469 6d65 2e73 7472 7074 696d  datetime.strptim
+00020270: 6528 7375 6249 7465 6d5b 2769 6d61 6765  e(subItem['image
+00020280: 2d64 6174 6574 696d 6527 5d2c 666f 726d  -datetime'],form
+00020290: 6174 290a 2020 2020 2020 2020 2020 2020  at).            
+000202a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000202b0: 7375 6249 7465 6d5b 2769 6d61 6765 2d64  subItem['image-d
+000202c0: 6174 6574 696d 6527 5d20 3d20 6461 7465  atetime'] = date
+000202d0: 7469 6d65 2e64 6174 6574 696d 652e 7374  time.datetime.st
+000202e0: 7266 7469 6d65 2864 742c 6d69 7174 762e  rftime(dt,miqtv.
+000202f0: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
+00020300: 7269 7174 275d 290a 2020 2020 2020 2020  riqt']).        
+00020310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020320: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+00020330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020340: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
+00020350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020360: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00020370: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
+00020380: 6570 7469 6f6e 2827 496e 7661 6c69 6420  eption('Invalid 
+00020390: 6461 7465 7469 6d65 2076 616c 7565 272c  datetime value',
+000203a0: 7375 6249 7465 6d5b 2769 6d61 6765 2d64  subItem['image-d
+000203b0: 6174 6574 696d 6527 5d2c 2022 646f 6573  atetime'], "does
+000203c0: 206e 6f74 206d 6174 6368 2066 6f72 6d61   not match forma
+000203d0: 7420 6465 6661 756c 7420 6f72 2063 7573  t default or cus
+000203e0: 746f 6d20 666f 726d 6174 2229 0a20 2020  tom format").   
+000203f0: 2020 2020 2069 6620 6375 7374 6f6d 4461       if customDa
+00020400: 7465 5469 6d65 466f 726d 6174 466f 756e  teTimeFormatFoun
+00020410: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
+00020420: 656c 662e 7072 6f76 2e6c 6f67 2822 4375  elf.prov.log("Cu
+00020430: 7374 6f6d 2064 6174 6574 696d 6520 666f  stom datetime fo
+00020440: 726d 6174 7320 666f 756e 642e 2054 6865  rmats found. The
+00020450: 7920 7769 6c6c 2062 6520 7265 706c 6163  y will be replac
+00020460: 6564 2062 7920 7468 6520 6465 6661 756c  ed by the defaul
+00020470: 7420 666f 726d 6174 2e22 2920 2020 0a20  t format.")   . 
+00020480: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
+00020490: 7228 2920 2020 200a 0a0a 2020 2020 6465  r()    ...    de
+000204a0: 6620 5f5f 696e 6974 496e 7465 726d 6564  f __initIntermed
+000204b0: 6961 7465 4669 6c65 7328 7365 6c66 293a  iateFiles(self):
+000204c0: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
+000204d0: 7465 726d 6564 6961 7465 4669 6c65 7344  termediateFilesD
+000204e0: 6566 5f63 6f72 6520 3d20 7b0a 2020 2020  ef_core = {.    
+000204f0: 2020 2020 2020 2020 2768 6173 6865 7327          'hashes'
+00020500: 3a20 7b0a 2020 2020 2020 2020 2020 2020  : {.            
+00020510: 2020 2020 2763 7265 6174 696f 6e46 6374      'creationFct
+00020520: 273a 2027 6372 6561 7465 5f69 6d61 6765  ': 'create_image
+00020530: 5f73 6861 3235 365f 6669 6c65 2829 272c  _sha256_file()',
+00020540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020550: 2027 7375 6666 6978 273a 2027 5f69 6d61   'suffix': '_ima
+00020560: 6765 2d68 6173 6865 732e 7478 7427 2c0a  ge-hashes.txt',.
+00020570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020580: 2763 6f6c 7327 3a20 5b6d 6971 7476 2e63  'cols': [miqtv.c
+00020590: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+000205a0: 7427 5d5b 2768 6173 6827 5d5d 2c0a 2020  t']['hash']],.  
+000205b0: 2020 2020 2020 2020 2020 2020 2020 276f                'o
+000205c0: 7074 696f 6e61 6c27 3a20 5b5d 7d2c 0a20  ptional': []},. 
+000205d0: 2020 2020 2020 2020 2020 2027 7575 6964             'uuid
+000205e0: 7327 3a20 7b0a 2020 2020 2020 2020 2020  s': {.          
+000205f0: 2020 2020 2020 2763 7265 6174 696f 6e46        'creationF
+00020600: 6374 273a 2027 6372 6561 7465 5f75 7569  ct': 'create_uui
+00020610: 645f 6669 6c65 2829 272c 0a20 2020 2020  d_file()',.     
+00020620: 2020 2020 2020 2020 2020 2027 7375 6666             'suff
+00020630: 6978 273a 2027 5f69 6d61 6765 2d75 7569  ix': '_image-uui
+00020640: 6473 2e74 7874 272c 0a20 2020 2020 2020  ds.txt',.       
+00020650: 2020 2020 2020 2020 2027 636f 6c73 273a           'cols':
+00020660: 205b 6d69 7174 762e 636f 6c5f 6865 6164   [miqtv.col_head
+00020670: 6572 5b27 6d61 7269 7174 275d 5b27 7575  er['mariqt']['uu
+00020680: 6964 275d 5d2c 0a20 2020 2020 2020 2020  id']],.         
+00020690: 2020 2020 2020 2027 6f70 7469 6f6e 616c         'optional
+000206a0: 273a 205b 5d7d 2c0a 2020 2020 2020 2020  ': []},.        
+000206b0: 2020 2020 2764 6174 6574 696d 6527 3a20      'datetime': 
+000206c0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+000206d0: 2020 2763 7265 6174 696f 6e46 6374 273a    'creationFct':
+000206e0: 2027 6372 6561 7465 5f73 7461 7274 5f74   'create_start_t
+000206f0: 696d 655f 6669 6c65 2829 272c 0a20 2020  ime_file()',.   
+00020700: 2020 2020 2020 2020 2020 2020 2027 7375               'su
+00020710: 6666 6978 273a 2027 5f69 6d61 6765 2d73  ffix': '_image-s
+00020720: 7461 7274 2d74 696d 6573 2e74 7874 272c  tart-times.txt',
+00020730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020740: 2027 636f 6c73 273a 205b 6d69 7174 762e   'cols': [miqtv.
+00020750: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00020760: 7174 275d 5b27 7574 6327 5d5d 2c0a 2020  qt']['utc']],.  
+00020770: 2020 2020 2020 2020 2020 2020 2020 276f                'o
+00020780: 7074 696f 6e61 6c27 3a20 5b5d 7d2c 0a20  ptional': []},. 
+00020790: 2020 2020 2020 2020 2020 2027 6e61 7669             'navi
+000207a0: 6761 7469 6f6e 273a 207b 0a20 2020 2020  gation': {.     
+000207b0: 2020 2020 2020 2020 2020 2027 6372 6561             'crea
+000207c0: 7469 6f6e 4663 7427 3a20 2763 7265 6174  tionFct': 'creat
+000207d0: 655f 696d 6167 655f 6e61 7669 6761 7469  e_image_navigati
+000207e0: 6f6e 5f66 696c 6528 2927 2c0a 2020 2020  on_file()',.    
+000207f0: 2020 2020 2020 2020 2020 2020 2773 7566              'suf
+00020800: 6669 7827 3a20 275f 696d 6167 652d 6e61  fix': '_image-na
+00020810: 7669 6761 7469 6f6e 2e74 7874 272c 0a20  vigation.txt',. 
+00020820: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00020830: 636f 6c73 273a 205b 6d69 7174 762e 636f  cols': [miqtv.co
+00020840: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00020850: 275d 5b27 7574 6327 5d5d 2c0a 2020 2020  ']['utc']],.    
+00020860: 2020 2020 2020 2020 2020 2020 276f 7074              'opt
+00020870: 696f 6e61 6c27 3a20 5b6d 6971 7476 2e63  ional': [miqtv.c
+00020880: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00020890: 7427 5d5b 276c 6f6e 275d 2c20 6d69 7174  t']['lon'], miqt
+000208a0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+000208b0: 7269 7174 275d 5b27 6c61 7427 5d2c 206d  riqt']['lat'], m
+000208c0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+000208d0: 276d 6172 6971 7427 5d5b 2761 6c74 275d  'mariqt']['alt']
+000208e0: 2c20 6d69 7174 762e 636f 6c5f 6865 6164  , miqtv.col_head
+000208f0: 6572 5b27 6d61 7269 7174 275d 5b27 6867  er['mariqt']['hg
+00020900: 7427 5d2c 206d 6971 7476 2e63 6f6c 5f68  t'], miqtv.col_h
+00020910: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00020920: 2775 6e63 6572 7427 5d5d 7d2c 0a20 2020  'uncert']]},.   
+00020930: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+00020940: 7365 6c66 2e6e 6f6e 436f 7265 4669 656c  self.nonCoreFiel
+00020950: 6449 6e74 6572 6d65 6469 6174 6549 7465  dIntermediateIte
+00020960: 6d49 6e66 6f46 696c 6573 203d 205b 5d0a  mInfoFiles = [].
+00020970: 0a20 2020 2064 6566 205f 5f67 6574 5f69  .    def __get_i
+00020980: 6e74 5f66 696c 655f 7072 6566 6978 2873  nt_file_prefix(s
+00020990: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+000209a0: 2220 6465 7065 6e64 7320 6f6e 2027 696d  " depends on 'im
+000209b0: 6167 652d 6576 656e 7427 2061 6e64 2027  age-event' and '
+000209c0: 696d 6167 652d 7365 6e73 6f72 2720 736f  image-sensor' so
+000209d0: 2069 7420 6361 6e20 6368 616e 6765 2064   it can change d
+000209e0: 7572 696e 6720 7570 6174 6520 2222 220a  uring upate """.
+000209f0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+00020a00: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
+00020a10: 2e64 6972 2e74 6f28 7365 6c66 2e64 6972  .dir.to(self.dir
+00020a20: 2e64 742e 696e 7465 726d 6564 6961 7465  .dt.intermediate
+00020a30: 292c 2073 656c 662e 6669 6e64 546d 7046  ), self.findTmpF
+00020a40: 6965 6c64 2827 696d 6167 652d 7365 742d  ield('image-set-
+00020a50: 6e61 6d65 2729 290a 0a20 2020 2064 6566  name'))..    def
+00020a60: 2067 6574 5f69 6e74 5f68 6173 685f 6669   get_int_hash_fi
+00020a70: 6c65 2873 656c 6629 3a0a 2020 2020 2020  le(self):.      
+00020a80: 2020 7265 7475 726e 2073 656c 662e 5f5f    return self.__
+00020a90: 6765 745f 696e 745f 6669 6c65 5f70 7265  get_int_file_pre
+00020aa0: 6669 7828 2920 2b20 7365 6c66 2e69 6e74  fix() + self.int
+00020ab0: 6572 6d65 6469 6174 6546 696c 6573 4465  ermediateFilesDe
+00020ac0: 665f 636f 7265 5b27 6861 7368 6573 275d  f_core['hashes']
+00020ad0: 5b27 7375 6666 6978 275d 0a0a 2020 2020  ['suffix']..    
+00020ae0: 6465 6620 6765 745f 696e 745f 7575 6964  def get_int_uuid
+00020af0: 5f66 696c 6528 7365 6c66 293a 0a20 2020  _file(self):.   
+00020b00: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00020b10: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
+00020b20: 7072 6566 6978 2829 202b 2073 656c 662e  prefix() + self.
+00020b30: 696e 7465 726d 6564 6961 7465 4669 6c65  intermediateFile
+00020b40: 7344 6566 5f63 6f72 655b 2775 7569 6473  sDef_core['uuids
+00020b50: 275d 5b27 7375 6666 6978 275d 0a0a 2020  ']['suffix']..  
+00020b60: 2020 6465 6620 6765 745f 696e 745f 7374    def get_int_st
+00020b70: 6172 7454 696d 6573 5f66 696c 6528 7365  artTimes_file(se
+00020b80: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+00020b90: 7572 6e20 7365 6c66 2e5f 5f67 6574 5f69  urn self.__get_i
+00020ba0: 6e74 5f66 696c 655f 7072 6566 6978 2829  nt_file_prefix()
+00020bb0: 202b 2073 656c 662e 696e 7465 726d 6564   + self.intermed
+00020bc0: 6961 7465 4669 6c65 7344 6566 5f63 6f72  iateFilesDef_cor
+00020bd0: 655b 2764 6174 6574 696d 6527 5d5b 2773  e['datetime']['s
+00020be0: 7566 6669 7827 5d0a 0a20 2020 2064 6566  uffix']..    def
+00020bf0: 2067 6574 5f69 6e74 5f6e 6176 5f66 696c   get_int_nav_fil
+00020c00: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+00020c10: 2072 6574 7572 6e20 7365 6c66 2e5f 5f67   return self.__g
+00020c20: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
+00020c30: 6978 2829 202b 2073 656c 662e 696e 7465  ix() + self.inte
+00020c40: 726d 6564 6961 7465 4669 6c65 7344 6566  rmediateFilesDef
+00020c50: 5f63 6f72 655b 276e 6176 6967 6174 696f  _core['navigatio
+00020c60: 6e27 5d5b 2773 7566 6669 7827 5d0a 0a    n']['suffix']..
```

## Comparing `mariqt-0.6.8.dist-info/LICENSE` & `mariqt-0.6.9.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `mariqt-0.6.8.dist-info/METADATA` & `mariqt-0.6.9.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mariqt
-Version: 0.6.8
+Version: 0.6.9
 Summary: The MareHub & Marine Imaging Community Image QA/QC and curation toolbox
 Author: Timm Schoening
 Author-email: tschoening@geomar.de
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: GNU General Public License v3 (GPLv3)
 Classifier: Operating System :: OS Independent
 License-File: LICENSE
```

## Comparing `mariqt-0.6.8.dist-info/RECORD` & `mariqt-0.6.9.dist-info/RECORD`

 * *Files 11% similar despite different names*

```diff
@@ -8,25 +8,25 @@
 mariqt/misc.py,sha256=BF_ItP_gnkS1Z6zb9P7O4cRi3XMgJR-Bm2OmzX7AK9M,3090
 mariqt/navigation.py,sha256=TdboYcC1RjXiJT_2WrkyC2FgR8szpBib1xlQ2w0efdk,40982
 mariqt/provenance.py,sha256=daR6sIK6tSFaBsanKvIuFyjR78NNOTzd4N3AdQRxdFw,7345
 mariqt/reports.py,sha256=YP03HvFe0BG0y4efvQhRpeGifijqqPpCB_gg4qX-MVw,22316
 mariqt/settings.py,sha256=bqjUJnTiKwFsbGP4cRQiwHQhsTi4191pb36R8GSKp58,4376
 mariqt/tests.py,sha256=IuXF7-ziBziKNC5boDm7ReWrsKpya_kkNuysFjgSW7c,9514
 mariqt/variables.py,sha256=0usg_MFwjMj558nPAXnnzDokY3XaqLF5-ASmw0Tqd2A,9614
-mariqt/version.py,sha256=45VZa7WiiyMfnHV3wXd7OZeYUr3Ri5EgvBPDQfyUAPc,21
+mariqt/version.py,sha256=lEtimanQ0QAPuS726x3QKLw8JEsmMwu5HCL_oPsQ2nc,21
 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json,sha256=HyHwLO2Wc6KWE3YBctExeEHtDNz4HQldPkczvTdpFp0,6175
 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.1.json,sha256=Y9mhQtihiPBVb_VbjAjXJY7nKNelUCwJtxftHJCKOqc,42625
 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json,sha256=krwoig3eWpFjG61HIsdX7N-7QXFJ3v9mRZ63vham7rM,3218
 mariqt/sources/dship.py,sha256=5PxhsraSImnSchTG0h0HlLHorJQZPSDSOzspRGhD6bg,12135
 mariqt/sources/dship_settings.py,sha256=2vAlW0oh4iHwRCkBQnbCZ4yhXNzVi7aKPnqNrN5RwI0,4684
 mariqt/sources/elements.py,sha256=5Cgchy_MJq4CiLVi2xqpxlOGqL5-PKl426XnzoCIEVI,2177
-mariqt/sources/ifdo.py,sha256=cHKSya7-kf3n5UfBBY8HNTEokOTj-BKQRod9IApsmmg,131555
+mariqt/sources/ifdo.py,sha256=u0zAEKtrbQNcgVGKRE2TxzNy2TU4grJEAI88giopFEQ,134255
 mariqt/sources/ofop.py,sha256=mSMZLvWszr_Yfd7rDf_4V4jIz3DMQh7Qe7eHLUnMOK8,5533
 mariqt/sources/osis.py,sha256=JLsyriGSteZ7o3Gy4EGE7cejhh_ikemFO4eEnzhzwlg,2961
 mariqt/sources/svgs.py,sha256=T089b6F0wYLbUZQ8XhvCqqNmZqrvyTpx3kqRojlg_pM,650149
 mariqt/sources/underway.py,sha256=mIweaYmKbxPvmZHSFd3k5JY4mnFZ-7X3u_MdCPNjQL0,3728
-mariqt-0.6.8.dist-info/AUTHORS.md,sha256=_mki0OpAav0xO0ztc3R5aVhIpmexyqWmY1mAXBoOxMU,162
-mariqt-0.6.8.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
-mariqt-0.6.8.dist-info/METADATA,sha256=SlAuV0GkROA1rdvFLrXRC4QQeHH5Uv_gpviI0rGOMP0,1168
-mariqt-0.6.8.dist-info/WHEEL,sha256=DZajD4pwLWue70CAfc7YaxT1wLUciNBvN_TTcvXpltE,110
-mariqt-0.6.8.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
-mariqt-0.6.8.dist-info/RECORD,,
+mariqt-0.6.9.dist-info/AUTHORS.md,sha256=_mki0OpAav0xO0ztc3R5aVhIpmexyqWmY1mAXBoOxMU,162
+mariqt-0.6.9.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
+mariqt-0.6.9.dist-info/METADATA,sha256=YjkRNMhNM9S6kYQpEm3Ii7x_idoCPpZPE3Xd0XZkpUg,1168
+mariqt-0.6.9.dist-info/WHEEL,sha256=DZajD4pwLWue70CAfc7YaxT1wLUciNBvN_TTcvXpltE,110
+mariqt-0.6.9.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
+mariqt-0.6.9.dist-info/RECORD,,
```

