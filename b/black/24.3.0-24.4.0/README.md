# Comparing `tmp/black-24.3.0.tar.gz` & `tmp/black-24.4.0.tar.gz`

## Comparing `black-24.3.0.tar` & `black-24.4.0.tar`

### file list

```diff
@@ -1,398 +1,399 @@
--rw-r--r--   0        0        0      369 2020-02-02 00:00:00.000000 black-24.3.0/.flake8
--rw-r--r--   0        0        0      125 2020-02-02 00:00:00.000000 black-24.3.0/.git_archival.txt
--rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-24.3.0/.gitattributes
--rw-r--r--   0        0        0     2332 2020-02-02 00:00:00.000000 black-24.3.0/.pre-commit-config.yaml
--rw-r--r--   0        0        0      681 2020-02-02 00:00:00.000000 black-24.3.0/.pre-commit-hooks.yaml
--rw-r--r--   0        0        0       49 2020-02-02 00:00:00.000000 black-24.3.0/.prettierrc.yaml
--rw-r--r--   0        0        0      221 2020-02-02 00:00:00.000000 black-24.3.0/.readthedocs.yaml
--rw-r--r--   0        0        0    64238 2020-02-02 00:00:00.000000 black-24.3.0/CHANGES.md
--rw-r--r--   0        0        0      933 2020-02-02 00:00:00.000000 black-24.3.0/CITATION.cff
--rw-r--r--   0        0        0      422 2020-02-02 00:00:00.000000 black-24.3.0/CONTRIBUTING.md
--rw-r--r--   0        0        0      718 2020-02-02 00:00:00.000000 black-24.3.0/Dockerfile
--rw-r--r--   0        0        0     9778 2020-02-02 00:00:00.000000 black-24.3.0/README.md
--rw-r--r--   0        0        0      289 2020-02-02 00:00:00.000000 black-24.3.0/SECURITY.md
--rw-r--r--   0        0        0     2199 2020-02-02 00:00:00.000000 black-24.3.0/action.yml
--rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.3.0/test_requirements.txt
--rw-r--r--   0        0        0     3148 2020-02-02 00:00:00.000000 black-24.3.0/tox.ini
--rw-r--r--   0        0        0      554 2020-02-02 00:00:00.000000 black-24.3.0/.github/CODE_OF_CONDUCT.md
--rw-r--r--   0        0        0     1536 2020-02-02 00:00:00.000000 black-24.3.0/.github/PULL_REQUEST_TEMPLATE.md
--rw-r--r--   0        0        0      565 2020-02-02 00:00:00.000000 black-24.3.0/.github/dependabot.yml
--rw-r--r--   0        0        0     1554 2020-02-02 00:00:00.000000 black-24.3.0/.github/ISSUE_TEMPLATE/bug_report.md
--rw-r--r--   0        0        0      545 2020-02-02 00:00:00.000000 black-24.3.0/.github/ISSUE_TEMPLATE/config.yml
--rw-r--r--   0        0        0      692 2020-02-02 00:00:00.000000 black-24.3.0/.github/ISSUE_TEMPLATE/docs-issue.md
--rw-r--r--   0        0        0      649 2020-02-02 00:00:00.000000 black-24.3.0/.github/ISSUE_TEMPLATE/feature_request.md
--rw-r--r--   0        0        0      646 2020-02-02 00:00:00.000000 black-24.3.0/.github/ISSUE_TEMPLATE/style_issue.md
--rw-r--r--   0        0        0      684 2020-02-02 00:00:00.000000 black-24.3.0/.github/workflows/changelog.yml
--rw-r--r--   0        0        0     5325 2020-02-02 00:00:00.000000 black-24.3.0/.github/workflows/diff_shades.yml
--rw-r--r--   0        0        0     1534 2020-02-02 00:00:00.000000 black-24.3.0/.github/workflows/diff_shades_comment.yml
--rw-r--r--   0        0        0     1058 2020-02-02 00:00:00.000000 black-24.3.0/.github/workflows/doc.yml
--rw-r--r--   0        0        0     1889 2020-02-02 00:00:00.000000 black-24.3.0/.github/workflows/docker.yml
--rw-r--r--   0        0        0     1128 2020-02-02 00:00:00.000000 black-24.3.0/.github/workflows/fuzz.yml
--rw-r--r--   0        0        0     1359 2020-02-02 00:00:00.000000 black-24.3.0/.github/workflows/lint.yml
--rw-r--r--   0        0        0     3795 2020-02-02 00:00:00.000000 black-24.3.0/.github/workflows/pypi_upload.yml
--rw-r--r--   0        0        0     1668 2020-02-02 00:00:00.000000 black-24.3.0/.github/workflows/release_tests.yml
--rw-r--r--   0        0        0     3176 2020-02-02 00:00:00.000000 black-24.3.0/.github/workflows/test.yml
--rw-r--r--   0        0        0     1910 2020-02-02 00:00:00.000000 black-24.3.0/.github/workflows/upload_binary.yml
--rw-r--r--   0        0        0     2521 2020-02-02 00:00:00.000000 black-24.3.0/action/main.py
--rw-r--r--   0        0        0     7597 2020-02-02 00:00:00.000000 black-24.3.0/autoload/black.vim
--rw-r--r--   0        0        0      603 2020-02-02 00:00:00.000000 black-24.3.0/docs/Makefile
--rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-24.3.0/docs/authors.md
--rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-24.3.0/docs/change_log.md
--rw-r--r--   0        0        0     6841 2020-02-02 00:00:00.000000 black-24.3.0/docs/conf.py
--rw-r--r--   0        0        0     5708 2020-02-02 00:00:00.000000 black-24.3.0/docs/faq.md
--rw-r--r--   0        0        0     1613 2020-02-02 00:00:00.000000 black-24.3.0/docs/getting_started.md
--rw-r--r--   0        0        0     3662 2020-02-02 00:00:00.000000 black-24.3.0/docs/index.md
--rw-r--r--   0        0        0       62 2020-02-02 00:00:00.000000 black-24.3.0/docs/license.md
--rw-r--r--   0        0        0      773 2020-02-02 00:00:00.000000 black-24.3.0/docs/make.bat
--rw-r--r--   0        0        0      260 2020-02-02 00:00:00.000000 black-24.3.0/docs/requirements.txt
--rw-r--r--   0        0        0      950 2020-02-02 00:00:00.000000 black-24.3.0/docs/_static/license.svg
--rw-r--r--   0        0        0    99591 2020-02-02 00:00:00.000000 black-24.3.0/docs/_static/logo2-readme.png
--rw-r--r--   0        0        0   128768 2020-02-02 00:00:00.000000 black-24.3.0/docs/_static/logo2.png
--rw-r--r--   0        0        0      954 2020-02-02 00:00:00.000000 black-24.3.0/docs/_static/pypi_template.svg
--rw-r--r--   0        0        0       56 2020-02-02 00:00:00.000000 black-24.3.0/docs/compatible_configs/flake8/.flake8
--rw-r--r--   0        0        0       56 2020-02-02 00:00:00.000000 black-24.3.0/docs/compatible_configs/flake8/setup.cfg
--rw-r--r--   0        0        0       56 2020-02-02 00:00:00.000000 black-24.3.0/docs/compatible_configs/flake8/tox.ini
--rw-r--r--   0        0        0       23 2020-02-02 00:00:00.000000 black-24.3.0/docs/compatible_configs/isort/.editorconfig
--rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 black-24.3.0/docs/compatible_configs/isort/.isort.cfg
--rw-r--r--   0        0        0       31 2020-02-02 00:00:00.000000 black-24.3.0/docs/compatible_configs/isort/pyproject.toml
--rw-r--r--   0        0        0       24 2020-02-02 00:00:00.000000 black-24.3.0/docs/compatible_configs/isort/setup.cfg
--rw-r--r--   0        0        0       54 2020-02-02 00:00:00.000000 black-24.3.0/docs/compatible_configs/pycodestyle/.flake8
--rw-r--r--   0        0        0       54 2020-02-02 00:00:00.000000 black-24.3.0/docs/compatible_configs/pycodestyle/setup.cfg
--rw-r--r--   0        0        0       54 2020-02-02 00:00:00.000000 black-24.3.0/docs/compatible_configs/pycodestyle/tox.ini
--rw-r--r--   0        0        0       30 2020-02-02 00:00:00.000000 black-24.3.0/docs/compatible_configs/pylint/pylintrc
--rw-r--r--   0        0        0       44 2020-02-02 00:00:00.000000 black-24.3.0/docs/compatible_configs/pylint/pyproject.toml
--rw-r--r--   0        0        0       30 2020-02-02 00:00:00.000000 black-24.3.0/docs/compatible_configs/pylint/setup.cfg
--rw-r--r--   0        0        0     2758 2020-02-02 00:00:00.000000 black-24.3.0/docs/contributing/gauging_changes.md
--rw-r--r--   0        0        0     1318 2020-02-02 00:00:00.000000 black-24.3.0/docs/contributing/index.md
--rw-r--r--   0        0        0     9266 2020-02-02 00:00:00.000000 black-24.3.0/docs/contributing/issue_triage.md
--rw-r--r--   0        0        0     8542 2020-02-02 00:00:00.000000 black-24.3.0/docs/contributing/release_process.md
--rw-r--r--   0        0        0     5051 2020-02-02 00:00:00.000000 black-24.3.0/docs/contributing/the_basics.md
--rw-r--r--   0        0        0      310 2020-02-02 00:00:00.000000 black-24.3.0/docs/guides/index.md
--rw-r--r--   0        0        0     2407 2020-02-02 00:00:00.000000 black-24.3.0/docs/guides/introducing_black_to_your_project.md
--rw-r--r--   0        0        0     7928 2020-02-02 00:00:00.000000 black-24.3.0/docs/guides/using_black_with_other_tools.md
--rw-r--r--   0        0        0    12292 2020-02-02 00:00:00.000000 black-24.3.0/docs/integrations/editors.md
--rw-r--r--   0        0        0     2255 2020-02-02 00:00:00.000000 black-24.3.0/docs/integrations/github_actions.md
--rw-r--r--   0        0        0      969 2020-02-02 00:00:00.000000 black-24.3.0/docs/integrations/index.md
--rw-r--r--   0        0        0     1962 2020-02-02 00:00:00.000000 black-24.3.0/docs/integrations/source_version_control.md
--rw-r--r--   0        0        0    20363 2020-02-02 00:00:00.000000 black-24.3.0/docs/the_black_code_style/current_style.md
--rw-r--r--   0        0        0     8185 2020-02-02 00:00:00.000000 black-24.3.0/docs/the_black_code_style/future_style.md
--rw-r--r--   0        0        0     2346 2020-02-02 00:00:00.000000 black-24.3.0/docs/the_black_code_style/index.md
--rw-r--r--   0        0        0     4684 2020-02-02 00:00:00.000000 black-24.3.0/docs/usage_and_configuration/black_as_a_server.md
--rw-r--r--   0        0        0     2173 2020-02-02 00:00:00.000000 black-24.3.0/docs/usage_and_configuration/black_docker_image.md
--rw-r--r--   0        0        0     1870 2020-02-02 00:00:00.000000 black-24.3.0/docs/usage_and_configuration/file_collection_and_discovery.md
--rw-r--r--   0        0        0      969 2020-02-02 00:00:00.000000 black-24.3.0/docs/usage_and_configuration/index.md
--rw-r--r--   0        0        0    19326 2020-02-02 00:00:00.000000 black-24.3.0/docs/usage_and_configuration/the_basics.md
--rw-r--r--   0        0        0      342 2020-02-02 00:00:00.000000 black-24.3.0/gallery/Dockerfile
--rw-r--r--   0        0        0     1595 2020-02-02 00:00:00.000000 black-24.3.0/gallery/README.md
--rwxr-xr-x   0        0        0     9105 2020-02-02 00:00:00.000000 black-24.3.0/gallery/gallery.py
--rw-r--r--   0        0        0     2176 2020-02-02 00:00:00.000000 black-24.3.0/plugin/black.vim
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/scripts/__init__.py
--rw-r--r--   0        0        0     1863 2020-02-02 00:00:00.000000 black-24.3.0/scripts/check_pre_commit_rev_in_example.py
--rw-r--r--   0        0        0     1618 2020-02-02 00:00:00.000000 black-24.3.0/scripts/check_version_in_basics_example.py
--rw-r--r--   0        0        0     8987 2020-02-02 00:00:00.000000 black-24.3.0/scripts/diff_shades_gha_helper.py
--rw-r--r--   0        0        0     3553 2020-02-02 00:00:00.000000 black-24.3.0/scripts/fuzz.py
--rwxr-xr-x   0        0        0     2381 2020-02-02 00:00:00.000000 black-24.3.0/scripts/generate_schema.py
--rw-r--r--   0        0        0     2358 2020-02-02 00:00:00.000000 black-24.3.0/scripts/make_width_table.py
--rwxr-xr-x   0        0        0     2987 2020-02-02 00:00:00.000000 black-24.3.0/scripts/migrate-black.py
--rwxr-xr-x   0        0        0     7496 2020-02-02 00:00:00.000000 black-24.3.0/scripts/release.py
--rw-r--r--   0        0        0     2321 2020-02-02 00:00:00.000000 black-24.3.0/scripts/release_tests.py
--rw-r--r--   0        0        0       19 2020-02-02 00:00:00.000000 black-24.3.0/src/_black_version.py
--rw-r--r--   0        0        0    51975 2020-02-02 00:00:00.000000 black-24.3.0/src/black/__init__.py
--rw-r--r--   0        0        0       47 2020-02-02 00:00:00.000000 black-24.3.0/src/black/__main__.py
--rw-r--r--   0        0        0    10761 2020-02-02 00:00:00.000000 black-24.3.0/src/black/_width_table.py
--rw-r--r--   0        0        0    12426 2020-02-02 00:00:00.000000 black-24.3.0/src/black/brackets.py
--rw-r--r--   0        0        0     4835 2020-02-02 00:00:00.000000 black-24.3.0/src/black/cache.py
--rw-r--r--   0        0        0    15983 2020-02-02 00:00:00.000000 black-24.3.0/src/black/comments.py
--rw-r--r--   0        0        0     6410 2020-02-02 00:00:00.000000 black-24.3.0/src/black/concurrency.py
--rw-r--r--   0        0        0      321 2020-02-02 00:00:00.000000 black-24.3.0/src/black/const.py
--rw-r--r--   0        0        0     1906 2020-02-02 00:00:00.000000 black-24.3.0/src/black/debug.py
--rw-r--r--   0        0        0    14665 2020-02-02 00:00:00.000000 black-24.3.0/src/black/files.py
--rw-r--r--   0        0        0    13364 2020-02-02 00:00:00.000000 black-24.3.0/src/black/handle_ipynb_magics.py
--rw-r--r--   0        0        0    67152 2020-02-02 00:00:00.000000 black-24.3.0/src/black/linegen.py
--rw-r--r--   0        0        0    39261 2020-02-02 00:00:00.000000 black-24.3.0/src/black/lines.py
--rw-r--r--   0        0        0     8446 2020-02-02 00:00:00.000000 black-24.3.0/src/black/mode.py
--rw-r--r--   0        0        0    28915 2020-02-02 00:00:00.000000 black-24.3.0/src/black/nodes.py
--rw-r--r--   0        0        0     1655 2020-02-02 00:00:00.000000 black-24.3.0/src/black/numerics.py
--rw-r--r--   0        0        0     3939 2020-02-02 00:00:00.000000 black-24.3.0/src/black/output.py
--rw-r--r--   0        0        0     8486 2020-02-02 00:00:00.000000 black-24.3.0/src/black/parsing.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/src/black/py.typed
--rw-r--r--   0        0        0    19695 2020-02-02 00:00:00.000000 black-24.3.0/src/black/ranges.py
--rw-r--r--   0        0        0     3452 2020-02-02 00:00:00.000000 black-24.3.0/src/black/report.py
--rw-r--r--   0        0        0      557 2020-02-02 00:00:00.000000 black-24.3.0/src/black/rusty.py
--rw-r--r--   0        0        0      617 2020-02-02 00:00:00.000000 black-24.3.0/src/black/schema.py
--rw-r--r--   0        0        0    10933 2020-02-02 00:00:00.000000 black-24.3.0/src/black/strings.py
--rw-r--r--   0        0        0    95476 2020-02-02 00:00:00.000000 black-24.3.0/src/black/trans.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/src/black/resources/__init__.py
--rw-r--r--   0        0        0     7379 2020-02-02 00:00:00.000000 black-24.3.0/src/black/resources/black.schema.json
--rw-r--r--   0        0        0     8867 2020-02-02 00:00:00.000000 black-24.3.0/src/blackd/__init__.py
--rw-r--r--   0        0        0       37 2020-02-02 00:00:00.000000 black-24.3.0/src/blackd/__main__.py
--rw-r--r--   0        0        0     1585 2020-02-02 00:00:00.000000 black-24.3.0/src/blackd/middlewares.py
--rw-r--r--   0        0        0    11351 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/Grammar.txt
--rw-r--r--   0        0        0    12762 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/LICENSE
--rw-r--r--   0        0        0      793 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/PatternGrammar.txt
--rw-r--r--   0        0        0     1074 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/README
--rw-r--r--   0        0        0        8 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/__init__.py
--rw-r--r--   0        0        0     4810 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/pygram.py
--rw-r--r--   0        0        0    32666 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/pytree.py
--rw-r--r--   0        0        0      143 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/pgen2/__init__.py
--rw-r--r--   0        0        0     9587 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/pgen2/conv.py
--rw-r--r--   0        0        0    10631 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/pgen2/driver.py
--rw-r--r--   0        0        0     6858 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/pgen2/grammar.py
--rw-r--r--   0        0        0     1614 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/pgen2/literals.py
--rw-r--r--   0        0        0    15658 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/pgen2/parse.py
--rw-r--r--   0        0        0    15428 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/pgen2/pgen.py
--rw-r--r--   0        0        0     1805 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/pgen2/token.py
--rw-r--r--   0        0        0    23006 2020-02-02 00:00:00.000000 black-24.3.0/src/blib2to3/pgen2/tokenize.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/__init__.py
--rw-r--r--   0        0        0      727 2020-02-02 00:00:00.000000 black-24.3.0/tests/conftest.py
--rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.3.0/tests/empty.toml
--rw-r--r--   0        0        0     4523 2020-02-02 00:00:00.000000 black-24.3.0/tests/optional.py
--rw-r--r--   0        0        0      388 2020-02-02 00:00:00.000000 black-24.3.0/tests/test.toml
--rw-r--r--   0        0        0   118697 2020-02-02 00:00:00.000000 black-24.3.0/tests/test_black.py
--rw-r--r--   0        0        0     9375 2020-02-02 00:00:00.000000 black-24.3.0/tests/test_blackd.py
--rw-r--r--   0        0        0     2531 2020-02-02 00:00:00.000000 black-24.3.0/tests/test_docs.py
--rw-r--r--   0        0        0     2683 2020-02-02 00:00:00.000000 black-24.3.0/tests/test_format.py
--rw-r--r--   0        0        0    16073 2020-02-02 00:00:00.000000 black-24.3.0/tests/test_ipynb.py
--rw-r--r--   0        0        0     1247 2020-02-02 00:00:00.000000 black-24.3.0/tests/test_no_ipynb.py
--rw-r--r--   0        0        0     4538 2020-02-02 00:00:00.000000 black-24.3.0/tests/test_ranges.py
--rw-r--r--   0        0        0      560 2020-02-02 00:00:00.000000 black-24.3.0/tests/test_schema.py
--rw-r--r--   0        0        0     2238 2020-02-02 00:00:00.000000 black-24.3.0/tests/test_trans.py
--rw-r--r--   0        0        0    12198 2020-02-02 00:00:00.000000 black-24.3.0/tests/util.py
--rw-r--r--   0        0        0       99 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/empty_pyproject.toml
--rw-r--r--   0        0        0       88 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/incorrect_spelling.toml
--rw-r--r--   0        0        0       33 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/invalid_line_ranges.toml
--rw-r--r--   0        0        0     1794 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/allow_empty_first_line.py
--rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/async_stmts.py
--rw-r--r--   0        0        0      907 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/attribute_access_on_number_literals.py
--rw-r--r--   0        0        0       63 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/beginning_backslash.py
--rw-r--r--   0        0        0      333 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/bracketmatch.py
--rw-r--r--   0        0        0      511 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/bytes_docstring.py
--rw-r--r--   0        0        0     1092 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/class_blank_parentheses.py
--rw-r--r--   0        0        0     4318 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/class_methods_new_line.py
--rw-r--r--   0        0        0     3294 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/collections.py
--rw-r--r--   0        0        0      212 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/comment_after_escaped_newline.py
--rw-r--r--   0        0        0      174 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/comment_type_hint.py
--rw-r--r--   0        0        0     1909 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/comments.py
--rw-r--r--   0        0        0     7640 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/comments2.py
--rw-r--r--   0        0        0     1573 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/comments3.py
--rw-r--r--   0        0        0     3532 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/comments4.py
--rw-r--r--   0        0        0     1184 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/comments5.py
--rw-r--r--   0        0        0     2479 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/comments6.py
--rw-r--r--   0        0        0      298 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/comments8.py
--rw-r--r--   0        0        0     5279 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/comments9.py
--rw-r--r--   0        0        0     2150 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/comments_in_blocks.py
--rw-r--r--   0        0        0     1142 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/comments_in_double_parens.py
--rw-r--r--   0        0        0      994 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/comments_non_breaking_space.py
--rw-r--r--   0        0        0     5596 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/composition.py
--rw-r--r--   0        0        0    11196 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/composition_no_trailing_comma.py
--rw-r--r--   0        0        0     4910 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/conditional_expression.py
--rw-r--r--   0        0        0     1171 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/context_managers_38.py
--rw-r--r--   0        0        0     3392 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/context_managers_39.py
--rw-r--r--   0        0        0      627 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/context_managers_autodetect_310.py
--rw-r--r--   0        0        0      585 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/context_managers_autodetect_311.py
--rw-r--r--   0        0        0     1058 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/context_managers_autodetect_38.py
--rw-r--r--   0        0        0      654 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/context_managers_autodetect_39.py
--rw-r--r--   0        0        0     7978 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/docstring.py
--rw-r--r--   0        0        0      118 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/docstring_newline_preview.py
--rw-r--r--   0        0        0      140 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/docstring_no_extra_empty_line_before_eof.py
--rw-r--r--   0        0        0     3638 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/docstring_no_string_normalization.py
--rw-r--r--   0        0        0     3518 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/docstring_preview.py
--rw-r--r--   0        0        0     2247 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/dummy_implementations.py
--rw-r--r--   0        0        0     4597 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/empty_lines.py
--rw-r--r--   0        0        0    15801 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/expression.diff
--rw-r--r--   0        0        0    18624 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/expression.py
--rw-r--r--   0        0        0      234 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/f_docstring.py
--rw-r--r--   0        0        0     9635 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fmtonoff.py
--rw-r--r--   0        0        0      604 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fmtonoff2.py
--rw-r--r--   0        0        0      251 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fmtonoff3.py
--rw-r--r--   0        0        0      278 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fmtonoff4.py
--rw-r--r--   0        0        0     3619 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fmtonoff5.py
--rw-r--r--   0        0        0      277 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fmtpass_imports.py
--rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fmtskip.py
--rw-r--r--   0        0        0      708 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fmtskip2.py
--rw-r--r--   0        0        0      362 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fmtskip3.py
--rw-r--r--   0        0        0       92 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fmtskip4.py
--rw-r--r--   0        0        0      301 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fmtskip5.py
--rw-r--r--   0        0        0      235 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fmtskip6.py
--rw-r--r--   0        0        0      356 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fmtskip7.py
--rw-r--r--   0        0        0     1705 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fmtskip8.py
--rw-r--r--   0        0        0      113 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fmtskip9.py
--rw-r--r--   0        0        0     1932 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/form_feeds.py
--rw-r--r--   0        0        0      989 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/fstring.py
--rw-r--r--   0        0        0     5786 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/funcdef_return_type_trailing_comma.py
--rw-r--r--   0        0        0     6408 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/function.py
--rw-r--r--   0        0        0     2419 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/function2.py
--rw-r--r--   0        0        0     3605 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/function_trailing_comma.py
--rw-r--r--   0        0        0      520 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/ignore_pyi.py
--rw-r--r--   0        0        0     2542 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/import_spacing.py
--rw-r--r--   0        0        0      565 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/is_simple_lookup_for_doublestar_expression.py
--rw-r--r--   0        0        0      547 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/keep_newline_after_match.py
--rw-r--r--   0        0        0     3519 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/line_ranges_basic.py
--rw-r--r--   0        0        0      954 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/line_ranges_diff_edge_case.py
--rw-r--r--   0        0        0     1276 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/line_ranges_exceeding_end.py
--rw-r--r--   0        0        0     1373 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/line_ranges_fmt_off.py
--rw-r--r--   0        0        0      998 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/line_ranges_fmt_off_decorator.py
--rw-r--r--   0        0        0     1155 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/line_ranges_fmt_off_overlap.py
--rw-r--r--   0        0        0      346 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/line_ranges_imports.py
--rw-r--r--   0        0        0      633 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/line_ranges_indentation.py
--rw-r--r--   0        0        0      619 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/line_ranges_outside_source.py
--rw-r--r--   0        0        0     1065 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/line_ranges_two_passes.py
--rw-r--r--   0        0        0      591 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/line_ranges_unwrapping.py
--rw-r--r--   0        0        0      126 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/linelength6.py
--rw-r--r--   0        0        0    11608 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/long_strings_flag_disabled.py
--rw-r--r--   0        0        0      329 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/module_docstring_1.py
--rw-r--r--   0        0        0     2252 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/module_docstring_2.py
--rw-r--r--   0        0        0      181 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/module_docstring_3.py
--rw-r--r--   0        0        0      182 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/module_docstring_4.py
--rw-r--r--   0        0        0      180 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/module_docstring_followed_by_class.py
--rw-r--r--   0        0        0      196 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/module_docstring_followed_by_function.py
--rw-r--r--   0        0        0      644 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/multiline_consecutive_open_parentheses_ignore.py
--rw-r--r--   0        0        0     1243 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/nested_stub.py
--rw-r--r--   0        0        0      988 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/no_blank_line_before_docstring.py
--rw-r--r--   0        0        0      544 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/numeric_literals.py
--rw-r--r--   0        0        0      215 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/numeric_literals_skip_underscores.py
--rw-r--r--   0        0        0      674 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/one_element_subscript.py
--rw-r--r--   0        0        0      797 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/parenthesized_context_managers.py
--rw-r--r--   0        0        0     2967 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pattern_matching_complex.py
--rw-r--r--   0        0        0     1796 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pattern_matching_extras.py
--rw-r--r--   0        0        0     3098 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pattern_matching_generic.py
--rw-r--r--   0        0        0      692 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pattern_matching_long.py
--rw-r--r--   0        0        0     2673 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pattern_matching_simple.py
--rw-r--r--   0        0        0     1093 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pattern_matching_style.py
--rw-r--r--   0        0        0      547 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pattern_matching_trailing_comma.py
--rw-r--r--   0        0        0     4689 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pep604_union_types_line_breaks.py
--rw-r--r--   0        0        0      711 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pep_570.py
--rw-r--r--   0        0        0     1001 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pep_572.py
--rw-r--r--   0        0        0      514 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pep_572_do_not_remove_parens.py
--rw-r--r--   0        0        0      531 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pep_572_py310.py
--rw-r--r--   0        0        0      282 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pep_572_py39.py
--rw-r--r--   0        0        0     1919 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pep_572_remove_parens.py
--rw-r--r--   0        0        0       60 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pep_572_slices.py
--rw-r--r--   0        0        0      583 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pep_604.py
--rw-r--r--   0        0        0     2146 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pep_646.py
--rw-r--r--   0        0        0     1004 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pep_654.py
--rw-r--r--   0        0        0     2065 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/pep_654_style.py
--rw-r--r--   0        0        0      485 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/percent_precedence.py
--rw-r--r--   0        0        0       94 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/power_op_newline.py
--rw-r--r--   0        0        0     3533 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/power_op_spacing.py
--rw-r--r--   0        0        0     2500 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/power_op_spacing_long.py
--rw-r--r--   0        0        0     3270 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/prefer_rhs_split.py
--rw-r--r--   0        0        0     1106 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/prefer_rhs_split_reformatted.py
--rw-r--r--   0        0        0     3328 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/preview_cantfit.py
--rw-r--r--   0        0        0      829 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/preview_cantfit_string.py
--rw-r--r--   0        0        0     8996 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/preview_comments7.py
--rw-r--r--   0        0        0      632 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/preview_format_unicode_escape_seq.py
--rw-r--r--   0        0        0     5823 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets.py
--rw-r--r--   0        0        0     4093 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets_no_ll1.py
--rw-r--r--   0        0        0     3982 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/preview_long_dict_values.py
--rw-r--r--   0        0        0    36538 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/preview_long_strings.py
--rw-r--r--   0        0        0     1439 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/preview_long_strings__east_asian_width.py
--rw-r--r--   0        0        0     6556 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/preview_long_strings__edge_case.py
--rw-r--r--   0        0        0    45834 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/preview_long_strings__regression.py
--rw-r--r--   0        0        0     1094 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/preview_long_strings__type_annotations.py
--rw-r--r--   0        0        0     7579 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/preview_multiline_strings.py
--rw-r--r--   0        0        0      742 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/preview_return_annotation_brackets_string.py
--rw-r--r--   0        0        0      173 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/py310_pep572.py
--rw-r--r--   0        0        0     1178 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/python37.py
--rw-r--r--   0        0        0      813 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/python38.py
--rw-r--r--   0        0        0      662 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/python39.py
--rw-r--r--   0        0        0      292 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/raw_docstring.py
--rw-r--r--   0        0        0      394 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/raw_docstring_no_string_normalization.py
--rw-r--r--   0        0        0     3538 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/remove_await_parens.py
--rw-r--r--   0        0        0     2025 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/remove_except_parens.py
--rw-r--r--   0        0        0     1460 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/remove_for_brackets.py
--rw-r--r--   0        0        0     3218 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/remove_newline_after_code_block_open.py
--rw-r--r--   0        0        0     3493 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/remove_parens.py
--rw-r--r--   0        0        0     1496 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/remove_redundant_parens_in_case_guard.py
--rw-r--r--   0        0        0     2606 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/remove_with_brackets.py
--rw-r--r--   0        0        0     5207 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/return_annotation_brackets.py
--rw-r--r--   0        0        0      646 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/single_line_format_skip_with_multiple_comments.py
--rw-r--r--   0        0        0     1435 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/skip_magic_trailing_comma.py
--rw-r--r--   0        0        0      787 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/slices.py
--rw-r--r--   0        0        0      817 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/split_delimiter_comments.py
--rw-r--r--   0        0        0      412 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/starred_for_target.py
--rw-r--r--   0        0        0      845 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/string_prefixes.py
--rw-r--r--   0        0        0     2281 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/stub.py
--rw-r--r--   0        0        0     2279 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/torture.py
--rw-r--r--   0        0        0      655 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/trailing_comma.py
--rw-r--r--   0        0        0     1615 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/trailing_comma_optional_parens1.py
--rw-r--r--   0        0        0      248 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/trailing_comma_optional_parens2.py
--rw-r--r--   0        0        0      967 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/trailing_comma_optional_parens3.py
--rw-r--r--   0        0        0     2123 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/trailing_commas_in_leading_parts.py
--rw-r--r--   0        0        0       80 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/tricky_unicode_symbols.py
--rw-r--r--   0        0        0      510 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/tupleassign.py
--rw-r--r--   0        0        0      458 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/type_aliases.py
--rw-r--r--   0        0        0       93 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/type_comment_syntax_error.py
--rw-r--r--   0        0        0     1144 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/type_params.py
--rw-r--r--   0        0        0      544 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/typed_params_trailing_comma.py
--rw-r--r--   0        0        0      269 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/walrus_in_dict.py
--rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/cases/whitespace.py
--rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/gitignore_used_on_multiple_sources/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/gitignore_used_on_multiple_sources/dir1/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/gitignore_used_on_multiple_sources/dir1/b.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/gitignore_used_on_multiple_sources/dir2/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/gitignore_used_on_multiple_sources/dir2/b.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/ignore_subfolders_gitignore_tests/a.py
--rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/ignore_subfolders_gitignore_tests/subdir/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/ignore_subfolders_gitignore_tests/subdir/b.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/ignore_subfolders_gitignore_tests/subdir/subdir/c.py
--rw-r--r--   0        0        0       14 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/include_exclude_tests/.gitignore
--rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/include_exclude_tests/pyproject.toml
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.pie
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.pyi
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/include_exclude_tests/b/dont_exclude/a.pie
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/include_exclude_tests/b/dont_exclude/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/include_exclude_tests/b/dont_exclude/a.pyi
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/include_exclude_tests/b/exclude/a.pie
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/include_exclude_tests/b/exclude/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/include_exclude_tests/b/exclude/a.pyi
--rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/invalid_gitignore_tests/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/invalid_gitignore_tests/a.py
--rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/invalid_gitignore_tests/pyproject.toml
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/invalid_nested_gitignore_tests/a.py
--rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/invalid_nested_gitignore_tests/pyproject.toml
--rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/invalid_nested_gitignore_tests/a/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/invalid_nested_gitignore_tests/a/a.py
--rw-r--r--   0        0        0      436 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/jupyter/non_python_notebook.ipynb
--rw-r--r--   0        0        0      369 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/jupyter/notebook_empty_metadata.ipynb
--rw-r--r--   0        0        0      638 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/jupyter/notebook_no_trailing_newline.ipynb
--rw-r--r--   0        0        0      639 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/jupyter/notebook_trailing_newline.ipynb
--rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/jupyter/notebook_which_cant_be_parsed.ipynb
--rw-r--r--   0        0        0      762 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/jupyter/notebook_without_changes.ipynb
--rw-r--r--   0        0        0      853 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/line_ranges_formatted/basic.py
--rw-r--r--   0        0        0      537 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/line_ranges_formatted/pattern_matching.py
--rw-r--r--   0        0        0      495 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/miscellaneous/async_as_identifier.py
--rw-r--r--   0        0        0      255 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/miscellaneous/blackd_diff.diff
--rw-r--r--   0        0        0       98 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/miscellaneous/blackd_diff.py
--rw-r--r--   0        0        0    15604 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/miscellaneous/debug_visitor.out
--rw-r--r--   0        0        0     1193 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/miscellaneous/debug_visitor.py
--rw-r--r--   0        0        0     1774 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/miscellaneous/decorators.py
--rw-r--r--   0        0        0    15711 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff
--rw-r--r--   0        0        0      600 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/miscellaneous/force_py36.py
--rw-r--r--   0        0        0      808 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/miscellaneous/force_pyi.py
--rw-r--r--   0        0        0       59 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/miscellaneous/invalid_header.py
--rw-r--r--   0        0        0      293 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/miscellaneous/missing_final_newline.diff
--rw-r--r--   0        0        0      145 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/miscellaneous/missing_final_newline.py
--rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/miscellaneous/pattern_matching_invalid.py
--rw-r--r--   0        0        0      758 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/miscellaneous/python2_detection.py
--rw-r--r--   0        0        0     2363 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/miscellaneous/string_quotes.py
--rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/nested_gitignore_tests/pyproject.toml
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/nested_gitignore_tests/x.py
--rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/nested_gitignore_tests/root/.gitignore
--rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/nested_gitignore_tests/root/a.py
--rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/nested_gitignore_tests/root/b.py
--rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/nested_gitignore_tests/root/c.py
--rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/nested_gitignore_tests/root/child/.gitignore
--rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/nested_gitignore_tests/root/child/a.py
--rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/nested_gitignore_tests/root/child/b.py
--rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/nested_gitignore_tests/root/child/c.py
--rw-r--r--   0        0        0      132 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/project_metadata/both_pyproject.toml
--rw-r--r--   0        0        0       73 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/project_metadata/neither_pyproject.toml
--rw-r--r--   0        0        0      100 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/project_metadata/only_black_pyproject.toml
--rw-r--r--   0        0        0      105 2020-02-02 00:00:00.000000 black-24.3.0/tests/data/project_metadata/only_metadata_pyproject.toml
--rw-r--r--   0        0        0      302 2020-02-02 00:00:00.000000 black-24.3.0/.gitignore
--rw-r--r--   0        0        0     8092 2020-02-02 00:00:00.000000 black-24.3.0/AUTHORS.md
--rw-r--r--   0        0        0     1080 2020-02-02 00:00:00.000000 black-24.3.0/LICENSE
--rw-r--r--   0        0        0     8736 2020-02-02 00:00:00.000000 black-24.3.0/pyproject.toml
--rw-r--r--   0        0        0    75987 2020-02-02 00:00:00.000000 black-24.3.0/PKG-INFO
+-rw-r--r--   0        0        0      369 2020-02-02 00:00:00.000000 black-24.4.0/.flake8
+-rw-r--r--   0        0        0      125 2020-02-02 00:00:00.000000 black-24.4.0/.git_archival.txt
+-rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-24.4.0/.gitattributes
+-rw-r--r--   0        0        0     2332 2020-02-02 00:00:00.000000 black-24.4.0/.pre-commit-config.yaml
+-rw-r--r--   0        0        0      681 2020-02-02 00:00:00.000000 black-24.4.0/.pre-commit-hooks.yaml
+-rw-r--r--   0        0        0       49 2020-02-02 00:00:00.000000 black-24.4.0/.prettierrc.yaml
+-rw-r--r--   0        0        0      221 2020-02-02 00:00:00.000000 black-24.4.0/.readthedocs.yaml
+-rw-r--r--   0        0        0    64681 2020-02-02 00:00:00.000000 black-24.4.0/CHANGES.md
+-rw-r--r--   0        0        0      933 2020-02-02 00:00:00.000000 black-24.4.0/CITATION.cff
+-rw-r--r--   0        0        0      422 2020-02-02 00:00:00.000000 black-24.4.0/CONTRIBUTING.md
+-rw-r--r--   0        0        0      718 2020-02-02 00:00:00.000000 black-24.4.0/Dockerfile
+-rw-r--r--   0        0        0     9778 2020-02-02 00:00:00.000000 black-24.4.0/README.md
+-rw-r--r--   0        0        0      289 2020-02-02 00:00:00.000000 black-24.4.0/SECURITY.md
+-rw-r--r--   0        0        0     2391 2020-02-02 00:00:00.000000 black-24.4.0/action.yml
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.4.0/test_requirements.txt
+-rw-r--r--   0        0        0     3148 2020-02-02 00:00:00.000000 black-24.4.0/tox.ini
+-rw-r--r--   0        0        0      554 2020-02-02 00:00:00.000000 black-24.4.0/.github/CODE_OF_CONDUCT.md
+-rw-r--r--   0        0        0     1536 2020-02-02 00:00:00.000000 black-24.4.0/.github/PULL_REQUEST_TEMPLATE.md
+-rw-r--r--   0        0        0      565 2020-02-02 00:00:00.000000 black-24.4.0/.github/dependabot.yml
+-rw-r--r--   0        0        0     1554 2020-02-02 00:00:00.000000 black-24.4.0/.github/ISSUE_TEMPLATE/bug_report.md
+-rw-r--r--   0        0        0      545 2020-02-02 00:00:00.000000 black-24.4.0/.github/ISSUE_TEMPLATE/config.yml
+-rw-r--r--   0        0        0      692 2020-02-02 00:00:00.000000 black-24.4.0/.github/ISSUE_TEMPLATE/docs-issue.md
+-rw-r--r--   0        0        0      649 2020-02-02 00:00:00.000000 black-24.4.0/.github/ISSUE_TEMPLATE/feature_request.md
+-rw-r--r--   0        0        0      646 2020-02-02 00:00:00.000000 black-24.4.0/.github/ISSUE_TEMPLATE/style_issue.md
+-rw-r--r--   0        0        0      684 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/changelog.yml
+-rw-r--r--   0        0        0     5325 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/diff_shades.yml
+-rw-r--r--   0        0        0     1534 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/diff_shades_comment.yml
+-rw-r--r--   0        0        0     1058 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/doc.yml
+-rw-r--r--   0        0        0     1889 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/docker.yml
+-rw-r--r--   0        0        0     1128 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/fuzz.yml
+-rw-r--r--   0        0        0     1359 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/lint.yml
+-rw-r--r--   0        0        0     3795 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/pypi_upload.yml
+-rw-r--r--   0        0        0     1668 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/release_tests.yml
+-rw-r--r--   0        0        0     3176 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/test.yml
+-rw-r--r--   0        0        0     1910 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/upload_binary.yml
+-rw-r--r--   0        0        0     5373 2020-02-02 00:00:00.000000 black-24.4.0/action/main.py
+-rw-r--r--   0        0        0     7597 2020-02-02 00:00:00.000000 black-24.4.0/autoload/black.vim
+-rw-r--r--   0        0        0      603 2020-02-02 00:00:00.000000 black-24.4.0/docs/Makefile
+-rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-24.4.0/docs/authors.md
+-rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-24.4.0/docs/change_log.md
+-rw-r--r--   0        0        0     6841 2020-02-02 00:00:00.000000 black-24.4.0/docs/conf.py
+-rw-r--r--   0        0        0     5708 2020-02-02 00:00:00.000000 black-24.4.0/docs/faq.md
+-rw-r--r--   0        0        0     1613 2020-02-02 00:00:00.000000 black-24.4.0/docs/getting_started.md
+-rw-r--r--   0        0        0     3662 2020-02-02 00:00:00.000000 black-24.4.0/docs/index.md
+-rw-r--r--   0        0        0       62 2020-02-02 00:00:00.000000 black-24.4.0/docs/license.md
+-rw-r--r--   0        0        0      773 2020-02-02 00:00:00.000000 black-24.4.0/docs/make.bat
+-rw-r--r--   0        0        0      260 2020-02-02 00:00:00.000000 black-24.4.0/docs/requirements.txt
+-rw-r--r--   0        0        0      950 2020-02-02 00:00:00.000000 black-24.4.0/docs/_static/license.svg
+-rw-r--r--   0        0        0    99591 2020-02-02 00:00:00.000000 black-24.4.0/docs/_static/logo2-readme.png
+-rw-r--r--   0        0        0   128768 2020-02-02 00:00:00.000000 black-24.4.0/docs/_static/logo2.png
+-rw-r--r--   0        0        0      954 2020-02-02 00:00:00.000000 black-24.4.0/docs/_static/pypi_template.svg
+-rw-r--r--   0        0        0       56 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/flake8/.flake8
+-rw-r--r--   0        0        0       56 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/flake8/setup.cfg
+-rw-r--r--   0        0        0       56 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/flake8/tox.ini
+-rw-r--r--   0        0        0       23 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/isort/.editorconfig
+-rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/isort/.isort.cfg
+-rw-r--r--   0        0        0       31 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/isort/pyproject.toml
+-rw-r--r--   0        0        0       24 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/isort/setup.cfg
+-rw-r--r--   0        0        0       54 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/pycodestyle/.flake8
+-rw-r--r--   0        0        0       54 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/pycodestyle/setup.cfg
+-rw-r--r--   0        0        0       54 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/pycodestyle/tox.ini
+-rw-r--r--   0        0        0       30 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/pylint/pylintrc
+-rw-r--r--   0        0        0       44 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/pylint/pyproject.toml
+-rw-r--r--   0        0        0       30 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/pylint/setup.cfg
+-rw-r--r--   0        0        0     2758 2020-02-02 00:00:00.000000 black-24.4.0/docs/contributing/gauging_changes.md
+-rw-r--r--   0        0        0     1318 2020-02-02 00:00:00.000000 black-24.4.0/docs/contributing/index.md
+-rw-r--r--   0        0        0     9266 2020-02-02 00:00:00.000000 black-24.4.0/docs/contributing/issue_triage.md
+-rw-r--r--   0        0        0     8542 2020-02-02 00:00:00.000000 black-24.4.0/docs/contributing/release_process.md
+-rw-r--r--   0        0        0     5051 2020-02-02 00:00:00.000000 black-24.4.0/docs/contributing/the_basics.md
+-rw-r--r--   0        0        0      310 2020-02-02 00:00:00.000000 black-24.4.0/docs/guides/index.md
+-rw-r--r--   0        0        0     2407 2020-02-02 00:00:00.000000 black-24.4.0/docs/guides/introducing_black_to_your_project.md
+-rw-r--r--   0        0        0     7928 2020-02-02 00:00:00.000000 black-24.4.0/docs/guides/using_black_with_other_tools.md
+-rw-r--r--   0        0        0    12292 2020-02-02 00:00:00.000000 black-24.4.0/docs/integrations/editors.md
+-rw-r--r--   0        0        0     2757 2020-02-02 00:00:00.000000 black-24.4.0/docs/integrations/github_actions.md
+-rw-r--r--   0        0        0      969 2020-02-02 00:00:00.000000 black-24.4.0/docs/integrations/index.md
+-rw-r--r--   0        0        0     1962 2020-02-02 00:00:00.000000 black-24.4.0/docs/integrations/source_version_control.md
+-rw-r--r--   0        0        0    20363 2020-02-02 00:00:00.000000 black-24.4.0/docs/the_black_code_style/current_style.md
+-rw-r--r--   0        0        0     8309 2020-02-02 00:00:00.000000 black-24.4.0/docs/the_black_code_style/future_style.md
+-rw-r--r--   0        0        0     2346 2020-02-02 00:00:00.000000 black-24.4.0/docs/the_black_code_style/index.md
+-rw-r--r--   0        0        0     4684 2020-02-02 00:00:00.000000 black-24.4.0/docs/usage_and_configuration/black_as_a_server.md
+-rw-r--r--   0        0        0     2173 2020-02-02 00:00:00.000000 black-24.4.0/docs/usage_and_configuration/black_docker_image.md
+-rw-r--r--   0        0        0     1870 2020-02-02 00:00:00.000000 black-24.4.0/docs/usage_and_configuration/file_collection_and_discovery.md
+-rw-r--r--   0        0        0      969 2020-02-02 00:00:00.000000 black-24.4.0/docs/usage_and_configuration/index.md
+-rw-r--r--   0        0        0    19326 2020-02-02 00:00:00.000000 black-24.4.0/docs/usage_and_configuration/the_basics.md
+-rw-r--r--   0        0        0      342 2020-02-02 00:00:00.000000 black-24.4.0/gallery/Dockerfile
+-rw-r--r--   0        0        0     1595 2020-02-02 00:00:00.000000 black-24.4.0/gallery/README.md
+-rwxr-xr-x   0        0        0     9105 2020-02-02 00:00:00.000000 black-24.4.0/gallery/gallery.py
+-rw-r--r--   0        0        0     2176 2020-02-02 00:00:00.000000 black-24.4.0/plugin/black.vim
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/scripts/__init__.py
+-rw-r--r--   0        0        0     1863 2020-02-02 00:00:00.000000 black-24.4.0/scripts/check_pre_commit_rev_in_example.py
+-rw-r--r--   0        0        0     1618 2020-02-02 00:00:00.000000 black-24.4.0/scripts/check_version_in_basics_example.py
+-rw-r--r--   0        0        0     8987 2020-02-02 00:00:00.000000 black-24.4.0/scripts/diff_shades_gha_helper.py
+-rw-r--r--   0        0        0     3553 2020-02-02 00:00:00.000000 black-24.4.0/scripts/fuzz.py
+-rwxr-xr-x   0        0        0     2381 2020-02-02 00:00:00.000000 black-24.4.0/scripts/generate_schema.py
+-rw-r--r--   0        0        0     2358 2020-02-02 00:00:00.000000 black-24.4.0/scripts/make_width_table.py
+-rwxr-xr-x   0        0        0     2987 2020-02-02 00:00:00.000000 black-24.4.0/scripts/migrate-black.py
+-rwxr-xr-x   0        0        0     7496 2020-02-02 00:00:00.000000 black-24.4.0/scripts/release.py
+-rw-r--r--   0        0        0     2321 2020-02-02 00:00:00.000000 black-24.4.0/scripts/release_tests.py
+-rw-r--r--   0        0        0       19 2020-02-02 00:00:00.000000 black-24.4.0/src/_black_version.py
+-rw-r--r--   0        0        0    51975 2020-02-02 00:00:00.000000 black-24.4.0/src/black/__init__.py
+-rw-r--r--   0        0        0       47 2020-02-02 00:00:00.000000 black-24.4.0/src/black/__main__.py
+-rw-r--r--   0        0        0    10761 2020-02-02 00:00:00.000000 black-24.4.0/src/black/_width_table.py
+-rw-r--r--   0        0        0    12426 2020-02-02 00:00:00.000000 black-24.4.0/src/black/brackets.py
+-rw-r--r--   0        0        0     4835 2020-02-02 00:00:00.000000 black-24.4.0/src/black/cache.py
+-rw-r--r--   0        0        0    15983 2020-02-02 00:00:00.000000 black-24.4.0/src/black/comments.py
+-rw-r--r--   0        0        0     6410 2020-02-02 00:00:00.000000 black-24.4.0/src/black/concurrency.py
+-rw-r--r--   0        0        0      321 2020-02-02 00:00:00.000000 black-24.4.0/src/black/const.py
+-rw-r--r--   0        0        0     1906 2020-02-02 00:00:00.000000 black-24.4.0/src/black/debug.py
+-rw-r--r--   0        0        0    14665 2020-02-02 00:00:00.000000 black-24.4.0/src/black/files.py
+-rw-r--r--   0        0        0    13364 2020-02-02 00:00:00.000000 black-24.4.0/src/black/handle_ipynb_magics.py
+-rw-r--r--   0        0        0    67512 2020-02-02 00:00:00.000000 black-24.4.0/src/black/linegen.py
+-rw-r--r--   0        0        0    39349 2020-02-02 00:00:00.000000 black-24.4.0/src/black/lines.py
+-rw-r--r--   0        0        0     8500 2020-02-02 00:00:00.000000 black-24.4.0/src/black/mode.py
+-rw-r--r--   0        0        0    28915 2020-02-02 00:00:00.000000 black-24.4.0/src/black/nodes.py
+-rw-r--r--   0        0        0     1655 2020-02-02 00:00:00.000000 black-24.4.0/src/black/numerics.py
+-rw-r--r--   0        0        0     3939 2020-02-02 00:00:00.000000 black-24.4.0/src/black/output.py
+-rw-r--r--   0        0        0     8428 2020-02-02 00:00:00.000000 black-24.4.0/src/black/parsing.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/src/black/py.typed
+-rw-r--r--   0        0        0    19695 2020-02-02 00:00:00.000000 black-24.4.0/src/black/ranges.py
+-rw-r--r--   0        0        0     3452 2020-02-02 00:00:00.000000 black-24.4.0/src/black/report.py
+-rw-r--r--   0        0        0      557 2020-02-02 00:00:00.000000 black-24.4.0/src/black/rusty.py
+-rw-r--r--   0        0        0      617 2020-02-02 00:00:00.000000 black-24.4.0/src/black/schema.py
+-rw-r--r--   0        0        0    10933 2020-02-02 00:00:00.000000 black-24.4.0/src/black/strings.py
+-rw-r--r--   0        0        0    95476 2020-02-02 00:00:00.000000 black-24.4.0/src/black/trans.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/src/black/resources/__init__.py
+-rw-r--r--   0        0        0     7433 2020-02-02 00:00:00.000000 black-24.4.0/src/black/resources/black.schema.json
+-rw-r--r--   0        0        0     8867 2020-02-02 00:00:00.000000 black-24.4.0/src/blackd/__init__.py
+-rw-r--r--   0        0        0       37 2020-02-02 00:00:00.000000 black-24.4.0/src/blackd/__main__.py
+-rw-r--r--   0        0        0     1585 2020-02-02 00:00:00.000000 black-24.4.0/src/blackd/middlewares.py
+-rw-r--r--   0        0        0    11351 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/Grammar.txt
+-rw-r--r--   0        0        0    12762 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/LICENSE
+-rw-r--r--   0        0        0      793 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/PatternGrammar.txt
+-rw-r--r--   0        0        0     1074 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/README
+-rw-r--r--   0        0        0        8 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/__init__.py
+-rw-r--r--   0        0        0     4810 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pygram.py
+-rw-r--r--   0        0        0    32666 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pytree.py
+-rw-r--r--   0        0        0      143 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/__init__.py
+-rw-r--r--   0        0        0     9587 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/conv.py
+-rw-r--r--   0        0        0    10631 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/driver.py
+-rw-r--r--   0        0        0     6858 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/grammar.py
+-rw-r--r--   0        0        0     1614 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/literals.py
+-rw-r--r--   0        0        0    15658 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/parse.py
+-rw-r--r--   0        0        0    15428 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/pgen.py
+-rw-r--r--   0        0        0     1805 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/token.py
+-rw-r--r--   0        0        0    23006 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/tokenize.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/__init__.py
+-rw-r--r--   0        0        0      727 2020-02-02 00:00:00.000000 black-24.4.0/tests/conftest.py
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.4.0/tests/empty.toml
+-rw-r--r--   0        0        0     4530 2020-02-02 00:00:00.000000 black-24.4.0/tests/optional.py
+-rw-r--r--   0        0        0      388 2020-02-02 00:00:00.000000 black-24.4.0/tests/test.toml
+-rw-r--r--   0        0        0   118890 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_black.py
+-rw-r--r--   0        0        0     9375 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_blackd.py
+-rw-r--r--   0        0        0     2531 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_docs.py
+-rw-r--r--   0        0        0     2683 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_format.py
+-rw-r--r--   0        0        0    16073 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_ipynb.py
+-rw-r--r--   0        0        0     1247 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_no_ipynb.py
+-rw-r--r--   0        0        0     4538 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_ranges.py
+-rw-r--r--   0        0        0      560 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_schema.py
+-rw-r--r--   0        0        0     2238 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_trans.py
+-rw-r--r--   0        0        0    12198 2020-02-02 00:00:00.000000 black-24.4.0/tests/util.py
+-rw-r--r--   0        0        0       99 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/empty_pyproject.toml
+-rw-r--r--   0        0        0       88 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/incorrect_spelling.toml
+-rw-r--r--   0        0        0       33 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_line_ranges.toml
+-rw-r--r--   0        0        0     1794 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/allow_empty_first_line.py
+-rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/async_stmts.py
+-rw-r--r--   0        0        0      907 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/attribute_access_on_number_literals.py
+-rw-r--r--   0        0        0       63 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/beginning_backslash.py
+-rw-r--r--   0        0        0      333 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/bracketmatch.py
+-rw-r--r--   0        0        0      511 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/bytes_docstring.py
+-rw-r--r--   0        0        0     1092 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/class_blank_parentheses.py
+-rw-r--r--   0        0        0     4318 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/class_methods_new_line.py
+-rw-r--r--   0        0        0     3294 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/collections.py
+-rw-r--r--   0        0        0      212 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comment_after_escaped_newline.py
+-rw-r--r--   0        0        0      174 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comment_type_hint.py
+-rw-r--r--   0        0        0     1909 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments.py
+-rw-r--r--   0        0        0     7640 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments2.py
+-rw-r--r--   0        0        0     1573 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments3.py
+-rw-r--r--   0        0        0     3532 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments4.py
+-rw-r--r--   0        0        0     1184 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments5.py
+-rw-r--r--   0        0        0     2479 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments6.py
+-rw-r--r--   0        0        0      298 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments8.py
+-rw-r--r--   0        0        0     5279 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments9.py
+-rw-r--r--   0        0        0     2150 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments_in_blocks.py
+-rw-r--r--   0        0        0     1142 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments_in_double_parens.py
+-rw-r--r--   0        0        0      994 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments_non_breaking_space.py
+-rw-r--r--   0        0        0     5596 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/composition.py
+-rw-r--r--   0        0        0    11196 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/composition_no_trailing_comma.py
+-rw-r--r--   0        0        0     4910 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/conditional_expression.py
+-rw-r--r--   0        0        0     1171 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/context_managers_38.py
+-rw-r--r--   0        0        0     3392 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/context_managers_39.py
+-rw-r--r--   0        0        0      627 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/context_managers_autodetect_310.py
+-rw-r--r--   0        0        0      585 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/context_managers_autodetect_311.py
+-rw-r--r--   0        0        0     1058 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/context_managers_autodetect_38.py
+-rw-r--r--   0        0        0      654 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/context_managers_autodetect_39.py
+-rw-r--r--   0        0        0     7978 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/docstring.py
+-rw-r--r--   0        0        0      118 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/docstring_newline_preview.py
+-rw-r--r--   0        0        0      140 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/docstring_no_extra_empty_line_before_eof.py
+-rw-r--r--   0        0        0     3638 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/docstring_no_string_normalization.py
+-rw-r--r--   0        0        0     3518 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/docstring_preview.py
+-rw-r--r--   0        0        0     2247 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/dummy_implementations.py
+-rw-r--r--   0        0        0     4597 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/empty_lines.py
+-rw-r--r--   0        0        0    15801 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/expression.diff
+-rw-r--r--   0        0        0    18624 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/expression.py
+-rw-r--r--   0        0        0      234 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/f_docstring.py
+-rw-r--r--   0        0        0     9635 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtonoff.py
+-rw-r--r--   0        0        0      604 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtonoff2.py
+-rw-r--r--   0        0        0      251 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtonoff3.py
+-rw-r--r--   0        0        0      278 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtonoff4.py
+-rw-r--r--   0        0        0     3619 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtonoff5.py
+-rw-r--r--   0        0        0      277 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtpass_imports.py
+-rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip.py
+-rw-r--r--   0        0        0      708 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip2.py
+-rw-r--r--   0        0        0      362 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip3.py
+-rw-r--r--   0        0        0       92 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip4.py
+-rw-r--r--   0        0        0      301 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip5.py
+-rw-r--r--   0        0        0      235 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip6.py
+-rw-r--r--   0        0        0      356 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip7.py
+-rw-r--r--   0        0        0     1705 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip8.py
+-rw-r--r--   0        0        0      113 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip9.py
+-rw-r--r--   0        0        0     1932 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/form_feeds.py
+-rw-r--r--   0        0        0      989 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fstring.py
+-rw-r--r--   0        0        0     5786 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/funcdef_return_type_trailing_comma.py
+-rw-r--r--   0        0        0     6408 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/function.py
+-rw-r--r--   0        0        0     2419 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/function2.py
+-rw-r--r--   0        0        0     3605 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/function_trailing_comma.py
+-rw-r--r--   0        0        0      520 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/ignore_pyi.py
+-rw-r--r--   0        0        0     2542 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/import_spacing.py
+-rw-r--r--   0        0        0      565 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/is_simple_lookup_for_doublestar_expression.py
+-rw-r--r--   0        0        0      547 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/keep_newline_after_match.py
+-rw-r--r--   0        0        0     3519 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_basic.py
+-rw-r--r--   0        0        0      954 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_diff_edge_case.py
+-rw-r--r--   0        0        0     1276 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_exceeding_end.py
+-rw-r--r--   0        0        0     1373 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_fmt_off.py
+-rw-r--r--   0        0        0      998 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_fmt_off_decorator.py
+-rw-r--r--   0        0        0     1155 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_fmt_off_overlap.py
+-rw-r--r--   0        0        0      346 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_imports.py
+-rw-r--r--   0        0        0      633 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_indentation.py
+-rw-r--r--   0        0        0      619 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_outside_source.py
+-rw-r--r--   0        0        0     1065 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_two_passes.py
+-rw-r--r--   0        0        0      591 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_unwrapping.py
+-rw-r--r--   0        0        0      126 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/linelength6.py
+-rw-r--r--   0        0        0    11608 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/long_strings_flag_disabled.py
+-rw-r--r--   0        0        0      329 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/module_docstring_1.py
+-rw-r--r--   0        0        0     2252 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/module_docstring_2.py
+-rw-r--r--   0        0        0      181 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/module_docstring_3.py
+-rw-r--r--   0        0        0      182 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/module_docstring_4.py
+-rw-r--r--   0        0        0      180 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/module_docstring_followed_by_class.py
+-rw-r--r--   0        0        0      196 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/module_docstring_followed_by_function.py
+-rw-r--r--   0        0        0      644 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/multiline_consecutive_open_parentheses_ignore.py
+-rw-r--r--   0        0        0     1243 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/nested_stub.py
+-rw-r--r--   0        0        0      988 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/no_blank_line_before_docstring.py
+-rw-r--r--   0        0        0      544 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/numeric_literals.py
+-rw-r--r--   0        0        0      215 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/numeric_literals_skip_underscores.py
+-rw-r--r--   0        0        0      674 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/one_element_subscript.py
+-rw-r--r--   0        0        0      797 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/parenthesized_context_managers.py
+-rw-r--r--   0        0        0     2965 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_complex.py
+-rw-r--r--   0        0        0     1796 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_extras.py
+-rw-r--r--   0        0        0     3098 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_generic.py
+-rw-r--r--   0        0        0      692 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_long.py
+-rw-r--r--   0        0        0     2673 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_simple.py
+-rw-r--r--   0        0        0     1093 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_style.py
+-rw-r--r--   0        0        0      547 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_trailing_comma.py
+-rw-r--r--   0        0        0     2190 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_with_if_stmt.py
+-rw-r--r--   0        0        0     4689 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep604_union_types_line_breaks.py
+-rw-r--r--   0        0        0      711 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_570.py
+-rw-r--r--   0        0        0     1001 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_572.py
+-rw-r--r--   0        0        0      514 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_572_do_not_remove_parens.py
+-rw-r--r--   0        0        0      531 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_572_py310.py
+-rw-r--r--   0        0        0      282 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_572_py39.py
+-rw-r--r--   0        0        0     1919 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_572_remove_parens.py
+-rw-r--r--   0        0        0       60 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_572_slices.py
+-rw-r--r--   0        0        0      583 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_604.py
+-rw-r--r--   0        0        0     2146 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_646.py
+-rw-r--r--   0        0        0     1004 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_654.py
+-rw-r--r--   0        0        0     2065 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_654_style.py
+-rw-r--r--   0        0        0      485 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/percent_precedence.py
+-rw-r--r--   0        0        0       94 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/power_op_newline.py
+-rw-r--r--   0        0        0     3533 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/power_op_spacing.py
+-rw-r--r--   0        0        0     2500 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/power_op_spacing_long.py
+-rw-r--r--   0        0        0     3270 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/prefer_rhs_split.py
+-rw-r--r--   0        0        0     1106 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/prefer_rhs_split_reformatted.py
+-rw-r--r--   0        0        0     3328 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_cantfit.py
+-rw-r--r--   0        0        0      829 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_cantfit_string.py
+-rw-r--r--   0        0        0     8996 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_comments7.py
+-rw-r--r--   0        0        0      632 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_format_unicode_escape_seq.py
+-rw-r--r--   0        0        0     5823 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets.py
+-rw-r--r--   0        0        0     4093 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets_no_ll1.py
+-rw-r--r--   0        0        0     3982 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_long_dict_values.py
+-rw-r--r--   0        0        0    36538 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_long_strings.py
+-rw-r--r--   0        0        0     1439 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_long_strings__east_asian_width.py
+-rw-r--r--   0        0        0     6556 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_long_strings__edge_case.py
+-rw-r--r--   0        0        0    45834 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_long_strings__regression.py
+-rw-r--r--   0        0        0     1094 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_long_strings__type_annotations.py
+-rw-r--r--   0        0        0     7861 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_multiline_strings.py
+-rw-r--r--   0        0        0      742 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_return_annotation_brackets_string.py
+-rw-r--r--   0        0        0      173 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/py310_pep572.py
+-rw-r--r--   0        0        0     1178 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/python37.py
+-rw-r--r--   0        0        0      813 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/python38.py
+-rw-r--r--   0        0        0      662 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/python39.py
+-rw-r--r--   0        0        0      292 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/raw_docstring.py
+-rw-r--r--   0        0        0      394 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/raw_docstring_no_string_normalization.py
+-rw-r--r--   0        0        0     3538 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/remove_await_parens.py
+-rw-r--r--   0        0        0     2025 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/remove_except_parens.py
+-rw-r--r--   0        0        0     1460 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/remove_for_brackets.py
+-rw-r--r--   0        0        0     3218 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/remove_newline_after_code_block_open.py
+-rw-r--r--   0        0        0     3493 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/remove_parens.py
+-rw-r--r--   0        0        0     1496 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/remove_redundant_parens_in_case_guard.py
+-rw-r--r--   0        0        0     2606 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/remove_with_brackets.py
+-rw-r--r--   0        0        0     5207 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/return_annotation_brackets.py
+-rw-r--r--   0        0        0      646 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/single_line_format_skip_with_multiple_comments.py
+-rw-r--r--   0        0        0     1435 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/skip_magic_trailing_comma.py
+-rw-r--r--   0        0        0      787 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/slices.py
+-rw-r--r--   0        0        0      817 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/split_delimiter_comments.py
+-rw-r--r--   0        0        0      412 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/starred_for_target.py
+-rw-r--r--   0        0        0      845 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/string_prefixes.py
+-rw-r--r--   0        0        0     2281 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/stub.py
+-rw-r--r--   0        0        0     2279 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/torture.py
+-rw-r--r--   0        0        0      655 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/trailing_comma.py
+-rw-r--r--   0        0        0     1615 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/trailing_comma_optional_parens1.py
+-rw-r--r--   0        0        0      248 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/trailing_comma_optional_parens2.py
+-rw-r--r--   0        0        0      967 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/trailing_comma_optional_parens3.py
+-rw-r--r--   0        0        0     2123 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/trailing_commas_in_leading_parts.py
+-rw-r--r--   0        0        0       80 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/tricky_unicode_symbols.py
+-rw-r--r--   0        0        0      510 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/tupleassign.py
+-rw-r--r--   0        0        0      458 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/type_aliases.py
+-rw-r--r--   0        0        0       93 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/type_comment_syntax_error.py
+-rw-r--r--   0        0        0     1144 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/type_params.py
+-rw-r--r--   0        0        0      544 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/typed_params_trailing_comma.py
+-rw-r--r--   0        0        0      269 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/walrus_in_dict.py
+-rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/whitespace.py
+-rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/gitignore_used_on_multiple_sources/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/gitignore_used_on_multiple_sources/dir1/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/gitignore_used_on_multiple_sources/dir1/b.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/gitignore_used_on_multiple_sources/dir2/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/gitignore_used_on_multiple_sources/dir2/b.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/ignore_subfolders_gitignore_tests/a.py
+-rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/ignore_subfolders_gitignore_tests/subdir/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/ignore_subfolders_gitignore_tests/subdir/b.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/ignore_subfolders_gitignore_tests/subdir/subdir/c.py
+-rw-r--r--   0        0        0       14 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/.gitignore
+-rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/pyproject.toml
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.pie
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.pyi
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/dont_exclude/a.pie
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/dont_exclude/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/dont_exclude/a.pyi
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/exclude/a.pie
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/exclude/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/exclude/a.pyi
+-rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_gitignore_tests/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_gitignore_tests/a.py
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_gitignore_tests/pyproject.toml
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_nested_gitignore_tests/a.py
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_nested_gitignore_tests/pyproject.toml
+-rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_nested_gitignore_tests/a/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_nested_gitignore_tests/a/a.py
+-rw-r--r--   0        0        0      436 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/jupyter/non_python_notebook.ipynb
+-rw-r--r--   0        0        0      369 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/jupyter/notebook_empty_metadata.ipynb
+-rw-r--r--   0        0        0      638 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/jupyter/notebook_no_trailing_newline.ipynb
+-rw-r--r--   0        0        0      639 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/jupyter/notebook_trailing_newline.ipynb
+-rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/jupyter/notebook_which_cant_be_parsed.ipynb
+-rw-r--r--   0        0        0      762 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/jupyter/notebook_without_changes.ipynb
+-rw-r--r--   0        0        0      853 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/line_ranges_formatted/basic.py
+-rw-r--r--   0        0        0      537 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/line_ranges_formatted/pattern_matching.py
+-rw-r--r--   0        0        0      495 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/async_as_identifier.py
+-rw-r--r--   0        0        0      255 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/blackd_diff.diff
+-rw-r--r--   0        0        0       98 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/blackd_diff.py
+-rw-r--r--   0        0        0    15604 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/debug_visitor.out
+-rw-r--r--   0        0        0     1193 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/debug_visitor.py
+-rw-r--r--   0        0        0     1774 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/decorators.py
+-rw-r--r--   0        0        0    15711 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff
+-rw-r--r--   0        0        0      600 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/force_py36.py
+-rw-r--r--   0        0        0      808 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/force_pyi.py
+-rw-r--r--   0        0        0       59 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/invalid_header.py
+-rw-r--r--   0        0        0      293 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/missing_final_newline.diff
+-rw-r--r--   0        0        0      145 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/missing_final_newline.py
+-rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/pattern_matching_invalid.py
+-rw-r--r--   0        0        0      758 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/python2_detection.py
+-rw-r--r--   0        0        0     2363 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/string_quotes.py
+-rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/pyproject.toml
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/x.py
+-rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/.gitignore
+-rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/a.py
+-rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/b.py
+-rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/c.py
+-rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/child/.gitignore
+-rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/child/a.py
+-rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/child/b.py
+-rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/child/c.py
+-rw-r--r--   0        0        0      132 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/project_metadata/both_pyproject.toml
+-rw-r--r--   0        0        0       73 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/project_metadata/neither_pyproject.toml
+-rw-r--r--   0        0        0      100 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/project_metadata/only_black_pyproject.toml
+-rw-r--r--   0        0        0      105 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/project_metadata/only_metadata_pyproject.toml
+-rw-r--r--   0        0        0      302 2020-02-02 00:00:00.000000 black-24.4.0/.gitignore
+-rw-r--r--   0        0        0     8092 2020-02-02 00:00:00.000000 black-24.4.0/AUTHORS.md
+-rw-r--r--   0        0        0     1080 2020-02-02 00:00:00.000000 black-24.4.0/LICENSE
+-rw-r--r--   0        0        0     8736 2020-02-02 00:00:00.000000 black-24.4.0/pyproject.toml
+-rw-r--r--   0        0        0    76430 2020-02-02 00:00:00.000000 black-24.4.0/PKG-INFO
```

### Comparing `black-24.3.0/.pre-commit-config.yaml` & `black-24.4.0/.pre-commit-config.yaml`

 * *Files 2% similar despite different names*

```diff
@@ -25,25 +25,25 @@
 
   - repo: https://github.com/pycqa/isort
     rev: 5.13.2
     hooks:
       - id: isort
 
   - repo: https://github.com/pycqa/flake8
-    rev: 6.1.0
+    rev: 7.0.0
     hooks:
       - id: flake8
         additional_dependencies:
           - flake8-bugbear
           - flake8-comprehensions
           - flake8-simplify
         exclude: ^src/blib2to3/
 
   - repo: https://github.com/pre-commit/mirrors-mypy
-    rev: v1.8.0
+    rev: v1.9.0
     hooks:
       - id: mypy
         exclude: ^(docs/conf.py|scripts/generate_schema.py)$
         args: []
         additional_dependencies: &mypy_deps
           - types-PyYAML
           - tomli >= 0.2.6, < 2.0.0
```

### Comparing `black-24.3.0/.pre-commit-hooks.yaml` & `black-24.4.0/.pre-commit-hooks.yaml`

 * *Files identical despite different names*

### Comparing `black-24.3.0/CHANGES.md` & `black-24.4.0/CHANGES.md`

 * *Files 0% similar despite different names*

```diff
@@ -1,9 +1,26 @@
 # Change Log
 
+## 24.4.0
+
+### Stable style
+
+- Fix unwanted crashes caused by AST equivalency check (#4290)
+
+### Preview style
+
+- `if` guards in `case` blocks are now wrapped in parentheses when the line is too long.
+  (#4269)
+- Stop moving multiline strings to a new line unless inside brackets (#4289)
+
+### Integrations
+
+- Add a new option `use_pyproject` to the GitHub Action `psf/black`. This will read the
+  Black version from `pyproject.toml`. (#4294)
+
 ## 24.3.0
 
 ### Highlights
 
 This release is a milestone: it fixes Black's first CVE security vulnerability. If you
 run Black on untrusted input, or if you habitually put thousands of leading tab
 characters in your docstrings, you are strongly encouraged to upgrade immediately to fix
```

### Comparing `black-24.3.0/CITATION.cff` & `black-24.4.0/CITATION.cff`

 * *Files identical despite different names*

### Comparing `black-24.3.0/Dockerfile` & `black-24.4.0/Dockerfile`

 * *Files identical despite different names*

### Comparing `black-24.3.0/README.md` & `black-24.4.0/README.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/action.yml` & `black-24.4.0/action.yml`

 * *Files 11% similar despite different names*

```diff
@@ -23,14 +23,18 @@
     default: ""
     deprecationMessage:
       "Input `with.black_args` is deprecated. Use `with.options` and `with.src` instead."
   version:
     description: 'Python Version specifier (PEP440) - e.g. "21.5b1"'
     required: false
     default: ""
+  use_pyproject:
+    description: Read Black version specifier from pyproject.toml if `true`.
+    required: false
+    default: "false"
   summary:
     description: "Whether to add the output to the workflow summary"
     required: false
     default: true
 branding:
   color: "black"
   icon: "check-circle"
@@ -66,9 +70,10 @@
       env:
         # TODO: Remove once https://github.com/actions/runner/issues/665 is fixed.
         INPUT_OPTIONS: ${{ inputs.options }}
         INPUT_SRC: ${{ inputs.src }}
         INPUT_JUPYTER: ${{ inputs.jupyter }}
         INPUT_BLACK_ARGS: ${{ inputs.black_args }}
         INPUT_VERSION: ${{ inputs.version }}
+        INPUT_USE_PYPROJECT: ${{ inputs.use_pyproject }}
         pythonioencoding: utf-8
       shell: bash
```

### Comparing `black-24.3.0/tox.ini` & `black-24.4.0/tox.ini`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/CODE_OF_CONDUCT.md` & `black-24.4.0/.github/CODE_OF_CONDUCT.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/PULL_REQUEST_TEMPLATE.md` & `black-24.4.0/.github/PULL_REQUEST_TEMPLATE.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/dependabot.yml` & `black-24.4.0/.github/dependabot.yml`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/ISSUE_TEMPLATE/bug_report.md` & `black-24.4.0/.github/ISSUE_TEMPLATE/bug_report.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/ISSUE_TEMPLATE/config.yml` & `black-24.4.0/.github/ISSUE_TEMPLATE/config.yml`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/ISSUE_TEMPLATE/docs-issue.md` & `black-24.4.0/.github/ISSUE_TEMPLATE/docs-issue.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/ISSUE_TEMPLATE/feature_request.md` & `black-24.4.0/.github/ISSUE_TEMPLATE/feature_request.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/ISSUE_TEMPLATE/style_issue.md` & `black-24.4.0/.github/ISSUE_TEMPLATE/style_issue.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/workflows/changelog.yml` & `black-24.4.0/.github/workflows/changelog.yml`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/workflows/diff_shades.yml` & `black-24.4.0/.github/workflows/diff_shades.yml`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/workflows/diff_shades_comment.yml` & `black-24.4.0/.github/workflows/diff_shades_comment.yml`

 * *Files 12% similar despite different names*

```diff
@@ -29,15 +29,15 @@
         run: >
           python scripts/diff_shades_gha_helper.py comment-details
           ${{github.event.workflow_run.id }}
 
       - name: Try to find pre-existing PR comment
         if: steps.metadata.outputs.needs-comment == 'true'
         id: find-comment
-        uses: peter-evans/find-comment@d5fe37641ad8451bdd80312415672ba26c86575e
+        uses: peter-evans/find-comment@3eae4d37986fb5a8592848f6a574fdf654e61f9e
         with:
           issue-number: ${{ steps.metadata.outputs.pr-number }}
           comment-author: "github-actions[bot]"
           body-includes: "diff-shades"
 
       - name: Create or update PR comment
         if: steps.metadata.outputs.needs-comment == 'true'
```

### Comparing `black-24.3.0/.github/workflows/doc.yml` & `black-24.4.0/.github/workflows/doc.yml`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/workflows/docker.yml` & `black-24.4.0/.github/workflows/docker.yml`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/workflows/fuzz.yml` & `black-24.4.0/.github/workflows/fuzz.yml`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/workflows/lint.yml` & `black-24.4.0/.github/workflows/lint.yml`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/workflows/pypi_upload.yml` & `black-24.4.0/.github/workflows/pypi_upload.yml`

 * *Files 1% similar despite different names*

```diff
@@ -85,15 +85,15 @@
     strategy:
       fail-fast: false
       matrix:
         include: ${{ fromJson(needs.generate_wheels_matrix.outputs.include) }}
 
     steps:
       - uses: actions/checkout@v4
-      - uses: pypa/cibuildwheel@v2.16.5
+      - uses: pypa/cibuildwheel@v2.17.0
         with:
           only: ${{ matrix.only }}
 
       - name: Upload wheels as workflow artifacts
         uses: actions/upload-artifact@v3
         with:
           name: ${{ matrix.name }}-mypyc-wheels
```

### Comparing `black-24.3.0/.github/workflows/release_tests.yml` & `black-24.4.0/.github/workflows/release_tests.yml`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/workflows/test.yml` & `black-24.4.0/.github/workflows/test.yml`

 * *Files identical despite different names*

### Comparing `black-24.3.0/.github/workflows/upload_binary.yml` & `black-24.4.0/.github/workflows/upload_binary.yml`

 * *Files identical despite different names*

### Comparing `black-24.3.0/autoload/black.vim` & `black-24.4.0/autoload/black.vim`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/Makefile` & `black-24.4.0/docs/Makefile`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/conf.py` & `black-24.4.0/docs/conf.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/faq.md` & `black-24.4.0/docs/faq.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/getting_started.md` & `black-24.4.0/docs/getting_started.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/index.md` & `black-24.4.0/docs/index.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/make.bat` & `black-24.4.0/docs/make.bat`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/_static/license.svg` & `black-24.4.0/docs/_static/license.svg`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/_static/logo2-readme.png` & `black-24.4.0/docs/_static/logo2-readme.png`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/_static/logo2.png` & `black-24.4.0/docs/_static/logo2.png`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/_static/pypi_template.svg` & `black-24.4.0/docs/_static/pypi_template.svg`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/contributing/gauging_changes.md` & `black-24.4.0/docs/contributing/gauging_changes.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/contributing/index.md` & `black-24.4.0/docs/contributing/index.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/contributing/issue_triage.md` & `black-24.4.0/docs/contributing/issue_triage.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/contributing/release_process.md` & `black-24.4.0/docs/contributing/release_process.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/contributing/the_basics.md` & `black-24.4.0/docs/contributing/the_basics.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/guides/introducing_black_to_your_project.md` & `black-24.4.0/docs/guides/introducing_black_to_your_project.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/guides/using_black_with_other_tools.md` & `black-24.4.0/docs/guides/using_black_with_other_tools.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/integrations/editors.md` & `black-24.4.0/docs/integrations/editors.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/integrations/github_actions.md` & `black-24.4.0/docs/integrations/github_actions.md`

 * *Files 8% similar despite different names*

```diff
@@ -28,20 +28,23 @@
       - uses: psf/black@stable
 ```
 
 We recommend the use of the `@stable` tag, but per version tags also exist if you prefer
 that. Note that the action's version you select is independent of the version of _Black_
 the action will use.
 
-The version of _Black_ the action will use can be configured via `version`. This can be
-any
+The version of _Black_ the action will use can be configured via `version` or read from
+the `pyproject.toml` file. `version` can be any
 [valid version specifier](https://packaging.python.org/en/latest/glossary/#term-Version-Specifier)
-or just the version number if you want an exact version. The action defaults to the
-latest release available on PyPI. Only versions available from PyPI are supported, so no
-commit SHAs or branch names.
+or just the version number if you want an exact version. To read the version from the
+`pyproject.toml` file instead, set `use_pyproject` to `true`. This will first look into
+the `tool.black.required-version` field, then the `project.dependencies` array and
+finally the `project.optional-dependencies` table. The action defaults to the latest
+release available on PyPI. Only versions available from PyPI are supported, so no commit
+SHAs or branch names.
 
 If you want to include Jupyter Notebooks, _Black_ must be installed with the `jupyter`
 extra. Installing the extra and including Jupyter Notebook files can be configured via
 `jupyter` (default is `false`).
 
 You can also configure the arguments passed to _Black_ via `options` (defaults to
 `'--check --diff'`) and `src` (default is `'.'`). Please note that the
@@ -66,7 +69,17 @@
 ```yaml
 - uses: psf/black@stable
   with:
     options: "--check --verbose"
     src: "./src"
     version: "~= 22.0"
 ```
+
+If you want to read the version from `pyproject.toml`, set `use_pyproject` to `true`:
+
+```yaml
+- uses: psf/black@stable
+  with:
+    options: "--check --verbose"
+    src: "./src"
+    use_pyproject: true
+```
```

### Comparing `black-24.3.0/docs/integrations/index.md` & `black-24.4.0/docs/integrations/index.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/integrations/source_version_control.md` & `black-24.4.0/docs/integrations/source_version_control.md`

 * *Files 1% similar despite different names*

```diff
@@ -4,15 +4,15 @@
 [have it installed](https://pre-commit.com/#install), add this to the
 `.pre-commit-config.yaml` in your repository:
 
 ```yaml
 repos:
   # Using this mirror lets us use mypyc-compiled black, which is about 2x faster
   - repo: https://github.com/psf/black-pre-commit-mirror
-    rev: 24.3.0
+    rev: 24.4.0
     hooks:
       - id: black
         # It is recommended to specify the latest version of Python
         # supported by your project here, or alternatively use
         # pre-commit's default_language_version, see
         # https://pre-commit.com/#top_level-default_language_version
         language_version: python3.11
@@ -31,15 +31,15 @@
 include Jupyter Notebooks. To use this hook, simply replace the hook's `id: black` with
 `id: black-jupyter` in the `.pre-commit-config.yaml`:
 
 ```yaml
 repos:
   # Using this mirror lets us use mypyc-compiled black, which is about 2x faster
   - repo: https://github.com/psf/black-pre-commit-mirror
-    rev: 24.3.0
+    rev: 24.4.0
     hooks:
       - id: black-jupyter
         # It is recommended to specify the latest version of Python
         # supported by your project here, or alternatively use
         # pre-commit's default_language_version, see
         # https://pre-commit.com/#top_level-default_language_version
         language_version: python3.11
```

### Comparing `black-24.3.0/docs/the_black_code_style/current_style.md` & `black-24.4.0/docs/the_black_code_style/current_style.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/the_black_code_style/future_style.md` & `black-24.4.0/docs/the_black_code_style/future_style.md`

 * *Files 2% similar despite different names*

```diff
@@ -30,14 +30,16 @@
   parameters
 - `is_simple_lookup_for_doublestar_expression`: fix line length computation for certain
   expressions that involve the power operator
 - `docstring_check_for_newline`: checks if there is a newline before the terminating
   quotes of a docstring
 - `remove_redundant_guard_parens`: Removes redundant parentheses in `if` guards for
   `case` blocks.
+- `parens_for_long_if_clauses_in_case_block`: Adds parentheses to `if` clauses in `case`
+  blocks when the line is too long
 
 (labels/unstable-features)=
 
 The unstable style additionally includes the following features:
 
 - `string_processing`: split long string literals and related changes
   ([see below](labels/string-processing))
```

### Comparing `black-24.3.0/docs/the_black_code_style/index.md` & `black-24.4.0/docs/the_black_code_style/index.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/usage_and_configuration/black_as_a_server.md` & `black-24.4.0/docs/usage_and_configuration/black_as_a_server.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/usage_and_configuration/black_docker_image.md` & `black-24.4.0/docs/usage_and_configuration/black_docker_image.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/usage_and_configuration/file_collection_and_discovery.md` & `black-24.4.0/docs/usage_and_configuration/file_collection_and_discovery.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/usage_and_configuration/index.md` & `black-24.4.0/docs/usage_and_configuration/index.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/docs/usage_and_configuration/the_basics.md` & `black-24.4.0/docs/usage_and_configuration/the_basics.md`

 * *Files 0% similar despite different names*

```diff
@@ -265,16 +265,16 @@
 Require a specific version of _Black_ to be running. This is useful for ensuring that
 all contributors to your project are using the same version, because different versions
 of _Black_ may format code a little differently. This option can be set in a
 configuration file for consistent results across environments.
 
 ```console
 $ black --version
-black, 24.3.0 (compiled: yes)
-$ black --required-version 24.3.0 -c "format = 'this'"
+black, 24.4.0 (compiled: yes)
+$ black --required-version 24.4.0 -c "format = 'this'"
 format = "this"
 $ black --required-version 31.5b2 -c "still = 'beta?!'"
 Oh no! 💥 💔 💥 The required version does not match the running version!
 ```
 
 You can also pass just the major version:
 
@@ -362,15 +362,15 @@
 
 #### `--version`
 
 You can check the version of _Black_ you have installed using the `--version` flag.
 
 ```console
 $ black --version
-black, 24.3.0
+black, 24.4.0
 ```
 
 #### `--config`
 
 Read configuration options from a configuration file. See
 [below](#configuration-via-a-file) for more details on the configuration file.
```

### Comparing `black-24.3.0/gallery/README.md` & `black-24.4.0/gallery/README.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/gallery/gallery.py` & `black-24.4.0/gallery/gallery.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/plugin/black.vim` & `black-24.4.0/plugin/black.vim`

 * *Files identical despite different names*

### Comparing `black-24.3.0/scripts/check_pre_commit_rev_in_example.py` & `black-24.4.0/scripts/check_pre_commit_rev_in_example.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/scripts/check_version_in_basics_example.py` & `black-24.4.0/scripts/check_version_in_basics_example.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/scripts/diff_shades_gha_helper.py` & `black-24.4.0/scripts/diff_shades_gha_helper.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/scripts/fuzz.py` & `black-24.4.0/scripts/fuzz.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/scripts/generate_schema.py` & `black-24.4.0/scripts/generate_schema.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/scripts/make_width_table.py` & `black-24.4.0/scripts/make_width_table.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/scripts/migrate-black.py` & `black-24.4.0/scripts/migrate-black.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/scripts/release.py` & `black-24.4.0/scripts/release.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/scripts/release_tests.py` & `black-24.4.0/scripts/release_tests.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/__init__.py` & `black-24.4.0/src/black/__init__.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/_width_table.py` & `black-24.4.0/src/black/_width_table.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/brackets.py` & `black-24.4.0/src/black/brackets.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/cache.py` & `black-24.4.0/src/black/cache.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/comments.py` & `black-24.4.0/src/black/comments.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/concurrency.py` & `black-24.4.0/src/black/concurrency.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/debug.py` & `black-24.4.0/src/black/debug.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/files.py` & `black-24.4.0/src/black/files.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/handle_ipynb_magics.py` & `black-24.4.0/src/black/handle_ipynb_magics.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/linegen.py` & `black-24.4.0/src/black/linegen.py`

 * *Files 1% similar despite different names*

```diff
@@ -1306,14 +1306,24 @@
         # Fixes a bug where invisible parens are not properly wrapped around
         # case blocks.
         if isinstance(child, Node) and child.type == syms.case_block:
             normalize_invisible_parens(
                 child, parens_after={"case"}, mode=mode, features=features
             )
 
+        # Add parentheses around if guards in case blocks
+        if (
+            isinstance(child, Node)
+            and child.type == syms.guard
+            and Preview.parens_for_long_if_clauses_in_case_block in mode
+        ):
+            normalize_invisible_parens(
+                child, parens_after={"if"}, mode=mode, features=features
+            )
+
         # Add parentheses around long tuple unpacking in assignments.
         if (
             index == 0
             and isinstance(child, Node)
             and child.type == syms.testlist_star_expr
         ):
             check_lpar = True
```

### Comparing `black-24.3.0/src/black/lines.py` & `black-24.4.0/src/black/lines.py`

 * *Files 1% similar despite different names*

```diff
@@ -854,19 +854,21 @@
                 # Have left the level with the MLS, stop tracking commas
                 max_level_to_update = leaf.bracket_depth
                 if had_comma > 0:
                     # MLS was in parens with at least one comma - force split
                     return False
 
         if leaf.bracket_depth <= max_level_to_update and leaf.type == token.COMMA:
-            # Ignore non-nested trailing comma
+            # Inside brackets, ignore trailing comma
             # directly after MLS/MLS-containing expression
             ignore_ctxs: List[Optional[LN]] = [None]
             ignore_ctxs += multiline_string_contexts
-            if not (leaf.prev_sibling in ignore_ctxs and i == len(line.leaves) - 1):
+            if (line.inside_brackets or leaf.bracket_depth > 0) and (
+                i != len(line.leaves) - 1 or leaf.prev_sibling not in ignore_ctxs
+            ):
                 commas[leaf.bracket_depth] += 1
         if max_level_to_update != math.inf:
             max_level_to_update = min(max_level_to_update, leaf.bracket_depth)
 
         if is_multiline_string(leaf):
             if len(multiline_string_contexts) > 0:
                 # >1 multiline string cannot fit on a single line - force split
```

### Comparing `black-24.3.0/src/black/mode.py` & `black-24.4.0/src/black/mode.py`

 * *Files 3% similar despite different names*

```diff
@@ -176,14 +176,15 @@
     no_normalize_fmt_skip_whitespace = auto()
     wrap_long_dict_values_in_parens = auto()
     multiline_string_handling = auto()
     typed_params_trailing_comma = auto()
     is_simple_lookup_for_doublestar_expression = auto()
     docstring_check_for_newline = auto()
     remove_redundant_guard_parens = auto()
+    parens_for_long_if_clauses_in_case_block = auto()
 
 
 UNSTABLE_FEATURES: Set[Preview] = {
     # Many issues, see summary in https://github.com/psf/black/issues/4042
     Preview.string_processing,
     # See issues #3452 and #4158
     Preview.wrap_long_dict_values_in_parens,
```

### Comparing `black-24.3.0/src/black/nodes.py` & `black-24.4.0/src/black/nodes.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/numerics.py` & `black-24.4.0/src/black/numerics.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/output.py` & `black-24.4.0/src/black/output.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/parsing.py` & `black-24.4.0/src/black/parsing.py`

 * *Files 5% similar despite different names*

```diff
@@ -219,19 +219,17 @@
         else:
             normalized: object
             if (
                 isinstance(node, ast.Constant)
                 and field == "value"
                 and isinstance(value, str)
                 and len(parent_stack) >= 2
+                # Any standalone string, ideally this would
+                # exactly match black.nodes.is_docstring
                 and isinstance(parent_stack[-1], ast.Expr)
-                and isinstance(
-                    parent_stack[-2],
-                    (ast.FunctionDef, ast.AsyncFunctionDef, ast.Module, ast.ClassDef),
-                )
             ):
                 # Constant strings may be indented across newlines, if they are
                 # docstrings; fold spaces after newlines when comparing. Similarly,
                 # trailing and leading space may be removed.
                 normalized = _normalize("\n", value)
             elif field == "type_comment" and isinstance(value, str):
                 # Trailing whitespace in type comments is removed.
```

### Comparing `black-24.3.0/src/black/ranges.py` & `black-24.4.0/src/black/ranges.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/report.py` & `black-24.4.0/src/black/report.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/rusty.py` & `black-24.4.0/src/black/rusty.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/schema.py` & `black-24.4.0/src/black/schema.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/strings.py` & `black-24.4.0/src/black/strings.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/trans.py` & `black-24.4.0/src/black/trans.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/black/resources/black.schema.json` & `black-24.4.0/src/black/resources/black.schema.json`

 * *Files 1% similar despite different names*

#### Pretty-printed

 * *Similarity: 0.9999879436728395%*

 * *Differences: {"'properties'": "{'enable-unstable-feature': {'items': {'enum': {insert: [(11, "*

 * *                 "'parens_for_long_if_clauses_in_case_block')]}}}}"}*

```diff
@@ -33,15 +33,16 @@
                     "unify_docstring_detection",
                     "no_normalize_fmt_skip_whitespace",
                     "wrap_long_dict_values_in_parens",
                     "multiline_string_handling",
                     "typed_params_trailing_comma",
                     "is_simple_lookup_for_doublestar_expression",
                     "docstring_check_for_newline",
-                    "remove_redundant_guard_parens"
+                    "remove_redundant_guard_parens",
+                    "parens_for_long_if_clauses_in_case_block"
                 ]
             },
             "type": "array"
         },
         "exclude": {
             "description": "A regular expression that matches files and directories that should be excluded on recursive searches. An empty value means no paths are excluded. Use forward slashes for directories on all platforms (Windows, too). By default, Black also ignores all paths listed in .gitignore. Changing this value will override all default exclusions. [default: /(\\.direnv|\\.eggs|\\.git|\\.hg|\\.ipynb_checkpoints|\\.mypy_cache|\\.nox|\\.pytest_cache|\\.ruff_cache|\\.tox|\\.svn|\\.venv|\\.vscode|__pypackages__|_build|buck-out|build|dist|venv)/]",
             "type": "string"
```

### Comparing `black-24.3.0/src/blackd/__init__.py` & `black-24.4.0/src/blackd/__init__.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/blackd/middlewares.py` & `black-24.4.0/src/blackd/middlewares.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/blib2to3/Grammar.txt` & `black-24.4.0/src/blib2to3/Grammar.txt`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/blib2to3/LICENSE` & `black-24.4.0/src/blib2to3/LICENSE`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/blib2to3/PatternGrammar.txt` & `black-24.4.0/src/blib2to3/PatternGrammar.txt`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/blib2to3/README` & `black-24.4.0/src/blib2to3/README`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/blib2to3/pygram.py` & `black-24.4.0/src/blib2to3/pygram.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/blib2to3/pytree.py` & `black-24.4.0/src/blib2to3/pytree.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/blib2to3/pgen2/conv.py` & `black-24.4.0/src/blib2to3/pgen2/conv.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/blib2to3/pgen2/driver.py` & `black-24.4.0/src/blib2to3/pgen2/driver.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/blib2to3/pgen2/grammar.py` & `black-24.4.0/src/blib2to3/pgen2/grammar.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/blib2to3/pgen2/literals.py` & `black-24.4.0/src/blib2to3/pgen2/literals.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/blib2to3/pgen2/parse.py` & `black-24.4.0/src/blib2to3/pgen2/parse.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/blib2to3/pgen2/pgen.py` & `black-24.4.0/src/blib2to3/pgen2/pgen.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/blib2to3/pgen2/token.py` & `black-24.4.0/src/blib2to3/pgen2/token.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/src/blib2to3/pgen2/tokenize.py` & `black-24.4.0/src/blib2to3/pgen2/tokenize.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/conftest.py` & `black-24.4.0/tests/conftest.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/optional.py` & `black-24.4.0/tests/optional.py`

 * *Files 2% similar despite different names*

```diff
@@ -89,15 +89,15 @@
     # collect requested optional tests
     passed_args = config.getoption("run_optional")
     if passed_args:
         ot_run.update(itertools.chain.from_iterable(a.split(",") for a in passed_args))
     ot_run |= {no(excluded) for excluded in ot_markers - ot_run}
     ot_markers |= {no(m) for m in ot_markers}
 
-    log.info("optional tests to run:", ot_run)
+    log.info("optional tests to run: %s", ot_run)
     unknown_tests = ot_run - ot_markers
     if unknown_tests:
         raise ValueError(f"Unknown optional tests wanted: {unknown_tests!r}")
 
     store = config._store
     store[ALL_POSSIBLE_OPTIONAL_MARKERS] = frozenset(ot_markers)
     store[ENABLED_OPTIONAL_MARKERS] = frozenset(ot_run)
@@ -111,15 +111,15 @@
     for item in items:
         all_markers_on_test = {m.name for m in item.iter_markers()}
         optional_markers_on_test = all_markers_on_test & all_possible_optional_markers
         if not optional_markers_on_test or (
             optional_markers_on_test & enabled_optional_markers
         ):
             continue
-        log.info("skipping non-requested optional", item)
+        log.info("skipping non-requested optional: %s", item)
         item.add_marker(skip_mark(frozenset(optional_markers_on_test)))
 
 
 @lru_cache()
 def skip_mark(tests: FrozenSet[str]) -> "MarkDecorator":
     names = ", ".join(sorted(tests))
     return pytest.mark.skip(reason=f"Marked with disabled optional tests ({names})")
```

### Comparing `black-24.3.0/tests/test_black.py` & `black-24.4.0/tests/test_black.py`

 * *Files 1% similar despite different names*

```diff
@@ -1174,6246 +1174,6258 @@
 00004950: 6f6a 6563 745f 726f 6f74 203d 2050 6174  oject_root = Pat
 00004960: 6828 5448 4953 5f44 4952 202f 2022 6461  h(THIS_DIR / "da
 00004970: 7461 2220 2f20 226e 6573 7465 645f 6769  ta" / "nested_gi
 00004980: 7469 676e 6f72 655f 7465 7374 7322 290a  tignore_tests").
 00004990: 2020 2020 2020 2020 776f 726b 696e 675f          working_
 000049a0: 6469 7265 6374 6f72 7920 3d20 7072 6f6a  directory = proj
 000049b0: 6563 745f 726f 6f74 202f 2022 726f 6f74  ect_root / "root
-000049c0: 220a 2020 2020 2020 2020 7461 7267 6574  ".        target
-000049d0: 5f61 6273 7061 7468 203d 2077 6f72 6b69  _abspath = worki
-000049e0: 6e67 5f64 6972 6563 746f 7279 202f 2022  ng_directory / "
-000049f0: 6368 696c 6422 0a20 2020 2020 2020 2074  child".        t
-00004a00: 6172 6765 745f 636f 6e74 656e 7473 203d  arget_contents =
-00004a10: 206c 6973 7428 7461 7267 6574 5f61 6273   list(target_abs
-00004a20: 7061 7468 2e69 7465 7264 6972 2829 290a  path.iterdir()).
-00004a30: 0a20 2020 2020 2020 2064 6566 206d 6f63  .        def moc
-00004a40: 6b5f 6e5f 6361 6c6c 7328 7265 7370 6f6e  k_n_calls(respon
-00004a50: 7365 733a 204c 6973 745b 626f 6f6c 5d29  ses: List[bool])
-00004a60: 202d 3e20 4361 6c6c 6162 6c65 5b5b 5d2c   -> Callable[[],
-00004a70: 2062 6f6f 6c5d 3a0a 2020 2020 2020 2020   bool]:.        
-00004a80: 2020 2020 6465 6620 5f6d 6f63 6b65 645f      def _mocked_
-00004a90: 6361 6c6c 7328 2920 2d3e 2062 6f6f 6c3a  calls() -> bool:
-00004aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004ab0: 2069 6620 7265 7370 6f6e 7365 733a 0a20   if responses:. 
-00004ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ad0: 2020 2072 6574 7572 6e20 7265 7370 6f6e     return respon
-00004ae0: 7365 732e 706f 7028 3029 0a20 2020 2020  ses.pop(0).     
-00004af0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00004b00: 6e20 4661 6c73 650a 0a20 2020 2020 2020  n False..       
-00004b10: 2020 2020 2072 6574 7572 6e20 5f6d 6f63       return _moc
-00004b20: 6b65 645f 6361 6c6c 730a 0a20 2020 2020  ked_calls..     
-00004b30: 2020 2077 6974 6820 7061 7463 6828 2270     with patch("p
-00004b40: 6174 686c 6962 2e50 6174 682e 6974 6572  athlib.Path.iter
-00004b50: 6469 7222 2c20 7265 7475 726e 5f76 616c  dir", return_val
-00004b60: 7565 3d74 6172 6765 745f 636f 6e74 656e  ue=target_conten
-00004b70: 7473 292c 2070 6174 6368 280a 2020 2020  ts), patch(.    
-00004b80: 2020 2020 2020 2020 2270 6174 686c 6962          "pathlib
-00004b90: 2e50 6174 682e 7265 736f 6c76 6522 2c20  .Path.resolve", 
-00004ba0: 7265 7475 726e 5f76 616c 7565 3d74 6172  return_value=tar
-00004bb0: 6765 745f 6162 7370 6174 680a 2020 2020  get_abspath.    
-00004bc0: 2020 2020 292c 2070 6174 6368 2822 7061      ), patch("pa
-00004bd0: 7468 6c69 622e 5061 7468 2e69 735f 6469  thlib.Path.is_di
-00004be0: 7222 2c20 7369 6465 5f65 6666 6563 743d  r", side_effect=
-00004bf0: 6d6f 636b 5f6e 5f63 616c 6c73 285b 5472  mock_n_calls([Tr
-00004c00: 7565 5d29 293a 0a20 2020 2020 2020 2020  ue])):.         
-00004c10: 2020 2023 204e 6f74 6520 7468 6174 2074     # Note that t
-00004c20: 6865 2072 6f6f 7420 666f 6c64 6572 2028  he root folder (
-00004c30: 7072 6f6a 6563 745f 726f 6f74 2920 6973  project_root) is
-00004c40: 6e27 7420 7468 6520 666f 6c64 6572 0a20  n't the folder. 
-00004c50: 2020 2020 2020 2020 2020 2023 206e 616d             # nam
-00004c60: 6564 2022 726f 6f74 2220 2861 6b61 2077  ed "root" (aka w
-00004c70: 6f72 6b69 6e67 5f64 6972 6563 746f 7279  orking_directory
-00004c80: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00004c90: 706f 7274 203d 204d 6167 6963 4d6f 636b  port = MagicMock
-00004ca0: 2876 6572 626f 7365 3d54 7275 6529 0a20  (verbose=True). 
-00004cb0: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-00004cc0: 2e67 6574 5f73 6f75 7263 6573 280a 2020  .get_sources(.  
-00004cd0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-00004ce0: 6f74 3d70 726f 6a65 6374 5f72 6f6f 742c  ot=project_root,
-00004cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004d00: 2073 7263 3d28 222e 2f63 6869 6c64 222c   src=("./child",
-00004d10: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00004d20: 2020 2071 7569 6574 3d46 616c 7365 2c0a     quiet=False,.
-00004d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d40: 7665 7262 6f73 653d 5472 7565 2c0a 2020  verbose=True,.  
-00004d50: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00004d60: 636c 7564 653d 4445 4641 554c 545f 494e  clude=DEFAULT_IN
-00004d70: 434c 5544 452c 0a20 2020 2020 2020 2020  CLUDE,.         
-00004d80: 2020 2020 2020 2065 7863 6c75 6465 3d4e         exclude=N
-00004d90: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-00004da0: 2020 2020 2072 6570 6f72 743d 7265 706f       report=repo
-00004db0: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
-00004dc0: 2020 2020 6578 7465 6e64 5f65 7863 6c75      extend_exclu
-00004dd0: 6465 3d4e 6f6e 652c 0a20 2020 2020 2020  de=None,.       
-00004de0: 2020 2020 2020 2020 2066 6f72 6365 5f65           force_e
-00004df0: 7863 6c75 6465 3d4e 6f6e 652c 0a20 2020  xclude=None,.   
-00004e00: 2020 2020 2020 2020 2020 2020 2073 7464               std
-00004e10: 696e 5f66 696c 656e 616d 653d 4e6f 6e65  in_filename=None
-00004e20: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00004e30: 2020 2020 2020 2020 6173 7365 7274 206e          assert n
-00004e40: 6f74 2061 6e79 280a 2020 2020 2020 2020  ot any(.        
-00004e50: 2020 2020 6d6f 636b 5f61 7267 735b 315d      mock_args[1]
-00004e60: 2e73 7461 7274 7377 6974 6828 2269 7320  .startswith("is 
-00004e70: 6120 7379 6d62 6f6c 6963 206c 696e 6b20  a symbolic link 
-00004e80: 7468 6174 2070 6f69 6e74 7320 6f75 7473  that points outs
-00004e90: 6964 6522 290a 2020 2020 2020 2020 2020  ide").          
-00004ea0: 2020 666f 7220 5f2c 206d 6f63 6b5f 6172    for _, mock_ar
-00004eb0: 6773 2c20 5f20 696e 2072 6570 6f72 742e  gs, _ in report.
-00004ec0: 7061 7468 5f69 676e 6f72 6564 2e6d 6f63  path_ignored.moc
-00004ed0: 6b5f 6361 6c6c 730a 2020 2020 2020 2020  k_calls.        
-00004ee0: 292c 2022 4120 7379 6d62 6f6c 6963 206c  ), "A symbolic l
-00004ef0: 696e 6b20 7761 7320 7265 706f 7274 6564  ink was reported
-00004f00: 2e22 0a20 2020 2020 2020 2072 6570 6f72  .".        repor
-00004f10: 742e 7061 7468 5f69 676e 6f72 6564 2e61  t.path_ignored.a
-00004f20: 7373 6572 745f 6361 6c6c 6564 5f6f 6e63  ssert_called_onc
-00004f30: 655f 7769 7468 280a 2020 2020 2020 2020  e_with(.        
-00004f40: 2020 2020 5061 7468 2877 6f72 6b69 6e67      Path(working
-00004f50: 5f64 6972 6563 746f 7279 2c20 2263 6869  _directory, "chi
-00004f60: 6c64 222c 2022 622e 7079 2229 2c0a 2020  ld", "b.py"),.  
-00004f70: 2020 2020 2020 2020 2020 226d 6174 6368            "match
-00004f80: 6573 2061 202e 6769 7469 676e 6f72 6520  es a .gitignore 
-00004f90: 6669 6c65 2063 6f6e 7465 6e74 222c 0a20  file content",. 
-00004fa0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00004fb0: 6620 7465 7374 5f72 6570 6f72 745f 7665  f test_report_ve
-00004fc0: 7262 6f73 6528 7365 6c66 2920 2d3e 204e  rbose(self) -> N
-00004fd0: 6f6e 653a 0a20 2020 2020 2020 2072 6570  one:.        rep
-00004fe0: 6f72 7420 3d20 5265 706f 7274 2876 6572  ort = Report(ver
-00004ff0: 626f 7365 3d54 7275 6529 0a20 2020 2020  bose=True).     
-00005000: 2020 206f 7574 5f6c 696e 6573 203d 205b     out_lines = [
-00005010: 5d0a 2020 2020 2020 2020 6572 725f 6c69  ].        err_li
-00005020: 6e65 7320 3d20 5b5d 0a0a 2020 2020 2020  nes = []..      
-00005030: 2020 6465 6620 6f75 7428 6d73 673a 2073    def out(msg: s
-00005040: 7472 2c20 2a2a 6b77 6172 6773 3a20 416e  tr, **kwargs: An
-00005050: 7929 202d 3e20 4e6f 6e65 3a0a 2020 2020  y) -> None:.    
-00005060: 2020 2020 2020 2020 6f75 745f 6c69 6e65          out_line
-00005070: 732e 6170 7065 6e64 286d 7367 290a 0a20  s.append(msg).. 
-00005080: 2020 2020 2020 2064 6566 2065 7272 286d         def err(m
-00005090: 7367 3a20 7374 722c 202a 2a6b 7761 7267  sg: str, **kwarg
-000050a0: 733a 2041 6e79 2920 2d3e 204e 6f6e 653a  s: Any) -> None:
-000050b0: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
-000050c0: 5f6c 696e 6573 2e61 7070 656e 6428 6d73  _lines.append(ms
-000050d0: 6729 0a0a 2020 2020 2020 2020 7769 7468  g)..        with
-000050e0: 2070 6174 6368 2822 626c 6163 6b2e 6f75   patch("black.ou
-000050f0: 7470 7574 2e5f 6f75 7422 2c20 6f75 7429  tput._out", out)
-00005100: 2c20 7061 7463 6828 2262 6c61 636b 2e6f  , patch("black.o
-00005110: 7574 7075 742e 5f65 7272 222c 2065 7272  utput._err", err
-00005120: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00005130: 6570 6f72 742e 646f 6e65 2850 6174 6828  eport.done(Path(
-00005140: 2266 3122 292c 2062 6c61 636b 2e43 6861  "f1"), black.Cha
-00005150: 6e67 6564 2e4e 4f29 0a20 2020 2020 2020  nged.NO).       
-00005160: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00005170: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
-00005180: 6e65 7329 2c20 3129 0a20 2020 2020 2020  nes), 1).       
-00005190: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000051a0: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
-000051b0: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
-000051c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000051d0: 4571 7561 6c28 6f75 745f 6c69 6e65 735b  Equal(out_lines[
-000051e0: 2d31 5d2c 2022 6631 2061 6c72 6561 6479  -1], "f1 already
-000051f0: 2077 656c 6c20 666f 726d 6174 7465 642c   well formatted,
-00005200: 2067 6f6f 6420 6a6f 622e 2229 0a20 2020   good job.").   
-00005210: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00005220: 7365 7274 4571 7561 6c28 756e 7374 796c  sertEqual(unstyl
-00005230: 6528 7374 7228 7265 706f 7274 2929 2c20  e(str(report)), 
-00005240: 2231 2066 696c 6520 6c65 6674 2075 6e63  "1 file left unc
-00005250: 6861 6e67 6564 2e22 290a 2020 2020 2020  hanged.").      
-00005260: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00005270: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
-00005280: 7475 726e 5f63 6f64 652c 2030 290a 2020  turn_code, 0).  
-00005290: 2020 2020 2020 2020 2020 7265 706f 7274            report
-000052a0: 2e64 6f6e 6528 5061 7468 2822 6632 2229  .done(Path("f2")
-000052b0: 2c20 626c 6163 6b2e 4368 616e 6765 642e  , black.Changed.
-000052c0: 5945 5329 0a20 2020 2020 2020 2020 2020  YES).           
-000052d0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000052e0: 6c28 6c65 6e28 6f75 745f 6c69 6e65 7329  l(len(out_lines)
-000052f0: 2c20 3229 0a20 2020 2020 2020 2020 2020  , 2).           
-00005300: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00005310: 6c28 6c65 6e28 6572 725f 6c69 6e65 7329  l(len(err_lines)
-00005320: 2c20 3029 0a20 2020 2020 2020 2020 2020  , 0).           
-00005330: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00005340: 6c28 6f75 745f 6c69 6e65 735b 2d31 5d2c  l(out_lines[-1],
-00005350: 2022 7265 666f 726d 6174 7465 6420 6632   "reformatted f2
-00005360: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
-00005370: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005390: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
-000053a0: 6f72 7429 292c 2022 3120 6669 6c65 2072  ort)), "1 file r
-000053b0: 6566 6f72 6d61 7474 6564 2c20 3120 6669  eformatted, 1 fi
-000053c0: 6c65 206c 6566 7420 756e 6368 616e 6765  le left unchange
-000053d0: 642e 220a 2020 2020 2020 2020 2020 2020  d.".            
-000053e0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-000053f0: 706f 7274 2e64 6f6e 6528 5061 7468 2822  port.done(Path("
-00005400: 6633 2229 2c20 626c 6163 6b2e 4368 616e  f3"), black.Chan
-00005410: 6765 642e 4341 4348 4544 290a 2020 2020  ged.CACHED).    
-00005420: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00005430: 6572 7445 7175 616c 286c 656e 286f 7574  ertEqual(len(out
-00005440: 5f6c 696e 6573 292c 2033 290a 2020 2020  _lines), 3).    
-00005450: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00005460: 6572 7445 7175 616c 286c 656e 2865 7272  ertEqual(len(err
-00005470: 5f6c 696e 6573 292c 2030 290a 2020 2020  _lines), 0).    
-00005480: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00005490: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
-000054a0: 2020 2020 2020 2020 2020 6f75 745f 6c69            out_li
-000054b0: 6e65 735b 2d31 5d2c 2022 6633 2077 6173  nes[-1], "f3 was
-000054c0: 6e27 7420 6d6f 6469 6669 6564 206f 6e20  n't modified on 
-000054d0: 6469 736b 2073 696e 6365 206c 6173 7420  disk since last 
-000054e0: 7275 6e2e 220a 2020 2020 2020 2020 2020  run.".          
-000054f0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00005500: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00005510: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00005520: 2020 756e 7374 796c 6528 7374 7228 7265    unstyle(str(re
-00005530: 706f 7274 2929 2c20 2231 2066 696c 6520  port)), "1 file 
-00005540: 7265 666f 726d 6174 7465 642c 2032 2066  reformatted, 2 f
-00005550: 696c 6573 206c 6566 7420 756e 6368 616e  iles left unchan
-00005560: 6765 642e 220a 2020 2020 2020 2020 2020  ged.".          
-00005570: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00005580: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00005590: 2872 6570 6f72 742e 7265 7475 726e 5f63  (report.return_c
-000055a0: 6f64 652c 2030 290a 2020 2020 2020 2020  ode, 0).        
-000055b0: 2020 2020 7265 706f 7274 2e63 6865 636b      report.check
-000055c0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-000055d0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000055e0: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
-000055f0: 726e 5f63 6f64 652c 2031 290a 2020 2020  rn_code, 1).    
-00005600: 2020 2020 2020 2020 7265 706f 7274 2e63          report.c
-00005610: 6865 636b 203d 2046 616c 7365 0a20 2020  heck = False.   
-00005620: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
-00005630: 6661 696c 6564 2850 6174 6828 2265 3122  failed(Path("e1"
-00005640: 292c 2022 626f 6f6d 2229 0a20 2020 2020  ), "boom").     
-00005650: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005660: 7274 4571 7561 6c28 6c65 6e28 6f75 745f  rtEqual(len(out_
-00005670: 6c69 6e65 7329 2c20 3329 0a20 2020 2020  lines), 3).     
-00005680: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005690: 7274 4571 7561 6c28 6c65 6e28 6572 725f  rtEqual(len(err_
-000056a0: 6c69 6e65 7329 2c20 3129 0a20 2020 2020  lines), 1).     
-000056b0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000056c0: 7274 4571 7561 6c28 6572 725f 6c69 6e65  rtEqual(err_line
-000056d0: 735b 2d31 5d2c 2022 6572 726f 723a 2063  s[-1], "error: c
-000056e0: 616e 6e6f 7420 666f 726d 6174 2065 313a  annot format e1:
-000056f0: 2062 6f6f 6d22 290a 2020 2020 2020 2020   boom").        
-00005700: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005710: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-00005720: 2020 2020 2020 756e 7374 796c 6528 7374        unstyle(st
-00005730: 7228 7265 706f 7274 2929 2c0a 2020 2020  r(report)),.    
-00005740: 2020 2020 2020 2020 2020 2020 2231 2066              "1 f
-00005750: 696c 6520 7265 666f 726d 6174 7465 642c  ile reformatted,
-00005760: 2032 2066 696c 6573 206c 6566 7420 756e   2 files left un
-00005770: 6368 616e 6765 642c 2031 2066 696c 6520  changed, 1 file 
-00005780: 6661 696c 6564 2074 6f22 0a20 2020 2020  failed to".     
-00005790: 2020 2020 2020 2020 2020 2022 2072 6566             " ref
-000057a0: 6f72 6d61 742e 222c 0a20 2020 2020 2020  ormat.",.       
-000057b0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000057c0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000057d0: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
-000057e0: 6e5f 636f 6465 2c20 3132 3329 0a20 2020  n_code, 123).   
-000057f0: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
-00005800: 646f 6e65 2850 6174 6828 2266 3322 292c  done(Path("f3"),
-00005810: 2062 6c61 636b 2e43 6861 6e67 6564 2e59   black.Changed.Y
-00005820: 4553 290a 2020 2020 2020 2020 2020 2020  ES).            
-00005830: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00005840: 286c 656e 286f 7574 5f6c 696e 6573 292c  (len(out_lines),
-00005850: 2034 290a 2020 2020 2020 2020 2020 2020   4).            
-00005860: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00005870: 286c 656e 2865 7272 5f6c 696e 6573 292c  (len(err_lines),
-00005880: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
-00005890: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000058a0: 286f 7574 5f6c 696e 6573 5b2d 315d 2c20  (out_lines[-1], 
-000058b0: 2272 6566 6f72 6d61 7474 6564 2066 3322  "reformatted f3"
-000058c0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000058d0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
-000058e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000058f0: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
-00005900: 7274 2929 2c0a 2020 2020 2020 2020 2020  rt)),.          
-00005910: 2020 2020 2020 2232 2066 696c 6573 2072        "2 files r
-00005920: 6566 6f72 6d61 7474 6564 2c20 3220 6669  eformatted, 2 fi
-00005930: 6c65 7320 6c65 6674 2075 6e63 6861 6e67  les left unchang
-00005940: 6564 2c20 3120 6669 6c65 2066 6169 6c65  ed, 1 file faile
-00005950: 6420 746f 220a 2020 2020 2020 2020 2020  d to".          
-00005960: 2020 2020 2020 2220 7265 666f 726d 6174        " reformat
-00005970: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
-00005980: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00005990: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-000059a0: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
-000059b0: 652c 2031 3233 290a 2020 2020 2020 2020  e, 123).        
-000059c0: 2020 2020 7265 706f 7274 2e66 6169 6c65      report.faile
-000059d0: 6428 5061 7468 2822 6532 2229 2c20 2262  d(Path("e2"), "b
-000059e0: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
-000059f0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00005a00: 616c 286c 656e 286f 7574 5f6c 696e 6573  al(len(out_lines
-00005a10: 292c 2034 290a 2020 2020 2020 2020 2020  ), 4).          
-00005a20: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00005a30: 616c 286c 656e 2865 7272 5f6c 696e 6573  al(len(err_lines
-00005a40: 292c 2032 290a 2020 2020 2020 2020 2020  ), 2).          
-00005a50: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00005a60: 616c 2865 7272 5f6c 696e 6573 5b2d 315d  al(err_lines[-1]
-00005a70: 2c20 2265 7272 6f72 3a20 6361 6e6e 6f74  , "error: cannot
-00005a80: 2066 6f72 6d61 7420 6532 3a20 626f 6f6d   format e2: boom
-00005a90: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
-00005aa0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005ac0: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
-00005ad0: 6f72 7429 292c 0a20 2020 2020 2020 2020  ort)),.         
-00005ae0: 2020 2020 2020 2022 3220 6669 6c65 7320         "2 files 
-00005af0: 7265 666f 726d 6174 7465 642c 2032 2066  reformatted, 2 f
-00005b00: 696c 6573 206c 6566 7420 756e 6368 616e  iles left unchan
-00005b10: 6765 642c 2032 2066 696c 6573 2066 6169  ged, 2 files fai
-00005b20: 6c65 6420 746f 220a 2020 2020 2020 2020  led to".        
-00005b30: 2020 2020 2020 2020 2220 7265 666f 726d          " reform
-00005b40: 6174 2e22 2c0a 2020 2020 2020 2020 2020  at.",.          
-00005b50: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00005b60: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00005b70: 2872 6570 6f72 742e 7265 7475 726e 5f63  (report.return_c
-00005b80: 6f64 652c 2031 3233 290a 2020 2020 2020  ode, 123).      
-00005b90: 2020 2020 2020 7265 706f 7274 2e70 6174        report.pat
-00005ba0: 685f 6967 6e6f 7265 6428 5061 7468 2822  h_ignored(Path("
-00005bb0: 7761 7422 292c 2022 6e6f 206d 6174 6368  wat"), "no match
-00005bc0: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
-00005bd0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005be0: 6c65 6e28 6f75 745f 6c69 6e65 7329 2c20  len(out_lines), 
-00005bf0: 3529 0a20 2020 2020 2020 2020 2020 2073  5).            s
-00005c00: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005c10: 6c65 6e28 6572 725f 6c69 6e65 7329 2c20  len(err_lines), 
-00005c20: 3229 0a20 2020 2020 2020 2020 2020 2073  2).            s
-00005c30: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005c40: 6f75 745f 6c69 6e65 735b 2d31 5d2c 2022  out_lines[-1], "
-00005c50: 7761 7420 6967 6e6f 7265 643a 206e 6f20  wat ignored: no 
-00005c60: 6d61 7463 6822 290a 2020 2020 2020 2020  match").        
-00005c70: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005c80: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-00005c90: 2020 2020 2020 756e 7374 796c 6528 7374        unstyle(st
-00005ca0: 7228 7265 706f 7274 2929 2c0a 2020 2020  r(report)),.    
-00005cb0: 2020 2020 2020 2020 2020 2020 2232 2066              "2 f
-00005cc0: 696c 6573 2072 6566 6f72 6d61 7474 6564  iles reformatted
-00005cd0: 2c20 3220 6669 6c65 7320 6c65 6674 2075  , 2 files left u
-00005ce0: 6e63 6861 6e67 6564 2c20 3220 6669 6c65  nchanged, 2 file
-00005cf0: 7320 6661 696c 6564 2074 6f22 0a20 2020  s failed to".   
-00005d00: 2020 2020 2020 2020 2020 2020 2022 2072               " r
-00005d10: 6566 6f72 6d61 742e 222c 0a20 2020 2020  eformat.",.     
-00005d20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00005d30: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00005d40: 4571 7561 6c28 7265 706f 7274 2e72 6574  Equal(report.ret
-00005d50: 7572 6e5f 636f 6465 2c20 3132 3329 0a20  urn_code, 123). 
-00005d60: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-00005d70: 742e 646f 6e65 2850 6174 6828 2266 3422  t.done(Path("f4"
-00005d80: 292c 2062 6c61 636b 2e43 6861 6e67 6564  ), black.Changed
-00005d90: 2e4e 4f29 0a20 2020 2020 2020 2020 2020  .NO).           
-00005da0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00005db0: 6c28 6c65 6e28 6f75 745f 6c69 6e65 7329  l(len(out_lines)
-00005dc0: 2c20 3629 0a20 2020 2020 2020 2020 2020  , 6).           
-00005dd0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00005de0: 6c28 6c65 6e28 6572 725f 6c69 6e65 7329  l(len(err_lines)
-00005df0: 2c20 3229 0a20 2020 2020 2020 2020 2020  , 2).           
-00005e00: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00005e10: 6c28 6f75 745f 6c69 6e65 735b 2d31 5d2c  l(out_lines[-1],
-00005e20: 2022 6634 2061 6c72 6561 6479 2077 656c   "f4 already wel
-00005e30: 6c20 666f 726d 6174 7465 642c 2067 6f6f  l formatted, goo
-00005e40: 6420 6a6f 622e 2229 0a20 2020 2020 2020  d job.").       
-00005e50: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00005e60: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-00005e70: 2020 2020 2020 2075 6e73 7479 6c65 2873         unstyle(s
-00005e80: 7472 2872 6570 6f72 7429 292c 0a20 2020  tr(report)),.   
-00005e90: 2020 2020 2020 2020 2020 2020 2022 3220               "2 
-00005ea0: 6669 6c65 7320 7265 666f 726d 6174 7465  files reformatte
-00005eb0: 642c 2033 2066 696c 6573 206c 6566 7420  d, 3 files left 
-00005ec0: 756e 6368 616e 6765 642c 2032 2066 696c  unchanged, 2 fil
-00005ed0: 6573 2066 6169 6c65 6420 746f 220a 2020  es failed to".  
-00005ee0: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-00005ef0: 7265 666f 726d 6174 2e22 2c0a 2020 2020  reformat.",.    
-00005f00: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00005f10: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00005f20: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
-00005f30: 7475 726e 5f63 6f64 652c 2031 3233 290a  turn_code, 123).
-00005f40: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00005f50: 7274 2e63 6865 636b 203d 2054 7275 650a  rt.check = True.
-00005f60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00005f70: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
-00005f80: 2020 2020 2020 2020 2020 2020 2020 756e                un
-00005f90: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
-00005fa0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-00005fb0: 2020 2020 2232 2066 696c 6573 2077 6f75      "2 files wou
-00005fc0: 6c64 2062 6520 7265 666f 726d 6174 7465  ld be reformatte
-00005fd0: 642c 2033 2066 696c 6573 2077 6f75 6c64  d, 3 files would
-00005fe0: 2062 6520 6c65 6674 2075 6e63 6861 6e67   be left unchang
-00005ff0: 6564 2c20 3222 0a20 2020 2020 2020 2020  ed, 2".         
-00006000: 2020 2020 2020 2022 2066 696c 6573 2077         " files w
-00006010: 6f75 6c64 2066 6169 6c20 746f 2072 6566  ould fail to ref
-00006020: 6f72 6d61 742e 222c 0a20 2020 2020 2020  ormat.",.       
-00006030: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00006040: 2020 2072 6570 6f72 742e 6368 6563 6b20     report.check 
-00006050: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00006060: 2020 2020 7265 706f 7274 2e64 6966 6620      report.diff 
-00006070: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00006080: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00006090: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-000060a0: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
-000060b0: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
-000060c0: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
-000060d0: 6c65 7320 776f 756c 6420 6265 2072 6566  les would be ref
-000060e0: 6f72 6d61 7474 6564 2c20 3320 6669 6c65  ormatted, 3 file
-000060f0: 7320 776f 756c 6420 6265 206c 6566 7420  s would be left 
-00006100: 756e 6368 616e 6765 642c 2032 220a 2020  unchanged, 2".  
-00006110: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-00006120: 6669 6c65 7320 776f 756c 6420 6661 696c  files would fail
-00006130: 2074 6f20 7265 666f 726d 6174 2e22 2c0a   to reformat.",.
-00006140: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00006150: 2020 2064 6566 2074 6573 745f 7265 706f     def test_repo
-00006160: 7274 5f71 7569 6574 2873 656c 6629 202d  rt_quiet(self) -
-00006170: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00006180: 7265 706f 7274 203d 2052 6570 6f72 7428  report = Report(
-00006190: 7175 6965 743d 5472 7565 290a 2020 2020  quiet=True).    
-000061a0: 2020 2020 6f75 745f 6c69 6e65 7320 3d20      out_lines = 
-000061b0: 5b5d 0a20 2020 2020 2020 2065 7272 5f6c  [].        err_l
-000061c0: 696e 6573 203d 205b 5d0a 0a20 2020 2020  ines = []..     
-000061d0: 2020 2064 6566 206f 7574 286d 7367 3a20     def out(msg: 
-000061e0: 7374 722c 202a 2a6b 7761 7267 733a 2041  str, **kwargs: A
-000061f0: 6e79 2920 2d3e 204e 6f6e 653a 0a20 2020  ny) -> None:.   
-00006200: 2020 2020 2020 2020 206f 7574 5f6c 696e           out_lin
-00006210: 6573 2e61 7070 656e 6428 6d73 6729 0a0a  es.append(msg)..
-00006220: 2020 2020 2020 2020 6465 6620 6572 7228          def err(
-00006230: 6d73 673a 2073 7472 2c20 2a2a 6b77 6172  msg: str, **kwar
-00006240: 6773 3a20 416e 7929 202d 3e20 4e6f 6e65  gs: Any) -> None
-00006250: 3a0a 2020 2020 2020 2020 2020 2020 6572  :.            er
-00006260: 725f 6c69 6e65 732e 6170 7065 6e64 286d  r_lines.append(m
-00006270: 7367 290a 0a20 2020 2020 2020 2077 6974  sg)..        wit
-00006280: 6820 7061 7463 6828 2262 6c61 636b 2e6f  h patch("black.o
-00006290: 7574 7075 742e 5f6f 7574 222c 206f 7574  utput._out", out
-000062a0: 292c 2070 6174 6368 2822 626c 6163 6b2e  ), patch("black.
-000062b0: 6f75 7470 7574 2e5f 6572 7222 2c20 6572  output._err", er
-000062c0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-000062d0: 7265 706f 7274 2e64 6f6e 6528 5061 7468  report.done(Path
-000062e0: 2822 6631 2229 2c20 626c 6163 6b2e 4368  ("f1"), black.Ch
-000062f0: 616e 6765 642e 4e4f 290a 2020 2020 2020  anged.NO).      
-00006300: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006310: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
-00006320: 696e 6573 292c 2030 290a 2020 2020 2020  ines), 0).      
-00006330: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006340: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
-00006350: 696e 6573 292c 2030 290a 2020 2020 2020  ines), 0).      
-00006360: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006370: 7445 7175 616c 2875 6e73 7479 6c65 2873  tEqual(unstyle(s
-00006380: 7472 2872 6570 6f72 7429 292c 2022 3120  tr(report)), "1 
-00006390: 6669 6c65 206c 6566 7420 756e 6368 616e  file left unchan
-000063a0: 6765 642e 2229 0a20 2020 2020 2020 2020  ged.").         
-000063b0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000063c0: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
-000063d0: 6e5f 636f 6465 2c20 3029 0a20 2020 2020  n_code, 0).     
-000063e0: 2020 2020 2020 2072 6570 6f72 742e 646f         report.do
-000063f0: 6e65 2850 6174 6828 2266 3222 292c 2062  ne(Path("f2"), b
-00006400: 6c61 636b 2e43 6861 6e67 6564 2e59 4553  lack.Changed.YES
-00006410: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00006420: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00006430: 656e 286f 7574 5f6c 696e 6573 292c 2030  en(out_lines), 0
-00006440: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00006450: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00006460: 656e 2865 7272 5f6c 696e 6573 292c 2030  en(err_lines), 0
-00006470: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00006480: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
-00006490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000064a0: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
-000064b0: 7274 2929 2c20 2231 2066 696c 6520 7265  rt)), "1 file re
-000064c0: 666f 726d 6174 7465 642c 2031 2066 696c  formatted, 1 fil
-000064d0: 6520 6c65 6674 2075 6e63 6861 6e67 6564  e left unchanged
-000064e0: 2e22 0a20 2020 2020 2020 2020 2020 2029  .".            )
-000064f0: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-00006500: 6f72 742e 646f 6e65 2850 6174 6828 2266  ort.done(Path("f
-00006510: 3322 292c 2062 6c61 636b 2e43 6861 6e67  3"), black.Chang
-00006520: 6564 2e43 4143 4845 4429 0a20 2020 2020  ed.CACHED).     
-00006530: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006540: 7274 4571 7561 6c28 6c65 6e28 6f75 745f  rtEqual(len(out_
-00006550: 6c69 6e65 7329 2c20 3029 0a20 2020 2020  lines), 0).     
-00006560: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006570: 7274 4571 7561 6c28 6c65 6e28 6572 725f  rtEqual(len(err_
-00006580: 6c69 6e65 7329 2c20 3029 0a20 2020 2020  lines), 0).     
-00006590: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000065a0: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
-000065b0: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
-000065c0: 2873 7472 2872 6570 6f72 7429 292c 2022  (str(report)), "
-000065d0: 3120 6669 6c65 2072 6566 6f72 6d61 7474  1 file reformatt
-000065e0: 6564 2c20 3220 6669 6c65 7320 6c65 6674  ed, 2 files left
-000065f0: 2075 6e63 6861 6e67 6564 2e22 0a20 2020   unchanged.".   
-00006600: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00006610: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006620: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
-00006630: 6574 7572 6e5f 636f 6465 2c20 3029 0a20  eturn_code, 0). 
-00006640: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-00006650: 742e 6368 6563 6b20 3d20 5472 7565 0a20  t.check = True. 
-00006660: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006670: 6173 7365 7274 4571 7561 6c28 7265 706f  assertEqual(repo
-00006680: 7274 2e72 6574 7572 6e5f 636f 6465 2c20  rt.return_code, 
-00006690: 3129 0a20 2020 2020 2020 2020 2020 2072  1).            r
-000066a0: 6570 6f72 742e 6368 6563 6b20 3d20 4661  eport.check = Fa
-000066b0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-000066c0: 7265 706f 7274 2e66 6169 6c65 6428 5061  report.failed(Pa
-000066d0: 7468 2822 6531 2229 2c20 2262 6f6f 6d22  th("e1"), "boom"
-000066e0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000066f0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00006700: 656e 286f 7574 5f6c 696e 6573 292c 2030  en(out_lines), 0
-00006710: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00006720: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00006730: 656e 2865 7272 5f6c 696e 6573 292c 2031  en(err_lines), 1
-00006740: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00006750: 6c66 2e61 7373 6572 7445 7175 616c 2865  lf.assertEqual(e
-00006760: 7272 5f6c 696e 6573 5b2d 315d 2c20 2265  rr_lines[-1], "e
-00006770: 7272 6f72 3a20 6361 6e6e 6f74 2066 6f72  rror: cannot for
-00006780: 6d61 7420 6531 3a20 626f 6f6d 2229 0a20  mat e1: boom"). 
-00006790: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000067a0: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
-000067b0: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
-000067c0: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
-000067d0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-000067e0: 2020 2022 3120 6669 6c65 2072 6566 6f72     "1 file refor
-000067f0: 6d61 7474 6564 2c20 3220 6669 6c65 7320  matted, 2 files 
-00006800: 6c65 6674 2075 6e63 6861 6e67 6564 2c20  left unchanged, 
-00006810: 3120 6669 6c65 2066 6169 6c65 6420 746f  1 file failed to
-00006820: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00006830: 2020 2220 7265 666f 726d 6174 2e22 2c0a    " reformat.",.
-00006840: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00006850: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00006860: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
-00006870: 742e 7265 7475 726e 5f63 6f64 652c 2031  t.return_code, 1
-00006880: 3233 290a 2020 2020 2020 2020 2020 2020  23).            
-00006890: 7265 706f 7274 2e64 6f6e 6528 5061 7468  report.done(Path
-000068a0: 2822 6633 2229 2c20 626c 6163 6b2e 4368  ("f3"), black.Ch
-000068b0: 616e 6765 642e 5945 5329 0a20 2020 2020  anged.YES).     
-000068c0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000068d0: 7274 4571 7561 6c28 6c65 6e28 6f75 745f  rtEqual(len(out_
-000068e0: 6c69 6e65 7329 2c20 3029 0a20 2020 2020  lines), 0).     
-000068f0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006900: 7274 4571 7561 6c28 6c65 6e28 6572 725f  rtEqual(len(err_
-00006910: 6c69 6e65 7329 2c20 3129 0a20 2020 2020  lines), 1).     
-00006920: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006930: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
-00006940: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
-00006950: 2873 7472 2872 6570 6f72 7429 292c 0a20  (str(report)),. 
-00006960: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00006970: 3220 6669 6c65 7320 7265 666f 726d 6174  2 files reformat
-00006980: 7465 642c 2032 2066 696c 6573 206c 6566  ted, 2 files lef
-00006990: 7420 756e 6368 616e 6765 642c 2031 2066  t unchanged, 1 f
-000069a0: 696c 6520 6661 696c 6564 2074 6f22 0a20  ile failed to". 
-000069b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000069c0: 2072 6566 6f72 6d61 742e 222c 0a20 2020   reformat.",.   
-000069d0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000069e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000069f0: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
-00006a00: 6574 7572 6e5f 636f 6465 2c20 3132 3329  eturn_code, 123)
-00006a10: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-00006a20: 6f72 742e 6661 696c 6564 2850 6174 6828  ort.failed(Path(
-00006a30: 2265 3222 292c 2022 626f 6f6d 2229 0a20  "e2"), "boom"). 
-00006a40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006a50: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00006a60: 6f75 745f 6c69 6e65 7329 2c20 3029 0a20  out_lines), 0). 
-00006a70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006a80: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00006a90: 6572 725f 6c69 6e65 7329 2c20 3229 0a20  err_lines), 2). 
-00006aa0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006ab0: 6173 7365 7274 4571 7561 6c28 6572 725f  assertEqual(err_
-00006ac0: 6c69 6e65 735b 2d31 5d2c 2022 6572 726f  lines[-1], "erro
-00006ad0: 723a 2063 616e 6e6f 7420 666f 726d 6174  r: cannot format
-00006ae0: 2065 323a 2062 6f6f 6d22 290a 2020 2020   e2: boom").    
-00006af0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00006b00: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
-00006b10: 2020 2020 2020 2020 2020 756e 7374 796c            unstyl
-00006b20: 6528 7374 7228 7265 706f 7274 2929 2c0a  e(str(report)),.
-00006b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b40: 2232 2066 696c 6573 2072 6566 6f72 6d61  "2 files reforma
-00006b50: 7474 6564 2c20 3220 6669 6c65 7320 6c65  tted, 2 files le
-00006b60: 6674 2075 6e63 6861 6e67 6564 2c20 3220  ft unchanged, 2 
-00006b70: 6669 6c65 7320 6661 696c 6564 2074 6f22  files failed to"
-00006b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006b90: 2022 2072 6566 6f72 6d61 742e 222c 0a20   " reformat.",. 
-00006ba0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00006bb0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00006bc0: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
-00006bd0: 2e72 6574 7572 6e5f 636f 6465 2c20 3132  .return_code, 12
-00006be0: 3329 0a20 2020 2020 2020 2020 2020 2072  3).            r
-00006bf0: 6570 6f72 742e 7061 7468 5f69 676e 6f72  eport.path_ignor
-00006c00: 6564 2850 6174 6828 2277 6174 2229 2c20  ed(Path("wat"), 
-00006c10: 226e 6f20 6d61 7463 6822 290a 2020 2020  "no match").    
-00006c20: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00006c30: 6572 7445 7175 616c 286c 656e 286f 7574  ertEqual(len(out
-00006c40: 5f6c 696e 6573 292c 2030 290a 2020 2020  _lines), 0).    
-00006c50: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00006c60: 6572 7445 7175 616c 286c 656e 2865 7272  ertEqual(len(err
-00006c70: 5f6c 696e 6573 292c 2032 290a 2020 2020  _lines), 2).    
-00006c80: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00006c90: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
-00006ca0: 2020 2020 2020 2020 2020 756e 7374 796c            unstyl
-00006cb0: 6528 7374 7228 7265 706f 7274 2929 2c0a  e(str(report)),.
-00006cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006cd0: 2232 2066 696c 6573 2072 6566 6f72 6d61  "2 files reforma
-00006ce0: 7474 6564 2c20 3220 6669 6c65 7320 6c65  tted, 2 files le
-00006cf0: 6674 2075 6e63 6861 6e67 6564 2c20 3220  ft unchanged, 2 
-00006d00: 6669 6c65 7320 6661 696c 6564 2074 6f22  files failed to"
-00006d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006d20: 2022 2072 6566 6f72 6d61 742e 222c 0a20   " reformat.",. 
-00006d30: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00006d40: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00006d50: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
-00006d60: 2e72 6574 7572 6e5f 636f 6465 2c20 3132  .return_code, 12
-00006d70: 3329 0a20 2020 2020 2020 2020 2020 2072  3).            r
-00006d80: 6570 6f72 742e 646f 6e65 2850 6174 6828  eport.done(Path(
-00006d90: 2266 3422 292c 2062 6c61 636b 2e43 6861  "f4"), black.Cha
-00006da0: 6e67 6564 2e4e 4f29 0a20 2020 2020 2020  nged.NO).       
-00006db0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006dc0: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
-00006dd0: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
-00006de0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006df0: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
-00006e00: 6e65 7329 2c20 3229 0a20 2020 2020 2020  nes), 2).       
-00006e10: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006e20: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-00006e30: 2020 2020 2020 2075 6e73 7479 6c65 2873         unstyle(s
-00006e40: 7472 2872 6570 6f72 7429 292c 0a20 2020  tr(report)),.   
-00006e50: 2020 2020 2020 2020 2020 2020 2022 3220               "2 
-00006e60: 6669 6c65 7320 7265 666f 726d 6174 7465  files reformatte
-00006e70: 642c 2033 2066 696c 6573 206c 6566 7420  d, 3 files left 
-00006e80: 756e 6368 616e 6765 642c 2032 2066 696c  unchanged, 2 fil
-00006e90: 6573 2066 6169 6c65 6420 746f 220a 2020  es failed to".  
-00006ea0: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-00006eb0: 7265 666f 726d 6174 2e22 2c0a 2020 2020  reformat.",.    
-00006ec0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00006ed0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006ee0: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
-00006ef0: 7475 726e 5f63 6f64 652c 2031 3233 290a  turn_code, 123).
-00006f00: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00006f10: 7274 2e63 6865 636b 203d 2054 7275 650a  rt.check = True.
-00006f20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006f30: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
-00006f40: 2020 2020 2020 2020 2020 2020 2020 756e                un
-00006f50: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
-00006f60: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-00006f70: 2020 2020 2232 2066 696c 6573 2077 6f75      "2 files wou
-00006f80: 6c64 2062 6520 7265 666f 726d 6174 7465  ld be reformatte
-00006f90: 642c 2033 2066 696c 6573 2077 6f75 6c64  d, 3 files would
-00006fa0: 2062 6520 6c65 6674 2075 6e63 6861 6e67   be left unchang
-00006fb0: 6564 2c20 3222 0a20 2020 2020 2020 2020  ed, 2".         
-00006fc0: 2020 2020 2020 2022 2066 696c 6573 2077         " files w
-00006fd0: 6f75 6c64 2066 6169 6c20 746f 2072 6566  ould fail to ref
-00006fe0: 6f72 6d61 742e 222c 0a20 2020 2020 2020  ormat.",.       
-00006ff0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00007000: 2020 2072 6570 6f72 742e 6368 6563 6b20     report.check 
-00007010: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00007020: 2020 2020 7265 706f 7274 2e64 6966 6620      report.diff 
-00007030: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00007040: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00007050: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-00007060: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
-00007070: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
-00007080: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
-00007090: 6c65 7320 776f 756c 6420 6265 2072 6566  les would be ref
-000070a0: 6f72 6d61 7474 6564 2c20 3320 6669 6c65  ormatted, 3 file
-000070b0: 7320 776f 756c 6420 6265 206c 6566 7420  s would be left 
-000070c0: 756e 6368 616e 6765 642c 2032 220a 2020  unchanged, 2".  
-000070d0: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-000070e0: 6669 6c65 7320 776f 756c 6420 6661 696c  files would fail
-000070f0: 2074 6f20 7265 666f 726d 6174 2e22 2c0a   to reformat.",.
-00007100: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00007110: 2020 2064 6566 2074 6573 745f 7265 706f     def test_repo
-00007120: 7274 5f6e 6f72 6d61 6c28 7365 6c66 2920  rt_normal(self) 
-00007130: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00007140: 2072 6570 6f72 7420 3d20 626c 6163 6b2e   report = black.
-00007150: 5265 706f 7274 2829 0a20 2020 2020 2020  Report().       
-00007160: 206f 7574 5f6c 696e 6573 203d 205b 5d0a   out_lines = [].
-00007170: 2020 2020 2020 2020 6572 725f 6c69 6e65          err_line
-00007180: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
-00007190: 6465 6620 6f75 7428 6d73 673a 2073 7472  def out(msg: str
-000071a0: 2c20 2a2a 6b77 6172 6773 3a20 416e 7929  , **kwargs: Any)
-000071b0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000071c0: 2020 2020 2020 6f75 745f 6c69 6e65 732e        out_lines.
-000071d0: 6170 7065 6e64 286d 7367 290a 0a20 2020  append(msg)..   
-000071e0: 2020 2020 2064 6566 2065 7272 286d 7367       def err(msg
-000071f0: 3a20 7374 722c 202a 2a6b 7761 7267 733a  : str, **kwargs:
-00007200: 2041 6e79 2920 2d3e 204e 6f6e 653a 0a20   Any) -> None:. 
-00007210: 2020 2020 2020 2020 2020 2065 7272 5f6c             err_l
-00007220: 696e 6573 2e61 7070 656e 6428 6d73 6729  ines.append(msg)
-00007230: 0a0a 2020 2020 2020 2020 7769 7468 2070  ..        with p
-00007240: 6174 6368 2822 626c 6163 6b2e 6f75 7470  atch("black.outp
-00007250: 7574 2e5f 6f75 7422 2c20 6f75 7429 2c20  ut._out", out), 
-00007260: 7061 7463 6828 2262 6c61 636b 2e6f 7574  patch("black.out
-00007270: 7075 742e 5f65 7272 222c 2065 7272 293a  put._err", err):
-00007280: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-00007290: 6f72 742e 646f 6e65 2850 6174 6828 2266  ort.done(Path("f
-000072a0: 3122 292c 2062 6c61 636b 2e43 6861 6e67  1"), black.Chang
-000072b0: 6564 2e4e 4f29 0a20 2020 2020 2020 2020  ed.NO).         
-000072c0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000072d0: 7561 6c28 6c65 6e28 6f75 745f 6c69 6e65  ual(len(out_line
-000072e0: 7329 2c20 3029 0a20 2020 2020 2020 2020  s), 0).         
-000072f0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00007300: 7561 6c28 6c65 6e28 6572 725f 6c69 6e65  ual(len(err_line
-00007310: 7329 2c20 3029 0a20 2020 2020 2020 2020  s), 0).         
-00007320: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00007330: 7561 6c28 756e 7374 796c 6528 7374 7228  ual(unstyle(str(
-00007340: 7265 706f 7274 2929 2c20 2231 2066 696c  report)), "1 fil
-00007350: 6520 6c65 6674 2075 6e63 6861 6e67 6564  e left unchanged
-00007360: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00007370: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007380: 2872 6570 6f72 742e 7265 7475 726e 5f63  (report.return_c
-00007390: 6f64 652c 2030 290a 2020 2020 2020 2020  ode, 0).        
-000073a0: 2020 2020 7265 706f 7274 2e64 6f6e 6528      report.done(
-000073b0: 5061 7468 2822 6632 2229 2c20 626c 6163  Path("f2"), blac
-000073c0: 6b2e 4368 616e 6765 642e 5945 5329 0a20  k.Changed.YES). 
-000073d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000073e0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-000073f0: 6f75 745f 6c69 6e65 7329 2c20 3129 0a20  out_lines), 1). 
-00007400: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007410: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00007420: 6572 725f 6c69 6e65 7329 2c20 3029 0a20  err_lines), 0). 
-00007430: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007440: 6173 7365 7274 4571 7561 6c28 6f75 745f  assertEqual(out_
-00007450: 6c69 6e65 735b 2d31 5d2c 2022 7265 666f  lines[-1], "refo
-00007460: 726d 6174 7465 6420 6632 2229 0a20 2020  rmatted f2").   
-00007470: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00007480: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
-00007490: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
-000074a0: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
-000074b0: 2022 3120 6669 6c65 2072 6566 6f72 6d61   "1 file reforma
-000074c0: 7474 6564 2c20 3120 6669 6c65 206c 6566  tted, 1 file lef
-000074d0: 7420 756e 6368 616e 6765 642e 220a 2020  t unchanged.".  
-000074e0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000074f0: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
-00007500: 6f6e 6528 5061 7468 2822 6633 2229 2c20  one(Path("f3"), 
-00007510: 626c 6163 6b2e 4368 616e 6765 642e 4341  black.Changed.CA
-00007520: 4348 4544 290a 2020 2020 2020 2020 2020  CHED).          
-00007530: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00007540: 616c 286c 656e 286f 7574 5f6c 696e 6573  al(len(out_lines
-00007550: 292c 2031 290a 2020 2020 2020 2020 2020  ), 1).          
-00007560: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00007570: 616c 286c 656e 2865 7272 5f6c 696e 6573  al(len(err_lines
-00007580: 292c 2030 290a 2020 2020 2020 2020 2020  ), 0).          
-00007590: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000075a0: 616c 286f 7574 5f6c 696e 6573 5b2d 315d  al(out_lines[-1]
-000075b0: 2c20 2272 6566 6f72 6d61 7474 6564 2066  , "reformatted f
-000075c0: 3222 290a 2020 2020 2020 2020 2020 2020  2").            
-000075d0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000075e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000075f0: 2020 756e 7374 796c 6528 7374 7228 7265    unstyle(str(re
-00007600: 706f 7274 2929 2c20 2231 2066 696c 6520  port)), "1 file 
-00007610: 7265 666f 726d 6174 7465 642c 2032 2066  reformatted, 2 f
-00007620: 696c 6573 206c 6566 7420 756e 6368 616e  iles left unchan
-00007630: 6765 642e 220a 2020 2020 2020 2020 2020  ged.".          
-00007640: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00007650: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007660: 2872 6570 6f72 742e 7265 7475 726e 5f63  (report.return_c
-00007670: 6f64 652c 2030 290a 2020 2020 2020 2020  ode, 0).        
-00007680: 2020 2020 7265 706f 7274 2e63 6865 636b      report.check
-00007690: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-000076a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000076b0: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
-000076c0: 726e 5f63 6f64 652c 2031 290a 2020 2020  rn_code, 1).    
-000076d0: 2020 2020 2020 2020 7265 706f 7274 2e63          report.c
-000076e0: 6865 636b 203d 2046 616c 7365 0a20 2020  heck = False.   
-000076f0: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
-00007700: 6661 696c 6564 2850 6174 6828 2265 3122  failed(Path("e1"
-00007710: 292c 2022 626f 6f6d 2229 0a20 2020 2020  ), "boom").     
-00007720: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00007730: 7274 4571 7561 6c28 6c65 6e28 6f75 745f  rtEqual(len(out_
-00007740: 6c69 6e65 7329 2c20 3129 0a20 2020 2020  lines), 1).     
-00007750: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00007760: 7274 4571 7561 6c28 6c65 6e28 6572 725f  rtEqual(len(err_
-00007770: 6c69 6e65 7329 2c20 3129 0a20 2020 2020  lines), 1).     
-00007780: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00007790: 7274 4571 7561 6c28 6572 725f 6c69 6e65  rtEqual(err_line
-000077a0: 735b 2d31 5d2c 2022 6572 726f 723a 2063  s[-1], "error: c
-000077b0: 616e 6e6f 7420 666f 726d 6174 2065 313a  annot format e1:
-000077c0: 2062 6f6f 6d22 290a 2020 2020 2020 2020   boom").        
-000077d0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000077e0: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-000077f0: 2020 2020 2020 756e 7374 796c 6528 7374        unstyle(st
-00007800: 7228 7265 706f 7274 2929 2c0a 2020 2020  r(report)),.    
-00007810: 2020 2020 2020 2020 2020 2020 2231 2066              "1 f
-00007820: 696c 6520 7265 666f 726d 6174 7465 642c  ile reformatted,
-00007830: 2032 2066 696c 6573 206c 6566 7420 756e   2 files left un
-00007840: 6368 616e 6765 642c 2031 2066 696c 6520  changed, 1 file 
-00007850: 6661 696c 6564 2074 6f22 0a20 2020 2020  failed to".     
-00007860: 2020 2020 2020 2020 2020 2022 2072 6566             " ref
-00007870: 6f72 6d61 742e 222c 0a20 2020 2020 2020  ormat.",.       
-00007880: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00007890: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000078a0: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
-000078b0: 6e5f 636f 6465 2c20 3132 3329 0a20 2020  n_code, 123).   
-000078c0: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
-000078d0: 646f 6e65 2850 6174 6828 2266 3322 292c  done(Path("f3"),
-000078e0: 2062 6c61 636b 2e43 6861 6e67 6564 2e59   black.Changed.Y
-000078f0: 4553 290a 2020 2020 2020 2020 2020 2020  ES).            
-00007900: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007910: 286c 656e 286f 7574 5f6c 696e 6573 292c  (len(out_lines),
-00007920: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
-00007930: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007940: 286c 656e 2865 7272 5f6c 696e 6573 292c  (len(err_lines),
-00007950: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
-00007960: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007970: 286f 7574 5f6c 696e 6573 5b2d 315d 2c20  (out_lines[-1], 
-00007980: 2272 6566 6f72 6d61 7474 6564 2066 3322  "reformatted f3"
-00007990: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000079a0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
-000079b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079c0: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
-000079d0: 7274 2929 2c0a 2020 2020 2020 2020 2020  rt)),.          
-000079e0: 2020 2020 2020 2232 2066 696c 6573 2072        "2 files r
-000079f0: 6566 6f72 6d61 7474 6564 2c20 3220 6669  eformatted, 2 fi
-00007a00: 6c65 7320 6c65 6674 2075 6e63 6861 6e67  les left unchang
-00007a10: 6564 2c20 3120 6669 6c65 2066 6169 6c65  ed, 1 file faile
-00007a20: 6420 746f 220a 2020 2020 2020 2020 2020  d to".          
-00007a30: 2020 2020 2020 2220 7265 666f 726d 6174        " reformat
-00007a40: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
-00007a50: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00007a60: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-00007a70: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
-00007a80: 652c 2031 3233 290a 2020 2020 2020 2020  e, 123).        
-00007a90: 2020 2020 7265 706f 7274 2e66 6169 6c65      report.faile
-00007aa0: 6428 5061 7468 2822 6532 2229 2c20 2262  d(Path("e2"), "b
-00007ab0: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
-00007ac0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00007ad0: 616c 286c 656e 286f 7574 5f6c 696e 6573  al(len(out_lines
-00007ae0: 292c 2032 290a 2020 2020 2020 2020 2020  ), 2).          
-00007af0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00007b00: 616c 286c 656e 2865 7272 5f6c 696e 6573  al(len(err_lines
-00007b10: 292c 2032 290a 2020 2020 2020 2020 2020  ), 2).          
-00007b20: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00007b30: 616c 2865 7272 5f6c 696e 6573 5b2d 315d  al(err_lines[-1]
-00007b40: 2c20 2265 7272 6f72 3a20 6361 6e6e 6f74  , "error: cannot
-00007b50: 2066 6f72 6d61 7420 6532 3a20 626f 6f6d   format e2: boom
-00007b60: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
-00007b70: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00007b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007b90: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
-00007ba0: 6f72 7429 292c 0a20 2020 2020 2020 2020  ort)),.         
-00007bb0: 2020 2020 2020 2022 3220 6669 6c65 7320         "2 files 
-00007bc0: 7265 666f 726d 6174 7465 642c 2032 2066  reformatted, 2 f
-00007bd0: 696c 6573 206c 6566 7420 756e 6368 616e  iles left unchan
-00007be0: 6765 642c 2032 2066 696c 6573 2066 6169  ged, 2 files fai
-00007bf0: 6c65 6420 746f 220a 2020 2020 2020 2020  led to".        
-00007c00: 2020 2020 2020 2020 2220 7265 666f 726d          " reform
-00007c10: 6174 2e22 2c0a 2020 2020 2020 2020 2020  at.",.          
-00007c20: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00007c30: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007c40: 2872 6570 6f72 742e 7265 7475 726e 5f63  (report.return_c
-00007c50: 6f64 652c 2031 3233 290a 2020 2020 2020  ode, 123).      
-00007c60: 2020 2020 2020 7265 706f 7274 2e70 6174        report.pat
-00007c70: 685f 6967 6e6f 7265 6428 5061 7468 2822  h_ignored(Path("
-00007c80: 7761 7422 292c 2022 6e6f 206d 6174 6368  wat"), "no match
-00007c90: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
-00007ca0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00007cb0: 6c65 6e28 6f75 745f 6c69 6e65 7329 2c20  len(out_lines), 
-00007cc0: 3229 0a20 2020 2020 2020 2020 2020 2073  2).            s
-00007cd0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00007ce0: 6c65 6e28 6572 725f 6c69 6e65 7329 2c20  len(err_lines), 
-00007cf0: 3229 0a20 2020 2020 2020 2020 2020 2073  2).            s
-00007d00: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00007d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007d20: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
-00007d30: 6f72 7429 292c 0a20 2020 2020 2020 2020  ort)),.         
-00007d40: 2020 2020 2020 2022 3220 6669 6c65 7320         "2 files 
-00007d50: 7265 666f 726d 6174 7465 642c 2032 2066  reformatted, 2 f
-00007d60: 696c 6573 206c 6566 7420 756e 6368 616e  iles left unchan
-00007d70: 6765 642c 2032 2066 696c 6573 2066 6169  ged, 2 files fai
-00007d80: 6c65 6420 746f 220a 2020 2020 2020 2020  led to".        
-00007d90: 2020 2020 2020 2020 2220 7265 666f 726d          " reform
-00007da0: 6174 2e22 2c0a 2020 2020 2020 2020 2020  at.",.          
-00007db0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00007dc0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007dd0: 2872 6570 6f72 742e 7265 7475 726e 5f63  (report.return_c
-00007de0: 6f64 652c 2031 3233 290a 2020 2020 2020  ode, 123).      
-00007df0: 2020 2020 2020 7265 706f 7274 2e64 6f6e        report.don
-00007e00: 6528 5061 7468 2822 6634 2229 2c20 626c  e(Path("f4"), bl
-00007e10: 6163 6b2e 4368 616e 6765 642e 4e4f 290a  ack.Changed.NO).
-00007e20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007e30: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-00007e40: 286f 7574 5f6c 696e 6573 292c 2032 290a  (out_lines), 2).
-00007e50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007e60: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-00007e70: 2865 7272 5f6c 696e 6573 292c 2032 290a  (err_lines), 2).
-00007e80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007e90: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
-00007ea0: 2020 2020 2020 2020 2020 2020 2020 756e                un
-00007eb0: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
-00007ec0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-00007ed0: 2020 2020 2232 2066 696c 6573 2072 6566      "2 files ref
-00007ee0: 6f72 6d61 7474 6564 2c20 3320 6669 6c65  ormatted, 3 file
-00007ef0: 7320 6c65 6674 2075 6e63 6861 6e67 6564  s left unchanged
-00007f00: 2c20 3220 6669 6c65 7320 6661 696c 6564  , 2 files failed
-00007f10: 2074 6f22 0a20 2020 2020 2020 2020 2020   to".           
-00007f20: 2020 2020 2022 2072 6566 6f72 6d61 742e       " reformat.
-00007f30: 222c 0a20 2020 2020 2020 2020 2020 2029  ",.            )
-00007f40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007f50: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
-00007f60: 706f 7274 2e72 6574 7572 6e5f 636f 6465  port.return_code
-00007f70: 2c20 3132 3329 0a20 2020 2020 2020 2020  , 123).         
-00007f80: 2020 2072 6570 6f72 742e 6368 6563 6b20     report.check 
-00007f90: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00007fa0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00007fb0: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-00007fc0: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
-00007fd0: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
-00007fe0: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
-00007ff0: 6c65 7320 776f 756c 6420 6265 2072 6566  les would be ref
-00008000: 6f72 6d61 7474 6564 2c20 3320 6669 6c65  ormatted, 3 file
-00008010: 7320 776f 756c 6420 6265 206c 6566 7420  s would be left 
-00008020: 756e 6368 616e 6765 642c 2032 220a 2020  unchanged, 2".  
-00008030: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-00008040: 6669 6c65 7320 776f 756c 6420 6661 696c  files would fail
-00008050: 2074 6f20 7265 666f 726d 6174 2e22 2c0a   to reformat.",.
-00008060: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00008070: 2020 2020 2020 2020 2020 7265 706f 7274            report
-00008080: 2e63 6865 636b 203d 2046 616c 7365 0a20  .check = False. 
-00008090: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-000080a0: 742e 6469 6666 203d 2054 7275 650a 2020  t.diff = True.  
-000080b0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000080c0: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-000080d0: 2020 2020 2020 2020 2020 2020 756e 7374              unst
-000080e0: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
-000080f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00008100: 2020 2232 2066 696c 6573 2077 6f75 6c64    "2 files would
-00008110: 2062 6520 7265 666f 726d 6174 7465 642c   be reformatted,
-00008120: 2033 2066 696c 6573 2077 6f75 6c64 2062   3 files would b
-00008130: 6520 6c65 6674 2075 6e63 6861 6e67 6564  e left unchanged
-00008140: 2c20 3222 0a20 2020 2020 2020 2020 2020  , 2".           
-00008150: 2020 2020 2022 2066 696c 6573 2077 6f75       " files wou
-00008160: 6c64 2066 6169 6c20 746f 2072 6566 6f72  ld fail to refor
-00008170: 6d61 742e 222c 0a20 2020 2020 2020 2020  mat.",.         
-00008180: 2020 2029 0a0a 2020 2020 6465 6620 7465     )..    def te
-00008190: 7374 5f6c 6962 3274 6f33 5f70 6172 7365  st_lib2to3_parse
-000081a0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-000081b0: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
-000081c0: 662e 6173 7365 7274 5261 6973 6573 2862  f.assertRaises(b
-000081d0: 6c61 636b 2e49 6e76 616c 6964 496e 7075  lack.InvalidInpu
-000081e0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-000081f0: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
-00008200: 7273 6528 2269 6e76 616c 6964 2073 796e  rse("invalid syn
-00008210: 7461 7822 290a 0a20 2020 2020 2020 2073  tax")..        s
-00008220: 7472 6164 646c 696e 6720 3d20 2278 202b  traddling = "x +
-00008230: 2079 220a 2020 2020 2020 2020 626c 6163   y".        blac
-00008240: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
-00008250: 7374 7261 6464 6c69 6e67 290a 2020 2020  straddling).    
-00008260: 2020 2020 626c 6163 6b2e 6c69 6232 746f      black.lib2to
-00008270: 335f 7061 7273 6528 7374 7261 6464 6c69  3_parse(straddli
-00008280: 6e67 2c20 7b54 6172 6765 7456 6572 7369  ng, {TargetVersi
-00008290: 6f6e 2e50 5933 367d 290a 0a20 2020 2020  on.PY36})..     
-000082a0: 2020 2070 7932 5f6f 6e6c 7920 3d20 2270     py2_only = "p
-000082b0: 7269 6e74 2078 220a 2020 2020 2020 2020  rint x".        
-000082c0: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
-000082d0: 5261 6973 6573 2862 6c61 636b 2e49 6e76  Raises(black.Inv
-000082e0: 616c 6964 496e 7075 7429 3a0a 2020 2020  alidInput):.    
-000082f0: 2020 2020 2020 2020 626c 6163 6b2e 6c69          black.li
-00008300: 6232 746f 335f 7061 7273 6528 7079 325f  b2to3_parse(py2_
-00008310: 6f6e 6c79 2c20 7b54 6172 6765 7456 6572  only, {TargetVer
-00008320: 7369 6f6e 2e50 5933 367d 290a 0a20 2020  sion.PY36})..   
-00008330: 2020 2020 2070 7933 5f6f 6e6c 7920 3d20       py3_only = 
-00008340: 2265 7865 6328 782c 2065 6e64 3d79 2922  "exec(x, end=y)"
-00008350: 0a20 2020 2020 2020 2062 6c61 636b 2e6c  .        black.l
-00008360: 6962 3274 6f33 5f70 6172 7365 2870 7933  ib2to3_parse(py3
-00008370: 5f6f 6e6c 7929 0a20 2020 2020 2020 2062  _only).        b
-00008380: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
-00008390: 7365 2870 7933 5f6f 6e6c 792c 207b 5461  se(py3_only, {Ta
-000083a0: 7267 6574 5665 7273 696f 6e2e 5059 3336  rgetVersion.PY36
-000083b0: 7d29 0a0a 2020 2020 6465 6620 7465 7374  })..    def test
-000083c0: 5f67 6574 5f66 6561 7475 7265 735f 7573  _get_features_us
-000083d0: 6564 5f64 6563 6f72 6174 6f72 2873 656c  ed_decorator(sel
-000083e0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-000083f0: 2020 2020 2320 5465 7374 2074 6865 2066      # Test the f
-00008400: 6561 7475 7265 2064 6574 6563 7469 6f6e  eature detection
-00008410: 206f 6620 6e65 7720 6465 636f 7261 746f   of new decorato
-00008420: 7220 7379 6e74 6178 0a20 2020 2020 2020  r syntax.       
-00008430: 2023 2073 696e 6365 2074 6869 7320 6d61   # since this ma
-00008440: 6b65 7320 736f 6d65 2074 6573 7420 6361  kes some test ca
-00008450: 7365 7320 6f66 2074 6573 745f 6765 745f  ses of test_get_
-00008460: 6665 6174 7572 6573 5f75 7365 6428 290a  features_used().
-00008470: 2020 2020 2020 2020 2320 6661 696c 7320          # fails 
-00008480: 6966 2069 7420 6661 696c 732c 2074 6869  if it fails, thi
-00008490: 7320 6973 2074 6573 7465 6420 6669 7273  s is tested firs
-000084a0: 7420 736f 2074 6861 7420 6120 7573 6566  t so that a usef
-000084b0: 756c 2063 6173 650a 2020 2020 2020 2020  ul case.        
-000084c0: 2320 6973 2069 6465 6e74 6966 6965 640a  # is identified.
-000084d0: 2020 2020 2020 2020 7369 6d70 6c65 732c          simples,
-000084e0: 2072 656c 6178 6564 203d 2072 6561 645f   relaxed = read_
-000084f0: 6461 7461 2822 6d69 7363 656c 6c61 6e65  data("miscellane
-00008500: 6f75 7322 2c20 2264 6563 6f72 6174 6f72  ous", "decorator
-00008510: 7322 290a 2020 2020 2020 2020 2320 736b  s").        # sk
-00008520: 6970 2065 7870 6c61 6e61 7469 6f6e 2063  ip explanation c
-00008530: 6f6d 6d65 6e74 7320 6174 2074 6865 2074  omments at the t
-00008540: 6f70 206f 6620 7468 6520 6669 6c65 0a20  op of the file. 
-00008550: 2020 2020 2020 2066 6f72 2073 696d 706c         for simpl
-00008560: 655f 7465 7374 2069 6e20 7369 6d70 6c65  e_test in simple
-00008570: 732e 7370 6c69 7428 2223 2322 295b 313a  s.split("##")[1:
-00008580: 5d3a 0a20 2020 2020 2020 2020 2020 206e  ]:.            n
-00008590: 6f64 6520 3d20 626c 6163 6b2e 6c69 6232  ode = black.lib2
-000085a0: 746f 335f 7061 7273 6528 7369 6d70 6c65  to3_parse(simple
-000085b0: 5f74 6573 7429 0a20 2020 2020 2020 2020  _test).         
-000085c0: 2020 2064 6563 6f72 6174 6f72 203d 2073     decorator = s
-000085d0: 7472 286e 6f64 652e 6368 696c 6472 656e  tr(node.children
-000085e0: 5b30 5d2e 6368 696c 6472 656e 5b30 5d29  [0].children[0])
-000085f0: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
-00008600: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00008610: 4e6f 7449 6e28 0a20 2020 2020 2020 2020  NotIn(.         
-00008620: 2020 2020 2020 2046 6561 7475 7265 2e52         Feature.R
-00008630: 454c 4158 4544 5f44 4543 4f52 4154 4f52  ELAXED_DECORATOR
-00008640: 532c 0a20 2020 2020 2020 2020 2020 2020  S,.             
-00008650: 2020 2062 6c61 636b 2e67 6574 5f66 6561     black.get_fea
-00008660: 7475 7265 735f 7573 6564 286e 6f64 6529  tures_used(node)
-00008670: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00008680: 2020 6d73 673d 280a 2020 2020 2020 2020    msg=(.        
-00008690: 2020 2020 2020 2020 2020 2020 6622 6465              f"de
-000086a0: 636f 7261 746f 7220 277b 6465 636f 7261  corator '{decora
-000086b0: 746f 727d 2720 666f 6c6c 6f77 7320 7079  tor}' follows py
-000086c0: 7468 6f6e 3c3d 332e 3820 7379 6e74 6178  thon<=3.8 syntax
-000086d0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000086e0: 2020 2020 2020 2262 7574 2069 7320 6465        "but is de
-000086f0: 7465 6374 6564 2061 7320 332e 392b 220a  tected as 3.9+".
-00008700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008710: 2020 2020 2320 6622 5468 6520 6675 6c6c      # f"The full
-00008720: 206e 6f64 6520 6973 5c6e 7b6e 6f64 6521   node is\n{node!
-00008730: 727d 220a 2020 2020 2020 2020 2020 2020  r}".            
-00008740: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
-00008750: 2020 2029 0a20 2020 2020 2020 2023 2073     ).        # s
-00008760: 6b69 7020 7468 6520 2723 206f 7574 7075  kip the '# outpu
-00008770: 7427 2063 6f6d 6d65 6e74 2061 7420 7468  t' comment at th
-00008780: 6520 746f 7020 6f66 2074 6865 206f 7574  e top of the out
-00008790: 7075 7420 7061 7274 0a20 2020 2020 2020  put part.       
-000087a0: 2066 6f72 2072 656c 6178 6564 5f74 6573   for relaxed_tes
-000087b0: 7420 696e 2072 656c 6178 6564 2e73 706c  t in relaxed.spl
-000087c0: 6974 2822 2323 2229 5b31 3a5d 3a0a 2020  it("##")[1:]:.  
-000087d0: 2020 2020 2020 2020 2020 6e6f 6465 203d            node =
-000087e0: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
-000087f0: 6172 7365 2872 656c 6178 6564 5f74 6573  arse(relaxed_tes
-00008800: 7429 0a20 2020 2020 2020 2020 2020 2064  t).            d
-00008810: 6563 6f72 6174 6f72 203d 2073 7472 286e  ecorator = str(n
-00008820: 6f64 652e 6368 696c 6472 656e 5b30 5d2e  ode.children[0].
-00008830: 6368 696c 6472 656e 5b30 5d29 2e73 7472  children[0]).str
-00008840: 6970 2829 0a20 2020 2020 2020 2020 2020  ip().           
-00008850: 2073 656c 662e 6173 7365 7274 496e 280a   self.assertIn(.
-00008860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008870: 4665 6174 7572 652e 5245 4c41 5845 445f  Feature.RELAXED_
-00008880: 4445 434f 5241 544f 5253 2c0a 2020 2020  DECORATORS,.    
-00008890: 2020 2020 2020 2020 2020 2020 626c 6163              blac
-000088a0: 6b2e 6765 745f 6665 6174 7572 6573 5f75  k.get_features_u
-000088b0: 7365 6428 6e6f 6465 292c 0a20 2020 2020  sed(node),.     
-000088c0: 2020 2020 2020 2020 2020 206d 7367 3d28             msg=(
-000088d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000088e0: 2020 2020 2066 2264 6563 6f72 6174 6f72       f"decorator
-000088f0: 2027 7b64 6563 6f72 6174 6f72 7d27 2075   '{decorator}' u
-00008900: 7365 7320 7079 7468 6f6e 332e 392b 2073  ses python3.9+ s
-00008910: 796e 7461 7822 0a20 2020 2020 2020 2020  yntax".         
-00008920: 2020 2020 2020 2020 2020 2022 6275 7420             "but 
-00008930: 6973 2064 6574 6563 7465 6420 6173 2070  is detected as p
-00008940: 7974 686f 6e3c 3d33 2e38 220a 2020 2020  ython<=3.8".    
-00008950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008960: 2320 6622 5468 6520 6675 6c6c 206e 6f64  # f"The full nod
-00008970: 6520 6973 5c6e 7b6e 6f64 6521 727d 220a  e is\n{node!r}".
-00008980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008990: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
-000089a0: 0a0a 2020 2020 6465 6620 7465 7374 5f67  ..    def test_g
-000089b0: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
-000089c0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-000089d0: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-000089e0: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
-000089f0: 2822 6465 6620 6628 2a2c 2061 7267 293a  ("def f(*, arg):
-00008a00: 202e 2e2e 5c6e 222c 2073 6574 2829 290a   ...\n", set()).
-00008a10: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-00008a20: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
-00008a30: 280a 2020 2020 2020 2020 2020 2020 2264  (.            "d
-00008a40: 6566 2066 282a 2c20 6172 672c 293a 202e  ef f(*, arg,): .
-00008a50: 2e2e 5c6e 222c 207b 4665 6174 7572 652e  ..\n", {Feature.
-00008a60: 5452 4149 4c49 4e47 5f43 4f4d 4d41 5f49  TRAILING_COMMA_I
-00008a70: 4e5f 4445 467d 0a20 2020 2020 2020 2029  N_DEF}.        )
-00008a80: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
-00008a90: 6563 6b5f 6665 6174 7572 6573 5f75 7365  eck_features_use
-00008aa0: 6428 2266 282a 6172 672c 295c 6e22 2c20  d("f(*arg,)\n", 
-00008ab0: 7b46 6561 7475 7265 2e54 5241 494c 494e  {Feature.TRAILIN
-00008ac0: 475f 434f 4d4d 415f 494e 5f43 414c 4c7d  G_COMMA_IN_CALL}
-00008ad0: 290a 2020 2020 2020 2020 7365 6c66 2e63  ).        self.c
-00008ae0: 6865 636b 5f66 6561 7475 7265 735f 7573  heck_features_us
-00008af0: 6564 2822 6465 6620 6628 2a2c 2061 7267  ed("def f(*, arg
-00008b00: 293a 2066 2773 7472 696e 6727 5c6e 222c  ): f'string'\n",
-00008b10: 207b 4665 6174 7572 652e 465f 5354 5249   {Feature.F_STRI
-00008b20: 4e47 537d 290a 2020 2020 2020 2020 7365  NGS}).        se
-00008b30: 6c66 2e63 6865 636b 5f66 6561 7475 7265  lf.check_feature
-00008b40: 735f 7573 6564 2822 3132 335f 3435 365c  s_used("123_456\
-00008b50: 6e22 2c20 7b46 6561 7475 7265 2e4e 554d  n", {Feature.NUM
-00008b60: 4552 4943 5f55 4e44 4552 5343 4f52 4553  ERIC_UNDERSCORES
-00008b70: 7d29 0a20 2020 2020 2020 2073 656c 662e  }).        self.
-00008b80: 6368 6563 6b5f 6665 6174 7572 6573 5f75  check_features_u
-00008b90: 7365 6428 2231 3233 3435 365c 6e22 2c20  sed("123456\n", 
-00008ba0: 7365 7428 2929 0a0a 2020 2020 2020 2020  set())..        
-00008bb0: 736f 7572 6365 2c20 6578 7065 6374 6564  source, expected
-00008bc0: 203d 2072 6561 645f 6461 7461 2822 6361   = read_data("ca
-00008bd0: 7365 7322 2c20 2266 756e 6374 696f 6e22  ses", "function"
-00008be0: 290a 2020 2020 2020 2020 6578 7065 6374  ).        expect
-00008bf0: 6564 5f66 6561 7475 7265 7320 3d20 7b0a  ed_features = {.
-00008c00: 2020 2020 2020 2020 2020 2020 4665 6174              Feat
-00008c10: 7572 652e 5452 4149 4c49 4e47 5f43 4f4d  ure.TRAILING_COM
-00008c20: 4d41 5f49 4e5f 4341 4c4c 2c0a 2020 2020  MA_IN_CALL,.    
-00008c30: 2020 2020 2020 2020 4665 6174 7572 652e          Feature.
-00008c40: 5452 4149 4c49 4e47 5f43 4f4d 4d41 5f49  TRAILING_COMMA_I
-00008c50: 4e5f 4445 462c 0a20 2020 2020 2020 2020  N_DEF,.         
-00008c60: 2020 2046 6561 7475 7265 2e46 5f53 5452     Feature.F_STR
-00008c70: 494e 4753 2c0a 2020 2020 2020 2020 7d0a  INGS,.        }.
-00008c80: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-00008c90: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
-00008ca0: 2873 6f75 7263 652c 2065 7870 6563 7465  (source, expecte
-00008cb0: 645f 6665 6174 7572 6573 290a 2020 2020  d_features).    
-00008cc0: 2020 2020 7365 6c66 2e63 6865 636b 5f66      self.check_f
-00008cd0: 6561 7475 7265 735f 7573 6564 2865 7870  eatures_used(exp
-00008ce0: 6563 7465 642c 2065 7870 6563 7465 645f  ected, expected_
-00008cf0: 6665 6174 7572 6573 290a 0a20 2020 2020  features)..     
-00008d00: 2020 2073 6f75 7263 652c 2065 7870 6563     source, expec
-00008d10: 7465 6420 3d20 7265 6164 5f64 6174 6128  ted = read_data(
-00008d20: 2263 6173 6573 222c 2022 6578 7072 6573  "cases", "expres
-00008d30: 7369 6f6e 2229 0a20 2020 2020 2020 2073  sion").        s
-00008d40: 656c 662e 6368 6563 6b5f 6665 6174 7572  elf.check_featur
-00008d50: 6573 5f75 7365 6428 736f 7572 6365 2c20  es_used(source, 
-00008d60: 7365 7428 2929 0a20 2020 2020 2020 2073  set()).        s
-00008d70: 656c 662e 6368 6563 6b5f 6665 6174 7572  elf.check_featur
-00008d80: 6573 5f75 7365 6428 6578 7065 6374 6564  es_used(expected
-00008d90: 2c20 7365 7428 2929 0a0a 2020 2020 2020  , set())..      
-00008da0: 2020 7365 6c66 2e63 6865 636b 5f66 6561    self.check_fea
-00008db0: 7475 7265 735f 7573 6564 2822 6c61 6d62  tures_used("lamb
-00008dc0: 6461 2061 2c20 2f2c 2062 3a20 2e2e 2e5c  da a, /, b: ...\
-00008dd0: 6e22 2c20 7b46 6561 7475 7265 2e50 4f53  n", {Feature.POS
-00008de0: 5f4f 4e4c 595f 4152 4755 4d45 4e54 537d  _ONLY_ARGUMENTS}
-00008df0: 290a 2020 2020 2020 2020 7365 6c66 2e63  ).        self.c
-00008e00: 6865 636b 5f66 6561 7475 7265 735f 7573  heck_features_us
-00008e10: 6564 2822 6465 6620 666e 2861 2c20 2f2c  ed("def fn(a, /,
-00008e20: 2062 293a 202e 2e2e 222c 207b 4665 6174   b): ...", {Feat
-00008e30: 7572 652e 504f 535f 4f4e 4c59 5f41 5247  ure.POS_ONLY_ARG
-00008e40: 554d 454e 5453 7d29 0a0a 2020 2020 2020  UMENTS})..      
-00008e50: 2020 7365 6c66 2e63 6865 636b 5f66 6561    self.check_fea
-00008e60: 7475 7265 735f 7573 6564 2822 6465 6620  tures_used("def 
-00008e70: 666e 2829 3a20 7969 656c 6420 612c 2062  fn(): yield a, b
-00008e80: 222c 2073 6574 2829 290a 2020 2020 2020  ", set()).      
-00008e90: 2020 7365 6c66 2e63 6865 636b 5f66 6561    self.check_fea
-00008ea0: 7475 7265 735f 7573 6564 2822 6465 6620  tures_used("def 
-00008eb0: 666e 2829 3a20 7265 7475 726e 2061 2c20  fn(): return a, 
-00008ec0: 6222 2c20 7365 7428 2929 0a20 2020 2020  b", set()).     
-00008ed0: 2020 2073 656c 662e 6368 6563 6b5f 6665     self.check_fe
-00008ee0: 6174 7572 6573 5f75 7365 6428 2264 6566  atures_used("def
-00008ef0: 2066 6e28 293a 2079 6965 6c64 202a 622c   fn(): yield *b,
-00008f00: 2063 222c 207b 4665 6174 7572 652e 554e   c", {Feature.UN
-00008f10: 5041 434b 494e 475f 4f4e 5f46 4c4f 577d  PACKING_ON_FLOW}
-00008f20: 290a 2020 2020 2020 2020 7365 6c66 2e63  ).        self.c
-00008f30: 6865 636b 5f66 6561 7475 7265 735f 7573  heck_features_us
-00008f40: 6564 280a 2020 2020 2020 2020 2020 2020  ed(.            
-00008f50: 2264 6566 2066 6e28 293a 2072 6574 7572  "def fn(): retur
-00008f60: 6e20 612c 202a 622c 2063 222c 207b 4665  n a, *b, c", {Fe
-00008f70: 6174 7572 652e 554e 5041 434b 494e 475f  ature.UNPACKING_
-00008f80: 4f4e 5f46 4c4f 577d 0a20 2020 2020 2020  ON_FLOW}.       
-00008f90: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
-00008fa0: 6368 6563 6b5f 6665 6174 7572 6573 5f75  check_features_u
-00008fb0: 7365 6428 2278 203d 2061 2c20 2a62 2c20  sed("x = a, *b, 
-00008fc0: 6322 2c20 7365 7428 2929 0a0a 2020 2020  c", set())..    
-00008fd0: 2020 2020 7365 6c66 2e63 6865 636b 5f66      self.check_f
-00008fe0: 6561 7475 7265 735f 7573 6564 2822 783a  eatures_used("x:
-00008ff0: 2041 6e79 203d 2072 6567 756c 6172 222c   Any = regular",
-00009000: 2073 6574 2829 290a 2020 2020 2020 2020   set()).        
-00009010: 7365 6c66 2e63 6865 636b 5f66 6561 7475  self.check_featu
-00009020: 7265 735f 7573 6564 2822 783a 2041 6e79  res_used("x: Any
-00009030: 203d 2028 7265 6775 6c61 722c 2072 6567   = (regular, reg
-00009040: 756c 6172 2922 2c20 7365 7428 2929 0a20  ular)", set()). 
-00009050: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
-00009060: 6b5f 6665 6174 7572 6573 5f75 7365 6428  k_features_used(
-00009070: 2278 3a20 416e 7920 3d20 436f 6d70 6c65  "x: Any = Comple
-00009080: 7828 5479 7065 2831 2929 5b73 6f6d 6574  x(Type(1))[somet
-00009090: 6869 6e67 5d22 2c20 7365 7428 2929 0a20  hing]", set()). 
-000090a0: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
-000090b0: 6b5f 6665 6174 7572 6573 5f75 7365 6428  k_features_used(
-000090c0: 0a20 2020 2020 2020 2020 2020 2022 783a  .            "x:
-000090d0: 2054 7570 6c65 5b69 6e74 2c20 2e2e 2e5d   Tuple[int, ...]
-000090e0: 203d 2061 2c20 622c 2063 222c 207b 4665   = a, b, c", {Fe
-000090f0: 6174 7572 652e 414e 4e5f 4153 5349 474e  ature.ANN_ASSIGN
-00009100: 5f45 5854 454e 4445 445f 5248 537d 0a20  _EXTENDED_RHS}. 
-00009110: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00009120: 2020 7365 6c66 2e63 6865 636b 5f66 6561    self.check_fea
-00009130: 7475 7265 735f 7573 6564 2822 7472 793a  tures_used("try:
-00009140: 2070 6173 735c 6e65 7863 6570 7420 536f   pass\nexcept So
-00009150: 6d65 7468 696e 673a 2070 6173 7322 2c20  mething: pass", 
-00009160: 7365 7428 2929 0a20 2020 2020 2020 2073  set()).        s
-00009170: 656c 662e 6368 6563 6b5f 6665 6174 7572  elf.check_featur
-00009180: 6573 5f75 7365 6428 2274 7279 3a20 7061  es_used("try: pa
-00009190: 7373 5c6e 6578 6365 7074 2028 2a53 6f6d  ss\nexcept (*Som
-000091a0: 6574 6869 6e67 2c29 3a20 7061 7373 222c  ething,): pass",
-000091b0: 2073 6574 2829 290a 2020 2020 2020 2020   set()).        
-000091c0: 7365 6c66 2e63 6865 636b 5f66 6561 7475  self.check_featu
-000091d0: 7265 735f 7573 6564 280a 2020 2020 2020  res_used(.      
-000091e0: 2020 2020 2020 2274 7279 3a20 7061 7373        "try: pass
-000091f0: 5c6e 6578 6365 7074 202a 4772 6f75 703a  \nexcept *Group:
-00009200: 2070 6173 7322 2c20 7b46 6561 7475 7265   pass", {Feature
-00009210: 2e45 5843 4550 545f 5354 4152 7d0a 2020  .EXCEPT_STAR}.  
-00009220: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00009230: 2073 656c 662e 6368 6563 6b5f 6665 6174   self.check_feat
-00009240: 7572 6573 5f75 7365 6428 2261 5b2a 625d  ures_used("a[*b]
-00009250: 222c 207b 4665 6174 7572 652e 5641 5249  ", {Feature.VARI
-00009260: 4144 4943 5f47 454e 4552 4943 537d 290a  ADIC_GENERICS}).
-00009270: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-00009280: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
-00009290: 2822 615b 782c 202a 7928 292c 207a 5d20  ("a[x, *y(), z] 
-000092a0: 3d20 7422 2c20 7b46 6561 7475 7265 2e56  = t", {Feature.V
-000092b0: 4152 4941 4449 435f 4745 4e45 5249 4353  ARIADIC_GENERICS
-000092c0: 7d29 0a20 2020 2020 2020 2073 656c 662e  }).        self.
-000092d0: 6368 6563 6b5f 6665 6174 7572 6573 5f75  check_features_u
-000092e0: 7365 6428 2264 6566 2066 6e28 2a61 7267  sed("def fn(*arg
-000092f0: 733a 202a 5429 3a20 7061 7373 222c 207b  s: *T): pass", {
-00009300: 4665 6174 7572 652e 5641 5249 4144 4943  Feature.VARIADIC
-00009310: 5f47 454e 4552 4943 537d 290a 0a20 2020  _GENERICS})..   
-00009320: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
-00009330: 6665 6174 7572 6573 5f75 7365 6428 2277  features_used("w
-00009340: 6974 6820 613a 2070 6173 7322 2c20 7365  ith a: pass", se
-00009350: 7428 2929 0a20 2020 2020 2020 2073 656c  t()).        sel
-00009360: 662e 6368 6563 6b5f 6665 6174 7572 6573  f.check_features
-00009370: 5f75 7365 6428 2277 6974 6820 612c 2062  _used("with a, b
-00009380: 3a20 7061 7373 222c 2073 6574 2829 290a  : pass", set()).
-00009390: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-000093a0: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
-000093b0: 2822 7769 7468 2061 2061 7320 623a 2070  ("with a as b: p
-000093c0: 6173 7322 2c20 7365 7428 2929 0a20 2020  ass", set()).   
-000093d0: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
-000093e0: 6665 6174 7572 6573 5f75 7365 6428 2277  features_used("w
-000093f0: 6974 6820 6120 6173 2062 2c20 6320 6173  ith a as b, c as
-00009400: 2064 3a20 7061 7373 222c 2073 6574 2829   d: pass", set()
-00009410: 290a 2020 2020 2020 2020 7365 6c66 2e63  ).        self.c
-00009420: 6865 636b 5f66 6561 7475 7265 735f 7573  heck_features_us
-00009430: 6564 2822 7769 7468 2028 6129 3a20 7061  ed("with (a): pa
-00009440: 7373 222c 2073 6574 2829 290a 2020 2020  ss", set()).    
-00009450: 2020 2020 7365 6c66 2e63 6865 636b 5f66      self.check_f
-00009460: 6561 7475 7265 735f 7573 6564 2822 7769  eatures_used("wi
-00009470: 7468 2028 612c 2062 293a 2070 6173 7322  th (a, b): pass"
-00009480: 2c20 7365 7428 2929 0a20 2020 2020 2020  , set()).       
-00009490: 2073 656c 662e 6368 6563 6b5f 6665 6174   self.check_feat
-000094a0: 7572 6573 5f75 7365 6428 2277 6974 6820  ures_used("with 
-000094b0: 2861 2c20 6229 2061 7320 2863 2c20 6429  (a, b) as (c, d)
-000094c0: 3a20 7061 7373 222c 2073 6574 2829 290a  : pass", set()).
-000094d0: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-000094e0: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
-000094f0: 280a 2020 2020 2020 2020 2020 2020 2277  (.            "w
-00009500: 6974 6820 2861 2061 7320 6229 3a20 7061  ith (a as b): pa
-00009510: 7373 222c 207b 4665 6174 7572 652e 5041  ss", {Feature.PA
-00009520: 5245 4e54 4845 5349 5a45 445f 434f 4e54  RENTHESIZED_CONT
-00009530: 4558 545f 4d41 4e41 4745 5253 7d0a 2020  EXT_MANAGERS}.  
-00009540: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00009550: 7365 6c66 2e63 6865 636b 5f66 6561 7475  self.check_featu
-00009560: 7265 735f 7573 6564 280a 2020 2020 2020  res_used(.      
-00009570: 2020 2020 2020 2277 6974 6820 2828 6120        "with ((a 
-00009580: 6173 2062 2929 3a20 7061 7373 222c 207b  as b)): pass", {
-00009590: 4665 6174 7572 652e 5041 5245 4e54 4845  Feature.PARENTHE
-000095a0: 5349 5a45 445f 434f 4e54 4558 545f 4d41  SIZED_CONTEXT_MA
-000095b0: 4e41 4745 5253 7d0a 2020 2020 2020 2020  NAGERS}.        
-000095c0: 290a 2020 2020 2020 2020 7365 6c66 2e63  ).        self.c
-000095d0: 6865 636b 5f66 6561 7475 7265 735f 7573  heck_features_us
-000095e0: 6564 280a 2020 2020 2020 2020 2020 2020  ed(.            
-000095f0: 2277 6974 6820 2861 2c20 6220 6173 2063  "with (a, b as c
-00009600: 293a 2070 6173 7322 2c20 7b46 6561 7475  ): pass", {Featu
-00009610: 7265 2e50 4152 454e 5448 4553 495a 4544  re.PARENTHESIZED
-00009620: 5f43 4f4e 5445 5854 5f4d 414e 4147 4552  _CONTEXT_MANAGER
-00009630: 537d 0a20 2020 2020 2020 2029 0a20 2020  S}.        ).   
-00009640: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
-00009650: 6665 6174 7572 6573 5f75 7365 6428 0a20  features_used(. 
-00009660: 2020 2020 2020 2020 2020 2022 7769 7468             "with
-00009670: 2028 612c 2028 6220 6173 2063 2929 3a20   (a, (b as c)): 
-00009680: 7061 7373 222c 207b 4665 6174 7572 652e  pass", {Feature.
-00009690: 5041 5245 4e54 4845 5349 5a45 445f 434f  PARENTHESIZED_CO
-000096a0: 4e54 4558 545f 4d41 4e41 4745 5253 7d0a  NTEXT_MANAGERS}.
-000096b0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000096c0: 2020 7365 6c66 2e63 6865 636b 5f66 6561    self.check_fea
-000096d0: 7475 7265 735f 7573 6564 280a 2020 2020  tures_used(.    
-000096e0: 2020 2020 2020 2020 2277 6974 6820 2828          "with ((
-000096f0: 612c 2028 2862 2061 7320 6329 2929 293a  a, ((b as c)))):
-00009700: 2070 6173 7322 2c20 7b46 6561 7475 7265   pass", {Feature
-00009710: 2e50 4152 454e 5448 4553 495a 4544 5f43  .PARENTHESIZED_C
-00009720: 4f4e 5445 5854 5f4d 414e 4147 4552 537d  ONTEXT_MANAGERS}
-00009730: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00009740: 6465 6620 6368 6563 6b5f 6665 6174 7572  def check_featur
-00009750: 6573 5f75 7365 6428 7365 6c66 2c20 736f  es_used(self, so
-00009760: 7572 6365 3a20 7374 722c 2065 7870 6563  urce: str, expec
-00009770: 7465 643a 2053 6574 5b46 6561 7475 7265  ted: Set[Feature
-00009780: 5d29 202d 3e20 4e6f 6e65 3a0a 2020 2020  ]) -> None:.    
-00009790: 2020 2020 6e6f 6465 203d 2062 6c61 636b      node = black
-000097a0: 2e6c 6962 3274 6f33 5f70 6172 7365 2873  .lib2to3_parse(s
-000097b0: 6f75 7263 6529 0a20 2020 2020 2020 2061  ource).        a
-000097c0: 6374 7561 6c20 3d20 626c 6163 6b2e 6765  ctual = black.ge
-000097d0: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
-000097e0: 6e6f 6465 290a 2020 2020 2020 2020 6d73  node).        ms
-000097f0: 6720 3d20 6622 4578 7065 6374 6564 207b  g = f"Expected {
-00009800: 6578 7065 6374 6564 7d20 6275 7420 676f  expected} but go
-00009810: 7420 7b61 6374 7561 6c7d 2066 6f72 207b  t {actual} for {
-00009820: 736f 7572 6365 2172 7d22 0a20 2020 2020  source!r}".     
-00009830: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00009840: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00009850: 7175 616c 2861 6374 7561 6c2c 2065 7870  qual(actual, exp
-00009860: 6563 7465 642c 206d 7367 3d6d 7367 290a  ected, msg=msg).
-00009870: 2020 2020 2020 2020 6578 6365 7074 2041          except A
-00009880: 7373 6572 7469 6f6e 4572 726f 723a 0a20  ssertionError:. 
-00009890: 2020 2020 2020 2020 2020 2044 6562 7567             Debug
-000098a0: 5669 7369 746f 722e 7368 6f77 286e 6f64  Visitor.show(nod
-000098b0: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
-000098c0: 6169 7365 0a0a 2020 2020 6465 6620 7465  aise..    def te
-000098d0: 7374 5f67 6574 5f66 6561 7475 7265 735f  st_get_features_
-000098e0: 7573 6564 5f66 6f72 5f66 7574 7572 655f  used_for_future_
-000098f0: 666c 6167 7328 7365 6c66 2920 2d3e 204e  flags(self) -> N
-00009900: 6f6e 653a 0a20 2020 2020 2020 2066 6f72  one:.        for
-00009910: 2073 7263 2c20 6665 6174 7572 6573 2069   src, features i
-00009920: 6e20 5b0a 2020 2020 2020 2020 2020 2020  n [.            
-00009930: 2822 6672 6f6d 205f 5f66 7574 7572 655f  ("from __future_
-00009940: 5f20 696d 706f 7274 2061 6e6e 6f74 6174  _ import annotat
-00009950: 696f 6e73 222c 207b 4665 6174 7572 652e  ions", {Feature.
-00009960: 4655 5455 5245 5f41 4e4e 4f54 4154 494f  FUTURE_ANNOTATIO
-00009970: 4e53 7d29 2c0a 2020 2020 2020 2020 2020  NS}),.          
-00009980: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
-00009990: 2020 2020 2266 726f 6d20 5f5f 6675 7475      "from __futu
-000099a0: 7265 5f5f 2069 6d70 6f72 7420 286f 7468  re__ import (oth
-000099b0: 6572 2c20 616e 6e6f 7461 7469 6f6e 7329  er, annotations)
-000099c0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-000099d0: 2020 207b 4665 6174 7572 652e 4655 5455     {Feature.FUTU
-000099e0: 5245 5f41 4e4e 4f54 4154 494f 4e53 7d2c  RE_ANNOTATIONS},
-000099f0: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
-00009a00: 2020 2020 2020 2020 2020 2020 2822 6120              ("a 
-00009a10: 3d20 3120 2b20 325c 6e66 726f 6d20 736f  = 1 + 2\nfrom so
-00009a20: 6d65 7468 696e 6720 696d 706f 7274 2061  mething import a
-00009a30: 6e6e 6f74 6174 696f 6e73 222c 2073 6574  nnotations", set
-00009a40: 2829 292c 0a20 2020 2020 2020 2020 2020  ()),.           
-00009a50: 2028 2266 726f 6d20 5f5f 6675 7475 7265   ("from __future
-00009a60: 5f5f 2069 6d70 6f72 7420 782c 2079 222c  __ import x, y",
-00009a70: 2073 6574 2829 292c 0a20 2020 2020 2020   set()),.       
-00009a80: 205d 3a0a 2020 2020 2020 2020 2020 2020   ]:.            
-00009a90: 7769 7468 2073 656c 662e 7375 6254 6573  with self.subTes
-00009aa0: 7428 7372 633d 7372 632c 2066 6561 7475  t(src=src, featu
-00009ab0: 7265 733d 6665 6174 7572 6573 293a 0a20  res=features):. 
-00009ac0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00009ad0: 6f64 6520 3d20 626c 6163 6b2e 6c69 6232  ode = black.lib2
-00009ae0: 746f 335f 7061 7273 6528 7372 6329 0a20  to3_parse(src). 
-00009af0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00009b00: 7574 7572 655f 696d 706f 7274 7320 3d20  uture_imports = 
-00009b10: 626c 6163 6b2e 6765 745f 6675 7475 7265  black.get_future
-00009b20: 5f69 6d70 6f72 7473 286e 6f64 6529 0a20  _imports(node). 
-00009b30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00009b40: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00009b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009b60: 2020 2020 2062 6c61 636b 2e67 6574 5f66       black.get_f
-00009b70: 6561 7475 7265 735f 7573 6564 286e 6f64  eatures_used(nod
-00009b80: 652c 2066 7574 7572 655f 696d 706f 7274  e, future_import
-00009b90: 733d 6675 7475 7265 5f69 6d70 6f72 7473  s=future_imports
-00009ba0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00009bb0: 2020 2020 2020 2066 6561 7475 7265 732c         features,
-00009bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009bd0: 2029 0a0a 2020 2020 6465 6620 7465 7374   )..    def test
-00009be0: 5f67 6574 5f66 7574 7572 655f 696d 706f  _get_future_impo
-00009bf0: 7274 7328 7365 6c66 2920 2d3e 204e 6f6e  rts(self) -> Non
-00009c00: 653a 0a20 2020 2020 2020 206e 6f64 6520  e:.        node 
-00009c10: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
-00009c20: 7061 7273 6528 225c 6e22 290a 2020 2020  parse("\n").    
-00009c30: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00009c40: 7175 616c 2873 6574 2829 2c20 626c 6163  qual(set(), blac
-00009c50: 6b2e 6765 745f 6675 7475 7265 5f69 6d70  k.get_future_imp
-00009c60: 6f72 7473 286e 6f64 6529 290a 2020 2020  orts(node)).    
-00009c70: 2020 2020 6e6f 6465 203d 2062 6c61 636b      node = black
-00009c80: 2e6c 6962 3274 6f33 5f70 6172 7365 2822  .lib2to3_parse("
-00009c90: 6672 6f6d 205f 5f66 7574 7572 655f 5f20  from __future__ 
-00009ca0: 696d 706f 7274 2062 6c61 636b 5c6e 2229  import black\n")
-00009cb0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00009cc0: 7365 7274 4571 7561 6c28 7b22 626c 6163  sertEqual({"blac
-00009cd0: 6b22 7d2c 2062 6c61 636b 2e67 6574 5f66  k"}, black.get_f
-00009ce0: 7574 7572 655f 696d 706f 7274 7328 6e6f  uture_imports(no
-00009cf0: 6465 2929 0a20 2020 2020 2020 206e 6f64  de)).        nod
-00009d00: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
-00009d10: 335f 7061 7273 6528 2266 726f 6d20 5f5f  3_parse("from __
-00009d20: 6675 7475 7265 5f5f 2069 6d70 6f72 7420  future__ import 
-00009d30: 6d75 6c74 6970 6c65 2c20 696d 706f 7274  multiple, import
-00009d40: 735c 6e22 290a 2020 2020 2020 2020 7365  s\n").        se
-00009d50: 6c66 2e61 7373 6572 7445 7175 616c 287b  lf.assertEqual({
-00009d60: 226d 756c 7469 706c 6522 2c20 2269 6d70  "multiple", "imp
-00009d70: 6f72 7473 227d 2c20 626c 6163 6b2e 6765  orts"}, black.ge
-00009d80: 745f 6675 7475 7265 5f69 6d70 6f72 7473  t_future_imports
-00009d90: 286e 6f64 6529 290a 2020 2020 2020 2020  (node)).        
-00009da0: 6e6f 6465 203d 2062 6c61 636b 2e6c 6962  node = black.lib
-00009db0: 3274 6f33 5f70 6172 7365 2822 6672 6f6d  2to3_parse("from
-00009dc0: 205f 5f66 7574 7572 655f 5f20 696d 706f   __future__ impo
-00009dd0: 7274 2028 7061 7265 6e74 6865 7369 7a65  rt (parenthesize
-00009de0: 642c 2069 6d70 6f72 7473 295c 6e22 290a  d, imports)\n").
-00009df0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00009e00: 6572 7445 7175 616c 287b 2270 6172 656e  ertEqual({"paren
-00009e10: 7468 6573 697a 6564 222c 2022 696d 706f  thesized", "impo
-00009e20: 7274 7322 7d2c 2062 6c61 636b 2e67 6574  rts"}, black.get
-00009e30: 5f66 7574 7572 655f 696d 706f 7274 7328  _future_imports(
-00009e40: 6e6f 6465 2929 0a20 2020 2020 2020 206e  node)).        n
-00009e50: 6f64 6520 3d20 626c 6163 6b2e 6c69 6232  ode = black.lib2
-00009e60: 746f 335f 7061 7273 6528 0a20 2020 2020  to3_parse(.     
-00009e70: 2020 2020 2020 2022 6672 6f6d 205f 5f66         "from __f
-00009e80: 7574 7572 655f 5f20 696d 706f 7274 206d  uture__ import m
-00009e90: 756c 7469 706c 655c 6e66 726f 6d20 5f5f  ultiple\nfrom __
-00009ea0: 6675 7475 7265 5f5f 2069 6d70 6f72 7420  future__ import 
-00009eb0: 696d 706f 7274 735c 6e22 0a20 2020 2020  imports\n".     
-00009ec0: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
-00009ed0: 662e 6173 7365 7274 4571 7561 6c28 7b22  f.assertEqual({"
-00009ee0: 6d75 6c74 6970 6c65 222c 2022 696d 706f  multiple", "impo
-00009ef0: 7274 7322 7d2c 2062 6c61 636b 2e67 6574  rts"}, black.get
-00009f00: 5f66 7574 7572 655f 696d 706f 7274 7328  _future_imports(
-00009f10: 6e6f 6465 2929 0a20 2020 2020 2020 206e  node)).        n
-00009f20: 6f64 6520 3d20 626c 6163 6b2e 6c69 6232  ode = black.lib2
-00009f30: 746f 335f 7061 7273 6528 2223 2063 6f6d  to3_parse("# com
-00009f40: 6d65 6e74 5c6e 6672 6f6d 205f 5f66 7574  ment\nfrom __fut
-00009f50: 7572 655f 5f20 696d 706f 7274 2062 6c61  ure__ import bla
-00009f60: 636b 5c6e 2229 0a20 2020 2020 2020 2073  ck\n").        s
-00009f70: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00009f80: 7b22 626c 6163 6b22 7d2c 2062 6c61 636b  {"black"}, black
-00009f90: 2e67 6574 5f66 7574 7572 655f 696d 706f  .get_future_impo
-00009fa0: 7274 7328 6e6f 6465 2929 0a20 2020 2020  rts(node)).     
-00009fb0: 2020 206e 6f64 6520 3d20 626c 6163 6b2e     node = black.
-00009fc0: 6c69 6232 746f 335f 7061 7273 6528 2722  lib2to3_parse('"
-00009fd0: 2222 646f 6373 7472 696e 6722 2222 5c6e  ""docstring"""\n
-00009fe0: 6672 6f6d 205f 5f66 7574 7572 655f 5f20  from __future__ 
-00009ff0: 696d 706f 7274 2062 6c61 636b 5c6e 2729  import black\n')
-0000a000: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000a010: 7365 7274 4571 7561 6c28 7b22 626c 6163  sertEqual({"blac
-0000a020: 6b22 7d2c 2062 6c61 636b 2e67 6574 5f66  k"}, black.get_f
-0000a030: 7574 7572 655f 696d 706f 7274 7328 6e6f  uture_imports(no
-0000a040: 6465 2929 0a20 2020 2020 2020 206e 6f64  de)).        nod
-0000a050: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
-0000a060: 335f 7061 7273 6528 2273 6f6d 6528 6f74  3_parse("some(ot
-0000a070: 6865 722c 2063 6f64 6529 5c6e 6672 6f6d  her, code)\nfrom
-0000a080: 205f 5f66 7574 7572 655f 5f20 696d 706f   __future__ impo
-0000a090: 7274 2062 6c61 636b 5c6e 2229 0a20 2020  rt black\n").   
-0000a0a0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000a0b0: 4571 7561 6c28 7365 7428 292c 2062 6c61  Equal(set(), bla
-0000a0c0: 636b 2e67 6574 5f66 7574 7572 655f 696d  ck.get_future_im
-0000a0d0: 706f 7274 7328 6e6f 6465 2929 0a20 2020  ports(node)).   
-0000a0e0: 2020 2020 206e 6f64 6520 3d20 626c 6163       node = blac
-0000a0f0: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
-0000a100: 2266 726f 6d20 736f 6d65 2e6d 6f64 756c  "from some.modul
-0000a110: 6520 696d 706f 7274 2062 6c61 636b 5c6e  e import black\n
-0000a120: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-0000a130: 6173 7365 7274 4571 7561 6c28 7365 7428  assertEqual(set(
-0000a140: 292c 2062 6c61 636b 2e67 6574 5f66 7574  ), black.get_fut
-0000a150: 7572 655f 696d 706f 7274 7328 6e6f 6465  ure_imports(node
-0000a160: 2929 0a20 2020 2020 2020 206e 6f64 6520  )).        node 
-0000a170: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
-0000a180: 7061 7273 6528 0a20 2020 2020 2020 2020  parse(.         
-0000a190: 2020 2022 6672 6f6d 205f 5f66 7574 7572     "from __futur
-0000a1a0: 655f 5f20 696d 706f 7274 2075 6e69 636f  e__ import unico
-0000a1b0: 6465 5f6c 6974 6572 616c 7320 6173 205f  de_literals as _
-0000a1c0: 756e 6963 6f64 655f 6c69 7465 7261 6c73  unicode_literals
-0000a1d0: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-0000a1e0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000a1f0: 7175 616c 287b 2275 6e69 636f 6465 5f6c  qual({"unicode_l
-0000a200: 6974 6572 616c 7322 7d2c 2062 6c61 636b  iterals"}, black
-0000a210: 2e67 6574 5f66 7574 7572 655f 696d 706f  .get_future_impo
-0000a220: 7274 7328 6e6f 6465 2929 0a20 2020 2020  rts(node)).     
-0000a230: 2020 206e 6f64 6520 3d20 626c 6163 6b2e     node = black.
-0000a240: 6c69 6232 746f 335f 7061 7273 6528 0a20  lib2to3_parse(. 
-0000a250: 2020 2020 2020 2020 2020 2022 6672 6f6d             "from
-0000a260: 205f 5f66 7574 7572 655f 5f20 696d 706f   __future__ impo
-0000a270: 7274 2075 6e69 636f 6465 5f6c 6974 6572  rt unicode_liter
-0000a280: 616c 7320 6173 205f 6c6f 6c2c 2070 7269  als as _lol, pri
-0000a290: 6e74 220a 2020 2020 2020 2020 290a 2020  nt".        ).  
-0000a2a0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000a2b0: 7445 7175 616c 287b 2275 6e69 636f 6465  tEqual({"unicode
-0000a2c0: 5f6c 6974 6572 616c 7322 2c20 2270 7269  _literals", "pri
-0000a2d0: 6e74 227d 2c20 626c 6163 6b2e 6765 745f  nt"}, black.get_
-0000a2e0: 6675 7475 7265 5f69 6d70 6f72 7473 286e  future_imports(n
-0000a2f0: 6f64 6529 290a 0a20 2020 2040 7079 7465  ode))..    @pyte
-0000a300: 7374 2e6d 6172 6b2e 696e 636f 6d70 6174  st.mark.incompat
-0000a310: 6962 6c65 5f77 6974 685f 6d79 7079 630a  ible_with_mypyc.
-0000a320: 2020 2020 6465 6620 7465 7374 5f64 6562      def test_deb
-0000a330: 7567 5f76 6973 6974 6f72 2873 656c 6629  ug_visitor(self)
-0000a340: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000a350: 2020 736f 7572 6365 2c20 5f20 3d20 7265    source, _ = re
-0000a360: 6164 5f64 6174 6128 226d 6973 6365 6c6c  ad_data("miscell
-0000a370: 616e 656f 7573 222c 2022 6465 6275 675f  aneous", "debug_
-0000a380: 7669 7369 746f 7222 290a 2020 2020 2020  visitor").      
-0000a390: 2020 6578 7065 6374 6564 2c20 5f20 3d20    expected, _ = 
-0000a3a0: 7265 6164 5f64 6174 6128 226d 6973 6365  read_data("misce
-0000a3b0: 6c6c 616e 656f 7573 222c 2022 6465 6275  llaneous", "debu
-0000a3c0: 675f 7669 7369 746f 722e 6f75 7422 290a  g_visitor.out").
-0000a3d0: 2020 2020 2020 2020 6f75 745f 6c69 6e65          out_line
-0000a3e0: 7320 3d20 5b5d 0a20 2020 2020 2020 2065  s = [].        e
-0000a3f0: 7272 5f6c 696e 6573 203d 205b 5d0a 0a20  rr_lines = [].. 
-0000a400: 2020 2020 2020 2064 6566 206f 7574 286d         def out(m
-0000a410: 7367 3a20 7374 722c 202a 2a6b 7761 7267  sg: str, **kwarg
-0000a420: 733a 2041 6e79 2920 2d3e 204e 6f6e 653a  s: Any) -> None:
-0000a430: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-0000a440: 5f6c 696e 6573 2e61 7070 656e 6428 6d73  _lines.append(ms
-0000a450: 6729 0a0a 2020 2020 2020 2020 6465 6620  g)..        def 
-0000a460: 6572 7228 6d73 673a 2073 7472 2c20 2a2a  err(msg: str, **
-0000a470: 6b77 6172 6773 3a20 416e 7929 202d 3e20  kwargs: Any) -> 
-0000a480: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000a490: 2020 6572 725f 6c69 6e65 732e 6170 7065    err_lines.appe
-0000a4a0: 6e64 286d 7367 290a 0a20 2020 2020 2020  nd(msg)..       
-0000a4b0: 2077 6974 6820 7061 7463 6828 2262 6c61   with patch("bla
-0000a4c0: 636b 2e64 6562 7567 2e6f 7574 222c 206f  ck.debug.out", o
-0000a4d0: 7574 293a 0a20 2020 2020 2020 2020 2020  ut):.           
-0000a4e0: 2044 6562 7567 5669 7369 746f 722e 7368   DebugVisitor.sh
-0000a4f0: 6f77 2873 6f75 7263 6529 0a20 2020 2020  ow(source).     
-0000a500: 2020 2061 6374 7561 6c20 3d20 225c 6e22     actual = "\n"
-0000a510: 2e6a 6f69 6e28 6f75 745f 6c69 6e65 7329  .join(out_lines)
-0000a520: 202b 2022 5c6e 220a 2020 2020 2020 2020   + "\n".        
-0000a530: 6c6f 675f 6e61 6d65 203d 2022 220a 2020  log_name = "".  
-0000a540: 2020 2020 2020 6966 2065 7870 6563 7465        if expecte
-0000a550: 6420 213d 2061 6374 7561 6c3a 0a20 2020  d != actual:.   
-0000a560: 2020 2020 2020 2020 206c 6f67 5f6e 616d           log_nam
-0000a570: 6520 3d20 626c 6163 6b2e 6475 6d70 5f74  e = black.dump_t
-0000a580: 6f5f 6669 6c65 282a 6f75 745f 6c69 6e65  o_file(*out_line
-0000a590: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
-0000a5a0: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
-0000a5b0: 2020 2020 2020 2020 2065 7870 6563 7465           expecte
-0000a5c0: 642c 0a20 2020 2020 2020 2020 2020 2061  d,.            a
-0000a5d0: 6374 7561 6c2c 0a20 2020 2020 2020 2020  ctual,.         
-0000a5e0: 2020 2066 2241 5354 2070 7269 6e74 206f     f"AST print o
-0000a5f0: 7574 2069 7320 6469 6666 6572 656e 742e  ut is different.
-0000a600: 2041 6374 7561 6c20 7665 7273 696f 6e20   Actual version 
-0000a610: 6475 6d70 6564 2074 6f20 7b6c 6f67 5f6e  dumped to {log_n
-0000a620: 616d 657d 222c 0a20 2020 2020 2020 2029  ame}",.        )
-0000a630: 0a0a 2020 2020 6465 6620 7465 7374 5f66  ..    def test_f
-0000a640: 6f72 6d61 745f 6669 6c65 5f63 6f6e 7465  ormat_file_conte
-0000a650: 6e74 7328 7365 6c66 2920 2d3e 204e 6f6e  nts(self) -> Non
-0000a660: 653a 0a20 2020 2020 2020 206d 6f64 6520  e:.        mode 
-0000a670: 3d20 4445 4641 554c 545f 4d4f 4445 0a20  = DEFAULT_MODE. 
-0000a680: 2020 2020 2020 2065 6d70 7479 203d 2022         empty = "
-0000a690: 220a 2020 2020 2020 2020 7769 7468 2073  ".        with s
-0000a6a0: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-0000a6b0: 2862 6c61 636b 2e4e 6f74 6869 6e67 4368  (black.NothingCh
-0000a6c0: 616e 6765 6429 3a0a 2020 2020 2020 2020  anged):.        
-0000a6d0: 2020 2020 626c 6163 6b2e 666f 726d 6174      black.format
-0000a6e0: 5f66 696c 655f 636f 6e74 656e 7473 2865  _file_contents(e
-0000a6f0: 6d70 7479 2c20 6d6f 6465 3d6d 6f64 652c  mpty, mode=mode,
-0000a700: 2066 6173 743d 4661 6c73 6529 0a20 2020   fast=False).   
-0000a710: 2020 2020 206a 7573 745f 6e6c 203d 2022       just_nl = "
-0000a720: 5c6e 220a 2020 2020 2020 2020 7769 7468  \n".        with
-0000a730: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
-0000a740: 6573 2862 6c61 636b 2e4e 6f74 6869 6e67  es(black.Nothing
-0000a750: 4368 616e 6765 6429 3a0a 2020 2020 2020  Changed):.      
-0000a760: 2020 2020 2020 626c 6163 6b2e 666f 726d        black.form
-0000a770: 6174 5f66 696c 655f 636f 6e74 656e 7473  at_file_contents
-0000a780: 286a 7573 745f 6e6c 2c20 6d6f 6465 3d6d  (just_nl, mode=m
-0000a790: 6f64 652c 2066 6173 743d 4661 6c73 6529  ode, fast=False)
-0000a7a0: 0a20 2020 2020 2020 2073 616d 6520 3d20  .        same = 
-0000a7b0: 226a 203d 205b 312c 2032 2c20 335d 5c6e  "j = [1, 2, 3]\n
-0000a7c0: 220a 2020 2020 2020 2020 7769 7468 2073  ".        with s
-0000a7d0: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-0000a7e0: 2862 6c61 636b 2e4e 6f74 6869 6e67 4368  (black.NothingCh
-0000a7f0: 616e 6765 6429 3a0a 2020 2020 2020 2020  anged):.        
-0000a800: 2020 2020 626c 6163 6b2e 666f 726d 6174      black.format
-0000a810: 5f66 696c 655f 636f 6e74 656e 7473 2873  _file_contents(s
-0000a820: 616d 652c 206d 6f64 653d 6d6f 6465 2c20  ame, mode=mode, 
-0000a830: 6661 7374 3d46 616c 7365 290a 2020 2020  fast=False).    
-0000a840: 2020 2020 6469 6666 6572 656e 7420 3d20      different = 
-0000a850: 226a 203d 205b 312c 322c 335d 220a 2020  "j = [1,2,3]".  
-0000a860: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
-0000a870: 2073 616d 650a 2020 2020 2020 2020 6163   same.        ac
-0000a880: 7475 616c 203d 2062 6c61 636b 2e66 6f72  tual = black.for
-0000a890: 6d61 745f 6669 6c65 5f63 6f6e 7465 6e74  mat_file_content
-0000a8a0: 7328 6469 6666 6572 656e 742c 206d 6f64  s(different, mod
-0000a8b0: 653d 6d6f 6465 2c20 6661 7374 3d46 616c  e=mode, fast=Fal
-0000a8c0: 7365 290a 2020 2020 2020 2020 7365 6c66  se).        self
-0000a8d0: 2e61 7373 6572 7445 7175 616c 2865 7870  .assertEqual(exp
-0000a8e0: 6563 7465 642c 2061 6374 7561 6c29 0a20  ected, actual). 
-0000a8f0: 2020 2020 2020 2069 6e76 616c 6964 203d         invalid =
-0000a900: 2022 7265 7475 726e 2069 6620 796f 7520   "return if you 
-0000a910: 6361 6e22 0a20 2020 2020 2020 2077 6974  can".        wit
-0000a920: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
-0000a930: 7365 7328 626c 6163 6b2e 496e 7661 6c69  ses(black.Invali
-0000a940: 6449 6e70 7574 2920 6173 2065 3a0a 2020  dInput) as e:.  
-0000a950: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
-0000a960: 666f 726d 6174 5f66 696c 655f 636f 6e74  format_file_cont
-0000a970: 656e 7473 2869 6e76 616c 6964 2c20 6d6f  ents(invalid, mo
-0000a980: 6465 3d6d 6f64 652c 2066 6173 743d 4661  de=mode, fast=Fa
-0000a990: 6c73 6529 0a20 2020 2020 2020 2073 656c  lse).        sel
-0000a9a0: 662e 6173 7365 7274 4571 7561 6c28 7374  f.assertEqual(st
-0000a9b0: 7228 652e 6578 6365 7074 696f 6e29 2c20  r(e.exception), 
-0000a9c0: 2243 616e 6e6f 7420 7061 7273 653a 2031  "Cannot parse: 1
-0000a9d0: 3a37 3a20 7265 7475 726e 2069 6620 796f  :7: return if yo
-0000a9e0: 7520 6361 6e22 290a 0a20 2020 2020 2020  u can")..       
-0000a9f0: 206a 7573 745f 6372 6c66 203d 2022 5c72   just_crlf = "\r
-0000aa00: 5c6e 220a 2020 2020 2020 2020 7769 7468  \n".        with
-0000aa10: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
-0000aa20: 6573 2862 6c61 636b 2e4e 6f74 6869 6e67  es(black.Nothing
-0000aa30: 4368 616e 6765 6429 3a0a 2020 2020 2020  Changed):.      
-0000aa40: 2020 2020 2020 626c 6163 6b2e 666f 726d        black.form
-0000aa50: 6174 5f66 696c 655f 636f 6e74 656e 7473  at_file_contents
-0000aa60: 286a 7573 745f 6372 6c66 2c20 6d6f 6465  (just_crlf, mode
-0000aa70: 3d6d 6f64 652c 2066 6173 743d 4661 6c73  =mode, fast=Fals
-0000aa80: 6529 0a20 2020 2020 2020 206a 7573 745f  e).        just_
-0000aa90: 7768 6974 6573 7061 6365 5f6e 6c20 3d20  whitespace_nl = 
-0000aaa0: 225c 6e5c 745c 6e20 5c6e 5c74 205c 6e20  "\n\t\n \n\t \n 
-0000aab0: 5c74 5c6e 5c6e 220a 2020 2020 2020 2020  \t\n\n".        
-0000aac0: 6163 7475 616c 203d 2062 6c61 636b 2e66  actual = black.f
-0000aad0: 6f72 6d61 745f 6669 6c65 5f63 6f6e 7465  ormat_file_conte
-0000aae0: 6e74 7328 6a75 7374 5f77 6869 7465 7370  nts(just_whitesp
-0000aaf0: 6163 655f 6e6c 2c20 6d6f 6465 3d6d 6f64  ace_nl, mode=mod
-0000ab00: 652c 2066 6173 743d 4661 6c73 6529 0a20  e, fast=False). 
-0000ab10: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000ab20: 7274 4571 7561 6c28 225c 6e22 2c20 6163  rtEqual("\n", ac
-0000ab30: 7475 616c 290a 2020 2020 2020 2020 6a75  tual).        ju
-0000ab40: 7374 5f77 6869 7465 7370 6163 655f 6372  st_whitespace_cr
-0000ab50: 6c66 203d 2022 5c72 5c6e 5c74 5c72 5c6e  lf = "\r\n\t\r\n
-0000ab60: 205c 725c 6e5c 7420 5c72 5c6e 205c 745c   \r\n\t \r\n \t\
-0000ab70: 725c 6e5c 725c 6e22 0a20 2020 2020 2020  r\n\r\n".       
-0000ab80: 2061 6374 7561 6c20 3d20 626c 6163 6b2e   actual = black.
-0000ab90: 666f 726d 6174 5f66 696c 655f 636f 6e74  format_file_cont
-0000aba0: 656e 7473 286a 7573 745f 7768 6974 6573  ents(just_whites
-0000abb0: 7061 6365 5f63 726c 662c 206d 6f64 653d  pace_crlf, mode=
-0000abc0: 6d6f 6465 2c20 6661 7374 3d46 616c 7365  mode, fast=False
-0000abd0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000abe0: 7373 6572 7445 7175 616c 2822 5c72 5c6e  ssertEqual("\r\n
-0000abf0: 222c 2061 6374 7561 6c29 0a0a 2020 2020  ", actual)..    
-0000ac00: 6465 6620 7465 7374 5f65 6e64 6d61 726b  def test_endmark
-0000ac10: 6572 2873 656c 6629 202d 3e20 4e6f 6e65  er(self) -> None
-0000ac20: 3a0a 2020 2020 2020 2020 6e20 3d20 626c  :.        n = bl
-0000ac30: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
-0000ac40: 6528 225c 6e22 290a 2020 2020 2020 2020  e("\n").        
-0000ac50: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000ac60: 286e 2e74 7970 652c 2062 6c61 636b 2e73  (n.type, black.s
-0000ac70: 796d 732e 6669 6c65 5f69 6e70 7574 290a  yms.file_input).
-0000ac80: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000ac90: 6572 7445 7175 616c 286c 656e 286e 2e63  ertEqual(len(n.c
-0000aca0: 6869 6c64 7265 6e29 2c20 3129 0a20 2020  hildren), 1).   
-0000acb0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000acc0: 4571 7561 6c28 6e2e 6368 696c 6472 656e  Equal(n.children
-0000acd0: 5b30 5d2e 7479 7065 2c20 626c 6163 6b2e  [0].type, black.
-0000ace0: 746f 6b65 6e2e 454e 444d 4152 4b45 5229  token.ENDMARKER)
-0000acf0: 0a0a 2020 2020 4070 6174 6368 2822 7465  ..    @patch("te
-0000ad00: 7374 732e 636f 6e66 7465 7374 2e50 5249  sts.conftest.PRI
-0000ad10: 4e54 5f46 554c 4c5f 5452 4545 222c 2054  NT_FULL_TREE", T
-0000ad20: 7275 6529 0a20 2020 2040 7061 7463 6828  rue).    @patch(
-0000ad30: 2274 6573 7473 2e63 6f6e 6674 6573 742e  "tests.conftest.
-0000ad40: 5052 494e 545f 5452 4545 5f44 4946 4622  PRINT_TREE_DIFF"
-0000ad50: 2c20 4661 6c73 6529 0a20 2020 2040 7079  , False).    @py
-0000ad60: 7465 7374 2e6d 6172 6b2e 696e 636f 6d70  test.mark.incomp
-0000ad70: 6174 6962 6c65 5f77 6974 685f 6d79 7079  atible_with_mypy
-0000ad80: 630a 2020 2020 6465 6620 7465 7374 5f61  c.    def test_a
-0000ad90: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
-0000ada0: 5f70 7269 6e74 5f66 756c 6c5f 7472 6565  _print_full_tree
-0000adb0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000adc0: 2020 2020 2020 2020 6f75 745f 6c69 6e65          out_line
-0000add0: 7320 3d20 5b5d 0a20 2020 2020 2020 2065  s = [].        e
-0000ade0: 7272 5f6c 696e 6573 203d 205b 5d0a 0a20  rr_lines = [].. 
-0000adf0: 2020 2020 2020 2064 6566 206f 7574 286d         def out(m
-0000ae00: 7367 3a20 7374 722c 202a 2a6b 7761 7267  sg: str, **kwarg
-0000ae10: 733a 2041 6e79 2920 2d3e 204e 6f6e 653a  s: Any) -> None:
-0000ae20: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-0000ae30: 5f6c 696e 6573 2e61 7070 656e 6428 6d73  _lines.append(ms
-0000ae40: 6729 0a0a 2020 2020 2020 2020 6465 6620  g)..        def 
-0000ae50: 6572 7228 6d73 673a 2073 7472 2c20 2a2a  err(msg: str, **
-0000ae60: 6b77 6172 6773 3a20 416e 7929 202d 3e20  kwargs: Any) -> 
-0000ae70: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000ae80: 2020 6572 725f 6c69 6e65 732e 6170 7065    err_lines.appe
-0000ae90: 6e64 286d 7367 290a 0a20 2020 2020 2020  nd(msg)..       
-0000aea0: 2077 6974 6820 7061 7463 6828 2262 6c61   with patch("bla
-0000aeb0: 636b 2e6f 7574 7075 742e 5f6f 7574 222c  ck.output._out",
-0000aec0: 206f 7574 292c 2070 6174 6368 2822 626c   out), patch("bl
-0000aed0: 6163 6b2e 6f75 7470 7574 2e5f 6572 7222  ack.output._err"
-0000aee0: 2c20 6572 7229 3a0a 2020 2020 2020 2020  , err):.        
-0000aef0: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
-0000af00: 7365 7274 5261 6973 6573 2841 7373 6572  sertRaises(Asser
-0000af10: 7469 6f6e 4572 726f 7229 3a0a 2020 2020  tionError):.    
-0000af20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000af30: 2e61 7373 6572 7446 6f72 6d61 7445 7175  .assertFormatEqu
-0000af40: 616c 2822 6a20 3d20 5b31 2c20 322c 2033  al("j = [1, 2, 3
-0000af50: 5d22 2c20 226a 203d 205b 312c 2032 2c20  ]", "j = [1, 2, 
-0000af60: 332c 5d22 290a 0a20 2020 2020 2020 206f  3,]")..        o
-0000af70: 7574 5f73 7472 203d 2022 222e 6a6f 696e  ut_str = "".join
-0000af80: 286f 7574 5f6c 696e 6573 290a 2020 2020  (out_lines).    
-0000af90: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-0000afa0: 6e28 2245 7870 6563 7465 6420 7472 6565  n("Expected tree
-0000afb0: 3a22 2c20 6f75 745f 7374 7229 0a20 2020  :", out_str).   
-0000afc0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000afd0: 496e 2822 4163 7475 616c 2074 7265 653a  In("Actual tree:
-0000afe0: 222c 206f 7574 5f73 7472 290a 2020 2020  ", out_str).    
-0000aff0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000b000: 7175 616c 2822 222e 6a6f 696e 2865 7272  qual("".join(err
-0000b010: 5f6c 696e 6573 292c 2022 2229 0a0a 2020  _lines), "")..  
-0000b020: 2020 4070 6174 6368 2822 7465 7374 732e    @patch("tests.
-0000b030: 636f 6e66 7465 7374 2e50 5249 4e54 5f46  conftest.PRINT_F
-0000b040: 554c 4c5f 5452 4545 222c 2046 616c 7365  ULL_TREE", False
-0000b050: 290a 2020 2020 4070 6174 6368 2822 7465  ).    @patch("te
-0000b060: 7374 732e 636f 6e66 7465 7374 2e50 5249  sts.conftest.PRI
-0000b070: 4e54 5f54 5245 455f 4449 4646 222c 2054  NT_TREE_DIFF", T
-0000b080: 7275 6529 0a20 2020 2040 7079 7465 7374  rue).    @pytest
-0000b090: 2e6d 6172 6b2e 696e 636f 6d70 6174 6962  .mark.incompatib
-0000b0a0: 6c65 5f77 6974 685f 6d79 7079 630a 2020  le_with_mypyc.  
-0000b0b0: 2020 6465 6620 7465 7374 5f61 7373 6572    def test_asser
-0000b0c0: 7446 6f72 6d61 7445 7175 616c 5f70 7269  tFormatEqual_pri
-0000b0d0: 6e74 5f74 7265 655f 6469 6666 2873 656c  nt_tree_diff(sel
-0000b0e0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0000b0f0: 2020 2020 6f75 745f 6c69 6e65 7320 3d20      out_lines = 
-0000b100: 5b5d 0a20 2020 2020 2020 2065 7272 5f6c  [].        err_l
-0000b110: 696e 6573 203d 205b 5d0a 0a20 2020 2020  ines = []..     
-0000b120: 2020 2064 6566 206f 7574 286d 7367 3a20     def out(msg: 
-0000b130: 7374 722c 202a 2a6b 7761 7267 733a 2041  str, **kwargs: A
-0000b140: 6e79 2920 2d3e 204e 6f6e 653a 0a20 2020  ny) -> None:.   
-0000b150: 2020 2020 2020 2020 206f 7574 5f6c 696e           out_lin
-0000b160: 6573 2e61 7070 656e 6428 6d73 6729 0a0a  es.append(msg)..
-0000b170: 2020 2020 2020 2020 6465 6620 6572 7228          def err(
-0000b180: 6d73 673a 2073 7472 2c20 2a2a 6b77 6172  msg: str, **kwar
-0000b190: 6773 3a20 416e 7929 202d 3e20 4e6f 6e65  gs: Any) -> None
-0000b1a0: 3a0a 2020 2020 2020 2020 2020 2020 6572  :.            er
-0000b1b0: 725f 6c69 6e65 732e 6170 7065 6e64 286d  r_lines.append(m
-0000b1c0: 7367 290a 0a20 2020 2020 2020 2077 6974  sg)..        wit
-0000b1d0: 6820 7061 7463 6828 2262 6c61 636b 2e6f  h patch("black.o
-0000b1e0: 7574 7075 742e 5f6f 7574 222c 206f 7574  utput._out", out
-0000b1f0: 292c 2070 6174 6368 2822 626c 6163 6b2e  ), patch("black.
-0000b200: 6f75 7470 7574 2e5f 6572 7222 2c20 6572  output._err", er
-0000b210: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-0000b220: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
-0000b230: 5261 6973 6573 2841 7373 6572 7469 6f6e  Raises(Assertion
-0000b240: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-0000b250: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000b260: 6572 7446 6f72 6d61 7445 7175 616c 2822  ertFormatEqual("
-0000b270: 6a20 3d20 5b31 2c20 322c 2033 5d5c 6e22  j = [1, 2, 3]\n"
-0000b280: 2c20 226a 203d 205b 312c 2032 2c20 332c  , "j = [1, 2, 3,
-0000b290: 5d5c 6e22 290a 0a20 2020 2020 2020 206f  ]\n")..        o
-0000b2a0: 7574 5f73 7472 203d 2022 222e 6a6f 696e  ut_str = "".join
-0000b2b0: 286f 7574 5f6c 696e 6573 290a 2020 2020  (out_lines).    
-0000b2c0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-0000b2d0: 6e28 2254 7265 6520 4469 6666 3a22 2c20  n("Tree Diff:", 
-0000b2e0: 6f75 745f 7374 7229 0a20 2020 2020 2020  out_str).       
-0000b2f0: 2073 656c 662e 6173 7365 7274 496e 2822   self.assertIn("
-0000b300: 2b20 2020 2020 2020 2020 2043 4f4d 4d41  +          COMMA
-0000b310: 222c 206f 7574 5f73 7472 290a 2020 2020  ", out_str).    
-0000b320: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-0000b330: 6e28 222b 2027 2c27 222c 206f 7574 5f73  n("+ ','", out_s
-0000b340: 7472 290a 2020 2020 2020 2020 7365 6c66  tr).        self
-0000b350: 2e61 7373 6572 7445 7175 616c 2822 222e  .assertEqual("".
-0000b360: 6a6f 696e 2865 7272 5f6c 696e 6573 292c  join(err_lines),
-0000b370: 2022 2229 0a0a 2020 2020 4065 7665 6e74   "")..    @event
-0000b380: 5f6c 6f6f 7028 290a 2020 2020 4070 6174  _loop().    @pat
-0000b390: 6368 2822 636f 6e63 7572 7265 6e74 2e66  ch("concurrent.f
-0000b3a0: 7574 7572 6573 2e50 726f 6365 7373 506f  utures.ProcessPo
-0000b3b0: 6f6c 4578 6563 7574 6f72 222c 204d 6167  olExecutor", Mag
-0000b3c0: 6963 4d6f 636b 2873 6964 655f 6566 6665  icMock(side_effe
-0000b3d0: 6374 3d4f 5345 7272 6f72 2929 0a20 2020  ct=OSError)).   
-0000b3e0: 2064 6566 2074 6573 745f 776f 726b 735f   def test_works_
-0000b3f0: 696e 5f6d 6f6e 6f5f 7072 6f63 6573 735f  in_mono_process_
-0000b400: 6f6e 6c79 5f65 6e76 6972 6f6e 6d65 6e74  only_environment
-0000b410: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000b420: 2020 2020 2020 2020 7769 7468 2063 6163          with cac
-0000b430: 6865 5f64 6972 2829 2061 7320 776f 726b  he_dir() as work
-0000b440: 7370 6163 653a 0a20 2020 2020 2020 2020  space:.         
-0000b450: 2020 2066 6f72 2066 2069 6e20 5b0a 2020     for f in [.  
-0000b460: 2020 2020 2020 2020 2020 2020 2020 2877                (w
-0000b470: 6f72 6b73 7061 6365 202f 2022 6f6e 652e  orkspace / "one.
-0000b480: 7079 2229 2e72 6573 6f6c 7665 2829 2c0a  py").resolve(),.
-0000b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4a0: 2877 6f72 6b73 7061 6365 202f 2022 7477  (workspace / "tw
-0000b4b0: 6f2e 7079 2229 2e72 6573 6f6c 7665 2829  o.py").resolve()
-0000b4c0: 2c0a 2020 2020 2020 2020 2020 2020 5d3a  ,.            ]:
-0000b4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b4e0: 2066 2e77 7269 7465 5f74 6578 7428 2770   f.write_text('p
-0000b4f0: 7269 6e74 2822 6865 6c6c 6f22 295c 6e27  rint("hello")\n'
-0000b500: 2c20 656e 636f 6469 6e67 3d22 7574 662d  , encoding="utf-
-0000b510: 3822 290a 2020 2020 2020 2020 2020 2020  8").            
-0000b520: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
-0000b530: 285b 7374 7228 776f 726b 7370 6163 6529  ([str(workspace)
-0000b540: 5d29 0a0a 2020 2020 4065 7665 6e74 5f6c  ])..    @event_l
-0000b550: 6f6f 7028 290a 2020 2020 6465 6620 7465  oop().    def te
-0000b560: 7374 5f63 6865 636b 5f64 6966 665f 7573  st_check_diff_us
-0000b570: 655f 746f 6765 7468 6572 2873 656c 6629  e_together(self)
-0000b580: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000b590: 2020 7769 7468 2063 6163 6865 5f64 6972    with cache_dir
-0000b5a0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0000b5b0: 2320 4669 6c65 7320 7768 6963 6820 7769  # Files which wi
-0000b5c0: 6c6c 2062 6520 7265 666f 726d 6174 7465  ll be reformatte
-0000b5d0: 642e 0a20 2020 2020 2020 2020 2020 2073  d..            s
-0000b5e0: 7263 3120 3d20 6765 745f 6361 7365 5f70  rc1 = get_case_p
-0000b5f0: 6174 6828 226d 6973 6365 6c6c 616e 656f  ath("miscellaneo
-0000b600: 7573 222c 2022 7374 7269 6e67 5f71 756f  us", "string_quo
-0000b610: 7465 7322 290a 2020 2020 2020 2020 2020  tes").          
-0000b620: 2020 7365 6c66 2e69 6e76 6f6b 6542 6c61    self.invokeBla
-0000b630: 636b 285b 7374 7228 7372 6331 292c 2022  ck([str(src1), "
-0000b640: 2d2d 6469 6666 222c 2022 2d2d 6368 6563  --diff", "--chec
-0000b650: 6b22 5d2c 2065 7869 745f 636f 6465 3d31  k"], exit_code=1
-0000b660: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-0000b670: 4669 6c65 7320 7768 6963 6820 7769 6c6c  Files which will
-0000b680: 206e 6f74 2062 6520 7265 666f 726d 6174   not be reformat
-0000b690: 7465 642e 0a20 2020 2020 2020 2020 2020  ted..           
-0000b6a0: 2073 7263 3220 3d20 6765 745f 6361 7365   src2 = get_case
-0000b6b0: 5f70 6174 6828 2263 6173 6573 222c 2022  _path("cases", "
-0000b6c0: 636f 6d70 6f73 6974 696f 6e22 290a 2020  composition").  
-0000b6d0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-0000b6e0: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
-0000b6f0: 7372 6332 292c 2022 2d2d 6469 6666 222c  src2), "--diff",
-0000b700: 2022 2d2d 6368 6563 6b22 5d29 0a20 2020   "--check"]).   
-0000b710: 2020 2020 2020 2020 2023 204d 756c 7469           # Multi
-0000b720: 2066 696c 6520 636f 6d6d 616e 642e 0a20   file command.. 
-0000b730: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b740: 696e 766f 6b65 426c 6163 6b28 5b73 7472  invokeBlack([str
-0000b750: 2873 7263 3129 2c20 7374 7228 7372 6332  (src1), str(src2
-0000b760: 292c 2022 2d2d 6469 6666 222c 2022 2d2d  ), "--diff", "--
-0000b770: 6368 6563 6b22 5d2c 2065 7869 745f 636f  check"], exit_co
-0000b780: 6465 3d31 290a 0a20 2020 2064 6566 2074  de=1)..    def t
-0000b790: 6573 745f 6e6f 5f73 7263 5f66 6169 6c73  est_no_src_fails
-0000b7a0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000b7b0: 2020 2020 2020 2020 7769 7468 2063 6163          with cac
-0000b7c0: 6865 5f64 6972 2829 3a0a 2020 2020 2020  he_dir():.      
-0000b7d0: 2020 2020 2020 7365 6c66 2e69 6e76 6f6b        self.invok
-0000b7e0: 6542 6c61 636b 285b 5d2c 2065 7869 745f  eBlack([], exit_
-0000b7f0: 636f 6465 3d31 290a 0a20 2020 2064 6566  code=1)..    def
-0000b800: 2074 6573 745f 7372 635f 616e 645f 636f   test_src_and_co
-0000b810: 6465 5f66 6169 6c73 2873 656c 6629 202d  de_fails(self) -
-0000b820: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000b830: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
-0000b840: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000b850: 6c66 2e69 6e76 6f6b 6542 6c61 636b 285b  lf.invokeBlack([
-0000b860: 222e 222c 2022 2d63 222c 2022 3022 5d2c  ".", "-c", "0"],
-0000b870: 2065 7869 745f 636f 6465 3d31 290a 0a20   exit_code=1).. 
-0000b880: 2020 2064 6566 2074 6573 745f 6272 6f6b     def test_brok
-0000b890: 656e 5f73 796d 6c69 6e6b 2873 656c 6629  en_symlink(self)
-0000b8a0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000b8b0: 2020 7769 7468 2063 6163 6865 5f64 6972    with cache_dir
-0000b8c0: 2829 2061 7320 776f 726b 7370 6163 653a  () as workspace:
-0000b8d0: 0a20 2020 2020 2020 2020 2020 2073 796d  .            sym
-0000b8e0: 6c69 6e6b 203d 2077 6f72 6b73 7061 6365  link = workspace
-0000b8f0: 202f 2022 6272 6f6b 656e 5f6c 696e 6b2e   / "broken_link.
-0000b900: 7079 220a 2020 2020 2020 2020 2020 2020  py".            
-0000b910: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000b920: 2020 2020 2073 796d 6c69 6e6b 2e73 796d       symlink.sym
-0000b930: 6c69 6e6b 5f74 6f28 226e 6f6e 6578 6973  link_to("nonexis
-0000b940: 7465 6e74 2e70 7922 290a 2020 2020 2020  tent.py").      
-0000b950: 2020 2020 2020 6578 6365 7074 2028 4f53        except (OS
-0000b960: 4572 726f 722c 204e 6f74 496d 706c 656d  Error, NotImplem
-0000b970: 656e 7465 6445 7272 6f72 2920 6173 2065  entedError) as e
-0000b980: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000b990: 2020 7365 6c66 2e73 6b69 7054 6573 7428    self.skipTest(
-0000b9a0: 6622 4361 6e27 7420 6372 6561 7465 2073  f"Can't create s
-0000b9b0: 796d 6c69 6e6b 733a 207b 657d 2229 0a20  ymlinks: {e}"). 
-0000b9c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b9d0: 696e 766f 6b65 426c 6163 6b28 5b73 7472  invokeBlack([str
-0000b9e0: 2877 6f72 6b73 7061 6365 2e72 6573 6f6c  (workspace.resol
-0000b9f0: 7665 2829 295d 290a 0a20 2020 2064 6566  ve())])..    def
-0000ba00: 2074 6573 745f 7369 6e67 6c65 5f66 696c   test_single_fil
-0000ba10: 655f 666f 7263 655f 7079 6928 7365 6c66  e_force_pyi(self
-0000ba20: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000ba30: 2020 2070 7969 5f6d 6f64 6520 3d20 7265     pyi_mode = re
-0000ba40: 706c 6163 6528 4445 4641 554c 545f 4d4f  place(DEFAULT_MO
-0000ba50: 4445 2c20 6973 5f70 7969 3d54 7275 6529  DE, is_pyi=True)
-0000ba60: 0a20 2020 2020 2020 2063 6f6e 7465 6e74  .        content
-0000ba70: 732c 2065 7870 6563 7465 6420 3d20 7265  s, expected = re
-0000ba80: 6164 5f64 6174 6128 226d 6973 6365 6c6c  ad_data("miscell
-0000ba90: 616e 656f 7573 222c 2022 666f 7263 655f  aneous", "force_
-0000baa0: 7079 6922 290a 2020 2020 2020 2020 7769  pyi").        wi
-0000bab0: 7468 2063 6163 6865 5f64 6972 2829 2061  th cache_dir() a
-0000bac0: 7320 776f 726b 7370 6163 653a 0a20 2020  s workspace:.   
-0000bad0: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
-0000bae0: 2877 6f72 6b73 7061 6365 202f 2022 6669  (workspace / "fi
-0000baf0: 6c65 2e70 7922 292e 7265 736f 6c76 6528  le.py").resolve(
-0000bb00: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
-0000bb10: 7468 2e77 7269 7465 5f74 6578 7428 636f  th.write_text(co
-0000bb20: 6e74 656e 7473 2c20 656e 636f 6469 6e67  ntents, encoding
-0000bb30: 3d22 7574 662d 3822 290a 2020 2020 2020  ="utf-8").      
-0000bb40: 2020 2020 2020 7365 6c66 2e69 6e76 6f6b        self.invok
-0000bb50: 6542 6c61 636b 285b 7374 7228 7061 7468  eBlack([str(path
-0000bb60: 292c 2022 2d2d 7079 6922 5d29 0a20 2020  ), "--pyi"]).   
-0000bb70: 2020 2020 2020 2020 2061 6374 7561 6c20           actual 
-0000bb80: 3d20 7061 7468 2e72 6561 645f 7465 7874  = path.read_text
-0000bb90: 2865 6e63 6f64 696e 673d 2275 7466 2d38  (encoding="utf-8
-0000bba0: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
-0000bbb0: 2076 6572 6966 7920 6361 6368 6520 7769   verify cache wi
-0000bbc0: 7468 202d 2d70 7969 2069 7320 7365 7061  th --pyi is sepa
-0000bbd0: 7261 7465 0a20 2020 2020 2020 2020 2020  rate.           
-0000bbe0: 2070 7969 5f63 6163 6865 203d 2062 6c61   pyi_cache = bla
-0000bbf0: 636b 2e43 6163 6865 2e72 6561 6428 7079  ck.Cache.read(py
-0000bc00: 695f 6d6f 6465 290a 2020 2020 2020 2020  i_mode).        
-0000bc10: 2020 2020 6173 7365 7274 206e 6f74 2070      assert not p
-0000bc20: 7969 5f63 6163 6865 2e69 735f 6368 616e  yi_cache.is_chan
-0000bc30: 6765 6428 7061 7468 290a 2020 2020 2020  ged(path).      
-0000bc40: 2020 2020 2020 6e6f 726d 616c 5f63 6163        normal_cac
-0000bc50: 6865 203d 2062 6c61 636b 2e43 6163 6865  he = black.Cache
-0000bc60: 2e72 6561 6428 4445 4641 554c 545f 4d4f  .read(DEFAULT_MO
-0000bc70: 4445 290a 2020 2020 2020 2020 2020 2020  DE).            
-0000bc80: 6173 7365 7274 206e 6f72 6d61 6c5f 6361  assert normal_ca
-0000bc90: 6368 652e 6973 5f63 6861 6e67 6564 2870  che.is_changed(p
-0000bca0: 6174 6829 0a20 2020 2020 2020 2073 656c  ath).        sel
-0000bcb0: 662e 6173 7365 7274 466f 726d 6174 4571  f.assertFormatEq
-0000bcc0: 7561 6c28 6578 7065 6374 6564 2c20 6163  ual(expected, ac
-0000bcd0: 7475 616c 290a 2020 2020 2020 2020 626c  tual).        bl
-0000bce0: 6163 6b2e 6173 7365 7274 5f65 7175 6976  ack.assert_equiv
-0000bcf0: 616c 656e 7428 636f 6e74 656e 7473 2c20  alent(contents, 
-0000bd00: 6163 7475 616c 290a 2020 2020 2020 2020  actual).        
-0000bd10: 626c 6163 6b2e 6173 7365 7274 5f73 7461  black.assert_sta
-0000bd20: 626c 6528 636f 6e74 656e 7473 2c20 6163  ble(contents, ac
-0000bd30: 7475 616c 2c20 7079 695f 6d6f 6465 290a  tual, pyi_mode).
-0000bd40: 0a20 2020 2040 6576 656e 745f 6c6f 6f70  .    @event_loop
-0000bd50: 2829 0a20 2020 2064 6566 2074 6573 745f  ().    def test_
-0000bd60: 6d75 6c74 695f 6669 6c65 5f66 6f72 6365  multi_file_force
-0000bd70: 5f70 7969 2873 656c 6629 202d 3e20 4e6f  _pyi(self) -> No
-0000bd80: 6e65 3a0a 2020 2020 2020 2020 7265 675f  ne:.        reg_
-0000bd90: 6d6f 6465 203d 2044 4546 4155 4c54 5f4d  mode = DEFAULT_M
-0000bda0: 4f44 450a 2020 2020 2020 2020 7079 695f  ODE.        pyi_
-0000bdb0: 6d6f 6465 203d 2072 6570 6c61 6365 2844  mode = replace(D
-0000bdc0: 4546 4155 4c54 5f4d 4f44 452c 2069 735f  EFAULT_MODE, is_
-0000bdd0: 7079 693d 5472 7565 290a 2020 2020 2020  pyi=True).      
-0000bde0: 2020 636f 6e74 656e 7473 2c20 6578 7065    contents, expe
-0000bdf0: 6374 6564 203d 2072 6561 645f 6461 7461  cted = read_data
-0000be00: 2822 6d69 7363 656c 6c61 6e65 6f75 7322  ("miscellaneous"
-0000be10: 2c20 2266 6f72 6365 5f70 7969 2229 0a20  , "force_pyi"). 
-0000be20: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
-0000be30: 655f 6469 7228 2920 6173 2077 6f72 6b73  e_dir() as works
-0000be40: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
-0000be50: 2020 7061 7468 7320 3d20 5b0a 2020 2020    paths = [.    
-0000be60: 2020 2020 2020 2020 2020 2020 2877 6f72              (wor
-0000be70: 6b73 7061 6365 202f 2022 6669 6c65 312e  kspace / "file1.
-0000be80: 7079 2229 2e72 6573 6f6c 7665 2829 2c0a  py").resolve(),.
-0000be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bea0: 2877 6f72 6b73 7061 6365 202f 2022 6669  (workspace / "fi
-0000beb0: 6c65 322e 7079 2229 2e72 6573 6f6c 7665  le2.py").resolve
-0000bec0: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-0000bed0: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
-0000bee0: 7220 7061 7468 2069 6e20 7061 7468 733a  r path in paths:
-0000bef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bf00: 2070 6174 682e 7772 6974 655f 7465 7874   path.write_text
-0000bf10: 2863 6f6e 7465 6e74 732c 2065 6e63 6f64  (contents, encod
-0000bf20: 696e 673d 2275 7466 2d38 2229 0a20 2020  ing="utf-8").   
-0000bf30: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
-0000bf40: 766f 6b65 426c 6163 6b28 5b73 7472 2870  vokeBlack([str(p
-0000bf50: 2920 666f 7220 7020 696e 2070 6174 6873  ) for p in paths
-0000bf60: 5d20 2b20 5b22 2d2d 7079 6922 5d29 0a20  ] + ["--pyi"]). 
-0000bf70: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
-0000bf80: 6174 6820 696e 2070 6174 6873 3a0a 2020  ath in paths:.  
-0000bf90: 2020 2020 2020 2020 2020 2020 2020 6163                ac
-0000bfa0: 7475 616c 203d 2070 6174 682e 7265 6164  tual = path.read
-0000bfb0: 5f74 6578 7428 656e 636f 6469 6e67 3d22  _text(encoding="
-0000bfc0: 7574 662d 3822 290a 2020 2020 2020 2020  utf-8").        
-0000bfd0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000bfe0: 6572 7445 7175 616c 2861 6374 7561 6c2c  ertEqual(actual,
-0000bff0: 2065 7870 6563 7465 6429 0a20 2020 2020   expected).     
-0000c000: 2020 2020 2020 2023 2076 6572 6966 7920         # verify 
-0000c010: 6361 6368 6520 7769 7468 202d 2d70 7969  cache with --pyi
-0000c020: 2069 7320 7365 7061 7261 7465 0a20 2020   is separate.   
-0000c030: 2020 2020 2020 2020 2070 7969 5f63 6163           pyi_cac
-0000c040: 6865 203d 2062 6c61 636b 2e43 6163 6865  he = black.Cache
-0000c050: 2e72 6561 6428 7079 695f 6d6f 6465 290a  .read(pyi_mode).
-0000c060: 2020 2020 2020 2020 2020 2020 6e6f 726d              norm
-0000c070: 616c 5f63 6163 6865 203d 2062 6c61 636b  al_cache = black
-0000c080: 2e43 6163 6865 2e72 6561 6428 7265 675f  .Cache.read(reg_
-0000c090: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
-0000c0a0: 2020 666f 7220 7061 7468 2069 6e20 7061    for path in pa
-0000c0b0: 7468 733a 0a20 2020 2020 2020 2020 2020  ths:.           
-0000c0c0: 2020 2020 2061 7373 6572 7420 6e6f 7420       assert not 
-0000c0d0: 7079 695f 6361 6368 652e 6973 5f63 6861  pyi_cache.is_cha
-0000c0e0: 6e67 6564 2870 6174 6829 0a20 2020 2020  nged(path).     
-0000c0f0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-0000c100: 7420 6e6f 726d 616c 5f63 6163 6865 2e69  t normal_cache.i
-0000c110: 735f 6368 616e 6765 6428 7061 7468 290a  s_changed(path).
-0000c120: 0a20 2020 2064 6566 2074 6573 745f 7069  .    def test_pi
-0000c130: 7065 5f66 6f72 6365 5f70 7969 2873 656c  pe_force_pyi(sel
-0000c140: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0000c150: 2020 2020 736f 7572 6365 2c20 6578 7065      source, expe
-0000c160: 6374 6564 203d 2072 6561 645f 6461 7461  cted = read_data
-0000c170: 2822 6d69 7363 656c 6c61 6e65 6f75 7322  ("miscellaneous"
-0000c180: 2c20 2266 6f72 6365 5f70 7969 2229 0a20  , "force_pyi"). 
-0000c190: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-0000c1a0: 436c 6952 756e 6e65 7228 292e 696e 766f  CliRunner().invo
-0000c1b0: 6b65 280a 2020 2020 2020 2020 2020 2020  ke(.            
-0000c1c0: 626c 6163 6b2e 6d61 696e 2c20 5b22 2d22  black.main, ["-"
-0000c1d0: 2c20 222d 7122 2c20 222d 2d70 7969 225d  , "-q", "--pyi"]
-0000c1e0: 2c20 696e 7075 743d 4279 7465 7349 4f28  , input=BytesIO(
-0000c1f0: 736f 7572 6365 2e65 6e63 6f64 6528 2275  source.encode("u
-0000c200: 7466 2d38 2229 290a 2020 2020 2020 2020  tf-8")).        
-0000c210: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000c220: 7373 6572 7445 7175 616c 2872 6573 756c  ssertEqual(resul
-0000c230: 742e 6578 6974 5f63 6f64 652c 2030 290a  t.exit_code, 0).
-0000c240: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
-0000c250: 2072 6573 756c 742e 6f75 7470 7574 0a20   result.output. 
-0000c260: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000c270: 7274 466f 726d 6174 4571 7561 6c28 6163  rtFormatEqual(ac
-0000c280: 7475 616c 2c20 6578 7065 6374 6564 290a  tual, expected).
-0000c290: 0a20 2020 2064 6566 2074 6573 745f 7369  .    def test_si
-0000c2a0: 6e67 6c65 5f66 696c 655f 666f 7263 655f  ngle_file_force_
-0000c2b0: 7079 3336 2873 656c 6629 202d 3e20 4e6f  py36(self) -> No
-0000c2c0: 6e65 3a0a 2020 2020 2020 2020 7265 675f  ne:.        reg_
-0000c2d0: 6d6f 6465 203d 2044 4546 4155 4c54 5f4d  mode = DEFAULT_M
-0000c2e0: 4f44 450a 2020 2020 2020 2020 7079 3336  ODE.        py36
-0000c2f0: 5f6d 6f64 6520 3d20 7265 706c 6163 6528  _mode = replace(
-0000c300: 4445 4641 554c 545f 4d4f 4445 2c20 7461  DEFAULT_MODE, ta
-0000c310: 7267 6574 5f76 6572 7369 6f6e 733d 5059  rget_versions=PY
-0000c320: 3336 5f56 4552 5349 4f4e 5329 0a20 2020  36_VERSIONS).   
-0000c330: 2020 2020 2073 6f75 7263 652c 2065 7870       source, exp
-0000c340: 6563 7465 6420 3d20 7265 6164 5f64 6174  ected = read_dat
-0000c350: 6128 226d 6973 6365 6c6c 616e 656f 7573  a("miscellaneous
-0000c360: 222c 2022 666f 7263 655f 7079 3336 2229  ", "force_py36")
-0000c370: 0a20 2020 2020 2020 2077 6974 6820 6361  .        with ca
-0000c380: 6368 655f 6469 7228 2920 6173 2077 6f72  che_dir() as wor
-0000c390: 6b73 7061 6365 3a0a 2020 2020 2020 2020  kspace:.        
-0000c3a0: 2020 2020 7061 7468 203d 2028 776f 726b      path = (work
-0000c3b0: 7370 6163 6520 2f20 2266 696c 652e 7079  space / "file.py
-0000c3c0: 2229 2e72 6573 6f6c 7665 2829 0a20 2020  ").resolve().   
-0000c3d0: 2020 2020 2020 2020 2070 6174 682e 7772           path.wr
-0000c3e0: 6974 655f 7465 7874 2873 6f75 7263 652c  ite_text(source,
-0000c3f0: 2065 6e63 6f64 696e 673d 2275 7466 2d38   encoding="utf-8
-0000c400: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
-0000c410: 656c 662e 696e 766f 6b65 426c 6163 6b28  elf.invokeBlack(
-0000c420: 5b73 7472 2870 6174 6829 2c20 2a50 5933  [str(path), *PY3
-0000c430: 365f 4152 4753 5d29 0a20 2020 2020 2020  6_ARGS]).       
-0000c440: 2020 2020 2061 6374 7561 6c20 3d20 7061       actual = pa
-0000c450: 7468 2e72 6561 645f 7465 7874 2865 6e63  th.read_text(enc
-0000c460: 6f64 696e 673d 2275 7466 2d38 2229 0a20  oding="utf-8"). 
-0000c470: 2020 2020 2020 2020 2020 2023 2076 6572             # ver
-0000c480: 6966 7920 6361 6368 6520 7769 7468 202d  ify cache with -
-0000c490: 2d74 6172 6765 742d 7665 7273 696f 6e20  -target-version 
-0000c4a0: 6973 2073 6570 6172 6174 650a 2020 2020  is separate.    
-0000c4b0: 2020 2020 2020 2020 7079 3336 5f63 6163          py36_cac
-0000c4c0: 6865 203d 2062 6c61 636b 2e43 6163 6865  he = black.Cache
-0000c4d0: 2e72 6561 6428 7079 3336 5f6d 6f64 6529  .read(py36_mode)
-0000c4e0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-0000c4f0: 6572 7420 6e6f 7420 7079 3336 5f63 6163  ert not py36_cac
-0000c500: 6865 2e69 735f 6368 616e 6765 6428 7061  he.is_changed(pa
-0000c510: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
-0000c520: 6e6f 726d 616c 5f63 6163 6865 203d 2062  normal_cache = b
-0000c530: 6c61 636b 2e43 6163 6865 2e72 6561 6428  lack.Cache.read(
-0000c540: 7265 675f 6d6f 6465 290a 2020 2020 2020  reg_mode).      
-0000c550: 2020 2020 2020 6173 7365 7274 206e 6f72        assert nor
-0000c560: 6d61 6c5f 6361 6368 652e 6973 5f63 6861  mal_cache.is_cha
-0000c570: 6e67 6564 2870 6174 6829 0a20 2020 2020  nged(path).     
-0000c580: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000c590: 7561 6c28 6163 7475 616c 2c20 6578 7065  ual(actual, expe
-0000c5a0: 6374 6564 290a 0a20 2020 2040 6576 656e  cted)..    @even
-0000c5b0: 745f 6c6f 6f70 2829 0a20 2020 2064 6566  t_loop().    def
-0000c5c0: 2074 6573 745f 6d75 6c74 695f 6669 6c65   test_multi_file
-0000c5d0: 5f66 6f72 6365 5f70 7933 3628 7365 6c66  _force_py36(self
-0000c5e0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000c5f0: 2020 2072 6567 5f6d 6f64 6520 3d20 4445     reg_mode = DE
-0000c600: 4641 554c 545f 4d4f 4445 0a20 2020 2020  FAULT_MODE.     
-0000c610: 2020 2070 7933 365f 6d6f 6465 203d 2072     py36_mode = r
-0000c620: 6570 6c61 6365 2844 4546 4155 4c54 5f4d  eplace(DEFAULT_M
-0000c630: 4f44 452c 2074 6172 6765 745f 7665 7273  ODE, target_vers
-0000c640: 696f 6e73 3d50 5933 365f 5645 5253 494f  ions=PY36_VERSIO
-0000c650: 4e53 290a 2020 2020 2020 2020 736f 7572  NS).        sour
-0000c660: 6365 2c20 6578 7065 6374 6564 203d 2072  ce, expected = r
-0000c670: 6561 645f 6461 7461 2822 6d69 7363 656c  ead_data("miscel
-0000c680: 6c61 6e65 6f75 7322 2c20 2266 6f72 6365  laneous", "force
-0000c690: 5f70 7933 3622 290a 2020 2020 2020 2020  _py36").        
-0000c6a0: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
-0000c6b0: 2061 7320 776f 726b 7370 6163 653a 0a20   as workspace:. 
-0000c6c0: 2020 2020 2020 2020 2020 2070 6174 6873             paths
-0000c6d0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-0000c6e0: 2020 2020 2028 776f 726b 7370 6163 6520       (workspace 
-0000c6f0: 2f20 2266 696c 6531 2e70 7922 292e 7265  / "file1.py").re
-0000c700: 736f 6c76 6528 292c 0a20 2020 2020 2020  solve(),.       
-0000c710: 2020 2020 2020 2020 2028 776f 726b 7370           (worksp
-0000c720: 6163 6520 2f20 2266 696c 6532 2e70 7922  ace / "file2.py"
-0000c730: 292e 7265 736f 6c76 6528 292c 0a20 2020  ).resolve(),.   
-0000c740: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
-0000c750: 2020 2020 2020 2066 6f72 2070 6174 6820         for path 
-0000c760: 696e 2070 6174 6873 3a0a 2020 2020 2020  in paths:.      
-0000c770: 2020 2020 2020 2020 2020 7061 7468 2e77            path.w
-0000c780: 7269 7465 5f74 6578 7428 736f 7572 6365  rite_text(source
-0000c790: 2c20 656e 636f 6469 6e67 3d22 7574 662d  , encoding="utf-
-0000c7a0: 3822 290a 2020 2020 2020 2020 2020 2020  8").            
-0000c7b0: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
-0000c7c0: 285b 7374 7228 7029 2066 6f72 2070 2069  ([str(p) for p i
-0000c7d0: 6e20 7061 7468 735d 202b 2050 5933 365f  n paths] + PY36_
-0000c7e0: 4152 4753 290a 2020 2020 2020 2020 2020  ARGS).          
-0000c7f0: 2020 666f 7220 7061 7468 2069 6e20 7061    for path in pa
-0000c800: 7468 733a 0a20 2020 2020 2020 2020 2020  ths:.           
-0000c810: 2020 2020 2061 6374 7561 6c20 3d20 7061       actual = pa
-0000c820: 7468 2e72 6561 645f 7465 7874 2865 6e63  th.read_text(enc
-0000c830: 6f64 696e 673d 2275 7466 2d38 2229 0a20  oding="utf-8"). 
-0000c840: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000c850: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000c860: 6163 7475 616c 2c20 6578 7065 6374 6564  actual, expected
-0000c870: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-0000c880: 7665 7269 6679 2063 6163 6865 2077 6974  verify cache wit
-0000c890: 6820 2d2d 7461 7267 6574 2d76 6572 7369  h --target-versi
-0000c8a0: 6f6e 2069 7320 7365 7061 7261 7465 0a20  on is separate. 
-0000c8b0: 2020 2020 2020 2020 2020 2070 7969 5f63             pyi_c
-0000c8c0: 6163 6865 203d 2062 6c61 636b 2e43 6163  ache = black.Cac
-0000c8d0: 6865 2e72 6561 6428 7079 3336 5f6d 6f64  he.read(py36_mod
-0000c8e0: 6529 0a20 2020 2020 2020 2020 2020 206e  e).            n
-0000c8f0: 6f72 6d61 6c5f 6361 6368 6520 3d20 626c  ormal_cache = bl
-0000c900: 6163 6b2e 4361 6368 652e 7265 6164 2872  ack.Cache.read(r
-0000c910: 6567 5f6d 6f64 6529 0a20 2020 2020 2020  eg_mode).       
-0000c920: 2020 2020 2066 6f72 2070 6174 6820 696e       for path in
-0000c930: 2070 6174 6873 3a0a 2020 2020 2020 2020   paths:.        
-0000c940: 2020 2020 2020 2020 6173 7365 7274 206e          assert n
-0000c950: 6f74 2070 7969 5f63 6163 6865 2e69 735f  ot pyi_cache.is_
-0000c960: 6368 616e 6765 6428 7061 7468 290a 2020  changed(path).  
-0000c970: 2020 2020 2020 2020 2020 2020 2020 6173                as
-0000c980: 7365 7274 206e 6f72 6d61 6c5f 6361 6368  sert normal_cach
-0000c990: 652e 6973 5f63 6861 6e67 6564 2870 6174  e.is_changed(pat
-0000c9a0: 6829 0a0a 2020 2020 6465 6620 7465 7374  h)..    def test
-0000c9b0: 5f70 6970 655f 666f 7263 655f 7079 3336  _pipe_force_py36
-0000c9c0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000c9d0: 2020 2020 2020 2020 736f 7572 6365 2c20          source, 
-0000c9e0: 6578 7065 6374 6564 203d 2072 6561 645f  expected = read_
-0000c9f0: 6461 7461 2822 6d69 7363 656c 6c61 6e65  data("miscellane
-0000ca00: 6f75 7322 2c20 2266 6f72 6365 5f70 7933  ous", "force_py3
-0000ca10: 3622 290a 2020 2020 2020 2020 7265 7375  6").        resu
-0000ca20: 6c74 203d 2043 6c69 5275 6e6e 6572 2829  lt = CliRunner()
-0000ca30: 2e69 6e76 6f6b 6528 0a20 2020 2020 2020  .invoke(.       
-0000ca40: 2020 2020 2062 6c61 636b 2e6d 6169 6e2c       black.main,
-0000ca50: 0a20 2020 2020 2020 2020 2020 205b 222d  .            ["-
-0000ca60: 222c 2022 2d71 222c 2022 2d2d 7461 7267  ", "-q", "--targ
-0000ca70: 6574 2d76 6572 7369 6f6e 3d70 7933 3622  et-version=py36"
-0000ca80: 5d2c 0a20 2020 2020 2020 2020 2020 2069  ],.            i
-0000ca90: 6e70 7574 3d42 7974 6573 494f 2873 6f75  nput=BytesIO(sou
-0000caa0: 7263 652e 656e 636f 6465 2822 7574 662d  rce.encode("utf-
-0000cab0: 3822 2929 2c0a 2020 2020 2020 2020 290a  8")),.        ).
-0000cac0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000cad0: 6572 7445 7175 616c 2872 6573 756c 742e  ertEqual(result.
-0000cae0: 6578 6974 5f63 6f64 652c 2030 290a 2020  exit_code, 0).  
-0000caf0: 2020 2020 2020 6163 7475 616c 203d 2072        actual = r
-0000cb00: 6573 756c 742e 6f75 7470 7574 0a20 2020  esult.output.   
-0000cb10: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000cb20: 466f 726d 6174 4571 7561 6c28 6163 7475  FormatEqual(actu
-0000cb30: 616c 2c20 6578 7065 6374 6564 290a 0a20  al, expected).. 
-0000cb40: 2020 2040 7079 7465 7374 2e6d 6172 6b2e     @pytest.mark.
-0000cb50: 696e 636f 6d70 6174 6962 6c65 5f77 6974  incompatible_wit
-0000cb60: 685f 6d79 7079 630a 2020 2020 6465 6620  h_mypyc.    def 
-0000cb70: 7465 7374 5f72 6566 6f72 6d61 745f 6f6e  test_reformat_on
-0000cb80: 655f 7769 7468 5f73 7464 696e 2873 656c  e_with_stdin(sel
-0000cb90: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0000cba0: 2020 2020 7769 7468 2070 6174 6368 280a      with patch(.
-0000cbb0: 2020 2020 2020 2020 2020 2020 2262 6c61              "bla
-0000cbc0: 636b 2e66 6f72 6d61 745f 7374 6469 6e5f  ck.format_stdin_
-0000cbd0: 746f 5f73 7464 6f75 7422 2c0a 2020 2020  to_stdout",.    
-0000cbe0: 2020 2020 2020 2020 7265 7475 726e 5f76          return_v
-0000cbf0: 616c 7565 3d6c 616d 6264 6120 2a61 7267  alue=lambda *arg
-0000cc00: 732c 202a 2a6b 7761 7267 733a 2062 6c61  s, **kwargs: bla
-0000cc10: 636b 2e43 6861 6e67 6564 2e59 4553 2c0a  ck.Changed.YES,.
-0000cc20: 2020 2020 2020 2020 2920 6173 2066 7374          ) as fst
-0000cc30: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-0000cc40: 6570 6f72 7420 3d20 4d61 6769 634d 6f63  eport = MagicMoc
-0000cc50: 6b28 290a 2020 2020 2020 2020 2020 2020  k().            
-0000cc60: 7061 7468 203d 2050 6174 6828 222d 2229  path = Path("-")
-0000cc70: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
-0000cc80: 636b 2e72 6566 6f72 6d61 745f 6f6e 6528  ck.reformat_one(
-0000cc90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cca0: 2070 6174 682c 0a20 2020 2020 2020 2020   path,.         
-0000ccb0: 2020 2020 2020 2066 6173 743d 5472 7565         fast=True
-0000ccc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000ccd0: 2020 7772 6974 655f 6261 636b 3d62 6c61    write_back=bla
-0000cce0: 636b 2e57 7269 7465 4261 636b 2e59 4553  ck.WriteBack.YES
-0000ccf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000cd00: 2020 6d6f 6465 3d44 4546 4155 4c54 5f4d    mode=DEFAULT_M
-0000cd10: 4f44 452c 0a20 2020 2020 2020 2020 2020  ODE,.           
-0000cd20: 2020 2020 2072 6570 6f72 743d 7265 706f       report=repo
-0000cd30: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
-0000cd40: 290a 2020 2020 2020 2020 2020 2020 6673  ).            fs
-0000cd50: 7473 2e61 7373 6572 745f 6361 6c6c 6564  ts.assert_called
-0000cd60: 5f6f 6e63 6528 290a 2020 2020 2020 2020  _once().        
-0000cd70: 2020 2020 7265 706f 7274 2e64 6f6e 652e      report.done.
-0000cd80: 6173 7365 7274 5f63 616c 6c65 645f 7769  assert_called_wi
-0000cd90: 7468 2870 6174 682c 2062 6c61 636b 2e43  th(path, black.C
-0000cda0: 6861 6e67 6564 2e59 4553 290a 0a20 2020  hanged.YES)..   
-0000cdb0: 2040 7079 7465 7374 2e6d 6172 6b2e 696e   @pytest.mark.in
-0000cdc0: 636f 6d70 6174 6962 6c65 5f77 6974 685f  compatible_with_
-0000cdd0: 6d79 7079 630a 2020 2020 6465 6620 7465  mypyc.    def te
-0000cde0: 7374 5f72 6566 6f72 6d61 745f 6f6e 655f  st_reformat_one_
-0000cdf0: 7769 7468 5f73 7464 696e 5f66 696c 656e  with_stdin_filen
-0000ce00: 616d 6528 7365 6c66 2920 2d3e 204e 6f6e  ame(self) -> Non
-0000ce10: 653a 0a20 2020 2020 2020 2077 6974 6820  e:.        with 
-0000ce20: 7061 7463 6828 0a20 2020 2020 2020 2020  patch(.         
-0000ce30: 2020 2022 626c 6163 6b2e 666f 726d 6174     "black.format
-0000ce40: 5f73 7464 696e 5f74 6f5f 7374 646f 7574  _stdin_to_stdout
-0000ce50: 222c 0a20 2020 2020 2020 2020 2020 2072  ",.            r
-0000ce60: 6574 7572 6e5f 7661 6c75 653d 6c61 6d62  eturn_value=lamb
-0000ce70: 6461 202a 6172 6773 2c20 2a2a 6b77 6172  da *args, **kwar
-0000ce80: 6773 3a20 626c 6163 6b2e 4368 616e 6765  gs: black.Change
-0000ce90: 642e 5945 532c 0a20 2020 2020 2020 2029  d.YES,.        )
-0000cea0: 2061 7320 6673 7473 3a0a 2020 2020 2020   as fsts:.      
-0000ceb0: 2020 2020 2020 7265 706f 7274 203d 204d        report = M
-0000cec0: 6167 6963 4d6f 636b 2829 0a20 2020 2020  agicMock().     
-0000ced0: 2020 2020 2020 2070 203d 2022 666f 6f2e         p = "foo.
-0000cee0: 7079 220a 2020 2020 2020 2020 2020 2020  py".            
-0000cef0: 7061 7468 203d 2050 6174 6828 6622 5f5f  path = Path(f"__
-0000cf00: 424c 4143 4b5f 5354 4449 4e5f 4649 4c45  BLACK_STDIN_FILE
-0000cf10: 4e41 4d45 5f5f 7b70 7d22 290a 2020 2020  NAME__{p}").    
-0000cf20: 2020 2020 2020 2020 6578 7065 6374 6564          expected
-0000cf30: 203d 2050 6174 6828 7029 0a20 2020 2020   = Path(p).     
-0000cf40: 2020 2020 2020 2062 6c61 636b 2e72 6566         black.ref
-0000cf50: 6f72 6d61 745f 6f6e 6528 0a20 2020 2020  ormat_one(.     
-0000cf60: 2020 2020 2020 2020 2020 2070 6174 682c             path,
-0000cf70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cf80: 2066 6173 743d 5472 7565 2c0a 2020 2020   fast=True,.    
-0000cf90: 2020 2020 2020 2020 2020 2020 7772 6974              writ
-0000cfa0: 655f 6261 636b 3d62 6c61 636b 2e57 7269  e_back=black.Wri
-0000cfb0: 7465 4261 636b 2e59 4553 2c0a 2020 2020  teBack.YES,.    
-0000cfc0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-0000cfd0: 3d44 4546 4155 4c54 5f4d 4f44 452c 0a20  =DEFAULT_MODE,. 
-0000cfe0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000cff0: 6570 6f72 743d 7265 706f 7274 2c0a 2020  eport=report,.  
-0000d000: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000d010: 2020 2020 2020 2020 6673 7473 2e61 7373          fsts.ass
-0000d020: 6572 745f 6361 6c6c 6564 5f6f 6e63 655f  ert_called_once_
-0000d030: 7769 7468 280a 2020 2020 2020 2020 2020  with(.          
-0000d040: 2020 2020 2020 6661 7374 3d54 7275 652c        fast=True,
-0000d050: 2077 7269 7465 5f62 6163 6b3d 626c 6163   write_back=blac
-0000d060: 6b2e 5772 6974 6542 6163 6b2e 5945 532c  k.WriteBack.YES,
-0000d070: 206d 6f64 653d 4445 4641 554c 545f 4d4f   mode=DEFAULT_MO
-0000d080: 4445 2c20 6c69 6e65 733d 2829 0a20 2020  DE, lines=().   
-0000d090: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000d0a0: 2020 2020 2020 2023 205f 5f42 4c41 434b         # __BLACK
-0000d0b0: 5f53 5444 494e 5f46 494c 454e 414d 455f  _STDIN_FILENAME_
-0000d0c0: 5f20 7368 6f75 6c64 2068 6176 6520 6265  _ should have be
-0000d0d0: 656e 2073 7472 6970 7065 640a 2020 2020  en stripped.    
-0000d0e0: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
-0000d0f0: 6f6e 652e 6173 7365 7274 5f63 616c 6c65  one.assert_calle
-0000d100: 645f 7769 7468 2865 7870 6563 7465 642c  d_with(expected,
-0000d110: 2062 6c61 636b 2e43 6861 6e67 6564 2e59   black.Changed.Y
-0000d120: 4553 290a 0a20 2020 2040 7079 7465 7374  ES)..    @pytest
-0000d130: 2e6d 6172 6b2e 696e 636f 6d70 6174 6962  .mark.incompatib
-0000d140: 6c65 5f77 6974 685f 6d79 7079 630a 2020  le_with_mypyc.  
-0000d150: 2020 6465 6620 7465 7374 5f72 6566 6f72    def test_refor
-0000d160: 6d61 745f 6f6e 655f 7769 7468 5f73 7464  mat_one_with_std
-0000d170: 696e 5f66 696c 656e 616d 655f 7079 6928  in_filename_pyi(
-0000d180: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0000d190: 2020 2020 2020 2077 6974 6820 7061 7463         with patc
-0000d1a0: 6828 0a20 2020 2020 2020 2020 2020 2022  h(.            "
-0000d1b0: 626c 6163 6b2e 666f 726d 6174 5f73 7464  black.format_std
-0000d1c0: 696e 5f74 6f5f 7374 646f 7574 222c 0a20  in_to_stdout",. 
-0000d1d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000d1e0: 6e5f 7661 6c75 653d 6c61 6d62 6461 202a  n_value=lambda *
-0000d1f0: 6172 6773 2c20 2a2a 6b77 6172 6773 3a20  args, **kwargs: 
-0000d200: 626c 6163 6b2e 4368 616e 6765 642e 5945  black.Changed.YE
-0000d210: 532c 0a20 2020 2020 2020 2029 2061 7320  S,.        ) as 
-0000d220: 6673 7473 3a0a 2020 2020 2020 2020 2020  fsts:.          
-0000d230: 2020 7265 706f 7274 203d 204d 6167 6963    report = Magic
-0000d240: 4d6f 636b 2829 0a20 2020 2020 2020 2020  Mock().         
-0000d250: 2020 2070 203d 2022 666f 6f2e 7079 6922     p = "foo.pyi"
-0000d260: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-0000d270: 6820 3d20 5061 7468 2866 225f 5f42 4c41  h = Path(f"__BLA
-0000d280: 434b 5f53 5444 494e 5f46 494c 454e 414d  CK_STDIN_FILENAM
-0000d290: 455f 5f7b 707d 2229 0a20 2020 2020 2020  E__{p}").       
-0000d2a0: 2020 2020 2065 7870 6563 7465 6420 3d20       expected = 
-0000d2b0: 5061 7468 2870 290a 2020 2020 2020 2020  Path(p).        
-0000d2c0: 2020 2020 626c 6163 6b2e 7265 666f 726d      black.reform
-0000d2d0: 6174 5f6f 6e65 280a 2020 2020 2020 2020  at_one(.        
-0000d2e0: 2020 2020 2020 2020 7061 7468 2c0a 2020          path,.  
-0000d2f0: 2020 2020 2020 2020 2020 2020 2020 6661                fa
-0000d300: 7374 3d54 7275 652c 0a20 2020 2020 2020  st=True,.       
-0000d310: 2020 2020 2020 2020 2077 7269 7465 5f62           write_b
-0000d320: 6163 6b3d 626c 6163 6b2e 5772 6974 6542  ack=black.WriteB
-0000d330: 6163 6b2e 5945 532c 0a20 2020 2020 2020  ack.YES,.       
-0000d340: 2020 2020 2020 2020 206d 6f64 653d 4445           mode=DE
-0000d350: 4641 554c 545f 4d4f 4445 2c0a 2020 2020  FAULT_MODE,.    
-0000d360: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-0000d370: 7274 3d72 6570 6f72 742c 0a20 2020 2020  rt=report,.     
-0000d380: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000d390: 2020 2020 2066 7374 732e 6173 7365 7274       fsts.assert
-0000d3a0: 5f63 616c 6c65 645f 6f6e 6365 5f77 6974  _called_once_wit
-0000d3b0: 6828 0a20 2020 2020 2020 2020 2020 2020  h(.             
-0000d3c0: 2020 2066 6173 743d 5472 7565 2c0a 2020     fast=True,.  
-0000d3d0: 2020 2020 2020 2020 2020 2020 2020 7772                wr
-0000d3e0: 6974 655f 6261 636b 3d62 6c61 636b 2e57  ite_back=black.W
-0000d3f0: 7269 7465 4261 636b 2e59 4553 2c0a 2020  riteBack.YES,.  
-0000d400: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-0000d410: 6465 3d72 6570 6c61 6365 2844 4546 4155  de=replace(DEFAU
-0000d420: 4c54 5f4d 4f44 452c 2069 735f 7079 693d  LT_MODE, is_pyi=
-0000d430: 5472 7565 292c 0a20 2020 2020 2020 2020  True),.         
-0000d440: 2020 2020 2020 206c 696e 6573 3d28 292c         lines=(),
-0000d450: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0000d460: 2020 2020 2020 2020 2020 2023 205f 5f42             # __B
-0000d470: 4c41 434b 5f53 5444 494e 5f46 494c 454e  LACK_STDIN_FILEN
-0000d480: 414d 455f 5f20 7368 6f75 6c64 2068 6176  AME__ should hav
-0000d490: 6520 6265 656e 2073 7472 6970 7065 640a  e been stripped.
-0000d4a0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-0000d4b0: 7274 2e64 6f6e 652e 6173 7365 7274 5f63  rt.done.assert_c
-0000d4c0: 616c 6c65 645f 7769 7468 2865 7870 6563  alled_with(expec
-0000d4d0: 7465 642c 2062 6c61 636b 2e43 6861 6e67  ted, black.Chang
-0000d4e0: 6564 2e59 4553 290a 0a20 2020 2040 7079  ed.YES)..    @py
-0000d4f0: 7465 7374 2e6d 6172 6b2e 696e 636f 6d70  test.mark.incomp
-0000d500: 6174 6962 6c65 5f77 6974 685f 6d79 7079  atible_with_mypy
-0000d510: 630a 2020 2020 6465 6620 7465 7374 5f72  c.    def test_r
-0000d520: 6566 6f72 6d61 745f 6f6e 655f 7769 7468  eformat_one_with
-0000d530: 5f73 7464 696e 5f66 696c 656e 616d 655f  _stdin_filename_
-0000d540: 6970 796e 6228 7365 6c66 2920 2d3e 204e  ipynb(self) -> N
-0000d550: 6f6e 653a 0a20 2020 2020 2020 2077 6974  one:.        wit
-0000d560: 6820 7061 7463 6828 0a20 2020 2020 2020  h patch(.       
-0000d570: 2020 2020 2022 626c 6163 6b2e 666f 726d       "black.form
-0000d580: 6174 5f73 7464 696e 5f74 6f5f 7374 646f  at_stdin_to_stdo
-0000d590: 7574 222c 0a20 2020 2020 2020 2020 2020  ut",.           
-0000d5a0: 2072 6574 7572 6e5f 7661 6c75 653d 6c61   return_value=la
-0000d5b0: 6d62 6461 202a 6172 6773 2c20 2a2a 6b77  mbda *args, **kw
-0000d5c0: 6172 6773 3a20 626c 6163 6b2e 4368 616e  args: black.Chan
-0000d5d0: 6765 642e 5945 532c 0a20 2020 2020 2020  ged.YES,.       
-0000d5e0: 2029 2061 7320 6673 7473 3a0a 2020 2020   ) as fsts:.    
-0000d5f0: 2020 2020 2020 2020 7265 706f 7274 203d          report =
-0000d600: 204d 6167 6963 4d6f 636b 2829 0a20 2020   MagicMock().   
-0000d610: 2020 2020 2020 2020 2070 203d 2022 666f           p = "fo
-0000d620: 6f2e 6970 796e 6222 0a20 2020 2020 2020  o.ipynb".       
-0000d630: 2020 2020 2070 6174 6820 3d20 5061 7468       path = Path
-0000d640: 2866 225f 5f42 4c41 434b 5f53 5444 494e  (f"__BLACK_STDIN
-0000d650: 5f46 494c 454e 414d 455f 5f7b 707d 2229  _FILENAME__{p}")
-0000d660: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
-0000d670: 6563 7465 6420 3d20 5061 7468 2870 290a  ected = Path(p).
-0000d680: 2020 2020 2020 2020 2020 2020 626c 6163              blac
-0000d690: 6b2e 7265 666f 726d 6174 5f6f 6e65 280a  k.reformat_one(.
-0000d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6b0: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
-0000d6c0: 2020 2020 2020 6661 7374 3d54 7275 652c        fast=True,
-0000d6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d6e0: 2077 7269 7465 5f62 6163 6b3d 626c 6163   write_back=blac
-0000d6f0: 6b2e 5772 6974 6542 6163 6b2e 5945 532c  k.WriteBack.YES,
-0000d700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d710: 206d 6f64 653d 4445 4641 554c 545f 4d4f   mode=DEFAULT_MO
-0000d720: 4445 2c0a 2020 2020 2020 2020 2020 2020  DE,.            
-0000d730: 2020 2020 7265 706f 7274 3d72 6570 6f72      report=repor
-0000d740: 742c 0a20 2020 2020 2020 2020 2020 2029  t,.            )
-0000d750: 0a20 2020 2020 2020 2020 2020 2066 7374  .            fst
-0000d760: 732e 6173 7365 7274 5f63 616c 6c65 645f  s.assert_called_
-0000d770: 6f6e 6365 5f77 6974 6828 0a20 2020 2020  once_with(.     
-0000d780: 2020 2020 2020 2020 2020 2066 6173 743d             fast=
-0000d790: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-0000d7a0: 2020 2020 2020 7772 6974 655f 6261 636b        write_back
-0000d7b0: 3d62 6c61 636b 2e57 7269 7465 4261 636b  =black.WriteBack
-0000d7c0: 2e59 4553 2c0a 2020 2020 2020 2020 2020  .YES,.          
-0000d7d0: 2020 2020 2020 6d6f 6465 3d72 6570 6c61        mode=repla
-0000d7e0: 6365 2844 4546 4155 4c54 5f4d 4f44 452c  ce(DEFAULT_MODE,
-0000d7f0: 2069 735f 6970 796e 623d 5472 7565 292c   is_ipynb=True),
-0000d800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d810: 206c 696e 6573 3d28 292c 0a20 2020 2020   lines=(),.     
-0000d820: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000d830: 2020 2020 2023 205f 5f42 4c41 434b 5f53       # __BLACK_S
-0000d840: 5444 494e 5f46 494c 454e 414d 455f 5f20  TDIN_FILENAME__ 
-0000d850: 7368 6f75 6c64 2068 6176 6520 6265 656e  should have been
-0000d860: 2073 7472 6970 7065 640a 2020 2020 2020   stripped.      
-0000d870: 2020 2020 2020 7265 706f 7274 2e64 6f6e        report.don
-0000d880: 652e 6173 7365 7274 5f63 616c 6c65 645f  e.assert_called_
-0000d890: 7769 7468 2865 7870 6563 7465 642c 2062  with(expected, b
-0000d8a0: 6c61 636b 2e43 6861 6e67 6564 2e59 4553  lack.Changed.YES
-0000d8b0: 290a 0a20 2020 2040 7079 7465 7374 2e6d  )..    @pytest.m
-0000d8c0: 6172 6b2e 696e 636f 6d70 6174 6962 6c65  ark.incompatible
-0000d8d0: 5f77 6974 685f 6d79 7079 630a 2020 2020  _with_mypyc.    
-0000d8e0: 6465 6620 7465 7374 5f72 6566 6f72 6d61  def test_reforma
-0000d8f0: 745f 6f6e 655f 7769 7468 5f73 7464 696e  t_one_with_stdin
-0000d900: 5f61 6e64 5f65 7869 7374 696e 675f 7061  _and_existing_pa
-0000d910: 7468 2873 656c 6629 202d 3e20 4e6f 6e65  th(self) -> None
-0000d920: 3a0a 2020 2020 2020 2020 7769 7468 2070  :.        with p
-0000d930: 6174 6368 280a 2020 2020 2020 2020 2020  atch(.          
-0000d940: 2020 2262 6c61 636b 2e66 6f72 6d61 745f    "black.format_
-0000d950: 7374 6469 6e5f 746f 5f73 7464 6f75 7422  stdin_to_stdout"
-0000d960: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
-0000d970: 7475 726e 5f76 616c 7565 3d6c 616d 6264  turn_value=lambd
-0000d980: 6120 2a61 7267 732c 202a 2a6b 7761 7267  a *args, **kwarg
-0000d990: 733a 2062 6c61 636b 2e43 6861 6e67 6564  s: black.Changed
-0000d9a0: 2e59 4553 2c0a 2020 2020 2020 2020 2920  .YES,.        ) 
-0000d9b0: 6173 2066 7374 733a 0a20 2020 2020 2020  as fsts:.       
-0000d9c0: 2020 2020 2072 6570 6f72 7420 3d20 4d61       report = Ma
-0000d9d0: 6769 634d 6f63 6b28 290a 2020 2020 2020  gicMock().      
-0000d9e0: 2020 2020 2020 2320 4576 656e 2077 6974        # Even wit
-0000d9f0: 6820 616e 2065 7869 7374 696e 6720 6669  h an existing fi
-0000da00: 6c65 2c20 7369 6e63 6520 7765 2061 7265  le, since we are
-0000da10: 2066 6f72 6369 6e67 2073 7464 696e 2c20   forcing stdin, 
-0000da20: 626c 6163 6b0a 2020 2020 2020 2020 2020  black.          
-0000da30: 2020 2320 7368 6f75 6c64 206f 7574 7075    # should outpu
-0000da40: 7420 746f 2073 7464 6f75 7420 616e 6420  t to stdout and 
-0000da50: 6e6f 7420 6d6f 6469 6679 2074 6865 2066  not modify the f
-0000da60: 696c 6520 696e 706c 6163 650a 2020 2020  ile inplace.    
-0000da70: 2020 2020 2020 2020 7020 3d20 5448 4953          p = THIS
-0000da80: 5f44 4952 202f 2022 6461 7461 2220 2f20  _DIR / "data" / 
-0000da90: 2263 6173 6573 2220 2f20 2263 6f6c 6c65  "cases" / "colle
-0000daa0: 6374 696f 6e73 2e70 7922 0a20 2020 2020  ctions.py".     
-0000dab0: 2020 2020 2020 2023 204d 616b 6520 7375         # Make su
-0000dac0: 7265 2069 735f 6669 6c65 2061 6374 7561  re is_file actua
-0000dad0: 6c6c 7920 7265 7475 726e 7320 5472 7565  lly returns True
-0000dae0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000daf0: 662e 6173 7365 7274 5472 7565 2870 2e69  f.assertTrue(p.i
-0000db00: 735f 6669 6c65 2829 290a 2020 2020 2020  s_file()).      
-0000db10: 2020 2020 2020 7061 7468 203d 2050 6174        path = Pat
-0000db20: 6828 6622 5f5f 424c 4143 4b5f 5354 4449  h(f"__BLACK_STDI
-0000db30: 4e5f 4649 4c45 4e41 4d45 5f5f 7b70 7d22  N_FILENAME__{p}"
-0000db40: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-0000db50: 7065 6374 6564 203d 2050 6174 6828 7029  pected = Path(p)
-0000db60: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
-0000db70: 636b 2e72 6566 6f72 6d61 745f 6f6e 6528  ck.reformat_one(
-0000db80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000db90: 2070 6174 682c 0a20 2020 2020 2020 2020   path,.         
-0000dba0: 2020 2020 2020 2066 6173 743d 5472 7565         fast=True
-0000dbb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000dbc0: 2020 7772 6974 655f 6261 636b 3d62 6c61    write_back=bla
-0000dbd0: 636b 2e57 7269 7465 4261 636b 2e59 4553  ck.WriteBack.YES
-0000dbe0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000dbf0: 2020 6d6f 6465 3d44 4546 4155 4c54 5f4d    mode=DEFAULT_M
-0000dc00: 4f44 452c 0a20 2020 2020 2020 2020 2020  ODE,.           
-0000dc10: 2020 2020 2072 6570 6f72 743d 7265 706f       report=repo
-0000dc20: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
-0000dc30: 290a 2020 2020 2020 2020 2020 2020 6673  ).            fs
-0000dc40: 7473 2e61 7373 6572 745f 6361 6c6c 6564  ts.assert_called
-0000dc50: 5f6f 6e63 6528 290a 2020 2020 2020 2020  _once().        
-0000dc60: 2020 2020 2320 5f5f 424c 4143 4b5f 5354      # __BLACK_ST
-0000dc70: 4449 4e5f 4649 4c45 4e41 4d45 5f5f 2073  DIN_FILENAME__ s
-0000dc80: 686f 756c 6420 6861 7665 2062 6565 6e20  hould have been 
-0000dc90: 7374 7269 7070 6564 0a20 2020 2020 2020  stripped.       
-0000dca0: 2020 2020 2072 6570 6f72 742e 646f 6e65       report.done
-0000dcb0: 2e61 7373 6572 745f 6361 6c6c 6564 5f77  .assert_called_w
-0000dcc0: 6974 6828 6578 7065 6374 6564 2c20 626c  ith(expected, bl
-0000dcd0: 6163 6b2e 4368 616e 6765 642e 5945 5329  ack.Changed.YES)
-0000dce0: 0a0a 2020 2020 6465 6620 7465 7374 5f72  ..    def test_r
-0000dcf0: 6566 6f72 6d61 745f 6f6e 655f 7769 7468  eformat_one_with
-0000dd00: 5f73 7464 696e 5f65 6d70 7479 2873 656c  _stdin_empty(sel
-0000dd10: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0000dd20: 2020 2020 6361 7365 7320 3d20 5b0a 2020      cases = [.  
-0000dd30: 2020 2020 2020 2020 2020 2822 222c 2022            ("", "
-0000dd40: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-0000dd50: 2822 5c6e 222c 2022 5c6e 2229 2c0a 2020  ("\n", "\n"),.  
-0000dd60: 2020 2020 2020 2020 2020 2822 5c72 5c6e            ("\r\n
-0000dd70: 222c 2022 5c72 5c6e 2229 2c0a 2020 2020  ", "\r\n"),.    
-0000dd80: 2020 2020 2020 2020 2822 205c 7422 2c20          (" \t", 
-0000dd90: 2222 292c 0a20 2020 2020 2020 2020 2020  ""),.           
-0000dda0: 2028 2220 5c74 5c6e 5c74 2022 2c20 225c   (" \t\n\t ", "\
-0000ddb0: 6e22 292c 0a20 2020 2020 2020 2020 2020  n"),.           
-0000ddc0: 2028 2220 5c74 5c72 5c6e 5c74 2022 2c20   (" \t\r\n\t ", 
-0000ddd0: 225c 725c 6e22 292c 0a20 2020 2020 2020  "\r\n"),.       
-0000dde0: 205d 0a0a 2020 2020 2020 2020 6465 6620   ]..        def 
-0000ddf0: 5f6e 6577 5f77 7261 7070 6572 280a 2020  _new_wrapper(.  
-0000de00: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-0000de10: 3a20 696f 2e53 7472 696e 6749 4f2c 2069  : io.StringIO, i
-0000de20: 6f5f 5465 7874 494f 5772 6170 7065 723a  o_TextIOWrapper:
-0000de30: 2054 7970 655b 696f 2e54 6578 7449 4f57   Type[io.TextIOW
-0000de40: 7261 7070 6572 5d0a 2020 2020 2020 2020  rapper].        
-0000de50: 2920 2d3e 2043 616c 6c61 626c 655b 5b41  ) -> Callable[[A
-0000de60: 6e79 2c20 416e 795d 2c20 696f 2e54 6578  ny, Any], io.Tex
-0000de70: 7449 4f57 7261 7070 6572 5d3a 0a20 2020  tIOWrapper]:.   
-0000de80: 2020 2020 2020 2020 2064 6566 2067 6574           def get
-0000de90: 5f6f 7574 7075 7428 2a61 7267 733a 2041  _output(*args: A
-0000dea0: 6e79 2c20 2a2a 6b77 6172 6773 3a20 416e  ny, **kwargs: An
-0000deb0: 7929 202d 3e20 696f 2e54 6578 7449 4f57  y) -> io.TextIOW
-0000dec0: 7261 7070 6572 3a0a 2020 2020 2020 2020  rapper:.        
-0000ded0: 2020 2020 2020 2020 6966 2061 7267 7320          if args 
-0000dee0: 3d3d 2028 7379 732e 7374 646f 7574 2e62  == (sys.stdout.b
-0000def0: 7566 6665 722c 293a 0a20 2020 2020 2020  uffer,):.       
-0000df00: 2020 2020 2020 2020 2020 2020 2023 2049               # I
-0000df10: 7427 7320 6066 6f72 6d61 745f 7374 6469  t's `format_stdi
-0000df20: 6e5f 746f 5f73 7464 6f75 7428 2960 2063  n_to_stdout()` c
-0000df30: 616c 6c69 6e67 2060 696f 2e54 6578 7449  alling `io.TextI
-0000df40: 4f57 7261 7070 6572 2829 602c 0a20 2020  OWrapper()`,.   
-0000df50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000df60: 2023 2072 6574 7572 6e20 6f75 7220 6d6f   # return our mo
-0000df70: 636b 206f 626a 6563 742e 0a20 2020 2020  ck object..     
-0000df80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000df90: 6574 7572 6e20 6f75 7470 7574 0a20 2020  eturn output.   
-0000dfa0: 2020 2020 2020 2020 2020 2020 2023 2049               # I
-0000dfb0: 7427 7320 736f 6d65 7468 696e 6720 656c  t's something el
-0000dfc0: 7365 2028 692e 652e 2060 6465 636f 6465  se (i.e. `decode
-0000dfd0: 5f62 7974 6573 2829 6029 2063 616c 6c69  _bytes()`) calli
-0000dfe0: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
-0000dff0: 2020 2023 2060 696f 2e54 6578 7449 4f57     # `io.TextIOW
-0000e000: 7261 7070 6572 2829 602c 2070 6173 7320  rapper()`, pass 
-0000e010: 7468 726f 7567 6820 746f 2074 6865 206f  through to the o
-0000e020: 7269 6769 6e61 6c20 696d 706c 656d 656e  riginal implemen
-0000e030: 7461 7469 6f6e 2e0a 2020 2020 2020 2020  tation..        
-0000e040: 2020 2020 2020 2020 2320 5365 6520 6469          # See di
-0000e050: 7363 7573 7369 6f6e 2069 6e20 6874 7470  scussion in http
-0000e060: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f70  s://github.com/p
-0000e070: 7366 2f62 6c61 636b 2f70 756c 6c2f 3234  sf/black/pull/24
-0000e080: 3839 0a20 2020 2020 2020 2020 2020 2020  89.             
-0000e090: 2020 2072 6574 7572 6e20 696f 5f54 6578     return io_Tex
-0000e0a0: 7449 4f57 7261 7070 6572 282a 6172 6773  tIOWrapper(*args
-0000e0b0: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
-0000e0c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000e0d0: 6765 745f 6f75 7470 7574 0a0a 2020 2020  get_output..    
-0000e0e0: 2020 2020 666f 7220 636f 6e74 656e 742c      for content,
-0000e0f0: 2065 7870 6563 7465 6420 696e 2063 6173   expected in cas
-0000e100: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0000e110: 6f75 7470 7574 203d 2069 6f2e 5374 7269  output = io.Stri
-0000e120: 6e67 494f 2829 0a20 2020 2020 2020 2020  ngIO().         
-0000e130: 2020 2069 6f5f 5465 7874 494f 5772 6170     io_TextIOWrap
-0000e140: 7065 7220 3d20 696f 2e54 6578 7449 4f57  per = io.TextIOW
-0000e150: 7261 7070 6572 0a0a 2020 2020 2020 2020  rapper..        
-0000e160: 2020 2020 7769 7468 2070 6174 6368 2822      with patch("
-0000e170: 696f 2e54 6578 7449 4f57 7261 7070 6572  io.TextIOWrapper
-0000e180: 222c 205f 6e65 775f 7772 6170 7065 7228  ", _new_wrapper(
-0000e190: 6f75 7470 7574 2c20 696f 5f54 6578 7449  output, io_TextI
-0000e1a0: 4f57 7261 7070 6572 2929 3a0a 2020 2020  OWrapper)):.    
-0000e1b0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-0000e1c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e1d0: 2020 2020 2062 6c61 636b 2e66 6f72 6d61       black.forma
-0000e1e0: 745f 7374 6469 6e5f 746f 5f73 7464 6f75  t_stdin_to_stdou
-0000e1f0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-0000e200: 2020 2020 2020 2020 2020 2066 6173 743d             fast=
-0000e210: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-0000e220: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000e230: 6e74 656e 743d 636f 6e74 656e 742c 0a20  ntent=content,. 
-0000e240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e250: 2020 2020 2020 2077 7269 7465 5f62 6163         write_bac
-0000e260: 6b3d 626c 6163 6b2e 5772 6974 6542 6163  k=black.WriteBac
-0000e270: 6b2e 5945 532c 0a20 2020 2020 2020 2020  k.YES,.         
-0000e280: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000e290: 6f64 653d 4445 4641 554c 545f 4d4f 4445  ode=DEFAULT_MODE
-0000e2a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000e2b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000e2c0: 2020 2020 2020 2020 6578 6365 7074 2069          except i
-0000e2d0: 6f2e 556e 7375 7070 6f72 7465 644f 7065  o.UnsupportedOpe
-0000e2e0: 7261 7469 6f6e 3a0a 2020 2020 2020 2020  ration:.        
-0000e2f0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-0000e300: 2020 2320 5374 7269 6e67 494f 2064 6f65    # StringIO doe
-0000e310: 7320 6e6f 7420 7375 7070 6f72 7420 6465  s not support de
-0000e320: 7461 6368 0a20 2020 2020 2020 2020 2020  tach.           
-0000e330: 2020 2020 2061 7373 6572 7420 6f75 7470       assert outp
-0000e340: 7574 2e67 6574 7661 6c75 6528 2920 3d3d  ut.getvalue() ==
-0000e350: 2065 7870 6563 7465 640a 0a20 2020 2064   expected..    d
-0000e360: 6566 2074 6573 745f 636c 695f 756e 7374  ef test_cli_unst
-0000e370: 6162 6c65 2873 656c 6629 202d 3e20 4e6f  able(self) -> No
-0000e380: 6e65 3a0a 2020 2020 2020 2020 7365 6c66  ne:.        self
-0000e390: 2e69 6e76 6f6b 6542 6c61 636b 285b 222d  .invokeBlack(["-
-0000e3a0: 2d75 6e73 7461 626c 6522 2c20 222d 6322  -unstable", "-c"
-0000e3b0: 2c20 2230 225d 2c20 6578 6974 5f63 6f64  , "0"], exit_cod
-0000e3c0: 653d 3029 0a20 2020 2020 2020 2073 656c  e=0).        sel
-0000e3d0: 662e 696e 766f 6b65 426c 6163 6b28 5b22  f.invokeBlack(["
-0000e3e0: 2d2d 7072 6576 6965 7722 2c20 222d 6322  --preview", "-c"
-0000e3f0: 2c20 2230 225d 2c20 6578 6974 5f63 6f64  , "0"], exit_cod
-0000e400: 653d 3029 0a20 2020 2020 2020 2023 204d  e=0).        # M
-0000e410: 7573 7420 616c 736f 2070 6173 7320 2d2d  ust also pass --
-0000e420: 7072 6576 6965 770a 2020 2020 2020 2020  preview.        
-0000e430: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
-0000e440: 280a 2020 2020 2020 2020 2020 2020 5b22  (.            ["
-0000e450: 2d2d 656e 6162 6c65 2d75 6e73 7461 626c  --enable-unstabl
-0000e460: 652d 6665 6174 7572 6522 2c20 2273 7472  e-feature", "str
-0000e470: 696e 675f 7072 6f63 6573 7369 6e67 222c  ing_processing",
-0000e480: 2022 2d63 222c 2022 3022 5d2c 2065 7869   "-c", "0"], exi
-0000e490: 745f 636f 6465 3d31 0a20 2020 2020 2020  t_code=1.       
-0000e4a0: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
-0000e4b0: 696e 766f 6b65 426c 6163 6b28 0a20 2020  invokeBlack(.   
-0000e4c0: 2020 2020 2020 2020 205b 222d 2d70 7265           ["--pre
-0000e4d0: 7669 6577 222c 2022 2d2d 656e 6162 6c65  view", "--enable
-0000e4e0: 2d75 6e73 7461 626c 652d 6665 6174 7572  -unstable-featur
-0000e4f0: 6522 2c20 2273 7472 696e 675f 7072 6f63  e", "string_proc
-0000e500: 6573 7369 6e67 222c 2022 2d63 222c 2022  essing", "-c", "
-0000e510: 3022 5d2c 0a20 2020 2020 2020 2020 2020  0"],.           
-0000e520: 2065 7869 745f 636f 6465 3d30 2c0a 2020   exit_code=0,.  
-0000e530: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000e540: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
-0000e550: 280a 2020 2020 2020 2020 2020 2020 5b22  (.            ["
-0000e560: 2d2d 756e 7374 6162 6c65 222c 2022 2d2d  --unstable", "--
-0000e570: 656e 6162 6c65 2d75 6e73 7461 626c 652d  enable-unstable-
-0000e580: 6665 6174 7572 6522 2c20 2273 7472 696e  feature", "strin
-0000e590: 675f 7072 6f63 6573 7369 6e67 222c 2022  g_processing", "
-0000e5a0: 2d63 222c 2022 3022 5d2c 0a20 2020 2020  -c", "0"],.     
-0000e5b0: 2020 2020 2020 2065 7869 745f 636f 6465         exit_code
-0000e5c0: 3d30 2c0a 2020 2020 2020 2020 290a 0a20  =0,.        ).. 
-0000e5d0: 2020 2064 6566 2074 6573 745f 696e 7661     def test_inva
-0000e5e0: 6c69 645f 636c 695f 7265 6765 7828 7365  lid_cli_regex(se
-0000e5f0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-0000e600: 2020 2020 2066 6f72 206f 7074 696f 6e20       for option 
-0000e610: 696e 205b 222d 2d69 6e63 6c75 6465 222c  in ["--include",
-0000e620: 2022 2d2d 6578 636c 7564 6522 2c20 222d   "--exclude", "-
-0000e630: 2d65 7874 656e 642d 6578 636c 7564 6522  -extend-exclude"
-0000e640: 2c20 222d 2d66 6f72 6365 2d65 7863 6c75  , "--force-exclu
-0000e650: 6465 225d 3a0a 2020 2020 2020 2020 2020  de"]:.          
-0000e660: 2020 7365 6c66 2e69 6e76 6f6b 6542 6c61    self.invokeBla
-0000e670: 636b 285b 222d 222c 206f 7074 696f 6e2c  ck(["-", option,
-0000e680: 2022 2a2a 2829 2821 212a 2922 5d2c 2065   "**()(!!*)"], e
-0000e690: 7869 745f 636f 6465 3d32 290a 0a20 2020  xit_code=2)..   
-0000e6a0: 2064 6566 2074 6573 745f 7265 7175 6972   def test_requir
-0000e6b0: 6564 5f76 6572 7369 6f6e 5f6d 6174 6368  ed_version_match
-0000e6c0: 6573 5f76 6572 7369 6f6e 2873 656c 6629  es_version(self)
-0000e6d0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000e6e0: 2020 7365 6c66 2e69 6e76 6f6b 6542 6c61    self.invokeBla
-0000e6f0: 636b 280a 2020 2020 2020 2020 2020 2020  ck(.            
-0000e700: 5b22 2d2d 7265 7175 6972 6564 2d76 6572  ["--required-ver
-0000e710: 7369 6f6e 222c 2062 6c61 636b 2e5f 5f76  sion", black.__v
-0000e720: 6572 7369 6f6e 5f5f 2c20 222d 6322 2c20  ersion__, "-c", 
-0000e730: 2230 225d 2c0a 2020 2020 2020 2020 2020  "0"],.          
-0000e740: 2020 6578 6974 5f63 6f64 653d 302c 0a20    exit_code=0,. 
-0000e750: 2020 2020 2020 2020 2020 2069 676e 6f72             ignor
-0000e760: 655f 636f 6e66 6967 3d54 7275 652c 0a20  e_config=True,. 
-0000e770: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0000e780: 6620 7465 7374 5f72 6571 7569 7265 645f  f test_required_
-0000e790: 7665 7273 696f 6e5f 6d61 7463 6865 735f  version_matches_
-0000e7a0: 7061 7274 6961 6c5f 7665 7273 696f 6e28  partial_version(
-0000e7b0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0000e7c0: 2020 2020 2020 2073 656c 662e 696e 766f         self.invo
-0000e7d0: 6b65 426c 6163 6b28 0a20 2020 2020 2020  keBlack(.       
-0000e7e0: 2020 2020 205b 222d 2d72 6571 7569 7265       ["--require
-0000e7f0: 642d 7665 7273 696f 6e22 2c20 626c 6163  d-version", blac
-0000e800: 6b2e 5f5f 7665 7273 696f 6e5f 5f2e 7370  k.__version__.sp
-0000e810: 6c69 7428 222e 2229 5b30 5d2c 2022 2d63  lit(".")[0], "-c
-0000e820: 222c 2022 3022 5d2c 0a20 2020 2020 2020  ", "0"],.       
-0000e830: 2020 2020 2065 7869 745f 636f 6465 3d30       exit_code=0
-0000e840: 2c0a 2020 2020 2020 2020 2020 2020 6967  ,.            ig
-0000e850: 6e6f 7265 5f63 6f6e 6669 673d 5472 7565  nore_config=True
-0000e860: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-0000e870: 2064 6566 2074 6573 745f 7265 7175 6972   def test_requir
-0000e880: 6564 5f76 6572 7369 6f6e 5f64 6f65 735f  ed_version_does_
-0000e890: 6e6f 745f 6d61 7463 685f 6f6e 5f6d 696e  not_match_on_min
-0000e8a0: 6f72 5f76 6572 7369 6f6e 2873 656c 6629  or_version(self)
-0000e8b0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000e8c0: 2020 7365 6c66 2e69 6e76 6f6b 6542 6c61    self.invokeBla
-0000e8d0: 636b 280a 2020 2020 2020 2020 2020 2020  ck(.            
-0000e8e0: 5b22 2d2d 7265 7175 6972 6564 2d76 6572  ["--required-ver
-0000e8f0: 7369 6f6e 222c 2062 6c61 636b 2e5f 5f76  sion", black.__v
-0000e900: 6572 7369 6f6e 5f5f 2e73 706c 6974 2822  ersion__.split("
-0000e910: 2e22 295b 305d 202b 2022 2e39 3939 222c  .")[0] + ".999",
-0000e920: 2022 2d63 222c 2022 3022 5d2c 0a20 2020   "-c", "0"],.   
-0000e930: 2020 2020 2020 2020 2065 7869 745f 636f           exit_co
-0000e940: 6465 3d31 2c0a 2020 2020 2020 2020 2020  de=1,.          
-0000e950: 2020 6967 6e6f 7265 5f63 6f6e 6669 673d    ignore_config=
-0000e960: 5472 7565 2c0a 2020 2020 2020 2020 290a  True,.        ).
-0000e970: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
-0000e980: 7175 6972 6564 5f76 6572 7369 6f6e 5f64  quired_version_d
-0000e990: 6f65 735f 6e6f 745f 6d61 7463 685f 7665  oes_not_match_ve
-0000e9a0: 7273 696f 6e28 7365 6c66 2920 2d3e 204e  rsion(self) -> N
-0000e9b0: 6f6e 653a 0a20 2020 2020 2020 2072 6573  one:.        res
-0000e9c0: 756c 7420 3d20 426c 6163 6b52 756e 6e65  ult = BlackRunne
-0000e9d0: 7228 292e 696e 766f 6b65 280a 2020 2020  r().invoke(.    
-0000e9e0: 2020 2020 2020 2020 626c 6163 6b2e 6d61          black.ma
-0000e9f0: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
-0000ea00: 5b22 2d2d 7265 7175 6972 6564 2d76 6572  ["--required-ver
-0000ea10: 7369 6f6e 222c 2022 3230 2e39 3962 222c  sion", "20.99b",
-0000ea20: 2022 2d63 222c 2022 3022 5d2c 0a20 2020   "-c", "0"],.   
-0000ea30: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-0000ea40: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000ea50: 7265 7375 6c74 2e65 7869 745f 636f 6465  result.exit_code
-0000ea60: 2c20 3129 0a20 2020 2020 2020 2073 656c  , 1).        sel
-0000ea70: 662e 6173 7365 7274 496e 2822 7265 7175  f.assertIn("requ
-0000ea80: 6972 6564 2076 6572 7369 6f6e 222c 2072  ired version", r
-0000ea90: 6573 756c 742e 7374 6465 7272 290a 0a20  esult.stderr).. 
-0000eaa0: 2020 2064 6566 2074 6573 745f 7072 6573     def test_pres
-0000eab0: 6572 7665 735f 6c69 6e65 5f65 6e64 696e  erves_line_endin
-0000eac0: 6773 2873 656c 6629 202d 3e20 4e6f 6e65  gs(self) -> None
-0000ead0: 3a0a 2020 2020 2020 2020 7769 7468 2054  :.        with T
-0000eae0: 656d 706f 7261 7279 4469 7265 6374 6f72  emporaryDirector
-0000eaf0: 7928 2920 6173 2077 6f72 6b73 7061 6365  y() as workspace
-0000eb00: 3a0a 2020 2020 2020 2020 2020 2020 7465  :.            te
-0000eb10: 7374 5f66 696c 6520 3d20 5061 7468 2877  st_file = Path(w
-0000eb20: 6f72 6b73 7061 6365 2920 2f20 2274 6573  orkspace) / "tes
-0000eb30: 742e 7079 220a 2020 2020 2020 2020 2020  t.py".          
-0000eb40: 2020 666f 7220 6e6c 2069 6e20 5b22 5c6e    for nl in ["\n
-0000eb50: 222c 2022 5c72 5c6e 225d 3a0a 2020 2020  ", "\r\n"]:.    
-0000eb60: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0000eb70: 656e 7473 203d 206e 6c2e 6a6f 696e 285b  ents = nl.join([
-0000eb80: 2264 6566 2066 2820 2029 3a22 2c20 2220  "def f(  ):", " 
-0000eb90: 2020 2070 6173 7322 5d29 0a20 2020 2020     pass"]).     
-0000eba0: 2020 2020 2020 2020 2020 2074 6573 745f             test_
-0000ebb0: 6669 6c65 2e77 7269 7465 5f62 7974 6573  file.write_bytes
-0000ebc0: 2863 6f6e 7465 6e74 732e 656e 636f 6465  (contents.encode
-0000ebd0: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
-0000ebe0: 2020 2020 6666 2874 6573 745f 6669 6c65      ff(test_file
-0000ebf0: 2c20 7772 6974 655f 6261 636b 3d62 6c61  , write_back=bla
-0000ec00: 636b 2e57 7269 7465 4261 636b 2e59 4553  ck.WriteBack.YES
-0000ec10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000ec20: 2020 7570 6461 7465 645f 636f 6e74 656e    updated_conten
-0000ec30: 7473 3a20 6279 7465 7320 3d20 7465 7374  ts: bytes = test
-0000ec40: 5f66 696c 652e 7265 6164 5f62 7974 6573  _file.read_bytes
-0000ec50: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0000ec60: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
-0000ec70: 286e 6c2e 656e 636f 6465 2829 2c20 7570  (nl.encode(), up
-0000ec80: 6461 7465 645f 636f 6e74 656e 7473 290a  dated_contents).
-0000ec90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eca0: 6966 206e 6c20 3d3d 2022 5c6e 223a 0a20  if nl == "\n":. 
-0000ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ecc0: 2020 2073 656c 662e 6173 7365 7274 4e6f     self.assertNo
-0000ecd0: 7449 6e28 6222 5c72 5c6e 222c 2075 7064  tIn(b"\r\n", upd
-0000ece0: 6174 6564 5f63 6f6e 7465 6e74 7329 0a0a  ated_contents)..
-0000ecf0: 2020 2020 6465 6620 7465 7374 5f70 7265      def test_pre
-0000ed00: 7365 7276 6573 5f6c 696e 655f 656e 6469  serves_line_endi
-0000ed10: 6e67 735f 7669 615f 7374 6469 6e28 7365  ngs_via_stdin(se
-0000ed20: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-0000ed30: 2020 2020 2066 6f72 206e 6c20 696e 205b       for nl in [
-0000ed40: 225c 6e22 2c20 225c 725c 6e22 5d3a 0a20  "\n", "\r\n"]:. 
-0000ed50: 2020 2020 2020 2020 2020 2063 6f6e 7465             conte
-0000ed60: 6e74 7320 3d20 6e6c 2e6a 6f69 6e28 5b22  nts = nl.join(["
-0000ed70: 6465 6620 6628 2020 293a 222c 2022 2020  def f(  ):", "  
-0000ed80: 2020 7061 7373 225d 290a 2020 2020 2020    pass"]).      
-0000ed90: 2020 2020 2020 7275 6e6e 6572 203d 2042        runner = B
-0000eda0: 6c61 636b 5275 6e6e 6572 2829 0a20 2020  lackRunner().   
-0000edb0: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-0000edc0: 3d20 7275 6e6e 6572 2e69 6e76 6f6b 6528  = runner.invoke(
-0000edd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ede0: 2062 6c61 636b 2e6d 6169 6e2c 205b 222d   black.main, ["-
-0000edf0: 222c 2022 2d2d 6661 7374 225d 2c20 696e  ", "--fast"], in
-0000ee00: 7075 743d 4279 7465 7349 4f28 636f 6e74  put=BytesIO(cont
-0000ee10: 656e 7473 2e65 6e63 6f64 6528 2275 7466  ents.encode("utf
-0000ee20: 2d38 2229 290a 2020 2020 2020 2020 2020  -8")).          
-0000ee30: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000ee40: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000ee50: 2872 6573 756c 742e 6578 6974 5f63 6f64  (result.exit_cod
-0000ee60: 652c 2030 290a 2020 2020 2020 2020 2020  e, 0).          
-0000ee70: 2020 6f75 7470 7574 203d 2072 6573 756c    output = resul
-0000ee80: 742e 7374 646f 7574 5f62 7974 6573 0a20  t.stdout_bytes. 
-0000ee90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000eea0: 6173 7365 7274 496e 286e 6c2e 656e 636f  assertIn(nl.enco
-0000eeb0: 6465 2822 7574 662d 3822 292c 206f 7574  de("utf-8"), out
-0000eec0: 7075 7429 0a20 2020 2020 2020 2020 2020  put).           
-0000eed0: 2069 6620 6e6c 203d 3d20 225c 6e22 3a0a   if nl == "\n":.
-0000eee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eef0: 7365 6c66 2e61 7373 6572 744e 6f74 496e  self.assertNotIn
-0000ef00: 2862 225c 725c 6e22 2c20 6f75 7470 7574  (b"\r\n", output
-0000ef10: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-0000ef20: 6e6f 726d 616c 697a 655f 6c69 6e65 5f65  normalize_line_e
-0000ef30: 6e64 696e 6773 2873 656c 6629 202d 3e20  ndings(self) -> 
-0000ef40: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
-0000ef50: 7468 2054 656d 706f 7261 7279 4469 7265  th TemporaryDire
-0000ef60: 6374 6f72 7928 2920 6173 2077 6f72 6b73  ctory() as works
-0000ef70: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
-0000ef80: 2020 7465 7374 5f66 696c 6520 3d20 5061    test_file = Pa
-0000ef90: 7468 2877 6f72 6b73 7061 6365 2920 2f20  th(workspace) / 
-0000efa0: 2274 6573 742e 7079 220a 2020 2020 2020  "test.py".      
-0000efb0: 2020 2020 2020 666f 7220 6461 7461 2c20        for data, 
-0000efc0: 6578 7065 6374 6564 2069 6e20 280a 2020  expected in (.  
-0000efd0: 2020 2020 2020 2020 2020 2020 2020 2862                (b
-0000efe0: 2263 5c72 5c6e 635c 6e20 222c 2062 2263  "c\r\nc\n ", b"c
-0000eff0: 5c72 5c6e 635c 725c 6e22 292c 0a20 2020  \r\nc\r\n"),.   
-0000f000: 2020 2020 2020 2020 2020 2020 2028 6222               (b"
-0000f010: 6c5c 6e6c 5c72 5c6e 2022 2c20 6222 6c5c  l\nl\r\n ", b"l\
-0000f020: 6e6c 5c6e 2229 2c0a 2020 2020 2020 2020  nl\n"),.        
-0000f030: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-0000f040: 2020 2020 2020 2074 6573 745f 6669 6c65         test_file
-0000f050: 2e77 7269 7465 5f62 7974 6573 2864 6174  .write_bytes(dat
-0000f060: 6129 0a20 2020 2020 2020 2020 2020 2020  a).             
-0000f070: 2020 2066 6628 7465 7374 5f66 696c 652c     ff(test_file,
-0000f080: 2077 7269 7465 5f62 6163 6b3d 626c 6163   write_back=blac
-0000f090: 6b2e 5772 6974 6542 6163 6b2e 5945 5329  k.WriteBack.YES)
-0000f0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f0b0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000f0c0: 6c28 7465 7374 5f66 696c 652e 7265 6164  l(test_file.read
-0000f0d0: 5f62 7974 6573 2829 2c20 6578 7065 6374  _bytes(), expect
-0000f0e0: 6564 290a 0a20 2020 2064 6566 2074 6573  ed)..    def tes
-0000f0f0: 745f 726f 6f74 5f6c 6f67 6765 725f 6e6f  t_root_logger_no
-0000f100: 745f 7573 6564 5f64 6972 6563 746c 7928  t_used_directly(
-0000f110: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0000f120: 2020 2020 2020 2064 6566 2066 6169 6c28         def fail(
-0000f130: 2a61 7267 733a 2041 6e79 2c20 2a2a 6b77  *args: Any, **kw
-0000f140: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
-0000f150: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000f160: 7365 6c66 2e66 6169 6c28 2252 6563 6f72  self.fail("Recor
-0000f170: 6420 6372 6561 7465 6420 7769 7468 2072  d created with r
-0000f180: 6f6f 7420 6c6f 6767 6572 2229 0a0a 2020  oot logger")..  
-0000f190: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
-0000f1a0: 2e6d 756c 7469 706c 6528 0a20 2020 2020  .multiple(.     
-0000f1b0: 2020 2020 2020 206c 6f67 6769 6e67 2e72         logging.r
-0000f1c0: 6f6f 742c 0a20 2020 2020 2020 2020 2020  oot,.           
-0000f1d0: 2064 6562 7567 3d66 6169 6c2c 0a20 2020   debug=fail,.   
-0000f1e0: 2020 2020 2020 2020 2069 6e66 6f3d 6661           info=fa
-0000f1f0: 696c 2c0a 2020 2020 2020 2020 2020 2020  il,.            
-0000f200: 7761 726e 696e 673d 6661 696c 2c0a 2020  warning=fail,.  
-0000f210: 2020 2020 2020 2020 2020 6572 726f 723d            error=
-0000f220: 6661 696c 2c0a 2020 2020 2020 2020 2020  fail,.          
-0000f230: 2020 6372 6974 6963 616c 3d66 6169 6c2c    critical=fail,
-0000f240: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-0000f250: 3d66 6169 6c2c 0a20 2020 2020 2020 2029  =fail,.        )
-0000f260: 3a0a 2020 2020 2020 2020 2020 2020 6666  :.            ff
-0000f270: 2854 4849 535f 4449 5220 2f20 2275 7469  (THIS_DIR / "uti
-0000f280: 6c2e 7079 2229 0a0a 2020 2020 6465 6620  l.py")..    def 
-0000f290: 7465 7374 5f69 6e76 616c 6964 5f63 6f6e  test_invalid_con
-0000f2a0: 6669 675f 7265 7475 726e 5f63 6f64 6528  fig_return_code(
-0000f2b0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0000f2c0: 2020 2020 2020 2074 6d70 5f66 696c 6520         tmp_file 
-0000f2d0: 3d20 5061 7468 2862 6c61 636b 2e64 756d  = Path(black.dum
-0000f2e0: 705f 746f 5f66 696c 6528 2929 0a20 2020  p_to_file()).   
-0000f2f0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0000f300: 2020 2020 2020 746d 705f 636f 6e66 6967        tmp_config
-0000f310: 203d 2050 6174 6828 626c 6163 6b2e 6475   = Path(black.du
-0000f320: 6d70 5f74 6f5f 6669 6c65 2829 290a 2020  mp_to_file()).  
-0000f330: 2020 2020 2020 2020 2020 746d 705f 636f            tmp_co
-0000f340: 6e66 6967 2e75 6e6c 696e 6b28 290a 2020  nfig.unlink().  
-0000f350: 2020 2020 2020 2020 2020 6172 6773 203d            args =
-0000f360: 205b 222d 2d63 6f6e 6669 6722 2c20 7374   ["--config", st
-0000f370: 7228 746d 705f 636f 6e66 6967 292c 2073  r(tmp_config), s
-0000f380: 7472 2874 6d70 5f66 696c 6529 5d0a 2020  tr(tmp_file)].  
-0000f390: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-0000f3a0: 6e76 6f6b 6542 6c61 636b 2861 7267 732c  nvokeBlack(args,
-0000f3b0: 2065 7869 745f 636f 6465 3d32 2c20 6967   exit_code=2, ig
-0000f3c0: 6e6f 7265 5f63 6f6e 6669 673d 4661 6c73  nore_config=Fals
-0000f3d0: 6529 0a20 2020 2020 2020 2066 696e 616c  e).        final
-0000f3e0: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
-0000f3f0: 746d 705f 6669 6c65 2e75 6e6c 696e 6b28  tmp_file.unlink(
-0000f400: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-0000f410: 7061 7273 655f 7079 7072 6f6a 6563 745f  parse_pyproject_
-0000f420: 746f 6d6c 2873 656c 6629 202d 3e20 4e6f  toml(self) -> No
-0000f430: 6e65 3a0a 2020 2020 2020 2020 7465 7374  ne:.        test
-0000f440: 5f74 6f6d 6c5f 6669 6c65 203d 2054 4849  _toml_file = THI
-0000f450: 535f 4449 5220 2f20 2274 6573 742e 746f  S_DIR / "test.to
-0000f460: 6d6c 220a 2020 2020 2020 2020 636f 6e66  ml".        conf
-0000f470: 6967 203d 2062 6c61 636b 2e70 6172 7365  ig = black.parse
-0000f480: 5f70 7970 726f 6a65 6374 5f74 6f6d 6c28  _pyproject_toml(
-0000f490: 7374 7228 7465 7374 5f74 6f6d 6c5f 6669  str(test_toml_fi
-0000f4a0: 6c65 2929 0a20 2020 2020 2020 2073 656c  le)).        sel
-0000f4b0: 662e 6173 7365 7274 4571 7561 6c28 636f  f.assertEqual(co
-0000f4c0: 6e66 6967 5b22 7665 7262 6f73 6522 5d2c  nfig["verbose"],
-0000f4d0: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
-0000f4e0: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
-0000f4f0: 6669 675b 2263 6865 636b 225d 2c20 226e  fig["check"], "n
-0000f500: 6f22 290a 2020 2020 2020 2020 7365 6c66  o").        self
-0000f510: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
-0000f520: 6669 675b 2264 6966 6622 5d2c 2022 7922  fig["diff"], "y"
-0000f530: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000f540: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
-0000f550: 675b 2263 6f6c 6f72 225d 2c20 5472 7565  g["color"], True
-0000f560: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000f570: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
-0000f580: 675b 226c 696e 655f 6c65 6e67 7468 225d  g["line_length"]
-0000f590: 2c20 3739 290a 2020 2020 2020 2020 7365  , 79).        se
-0000f5a0: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-0000f5b0: 6f6e 6669 675b 2274 6172 6765 745f 7665  onfig["target_ve
-0000f5c0: 7273 696f 6e22 5d2c 205b 2270 7933 3622  rsion"], ["py36"
-0000f5d0: 2c20 2270 7933 3722 2c20 2270 7933 3822  , "py37", "py38"
-0000f5e0: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
-0000f5f0: 6173 7365 7274 4571 7561 6c28 636f 6e66  assertEqual(conf
-0000f600: 6967 5b22 7079 7468 6f6e 5f63 656c 6c5f  ig["python_cell_
-0000f610: 6d61 6769 6373 225d 2c20 5b22 6375 7374  magics"], ["cust
-0000f620: 6f6d 3122 2c20 2263 7573 746f 6d32 225d  om1", "custom2"]
-0000f630: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000f640: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
-0000f650: 675b 2265 7863 6c75 6465 225d 2c20 7222  g["exclude"], r"
-0000f660: 5c2e 7079 693f 2422 290a 2020 2020 2020  \.pyi?$").      
-0000f670: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000f680: 616c 2863 6f6e 6669 675b 2269 6e63 6c75  al(config["inclu
-0000f690: 6465 225d 2c20 7222 5c2e 7079 3f24 2229  de"], r"\.py?$")
-0000f6a0: 0a0a 2020 2020 6465 6620 7465 7374 5f73  ..    def test_s
-0000f6b0: 7065 6c6c 6368 6563 6b5f 7079 7072 6f6a  pellcheck_pyproj
-0000f6c0: 6563 745f 746f 6d6c 2873 656c 6629 202d  ect_toml(self) -
-0000f6d0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000f6e0: 7465 7374 5f74 6f6d 6c5f 6669 6c65 203d  test_toml_file =
-0000f6f0: 2054 4849 535f 4449 5220 2f20 2264 6174   THIS_DIR / "dat
-0000f700: 6122 202f 2022 696e 636f 7272 6563 745f  a" / "incorrect_
-0000f710: 7370 656c 6c69 6e67 2e74 6f6d 6c22 0a20  spelling.toml". 
-0000f720: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-0000f730: 426c 6163 6b52 756e 6e65 7228 292e 696e  BlackRunner().in
-0000f740: 766f 6b65 280a 2020 2020 2020 2020 2020  voke(.          
-0000f750: 2020 626c 6163 6b2e 6d61 696e 2c0a 2020    black.main,.  
-0000f760: 2020 2020 2020 2020 2020 5b0a 2020 2020            [.    
-0000f770: 2020 2020 2020 2020 2020 2020 222d 2d63              "--c
-0000f780: 6f64 653d 7072 696e 7428 2768 656c 6c6f  ode=print('hello
-0000f790: 2077 6f72 6c64 2729 222c 0a20 2020 2020   world')",.     
-0000f7a0: 2020 2020 2020 2020 2020 2022 2d2d 7665             "--ve
-0000f7b0: 7262 6f73 6522 2c0a 2020 2020 2020 2020  rbose",.        
-0000f7c0: 2020 2020 2020 2020 6622 2d2d 636f 6e66          f"--conf
-0000f7d0: 6967 3d7b 7374 7228 7465 7374 5f74 6f6d  ig={str(test_tom
-0000f7e0: 6c5f 6669 6c65 297d 222c 0a20 2020 2020  l_file)}",.     
-0000f7f0: 2020 2020 2020 205d 2c0a 2020 2020 2020         ],.      
-0000f800: 2020 290a 0a20 2020 2020 2020 2061 7373    )..        ass
-0000f810: 6572 7420 280a 2020 2020 2020 2020 2020  ert (.          
-0000f820: 2020 7222 496e 7661 6c69 6420 636f 6e66    r"Invalid conf
-0000f830: 6967 206b 6579 7320 6465 7465 6374 6564  ig keys detected
-0000f840: 3a20 2769 6e65 5f6c 656e 6774 6827 2c20  : 'ine_length', 
-0000f850: 2774 6172 6765 745f 6572 7369 6f6e 2720  'target_ersion' 
-0000f860: 2869 6e22 0a20 2020 2020 2020 2020 2020  (in".           
-0000f870: 2072 6622 207b 7465 7374 5f74 6f6d 6c5f   rf" {test_toml_
-0000f880: 6669 6c65 7d29 2220 696e 2072 6573 756c  file})" in resul
-0000f890: 742e 7374 6465 7272 0a20 2020 2020 2020  t.stderr.       
-0000f8a0: 2029 0a0a 2020 2020 6465 6620 7465 7374   )..    def test
-0000f8b0: 5f70 6172 7365 5f70 7970 726f 6a65 6374  _parse_pyproject
-0000f8c0: 5f74 6f6d 6c5f 7072 6f6a 6563 745f 6d65  _toml_project_me
-0000f8d0: 7461 6461 7461 2873 656c 6629 202d 3e20  tadata(self) -> 
-0000f8e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 666f  None:.        fo
-0000f8f0: 7220 7465 7374 5f74 6f6d 6c2c 2065 7870  r test_toml, exp
-0000f900: 6563 7465 6420 696e 205b 0a20 2020 2020  ected in [.     
-0000f910: 2020 2020 2020 2028 226f 6e6c 795f 626c         ("only_bl
-0000f920: 6163 6b5f 7079 7072 6f6a 6563 742e 746f  ack_pyproject.to
-0000f930: 6d6c 222c 205b 2270 7933 3130 225d 292c  ml", ["py310"]),
-0000f940: 0a20 2020 2020 2020 2020 2020 2028 226f  .            ("o
-0000f950: 6e6c 795f 6d65 7461 6461 7461 5f70 7970  nly_metadata_pyp
-0000f960: 726f 6a65 6374 2e74 6f6d 6c22 2c20 5b22  roject.toml", ["
-0000f970: 7079 3337 222c 2022 7079 3338 222c 2022  py37", "py38", "
-0000f980: 7079 3339 222c 2022 7079 3331 3022 5d29  py39", "py310"])
-0000f990: 2c0a 2020 2020 2020 2020 2020 2020 2822  ,.            ("
-0000f9a0: 6e65 6974 6865 725f 7079 7072 6f6a 6563  neither_pyprojec
-0000f9b0: 742e 746f 6d6c 222c 204e 6f6e 6529 2c0a  t.toml", None),.
-0000f9c0: 2020 2020 2020 2020 2020 2020 2822 626f              ("bo
-0000f9d0: 7468 5f70 7970 726f 6a65 6374 2e74 6f6d  th_pyproject.tom
-0000f9e0: 6c22 2c20 5b22 7079 3331 3022 5d29 2c0a  l", ["py310"]),.
-0000f9f0: 2020 2020 2020 2020 5d3a 0a20 2020 2020          ]:.     
-0000fa00: 2020 2020 2020 2074 6573 745f 746f 6d6c         test_toml
-0000fa10: 5f66 696c 6520 3d20 5448 4953 5f44 4952  _file = THIS_DIR
-0000fa20: 202f 2022 6461 7461 2220 2f20 2270 726f   / "data" / "pro
-0000fa30: 6a65 6374 5f6d 6574 6164 6174 6122 202f  ject_metadata" /
-0000fa40: 2074 6573 745f 746f 6d6c 0a20 2020 2020   test_toml.     
-0000fa50: 2020 2020 2020 2063 6f6e 6669 6720 3d20         config = 
-0000fa60: 626c 6163 6b2e 7061 7273 655f 7079 7072  black.parse_pypr
-0000fa70: 6f6a 6563 745f 746f 6d6c 2873 7472 2874  oject_toml(str(t
-0000fa80: 6573 745f 746f 6d6c 5f66 696c 6529 290a  est_toml_file)).
-0000fa90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000faa0: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
-0000fab0: 6669 672e 6765 7428 2274 6172 6765 745f  fig.get("target_
-0000fac0: 7665 7273 696f 6e22 292c 2065 7870 6563  version"), expec
-0000fad0: 7465 6429 0a0a 2020 2020 6465 6620 7465  ted)..    def te
-0000fae0: 7374 5f69 6e66 6572 5f74 6172 6765 745f  st_infer_target_
-0000faf0: 7665 7273 696f 6e28 7365 6c66 2920 2d3e  version(self) ->
-0000fb00: 204e 6f6e 653a 0a20 2020 2020 2020 2066   None:.        f
-0000fb10: 6f72 2076 6572 7369 6f6e 2c20 6578 7065  or version, expe
-0000fb20: 6374 6564 2069 6e20 5b0a 2020 2020 2020  cted in [.      
-0000fb30: 2020 2020 2020 2822 332e 3622 2c20 5b54        ("3.6", [T
-0000fb40: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
-0000fb50: 365d 292c 0a20 2020 2020 2020 2020 2020  6]),.           
-0000fb60: 2028 2233 2e31 312e 3072 6331 222c 205b   ("3.11.0rc1", [
-0000fb70: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
-0000fb80: 3331 315d 292c 0a20 2020 2020 2020 2020  311]),.         
-0000fb90: 2020 2028 223e 3d33 2e31 3022 2c20 5b54     (">=3.10", [T
-0000fba0: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
-0000fbb0: 3130 2c20 5461 7267 6574 5665 7273 696f  10, TargetVersio
-0000fbc0: 6e2e 5059 3331 312c 2054 6172 6765 7456  n.PY311, TargetV
-0000fbd0: 6572 7369 6f6e 2e50 5933 3132 5d29 2c0a  ersion.PY312]),.
-0000fbe0: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
-0000fbf0: 2020 2020 2020 2020 2020 2020 2020 223e                ">
-0000fc00: 3d33 2e31 302e 3622 2c0a 2020 2020 2020  =3.10.6",.      
-0000fc10: 2020 2020 2020 2020 2020 5b54 6172 6765            [Targe
-0000fc20: 7456 6572 7369 6f6e 2e50 5933 3130 2c20  tVersion.PY310, 
-0000fc30: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
-0000fc40: 3331 312c 2054 6172 6765 7456 6572 7369  311, TargetVersi
-0000fc50: 6f6e 2e50 5933 3132 5d2c 0a20 2020 2020  on.PY312],.     
-0000fc60: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-0000fc70: 2020 2020 2020 2822 3c33 2e36 222c 205b        ("<3.6", [
-0000fc80: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
-0000fc90: 3333 2c20 5461 7267 6574 5665 7273 696f  33, TargetVersio
-0000fca0: 6e2e 5059 3334 2c20 5461 7267 6574 5665  n.PY34, TargetVe
-0000fcb0: 7273 696f 6e2e 5059 3335 5d29 2c0a 2020  rsion.PY35]),.  
-0000fcc0: 2020 2020 2020 2020 2020 2822 3e33 2e37            (">3.7
-0000fcd0: 2c3c 332e 3130 222c 205b 5461 7267 6574  ,<3.10", [Target
-0000fce0: 5665 7273 696f 6e2e 5059 3338 2c20 5461  Version.PY38, Ta
-0000fcf0: 7267 6574 5665 7273 696f 6e2e 5059 3339  rgetVersion.PY39
-0000fd00: 5d29 2c0a 2020 2020 2020 2020 2020 2020  ]),.            
-0000fd10: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000fd20: 2020 223e 332e 372c 213d 332e 382c 213d    ">3.7,!=3.8,!=
-0000fd30: 332e 3922 2c0a 2020 2020 2020 2020 2020  3.9",.          
-0000fd40: 2020 2020 2020 5b54 6172 6765 7456 6572        [TargetVer
-0000fd50: 7369 6f6e 2e50 5933 3130 2c20 5461 7267  sion.PY310, Targ
-0000fd60: 6574 5665 7273 696f 6e2e 5059 3331 312c  etVersion.PY311,
-0000fd70: 2054 6172 6765 7456 6572 7369 6f6e 2e50   TargetVersion.P
-0000fd80: 5933 3132 5d2c 0a20 2020 2020 2020 2020  Y312],.         
-0000fd90: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
-0000fda0: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
-0000fdb0: 2020 2020 223e 2033 2e39 2e34 2c20 213d      "> 3.9.4, !=
-0000fdc0: 2033 2e31 302e 3322 2c0a 2020 2020 2020   3.10.3",.      
-0000fdd0: 2020 2020 2020 2020 2020 5b0a 2020 2020            [.    
-0000fde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fdf0: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
-0000fe00: 3339 2c0a 2020 2020 2020 2020 2020 2020  39,.            
-0000fe10: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
-0000fe20: 7273 696f 6e2e 5059 3331 302c 0a20 2020  rsion.PY310,.   
-0000fe30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe40: 2054 6172 6765 7456 6572 7369 6f6e 2e50   TargetVersion.P
-0000fe50: 5933 3131 2c0a 2020 2020 2020 2020 2020  Y311,.          
-0000fe60: 2020 2020 2020 2020 2020 5461 7267 6574            Target
-0000fe70: 5665 7273 696f 6e2e 5059 3331 322c 0a20  Version.PY312,. 
-0000fe80: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
-0000fe90: 2c0a 2020 2020 2020 2020 2020 2020 292c  ,.            ),
-0000fea0: 0a20 2020 2020 2020 2020 2020 2028 0a20  .            (. 
-0000feb0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000fec0: 213d 332e 332c 213d 332e 3422 2c0a 2020  !=3.3,!=3.4",.  
-0000fed0: 2020 2020 2020 2020 2020 2020 2020 5b0a                [.
-0000fee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fef0: 2020 2020 5461 7267 6574 5665 7273 696f      TargetVersio
-0000ff00: 6e2e 5059 3335 2c0a 2020 2020 2020 2020  n.PY35,.        
-0000ff10: 2020 2020 2020 2020 2020 2020 5461 7267              Targ
-0000ff20: 6574 5665 7273 696f 6e2e 5059 3336 2c0a  etVersion.PY36,.
-0000ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff40: 2020 2020 5461 7267 6574 5665 7273 696f      TargetVersio
-0000ff50: 6e2e 5059 3337 2c0a 2020 2020 2020 2020  n.PY37,.        
-0000ff60: 2020 2020 2020 2020 2020 2020 5461 7267              Targ
-0000ff70: 6574 5665 7273 696f 6e2e 5059 3338 2c0a  etVersion.PY38,.
-0000ff80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff90: 2020 2020 5461 7267 6574 5665 7273 696f      TargetVersio
-0000ffa0: 6e2e 5059 3339 2c0a 2020 2020 2020 2020  n.PY39,.        
-0000ffb0: 2020 2020 2020 2020 2020 2020 5461 7267              Targ
-0000ffc0: 6574 5665 7273 696f 6e2e 5059 3331 302c  etVersion.PY310,
-0000ffd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ffe0: 2020 2020 2054 6172 6765 7456 6572 7369       TargetVersi
-0000fff0: 6f6e 2e50 5933 3131 2c0a 2020 2020 2020  on.PY311,.      
-00010000: 2020 2020 2020 2020 2020 2020 2020 5461                Ta
-00010010: 7267 6574 5665 7273 696f 6e2e 5059 3331  rgetVersion.PY31
-00010020: 322c 0a20 2020 2020 2020 2020 2020 2020  2,.             
-00010030: 2020 205d 2c0a 2020 2020 2020 2020 2020     ],.          
-00010040: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
-00010050: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00010060: 2020 2022 3d3d 332e 2a22 2c0a 2020 2020     "==3.*",.    
-00010070: 2020 2020 2020 2020 2020 2020 5b0a 2020              [.  
-00010080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010090: 2020 5461 7267 6574 5665 7273 696f 6e2e    TargetVersion.
-000100a0: 5059 3333 2c0a 2020 2020 2020 2020 2020  PY33,.          
-000100b0: 2020 2020 2020 2020 2020 5461 7267 6574            Target
-000100c0: 5665 7273 696f 6e2e 5059 3334 2c0a 2020  Version.PY34,.  
-000100d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100e0: 2020 5461 7267 6574 5665 7273 696f 6e2e    TargetVersion.
-000100f0: 5059 3335 2c0a 2020 2020 2020 2020 2020  PY35,.          
-00010100: 2020 2020 2020 2020 2020 5461 7267 6574            Target
-00010110: 5665 7273 696f 6e2e 5059 3336 2c0a 2020  Version.PY36,.  
-00010120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010130: 2020 5461 7267 6574 5665 7273 696f 6e2e    TargetVersion.
-00010140: 5059 3337 2c0a 2020 2020 2020 2020 2020  PY37,.          
-00010150: 2020 2020 2020 2020 2020 5461 7267 6574            Target
-00010160: 5665 7273 696f 6e2e 5059 3338 2c0a 2020  Version.PY38,.  
-00010170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010180: 2020 5461 7267 6574 5665 7273 696f 6e2e    TargetVersion.
-00010190: 5059 3339 2c0a 2020 2020 2020 2020 2020  PY39,.          
-000101a0: 2020 2020 2020 2020 2020 5461 7267 6574            Target
-000101b0: 5665 7273 696f 6e2e 5059 3331 302c 0a20  Version.PY310,. 
-000101c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000101d0: 2020 2054 6172 6765 7456 6572 7369 6f6e     TargetVersion
-000101e0: 2e50 5933 3131 2c0a 2020 2020 2020 2020  .PY311,.        
-000101f0: 2020 2020 2020 2020 2020 2020 5461 7267              Targ
-00010200: 6574 5665 7273 696f 6e2e 5059 3331 322c  etVersion.PY312,
-00010210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010220: 205d 2c0a 2020 2020 2020 2020 2020 2020   ],.            
-00010230: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
-00010240: 223d 3d33 2e38 2e2a 222c 205b 5461 7267  "==3.8.*", [Targ
-00010250: 6574 5665 7273 696f 6e2e 5059 3338 5d29  etVersion.PY38])
-00010260: 2c0a 2020 2020 2020 2020 2020 2020 284e  ,.            (N
-00010270: 6f6e 652c 204e 6f6e 6529 2c0a 2020 2020  one, None),.    
-00010280: 2020 2020 2020 2020 2822 222c 204e 6f6e          ("", Non
-00010290: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-000102a0: 2822 696e 7661 6c69 6422 2c20 4e6f 6e65  ("invalid", None
-000102b0: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
-000102c0: 223d 3d69 6e76 616c 6964 222c 204e 6f6e  "==invalid", Non
-000102d0: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-000102e0: 2822 3e33 2e39 2c21 3d69 6e76 616c 6964  (">3.9,!=invalid
-000102f0: 222c 204e 6f6e 6529 2c0a 2020 2020 2020  ", None),.      
-00010300: 2020 2020 2020 2822 3322 2c20 4e6f 6e65        ("3", None
-00010310: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
-00010320: 2233 2e32 222c 204e 6f6e 6529 2c0a 2020  "3.2", None),.  
-00010330: 2020 2020 2020 2020 2020 2822 322e 372e            ("2.7.
-00010340: 3138 222c 204e 6f6e 6529 2c0a 2020 2020  18", None),.    
-00010350: 2020 2020 2020 2020 2822 3d3d 322e 3722          ("==2.7"
-00010360: 2c20 4e6f 6e65 292c 0a20 2020 2020 2020  , None),.       
-00010370: 2020 2020 2028 223e 332e 3130 2c3c 332e       (">3.10,<3.
-00010380: 3131 222c 204e 6f6e 6529 2c0a 2020 2020  11", None),.    
-00010390: 2020 2020 5d3a 0a20 2020 2020 2020 2020      ]:.         
-000103a0: 2020 2074 6573 745f 746f 6d6c 203d 207b     test_toml = {
-000103b0: 2270 726f 6a65 6374 223a 207b 2272 6571  "project": {"req
-000103c0: 7569 7265 732d 7079 7468 6f6e 223a 2076  uires-python": v
-000103d0: 6572 7369 6f6e 7d7d 0a20 2020 2020 2020  ersion}}.       
-000103e0: 2020 2020 2072 6573 756c 7420 3d20 626c       result = bl
-000103f0: 6163 6b2e 6669 6c65 732e 696e 6665 725f  ack.files.infer_
-00010400: 7461 7267 6574 5f76 6572 7369 6f6e 2874  target_version(t
-00010410: 6573 745f 746f 6d6c 290a 2020 2020 2020  est_toml).      
-00010420: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00010430: 7445 7175 616c 2872 6573 756c 742c 2065  tEqual(result, e
-00010440: 7870 6563 7465 6429 0a0a 2020 2020 6465  xpected)..    de
-00010450: 6620 7465 7374 5f72 6561 645f 7079 7072  f test_read_pypr
-00010460: 6f6a 6563 745f 746f 6d6c 2873 656c 6629  oject_toml(self)
-00010470: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00010480: 2020 7465 7374 5f74 6f6d 6c5f 6669 6c65    test_toml_file
-00010490: 203d 2054 4849 535f 4449 5220 2f20 2274   = THIS_DIR / "t
-000104a0: 6573 742e 746f 6d6c 220a 2020 2020 2020  est.toml".      
-000104b0: 2020 6661 6b65 5f63 7478 203d 2046 616b    fake_ctx = Fak
-000104c0: 6543 6f6e 7465 7874 2829 0a20 2020 2020  eContext().     
-000104d0: 2020 2062 6c61 636b 2e72 6561 645f 7079     black.read_py
-000104e0: 7072 6f6a 6563 745f 746f 6d6c 2866 616b  project_toml(fak
-000104f0: 655f 6374 782c 2046 616b 6550 6172 616d  e_ctx, FakeParam
-00010500: 6574 6572 2829 2c20 7374 7228 7465 7374  eter(), str(test
-00010510: 5f74 6f6d 6c5f 6669 6c65 2929 0a20 2020  _toml_file)).   
-00010520: 2020 2020 2063 6f6e 6669 6720 3d20 6661       config = fa
-00010530: 6b65 5f63 7478 2e64 6566 6175 6c74 5f6d  ke_ctx.default_m
-00010540: 6170 0a20 2020 2020 2020 2073 656c 662e  ap.        self.
-00010550: 6173 7365 7274 4571 7561 6c28 636f 6e66  assertEqual(conf
-00010560: 6967 5b22 7665 7262 6f73 6522 5d2c 2022  ig["verbose"], "
-00010570: 3122 290a 2020 2020 2020 2020 7365 6c66  1").        self
-00010580: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
-00010590: 6669 675b 2263 6865 636b 225d 2c20 226e  fig["check"], "n
-000105a0: 6f22 290a 2020 2020 2020 2020 7365 6c66  o").        self
-000105b0: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
-000105c0: 6669 675b 2264 6966 6622 5d2c 2022 7922  fig["diff"], "y"
-000105d0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000105e0: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
-000105f0: 675b 2263 6f6c 6f72 225d 2c20 2254 7275  g["color"], "Tru
-00010600: 6522 290a 2020 2020 2020 2020 7365 6c66  e").        self
-00010610: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
-00010620: 6669 675b 226c 696e 655f 6c65 6e67 7468  fig["line_length
-00010630: 225d 2c20 2237 3922 290a 2020 2020 2020  "], "79").      
-00010640: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00010650: 616c 2863 6f6e 6669 675b 2274 6172 6765  al(config["targe
-00010660: 745f 7665 7273 696f 6e22 5d2c 205b 2270  t_version"], ["p
-00010670: 7933 3622 2c20 2270 7933 3722 2c20 2270  y36", "py37", "p
-00010680: 7933 3822 5d29 0a20 2020 2020 2020 2073  y38"]).        s
-00010690: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000106a0: 636f 6e66 6967 5b22 6578 636c 7564 6522  config["exclude"
-000106b0: 5d2c 2072 225c 2e70 7969 3f24 2229 0a20  ], r"\.pyi?$"). 
-000106c0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000106d0: 7274 4571 7561 6c28 636f 6e66 6967 5b22  rtEqual(config["
-000106e0: 696e 636c 7564 6522 5d2c 2072 225c 2e70  include"], r"\.p
-000106f0: 793f 2422 290a 0a20 2020 2064 6566 2074  y?$")..    def t
-00010700: 6573 745f 7265 6164 5f70 7970 726f 6a65  est_read_pyproje
-00010710: 6374 5f74 6f6d 6c5f 6672 6f6d 5f73 7464  ct_toml_from_std
-00010720: 696e 2873 656c 6629 202d 3e20 4e6f 6e65  in(self) -> None
-00010730: 3a0a 2020 2020 2020 2020 7769 7468 2054  :.        with T
-00010740: 656d 706f 7261 7279 4469 7265 6374 6f72  emporaryDirector
-00010750: 7928 2920 6173 2077 6f72 6b73 7061 6365  y() as workspace
-00010760: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
-00010770: 6f74 203d 2050 6174 6828 776f 726b 7370  ot = Path(worksp
-00010780: 6163 6529 0a0a 2020 2020 2020 2020 2020  ace)..          
-00010790: 2020 7372 635f 6469 7220 3d20 726f 6f74    src_dir = root
-000107a0: 202f 2022 7372 6322 0a20 2020 2020 2020   / "src".       
-000107b0: 2020 2020 2073 7263 5f64 6972 2e6d 6b64       src_dir.mkd
-000107c0: 6972 2829 0a0a 2020 2020 2020 2020 2020  ir()..          
-000107d0: 2020 7372 635f 7079 7072 6f6a 6563 7420    src_pyproject 
-000107e0: 3d20 7372 635f 6469 7220 2f20 2270 7970  = src_dir / "pyp
-000107f0: 726f 6a65 6374 2e74 6f6d 6c22 0a20 2020  roject.toml".   
-00010800: 2020 2020 2020 2020 2073 7263 5f70 7970           src_pyp
-00010810: 726f 6a65 6374 2e74 6f75 6368 2829 0a0a  roject.touch()..
-00010820: 2020 2020 2020 2020 2020 2020 7465 7374              test
-00010830: 5f74 6f6d 6c5f 636f 6e74 656e 7420 3d20  _toml_content = 
-00010840: 2854 4849 535f 4449 5220 2f20 2274 6573  (THIS_DIR / "tes
-00010850: 742e 746f 6d6c 2229 2e72 6561 645f 7465  t.toml").read_te
-00010860: 7874 2865 6e63 6f64 696e 673d 2275 7466  xt(encoding="utf
-00010870: 2d38 2229 0a20 2020 2020 2020 2020 2020  -8").           
-00010880: 2073 7263 5f70 7970 726f 6a65 6374 2e77   src_pyproject.w
-00010890: 7269 7465 5f74 6578 7428 7465 7374 5f74  rite_text(test_t
-000108a0: 6f6d 6c5f 636f 6e74 656e 742c 2065 6e63  oml_content, enc
-000108b0: 6f64 696e 673d 2275 7466 2d38 2229 0a0a  oding="utf-8")..
-000108c0: 2020 2020 2020 2020 2020 2020 7372 635f              src_
-000108d0: 7079 7468 6f6e 203d 2073 7263 5f64 6972  python = src_dir
-000108e0: 202f 2022 666f 6f2e 7079 220a 2020 2020   / "foo.py".    
-000108f0: 2020 2020 2020 2020 7372 635f 7079 7468          src_pyth
-00010900: 6f6e 2e74 6f75 6368 2829 0a0a 2020 2020  on.touch()..    
-00010910: 2020 2020 2020 2020 6661 6b65 5f63 7478          fake_ctx
-00010920: 203d 2046 616b 6543 6f6e 7465 7874 2829   = FakeContext()
-00010930: 0a20 2020 2020 2020 2020 2020 2066 616b  .            fak
-00010940: 655f 6374 782e 7061 7261 6d73 5b22 7372  e_ctx.params["sr
-00010950: 6322 5d20 3d20 2822 2d22 2c29 0a20 2020  c"] = ("-",).   
-00010960: 2020 2020 2020 2020 2066 616b 655f 6374           fake_ct
-00010970: 782e 7061 7261 6d73 5b22 7374 6469 6e5f  x.params["stdin_
-00010980: 6669 6c65 6e61 6d65 225d 203d 2073 7472  filename"] = str
-00010990: 2873 7263 5f70 7974 686f 6e29 0a0a 2020  (src_python)..  
-000109a0: 2020 2020 2020 2020 2020 7769 7468 2063            with c
-000109b0: 6861 6e67 655f 6469 7265 6374 6f72 7928  hange_directory(
-000109c0: 726f 6f74 293a 0a20 2020 2020 2020 2020  root):.         
-000109d0: 2020 2020 2020 2062 6c61 636b 2e72 6561         black.rea
-000109e0: 645f 7079 7072 6f6a 6563 745f 746f 6d6c  d_pyproject_toml
-000109f0: 2866 616b 655f 6374 782c 2046 616b 6550  (fake_ctx, FakeP
-00010a00: 6172 616d 6574 6572 2829 2c20 4e6f 6e65  arameter(), None
-00010a10: 290a 0a20 2020 2020 2020 2020 2020 2063  )..            c
-00010a20: 6f6e 6669 6720 3d20 6661 6b65 5f63 7478  onfig = fake_ctx
-00010a30: 2e64 6566 6175 6c74 5f6d 6170 0a20 2020  .default_map.   
-00010a40: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00010a50: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
-00010a60: 5b22 7665 7262 6f73 6522 5d2c 2022 3122  ["verbose"], "1"
-00010a70: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00010a80: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-00010a90: 6f6e 6669 675b 2263 6865 636b 225d 2c20  onfig["check"], 
-00010aa0: 226e 6f22 290a 2020 2020 2020 2020 2020  "no").          
-00010ab0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00010ac0: 616c 2863 6f6e 6669 675b 2264 6966 6622  al(config["diff"
-00010ad0: 5d2c 2022 7922 290a 2020 2020 2020 2020  ], "y").        
-00010ae0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00010af0: 7175 616c 2863 6f6e 6669 675b 2263 6f6c  qual(config["col
-00010b00: 6f72 225d 2c20 2254 7275 6522 290a 2020  or"], "True").  
-00010b10: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00010b20: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
-00010b30: 675b 226c 696e 655f 6c65 6e67 7468 225d  g["line_length"]
-00010b40: 2c20 2237 3922 290a 2020 2020 2020 2020  , "79").        
-00010b50: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00010b60: 7175 616c 2863 6f6e 6669 675b 2274 6172  qual(config["tar
-00010b70: 6765 745f 7665 7273 696f 6e22 5d2c 205b  get_version"], [
-00010b80: 2270 7933 3622 2c20 2270 7933 3722 2c20  "py36", "py37", 
-00010b90: 2270 7933 3822 5d29 0a20 2020 2020 2020  "py38"]).       
-00010ba0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00010bb0: 4571 7561 6c28 636f 6e66 6967 5b22 6578  Equal(config["ex
-00010bc0: 636c 7564 6522 5d2c 2072 225c 2e70 7969  clude"], r"\.pyi
-00010bd0: 3f24 2229 0a20 2020 2020 2020 2020 2020  ?$").           
-00010be0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00010bf0: 6c28 636f 6e66 6967 5b22 696e 636c 7564  l(config["includ
-00010c00: 6522 5d2c 2072 225c 2e70 793f 2422 290a  e"], r"\.py?$").
-00010c10: 0a20 2020 2040 7079 7465 7374 2e6d 6172  .    @pytest.mar
-00010c20: 6b2e 696e 636f 6d70 6174 6962 6c65 5f77  k.incompatible_w
-00010c30: 6974 685f 6d79 7079 630a 2020 2020 6465  ith_mypyc.    de
-00010c40: 6620 7465 7374 5f66 696e 645f 7072 6f6a  f test_find_proj
-00010c50: 6563 745f 726f 6f74 2873 656c 6629 202d  ect_root(self) -
-00010c60: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00010c70: 7769 7468 2054 656d 706f 7261 7279 4469  with TemporaryDi
-00010c80: 7265 6374 6f72 7928 2920 6173 2077 6f72  rectory() as wor
-00010c90: 6b73 7061 6365 3a0a 2020 2020 2020 2020  kspace:.        
-00010ca0: 2020 2020 726f 6f74 203d 2050 6174 6828      root = Path(
-00010cb0: 776f 726b 7370 6163 6529 0a20 2020 2020  workspace).     
-00010cc0: 2020 2020 2020 2074 6573 745f 6469 7220         test_dir 
-00010cd0: 3d20 726f 6f74 202f 2022 7465 7374 220a  = root / "test".
-00010ce0: 2020 2020 2020 2020 2020 2020 7465 7374              test
-00010cf0: 5f64 6972 2e6d 6b64 6972 2829 0a0a 2020  _dir.mkdir()..  
-00010d00: 2020 2020 2020 2020 2020 7372 635f 6469            src_di
-00010d10: 7220 3d20 726f 6f74 202f 2022 7372 6322  r = root / "src"
-00010d20: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
-00010d30: 5f64 6972 2e6d 6b64 6972 2829 0a0a 2020  _dir.mkdir()..  
-00010d40: 2020 2020 2020 2020 2020 726f 6f74 5f70            root_p
-00010d50: 7970 726f 6a65 6374 203d 2072 6f6f 7420  yproject = root 
-00010d60: 2f20 2270 7970 726f 6a65 6374 2e74 6f6d  / "pyproject.tom
-00010d70: 6c22 0a20 2020 2020 2020 2020 2020 2072  l".            r
-00010d80: 6f6f 745f 7079 7072 6f6a 6563 742e 7772  oot_pyproject.wr
-00010d90: 6974 655f 7465 7874 2822 5b74 6f6f 6c2e  ite_text("[tool.
-00010da0: 626c 6163 6b5d 222c 2065 6e63 6f64 696e  black]", encodin
-00010db0: 673d 2275 7466 2d38 2229 0a20 2020 2020  g="utf-8").     
-00010dc0: 2020 2020 2020 2073 7263 5f70 7970 726f         src_pypro
-00010dd0: 6a65 6374 203d 2073 7263 5f64 6972 202f  ject = src_dir /
-00010de0: 2022 7079 7072 6f6a 6563 742e 746f 6d6c   "pyproject.toml
-00010df0: 220a 2020 2020 2020 2020 2020 2020 7372  ".            sr
-00010e00: 635f 7079 7072 6f6a 6563 742e 7772 6974  c_pyproject.writ
-00010e10: 655f 7465 7874 2822 5b74 6f6f 6c2e 626c  e_text("[tool.bl
-00010e20: 6163 6b5d 222c 2065 6e63 6f64 696e 673d  ack]", encoding=
-00010e30: 2275 7466 2d38 2229 0a20 2020 2020 2020  "utf-8").       
-00010e40: 2020 2020 2073 7263 5f70 7974 686f 6e20       src_python 
-00010e50: 3d20 7372 635f 6469 7220 2f20 2266 6f6f  = src_dir / "foo
-00010e60: 2e70 7922 0a20 2020 2020 2020 2020 2020  .py".           
-00010e70: 2073 7263 5f70 7974 686f 6e2e 746f 7563   src_python.touc
-00010e80: 6828 290a 0a20 2020 2020 2020 2020 2020  h()..           
-00010e90: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00010ea0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-00010eb0: 2020 2062 6c61 636b 2e66 696e 645f 7072     black.find_pr
-00010ec0: 6f6a 6563 745f 726f 6f74 2828 7372 635f  oject_root((src_
-00010ed0: 6469 722c 2074 6573 745f 6469 7229 292c  dir, test_dir)),
-00010ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010ef0: 2028 726f 6f74 2e72 6573 6f6c 7665 2829   (root.resolve()
-00010f00: 2c20 2270 7970 726f 6a65 6374 2e74 6f6d  , "pyproject.tom
-00010f10: 6c22 292c 0a20 2020 2020 2020 2020 2020  l"),.           
-00010f20: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
-00010f30: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00010f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010f50: 2062 6c61 636b 2e66 696e 645f 7072 6f6a   black.find_proj
-00010f60: 6563 745f 726f 6f74 2828 7372 635f 6469  ect_root((src_di
-00010f70: 722c 2929 2c0a 2020 2020 2020 2020 2020  r,)),.          
-00010f80: 2020 2020 2020 2873 7263 5f64 6972 2e72        (src_dir.r
-00010f90: 6573 6f6c 7665 2829 2c20 2270 7970 726f  esolve(), "pypro
-00010fa0: 6a65 6374 2e74 6f6d 6c22 292c 0a20 2020  ject.toml"),.   
-00010fb0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00010fc0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00010fd0: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
-00010fe0: 2020 2020 2020 2020 2062 6c61 636b 2e66           black.f
-00010ff0: 696e 645f 7072 6f6a 6563 745f 726f 6f74  ind_project_root
-00011000: 2828 7372 635f 7079 7468 6f6e 2c29 292c  ((src_python,)),
-00011010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011020: 2028 7372 635f 6469 722e 7265 736f 6c76   (src_dir.resolv
-00011030: 6528 292c 2022 7079 7072 6f6a 6563 742e  e(), "pyproject.
-00011040: 746f 6d6c 2229 2c0a 2020 2020 2020 2020  toml"),.        
-00011050: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-00011060: 2020 2077 6974 6820 6368 616e 6765 5f64     with change_d
-00011070: 6972 6563 746f 7279 2874 6573 745f 6469  irectory(test_di
-00011080: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00011090: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000110a0: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-000110b0: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
-000110c0: 6669 6e64 5f70 726f 6a65 6374 5f72 6f6f  find_project_roo
-000110d0: 7428 2822 2d22 2c29 2c20 7374 6469 6e5f  t(("-",), stdin_
-000110e0: 6669 6c65 6e61 6d65 3d22 2e2e 2f73 7263  filename="../src
-000110f0: 2f61 2e70 7922 292c 0a20 2020 2020 2020  /a.py"),.       
-00011100: 2020 2020 2020 2020 2020 2020 2028 7372               (sr
-00011110: 635f 6469 722e 7265 736f 6c76 6528 292c  c_dir.resolve(),
-00011120: 2022 7079 7072 6f6a 6563 742e 746f 6d6c   "pyproject.toml
-00011130: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-00011140: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-00011150: 2020 2073 7263 5f73 7562 203d 2073 7263     src_sub = src
-00011160: 5f64 6972 202f 2022 7375 6222 0a20 2020  _dir / "sub".   
-00011170: 2020 2020 2020 2020 2073 7263 5f73 7562           src_sub
-00011180: 2e6d 6b64 6972 2829 0a0a 2020 2020 2020  .mkdir()..      
-00011190: 2020 2020 2020 7372 635f 7375 625f 7079        src_sub_py
-000111a0: 7072 6f6a 6563 7420 3d20 7372 635f 7375  project = src_su
-000111b0: 6220 2f20 2270 7970 726f 6a65 6374 2e74  b / "pyproject.t
-000111c0: 6f6d 6c22 0a20 2020 2020 2020 2020 2020  oml".           
-000111d0: 2073 7263 5f73 7562 5f70 7970 726f 6a65   src_sub_pyproje
-000111e0: 6374 2e74 6f75 6368 2829 2020 2320 656d  ct.touch()  # em
-000111f0: 7074 790a 0a20 2020 2020 2020 2020 2020  pty..           
-00011200: 2073 7263 5f73 7562 5f70 7974 686f 6e20   src_sub_python 
-00011210: 3d20 7372 635f 7375 6220 2f20 2262 6172  = src_sub / "bar
-00011220: 2e70 7922 0a0a 2020 2020 2020 2020 2020  .py"..          
-00011230: 2020 2320 7765 2073 6b69 7020 7372 635f    # we skip src_
-00011240: 7375 625f 7079 7072 6f6a 6563 7420 7369  sub_pyproject si
-00011250: 6e63 6520 6974 2069 7320 6d69 7373 696e  nce it is missin
-00011260: 6720 7468 6520 5b74 6f6f 6c2e 626c 6163  g the [tool.blac
-00011270: 6b5d 2073 6563 7469 6f6e 0a20 2020 2020  k] section.     
-00011280: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00011290: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
-000112a0: 2020 2020 2020 2020 2062 6c61 636b 2e66           black.f
-000112b0: 696e 645f 7072 6f6a 6563 745f 726f 6f74  ind_project_root
-000112c0: 2828 7372 635f 7375 625f 7079 7468 6f6e  ((src_sub_python
-000112d0: 2c29 292c 0a20 2020 2020 2020 2020 2020  ,)),.           
-000112e0: 2020 2020 2028 7372 635f 6469 722e 7265       (src_dir.re
-000112f0: 736f 6c76 6528 292c 2022 7079 7072 6f6a  solve(), "pyproj
-00011300: 6563 742e 746f 6d6c 2229 2c0a 2020 2020  ect.toml"),.    
-00011310: 2020 2020 2020 2020 290a 0a20 2020 2040          )..    @
-00011320: 7061 7463 6828 0a20 2020 2020 2020 2022  patch(.        "
-00011330: 626c 6163 6b2e 6669 6c65 732e 6669 6e64  black.files.find
-00011340: 5f75 7365 725f 7079 7072 6f6a 6563 745f  _user_pyproject_
-00011350: 746f 6d6c 222c 0a20 2020 2029 0a20 2020  toml",.    ).   
-00011360: 2064 6566 2074 6573 745f 6669 6e64 5f70   def test_find_p
-00011370: 7970 726f 6a65 6374 5f74 6f6d 6c28 7365  yproject_toml(se
-00011380: 6c66 2c20 6669 6e64 5f75 7365 725f 7079  lf, find_user_py
-00011390: 7072 6f6a 6563 745f 746f 6d6c 3a20 4d61  project_toml: Ma
-000113a0: 6769 634d 6f63 6b29 202d 3e20 4e6f 6e65  gicMock) -> None
-000113b0: 3a0a 2020 2020 2020 2020 6669 6e64 5f75  :.        find_u
-000113c0: 7365 725f 7079 7072 6f6a 6563 745f 746f  ser_pyproject_to
-000113d0: 6d6c 2e73 6964 655f 6566 6665 6374 203d  ml.side_effect =
-000113e0: 2052 756e 7469 6d65 4572 726f 7228 290a   RuntimeError().
-000113f0: 0a20 2020 2020 2020 2077 6974 6820 7265  .        with re
-00011400: 6469 7265 6374 5f73 7464 6572 7228 696f  direct_stderr(io
-00011410: 2e53 7472 696e 6749 4f28 2929 2061 7320  .StringIO()) as 
-00011420: 7374 6465 7272 3a0a 2020 2020 2020 2020  stderr:.        
-00011430: 2020 2020 7265 7375 6c74 203d 2062 6c61      result = bla
-00011440: 636b 2e66 696c 6573 2e66 696e 645f 7079  ck.files.find_py
-00011450: 7072 6f6a 6563 745f 746f 6d6c 280a 2020  project_toml(.  
-00011460: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00011470: 7468 5f73 6561 7263 685f 7374 6172 743d  th_search_start=
-00011480: 2873 7472 2850 6174 682e 6377 6428 292e  (str(Path.cwd().
-00011490: 726f 6f74 292c 290a 2020 2020 2020 2020  root),).        
-000114a0: 2020 2020 290a 0a20 2020 2020 2020 2061      )..        a
-000114b0: 7373 6572 7420 7265 7375 6c74 2069 7320  ssert result is 
-000114c0: 4e6f 6e65 0a20 2020 2020 2020 2065 7272  None.        err
-000114d0: 203d 2073 7464 6572 722e 6765 7476 616c   = stderr.getval
-000114e0: 7565 2829 0a20 2020 2020 2020 2061 7373  ue().        ass
-000114f0: 6572 7420 2249 676e 6f72 696e 6720 7573  ert "Ignoring us
-00011500: 6572 2063 6f6e 6669 6775 7261 7469 6f6e  er configuration
-00011510: 2220 696e 2065 7272 0a0a 2020 2020 4070  " in err..    @p
-00011520: 6174 6368 280a 2020 2020 2020 2020 2262  atch(.        "b
-00011530: 6c61 636b 2e66 696c 6573 2e66 696e 645f  lack.files.find_
-00011540: 7573 6572 5f70 7970 726f 6a65 6374 5f74  user_pyproject_t
-00011550: 6f6d 6c22 2c0a 2020 2020 2020 2020 626c  oml",.        bl
-00011560: 6163 6b2e 6669 6c65 732e 6669 6e64 5f75  ack.files.find_u
-00011570: 7365 725f 7079 7072 6f6a 6563 745f 746f  ser_pyproject_to
-00011580: 6d6c 2e5f 5f77 7261 7070 6564 5f5f 2c0a  ml.__wrapped__,.
-00011590: 2020 2020 290a 2020 2020 6465 6620 7465      ).    def te
-000115a0: 7374 5f66 696e 645f 7573 6572 5f70 7970  st_find_user_pyp
-000115b0: 726f 6a65 6374 5f74 6f6d 6c5f 6c69 6e75  roject_toml_linu
-000115c0: 7828 7365 6c66 2920 2d3e 204e 6f6e 653a  x(self) -> None:
-000115d0: 0a20 2020 2020 2020 2069 6620 7379 7374  .        if syst
-000115e0: 656d 2829 203d 3d20 2257 696e 646f 7773  em() == "Windows
-000115f0: 223a 0a20 2020 2020 2020 2020 2020 2072  ":.            r
-00011600: 6574 7572 6e0a 0a20 2020 2020 2020 2023  eturn..        #
-00011610: 2054 6573 7420 6966 2058 4447 5f43 4f4e   Test if XDG_CON
-00011620: 4649 475f 484f 4d45 2069 7320 6368 6563  FIG_HOME is chec
-00011630: 6b65 640a 2020 2020 2020 2020 7769 7468  ked.        with
-00011640: 2054 656d 706f 7261 7279 4469 7265 6374   TemporaryDirect
-00011650: 6f72 7928 2920 6173 2077 6f72 6b73 7061  ory() as workspa
-00011660: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-00011670: 746d 705f 7573 6572 5f63 6f6e 6669 6720  tmp_user_config 
-00011680: 3d20 5061 7468 2877 6f72 6b73 7061 6365  = Path(workspace
-00011690: 2920 2f20 2262 6c61 636b 220a 2020 2020  ) / "black".    
-000116a0: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
-000116b0: 6368 2e64 6963 7428 226f 732e 656e 7669  ch.dict("os.envi
-000116c0: 726f 6e22 2c20 7b22 5844 475f 434f 4e46  ron", {"XDG_CONF
-000116d0: 4947 5f48 4f4d 4522 3a20 776f 726b 7370  IG_HOME": worksp
-000116e0: 6163 657d 293a 0a20 2020 2020 2020 2020  ace}):.         
-000116f0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00011700: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
-00011710: 2020 2020 2020 2020 2020 2020 2062 6c61               bla
-00011720: 636b 2e66 696c 6573 2e66 696e 645f 7573  ck.files.find_us
-00011730: 6572 5f70 7970 726f 6a65 6374 5f74 6f6d  er_pyproject_tom
-00011740: 6c28 292c 2074 6d70 5f75 7365 725f 636f  l(), tmp_user_co
-00011750: 6e66 6967 2e72 6573 6f6c 7665 2829 0a20  nfig.resolve(). 
-00011760: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00011770: 0a0a 2020 2020 2020 2020 2320 5465 7374  ..        # Test
-00011780: 2066 616c 6c62 6163 6b20 666f 7220 5844   fallback for XD
-00011790: 475f 434f 4e46 4947 5f48 4f4d 450a 2020  G_CONFIG_HOME.  
-000117a0: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
-000117b0: 2e64 6963 7428 226f 732e 656e 7669 726f  .dict("os.enviro
-000117c0: 6e22 293a 0a20 2020 2020 2020 2020 2020  n"):.           
-000117d0: 206f 732e 656e 7669 726f 6e2e 706f 7028   os.environ.pop(
-000117e0: 2258 4447 5f43 4f4e 4649 475f 484f 4d45  "XDG_CONFIG_HOME
-000117f0: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
-00011800: 2020 2020 2066 616c 6c62 6163 6b5f 7573       fallback_us
-00011810: 6572 5f63 6f6e 6669 6720 3d20 5061 7468  er_config = Path
-00011820: 2822 7e2f 2e63 6f6e 6669 6722 292e 6578  ("~/.config").ex
-00011830: 7061 6e64 7573 6572 2829 202f 2022 626c  panduser() / "bl
-00011840: 6163 6b22 0a20 2020 2020 2020 2020 2020  ack".           
-00011850: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00011860: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-00011870: 2020 2062 6c61 636b 2e66 696c 6573 2e66     black.files.f
-00011880: 696e 645f 7573 6572 5f70 7970 726f 6a65  ind_user_pyproje
-00011890: 6374 5f74 6f6d 6c28 292c 2066 616c 6c62  ct_toml(), fallb
-000118a0: 6163 6b5f 7573 6572 5f63 6f6e 6669 672e  ack_user_config.
-000118b0: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
-000118c0: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-000118d0: 2074 6573 745f 6669 6e64 5f75 7365 725f   test_find_user_
-000118e0: 7079 7072 6f6a 6563 745f 746f 6d6c 5f77  pyproject_toml_w
-000118f0: 696e 646f 7773 2873 656c 6629 202d 3e20  indows(self) -> 
-00011900: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
-00011910: 2073 7973 7465 6d28 2920 213d 2022 5769   system() != "Wi
-00011920: 6e64 6f77 7322 3a0a 2020 2020 2020 2020  ndows":.        
-00011930: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00011940: 2020 2020 7573 6572 5f63 6f6e 6669 675f      user_config_
-00011950: 7061 7468 203d 2050 6174 682e 686f 6d65  path = Path.home
-00011960: 2829 202f 2022 2e62 6c61 636b 220a 2020  () / ".black".  
-00011970: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00011980: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
-00011990: 2020 2020 626c 6163 6b2e 6669 6c65 732e      black.files.
-000119a0: 6669 6e64 5f75 7365 725f 7079 7072 6f6a  find_user_pyproj
-000119b0: 6563 745f 746f 6d6c 2829 2c20 7573 6572  ect_toml(), user
-000119c0: 5f63 6f6e 6669 675f 7061 7468 2e72 6573  _config_path.res
-000119d0: 6f6c 7665 2829 0a20 2020 2020 2020 2029  olve().        )
-000119e0: 0a0a 2020 2020 6465 6620 7465 7374 5f62  ..    def test_b
-000119f0: 706f 5f33 3336 3630 5f77 6f72 6b61 726f  po_33660_workaro
-00011a00: 756e 6428 7365 6c66 2920 2d3e 204e 6f6e  und(self) -> Non
-00011a10: 653a 0a20 2020 2020 2020 2069 6620 7379  e:.        if sy
-00011a20: 7374 656d 2829 203d 3d20 2257 696e 646f  stem() == "Windo
-00011a30: 7773 223a 0a20 2020 2020 2020 2020 2020  ws":.           
-00011a40: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
-00011a50: 2023 2068 7474 7073 3a2f 2f62 7567 732e   # https://bugs.
-00011a60: 7079 7468 6f6e 2e6f 7267 2f69 7373 7565  python.org/issue
-00011a70: 3333 3636 300a 2020 2020 2020 2020 2320  33660.        # 
-00011a80: 4361 6e20 6265 2072 656d 6f76 6564 2077  Can be removed w
-00011a90: 6865 6e20 7765 2064 726f 7020 7375 7070  hen we drop supp
-00011aa0: 6f72 7420 666f 7220 5079 7468 6f6e 2033  ort for Python 3
-00011ab0: 2e38 2e35 0a20 2020 2020 2020 2072 6f6f  .8.5.        roo
-00011ac0: 7420 3d20 5061 7468 2822 2f22 290a 2020  t = Path("/").  
-00011ad0: 2020 2020 2020 7769 7468 2063 6861 6e67        with chang
-00011ae0: 655f 6469 7265 6374 6f72 7928 726f 6f74  e_directory(root
-00011af0: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-00011b00: 6174 6820 3d20 5061 7468 2822 776f 726b  ath = Path("work
-00011b10: 7370 6163 6522 2920 2f20 2270 726f 6a65  space") / "proje
-00011b20: 6374 220a 2020 2020 2020 2020 2020 2020  ct".            
-00011b30: 7265 706f 7274 203d 2062 6c61 636b 2e52  report = black.R
-00011b40: 6570 6f72 7428 7665 7262 6f73 653d 5472  eport(verbose=Tr
-00011b50: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00011b60: 7265 736f 6c76 6573 5f6f 7574 7369 6465  resolves_outside
-00011b70: 203d 2062 6c61 636b 2e72 6573 6f6c 7665   = black.resolve
-00011b80: 735f 6f75 7473 6964 655f 726f 6f74 5f6f  s_outside_root_o
-00011b90: 725f 6361 6e6e 6f74 5f73 7461 7428 0a20  r_cannot_stat(. 
-00011ba0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00011bb0: 6174 682c 2072 6f6f 742c 2072 6570 6f72  ath, root, repor
-00011bc0: 740a 2020 2020 2020 2020 2020 2020 290a  t.            ).
-00011bd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00011be0: 2e61 7373 6572 7449 7328 7265 736f 6c76  .assertIs(resolv
-00011bf0: 6573 5f6f 7574 7369 6465 2c20 4661 6c73  es_outside, Fals
-00011c00: 6529 0a0a 2020 2020 6465 6620 7465 7374  e)..    def test
-00011c10: 5f6e 6f72 6d61 6c69 7a65 5f70 6174 685f  _normalize_path_
-00011c20: 6967 6e6f 7265 5f77 696e 646f 7773 5f6a  ignore_windows_j
-00011c30: 756e 6374 696f 6e73 5f6f 7574 7369 6465  unctions_outside
-00011c40: 5f6f 665f 726f 6f74 2873 656c 6629 202d  _of_root(self) -
-00011c50: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00011c60: 6966 2073 7973 7465 6d28 2920 213d 2022  if system() != "
-00011c70: 5769 6e64 6f77 7322 3a0a 2020 2020 2020  Windows":.      
-00011c80: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-00011c90: 2020 2020 2020 7769 7468 2054 656d 706f        with Tempo
-00011ca0: 7261 7279 4469 7265 6374 6f72 7928 2920  raryDirectory() 
-00011cb0: 6173 2077 6f72 6b73 7061 6365 3a0a 2020  as workspace:.  
-00011cc0: 2020 2020 2020 2020 2020 726f 6f74 203d            root =
-00011cd0: 2050 6174 6828 776f 726b 7370 6163 6529   Path(workspace)
-00011ce0: 0a20 2020 2020 2020 2020 2020 206a 756e  .            jun
-00011cf0: 6374 696f 6e5f 6469 7220 3d20 726f 6f74  ction_dir = root
-00011d00: 202f 2022 6a75 6e63 7469 6f6e 220a 2020   / "junction".  
-00011d10: 2020 2020 2020 2020 2020 6a75 6e63 7469            juncti
-00011d20: 6f6e 5f74 6172 6765 745f 6f75 7473 6964  on_target_outsid
-00011d30: 655f 6f66 5f72 6f6f 7420 3d20 726f 6f74  e_of_root = root
-00011d40: 202f 2022 2e2e 220a 2020 2020 2020 2020   / "..".        
-00011d50: 2020 2020 6f73 2e73 7973 7465 6d28 6622      os.system(f"
-00011d60: 6d6b 6c69 6e6b 202f 4a20 7b6a 756e 6374  mklink /J {junct
-00011d70: 696f 6e5f 6469 727d 207b 6a75 6e63 7469  ion_dir} {juncti
-00011d80: 6f6e 5f74 6172 6765 745f 6f75 7473 6964  on_target_outsid
-00011d90: 655f 6f66 5f72 6f6f 747d 2229 0a0a 2020  e_of_root}")..  
-00011da0: 2020 2020 2020 2020 2020 7265 706f 7274            report
-00011db0: 203d 2062 6c61 636b 2e52 6570 6f72 7428   = black.Report(
-00011dc0: 7665 7262 6f73 653d 5472 7565 290a 2020  verbose=True).  
-00011dd0: 2020 2020 2020 2020 2020 7265 736f 6c76            resolv
-00011de0: 6573 5f6f 7574 7369 6465 203d 2062 6c61  es_outside = bla
-00011df0: 636b 2e72 6573 6f6c 7665 735f 6f75 7473  ck.resolves_outs
-00011e00: 6964 655f 726f 6f74 5f6f 725f 6361 6e6e  ide_root_or_cann
-00011e10: 6f74 5f73 7461 7428 0a20 2020 2020 2020  ot_stat(.       
-00011e20: 2020 2020 2020 2020 206a 756e 6374 696f           junctio
-00011e30: 6e5f 6469 722c 2072 6f6f 742c 2072 6570  n_dir, root, rep
-00011e40: 6f72 740a 2020 2020 2020 2020 2020 2020  ort.            
-00011e50: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-00011e60: 4d61 6e75 616c 6c79 2064 656c 6574 6520  Manually delete 
-00011e70: 666f 7220 5079 7468 6f6e 203c 2033 2e38  for Python < 3.8
-00011e80: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
-00011e90: 7379 7374 656d 2866 2272 6d64 6972 207b  system(f"rmdir {
-00011ea0: 6a75 6e63 7469 6f6e 5f64 6972 7d22 290a  junction_dir}").
-00011eb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00011ec0: 662e 6173 7365 7274 4973 2872 6573 6f6c  f.assertIs(resol
-00011ed0: 7665 735f 6f75 7473 6964 652c 2054 7275  ves_outside, Tru
-00011ee0: 6529 0a0a 2020 2020 6465 6620 7465 7374  e)..    def test
-00011ef0: 5f6e 6577 6c69 6e65 5f63 6f6d 6d65 6e74  _newline_comment
-00011f00: 5f69 6e74 6572 6163 7469 6f6e 2873 656c  _interaction(sel
-00011f10: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00011f20: 2020 2020 736f 7572 6365 203d 2022 636c      source = "cl
-00011f30: 6173 7320 413a 5c5c 5c72 5c6e 2320 7479  ass A:\\\r\n# ty
-00011f40: 7065 3a20 6967 6e6f 7265 5c6e 2070 6173  pe: ignore\n pas
-00011f50: 735c 6e22 0a20 2020 2020 2020 206f 7574  s\n".        out
-00011f60: 7075 7420 3d20 626c 6163 6b2e 666f 726d  put = black.form
-00011f70: 6174 5f73 7472 2873 6f75 7263 652c 206d  at_str(source, m
-00011f80: 6f64 653d 4445 4641 554c 545f 4d4f 4445  ode=DEFAULT_MODE
-00011f90: 290a 2020 2020 2020 2020 626c 6163 6b2e  ).        black.
-00011fa0: 6173 7365 7274 5f73 7461 626c 6528 736f  assert_stable(so
-00011fb0: 7572 6365 2c20 6f75 7470 7574 2c20 6d6f  urce, output, mo
-00011fc0: 6465 3d44 4546 4155 4c54 5f4d 4f44 4529  de=DEFAULT_MODE)
-00011fd0: 0a0a 2020 2020 6465 6620 7465 7374 5f62  ..    def test_b
-00011fe0: 706f 5f32 3134 325f 776f 726b 6172 6f75  po_2142_workarou
-00011ff0: 6e64 2873 656c 6629 202d 3e20 4e6f 6e65  nd(self) -> None
-00012000: 3a0a 2020 2020 2020 2020 2320 6874 7470  :.        # http
-00012010: 733a 2f2f 6275 6773 2e70 7974 686f 6e2e  s://bugs.python.
-00012020: 6f72 672f 6973 7375 6532 3134 320a 0a20  org/issue2142.. 
-00012030: 2020 2020 2020 2073 6f75 7263 652c 205f         source, _
-00012040: 203d 2072 6561 645f 6461 7461 2822 6d69   = read_data("mi
-00012050: 7363 656c 6c61 6e65 6f75 7322 2c20 226d  scellaneous", "m
-00012060: 6973 7369 6e67 5f66 696e 616c 5f6e 6577  issing_final_new
-00012070: 6c69 6e65 2229 0a20 2020 2020 2020 2023  line").        #
-00012080: 2072 6561 645f 6461 7461 2061 6464 7320   read_data adds 
-00012090: 6120 7472 6169 6c69 6e67 206e 6577 6c69  a trailing newli
-000120a0: 6e65 0a20 2020 2020 2020 2073 6f75 7263  ne.        sourc
-000120b0: 6520 3d20 736f 7572 6365 2e72 7374 7269  e = source.rstri
-000120c0: 7028 290a 2020 2020 2020 2020 6578 7065  p().        expe
-000120d0: 6374 6564 2c20 5f20 3d20 7265 6164 5f64  cted, _ = read_d
-000120e0: 6174 6128 226d 6973 6365 6c6c 616e 656f  ata("miscellaneo
-000120f0: 7573 222c 2022 6d69 7373 696e 675f 6669  us", "missing_fi
-00012100: 6e61 6c5f 6e65 776c 696e 652e 6469 6666  nal_newline.diff
-00012110: 2229 0a20 2020 2020 2020 2074 6d70 5f66  ").        tmp_f
-00012120: 696c 6520 3d20 5061 7468 2862 6c61 636b  ile = Path(black
-00012130: 2e64 756d 705f 746f 5f66 696c 6528 736f  .dump_to_file(so
-00012140: 7572 6365 2c20 656e 7375 7265 5f66 696e  urce, ensure_fin
-00012150: 616c 5f6e 6577 6c69 6e65 3d46 616c 7365  al_newline=False
-00012160: 2929 0a20 2020 2020 2020 2064 6966 665f  )).        diff_
-00012170: 6865 6164 6572 203d 2072 652e 636f 6d70  header = re.comp
-00012180: 696c 6528 0a20 2020 2020 2020 2020 2020  ile(.           
-00012190: 2072 6622 7b72 652e 6573 6361 7065 2873   rf"{re.escape(s
-000121a0: 7472 2874 6d70 5f66 696c 6529 297d 5c74  tr(tmp_file))}\t
-000121b0: 5c64 5c64 5c64 5c64 2d5c 645c 642d 5c64  \d\d\d\d-\d\d-\d
-000121c0: 5c64 2022 0a20 2020 2020 2020 2020 2020  \d ".           
-000121d0: 2072 225c 645c 643a 5c64 5c64 3a5c 645c   r"\d\d:\d\d:\d\
-000121e0: 645c 2e5c 645c 645c 645c 645c 645c 645c  d\.\d\d\d\d\d\d\
-000121f0: 2b5c 645c 643a 5c64 5c64 220a 2020 2020  +\d\d:\d\d".    
-00012200: 2020 2020 290a 2020 2020 2020 2020 7472      ).        tr
-00012210: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
-00012220: 6573 756c 7420 3d20 426c 6163 6b52 756e  esult = BlackRun
-00012230: 6e65 7228 292e 696e 766f 6b65 2862 6c61  ner().invoke(bla
-00012240: 636b 2e6d 6169 6e2c 205b 222d 2d64 6966  ck.main, ["--dif
-00012250: 6622 2c20 7374 7228 746d 705f 6669 6c65  f", str(tmp_file
-00012260: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
-00012270: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00012280: 2872 6573 756c 742e 6578 6974 5f63 6f64  (result.exit_cod
-00012290: 652c 2030 290a 2020 2020 2020 2020 6669  e, 0).        fi
-000122a0: 6e61 6c6c 793a 0a20 2020 2020 2020 2020  nally:.         
-000122b0: 2020 206f 732e 756e 6c69 6e6b 2874 6d70     os.unlink(tmp
-000122c0: 5f66 696c 6529 0a20 2020 2020 2020 2061  _file).        a
-000122d0: 6374 7561 6c20 3d20 7265 7375 6c74 2e6f  ctual = result.o
-000122e0: 7574 7075 740a 2020 2020 2020 2020 6163  utput.        ac
-000122f0: 7475 616c 203d 2064 6966 665f 6865 6164  tual = diff_head
-00012300: 6572 2e73 7562 2844 4554 4552 4d49 4e49  er.sub(DETERMINI
-00012310: 5354 4943 5f48 4541 4445 522c 2061 6374  STIC_HEADER, act
-00012320: 7561 6c29 0a20 2020 2020 2020 2073 656c  ual).        sel
-00012330: 662e 6173 7365 7274 4571 7561 6c28 6163  f.assertEqual(ac
-00012340: 7475 616c 2c20 6578 7065 6374 6564 290a  tual, expected).
-00012350: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
-00012360: 6f64 0a20 2020 2064 6566 2063 6f6d 7061  od.    def compa
-00012370: 7265 5f72 6573 756c 7473 280a 2020 2020  re_results(.    
-00012380: 2020 2020 7265 7375 6c74 3a20 636c 6963      result: clic
-00012390: 6b2e 7465 7374 696e 672e 5265 7375 6c74  k.testing.Result
-000123a0: 2c20 6578 7065 6374 6564 5f76 616c 7565  , expected_value
-000123b0: 3a20 7374 722c 2065 7870 6563 7465 645f  : str, expected_
-000123c0: 6578 6974 5f63 6f64 653a 2069 6e74 0a20  exit_code: int. 
-000123d0: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
-000123e0: 2020 2020 2020 2222 2248 656c 7065 7220        """Helper 
-000123f0: 6d65 7468 6f64 2074 6f20 7465 7374 2074  method to test t
-00012400: 6865 2076 616c 7565 2061 6e64 2065 7869  he value and exi
-00012410: 7420 636f 6465 206f 6620 6120 636c 6963  t code of a clic
-00012420: 6b20 5265 7375 6c74 2e22 2222 0a20 2020  k Result.""".   
-00012430: 2020 2020 2061 7373 6572 7420 280a 2020       assert (.  
-00012440: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00012450: 2e6f 7574 7075 7420 3d3d 2065 7870 6563  .output == expec
-00012460: 7465 645f 7661 6c75 650a 2020 2020 2020  ted_value.      
-00012470: 2020 292c 2022 5468 6520 6f75 7470 7574    ), "The output
-00012480: 2064 6964 206e 6f74 206d 6174 6368 2074   did not match t
-00012490: 6865 2065 7870 6563 7465 6420 7661 6c75  he expected valu
-000124a0: 652e 220a 2020 2020 2020 2020 6173 7365  e.".        asse
-000124b0: 7274 2072 6573 756c 742e 6578 6974 5f63  rt result.exit_c
-000124c0: 6f64 6520 3d3d 2065 7870 6563 7465 645f  ode == expected_
-000124d0: 6578 6974 5f63 6f64 652c 2022 5468 6520  exit_code, "The 
-000124e0: 6578 6974 2063 6f64 6520 6973 2069 6e63  exit code is inc
-000124f0: 6f72 7265 6374 2e22 0a0a 2020 2020 6465  orrect."..    de
-00012500: 6620 7465 7374 5f63 6f64 655f 6f70 7469  f test_code_opti
-00012510: 6f6e 2873 656c 6629 202d 3e20 4e6f 6e65  on(self) -> None
-00012520: 3a0a 2020 2020 2020 2020 2222 2254 6573  :.        """Tes
-00012530: 7420 7468 6520 636f 6465 206f 7074 696f  t the code optio
-00012540: 6e20 7769 7468 206e 6f20 6368 616e 6765  n with no change
-00012550: 732e 2222 220a 2020 2020 2020 2020 636f  s.""".        co
-00012560: 6465 203d 2027 7072 696e 7428 2248 656c  de = 'print("Hel
-00012570: 6c6f 2077 6f72 6c64 2229 5c6e 270a 2020  lo world")\n'.  
-00012580: 2020 2020 2020 6172 6773 203d 205b 222d        args = ["-
-00012590: 2d63 6f64 6522 2c20 636f 6465 5d0a 2020  -code", code].  
-000125a0: 2020 2020 2020 7265 7375 6c74 203d 2043        result = C
-000125b0: 6c69 5275 6e6e 6572 2829 2e69 6e76 6f6b  liRunner().invok
-000125c0: 6528 626c 6163 6b2e 6d61 696e 2c20 6172  e(black.main, ar
-000125d0: 6773 290a 0a20 2020 2020 2020 2073 656c  gs)..        sel
-000125e0: 662e 636f 6d70 6172 655f 7265 7375 6c74  f.compare_result
-000125f0: 7328 7265 7375 6c74 2c20 636f 6465 2c20  s(result, code, 
-00012600: 3029 0a0a 2020 2020 6465 6620 7465 7374  0)..    def test
-00012610: 5f63 6f64 655f 6f70 7469 6f6e 5f63 6861  _code_option_cha
-00012620: 6e67 6564 2873 656c 6629 202d 3e20 4e6f  nged(self) -> No
-00012630: 6e65 3a0a 2020 2020 2020 2020 2222 2254  ne:.        """T
-00012640: 6573 7420 7468 6520 636f 6465 206f 7074  est the code opt
-00012650: 696f 6e20 7768 656e 2063 6861 6e67 6573  ion when changes
-00012660: 2061 7265 2072 6571 7569 7265 642e 2222   are required.""
-00012670: 220a 2020 2020 2020 2020 636f 6465 203d  ".        code =
-00012680: 2022 7072 696e 7428 2768 656c 6c6f 2077   "print('hello w
-00012690: 6f72 6c64 2729 220a 2020 2020 2020 2020  orld')".        
-000126a0: 666f 726d 6174 7465 6420 3d20 626c 6163  formatted = blac
-000126b0: 6b2e 666f 726d 6174 5f73 7472 2863 6f64  k.format_str(cod
-000126c0: 652c 206d 6f64 653d 4445 4641 554c 545f  e, mode=DEFAULT_
-000126d0: 4d4f 4445 290a 0a20 2020 2020 2020 2061  MODE)..        a
-000126e0: 7267 7320 3d20 5b22 2d2d 636f 6465 222c  rgs = ["--code",
-000126f0: 2063 6f64 655d 0a20 2020 2020 2020 2072   code].        r
-00012700: 6573 756c 7420 3d20 436c 6952 756e 6e65  esult = CliRunne
-00012710: 7228 292e 696e 766f 6b65 2862 6c61 636b  r().invoke(black
-00012720: 2e6d 6169 6e2c 2061 7267 7329 0a0a 2020  .main, args)..  
-00012730: 2020 2020 2020 7365 6c66 2e63 6f6d 7061        self.compa
-00012740: 7265 5f72 6573 756c 7473 2872 6573 756c  re_results(resul
-00012750: 742c 2066 6f72 6d61 7474 6564 2c20 3029  t, formatted, 0)
-00012760: 0a0a 2020 2020 6465 6620 7465 7374 5f63  ..    def test_c
-00012770: 6f64 655f 6f70 7469 6f6e 5f63 6865 636b  ode_option_check
-00012780: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00012790: 2020 2020 2020 2020 2222 2254 6573 7420          """Test 
-000127a0: 7468 6520 636f 6465 206f 7074 696f 6e20  the code option 
-000127b0: 7768 656e 2063 6865 636b 2069 7320 7061  when check is pa
-000127c0: 7373 6564 2e22 2222 0a20 2020 2020 2020  ssed.""".       
-000127d0: 2061 7267 7320 3d20 5b22 2d2d 6368 6563   args = ["--chec
-000127e0: 6b22 2c20 222d 2d63 6f64 6522 2c20 2770  k", "--code", 'p
-000127f0: 7269 6e74 2822 4865 6c6c 6f20 776f 726c  rint("Hello worl
-00012800: 6422 295c 6e27 5d0a 2020 2020 2020 2020  d")\n'].        
-00012810: 7265 7375 6c74 203d 2043 6c69 5275 6e6e  result = CliRunn
-00012820: 6572 2829 2e69 6e76 6f6b 6528 626c 6163  er().invoke(blac
-00012830: 6b2e 6d61 696e 2c20 6172 6773 290a 2020  k.main, args).  
-00012840: 2020 2020 2020 7365 6c66 2e63 6f6d 7061        self.compa
-00012850: 7265 5f72 6573 756c 7473 2872 6573 756c  re_results(resul
-00012860: 742c 2022 222c 2030 290a 0a20 2020 2064  t, "", 0)..    d
-00012870: 6566 2074 6573 745f 636f 6465 5f6f 7074  ef test_code_opt
-00012880: 696f 6e5f 6368 6563 6b5f 6368 616e 6765  ion_check_change
-00012890: 6428 7365 6c66 2920 2d3e 204e 6f6e 653a  d(self) -> None:
-000128a0: 0a20 2020 2020 2020 2022 2222 5465 7374  .        """Test
-000128b0: 2074 6865 2063 6f64 6520 6f70 7469 6f6e   the code option
-000128c0: 2077 6865 6e20 6368 616e 6765 7320 6172   when changes ar
-000128d0: 6520 7265 7175 6972 6564 2c20 616e 6420  e required, and 
-000128e0: 6368 6563 6b20 6973 2070 6173 7365 642e  check is passed.
-000128f0: 2222 220a 2020 2020 2020 2020 6172 6773  """.        args
-00012900: 203d 205b 222d 2d63 6865 636b 222c 2022   = ["--check", "
-00012910: 2d2d 636f 6465 222c 2022 7072 696e 7428  --code", "print(
-00012920: 2768 656c 6c6f 2077 6f72 6c64 2729 225d  'hello world')"]
-00012930: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-00012940: 3d20 436c 6952 756e 6e65 7228 292e 696e  = CliRunner().in
-00012950: 766f 6b65 2862 6c61 636b 2e6d 6169 6e2c  voke(black.main,
-00012960: 2061 7267 7329 0a20 2020 2020 2020 2073   args).        s
-00012970: 656c 662e 636f 6d70 6172 655f 7265 7375  elf.compare_resu
-00012980: 6c74 7328 7265 7375 6c74 2c20 2222 2c20  lts(result, "", 
-00012990: 3129 0a0a 2020 2020 6465 6620 7465 7374  1)..    def test
-000129a0: 5f63 6f64 655f 6f70 7469 6f6e 5f64 6966  _code_option_dif
-000129b0: 6628 7365 6c66 2920 2d3e 204e 6f6e 653a  f(self) -> None:
-000129c0: 0a20 2020 2020 2020 2022 2222 5465 7374  .        """Test
-000129d0: 2074 6865 2063 6f64 6520 6f70 7469 6f6e   the code option
-000129e0: 2077 6865 6e20 6469 6666 2069 7320 7061   when diff is pa
-000129f0: 7373 6564 2e22 2222 0a20 2020 2020 2020  ssed.""".       
-00012a00: 2063 6f64 6520 3d20 2270 7269 6e74 2827   code = "print('
-00012a10: 6865 6c6c 6f20 776f 726c 6427 2922 0a20  hello world')". 
-00012a20: 2020 2020 2020 2066 6f72 6d61 7474 6564         formatted
-00012a30: 203d 2062 6c61 636b 2e66 6f72 6d61 745f   = black.format_
-00012a40: 7374 7228 636f 6465 2c20 6d6f 6465 3d44  str(code, mode=D
-00012a50: 4546 4155 4c54 5f4d 4f44 4529 0a20 2020  EFAULT_MODE).   
-00012a60: 2020 2020 2072 6573 756c 745f 6469 6666       result_diff
-00012a70: 203d 2064 6966 6628 636f 6465 2c20 666f   = diff(code, fo
-00012a80: 726d 6174 7465 642c 2022 5354 4449 4e22  rmatted, "STDIN"
-00012a90: 2c20 2253 5444 4f55 5422 290a 0a20 2020  , "STDOUT")..   
-00012aa0: 2020 2020 2061 7267 7320 3d20 5b22 2d2d       args = ["--
-00012ab0: 6469 6666 222c 2022 2d2d 636f 6465 222c  diff", "--code",
-00012ac0: 2063 6f64 655d 0a20 2020 2020 2020 2072   code].        r
-00012ad0: 6573 756c 7420 3d20 436c 6952 756e 6e65  esult = CliRunne
-00012ae0: 7228 292e 696e 766f 6b65 2862 6c61 636b  r().invoke(black
-00012af0: 2e6d 6169 6e2c 2061 7267 7329 0a0a 2020  .main, args)..  
-00012b00: 2020 2020 2020 2320 5265 6d6f 7665 2074        # Remove t
-00012b10: 696d 6520 6672 6f6d 2064 6966 660a 2020  ime from diff.  
-00012b20: 2020 2020 2020 6f75 7470 7574 203d 2044        output = D
-00012b30: 4946 465f 5449 4d45 2e73 7562 2822 222c  IFF_TIME.sub("",
-00012b40: 2072 6573 756c 742e 6f75 7470 7574 290a   result.output).
-00012b50: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00012b60: 6f75 7470 7574 203d 3d20 7265 7375 6c74  output == result
-00012b70: 5f64 6966 662c 2022 5468 6520 6f75 7470  _diff, "The outp
-00012b80: 7574 2064 6964 206e 6f74 206d 6174 6368  ut did not match
-00012b90: 2074 6865 2065 7870 6563 7465 6420 7661   the expected va
-00012ba0: 6c75 652e 220a 2020 2020 2020 2020 6173  lue.".        as
-00012bb0: 7365 7274 2072 6573 756c 742e 6578 6974  sert result.exit
-00012bc0: 5f63 6f64 6520 3d3d 2030 2c20 2254 6865  _code == 0, "The
-00012bd0: 2065 7869 7420 636f 6465 2069 7320 696e   exit code is in
-00012be0: 636f 7272 6563 742e 220a 0a20 2020 2064  correct."..    d
-00012bf0: 6566 2074 6573 745f 636f 6465 5f6f 7074  ef test_code_opt
-00012c00: 696f 6e5f 636f 6c6f 725f 6469 6666 2873  ion_color_diff(s
-00012c10: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00012c20: 2020 2020 2020 2222 2254 6573 7420 7468        """Test th
-00012c30: 6520 636f 6465 206f 7074 696f 6e20 7768  e code option wh
-00012c40: 656e 2063 6f6c 6f72 2061 6e64 2064 6966  en color and dif
-00012c50: 6620 6172 6520 7061 7373 6564 2e22 2222  f are passed."""
-00012c60: 0a20 2020 2020 2020 2063 6f64 6520 3d20  .        code = 
-00012c70: 2270 7269 6e74 2827 6865 6c6c 6f20 776f  "print('hello wo
-00012c80: 726c 6427 2922 0a20 2020 2020 2020 2066  rld')".        f
-00012c90: 6f72 6d61 7474 6564 203d 2062 6c61 636b  ormatted = black
-00012ca0: 2e66 6f72 6d61 745f 7374 7228 636f 6465  .format_str(code
-00012cb0: 2c20 6d6f 6465 3d44 4546 4155 4c54 5f4d  , mode=DEFAULT_M
-00012cc0: 4f44 4529 0a0a 2020 2020 2020 2020 7265  ODE)..        re
-00012cd0: 7375 6c74 5f64 6966 6620 3d20 6469 6666  sult_diff = diff
-00012ce0: 2863 6f64 652c 2066 6f72 6d61 7474 6564  (code, formatted
-00012cf0: 2c20 2253 5444 494e 222c 2022 5354 444f  , "STDIN", "STDO
-00012d00: 5554 2229 0a20 2020 2020 2020 2072 6573  UT").        res
-00012d10: 756c 745f 6469 6666 203d 2063 6f6c 6f72  ult_diff = color
-00012d20: 5f64 6966 6628 7265 7375 6c74 5f64 6966  _diff(result_dif
-00012d30: 6629 0a0a 2020 2020 2020 2020 6172 6773  f)..        args
-00012d40: 203d 205b 222d 2d64 6966 6622 2c20 222d   = ["--diff", "-
-00012d50: 2d63 6f6c 6f72 222c 2022 2d2d 636f 6465  -color", "--code
-00012d60: 222c 2063 6f64 655d 0a20 2020 2020 2020  ", code].       
-00012d70: 2072 6573 756c 7420 3d20 436c 6952 756e   result = CliRun
-00012d80: 6e65 7228 292e 696e 766f 6b65 2862 6c61  ner().invoke(bla
-00012d90: 636b 2e6d 6169 6e2c 2061 7267 7329 0a0a  ck.main, args)..
-00012da0: 2020 2020 2020 2020 2320 5265 6d6f 7665          # Remove
-00012db0: 2074 696d 6520 6672 6f6d 2064 6966 660a   time from diff.
-00012dc0: 2020 2020 2020 2020 6f75 7470 7574 203d          output =
-00012dd0: 2044 4946 465f 5449 4d45 2e73 7562 2822   DIFF_TIME.sub("
-00012de0: 222c 2072 6573 756c 742e 6f75 7470 7574  ", result.output
-00012df0: 290a 0a20 2020 2020 2020 2061 7373 6572  )..        asser
-00012e00: 7420 6f75 7470 7574 203d 3d20 7265 7375  t output == resu
-00012e10: 6c74 5f64 6966 662c 2022 5468 6520 6f75  lt_diff, "The ou
-00012e20: 7470 7574 2064 6964 206e 6f74 206d 6174  tput did not mat
-00012e30: 6368 2074 6865 2065 7870 6563 7465 6420  ch the expected 
-00012e40: 7661 6c75 652e 220a 2020 2020 2020 2020  value.".        
-00012e50: 6173 7365 7274 2072 6573 756c 742e 6578  assert result.ex
-00012e60: 6974 5f63 6f64 6520 3d3d 2030 2c20 2254  it_code == 0, "T
-00012e70: 6865 2065 7869 7420 636f 6465 2069 7320  he exit code is 
-00012e80: 696e 636f 7272 6563 742e 220a 0a20 2020  incorrect."..   
-00012e90: 2040 7079 7465 7374 2e6d 6172 6b2e 696e   @pytest.mark.in
-00012ea0: 636f 6d70 6174 6962 6c65 5f77 6974 685f  compatible_with_
-00012eb0: 6d79 7079 630a 2020 2020 6465 6620 7465  mypyc.    def te
-00012ec0: 7374 5f63 6f64 655f 6f70 7469 6f6e 5f73  st_code_option_s
-00012ed0: 6166 6528 7365 6c66 2920 2d3e 204e 6f6e  afe(self) -> Non
-00012ee0: 653a 0a20 2020 2020 2020 2022 2222 5465  e:.        """Te
-00012ef0: 7374 2074 6861 7420 7468 6520 636f 6465  st that the code
-00012f00: 206f 7074 696f 6e20 7468 726f 7773 2061   option throws a
-00012f10: 6e20 6572 726f 7220 7768 656e 2074 6865  n error when the
-00012f20: 2073 616e 6974 7920 6368 6563 6b73 2066   sanity checks f
-00012f30: 6169 6c2e 2222 220a 2020 2020 2020 2020  ail.""".        
-00012f40: 2320 5061 7463 6820 626c 6163 6b2e 6173  # Patch black.as
-00012f50: 7365 7274 5f65 7175 6976 616c 656e 7420  sert_equivalent 
-00012f60: 746f 2065 6e73 7572 6520 7468 6520 7361  to ensure the sa
-00012f70: 6e69 7479 2063 6865 636b 7320 6661 696c  nity checks fail
-00012f80: 0a20 2020 2020 2020 2077 6974 6820 7061  .        with pa
-00012f90: 7463 682e 6f62 6a65 6374 2862 6c61 636b  tch.object(black
-00012fa0: 2c20 2261 7373 6572 745f 6571 7569 7661  , "assert_equiva
-00012fb0: 6c65 6e74 222c 2073 6964 655f 6566 6665  lent", side_effe
-00012fc0: 6374 3d41 7373 6572 7469 6f6e 4572 726f  ct=AssertionErro
-00012fd0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00012fe0: 636f 6465 203d 2027 7072 696e 7428 2248  code = 'print("H
-00012ff0: 656c 6c6f 2077 6f72 6c64 2229 270a 2020  ello world")'.  
-00013000: 2020 2020 2020 2020 2020 6572 726f 725f            error_
-00013010: 6d73 6720 3d20 6622 7b63 6f64 657d 5c6e  msg = f"{code}\n
-00013020: 6572 726f 723a 2063 616e 6e6f 7420 666f  error: cannot fo
-00013030: 726d 6174 203c 7374 7269 6e67 3e3a 205c  rmat <string>: \
-00013040: 6e22 0a0a 2020 2020 2020 2020 2020 2020  n"..            
-00013050: 6172 6773 203d 205b 222d 2d73 6166 6522  args = ["--safe"
-00013060: 2c20 222d 2d63 6f64 6522 2c20 636f 6465  , "--code", code
-00013070: 5d0a 2020 2020 2020 2020 2020 2020 7265  ].            re
-00013080: 7375 6c74 203d 2043 6c69 5275 6e6e 6572  sult = CliRunner
-00013090: 2829 2e69 6e76 6f6b 6528 626c 6163 6b2e  ().invoke(black.
-000130a0: 6d61 696e 2c20 6172 6773 290a 0a20 2020  main, args)..   
-000130b0: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
-000130c0: 6d70 6172 655f 7265 7375 6c74 7328 7265  mpare_results(re
-000130d0: 7375 6c74 2c20 6572 726f 725f 6d73 672c  sult, error_msg,
-000130e0: 2031 3233 290a 0a20 2020 2064 6566 2074   123)..    def t
-000130f0: 6573 745f 636f 6465 5f6f 7074 696f 6e5f  est_code_option_
-00013100: 6661 7374 2873 656c 6629 202d 3e20 4e6f  fast(self) -> No
-00013110: 6e65 3a0a 2020 2020 2020 2020 2222 2254  ne:.        """T
-00013120: 6573 7420 7468 6174 2074 6865 2063 6f64  est that the cod
-00013130: 6520 6f70 7469 6f6e 2069 676e 6f72 6573  e option ignores
-00013140: 2065 7272 6f72 7320 7768 656e 2074 6865   errors when the
-00013150: 2073 616e 6974 7920 6368 6563 6b73 2066   sanity checks f
-00013160: 6169 6c2e 2222 220a 2020 2020 2020 2020  ail.""".        
-00013170: 2320 5061 7463 6820 626c 6163 6b2e 6173  # Patch black.as
-00013180: 7365 7274 5f65 7175 6976 616c 656e 7420  sert_equivalent 
-00013190: 746f 2065 6e73 7572 6520 7468 6520 7361  to ensure the sa
-000131a0: 6e69 7479 2063 6865 636b 7320 6661 696c  nity checks fail
-000131b0: 0a20 2020 2020 2020 2077 6974 6820 7061  .        with pa
-000131c0: 7463 682e 6f62 6a65 6374 2862 6c61 636b  tch.object(black
-000131d0: 2c20 2261 7373 6572 745f 6571 7569 7661  , "assert_equiva
-000131e0: 6c65 6e74 222c 2073 6964 655f 6566 6665  lent", side_effe
-000131f0: 6374 3d41 7373 6572 7469 6f6e 4572 726f  ct=AssertionErro
-00013200: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00013210: 636f 6465 203d 2027 7072 696e 7428 2248  code = 'print("H
-00013220: 656c 6c6f 2077 6f72 6c64 2229 270a 2020  ello world")'.  
-00013230: 2020 2020 2020 2020 2020 666f 726d 6174            format
-00013240: 7465 6420 3d20 626c 6163 6b2e 666f 726d  ted = black.form
-00013250: 6174 5f73 7472 2863 6f64 652c 206d 6f64  at_str(code, mod
-00013260: 653d 4445 4641 554c 545f 4d4f 4445 290a  e=DEFAULT_MODE).
-00013270: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
-00013280: 7320 3d20 5b22 2d2d 6661 7374 222c 2022  s = ["--fast", "
-00013290: 2d2d 636f 6465 222c 2063 6f64 655d 0a20  --code", code]. 
-000132a0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-000132b0: 7420 3d20 436c 6952 756e 6e65 7228 292e  t = CliRunner().
-000132c0: 696e 766f 6b65 2862 6c61 636b 2e6d 6169  invoke(black.mai
-000132d0: 6e2c 2061 7267 7329 0a0a 2020 2020 2020  n, args)..      
-000132e0: 2020 2020 2020 7365 6c66 2e63 6f6d 7061        self.compa
-000132f0: 7265 5f72 6573 756c 7473 2872 6573 756c  re_results(resul
-00013300: 742c 2066 6f72 6d61 7474 6564 2c20 3029  t, formatted, 0)
-00013310: 0a0a 2020 2020 4070 7974 6573 742e 6d61  ..    @pytest.ma
-00013320: 726b 2e69 6e63 6f6d 7061 7469 626c 655f  rk.incompatible_
-00013330: 7769 7468 5f6d 7970 7963 0a20 2020 2064  with_mypyc.    d
-00013340: 6566 2074 6573 745f 636f 6465 5f6f 7074  ef test_code_opt
-00013350: 696f 6e5f 636f 6e66 6967 2873 656c 6629  ion_config(self)
-00013360: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00013370: 2020 2222 220a 2020 2020 2020 2020 5465    """.        Te
-00013380: 7374 2074 6861 7420 7468 6520 636f 6465  st that the code
-00013390: 206f 7074 696f 6e20 6669 6e64 7320 7468   option finds th
-000133a0: 6520 7079 7072 6f6a 6563 742e 746f 6d6c  e pyproject.toml
-000133b0: 2069 6e20 7468 6520 6375 7272 656e 7420   in the current 
-000133c0: 6469 7265 6374 6f72 792e 0a20 2020 2020  directory..     
-000133d0: 2020 2022 2222 0a20 2020 2020 2020 2077     """.        w
-000133e0: 6974 6820 7061 7463 682e 6f62 6a65 6374  ith patch.object
-000133f0: 2862 6c61 636b 2c20 2270 6172 7365 5f70  (black, "parse_p
-00013400: 7970 726f 6a65 6374 5f74 6f6d 6c22 2c20  yproject_toml", 
-00013410: 7265 7475 726e 5f76 616c 7565 3d7b 7d29  return_value={})
-00013420: 2061 7320 7061 7273 653a 0a20 2020 2020   as parse:.     
-00013430: 2020 2020 2020 2061 7267 7320 3d20 5b22         args = ["
-00013440: 2d2d 636f 6465 222c 2022 7072 696e 7422  --code", "print"
-00013450: 5d0a 2020 2020 2020 2020 2020 2020 2320  ].            # 
-00013460: 5468 6973 2069 7320 7468 6520 6f6e 6c79  This is the only
-00013470: 2064 6972 6563 746f 7279 206b 6e6f 776e   directory known
-00013480: 2074 6f20 636f 6e74 6169 6e20 6120 7079   to contain a py
-00013490: 7072 6f6a 6563 742e 746f 6d6c 0a20 2020  project.toml.   
-000134a0: 2020 2020 2020 2020 2077 6974 6820 6368           with ch
-000134b0: 616e 6765 5f64 6972 6563 746f 7279 2850  ange_directory(P
-000134c0: 524f 4a45 4354 5f52 4f4f 5429 3a0a 2020  ROJECT_ROOT):.  
-000134d0: 2020 2020 2020 2020 2020 2020 2020 436c                Cl
-000134e0: 6952 756e 6e65 7228 292e 696e 766f 6b65  iRunner().invoke
-000134f0: 2862 6c61 636b 2e6d 6169 6e2c 2061 7267  (black.main, arg
-00013500: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00013510: 2020 2070 7970 726f 6a65 6374 5f70 6174     pyproject_pat
-00013520: 6820 3d20 5061 7468 2850 6174 682e 6377  h = Path(Path.cw
-00013530: 6428 292c 2022 7079 7072 6f6a 6563 742e  d(), "pyproject.
-00013540: 746f 6d6c 2229 2e72 6573 6f6c 7665 2829  toml").resolve()
-00013550: 0a0a 2020 2020 2020 2020 2020 2020 6173  ..            as
-00013560: 7365 7274 2028 0a20 2020 2020 2020 2020  sert (.         
-00013570: 2020 2020 2020 206c 656e 2870 6172 7365         len(parse
-00013580: 2e6d 6f63 6b5f 6361 6c6c 7329 203e 3d20  .mock_calls) >= 
-00013590: 310a 2020 2020 2020 2020 2020 2020 292c  1.            ),
-000135a0: 2022 4578 7065 6374 6564 2063 6f6e 6669   "Expected confi
-000135b0: 6720 7061 7273 6520 746f 2062 6520 6361  g parse to be ca
-000135c0: 6c6c 6564 2077 6974 6820 7468 6520 6375  lled with the cu
-000135d0: 7272 656e 7420 6469 7265 6374 6f72 792e  rrent directory.
-000135e0: 220a 0a20 2020 2020 2020 2020 2020 205f  "..            _
-000135f0: 2c20 6361 6c6c 5f61 7267 732c 205f 203d  , call_args, _ =
-00013600: 2070 6172 7365 2e6d 6f63 6b5f 6361 6c6c   parse.mock_call
-00013610: 735b 305d 0a20 2020 2020 2020 2020 2020  s[0].           
-00013620: 2061 7373 6572 7420 280a 2020 2020 2020   assert (.      
-00013630: 2020 2020 2020 2020 2020 6361 6c6c 5f61            call_a
-00013640: 7267 735b 305d 2e6c 6f77 6572 2829 203d  rgs[0].lower() =
-00013650: 3d20 7374 7228 7079 7072 6f6a 6563 745f  = str(pyproject_
-00013660: 7061 7468 292e 6c6f 7765 7228 290a 2020  path).lower().  
-00013670: 2020 2020 2020 2020 2020 292c 2022 496e            ), "In
-00013680: 636f 7272 6563 7420 636f 6e66 6967 206c  correct config l
-00013690: 6f61 6465 642e 220a 0a20 2020 2040 7079  oaded."..    @py
-000136a0: 7465 7374 2e6d 6172 6b2e 696e 636f 6d70  test.mark.incomp
-000136b0: 6174 6962 6c65 5f77 6974 685f 6d79 7079  atible_with_mypy
-000136c0: 630a 2020 2020 6465 6620 7465 7374 5f63  c.    def test_c
-000136d0: 6f64 655f 6f70 7469 6f6e 5f70 6172 656e  ode_option_paren
-000136e0: 745f 636f 6e66 6967 2873 656c 6629 202d  t_config(self) -
-000136f0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00013700: 2222 220a 2020 2020 2020 2020 5465 7374  """.        Test
-00013710: 2074 6861 7420 7468 6520 636f 6465 206f   that the code o
-00013720: 7074 696f 6e20 6669 6e64 7320 7468 6520  ption finds the 
-00013730: 7079 7072 6f6a 6563 742e 746f 6d6c 2069  pyproject.toml i
-00013740: 6e20 7468 6520 7061 7265 6e74 2064 6972  n the parent dir
-00013750: 6563 746f 7279 2e0a 2020 2020 2020 2020  ectory..        
-00013760: 2222 220a 2020 2020 2020 2020 7769 7468  """.        with
-00013770: 2070 6174 6368 2e6f 626a 6563 7428 626c   patch.object(bl
-00013780: 6163 6b2c 2022 7061 7273 655f 7079 7072  ack, "parse_pypr
-00013790: 6f6a 6563 745f 746f 6d6c 222c 2072 6574  oject_toml", ret
-000137a0: 7572 6e5f 7661 6c75 653d 7b7d 2920 6173  urn_value={}) as
-000137b0: 2070 6172 7365 3a0a 2020 2020 2020 2020   parse:.        
-000137c0: 2020 2020 7769 7468 2063 6861 6e67 655f      with change_
-000137d0: 6469 7265 6374 6f72 7928 5448 4953 5f44  directory(THIS_D
-000137e0: 4952 293a 0a20 2020 2020 2020 2020 2020  IR):.           
-000137f0: 2020 2020 2061 7267 7320 3d20 5b22 2d2d       args = ["--
-00013800: 636f 6465 222c 2022 7072 696e 7422 5d0a  code", "print"].
-00013810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013820: 436c 6952 756e 6e65 7228 292e 696e 766f  CliRunner().invo
-00013830: 6b65 2862 6c61 636b 2e6d 6169 6e2c 2061  ke(black.main, a
-00013840: 7267 7329 0a0a 2020 2020 2020 2020 2020  rgs)..          
-00013850: 2020 2020 2020 7079 7072 6f6a 6563 745f        pyproject_
-00013860: 7061 7468 203d 2050 6174 6828 5061 7468  path = Path(Path
-00013870: 2829 2e63 7764 2829 2e70 6172 656e 742c  ().cwd().parent,
-00013880: 2022 7079 7072 6f6a 6563 742e 746f 6d6c   "pyproject.toml
-00013890: 2229 2e72 6573 6f6c 7665 2829 0a20 2020  ").resolve().   
-000138a0: 2020 2020 2020 2020 2020 2020 2061 7373               ass
-000138b0: 6572 7420 280a 2020 2020 2020 2020 2020  ert (.          
-000138c0: 2020 2020 2020 2020 2020 6c65 6e28 7061            len(pa
-000138d0: 7273 652e 6d6f 636b 5f63 616c 6c73 2920  rse.mock_calls) 
-000138e0: 3e3d 2031 0a20 2020 2020 2020 2020 2020  >= 1.           
-000138f0: 2020 2020 2029 2c20 2245 7870 6563 7465       ), "Expecte
-00013900: 6420 636f 6e66 6967 2070 6172 7365 2074  d config parse t
-00013910: 6f20 6265 2063 616c 6c65 6420 7769 7468  o be called with
-00013920: 2074 6865 2063 7572 7265 6e74 2064 6972   the current dir
-00013930: 6563 746f 7279 2e22 0a0a 2020 2020 2020  ectory."..      
-00013940: 2020 2020 2020 2020 2020 5f2c 2063 616c            _, cal
-00013950: 6c5f 6172 6773 2c20 5f20 3d20 7061 7273  l_args, _ = pars
-00013960: 652e 6d6f 636b 5f63 616c 6c73 5b30 5d0a  e.mock_calls[0].
-00013970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013980: 6173 7365 7274 2028 0a20 2020 2020 2020  assert (.       
-00013990: 2020 2020 2020 2020 2020 2020 2063 616c               cal
-000139a0: 6c5f 6172 6773 5b30 5d2e 6c6f 7765 7228  l_args[0].lower(
-000139b0: 2920 3d3d 2073 7472 2870 7970 726f 6a65  ) == str(pyproje
-000139c0: 6374 5f70 6174 6829 2e6c 6f77 6572 2829  ct_path).lower()
-000139d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000139e0: 2029 2c20 2249 6e63 6f72 7265 6374 2063   ), "Incorrect c
-000139f0: 6f6e 6669 6720 6c6f 6164 6564 2e22 0a0a  onfig loaded."..
-00013a00: 2020 2020 6465 6620 7465 7374 5f66 6f72      def test_for
-00013a10: 5f68 616e 646c 6564 5f75 6e65 7870 6563  _handled_unexpec
-00013a20: 7465 645f 656f 665f 6572 726f 7228 7365  ted_eof_error(se
-00013a30: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00013a40: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00013a50: 2054 6573 7420 7468 6174 2061 6e20 756e   Test that an un
-00013a60: 6578 7065 6374 6564 2045 4f46 2053 796e  expected EOF Syn
-00013a70: 7461 7845 7272 6f72 2069 7320 6e69 6365  taxError is nice
-00013a80: 6c79 2070 7265 7365 6e74 6564 2e0a 2020  ly presented..  
-00013a90: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00013aa0: 2020 7769 7468 2070 7974 6573 742e 7261    with pytest.ra
-00013ab0: 6973 6573 2862 6c61 636b 2e70 6172 7369  ises(black.parsi
-00013ac0: 6e67 2e49 6e76 616c 6964 496e 7075 7429  ng.InvalidInput)
-00013ad0: 2061 7320 6578 635f 696e 666f 3a0a 2020   as exc_info:.  
-00013ae0: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
-00013af0: 6c69 6232 746f 335f 7061 7273 6528 2270  lib2to3_parse("p
-00013b00: 7269 6e74 2822 2c20 7b7d 290a 0a20 2020  rint(", {})..   
-00013b10: 2020 2020 2065 7863 5f69 6e66 6f2e 6d61       exc_info.ma
-00013b20: 7463 6828 2243 616e 6e6f 7420 7061 7273  tch("Cannot pars
-00013b30: 653a 2032 3a30 3a20 454f 4620 696e 206d  e: 2:0: EOF in m
-00013b40: 756c 7469 2d6c 696e 6520 7374 6174 656d  ulti-line statem
-00013b50: 656e 7422 290a 0a20 2020 2064 6566 2074  ent")..    def t
-00013b60: 6573 745f 6c69 6e65 5f72 616e 6765 735f  est_line_ranges_
-00013b70: 7769 7468 5f63 6f64 655f 6f70 7469 6f6e  with_code_option
-00013b80: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00013b90: 2020 2020 2020 2020 636f 6465 203d 2074          code = t
-00013ba0: 6578 7477 7261 702e 6465 6465 6e74 2822  extwrap.dedent("
-00013bb0: 2222 5c0a 2020 2020 2020 2020 2020 2020  ""\.            
-00013bc0: 6966 2020 6120 203d 3d20 2062 3a0a 2020  if  a  ==  b:.  
-00013bd0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00013be0: 696e 7420 2028 2022 4f4b 2220 290a 2020  int  ( "OK" ).  
-00013bf0: 2020 2020 2020 2020 2020 2222 2229 0a20            """). 
-00013c00: 2020 2020 2020 2061 7267 7320 3d20 5b22         args = ["
-00013c10: 2d2d 6c69 6e65 2d72 616e 6765 733d 312d  --line-ranges=1-
-00013c20: 3122 2c20 222d 2d63 6f64 6522 2c20 636f  1", "--code", co
-00013c30: 6465 5d0a 2020 2020 2020 2020 7265 7375  de].        resu
-00013c40: 6c74 203d 2043 6c69 5275 6e6e 6572 2829  lt = CliRunner()
-00013c50: 2e69 6e76 6f6b 6528 626c 6163 6b2e 6d61  .invoke(black.ma
-00013c60: 696e 2c20 6172 6773 290a 0a20 2020 2020  in, args)..     
-00013c70: 2020 2065 7870 6563 7465 6420 3d20 7465     expected = te
-00013c80: 7874 7772 6170 2e64 6564 656e 7428 2222  xtwrap.dedent(""
-00013c90: 225c 0a20 2020 2020 2020 2020 2020 2069  "\.            i
-00013ca0: 6620 6120 3d3d 2062 3a0a 2020 2020 2020  f a == b:.      
-00013cb0: 2020 2020 2020 2020 2020 7072 696e 7420            print 
-00013cc0: 2028 2022 4f4b 2220 290a 2020 2020 2020   ( "OK" ).      
-00013cd0: 2020 2020 2020 2222 2229 0a20 2020 2020        """).     
-00013ce0: 2020 2073 656c 662e 636f 6d70 6172 655f     self.compare_
-00013cf0: 7265 7375 6c74 7328 7265 7375 6c74 2c20  results(result, 
-00013d00: 6578 7065 6374 6564 2c20 6578 7065 6374  expected, expect
-00013d10: 6564 5f65 7869 745f 636f 6465 3d30 290a  ed_exit_code=0).
-00013d20: 0a20 2020 2064 6566 2074 6573 745f 6c69  .    def test_li
-00013d30: 6e65 5f72 616e 6765 735f 7769 7468 5f73  ne_ranges_with_s
-00013d40: 7464 696e 2873 656c 6629 202d 3e20 4e6f  tdin(self) -> No
-00013d50: 6e65 3a0a 2020 2020 2020 2020 636f 6465  ne:.        code
-00013d60: 203d 2074 6578 7477 7261 702e 6465 6465   = textwrap.dede
-00013d70: 6e74 2822 2222 5c0a 2020 2020 2020 2020  nt("""\.        
-00013d80: 2020 2020 6966 2020 6120 203d 3d20 2062      if  a  ==  b
-00013d90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013da0: 2020 7072 696e 7420 2028 2022 4f4b 2220    print  ( "OK" 
-00013db0: 290a 2020 2020 2020 2020 2020 2020 2222  ).            ""
-00013dc0: 2229 0a20 2020 2020 2020 2072 756e 6e65  ").        runne
-00013dd0: 7220 3d20 426c 6163 6b52 756e 6e65 7228  r = BlackRunner(
-00013de0: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
-00013df0: 203d 2072 756e 6e65 722e 696e 766f 6b65   = runner.invoke
-00013e00: 280a 2020 2020 2020 2020 2020 2020 626c  (.            bl
-00013e10: 6163 6b2e 6d61 696e 2c20 5b22 2d2d 6c69  ack.main, ["--li
-00013e20: 6e65 2d72 616e 6765 733d 312d 3122 2c20  ne-ranges=1-1", 
-00013e30: 222d 225d 2c20 696e 7075 743d 4279 7465  "-"], input=Byte
-00013e40: 7349 4f28 636f 6465 2e65 6e63 6f64 6528  sIO(code.encode(
-00013e50: 2275 7466 2d38 2229 290a 2020 2020 2020  "utf-8")).      
-00013e60: 2020 290a 0a20 2020 2020 2020 2065 7870    )..        exp
-00013e70: 6563 7465 6420 3d20 7465 7874 7772 6170  ected = textwrap
-00013e80: 2e64 6564 656e 7428 2222 225c 0a20 2020  .dedent("""\.   
-00013e90: 2020 2020 2020 2020 2069 6620 6120 3d3d           if a ==
-00013ea0: 2062 3a0a 2020 2020 2020 2020 2020 2020   b:.            
-00013eb0: 2020 2020 7072 696e 7420 2028 2022 4f4b      print  ( "OK
-00013ec0: 2220 290a 2020 2020 2020 2020 2020 2020  " ).            
-00013ed0: 2222 2229 0a20 2020 2020 2020 2073 656c  """).        sel
-00013ee0: 662e 636f 6d70 6172 655f 7265 7375 6c74  f.compare_result
-00013ef0: 7328 7265 7375 6c74 2c20 6578 7065 6374  s(result, expect
-00013f00: 6564 2c20 6578 7065 6374 6564 5f65 7869  ed, expected_exi
-00013f10: 745f 636f 6465 3d30 290a 0a20 2020 2064  t_code=0)..    d
-00013f20: 6566 2074 6573 745f 6c69 6e65 5f72 616e  ef test_line_ran
-00013f30: 6765 735f 7769 7468 5f73 6f75 7263 6528  ges_with_source(
-00013f40: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00013f50: 2020 2020 2020 2077 6974 6820 5465 6d70         with Temp
-00013f60: 6f72 6172 7944 6972 6563 746f 7279 2829  oraryDirectory()
-00013f70: 2061 7320 776f 726b 7370 6163 653a 0a20   as workspace:. 
-00013f80: 2020 2020 2020 2020 2020 2074 6573 745f             test_
-00013f90: 6669 6c65 203d 2050 6174 6828 776f 726b  file = Path(work
-00013fa0: 7370 6163 6529 202f 2022 7465 7374 2e70  space) / "test.p
-00013fb0: 7922 0a20 2020 2020 2020 2020 2020 2074  y".            t
-00013fc0: 6573 745f 6669 6c65 2e77 7269 7465 5f74  est_file.write_t
-00013fd0: 6578 7428 0a20 2020 2020 2020 2020 2020  ext(.           
-00013fe0: 2020 2020 2074 6578 7477 7261 702e 6465       textwrap.de
-00013ff0: 6465 6e74 2822 2222 5c0a 2020 2020 2020  dent("""\.      
-00014000: 2020 2020 2020 6966 2020 6120 203d 3d20        if  a  == 
-00014010: 2062 3a0a 2020 2020 2020 2020 2020 2020   b:.            
-00014020: 2020 2020 7072 696e 7420 2028 2022 4f4b      print  ( "OK
-00014030: 2220 290a 2020 2020 2020 2020 2020 2020  " ).            
-00014040: 2222 2229 2c0a 2020 2020 2020 2020 2020  """),.          
-00014050: 2020 2020 2020 656e 636f 6469 6e67 3d22        encoding="
-00014060: 7574 662d 3822 2c0a 2020 2020 2020 2020  utf-8",.        
-00014070: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00014080: 2020 6172 6773 203d 205b 222d 2d6c 696e    args = ["--lin
-00014090: 652d 7261 6e67 6573 3d31 2d31 222c 2073  e-ranges=1-1", s
-000140a0: 7472 2874 6573 745f 6669 6c65 295d 0a20  tr(test_file)]. 
-000140b0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-000140c0: 7420 3d20 436c 6952 756e 6e65 7228 292e  t = CliRunner().
-000140d0: 696e 766f 6b65 2862 6c61 636b 2e6d 6169  invoke(black.mai
-000140e0: 6e2c 2061 7267 7329 0a20 2020 2020 2020  n, args).       
-000140f0: 2020 2020 2061 7373 6572 7420 6e6f 7420       assert not 
-00014100: 7265 7375 6c74 2e65 7869 745f 636f 6465  result.exit_code
-00014110: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00014120: 726d 6174 7465 6420 3d20 7465 7374 5f66  rmatted = test_f
-00014130: 696c 652e 7265 6164 5f74 6578 7428 656e  ile.read_text(en
-00014140: 636f 6469 6e67 3d22 7574 662d 3822 290a  coding="utf-8").
-00014150: 2020 2020 2020 2020 2020 2020 6578 7065              expe
-00014160: 6374 6564 203d 2074 6578 7477 7261 702e  cted = textwrap.
-00014170: 6465 6465 6e74 2822 2222 5c0a 2020 2020  dedent("""\.    
-00014180: 2020 2020 2020 2020 6966 2061 203d 3d20          if a == 
-00014190: 623a 0a20 2020 2020 2020 2020 2020 2020  b:.             
-000141a0: 2020 2070 7269 6e74 2020 2820 224f 4b22     print  ( "OK"
-000141b0: 2029 0a20 2020 2020 2020 2020 2020 2022   ).            "
-000141c0: 2222 290a 2020 2020 2020 2020 2020 2020  "").            
-000141d0: 6173 7365 7274 2065 7870 6563 7465 6420  assert expected 
-000141e0: 3d3d 2066 6f72 6d61 7474 6564 0a0a 2020  == formatted..  
-000141f0: 2020 6465 6620 7465 7374 5f6c 696e 655f    def test_line_
-00014200: 7261 6e67 6573 5f77 6974 685f 6d75 6c74  ranges_with_mult
-00014210: 6970 6c65 5f73 6f75 7263 6573 2873 656c  iple_sources(sel
-00014220: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00014230: 2020 2020 7769 7468 2054 656d 706f 7261      with Tempora
-00014240: 7279 4469 7265 6374 6f72 7928 2920 6173  ryDirectory() as
-00014250: 2077 6f72 6b73 7061 6365 3a0a 2020 2020   workspace:.    
-00014260: 2020 2020 2020 2020 7465 7374 315f 6669          test1_fi
-00014270: 6c65 203d 2050 6174 6828 776f 726b 7370  le = Path(worksp
-00014280: 6163 6529 202f 2022 7465 7374 312e 7079  ace) / "test1.py
-00014290: 220a 2020 2020 2020 2020 2020 2020 7465  ".            te
-000142a0: 7374 315f 6669 6c65 2e77 7269 7465 5f74  st1_file.write_t
-000142b0: 6578 7428 2222 2c20 656e 636f 6469 6e67  ext("", encoding
-000142c0: 3d22 7574 662d 3822 290a 2020 2020 2020  ="utf-8").      
-000142d0: 2020 2020 2020 7465 7374 325f 6669 6c65        test2_file
-000142e0: 203d 2050 6174 6828 776f 726b 7370 6163   = Path(workspac
-000142f0: 6529 202f 2022 7465 7374 322e 7079 220a  e) / "test2.py".
-00014300: 2020 2020 2020 2020 2020 2020 7465 7374              test
-00014310: 325f 6669 6c65 2e77 7269 7465 5f74 6578  2_file.write_tex
-00014320: 7428 2222 2c20 656e 636f 6469 6e67 3d22  t("", encoding="
-00014330: 7574 662d 3822 290a 2020 2020 2020 2020  utf-8").        
-00014340: 2020 2020 6172 6773 203d 205b 222d 2d6c      args = ["--l
-00014350: 696e 652d 7261 6e67 6573 3d31 2d31 222c  ine-ranges=1-1",
-00014360: 2073 7472 2874 6573 7431 5f66 696c 6529   str(test1_file)
-00014370: 2c20 7374 7228 7465 7374 325f 6669 6c65  , str(test2_file
-00014380: 295d 0a20 2020 2020 2020 2020 2020 2072  )].            r
-00014390: 6573 756c 7420 3d20 436c 6952 756e 6e65  esult = CliRunne
-000143a0: 7228 292e 696e 766f 6b65 2862 6c61 636b  r().invoke(black
-000143b0: 2e6d 6169 6e2c 2061 7267 7329 0a20 2020  .main, args).   
-000143c0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-000143d0: 7265 7375 6c74 2e65 7869 745f 636f 6465  result.exit_code
-000143e0: 203d 3d20 310a 2020 2020 2020 2020 2020   == 1.          
-000143f0: 2020 6173 7365 7274 2022 4361 6e6e 6f74    assert "Cannot
-00014400: 2075 7365 202d 2d6c 696e 652d 7261 6e67   use --line-rang
-00014410: 6573 2074 6f20 666f 726d 6174 206d 756c  es to format mul
-00014420: 7469 706c 6520 6669 6c65 7322 2069 6e20  tiple files" in 
-00014430: 7265 7375 6c74 2e6f 7574 7075 740a 0a20  result.output.. 
-00014440: 2020 2064 6566 2074 6573 745f 6c69 6e65     def test_line
-00014450: 5f72 616e 6765 735f 7769 7468 5f69 7079  _ranges_with_ipy
-00014460: 6e62 2873 656c 6629 202d 3e20 4e6f 6e65  nb(self) -> None
-00014470: 3a0a 2020 2020 2020 2020 7769 7468 2054  :.        with T
-00014480: 656d 706f 7261 7279 4469 7265 6374 6f72  emporaryDirector
-00014490: 7928 2920 6173 2077 6f72 6b73 7061 6365  y() as workspace
-000144a0: 3a0a 2020 2020 2020 2020 2020 2020 7465  :.            te
-000144b0: 7374 5f66 696c 6520 3d20 5061 7468 2877  st_file = Path(w
-000144c0: 6f72 6b73 7061 6365 2920 2f20 2274 6573  orkspace) / "tes
-000144d0: 742e 6970 796e 6222 0a20 2020 2020 2020  t.ipynb".       
-000144e0: 2020 2020 2074 6573 745f 6669 6c65 2e77       test_file.w
-000144f0: 7269 7465 5f74 6578 7428 227b 7d22 2c20  rite_text("{}", 
-00014500: 656e 636f 6469 6e67 3d22 7574 662d 3822  encoding="utf-8"
-00014510: 290a 2020 2020 2020 2020 2020 2020 6172  ).            ar
-00014520: 6773 203d 205b 222d 2d6c 696e 652d 7261  gs = ["--line-ra
-00014530: 6e67 6573 3d31 2d31 222c 2022 2d2d 6970  nges=1-1", "--ip
-00014540: 796e 6222 2c20 7374 7228 7465 7374 5f66  ynb", str(test_f
-00014550: 696c 6529 5d0a 2020 2020 2020 2020 2020  ile)].          
-00014560: 2020 7265 7375 6c74 203d 2043 6c69 5275    result = CliRu
-00014570: 6e6e 6572 2829 2e69 6e76 6f6b 6528 626c  nner().invoke(bl
-00014580: 6163 6b2e 6d61 696e 2c20 6172 6773 290a  ack.main, args).
-00014590: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-000145a0: 7274 2022 4361 6e6e 6f74 2075 7365 202d  rt "Cannot use -
-000145b0: 2d6c 696e 652d 7261 6e67 6573 2077 6974  -line-ranges wit
-000145c0: 6820 6970 796e 6220 6669 6c65 7322 2069  h ipynb files" i
-000145d0: 6e20 7265 7375 6c74 2e6f 7574 7075 740a  n result.output.
-000145e0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-000145f0: 7274 2072 6573 756c 742e 6578 6974 5f63  rt result.exit_c
-00014600: 6f64 6520 3d3d 2031 0a0a 2020 2020 6465  ode == 1..    de
-00014610: 6620 7465 7374 5f6c 696e 655f 7261 6e67  f test_line_rang
-00014620: 6573 5f69 6e5f 7079 7072 6f6a 6563 745f  es_in_pyproject_
-00014630: 746f 6d6c 2873 656c 6629 202d 3e20 4e6f  toml(self) -> No
-00014640: 6e65 3a0a 2020 2020 2020 2020 636f 6e66  ne:.        conf
-00014650: 6967 203d 2054 4849 535f 4449 5220 2f20  ig = THIS_DIR / 
-00014660: 2264 6174 6122 202f 2022 696e 7661 6c69  "data" / "invali
-00014670: 645f 6c69 6e65 5f72 616e 6765 732e 746f  d_line_ranges.to
-00014680: 6d6c 220a 2020 2020 2020 2020 7265 7375  ml".        resu
-00014690: 6c74 203d 2042 6c61 636b 5275 6e6e 6572  lt = BlackRunner
-000146a0: 2829 2e69 6e76 6f6b 6528 0a20 2020 2020  ().invoke(.     
-000146b0: 2020 2020 2020 2062 6c61 636b 2e6d 6169         black.mai
-000146c0: 6e2c 205b 222d 2d63 6f64 6522 2c20 2270  n, ["--code", "p
-000146d0: 7269 6e74 2829 222c 2022 2d2d 636f 6e66  rint()", "--conf
-000146e0: 6967 222c 2073 7472 2863 6f6e 6669 6729  ig", str(config)
-000146f0: 5d0a 2020 2020 2020 2020 290a 2020 2020  ].        ).    
-00014700: 2020 2020 6173 7365 7274 2072 6573 756c      assert resul
-00014710: 742e 6578 6974 5f63 6f64 6520 3d3d 2032  t.exit_code == 2
-00014720: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00014730: 7265 7375 6c74 2e73 7464 6572 725f 6279  result.stderr_by
-00014740: 7465 7320 6973 206e 6f74 204e 6f6e 650a  tes is not None.
-00014750: 2020 2020 2020 2020 6173 7365 7274 2028          assert (
-00014760: 0a20 2020 2020 2020 2020 2020 2062 2243  .            b"C
-00014770: 616e 6e6f 7420 7573 6520 6c69 6e65 2d72  annot use line-r
-00014780: 616e 6765 7320 696e 2074 6865 2070 7970  anges in the pyp
-00014790: 726f 6a65 6374 2e74 6f6d 6c20 6669 6c65  roject.toml file
-000147a0: 2e22 2069 6e20 7265 7375 6c74 2e73 7464  ." in result.std
-000147b0: 6572 725f 6279 7465 730a 2020 2020 2020  err_bytes.      
-000147c0: 2020 290a 0a20 2020 2064 6566 2074 6573    )..    def tes
-000147d0: 745f 6c69 6e65 735f 7769 7468 5f6c 6561  t_lines_with_lea
-000147e0: 6469 6e67 5f74 6162 735f 6578 7061 6e64  ding_tabs_expand
-000147f0: 6564 2873 656c 6629 202d 3e20 4e6f 6e65  ed(self) -> None
-00014800: 3a0a 2020 2020 2020 2020 2320 5365 6520  :.        # See 
-00014810: 4356 452d 3230 3234 2d32 3135 3033 2e20  CVE-2024-21503. 
-00014820: 4d6f 7374 6c79 2074 6573 7420 7468 6174  Mostly test that
-00014830: 2074 6869 7320 636f 6d70 6c65 7465 7320   this completes 
-00014840: 696e 2061 2072 6561 736f 6e61 626c 650a  in a reasonable.
-00014850: 2020 2020 2020 2020 2320 7469 6d65 2e0a          # time..
-00014860: 2020 2020 2020 2020 7061 796c 6f61 6420          payload 
-00014870: 3d20 225c 7422 202a 2031 305f 3030 300a  = "\t" * 10_000.
-00014880: 2020 2020 2020 2020 6173 7365 7274 206c          assert l
-00014890: 696e 6573 5f77 6974 685f 6c65 6164 696e  ines_with_leadin
-000148a0: 675f 7461 6273 5f65 7870 616e 6465 6428  g_tabs_expanded(
-000148b0: 7061 796c 6f61 6429 203d 3d20 5b70 6179  payload) == [pay
-000148c0: 6c6f 6164 5d0a 0a20 2020 2020 2020 2074  load]..        t
-000148d0: 6162 203d 2022 2022 202a 2038 0a20 2020  ab = " " * 8.   
-000148e0: 2020 2020 2061 7373 6572 7420 6c69 6e65       assert line
-000148f0: 735f 7769 7468 5f6c 6561 6469 6e67 5f74  s_with_leading_t
-00014900: 6162 735f 6578 7061 6e64 6564 2822 5c74  abs_expanded("\t
-00014910: 7822 2920 3d3d 205b 6622 7b74 6162 7d78  x") == [f"{tab}x
-00014920: 225d 0a20 2020 2020 2020 2061 7373 6572  "].        asser
-00014930: 7420 6c69 6e65 735f 7769 7468 5f6c 6561  t lines_with_lea
-00014940: 6469 6e67 5f74 6162 735f 6578 7061 6e64  ding_tabs_expand
-00014950: 6564 2822 5c74 5c74 7822 2920 3d3d 205b  ed("\t\tx") == [
-00014960: 6622 7b74 6162 7d7b 7461 627d 7822 5d0a  f"{tab}{tab}x"].
-00014970: 2020 2020 2020 2020 6173 7365 7274 206c          assert l
-00014980: 696e 6573 5f77 6974 685f 6c65 6164 696e  ines_with_leadin
-00014990: 675f 7461 6273 5f65 7870 616e 6465 6428  g_tabs_expanded(
-000149a0: 225c 7478 5c6e 2020 7922 2920 3d3d 205b  "\tx\n  y") == [
-000149b0: 6622 7b74 6162 7d78 222c 2022 2020 7922  f"{tab}x", "  y"
-000149c0: 5d0a 0a0a 636c 6173 7320 5465 7374 4361  ]...class TestCa
-000149d0: 6368 696e 673a 0a20 2020 2064 6566 2074  ching:.    def t
-000149e0: 6573 745f 6765 745f 6361 6368 655f 6469  est_get_cache_di
-000149f0: 7228 0a20 2020 2020 2020 2073 656c 662c  r(.        self,
-00014a00: 0a20 2020 2020 2020 2074 6d70 5f70 6174  .        tmp_pat
-00014a10: 683a 2050 6174 682c 0a20 2020 2020 2020  h: Path,.       
-00014a20: 206d 6f6e 6b65 7970 6174 6368 3a20 7079   monkeypatch: py
-00014a30: 7465 7374 2e4d 6f6e 6b65 7950 6174 6368  test.MonkeyPatch
-00014a40: 2c0a 2020 2020 2920 2d3e 204e 6f6e 653a  ,.    ) -> None:
-00014a50: 0a20 2020 2020 2020 2023 2043 7265 6174  .        # Creat
-00014a60: 6520 6d75 6c74 6970 6c65 2063 6163 6865  e multiple cache
-00014a70: 2064 6972 6563 746f 7269 6573 0a20 2020   directories.   
-00014a80: 2020 2020 2077 6f72 6b73 7061 6365 3120       workspace1 
-00014a90: 3d20 746d 705f 7061 7468 202f 2022 7773  = tmp_path / "ws
-00014aa0: 3122 0a20 2020 2020 2020 2077 6f72 6b73  1".        works
-00014ab0: 7061 6365 312e 6d6b 6469 7228 290a 2020  pace1.mkdir().  
-00014ac0: 2020 2020 2020 776f 726b 7370 6163 6532        workspace2
-00014ad0: 203d 2074 6d70 5f70 6174 6820 2f20 2277   = tmp_path / "w
-00014ae0: 7332 220a 2020 2020 2020 2020 776f 726b  s2".        work
-00014af0: 7370 6163 6532 2e6d 6b64 6972 2829 0a0a  space2.mkdir()..
-00014b00: 2020 2020 2020 2020 2320 466f 7263 6520          # Force 
-00014b10: 7573 6572 5f63 6163 6865 5f64 6972 2074  user_cache_dir t
-00014b20: 6f20 7573 6520 7468 6520 7465 6d70 6f72  o use the tempor
-00014b30: 6172 7920 6469 7265 6374 6f72 7920 666f  ary directory fo
-00014b40: 7220 6561 7369 6572 2061 7373 6572 7469  r easier asserti
-00014b50: 6f6e 730a 2020 2020 2020 2020 7061 7463  ons.        patc
-00014b60: 685f 7573 6572 5f63 6163 6865 5f64 6972  h_user_cache_dir
-00014b70: 203d 2070 6174 6368 280a 2020 2020 2020   = patch(.      
-00014b80: 2020 2020 2020 7461 7267 6574 3d22 626c        target="bl
-00014b90: 6163 6b2e 6361 6368 652e 7573 6572 5f63  ack.cache.user_c
-00014ba0: 6163 6865 5f64 6972 222c 0a20 2020 2020  ache_dir",.     
-00014bb0: 2020 2020 2020 2061 7574 6f73 7065 633d         autospec=
-00014bc0: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-00014bd0: 2020 7265 7475 726e 5f76 616c 7565 3d73    return_value=s
-00014be0: 7472 2877 6f72 6b73 7061 6365 3129 2c0a  tr(workspace1),.
-00014bf0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00014c00: 2020 2023 2049 6620 424c 4143 4b5f 4341     # If BLACK_CA
-00014c10: 4348 455f 4449 5220 6973 206e 6f74 2073  CHE_DIR is not s
-00014c20: 6574 2c20 7573 6520 7573 6572 5f63 6163  et, use user_cac
-00014c30: 6865 5f64 6972 0a20 2020 2020 2020 206d  he_dir.        m
-00014c40: 6f6e 6b65 7970 6174 6368 2e64 656c 656e  onkeypatch.delen
-00014c50: 7628 2242 4c41 434b 5f43 4143 4845 5f44  v("BLACK_CACHE_D
-00014c60: 4952 222c 2072 6169 7369 6e67 3d46 616c  IR", raising=Fal
-00014c70: 7365 290a 2020 2020 2020 2020 7769 7468  se).        with
-00014c80: 2070 6174 6368 5f75 7365 725f 6361 6368   patch_user_cach
-00014c90: 655f 6469 723a 0a20 2020 2020 2020 2020  e_dir:.         
-00014ca0: 2020 2061 7373 6572 7420 6765 745f 6361     assert get_ca
-00014cb0: 6368 655f 6469 7228 292e 7061 7265 6e74  che_dir().parent
-00014cc0: 203d 3d20 776f 726b 7370 6163 6531 0a0a   == workspace1..
-00014cd0: 2020 2020 2020 2020 2320 4966 2069 7420          # If it 
-00014ce0: 6973 2073 6574 2c20 7573 6520 7468 6520  is set, use the 
-00014cf0: 7061 7468 2070 726f 7669 6465 6420 696e  path provided in
-00014d00: 2074 6865 2065 6e76 2076 6172 2e0a 2020   the env var..  
-00014d10: 2020 2020 2020 6d6f 6e6b 6579 7061 7463        monkeypatc
-00014d20: 682e 7365 7465 6e76 2822 424c 4143 4b5f  h.setenv("BLACK_
-00014d30: 4341 4348 455f 4449 5222 2c20 7374 7228  CACHE_DIR", str(
-00014d40: 776f 726b 7370 6163 6532 2929 0a20 2020  workspace2)).   
-00014d50: 2020 2020 2061 7373 6572 7420 6765 745f       assert get_
-00014d60: 6361 6368 655f 6469 7228 292e 7061 7265  cache_dir().pare
-00014d70: 6e74 203d 3d20 776f 726b 7370 6163 6532  nt == workspace2
-00014d80: 0a0a 2020 2020 6465 6620 7465 7374 5f63  ..    def test_c
-00014d90: 6163 6865 5f66 696c 655f 6c65 6e67 7468  ache_file_length
-00014da0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00014db0: 2020 2020 2020 2020 6361 7365 7320 3d20          cases = 
-00014dc0: 5b0a 2020 2020 2020 2020 2020 2020 4445  [.            DE
-00014dd0: 4641 554c 545f 4d4f 4445 2c0a 2020 2020  FAULT_MODE,.    
-00014de0: 2020 2020 2020 2020 2320 616c 6c20 6f66          # all of
-00014df0: 2074 6865 2074 6172 6765 7420 7665 7273   the target vers
-00014e00: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
-00014e10: 204d 6f64 6528 7461 7267 6574 5f76 6572   Mode(target_ver
-00014e20: 7369 6f6e 733d 7365 7428 5461 7267 6574  sions=set(Target
-00014e30: 5665 7273 696f 6e29 292c 0a20 2020 2020  Version)),.     
-00014e40: 2020 2020 2020 2023 2061 6c6c 206f 6620         # all of 
-00014e50: 7468 6520 6665 6174 7572 6573 0a20 2020  the features.   
-00014e60: 2020 2020 2020 2020 204d 6f64 6528 656e           Mode(en
-00014e70: 6162 6c65 645f 6665 6174 7572 6573 3d73  abled_features=s
-00014e80: 6574 2850 7265 7669 6577 2929 2c0a 2020  et(Preview)),.  
-00014e90: 2020 2020 2020 2020 2020 2320 616c 6c20            # all 
-00014ea0: 6f66 2074 6865 206d 6167 6963 730a 2020  of the magics.  
-00014eb0: 2020 2020 2020 2020 2020 4d6f 6465 2870            Mode(p
-00014ec0: 7974 686f 6e5f 6365 6c6c 5f6d 6167 6963  ython_cell_magic
-00014ed0: 733d 7b66 226d 6167 6963 7b69 7d22 2066  s={f"magic{i}" f
-00014ee0: 6f72 2069 2069 6e20 7261 6e67 6528 3530  or i in range(50
-00014ef0: 3029 7d29 2c0a 2020 2020 2020 2020 2020  0)}),.          
-00014f00: 2020 2320 616c 6c20 6f66 2074 6865 2074    # all of the t
-00014f10: 6869 6e67 730a 2020 2020 2020 2020 2020  hings.          
-00014f20: 2020 4d6f 6465 280a 2020 2020 2020 2020    Mode(.        
-00014f30: 2020 2020 2020 2020 7461 7267 6574 5f76          target_v
-00014f40: 6572 7369 6f6e 733d 7365 7428 5461 7267  ersions=set(Targ
-00014f50: 6574 5665 7273 696f 6e29 2c0a 2020 2020  etVersion),.    
-00014f60: 2020 2020 2020 2020 2020 2020 656e 6162              enab
-00014f70: 6c65 645f 6665 6174 7572 6573 3d73 6574  led_features=set
-00014f80: 2850 7265 7669 6577 292c 0a20 2020 2020  (Preview),.     
-00014f90: 2020 2020 2020 2020 2020 2070 7974 686f             pytho
-00014fa0: 6e5f 6365 6c6c 5f6d 6167 6963 733d 7b66  n_cell_magics={f
-00014fb0: 226d 6167 6963 7b69 7d22 2066 6f72 2069  "magic{i}" for i
-00014fc0: 2069 6e20 7261 6e67 6528 3530 3029 7d2c   in range(500)},
-00014fd0: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
-00014fe0: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-00014ff0: 2020 666f 7220 6361 7365 2069 6e20 6361    for case in ca
-00015000: 7365 733a 0a20 2020 2020 2020 2020 2020  ses:.           
-00015010: 2063 6163 6865 5f66 696c 6520 3d20 6765   cache_file = ge
-00015020: 745f 6361 6368 655f 6669 6c65 2863 6173  t_cache_file(cas
-00015030: 6529 0a20 2020 2020 2020 2020 2020 2023  e).            #
-00015040: 2053 6f6d 6520 636f 6d6d 6f6e 2066 696c   Some common fil
-00015050: 6520 7379 7374 656d 7320 656e 666f 7263  e systems enforc
-00015060: 6520 6120 6d61 7869 6d75 6d20 7061 7468  e a maximum path
-00015070: 206c 656e 6774 680a 2020 2020 2020 2020   length.        
-00015080: 2020 2020 2320 6f66 2031 3433 2028 6973      # of 143 (is
-00015090: 7375 6520 2334 3137 3429 2e20 5765 2063  sue #4174). We c
-000150a0: 616e 2774 2064 6f20 616e 7974 6869 6e67  an't do anything
-000150b0: 2069 6620 7468 6520 6469 7265 6374 6f72   if the director
-000150c0: 790a 2020 2020 2020 2020 2020 2020 2320  y.            # 
-000150d0: 7061 7468 2069 7320 746f 6f20 6c6f 6e67  path is too long
-000150e0: 2c20 6275 7420 656e 7375 7265 2074 6865  , but ensure the
-000150f0: 206e 616d 6520 6f66 2074 6865 2063 6163   name of the cac
-00015100: 6865 2066 696c 6520 6974 7365 6c66 0a20  he file itself. 
-00015110: 2020 2020 2020 2020 2020 2023 2064 6f65             # doe
-00015120: 736e 2774 2067 6574 2074 6f6f 2063 7261  sn't get too cra
-00015130: 7a79 2e0a 2020 2020 2020 2020 2020 2020  zy..            
-00015140: 6173 7365 7274 206c 656e 2863 6163 6865  assert len(cache
-00015150: 5f66 696c 652e 6e61 6d65 2920 3c3d 2039  _file.name) <= 9
-00015160: 360a 0a20 2020 2064 6566 2074 6573 745f  6..    def test_
-00015170: 6361 6368 655f 6272 6f6b 656e 5f66 696c  cache_broken_fil
-00015180: 6528 7365 6c66 2920 2d3e 204e 6f6e 653a  e(self) -> None:
-00015190: 0a20 2020 2020 2020 206d 6f64 6520 3d20  .        mode = 
-000151a0: 4445 4641 554c 545f 4d4f 4445 0a20 2020  DEFAULT_MODE.   
-000151b0: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
-000151c0: 6469 7228 2920 6173 2077 6f72 6b73 7061  dir() as workspa
-000151d0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-000151e0: 6361 6368 655f 6669 6c65 203d 2067 6574  cache_file = get
-000151f0: 5f63 6163 6865 5f66 696c 6528 6d6f 6465  _cache_file(mode
-00015200: 290a 2020 2020 2020 2020 2020 2020 6361  ).            ca
-00015210: 6368 655f 6669 6c65 2e77 7269 7465 5f74  che_file.write_t
-00015220: 6578 7428 2274 6869 7320 6973 206e 6f74  ext("this is not
-00015230: 2061 2070 6963 6b6c 6522 2c20 656e 636f   a pickle", enco
-00015240: 6469 6e67 3d22 7574 662d 3822 290a 2020  ding="utf-8").  
-00015250: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00015260: 2062 6c61 636b 2e43 6163 6865 2e72 6561   black.Cache.rea
-00015270: 6428 6d6f 6465 292e 6669 6c65 5f64 6174  d(mode).file_dat
-00015280: 6120 3d3d 207b 7d0a 2020 2020 2020 2020  a == {}.        
-00015290: 2020 2020 7372 6320 3d20 2877 6f72 6b73      src = (works
-000152a0: 7061 6365 202f 2022 7465 7374 2e70 7922  pace / "test.py"
-000152b0: 292e 7265 736f 6c76 6528 290a 2020 2020  ).resolve().    
-000152c0: 2020 2020 2020 2020 7372 632e 7772 6974          src.writ
-000152d0: 655f 7465 7874 2822 7072 696e 7428 2768  e_text("print('h
-000152e0: 656c 6c6f 2729 222c 2065 6e63 6f64 696e  ello')", encodin
-000152f0: 673d 2275 7466 2d38 2229 0a20 2020 2020  g="utf-8").     
-00015300: 2020 2020 2020 2069 6e76 6f6b 6542 6c61         invokeBla
-00015310: 636b 285b 7374 7228 7372 6329 5d29 0a20  ck([str(src)]). 
-00015320: 2020 2020 2020 2020 2020 2063 6163 6865             cache
-00015330: 203d 2062 6c61 636b 2e43 6163 6865 2e72   = black.Cache.r
-00015340: 6561 6428 6d6f 6465 290a 2020 2020 2020  ead(mode).      
-00015350: 2020 2020 2020 6173 7365 7274 206e 6f74        assert not
-00015360: 2063 6163 6865 2e69 735f 6368 616e 6765   cache.is_change
-00015370: 6428 7372 6329 0a0a 2020 2020 6465 6620  d(src)..    def 
-00015380: 7465 7374 5f63 6163 6865 5f73 696e 676c  test_cache_singl
-00015390: 655f 6669 6c65 5f61 6c72 6561 6479 5f63  e_file_already_c
-000153a0: 6163 6865 6428 7365 6c66 2920 2d3e 204e  ached(self) -> N
-000153b0: 6f6e 653a 0a20 2020 2020 2020 206d 6f64  one:.        mod
-000153c0: 6520 3d20 4445 4641 554c 545f 4d4f 4445  e = DEFAULT_MODE
-000153d0: 0a20 2020 2020 2020 2077 6974 6820 6361  .        with ca
-000153e0: 6368 655f 6469 7228 2920 6173 2077 6f72  che_dir() as wor
-000153f0: 6b73 7061 6365 3a0a 2020 2020 2020 2020  kspace:.        
-00015400: 2020 2020 7372 6320 3d20 2877 6f72 6b73      src = (works
-00015410: 7061 6365 202f 2022 7465 7374 2e70 7922  pace / "test.py"
-00015420: 292e 7265 736f 6c76 6528 290a 2020 2020  ).resolve().    
-00015430: 2020 2020 2020 2020 7372 632e 7772 6974          src.writ
-00015440: 655f 7465 7874 2822 7072 696e 7428 2768  e_text("print('h
-00015450: 656c 6c6f 2729 222c 2065 6e63 6f64 696e  ello')", encodin
-00015460: 673d 2275 7466 2d38 2229 0a20 2020 2020  g="utf-8").     
-00015470: 2020 2020 2020 2063 6163 6865 203d 2062         cache = b
-00015480: 6c61 636b 2e43 6163 6865 2e72 6561 6428  lack.Cache.read(
-00015490: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
-000154a0: 2020 6361 6368 652e 7772 6974 6528 5b73    cache.write([s
-000154b0: 7263 5d29 0a20 2020 2020 2020 2020 2020  rc]).           
-000154c0: 2069 6e76 6f6b 6542 6c61 636b 285b 7374   invokeBlack([st
-000154d0: 7228 7372 6329 5d29 0a20 2020 2020 2020  r(src)]).       
-000154e0: 2020 2020 2061 7373 6572 7420 7372 632e       assert src.
-000154f0: 7265 6164 5f74 6578 7428 656e 636f 6469  read_text(encodi
-00015500: 6e67 3d22 7574 662d 3822 2920 3d3d 2022  ng="utf-8") == "
-00015510: 7072 696e 7428 2768 656c 6c6f 2729 220a  print('hello')".
-00015520: 0a20 2020 2040 6576 656e 745f 6c6f 6f70  .    @event_loop
-00015530: 2829 0a20 2020 2064 6566 2074 6573 745f  ().    def test_
-00015540: 6361 6368 655f 6d75 6c74 6970 6c65 5f66  cache_multiple_f
-00015550: 696c 6573 2873 656c 6629 202d 3e20 4e6f  iles(self) -> No
-00015560: 6e65 3a0a 2020 2020 2020 2020 6d6f 6465  ne:.        mode
-00015570: 203d 2044 4546 4155 4c54 5f4d 4f44 450a   = DEFAULT_MODE.
-00015580: 2020 2020 2020 2020 7769 7468 2063 6163          with cac
-00015590: 6865 5f64 6972 2829 2061 7320 776f 726b  he_dir() as work
-000155a0: 7370 6163 652c 2070 6174 6368 280a 2020  space, patch(.  
-000155b0: 2020 2020 2020 2020 2020 2263 6f6e 6375            "concu
-000155c0: 7272 656e 742e 6675 7475 7265 732e 5072  rrent.futures.Pr
-000155d0: 6f63 6573 7350 6f6f 6c45 7865 6375 746f  ocessPoolExecuto
-000155e0: 7222 2c20 6e65 773d 5468 7265 6164 506f  r", new=ThreadPo
-000155f0: 6f6c 4578 6563 7574 6f72 0a20 2020 2020  olExecutor.     
-00015600: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-00015610: 2020 6f6e 6520 3d20 2877 6f72 6b73 7061    one = (workspa
-00015620: 6365 202f 2022 6f6e 652e 7079 2229 2e72  ce / "one.py").r
-00015630: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
-00015640: 2020 2020 206f 6e65 2e77 7269 7465 5f74       one.write_t
-00015650: 6578 7428 2270 7269 6e74 2827 6865 6c6c  ext("print('hell
-00015660: 6f27 2922 2c20 656e 636f 6469 6e67 3d22  o')", encoding="
-00015670: 7574 662d 3822 290a 2020 2020 2020 2020  utf-8").        
-00015680: 2020 2020 7477 6f20 3d20 2877 6f72 6b73      two = (works
-00015690: 7061 6365 202f 2022 7477 6f2e 7079 2229  pace / "two.py")
-000156a0: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
-000156b0: 2020 2020 2020 2074 776f 2e77 7269 7465         two.write
-000156c0: 5f74 6578 7428 2270 7269 6e74 2827 6865  _text("print('he
-000156d0: 6c6c 6f27 2922 2c20 656e 636f 6469 6e67  llo')", encoding
-000156e0: 3d22 7574 662d 3822 290a 2020 2020 2020  ="utf-8").      
-000156f0: 2020 2020 2020 6361 6368 6520 3d20 626c        cache = bl
-00015700: 6163 6b2e 4361 6368 652e 7265 6164 286d  ack.Cache.read(m
-00015710: 6f64 6529 0a20 2020 2020 2020 2020 2020  ode).           
-00015720: 2063 6163 6865 2e77 7269 7465 285b 6f6e   cache.write([on
-00015730: 655d 290a 2020 2020 2020 2020 2020 2020  e]).            
-00015740: 696e 766f 6b65 426c 6163 6b28 5b73 7472  invokeBlack([str
-00015750: 2877 6f72 6b73 7061 6365 295d 290a 2020  (workspace)]).  
-00015760: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00015770: 206f 6e65 2e72 6561 645f 7465 7874 2865   one.read_text(e
-00015780: 6e63 6f64 696e 673d 2275 7466 2d38 2229  ncoding="utf-8")
-00015790: 203d 3d20 2270 7269 6e74 2827 6865 6c6c   == "print('hell
-000157a0: 6f27 2922 0a20 2020 2020 2020 2020 2020  o')".           
-000157b0: 2061 7373 6572 7420 7477 6f2e 7265 6164   assert two.read
-000157c0: 5f74 6578 7428 656e 636f 6469 6e67 3d22  _text(encoding="
-000157d0: 7574 662d 3822 2920 3d3d 2027 7072 696e  utf-8") == 'prin
-000157e0: 7428 2268 656c 6c6f 2229 5c6e 270a 2020  t("hello")\n'.  
-000157f0: 2020 2020 2020 2020 2020 6361 6368 6520            cache 
-00015800: 3d20 626c 6163 6b2e 4361 6368 652e 7265  = black.Cache.re
-00015810: 6164 286d 6f64 6529 0a20 2020 2020 2020  ad(mode).       
-00015820: 2020 2020 2061 7373 6572 7420 6e6f 7420       assert not 
-00015830: 6361 6368 652e 6973 5f63 6861 6e67 6564  cache.is_changed
-00015840: 286f 6e65 290a 2020 2020 2020 2020 2020  (one).          
-00015850: 2020 6173 7365 7274 206e 6f74 2063 6163    assert not cac
-00015860: 6865 2e69 735f 6368 616e 6765 6428 7477  he.is_changed(tw
-00015870: 6f29 0a0a 2020 2020 4070 7974 6573 742e  o)..    @pytest.
-00015880: 6d61 726b 2e69 6e63 6f6d 7061 7469 626c  mark.incompatibl
-00015890: 655f 7769 7468 5f6d 7970 7963 0a20 2020  e_with_mypyc.   
-000158a0: 2040 7079 7465 7374 2e6d 6172 6b2e 7061   @pytest.mark.pa
-000158b0: 7261 6d65 7472 697a 6528 2263 6f6c 6f72  rametrize("color
-000158c0: 222c 205b 4661 6c73 652c 2054 7275 655d  ", [False, True]
-000158d0: 2c20 6964 733d 5b22 6e6f 2d63 6f6c 6f72  , ids=["no-color
-000158e0: 222c 2022 7769 7468 2d63 6f6c 6f72 225d  ", "with-color"]
-000158f0: 290a 2020 2020 6465 6620 7465 7374 5f6e  ).    def test_n
-00015900: 6f5f 6361 6368 655f 7768 656e 5f77 7269  o_cache_when_wri
-00015910: 7465 6261 636b 5f64 6966 6628 7365 6c66  teback_diff(self
-00015920: 2c20 636f 6c6f 723a 2062 6f6f 6c29 202d  , color: bool) -
-00015930: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00015940: 6d6f 6465 203d 2044 4546 4155 4c54 5f4d  mode = DEFAULT_M
-00015950: 4f44 450a 2020 2020 2020 2020 7769 7468  ODE.        with
-00015960: 2063 6163 6865 5f64 6972 2829 2061 7320   cache_dir() as 
-00015970: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
-00015980: 2020 2020 2020 2073 7263 203d 2028 776f         src = (wo
-00015990: 726b 7370 6163 6520 2f20 2274 6573 742e  rkspace / "test.
-000159a0: 7079 2229 2e72 6573 6f6c 7665 2829 0a20  py").resolve(). 
-000159b0: 2020 2020 2020 2020 2020 2073 7263 2e77             src.w
-000159c0: 7269 7465 5f74 6578 7428 2270 7269 6e74  rite_text("print
-000159d0: 2827 6865 6c6c 6f27 2922 2c20 656e 636f  ('hello')", enco
-000159e0: 6469 6e67 3d22 7574 662d 3822 290a 2020  ding="utf-8").  
-000159f0: 2020 2020 2020 2020 2020 7769 7468 2070            with p
-00015a00: 6174 6368 2e6f 626a 6563 7428 626c 6163  atch.object(blac
-00015a10: 6b2e 4361 6368 652c 2022 7265 6164 2229  k.Cache, "read")
-00015a20: 2061 7320 7265 6164 5f63 6163 6865 2c20   as read_cache, 
-00015a30: 7061 7463 682e 6f62 6a65 6374 280a 2020  patch.object(.  
-00015a40: 2020 2020 2020 2020 2020 2020 2020 626c                bl
-00015a50: 6163 6b2e 4361 6368 652c 2022 7772 6974  ack.Cache, "writ
-00015a60: 6522 0a20 2020 2020 2020 2020 2020 2029  e".            )
-00015a70: 2061 7320 7772 6974 655f 6361 6368 653a   as write_cache:
-00015a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015a90: 2063 6d64 203d 205b 7374 7228 7372 6329   cmd = [str(src)
-00015aa0: 2c20 222d 2d64 6966 6622 5d0a 2020 2020  , "--diff"].    
-00015ab0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00015ac0: 6f6c 6f72 3a0a 2020 2020 2020 2020 2020  olor:.          
-00015ad0: 2020 2020 2020 2020 2020 636d 642e 6170            cmd.ap
-00015ae0: 7065 6e64 2822 2d2d 636f 6c6f 7222 290a  pend("--color").
-00015af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b00: 696e 766f 6b65 426c 6163 6b28 636d 6429  invokeBlack(cmd)
-00015b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015b20: 2063 6163 6865 5f66 696c 6520 3d20 6765   cache_file = ge
-00015b30: 745f 6361 6368 655f 6669 6c65 286d 6f64  t_cache_file(mod
-00015b40: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00015b50: 2020 2061 7373 6572 7420 6361 6368 655f     assert cache_
-00015b60: 6669 6c65 2e65 7869 7374 7328 2920 6973  file.exists() is
-00015b70: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-00015b80: 2020 2020 2020 2072 6561 645f 6361 6368         read_cach
-00015b90: 652e 6173 7365 7274 5f63 616c 6c65 645f  e.assert_called_
-00015ba0: 6f6e 6365 2829 0a20 2020 2020 2020 2020  once().         
-00015bb0: 2020 2020 2020 2077 7269 7465 5f63 6163         write_cac
-00015bc0: 6865 2e61 7373 6572 745f 6e6f 745f 6361  he.assert_not_ca
-00015bd0: 6c6c 6564 2829 0a0a 2020 2020 4070 7974  lled()..    @pyt
-00015be0: 6573 742e 6d61 726b 2e70 6172 616d 6574  est.mark.paramet
-00015bf0: 7269 7a65 2822 636f 6c6f 7222 2c20 5b46  rize("color", [F
-00015c00: 616c 7365 2c20 5472 7565 5d2c 2069 6473  alse, True], ids
-00015c10: 3d5b 226e 6f2d 636f 6c6f 7222 2c20 2277  =["no-color", "w
-00015c20: 6974 682d 636f 6c6f 7222 5d29 0a20 2020  ith-color"]).   
-00015c30: 2040 6576 656e 745f 6c6f 6f70 2829 0a20   @event_loop(). 
-00015c40: 2020 2064 6566 2074 6573 745f 6f75 7470     def test_outp
-00015c50: 7574 5f6c 6f63 6b69 6e67 5f77 6865 6e5f  ut_locking_when_
-00015c60: 7772 6974 6562 6163 6b5f 6469 6666 2873  writeback_diff(s
-00015c70: 656c 662c 2063 6f6c 6f72 3a20 626f 6f6c  elf, color: bool
-00015c80: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00015c90: 2020 2077 6974 6820 6361 6368 655f 6469     with cache_di
-00015ca0: 7228 2920 6173 2077 6f72 6b73 7061 6365  r() as workspace
-00015cb0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00015cc0: 7220 7461 6720 696e 2072 616e 6765 2830  r tag in range(0
-00015cd0: 2c20 3429 3a0a 2020 2020 2020 2020 2020  , 4):.          
-00015ce0: 2020 2020 2020 7372 6320 3d20 2877 6f72        src = (wor
-00015cf0: 6b73 7061 6365 202f 2066 2274 6573 747b  kspace / f"test{
-00015d00: 7461 677d 2e70 7922 292e 7265 736f 6c76  tag}.py").resolv
-00015d10: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-00015d20: 2020 2020 7372 632e 7772 6974 655f 7465      src.write_te
-00015d30: 7874 2822 7072 696e 7428 2768 656c 6c6f  xt("print('hello
-00015d40: 2729 222c 2065 6e63 6f64 696e 673d 2275  ')", encoding="u
-00015d50: 7466 2d38 2229 0a20 2020 2020 2020 2020  tf-8").         
-00015d60: 2020 2077 6974 6820 7061 7463 6828 0a20     with patch(. 
-00015d70: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00015d80: 626c 6163 6b2e 636f 6e63 7572 7265 6e63  black.concurrenc
-00015d90: 792e 4d61 6e61 6765 7222 2c20 7772 6170  y.Manager", wrap
-00015da0: 733d 6d75 6c74 6970 726f 6365 7373 696e  s=multiprocessin
-00015db0: 672e 4d61 6e61 6765 720a 2020 2020 2020  g.Manager.      
-00015dc0: 2020 2020 2020 2920 6173 206d 6772 3a0a        ) as mgr:.
-00015dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015de0: 636d 6420 3d20 5b22 2d2d 6469 6666 222c  cmd = ["--diff",
-00015df0: 2073 7472 2877 6f72 6b73 7061 6365 295d   str(workspace)]
-00015e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015e10: 2069 6620 636f 6c6f 723a 0a20 2020 2020   if color:.     
-00015e20: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00015e30: 6d64 2e61 7070 656e 6428 222d 2d63 6f6c  md.append("--col
-00015e40: 6f72 2229 0a20 2020 2020 2020 2020 2020  or").           
-00015e50: 2020 2020 2069 6e76 6f6b 6542 6c61 636b       invokeBlack
-00015e60: 2863 6d64 2c20 6578 6974 5f63 6f64 653d  (cmd, exit_code=
-00015e70: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-00015e80: 2020 2023 2074 6869 7320 6973 6e27 7420     # this isn't 
-00015e90: 7175 6974 6520 646f 696e 6720 7768 6174  quite doing what
-00015ea0: 2077 6520 7761 6e74 2c20 6275 7420 6966   we want, but if
-00015eb0: 2069 7420 5f69 736e 2774 5f0a 2020 2020   it _isn't_.    
-00015ec0: 2020 2020 2020 2020 2020 2020 2320 6361              # ca
-00015ed0: 6c6c 6564 2074 6865 6e20 7765 2063 616e  lled then we can
-00015ee0: 6e6f 7420 6265 2075 7369 6e67 2074 6865  not be using the
-00015ef0: 206c 6f63 6b20 6974 2070 726f 7669 6465   lock it provide
-00015f00: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00015f10: 2020 6d67 722e 6173 7365 7274 5f63 616c    mgr.assert_cal
-00015f20: 6c65 6428 290a 0a20 2020 2064 6566 2074  led()..    def t
-00015f30: 6573 745f 6e6f 5f63 6163 6865 5f77 6865  est_no_cache_whe
-00015f40: 6e5f 7374 6469 6e28 7365 6c66 2920 2d3e  n_stdin(self) ->
-00015f50: 204e 6f6e 653a 0a20 2020 2020 2020 206d   None:.        m
-00015f60: 6f64 6520 3d20 4445 4641 554c 545f 4d4f  ode = DEFAULT_MO
-00015f70: 4445 0a20 2020 2020 2020 2077 6974 6820  DE.        with 
-00015f80: 6361 6368 655f 6469 7228 293a 0a20 2020  cache_dir():.   
-00015f90: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00015fa0: 3d20 436c 6952 756e 6e65 7228 292e 696e  = CliRunner().in
-00015fb0: 766f 6b65 280a 2020 2020 2020 2020 2020  voke(.          
-00015fc0: 2020 2020 2020 626c 6163 6b2e 6d61 696e        black.main
-00015fd0: 2c20 5b22 2d22 5d2c 2069 6e70 7574 3d42  , ["-"], input=B
-00015fe0: 7974 6573 494f 2862 2270 7269 6e74 2827  ytesIO(b"print('
-00015ff0: 6865 6c6c 6f27 2922 290a 2020 2020 2020  hello')").      
-00016000: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00016010: 2020 2020 6173 7365 7274 206e 6f74 2072      assert not r
-00016020: 6573 756c 742e 6578 6974 5f63 6f64 650a  esult.exit_code.
-00016030: 2020 2020 2020 2020 2020 2020 6361 6368              cach
-00016040: 655f 6669 6c65 203d 2067 6574 5f63 6163  e_file = get_cac
-00016050: 6865 5f66 696c 6528 6d6f 6465 290a 2020  he_file(mode).  
-00016060: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00016070: 206e 6f74 2063 6163 6865 5f66 696c 652e   not cache_file.
-00016080: 6578 6973 7473 2829 0a0a 2020 2020 6465  exists()..    de
-00016090: 6620 7465 7374 5f72 6561 645f 6361 6368  f test_read_cach
-000160a0: 655f 6e6f 5f63 6163 6865 6669 6c65 2873  e_no_cachefile(s
-000160b0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-000160c0: 2020 2020 2020 6d6f 6465 203d 2044 4546        mode = DEF
-000160d0: 4155 4c54 5f4d 4f44 450a 2020 2020 2020  AULT_MODE.      
-000160e0: 2020 7769 7468 2063 6163 6865 5f64 6972    with cache_dir
-000160f0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00016100: 6173 7365 7274 2062 6c61 636b 2e43 6163  assert black.Cac
-00016110: 6865 2e72 6561 6428 6d6f 6465 292e 6669  he.read(mode).fi
-00016120: 6c65 5f64 6174 6120 3d3d 207b 7d0a 0a20  le_data == {}.. 
-00016130: 2020 2064 6566 2074 6573 745f 7772 6974     def test_writ
-00016140: 655f 6361 6368 655f 7265 6164 5f63 6163  e_cache_read_cac
-00016150: 6865 2873 656c 6629 202d 3e20 4e6f 6e65  he(self) -> None
-00016160: 3a0a 2020 2020 2020 2020 6d6f 6465 203d  :.        mode =
-00016170: 2044 4546 4155 4c54 5f4d 4f44 450a 2020   DEFAULT_MODE.  
-00016180: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
-00016190: 5f64 6972 2829 2061 7320 776f 726b 7370  _dir() as worksp
-000161a0: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
-000161b0: 2073 7263 203d 2028 776f 726b 7370 6163   src = (workspac
-000161c0: 6520 2f20 2274 6573 742e 7079 2229 2e72  e / "test.py").r
-000161d0: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
-000161e0: 2020 2020 2073 7263 2e74 6f75 6368 2829       src.touch()
-000161f0: 0a20 2020 2020 2020 2020 2020 2077 7269  .            wri
-00016200: 7465 5f63 6163 6865 203d 2062 6c61 636b  te_cache = black
-00016210: 2e43 6163 6865 2e72 6561 6428 6d6f 6465  .Cache.read(mode
-00016220: 290a 2020 2020 2020 2020 2020 2020 7772  ).            wr
-00016230: 6974 655f 6361 6368 652e 7772 6974 6528  ite_cache.write(
-00016240: 5b73 7263 5d29 0a20 2020 2020 2020 2020  [src]).         
-00016250: 2020 2072 6561 645f 6361 6368 6520 3d20     read_cache = 
-00016260: 626c 6163 6b2e 4361 6368 652e 7265 6164  black.Cache.read
-00016270: 286d 6f64 6529 0a20 2020 2020 2020 2020  (mode).         
-00016280: 2020 2061 7373 6572 7420 6e6f 7420 7265     assert not re
-00016290: 6164 5f63 6163 6865 2e69 735f 6368 616e  ad_cache.is_chan
-000162a0: 6765 6428 7372 6329 0a0a 2020 2020 4070  ged(src)..    @p
-000162b0: 7974 6573 742e 6d61 726b 2e69 6e63 6f6d  ytest.mark.incom
-000162c0: 7061 7469 626c 655f 7769 7468 5f6d 7970  patible_with_myp
-000162d0: 7963 0a20 2020 2064 6566 2074 6573 745f  yc.    def test_
-000162e0: 6669 6c74 6572 5f63 6163 6865 6428 7365  filter_cached(se
-000162f0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00016300: 2020 2020 2077 6974 6820 5465 6d70 6f72       with Tempor
-00016310: 6172 7944 6972 6563 746f 7279 2829 2061  aryDirectory() a
-00016320: 7320 776f 726b 7370 6163 653a 0a20 2020  s workspace:.   
-00016330: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
-00016340: 5061 7468 2877 6f72 6b73 7061 6365 290a  Path(workspace).
-00016350: 2020 2020 2020 2020 2020 2020 756e 6361              unca
-00016360: 6368 6564 203d 2028 7061 7468 202f 2022  ched = (path / "
-00016370: 756e 6361 6368 6564 2229 2e72 6573 6f6c  uncached").resol
-00016380: 7665 2829 0a20 2020 2020 2020 2020 2020  ve().           
-00016390: 2063 6163 6865 6420 3d20 2870 6174 6820   cached = (path 
-000163a0: 2f20 2263 6163 6865 6422 292e 7265 736f  / "cached").reso
-000163b0: 6c76 6528 290a 2020 2020 2020 2020 2020  lve().          
-000163c0: 2020 6361 6368 6564 5f62 7574 5f63 6861    cached_but_cha
-000163d0: 6e67 6564 203d 2028 7061 7468 202f 2022  nged = (path / "
-000163e0: 6368 616e 6765 6422 292e 7265 736f 6c76  changed").resolv
-000163f0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-00016400: 756e 6361 6368 6564 2e74 6f75 6368 2829  uncached.touch()
-00016410: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
-00016420: 6865 642e 746f 7563 6828 290a 2020 2020  hed.touch().    
-00016430: 2020 2020 2020 2020 6361 6368 6564 5f62          cached_b
-00016440: 7574 5f63 6861 6e67 6564 2e74 6f75 6368  ut_changed.touch
-00016450: 2829 0a20 2020 2020 2020 2020 2020 2063  ().            c
-00016460: 6163 6865 203d 2062 6c61 636b 2e43 6163  ache = black.Cac
-00016470: 6865 2e72 6561 6428 4445 4641 554c 545f  he.read(DEFAULT_
-00016480: 4d4f 4445 290a 0a20 2020 2020 2020 2020  MODE)..         
-00016490: 2020 206f 7269 675f 6675 6e63 203d 2062     orig_func = b
-000164a0: 6c61 636b 2e43 6163 6865 2e67 6574 5f66  lack.Cache.get_f
-000164b0: 696c 655f 6461 7461 0a0a 2020 2020 2020  ile_data..      
-000164c0: 2020 2020 2020 6465 6620 7772 6170 7065        def wrappe
-000164d0: 645f 6675 6e63 2870 6174 683a 2050 6174  d_func(path: Pat
-000164e0: 6829 202d 3e20 4669 6c65 4461 7461 3a0a  h) -> FileData:.
-000164f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016500: 6966 2070 6174 6820 3d3d 2063 6163 6865  if path == cache
-00016510: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-00016520: 2020 2020 2020 2072 6574 7572 6e20 6f72         return or
-00016530: 6967 5f66 756e 6328 7061 7468 290a 2020  ig_func(path).  
-00016540: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00016550: 2070 6174 6820 3d3d 2063 6163 6865 645f   path == cached_
-00016560: 6275 745f 6368 616e 6765 643a 0a20 2020  but_changed:.   
-00016570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016580: 2072 6574 7572 6e20 4669 6c65 4461 7461   return FileData
-00016590: 2830 2e30 2c20 302c 2022 2229 0a20 2020  (0.0, 0, "").   
-000165a0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-000165b0: 7365 2041 7373 6572 7469 6f6e 4572 726f  se AssertionErro
-000165c0: 720a 0a20 2020 2020 2020 2020 2020 2077  r..            w
-000165d0: 6974 6820 7061 7463 682e 6f62 6a65 6374  ith patch.object
-000165e0: 2862 6c61 636b 2e43 6163 6865 2c20 2267  (black.Cache, "g
-000165f0: 6574 5f66 696c 655f 6461 7461 222c 2073  et_file_data", s
-00016600: 6964 655f 6566 6665 6374 3d77 7261 7070  ide_effect=wrapp
-00016610: 6564 5f66 756e 6329 3a0a 2020 2020 2020  ed_func):.      
-00016620: 2020 2020 2020 2020 2020 6361 6368 652e            cache.
-00016630: 7772 6974 6528 5b63 6163 6865 642c 2063  write([cached, c
-00016640: 6163 6865 645f 6275 745f 6368 616e 6765  ached_but_change
-00016650: 645d 290a 2020 2020 2020 2020 2020 2020  d]).            
-00016660: 746f 646f 2c20 646f 6e65 203d 2063 6163  todo, done = cac
-00016670: 6865 2e66 696c 7465 7265 645f 6361 6368  he.filtered_cach
-00016680: 6564 287b 756e 6361 6368 6564 2c20 6361  ed({uncached, ca
-00016690: 6368 6564 2c20 6361 6368 6564 5f62 7574  ched, cached_but
-000166a0: 5f63 6861 6e67 6564 7d29 0a20 2020 2020  _changed}).     
-000166b0: 2020 2020 2020 2061 7373 6572 7420 746f         assert to
-000166c0: 646f 203d 3d20 7b75 6e63 6163 6865 642c  do == {uncached,
-000166d0: 2063 6163 6865 645f 6275 745f 6368 616e   cached_but_chan
-000166e0: 6765 647d 0a20 2020 2020 2020 2020 2020  ged}.           
-000166f0: 2061 7373 6572 7420 646f 6e65 203d 3d20   assert done == 
-00016700: 7b63 6163 6865 647d 0a0a 2020 2020 6465  {cached}..    de
-00016710: 6620 7465 7374 5f66 696c 7465 725f 6361  f test_filter_ca
-00016720: 6368 6564 5f68 6173 6828 7365 6c66 2920  ched_hash(self) 
-00016730: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00016740: 2077 6974 6820 5465 6d70 6f72 6172 7944   with TemporaryD
-00016750: 6972 6563 746f 7279 2829 2061 7320 776f  irectory() as wo
-00016760: 726b 7370 6163 653a 0a20 2020 2020 2020  rkspace:.       
-00016770: 2020 2020 2070 6174 6820 3d20 5061 7468       path = Path
-00016780: 2877 6f72 6b73 7061 6365 290a 2020 2020  (workspace).    
-00016790: 2020 2020 2020 2020 7372 6320 3d20 2870          src = (p
-000167a0: 6174 6820 2f20 2274 6573 742e 7079 2229  ath / "test.py")
-000167b0: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
-000167c0: 2020 2020 2020 2073 7263 2e77 7269 7465         src.write
-000167d0: 5f74 6578 7428 2270 7269 6e74 2827 6865  _text("print('he
-000167e0: 6c6c 6f27 2922 2c20 656e 636f 6469 6e67  llo')", encoding
-000167f0: 3d22 7574 662d 3822 290a 2020 2020 2020  ="utf-8").      
-00016800: 2020 2020 2020 7374 203d 2073 7263 2e73        st = src.s
-00016810: 7461 7428 290a 2020 2020 2020 2020 2020  tat().          
-00016820: 2020 6361 6368 6520 3d20 626c 6163 6b2e    cache = black.
-00016830: 4361 6368 652e 7265 6164 2844 4546 4155  Cache.read(DEFAU
-00016840: 4c54 5f4d 4f44 4529 0a20 2020 2020 2020  LT_MODE).       
-00016850: 2020 2020 2063 6163 6865 2e77 7269 7465       cache.write
-00016860: 285b 7372 635d 290a 2020 2020 2020 2020  ([src]).        
-00016870: 2020 2020 6361 6368 6564 5f66 696c 655f      cached_file_
-00016880: 6461 7461 203d 2063 6163 6865 2e66 696c  data = cache.fil
-00016890: 655f 6461 7461 5b73 7472 2873 7263 295d  e_data[str(src)]
-000168a0: 0a0a 2020 2020 2020 2020 2020 2020 746f  ..            to
-000168b0: 646f 2c20 646f 6e65 203d 2063 6163 6865  do, done = cache
-000168c0: 2e66 696c 7465 7265 645f 6361 6368 6564  .filtered_cached
-000168d0: 285b 7372 635d 290a 2020 2020 2020 2020  ([src]).        
-000168e0: 2020 2020 6173 7365 7274 2074 6f64 6f20      assert todo 
-000168f0: 3d3d 2073 6574 2829 0a20 2020 2020 2020  == set().       
-00016900: 2020 2020 2061 7373 6572 7420 646f 6e65       assert done
-00016910: 203d 3d20 7b73 7263 7d0a 2020 2020 2020   == {src}.      
-00016920: 2020 2020 2020 6173 7365 7274 2063 6163        assert cac
-00016930: 6865 645f 6669 6c65 5f64 6174 612e 7374  hed_file_data.st
-00016940: 5f6d 7469 6d65 203d 3d20 7374 2e73 745f  _mtime == st.st_
-00016950: 6d74 696d 650a 0a20 2020 2020 2020 2020  mtime..         
-00016960: 2020 2023 204d 6f64 6966 7920 7374 5f6d     # Modify st_m
-00016970: 7469 6d65 0a20 2020 2020 2020 2020 2020  time.           
-00016980: 2063 6163 6865 645f 6669 6c65 5f64 6174   cached_file_dat
-00016990: 6120 3d20 6361 6368 652e 6669 6c65 5f64  a = cache.file_d
-000169a0: 6174 615b 7374 7228 7372 6329 5d20 3d20  ata[str(src)] = 
-000169b0: 4669 6c65 4461 7461 280a 2020 2020 2020  FileData(.      
-000169c0: 2020 2020 2020 2020 2020 6361 6368 6564            cached
-000169d0: 5f66 696c 655f 6461 7461 2e73 745f 6d74  _file_data.st_mt
-000169e0: 696d 6520 2d20 312c 0a20 2020 2020 2020  ime - 1,.       
-000169f0: 2020 2020 2020 2020 2063 6163 6865 645f           cached_
-00016a00: 6669 6c65 5f64 6174 612e 7374 5f73 697a  file_data.st_siz
-00016a10: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00016a20: 2020 2063 6163 6865 645f 6669 6c65 5f64     cached_file_d
-00016a30: 6174 612e 6861 7368 2c0a 2020 2020 2020  ata.hash,.      
-00016a40: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00016a50: 2020 2020 746f 646f 2c20 646f 6e65 203d      todo, done =
-00016a60: 2063 6163 6865 2e66 696c 7465 7265 645f   cache.filtered_
-00016a70: 6361 6368 6564 285b 7372 635d 290a 2020  cached([src]).  
-00016a80: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00016a90: 2074 6f64 6f20 3d3d 2073 6574 2829 0a20   todo == set(). 
-00016aa0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00016ab0: 7420 646f 6e65 203d 3d20 7b73 7263 7d0a  t done == {src}.
-00016ac0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00016ad0: 7274 2063 6163 6865 645f 6669 6c65 5f64  rt cached_file_d
-00016ae0: 6174 612e 7374 5f6d 7469 6d65 203c 2073  ata.st_mtime < s
-00016af0: 742e 7374 5f6d 7469 6d65 0a20 2020 2020  t.st_mtime.     
-00016b00: 2020 2020 2020 2061 7373 6572 7420 6361         assert ca
-00016b10: 6368 6564 5f66 696c 655f 6461 7461 2e73  ched_file_data.s
-00016b20: 745f 7369 7a65 203d 3d20 7374 2e73 745f  t_size == st.st_
-00016b30: 7369 7a65 0a20 2020 2020 2020 2020 2020  size.           
-00016b40: 2061 7373 6572 7420 6361 6368 6564 5f66   assert cached_f
-00016b50: 696c 655f 6461 7461 2e68 6173 6820 3d3d  ile_data.hash ==
-00016b60: 2062 6c61 636b 2e43 6163 6865 2e68 6173   black.Cache.has
-00016b70: 685f 6469 6765 7374 2873 7263 290a 0a20  h_digest(src).. 
-00016b80: 2020 2020 2020 2020 2020 2023 204d 6f64             # Mod
-00016b90: 6966 7920 636f 6e74 656e 7473 0a20 2020  ify contents.   
-00016ba0: 2020 2020 2020 2020 2073 7263 2e77 7269           src.wri
-00016bb0: 7465 5f74 6578 7428 2270 7269 6e74 2827  te_text("print('
-00016bc0: 6865 6c6c 6f20 776f 726c 6427 2922 2c20  hello world')", 
-00016bd0: 656e 636f 6469 6e67 3d22 7574 662d 3822  encoding="utf-8"
-00016be0: 290a 2020 2020 2020 2020 2020 2020 6e65  ).            ne
-00016bf0: 775f 7374 203d 2073 7263 2e73 7461 7428  w_st = src.stat(
-00016c00: 290a 2020 2020 2020 2020 2020 2020 746f  ).            to
-00016c10: 646f 2c20 646f 6e65 203d 2063 6163 6865  do, done = cache
-00016c20: 2e66 696c 7465 7265 645f 6361 6368 6564  .filtered_cached
-00016c30: 285b 7372 635d 290a 2020 2020 2020 2020  ([src]).        
-00016c40: 2020 2020 6173 7365 7274 2074 6f64 6f20      assert todo 
-00016c50: 3d3d 207b 7372 637d 0a20 2020 2020 2020  == {src}.       
-00016c60: 2020 2020 2061 7373 6572 7420 646f 6e65       assert done
-00016c70: 203d 3d20 7365 7428 290a 2020 2020 2020   == set().      
-00016c80: 2020 2020 2020 6173 7365 7274 2063 6163        assert cac
-00016c90: 6865 645f 6669 6c65 5f64 6174 612e 7374  hed_file_data.st
-00016ca0: 5f6d 7469 6d65 203c 206e 6577 5f73 742e  _mtime < new_st.
-00016cb0: 7374 5f6d 7469 6d65 0a20 2020 2020 2020  st_mtime.       
-00016cc0: 2020 2020 2061 7373 6572 7420 6361 6368       assert cach
-00016cd0: 6564 5f66 696c 655f 6461 7461 2e73 745f  ed_file_data.st_
-00016ce0: 7369 7a65 2021 3d20 6e65 775f 7374 2e73  size != new_st.s
-00016cf0: 745f 7369 7a65 0a20 2020 2020 2020 2020  t_size.         
-00016d00: 2020 2061 7373 6572 7420 6361 6368 6564     assert cached
-00016d10: 5f66 696c 655f 6461 7461 2e68 6173 6820  _file_data.hash 
-00016d20: 213d 2062 6c61 636b 2e43 6163 6865 2e68  != black.Cache.h
-00016d30: 6173 685f 6469 6765 7374 2873 7263 290a  ash_digest(src).
-00016d40: 0a20 2020 2064 6566 2074 6573 745f 7772  .    def test_wr
-00016d50: 6974 655f 6361 6368 655f 6372 6561 7465  ite_cache_create
-00016d60: 735f 6469 7265 6374 6f72 795f 6966 5f6e  s_directory_if_n
-00016d70: 6565 6465 6428 7365 6c66 2920 2d3e 204e  eeded(self) -> N
-00016d80: 6f6e 653a 0a20 2020 2020 2020 206d 6f64  one:.        mod
-00016d90: 6520 3d20 4445 4641 554c 545f 4d4f 4445  e = DEFAULT_MODE
-00016da0: 0a20 2020 2020 2020 2077 6974 6820 6361  .        with ca
-00016db0: 6368 655f 6469 7228 6578 6973 7473 3d46  che_dir(exists=F
-00016dc0: 616c 7365 2920 6173 2077 6f72 6b73 7061  alse) as workspa
-00016dd0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-00016de0: 6173 7365 7274 206e 6f74 2077 6f72 6b73  assert not works
-00016df0: 7061 6365 2e65 7869 7374 7328 290a 2020  pace.exists().  
-00016e00: 2020 2020 2020 2020 2020 6361 6368 6520            cache 
-00016e10: 3d20 626c 6163 6b2e 4361 6368 652e 7265  = black.Cache.re
-00016e20: 6164 286d 6f64 6529 0a20 2020 2020 2020  ad(mode).       
-00016e30: 2020 2020 2063 6163 6865 2e77 7269 7465       cache.write
-00016e40: 285b 5d29 0a20 2020 2020 2020 2020 2020  ([]).           
-00016e50: 2061 7373 6572 7420 776f 726b 7370 6163   assert workspac
-00016e60: 652e 6578 6973 7473 2829 0a0a 2020 2020  e.exists()..    
-00016e70: 4065 7665 6e74 5f6c 6f6f 7028 290a 2020  @event_loop().  
-00016e80: 2020 6465 6620 7465 7374 5f66 6169 6c65    def test_faile
-00016e90: 645f 666f 726d 6174 7469 6e67 5f64 6f65  d_formatting_doe
-00016ea0: 735f 6e6f 745f 6765 745f 6361 6368 6564  s_not_get_cached
-00016eb0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00016ec0: 2020 2020 2020 2020 6d6f 6465 203d 2044          mode = D
-00016ed0: 4546 4155 4c54 5f4d 4f44 450a 2020 2020  EFAULT_MODE.    
-00016ee0: 2020 2020 7769 7468 2063 6163 6865 5f64      with cache_d
-00016ef0: 6972 2829 2061 7320 776f 726b 7370 6163  ir() as workspac
-00016f00: 652c 2070 6174 6368 280a 2020 2020 2020  e, patch(.      
-00016f10: 2020 2020 2020 2263 6f6e 6375 7272 656e        "concurren
-00016f20: 742e 6675 7475 7265 732e 5072 6f63 6573  t.futures.Proces
-00016f30: 7350 6f6f 6c45 7865 6375 746f 7222 2c20  sPoolExecutor", 
-00016f40: 6e65 773d 5468 7265 6164 506f 6f6c 4578  new=ThreadPoolEx
-00016f50: 6563 7574 6f72 0a20 2020 2020 2020 2029  ecutor.        )
-00016f60: 3a0a 2020 2020 2020 2020 2020 2020 6661  :.            fa
-00016f70: 696c 696e 6720 3d20 2877 6f72 6b73 7061  iling = (workspa
-00016f80: 6365 202f 2022 6661 696c 696e 672e 7079  ce / "failing.py
-00016f90: 2229 2e72 6573 6f6c 7665 2829 0a20 2020  ").resolve().   
-00016fa0: 2020 2020 2020 2020 2066 6169 6c69 6e67           failing
-00016fb0: 2e77 7269 7465 5f74 6578 7428 226e 6f74  .write_text("not
-00016fc0: 2061 6374 7561 6c6c 7920 7079 7468 6f6e   actually python
-00016fd0: 222c 2065 6e63 6f64 696e 673d 2275 7466  ", encoding="utf
-00016fe0: 2d38 2229 0a20 2020 2020 2020 2020 2020  -8").           
-00016ff0: 2063 6c65 616e 203d 2028 776f 726b 7370   clean = (worksp
-00017000: 6163 6520 2f20 2263 6c65 616e 2e70 7922  ace / "clean.py"
-00017010: 292e 7265 736f 6c76 6528 290a 2020 2020  ).resolve().    
-00017020: 2020 2020 2020 2020 636c 6561 6e2e 7772          clean.wr
-00017030: 6974 655f 7465 7874 2827 7072 696e 7428  ite_text('print(
-00017040: 2268 656c 6c6f 2229 5c6e 272c 2065 6e63  "hello")\n', enc
-00017050: 6f64 696e 673d 2275 7466 2d38 2229 0a20  oding="utf-8"). 
-00017060: 2020 2020 2020 2020 2020 2069 6e76 6f6b             invok
-00017070: 6542 6c61 636b 285b 7374 7228 776f 726b  eBlack([str(work
-00017080: 7370 6163 6529 5d2c 2065 7869 745f 636f  space)], exit_co
-00017090: 6465 3d31 3233 290a 2020 2020 2020 2020  de=123).        
-000170a0: 2020 2020 6361 6368 6520 3d20 626c 6163      cache = blac
-000170b0: 6b2e 4361 6368 652e 7265 6164 286d 6f64  k.Cache.read(mod
-000170c0: 6529 0a20 2020 2020 2020 2020 2020 2061  e).            a
-000170d0: 7373 6572 7420 6361 6368 652e 6973 5f63  ssert cache.is_c
-000170e0: 6861 6e67 6564 2866 6169 6c69 6e67 290a  hanged(failing).
-000170f0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00017100: 7274 206e 6f74 2063 6163 6865 2e69 735f  rt not cache.is_
-00017110: 6368 616e 6765 6428 636c 6561 6e29 0a0a  changed(clean)..
-00017120: 2020 2020 6465 6620 7465 7374 5f77 7269      def test_wri
-00017130: 7465 5f63 6163 6865 5f77 7269 7465 5f66  te_cache_write_f
-00017140: 6169 6c28 7365 6c66 2920 2d3e 204e 6f6e  ail(self) -> Non
-00017150: 653a 0a20 2020 2020 2020 206d 6f64 6520  e:.        mode 
-00017160: 3d20 4445 4641 554c 545f 4d4f 4445 0a20  = DEFAULT_MODE. 
-00017170: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
-00017180: 655f 6469 7228 293a 0a20 2020 2020 2020  e_dir():.       
-00017190: 2020 2020 2063 6163 6865 203d 2062 6c61       cache = bla
-000171a0: 636b 2e43 6163 6865 2e72 6561 6428 6d6f  ck.Cache.read(mo
-000171b0: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-000171c0: 7769 7468 2070 6174 6368 2e6f 626a 6563  with patch.objec
-000171d0: 7428 5061 7468 2c20 226f 7065 6e22 2920  t(Path, "open") 
-000171e0: 6173 206d 6f63 6b3a 0a20 2020 2020 2020  as mock:.       
-000171f0: 2020 2020 2020 2020 206d 6f63 6b2e 7369           mock.si
-00017200: 6465 5f65 6666 6563 7420 3d20 4f53 4572  de_effect = OSEr
-00017210: 726f 720a 2020 2020 2020 2020 2020 2020  ror.            
-00017220: 2020 2020 6361 6368 652e 7772 6974 6528      cache.write(
-00017230: 5b5d 290a 0a20 2020 2064 6566 2074 6573  [])..    def tes
-00017240: 745f 7265 6164 5f63 6163 6865 5f6c 696e  t_read_cache_lin
-00017250: 655f 6c65 6e67 7468 7328 7365 6c66 2920  e_lengths(self) 
-00017260: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00017270: 206d 6f64 6520 3d20 4445 4641 554c 545f   mode = DEFAULT_
-00017280: 4d4f 4445 0a20 2020 2020 2020 2073 686f  MODE.        sho
-00017290: 7274 5f6d 6f64 6520 3d20 7265 706c 6163  rt_mode = replac
-000172a0: 6528 4445 4641 554c 545f 4d4f 4445 2c20  e(DEFAULT_MODE, 
-000172b0: 6c69 6e65 5f6c 656e 6774 683d 3129 0a20  line_length=1). 
-000172c0: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
-000172d0: 655f 6469 7228 2920 6173 2077 6f72 6b73  e_dir() as works
-000172e0: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
-000172f0: 2020 7061 7468 203d 2028 776f 726b 7370    path = (worksp
-00017300: 6163 6520 2f20 2266 696c 652e 7079 2229  ace / "file.py")
-00017310: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
-00017320: 2020 2020 2020 2070 6174 682e 746f 7563         path.touc
-00017330: 6828 290a 2020 2020 2020 2020 2020 2020  h().            
-00017340: 6361 6368 6520 3d20 626c 6163 6b2e 4361  cache = black.Ca
-00017350: 6368 652e 7265 6164 286d 6f64 6529 0a20  che.read(mode). 
-00017360: 2020 2020 2020 2020 2020 2063 6163 6865             cache
-00017370: 2e77 7269 7465 285b 7061 7468 5d29 0a20  .write([path]). 
-00017380: 2020 2020 2020 2020 2020 206f 6e65 203d             one =
-00017390: 2062 6c61 636b 2e43 6163 6865 2e72 6561   black.Cache.rea
-000173a0: 6428 6d6f 6465 290a 2020 2020 2020 2020  d(mode).        
-000173b0: 2020 2020 6173 7365 7274 206e 6f74 206f      assert not o
-000173c0: 6e65 2e69 735f 6368 616e 6765 6428 7061  ne.is_changed(pa
-000173d0: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
-000173e0: 7477 6f20 3d20 626c 6163 6b2e 4361 6368  two = black.Cach
-000173f0: 652e 7265 6164 2873 686f 7274 5f6d 6f64  e.read(short_mod
-00017400: 6529 0a20 2020 2020 2020 2020 2020 2061  e).            a
-00017410: 7373 6572 7420 7477 6f2e 6973 5f63 6861  ssert two.is_cha
-00017420: 6e67 6564 2870 6174 6829 0a0a 0a64 6566  nged(path)...def
-00017430: 2061 7373 6572 745f 636f 6c6c 6563 7465   assert_collecte
-00017440: 645f 736f 7572 6365 7328 0a20 2020 2073  d_sources(.    s
-00017450: 7263 3a20 5365 7175 656e 6365 5b55 6e69  rc: Sequence[Uni
-00017460: 6f6e 5b73 7472 2c20 5061 7468 5d5d 2c0a  on[str, Path]],.
-00017470: 2020 2020 6578 7065 6374 6564 3a20 5365      expected: Se
-00017480: 7175 656e 6365 5b55 6e69 6f6e 5b73 7472  quence[Union[str
-00017490: 2c20 5061 7468 5d5d 2c0a 2020 2020 2a2c  , Path]],.    *,
-000174a0: 0a20 2020 2072 6f6f 743a 204f 7074 696f  .    root: Optio
-000174b0: 6e61 6c5b 5061 7468 5d20 3d20 4e6f 6e65  nal[Path] = None
-000174c0: 2c0a 2020 2020 6578 636c 7564 653a 204f  ,.    exclude: O
-000174d0: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-000174e0: 6f6e 652c 0a20 2020 2069 6e63 6c75 6465  one,.    include
-000174f0: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
-00017500: 3d20 4e6f 6e65 2c0a 2020 2020 6578 7465  = None,.    exte
-00017510: 6e64 5f65 7863 6c75 6465 3a20 4f70 7469  nd_exclude: Opti
-00017520: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-00017530: 2c0a 2020 2020 666f 7263 655f 6578 636c  ,.    force_excl
-00017540: 7564 653a 204f 7074 696f 6e61 6c5b 7374  ude: Optional[st
-00017550: 725d 203d 204e 6f6e 652c 0a20 2020 2073  r] = None,.    s
-00017560: 7464 696e 5f66 696c 656e 616d 653a 204f  tdin_filename: O
-00017570: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-00017580: 6f6e 652c 0a29 202d 3e20 4e6f 6e65 3a0a  one,.) -> None:.
-00017590: 2020 2020 6773 5f73 7263 203d 2074 7570      gs_src = tup
-000175a0: 6c65 2873 7472 2850 6174 6828 7329 2920  le(str(Path(s)) 
-000175b0: 666f 7220 7320 696e 2073 7263 290a 2020  for s in src).  
-000175c0: 2020 6773 5f65 7870 6563 7465 6420 3d20    gs_expected = 
-000175d0: 5b50 6174 6828 7329 2066 6f72 2073 2069  [Path(s) for s i
-000175e0: 6e20 6578 7065 6374 6564 5d0a 2020 2020  n expected].    
-000175f0: 6773 5f65 7863 6c75 6465 203d 204e 6f6e  gs_exclude = Non
-00017600: 6520 6966 2065 7863 6c75 6465 2069 7320  e if exclude is 
-00017610: 4e6f 6e65 2065 6c73 6520 636f 6d70 696c  None else compil
-00017620: 655f 7061 7474 6572 6e28 6578 636c 7564  e_pattern(exclud
-00017630: 6529 0a20 2020 2067 735f 696e 636c 7564  e).    gs_includ
-00017640: 6520 3d20 4445 4641 554c 545f 494e 434c  e = DEFAULT_INCL
-00017650: 5544 4520 6966 2069 6e63 6c75 6465 2069  UDE if include i
-00017660: 7320 4e6f 6e65 2065 6c73 6520 636f 6d70  s None else comp
-00017670: 696c 655f 7061 7474 6572 6e28 696e 636c  ile_pattern(incl
-00017680: 7564 6529 0a20 2020 2067 735f 6578 7465  ude).    gs_exte
-00017690: 6e64 5f65 7863 6c75 6465 203d 2028 0a20  nd_exclude = (. 
-000176a0: 2020 2020 2020 204e 6f6e 6520 6966 2065         None if e
-000176b0: 7874 656e 645f 6578 636c 7564 6520 6973  xtend_exclude is
-000176c0: 204e 6f6e 6520 656c 7365 2063 6f6d 7069   None else compi
-000176d0: 6c65 5f70 6174 7465 726e 2865 7874 656e  le_pattern(exten
-000176e0: 645f 6578 636c 7564 6529 0a20 2020 2029  d_exclude).    )
-000176f0: 0a20 2020 2067 735f 666f 7263 655f 6578  .    gs_force_ex
-00017700: 636c 7564 6520 3d20 4e6f 6e65 2069 6620  clude = None if 
-00017710: 666f 7263 655f 6578 636c 7564 6520 6973  force_exclude is
-00017720: 204e 6f6e 6520 656c 7365 2063 6f6d 7069   None else compi
-00017730: 6c65 5f70 6174 7465 726e 2866 6f72 6365  le_pattern(force
-00017740: 5f65 7863 6c75 6465 290a 2020 2020 636f  _exclude).    co
-00017750: 6c6c 6563 7465 6420 3d20 626c 6163 6b2e  llected = black.
-00017760: 6765 745f 736f 7572 6365 7328 0a20 2020  get_sources(.   
-00017770: 2020 2020 2072 6f6f 743d 726f 6f74 206f       root=root o
-00017780: 7220 5448 4953 5f44 4952 2c0a 2020 2020  r THIS_DIR,.    
-00017790: 2020 2020 7372 633d 6773 5f73 7263 2c0a      src=gs_src,.
-000177a0: 2020 2020 2020 2020 7175 6965 743d 4661          quiet=Fa
-000177b0: 6c73 652c 0a20 2020 2020 2020 2076 6572  lse,.        ver
-000177c0: 626f 7365 3d46 616c 7365 2c0a 2020 2020  bose=False,.    
-000177d0: 2020 2020 696e 636c 7564 653d 6773 5f69      include=gs_i
-000177e0: 6e63 6c75 6465 2c0a 2020 2020 2020 2020  nclude,.        
-000177f0: 6578 636c 7564 653d 6773 5f65 7863 6c75  exclude=gs_exclu
-00017800: 6465 2c0a 2020 2020 2020 2020 6578 7465  de,.        exte
-00017810: 6e64 5f65 7863 6c75 6465 3d67 735f 6578  nd_exclude=gs_ex
-00017820: 7465 6e64 5f65 7863 6c75 6465 2c0a 2020  tend_exclude,.  
-00017830: 2020 2020 2020 666f 7263 655f 6578 636c        force_excl
-00017840: 7564 653d 6773 5f66 6f72 6365 5f65 7863  ude=gs_force_exc
-00017850: 6c75 6465 2c0a 2020 2020 2020 2020 7265  lude,.        re
-00017860: 706f 7274 3d62 6c61 636b 2e52 6570 6f72  port=black.Repor
-00017870: 7428 292c 0a20 2020 2020 2020 2073 7464  t(),.        std
-00017880: 696e 5f66 696c 656e 616d 653d 7374 6469  in_filename=stdi
-00017890: 6e5f 6669 6c65 6e61 6d65 2c0a 2020 2020  n_filename,.    
-000178a0: 290a 2020 2020 6173 7365 7274 2073 6f72  ).    assert sor
-000178b0: 7465 6428 636f 6c6c 6563 7465 6429 203d  ted(collected) =
-000178c0: 3d20 736f 7274 6564 2867 735f 6578 7065  = sorted(gs_expe
-000178d0: 6374 6564 290a 0a0a 636c 6173 7320 5465  cted)...class Te
-000178e0: 7374 4669 6c65 436f 6c6c 6563 7469 6f6e  stFileCollection
-000178f0: 3a0a 2020 2020 6465 6620 7465 7374 5f69  :.    def test_i
-00017900: 6e63 6c75 6465 5f65 7863 6c75 6465 2873  nclude_exclude(s
-00017910: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00017920: 2020 2020 2020 7061 7468 203d 2054 4849        path = THI
-00017930: 535f 4449 5220 2f20 2264 6174 6122 202f  S_DIR / "data" /
-00017940: 2022 696e 636c 7564 655f 6578 636c 7564   "include_exclud
-00017950: 655f 7465 7374 7322 0a20 2020 2020 2020  e_tests".       
-00017960: 2073 7263 203d 205b 7061 7468 5d0a 2020   src = [path].  
-00017970: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
-00017980: 205b 0a20 2020 2020 2020 2020 2020 2050   [.            P
-00017990: 6174 6828 7061 7468 202f 2022 622f 646f  ath(path / "b/do
-000179a0: 6e74 5f65 7863 6c75 6465 2f61 2e70 7922  nt_exclude/a.py"
-000179b0: 292c 0a20 2020 2020 2020 2020 2020 2050  ),.            P
-000179c0: 6174 6828 7061 7468 202f 2022 622f 646f  ath(path / "b/do
-000179d0: 6e74 5f65 7863 6c75 6465 2f61 2e70 7969  nt_exclude/a.pyi
-000179e0: 2229 2c0a 2020 2020 2020 2020 5d0a 2020  "),.        ].  
-000179f0: 2020 2020 2020 6173 7365 7274 5f63 6f6c        assert_col
-00017a00: 6c65 6374 6564 5f73 6f75 7263 6573 280a  lected_sources(.
-00017a10: 2020 2020 2020 2020 2020 2020 7372 632c              src,
-00017a20: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
-00017a30: 6563 7465 642c 0a20 2020 2020 2020 2020  ected,.         
-00017a40: 2020 2069 6e63 6c75 6465 3d72 225c 2e70     include=r"\.p
-00017a50: 7969 3f24 222c 0a20 2020 2020 2020 2020  yi?$",.         
-00017a60: 2020 2065 7863 6c75 6465 3d72 222f 6578     exclude=r"/ex
-00017a70: 636c 7564 652f 7c2f 5c2e 6465 6669 6e69  clude/|/\.defini
-00017a80: 7465 6c79 5f65 7863 6c75 6465 2f22 2c0a  tely_exclude/",.
-00017a90: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00017aa0: 6566 2074 6573 745f 6769 7469 676e 6f72  ef test_gitignor
-00017ab0: 655f 7573 6564 5f61 735f 6465 6661 756c  e_used_as_defaul
-00017ac0: 7428 7365 6c66 2920 2d3e 204e 6f6e 653a  t(self) -> None:
-00017ad0: 0a20 2020 2020 2020 2062 6173 6520 3d20  .        base = 
-00017ae0: 5061 7468 2844 4154 415f 4449 5220 2f20  Path(DATA_DIR / 
-00017af0: 2269 6e63 6c75 6465 5f65 7863 6c75 6465  "include_exclude
-00017b00: 5f74 6573 7473 2229 0a20 2020 2020 2020  _tests").       
-00017b10: 2065 7870 6563 7465 6420 3d20 5b0a 2020   expected = [.  
-00017b20: 2020 2020 2020 2020 2020 6261 7365 202f            base /
-00017b30: 2022 622f 2e64 6566 696e 6974 656c 795f   "b/.definitely_
-00017b40: 6578 636c 7564 652f 612e 7079 222c 0a20  exclude/a.py",. 
-00017b50: 2020 2020 2020 2020 2020 2062 6173 6520             base 
-00017b60: 2f20 2262 2f2e 6465 6669 6e69 7465 6c79  / "b/.definitely
-00017b70: 5f65 7863 6c75 6465 2f61 2e70 7969 222c  _exclude/a.pyi",
-00017b80: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
-00017b90: 2020 2073 7263 203d 205b 6261 7365 202f     src = [base /
-00017ba0: 2022 622f 225d 0a20 2020 2020 2020 2061   "b/"].        a
-00017bb0: 7373 6572 745f 636f 6c6c 6563 7465 645f  ssert_collected_
-00017bc0: 736f 7572 6365 7328 7372 632c 2065 7870  sources(src, exp
-00017bd0: 6563 7465 642c 2072 6f6f 743d 6261 7365  ected, root=base
-00017be0: 2c20 6578 7465 6e64 5f65 7863 6c75 6465  , extend_exclude
-00017bf0: 3d72 222f 6578 636c 7564 652f 2229 0a0a  =r"/exclude/")..
-00017c00: 2020 2020 6465 6620 7465 7374 5f67 6974      def test_git
-00017c10: 6967 6e6f 7265 5f75 7365 645f 6f6e 5f6d  ignore_used_on_m
-00017c20: 756c 7469 706c 655f 736f 7572 6365 7328  ultiple_sources(
-00017c30: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00017c40: 2020 2020 2020 2072 6f6f 7420 3d20 5061         root = Pa
-00017c50: 7468 2844 4154 415f 4449 5220 2f20 2267  th(DATA_DIR / "g
-00017c60: 6974 6967 6e6f 7265 5f75 7365 645f 6f6e  itignore_used_on
-00017c70: 5f6d 756c 7469 706c 655f 736f 7572 6365  _multiple_source
-00017c80: 7322 290a 2020 2020 2020 2020 6578 7065  s").        expe
-00017c90: 6374 6564 203d 205b 0a20 2020 2020 2020  cted = [.       
-00017ca0: 2020 2020 2072 6f6f 7420 2f20 2264 6972       root / "dir
-00017cb0: 3122 202f 2022 622e 7079 222c 0a20 2020  1" / "b.py",.   
-00017cc0: 2020 2020 2020 2020 2072 6f6f 7420 2f20           root / 
-00017cd0: 2264 6972 3222 202f 2022 622e 7079 222c  "dir2" / "b.py",
-00017ce0: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
-00017cf0: 2020 2073 7263 203d 205b 726f 6f74 202f     src = [root /
-00017d00: 2022 6469 7231 222c 2072 6f6f 7420 2f20   "dir1", root / 
-00017d10: 2264 6972 3222 5d0a 2020 2020 2020 2020  "dir2"].        
-00017d20: 6173 7365 7274 5f63 6f6c 6c65 6374 6564  assert_collected
-00017d30: 5f73 6f75 7263 6573 2873 7263 2c20 6578  _sources(src, ex
-00017d40: 7065 6374 6564 2c20 726f 6f74 3d72 6f6f  pected, root=roo
-00017d50: 7429 0a0a 2020 2020 4070 6174 6368 2822  t)..    @patch("
-00017d60: 626c 6163 6b2e 6669 6e64 5f70 726f 6a65  black.find_proje
-00017d70: 6374 5f72 6f6f 7422 2c20 6c61 6d62 6461  ct_root", lambda
-00017d80: 202a 6172 6773 3a20 2854 4849 535f 4449   *args: (THIS_DI
-00017d90: 522e 7265 736f 6c76 6528 292c 204e 6f6e  R.resolve(), Non
-00017da0: 6529 290a 2020 2020 6465 6620 7465 7374  e)).    def test
-00017db0: 5f65 7863 6c75 6465 5f66 6f72 5f69 7373  _exclude_for_iss
-00017dc0: 7565 5f31 3537 3228 7365 6c66 2920 2d3e  ue_1572(self) ->
-00017dd0: 204e 6f6e 653a 0a20 2020 2020 2020 2023   None:.        #
-00017de0: 2045 7863 6c75 6465 2073 686f 756c 646e   Exclude shouldn
-00017df0: 2774 2074 6f75 6368 2066 696c 6573 2074  't touch files t
-00017e00: 6861 7420 7765 7265 2065 7870 6c69 6369  hat were explici
-00017e10: 746c 7920 6769 7665 6e20 746f 2042 6c61  tly given to Bla
-00017e20: 636b 2074 6872 6f75 6768 2074 6865 0a20  ck through the. 
-00017e30: 2020 2020 2020 2023 2043 4c49 2e20 4578         # CLI. Ex
-00017e40: 636c 7564 6520 6973 2073 7570 706f 7365  clude is suppose
-00017e50: 6420 746f 206f 6e6c 7920 6170 706c 7920  d to only apply 
-00017e60: 746f 2074 6865 2072 6563 7572 7369 7665  to the recursive
-00017e70: 2064 6973 636f 7665 7279 206f 6620 6669   discovery of fi
-00017e80: 6c65 732e 0a20 2020 2020 2020 2023 2068  les..        # h
-00017e90: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-00017ea0: 6d2f 7073 662f 626c 6163 6b2f 6973 7375  m/psf/black/issu
-00017eb0: 6573 2f31 3537 320a 2020 2020 2020 2020  es/1572.        
-00017ec0: 7061 7468 203d 2044 4154 415f 4449 5220  path = DATA_DIR 
-00017ed0: 2f20 2269 6e63 6c75 6465 5f65 7863 6c75  / "include_exclu
-00017ee0: 6465 5f74 6573 7473 220a 2020 2020 2020  de_tests".      
-00017ef0: 2020 7372 6320 3d20 5b70 6174 6820 2f20    src = [path / 
-00017f00: 2262 2f65 7863 6c75 6465 2f61 2e70 7922  "b/exclude/a.py"
-00017f10: 5d0a 2020 2020 2020 2020 6578 7065 6374  ].        expect
-00017f20: 6564 203d 205b 7061 7468 202f 2022 622f  ed = [path / "b/
-00017f30: 6578 636c 7564 652f 612e 7079 225d 0a20  exclude/a.py"]. 
-00017f40: 2020 2020 2020 2061 7373 6572 745f 636f         assert_co
-00017f50: 6c6c 6563 7465 645f 736f 7572 6365 7328  llected_sources(
-00017f60: 7372 632c 2065 7870 6563 7465 642c 2069  src, expected, i
-00017f70: 6e63 6c75 6465 3d22 222c 2065 7863 6c75  nclude="", exclu
-00017f80: 6465 3d72 222f 6578 636c 7564 652f 7c61  de=r"/exclude/|a
-00017f90: 5c2e 7079 2229 0a0a 2020 2020 6465 6620  \.py")..    def 
-00017fa0: 7465 7374 5f67 6974 6967 6e6f 7265 5f65  test_gitignore_e
-00017fb0: 7863 6c75 6465 2873 656c 6629 202d 3e20  xclude(self) -> 
-00017fc0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7061  None:.        pa
-00017fd0: 7468 203d 2054 4849 535f 4449 5220 2f20  th = THIS_DIR / 
-00017fe0: 2264 6174 6122 202f 2022 696e 636c 7564  "data" / "includ
-00017ff0: 655f 6578 636c 7564 655f 7465 7374 7322  e_exclude_tests"
-00018000: 0a20 2020 2020 2020 2069 6e63 6c75 6465  .        include
-00018010: 203d 2072 652e 636f 6d70 696c 6528 7222   = re.compile(r"
-00018020: 5c2e 7079 693f 2422 290a 2020 2020 2020  \.pyi?$").      
-00018030: 2020 6578 636c 7564 6520 3d20 7265 2e63    exclude = re.c
-00018040: 6f6d 7069 6c65 2872 2222 290a 2020 2020  ompile(r"").    
-00018050: 2020 2020 7265 706f 7274 203d 2062 6c61      report = bla
-00018060: 636b 2e52 6570 6f72 7428 290a 2020 2020  ck.Report().    
-00018070: 2020 2020 6769 7469 676e 6f72 6520 3d20      gitignore = 
-00018080: 5061 7468 5370 6563 2e66 726f 6d5f 6c69  PathSpec.from_li
-00018090: 6e65 7328 0a20 2020 2020 2020 2020 2020  nes(.           
-000180a0: 2022 6769 7477 696c 646d 6174 6368 222c   "gitwildmatch",
-000180b0: 205b 2265 7863 6c75 6465 2f22 2c20 222e   ["exclude/", ".
-000180c0: 6465 6669 6e69 7465 6c79 5f65 7863 6c75  definitely_exclu
-000180d0: 6465 225d 0a20 2020 2020 2020 2029 0a20  de"].        ). 
-000180e0: 2020 2020 2020 2073 6f75 7263 6573 3a20         sources: 
-000180f0: 4c69 7374 5b50 6174 685d 203d 205b 5d0a  List[Path] = [].
-00018100: 2020 2020 2020 2020 6578 7065 6374 6564          expected
-00018110: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-00018120: 2050 6174 6828 7061 7468 202f 2022 622f   Path(path / "b/
-00018130: 646f 6e74 5f65 7863 6c75 6465 2f61 2e70  dont_exclude/a.p
-00018140: 7922 292c 0a20 2020 2020 2020 2020 2020  y"),.           
-00018150: 2050 6174 6828 7061 7468 202f 2022 622f   Path(path / "b/
-00018160: 646f 6e74 5f65 7863 6c75 6465 2f61 2e70  dont_exclude/a.p
-00018170: 7969 2229 2c0a 2020 2020 2020 2020 5d0a  yi"),.        ].
-00018180: 2020 2020 2020 2020 7468 6973 5f61 6273          this_abs
-00018190: 203d 2054 4849 535f 4449 522e 7265 736f   = THIS_DIR.reso
-000181a0: 6c76 6528 290a 2020 2020 2020 2020 736f  lve().        so
-000181b0: 7572 6365 732e 6578 7465 6e64 280a 2020  urces.extend(.  
-000181c0: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
-000181d0: 6765 6e5f 7079 7468 6f6e 5f66 696c 6573  gen_python_files
-000181e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000181f0: 2020 7061 7468 2e69 7465 7264 6972 2829    path.iterdir()
-00018200: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00018210: 2020 7468 6973 5f61 6273 2c0a 2020 2020    this_abs,.    
-00018220: 2020 2020 2020 2020 2020 2020 696e 636c              incl
-00018230: 7564 652c 0a20 2020 2020 2020 2020 2020  ude,.           
-00018240: 2020 2020 2065 7863 6c75 6465 2c0a 2020       exclude,.  
-00018250: 2020 2020 2020 2020 2020 2020 2020 4e6f                No
-00018260: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00018270: 2020 2020 4e6f 6e65 2c0a 2020 2020 2020      None,.      
-00018280: 2020 2020 2020 2020 2020 7265 706f 7274            report
-00018290: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000182a0: 2020 7b70 6174 683a 2067 6974 6967 6e6f    {path: gitigno
-000182b0: 7265 7d2c 0a20 2020 2020 2020 2020 2020  re},.           
-000182c0: 2020 2020 2076 6572 626f 7365 3d46 616c       verbose=Fal
-000182d0: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-000182e0: 2020 2020 7175 6965 743d 4661 6c73 652c      quiet=False,
-000182f0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00018300: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00018310: 2061 7373 6572 7420 736f 7274 6564 2865   assert sorted(e
-00018320: 7870 6563 7465 6429 203d 3d20 736f 7274  xpected) == sort
-00018330: 6564 2873 6f75 7263 6573 290a 0a20 2020  ed(sources)..   
-00018340: 2064 6566 2074 6573 745f 6e65 7374 6564   def test_nested
-00018350: 5f67 6974 6967 6e6f 7265 2873 656c 6629  _gitignore(self)
-00018360: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00018370: 2020 7061 7468 203d 2050 6174 6828 5448    path = Path(TH
-00018380: 4953 5f44 4952 202f 2022 6461 7461 2220  IS_DIR / "data" 
-00018390: 2f20 226e 6573 7465 645f 6769 7469 676e  / "nested_gitign
-000183a0: 6f72 655f 7465 7374 7322 290a 2020 2020  ore_tests").    
-000183b0: 2020 2020 696e 636c 7564 6520 3d20 7265      include = re
-000183c0: 2e63 6f6d 7069 6c65 2872 225c 2e70 7969  .compile(r"\.pyi
-000183d0: 3f24 2229 0a20 2020 2020 2020 2065 7863  ?$").        exc
-000183e0: 6c75 6465 203d 2072 652e 636f 6d70 696c  lude = re.compil
-000183f0: 6528 7222 2229 0a20 2020 2020 2020 2072  e(r"").        r
-00018400: 6f6f 745f 6769 7469 676e 6f72 6520 3d20  oot_gitignore = 
-00018410: 626c 6163 6b2e 6669 6c65 732e 6765 745f  black.files.get_
-00018420: 6769 7469 676e 6f72 6528 7061 7468 290a  gitignore(path).
-00018430: 2020 2020 2020 2020 7265 706f 7274 203d          report =
-00018440: 2062 6c61 636b 2e52 6570 6f72 7428 290a   black.Report().
-00018450: 2020 2020 2020 2020 6578 7065 6374 6564          expected
-00018460: 3a20 4c69 7374 5b50 6174 685d 203d 205b  : List[Path] = [
-00018470: 0a20 2020 2020 2020 2020 2020 2050 6174  .            Pat
-00018480: 6828 7061 7468 202f 2022 782e 7079 2229  h(path / "x.py")
-00018490: 2c0a 2020 2020 2020 2020 2020 2020 5061  ,.            Pa
-000184a0: 7468 2870 6174 6820 2f20 2272 6f6f 742f  th(path / "root/
-000184b0: 622e 7079 2229 2c0a 2020 2020 2020 2020  b.py"),.        
-000184c0: 2020 2020 5061 7468 2870 6174 6820 2f20      Path(path / 
-000184d0: 2272 6f6f 742f 632e 7079 2229 2c0a 2020  "root/c.py"),.  
-000184e0: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
-000184f0: 6174 6820 2f20 2272 6f6f 742f 6368 696c  ath / "root/chil
-00018500: 642f 632e 7079 2229 2c0a 2020 2020 2020  d/c.py"),.      
-00018510: 2020 5d0a 2020 2020 2020 2020 7468 6973    ].        this
-00018520: 5f61 6273 203d 2054 4849 535f 4449 522e  _abs = THIS_DIR.
-00018530: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
-00018540: 2020 736f 7572 6365 7320 3d20 6c69 7374    sources = list
-00018550: 280a 2020 2020 2020 2020 2020 2020 626c  (.            bl
-00018560: 6163 6b2e 6765 6e5f 7079 7468 6f6e 5f66  ack.gen_python_f
-00018570: 696c 6573 280a 2020 2020 2020 2020 2020  iles(.          
-00018580: 2020 2020 2020 7061 7468 2e69 7465 7264        path.iterd
-00018590: 6972 2829 2c0a 2020 2020 2020 2020 2020  ir(),.          
-000185a0: 2020 2020 2020 7468 6973 5f61 6273 2c0a        this_abs,.
-000185b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185c0: 696e 636c 7564 652c 0a20 2020 2020 2020  include,.       
-000185d0: 2020 2020 2020 2020 2065 7863 6c75 6465           exclude
-000185e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000185f0: 2020 4e6f 6e65 2c0a 2020 2020 2020 2020    None,.        
-00018600: 2020 2020 2020 2020 4e6f 6e65 2c0a 2020          None,.  
-00018610: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00018620: 706f 7274 2c0a 2020 2020 2020 2020 2020  port,.          
-00018630: 2020 2020 2020 7b70 6174 683a 2072 6f6f        {path: roo
-00018640: 745f 6769 7469 676e 6f72 657d 2c0a 2020  t_gitignore},.  
-00018650: 2020 2020 2020 2020 2020 2020 2020 7665                ve
-00018660: 7262 6f73 653d 4661 6c73 652c 0a20 2020  rbose=False,.   
-00018670: 2020 2020 2020 2020 2020 2020 2071 7569               qui
-00018680: 6574 3d46 616c 7365 2c0a 2020 2020 2020  et=False,.      
-00018690: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000186a0: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
-000186b0: 2073 6f72 7465 6428 6578 7065 6374 6564   sorted(expected
-000186c0: 2920 3d3d 2073 6f72 7465 6428 736f 7572  ) == sorted(sour
-000186d0: 6365 7329 0a0a 2020 2020 6465 6620 7465  ces)..    def te
-000186e0: 7374 5f6e 6573 7465 645f 6769 7469 676e  st_nested_gitign
-000186f0: 6f72 655f 6469 7265 6374 6c79 5f69 6e5f  ore_directly_in_
-00018700: 736f 7572 6365 5f64 6972 6563 746f 7279  source_directory
-00018710: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00018720: 2020 2020 2020 2020 2320 6874 7470 733a          # https:
-00018730: 2f2f 6769 7468 7562 2e63 6f6d 2f70 7366  //github.com/psf
-00018740: 2f62 6c61 636b 2f69 7373 7565 732f 3235  /black/issues/25
-00018750: 3938 0a20 2020 2020 2020 2070 6174 6820  98.        path 
-00018760: 3d20 5061 7468 2844 4154 415f 4449 5220  = Path(DATA_DIR 
-00018770: 2f20 226e 6573 7465 645f 6769 7469 676e  / "nested_gitign
-00018780: 6f72 655f 7465 7374 7322 290a 2020 2020  ore_tests").    
-00018790: 2020 2020 7372 6320 3d20 5061 7468 2870      src = Path(p
-000187a0: 6174 6820 2f20 2272 6f6f 7422 202f 2022  ath / "root" / "
-000187b0: 6368 696c 6422 290a 2020 2020 2020 2020  child").        
-000187c0: 6578 7065 6374 6564 203d 205b 7372 6320  expected = [src 
-000187d0: 2f20 2261 2e70 7922 2c20 7372 6320 2f20  / "a.py", src / 
-000187e0: 2263 2e70 7922 5d0a 2020 2020 2020 2020  "c.py"].        
-000187f0: 6173 7365 7274 5f63 6f6c 6c65 6374 6564  assert_collected
-00018800: 5f73 6f75 7263 6573 285b 7372 635d 2c20  _sources([src], 
-00018810: 6578 7065 6374 6564 290a 0a20 2020 2064  expected)..    d
-00018820: 6566 2074 6573 745f 696e 7661 6c69 645f  ef test_invalid_
-00018830: 6769 7469 676e 6f72 6528 7365 6c66 2920  gitignore(self) 
-00018840: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00018850: 2070 6174 6820 3d20 5448 4953 5f44 4952   path = THIS_DIR
-00018860: 202f 2022 6461 7461 2220 2f20 2269 6e76   / "data" / "inv
-00018870: 616c 6964 5f67 6974 6967 6e6f 7265 5f74  alid_gitignore_t
-00018880: 6573 7473 220a 2020 2020 2020 2020 656d  ests".        em
-00018890: 7074 795f 636f 6e66 6967 203d 2070 6174  pty_config = pat
-000188a0: 6820 2f20 2270 7970 726f 6a65 6374 2e74  h / "pyproject.t
-000188b0: 6f6d 6c22 0a20 2020 2020 2020 2072 6573  oml".        res
-000188c0: 756c 7420 3d20 426c 6163 6b52 756e 6e65  ult = BlackRunne
-000188d0: 7228 292e 696e 766f 6b65 280a 2020 2020  r().invoke(.    
-000188e0: 2020 2020 2020 2020 626c 6163 6b2e 6d61          black.ma
-000188f0: 696e 2c20 5b22 2d2d 7665 7262 6f73 6522  in, ["--verbose"
-00018900: 2c20 222d 2d63 6f6e 6669 6722 2c20 7374  , "--config", st
-00018910: 7228 656d 7074 795f 636f 6e66 6967 292c  r(empty_config),
-00018920: 2073 7472 2870 6174 6829 5d0a 2020 2020   str(path)].    
-00018930: 2020 2020 290a 2020 2020 2020 2020 6173      ).        as
-00018940: 7365 7274 2072 6573 756c 742e 6578 6974  sert result.exit
-00018950: 5f63 6f64 6520 3d3d 2031 0a20 2020 2020  _code == 1.     
-00018960: 2020 2061 7373 6572 7420 7265 7375 6c74     assert result
-00018970: 2e73 7464 6572 725f 6279 7465 7320 6973  .stderr_bytes is
-00018980: 206e 6f74 204e 6f6e 650a 0a20 2020 2020   not None..     
-00018990: 2020 2067 6974 6967 6e6f 7265 203d 2070     gitignore = p
-000189a0: 6174 6820 2f20 222e 6769 7469 676e 6f72  ath / ".gitignor
-000189b0: 6522 0a20 2020 2020 2020 2061 7373 6572  e".        asser
-000189c0: 7420 7265 2e73 6561 7263 6828 0a20 2020  t re.search(.   
-000189d0: 2020 2020 2020 2020 2066 2243 6f75 6c64           f"Could
-000189e0: 206e 6f74 2070 6172 7365 207b 6769 7469   not parse {giti
-000189f0: 676e 6f72 657d 222e 7265 706c 6163 6528  gnore}".replace(
-00018a00: 225c 5c22 2c20 225c 5c5c 5c22 292c 0a20  "\\", "\\\\"),. 
-00018a10: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00018a20: 742e 7374 6465 7272 5f62 7974 6573 2e64  t.stderr_bytes.d
-00018a30: 6563 6f64 6528 292c 0a20 2020 2020 2020  ecode(),.       
-00018a40: 2020 2020 2072 652e 4947 4e4f 5245 4341       re.IGNORECA
-00018a50: 5345 2069 6620 6973 696e 7374 616e 6365  SE if isinstance
-00018a60: 2867 6974 6967 6e6f 7265 2c20 5769 6e64  (gitignore, Wind
-00018a70: 6f77 7350 6174 6829 2065 6c73 6520 302c  owsPath) else 0,
-00018a80: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00018a90: 6465 6620 7465 7374 5f69 6e76 616c 6964  def test_invalid
-00018aa0: 5f6e 6573 7465 645f 6769 7469 676e 6f72  _nested_gitignor
-00018ab0: 6528 7365 6c66 2920 2d3e 204e 6f6e 653a  e(self) -> None:
-00018ac0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-00018ad0: 5448 4953 5f44 4952 202f 2022 6461 7461  THIS_DIR / "data
-00018ae0: 2220 2f20 2269 6e76 616c 6964 5f6e 6573  " / "invalid_nes
-00018af0: 7465 645f 6769 7469 676e 6f72 655f 7465  ted_gitignore_te
-00018b00: 7374 7322 0a20 2020 2020 2020 2065 6d70  sts".        emp
-00018b10: 7479 5f63 6f6e 6669 6720 3d20 7061 7468  ty_config = path
-00018b20: 202f 2022 7079 7072 6f6a 6563 742e 746f   / "pyproject.to
-00018b30: 6d6c 220a 2020 2020 2020 2020 7265 7375  ml".        resu
-00018b40: 6c74 203d 2042 6c61 636b 5275 6e6e 6572  lt = BlackRunner
-00018b50: 2829 2e69 6e76 6f6b 6528 0a20 2020 2020  ().invoke(.     
-00018b60: 2020 2020 2020 2062 6c61 636b 2e6d 6169         black.mai
-00018b70: 6e2c 205b 222d 2d76 6572 626f 7365 222c  n, ["--verbose",
-00018b80: 2022 2d2d 636f 6e66 6967 222c 2073 7472   "--config", str
-00018b90: 2865 6d70 7479 5f63 6f6e 6669 6729 2c20  (empty_config), 
-00018ba0: 7374 7228 7061 7468 295d 0a20 2020 2020  str(path)].     
-00018bb0: 2020 2029 0a20 2020 2020 2020 2061 7373     ).        ass
-00018bc0: 6572 7420 7265 7375 6c74 2e65 7869 745f  ert result.exit_
-00018bd0: 636f 6465 203d 3d20 310a 2020 2020 2020  code == 1.      
-00018be0: 2020 6173 7365 7274 2072 6573 756c 742e    assert result.
-00018bf0: 7374 6465 7272 5f62 7974 6573 2069 7320  stderr_bytes is 
-00018c00: 6e6f 7420 4e6f 6e65 0a0a 2020 2020 2020  not None..      
-00018c10: 2020 6769 7469 676e 6f72 6520 3d20 7061    gitignore = pa
-00018c20: 7468 202f 2022 6122 202f 2022 2e67 6974  th / "a" / ".git
-00018c30: 6967 6e6f 7265 220a 2020 2020 2020 2020  ignore".        
-00018c40: 6173 7365 7274 2072 652e 7365 6172 6368  assert re.search
-00018c50: 280a 2020 2020 2020 2020 2020 2020 6622  (.            f"
-00018c60: 436f 756c 6420 6e6f 7420 7061 7273 6520  Could not parse 
-00018c70: 7b67 6974 6967 6e6f 7265 7d22 2e72 6570  {gitignore}".rep
-00018c80: 6c61 6365 2822 5c5c 222c 2022 5c5c 5c5c  lace("\\", "\\\\
-00018c90: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-00018ca0: 7265 7375 6c74 2e73 7464 6572 725f 6279  result.stderr_by
-00018cb0: 7465 732e 6465 636f 6465 2829 2c0a 2020  tes.decode(),.  
-00018cc0: 2020 2020 2020 2020 2020 7265 2e49 474e            re.IGN
-00018cd0: 4f52 4543 4153 4520 6966 2069 7369 6e73  ORECASE if isins
-00018ce0: 7461 6e63 6528 6769 7469 676e 6f72 652c  tance(gitignore,
-00018cf0: 2057 696e 646f 7773 5061 7468 2920 656c   WindowsPath) el
-00018d00: 7365 2030 2c0a 2020 2020 2020 2020 290a  se 0,.        ).
-00018d10: 0a20 2020 2064 6566 2074 6573 745f 6769  .    def test_gi
-00018d20: 7469 676e 6f72 655f 7468 6174 5f69 676e  tignore_that_ign
-00018d30: 6f72 6573 5f73 7562 666f 6c64 6572 7328  ores_subfolders(
-00018d40: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00018d50: 2020 2020 2020 2023 2049 6620 6769 7469         # If giti
-00018d60: 676e 6f72 6520 7769 7468 202a 2f2a 2069  gnore with */* i
-00018d70: 7320 696e 2072 6f6f 740a 2020 2020 2020  s in root.      
-00018d80: 2020 726f 6f74 203d 2050 6174 6828 4441    root = Path(DA
-00018d90: 5441 5f44 4952 202f 2022 6967 6e6f 7265  TA_DIR / "ignore
-00018da0: 5f73 7562 666f 6c64 6572 735f 6769 7469  _subfolders_giti
-00018db0: 676e 6f72 655f 7465 7374 7322 202f 2022  gnore_tests" / "
-00018dc0: 7375 6264 6972 2229 0a20 2020 2020 2020  subdir").       
-00018dd0: 2065 7870 6563 7465 6420 3d20 5b72 6f6f   expected = [roo
-00018de0: 7420 2f20 2262 2e70 7922 5d0a 2020 2020  t / "b.py"].    
-00018df0: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
-00018e00: 6374 6564 5f73 6f75 7263 6573 285b 726f  cted_sources([ro
-00018e10: 6f74 5d2c 2065 7870 6563 7465 642c 2072  ot], expected, r
-00018e20: 6f6f 743d 726f 6f74 290a 0a20 2020 2020  oot=root)..     
-00018e30: 2020 2023 2049 6620 2e67 6974 6967 6e6f     # If .gitigno
-00018e40: 7265 2077 6974 6820 2a2f 2a20 6973 206e  re with */* is n
-00018e50: 6573 7465 640a 2020 2020 2020 2020 726f  ested.        ro
-00018e60: 6f74 203d 2050 6174 6828 4441 5441 5f44  ot = Path(DATA_D
-00018e70: 4952 202f 2022 6967 6e6f 7265 5f73 7562  IR / "ignore_sub
-00018e80: 666f 6c64 6572 735f 6769 7469 676e 6f72  folders_gitignor
-00018e90: 655f 7465 7374 7322 290a 2020 2020 2020  e_tests").      
-00018ea0: 2020 6578 7065 6374 6564 203d 205b 0a20    expected = [. 
-00018eb0: 2020 2020 2020 2020 2020 2072 6f6f 7420             root 
-00018ec0: 2f20 2261 2e70 7922 2c0a 2020 2020 2020  / "a.py",.      
-00018ed0: 2020 2020 2020 726f 6f74 202f 2022 7375        root / "su
-00018ee0: 6264 6972 2220 2f20 2262 2e70 7922 2c0a  bdir" / "b.py",.
-00018ef0: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-00018f00: 2020 6173 7365 7274 5f63 6f6c 6c65 6374    assert_collect
-00018f10: 6564 5f73 6f75 7263 6573 285b 726f 6f74  ed_sources([root
-00018f20: 5d2c 2065 7870 6563 7465 642c 2072 6f6f  ], expected, roo
-00018f30: 743d 726f 6f74 290a 0a20 2020 2020 2020  t=root)..       
-00018f40: 2023 2049 6620 636f 6d6d 616e 6420 6973   # If command is
-00018f50: 2065 7865 6375 7465 6420 6672 6f6d 206f   executed from o
-00018f60: 7574 6572 2064 6972 0a20 2020 2020 2020  uter dir.       
-00018f70: 2072 6f6f 7420 3d20 5061 7468 2844 4154   root = Path(DAT
-00018f80: 415f 4449 5220 2f20 2269 676e 6f72 655f  A_DIR / "ignore_
-00018f90: 7375 6266 6f6c 6465 7273 5f67 6974 6967  subfolders_gitig
-00018fa0: 6e6f 7265 5f74 6573 7473 2229 0a20 2020  nore_tests").   
-00018fb0: 2020 2020 2074 6172 6765 7420 3d20 726f       target = ro
-00018fc0: 6f74 202f 2022 7375 6264 6972 220a 2020  ot / "subdir".  
-00018fd0: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
-00018fe0: 205b 7461 7267 6574 202f 2022 622e 7079   [target / "b.py
-00018ff0: 225d 0a20 2020 2020 2020 2061 7373 6572  "].        asser
-00019000: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
-00019010: 6365 7328 5b74 6172 6765 745d 2c20 6578  ces([target], ex
-00019020: 7065 6374 6564 2c20 726f 6f74 3d72 6f6f  pected, root=roo
-00019030: 7429 0a0a 2020 2020 6465 6620 7465 7374  t)..    def test
-00019040: 5f65 6d70 7479 5f69 6e63 6c75 6465 2873  _empty_include(s
-00019050: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00019060: 2020 2020 2020 7061 7468 203d 2044 4154        path = DAT
-00019070: 415f 4449 5220 2f20 2269 6e63 6c75 6465  A_DIR / "include
-00019080: 5f65 7863 6c75 6465 5f74 6573 7473 220a  _exclude_tests".
-00019090: 2020 2020 2020 2020 7372 6320 3d20 5b70          src = [p
-000190a0: 6174 685d 0a20 2020 2020 2020 2065 7870  ath].        exp
-000190b0: 6563 7465 6420 3d20 5b0a 2020 2020 2020  ected = [.      
-000190c0: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
-000190d0: 2f20 2262 2f65 7863 6c75 6465 2f61 2e70  / "b/exclude/a.p
-000190e0: 6965 2229 2c0a 2020 2020 2020 2020 2020  ie"),.          
-000190f0: 2020 5061 7468 2870 6174 6820 2f20 2262    Path(path / "b
-00019100: 2f65 7863 6c75 6465 2f61 2e70 7922 292c  /exclude/a.py"),
-00019110: 0a20 2020 2020 2020 2020 2020 2050 6174  .            Pat
-00019120: 6828 7061 7468 202f 2022 622f 6578 636c  h(path / "b/excl
-00019130: 7564 652f 612e 7079 6922 292c 0a20 2020  ude/a.pyi"),.   
-00019140: 2020 2020 2020 2020 2050 6174 6828 7061           Path(pa
-00019150: 7468 202f 2022 622f 646f 6e74 5f65 7863  th / "b/dont_exc
-00019160: 6c75 6465 2f61 2e70 6965 2229 2c0a 2020  lude/a.pie"),.  
-00019170: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
-00019180: 6174 6820 2f20 2262 2f64 6f6e 745f 6578  ath / "b/dont_ex
-00019190: 636c 7564 652f 612e 7079 2229 2c0a 2020  clude/a.py"),.  
-000191a0: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
-000191b0: 6174 6820 2f20 2262 2f64 6f6e 745f 6578  ath / "b/dont_ex
-000191c0: 636c 7564 652f 612e 7079 6922 292c 0a20  clude/a.pyi"),. 
-000191d0: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
-000191e0: 7061 7468 202f 2022 622f 2e64 6566 696e  path / "b/.defin
-000191f0: 6974 656c 795f 6578 636c 7564 652f 612e  itely_exclude/a.
-00019200: 7069 6522 292c 0a20 2020 2020 2020 2020  pie"),.         
-00019210: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
-00019220: 622f 2e64 6566 696e 6974 656c 795f 6578  b/.definitely_ex
-00019230: 636c 7564 652f 612e 7079 2229 2c0a 2020  clude/a.py"),.  
-00019240: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
-00019250: 6174 6820 2f20 2262 2f2e 6465 6669 6e69  ath / "b/.defini
-00019260: 7465 6c79 5f65 7863 6c75 6465 2f61 2e70  tely_exclude/a.p
-00019270: 7969 2229 2c0a 2020 2020 2020 2020 2020  yi"),.          
-00019280: 2020 5061 7468 2870 6174 6820 2f20 222e    Path(path / ".
-00019290: 6769 7469 676e 6f72 6522 292c 0a20 2020  gitignore"),.   
-000192a0: 2020 2020 2020 2020 2050 6174 6828 7061           Path(pa
-000192b0: 7468 202f 2022 7079 7072 6f6a 6563 742e  th / "pyproject.
-000192c0: 746f 6d6c 2229 2c0a 2020 2020 2020 2020  toml"),.        
-000192d0: 5d0a 2020 2020 2020 2020 2320 5365 7474  ].        # Sett
-000192e0: 696e 6720 6578 636c 7564 6520 6578 706c  ing exclude expl
-000192f0: 6963 6974 6c79 2074 6f20 616e 2065 6d70  icitly to an emp
-00019300: 7479 2073 7472 696e 6720 746f 2062 6c6f  ty string to blo
-00019310: 636b 202e 6769 7469 676e 6f72 6520 7573  ck .gitignore us
-00019320: 6167 652e 0a20 2020 2020 2020 2061 7373  age..        ass
-00019330: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
-00019340: 7572 6365 7328 7372 632c 2065 7870 6563  urces(src, expec
-00019350: 7465 642c 2069 6e63 6c75 6465 3d22 222c  ted, include="",
-00019360: 2065 7863 6c75 6465 3d22 2229 0a0a 2020   exclude="")..  
-00019370: 2020 6465 6620 7465 7374 5f69 6e63 6c75    def test_inclu
-00019380: 6465 5f61 6273 6f6c 7574 655f 7061 7468  de_absolute_path
-00019390: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-000193a0: 2020 2020 2020 2020 7061 7468 203d 2044          path = D
-000193b0: 4154 415f 4449 5220 2f20 2269 6e63 6c75  ATA_DIR / "inclu
-000193c0: 6465 5f65 7863 6c75 6465 5f74 6573 7473  de_exclude_tests
-000193d0: 220a 2020 2020 2020 2020 7372 6320 3d20  ".        src = 
-000193e0: 5b70 6174 685d 0a20 2020 2020 2020 2065  [path].        e
-000193f0: 7870 6563 7465 6420 3d20 5b0a 2020 2020  xpected = [.    
-00019400: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
-00019410: 6820 2f20 2262 2f64 6f6e 745f 6578 636c  h / "b/dont_excl
-00019420: 7564 652f 612e 7069 6522 292c 0a20 2020  ude/a.pie"),.   
-00019430: 2020 2020 205d 0a20 2020 2020 2020 2061       ].        a
-00019440: 7373 6572 745f 636f 6c6c 6563 7465 645f  ssert_collected_
-00019450: 736f 7572 6365 7328 0a20 2020 2020 2020  sources(.       
-00019460: 2020 2020 2073 7263 2c20 6578 7065 6374       src, expect
-00019470: 6564 2c20 726f 6f74 3d70 6174 682c 2069  ed, root=path, i
-00019480: 6e63 6c75 6465 3d72 225e 2f62 2f64 6f6e  nclude=r"^/b/don
-00019490: 745f 6578 636c 7564 652f 615c 2e70 6965  t_exclude/a\.pie
-000194a0: 2422 2c20 6578 636c 7564 653d 2222 0a20  $", exclude="". 
-000194b0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-000194c0: 6620 7465 7374 5f65 7863 6c75 6465 5f61  f test_exclude_a
-000194d0: 6273 6f6c 7574 655f 7061 7468 2873 656c  bsolute_path(sel
-000194e0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-000194f0: 2020 2020 7061 7468 203d 2044 4154 415f      path = DATA_
-00019500: 4449 5220 2f20 2269 6e63 6c75 6465 5f65  DIR / "include_e
-00019510: 7863 6c75 6465 5f74 6573 7473 220a 2020  xclude_tests".  
-00019520: 2020 2020 2020 7372 6320 3d20 5b70 6174        src = [pat
-00019530: 685d 0a20 2020 2020 2020 2065 7870 6563  h].        expec
-00019540: 7465 6420 3d20 5b0a 2020 2020 2020 2020  ted = [.        
-00019550: 2020 2020 5061 7468 2870 6174 6820 2f20      Path(path / 
-00019560: 2262 2f64 6f6e 745f 6578 636c 7564 652f  "b/dont_exclude/
-00019570: 612e 7079 2229 2c0a 2020 2020 2020 2020  a.py"),.        
-00019580: 2020 2020 5061 7468 2870 6174 6820 2f20      Path(path / 
-00019590: 2262 2f2e 6465 6669 6e69 7465 6c79 5f65  "b/.definitely_e
-000195a0: 7863 6c75 6465 2f61 2e70 7922 292c 0a20  xclude/a.py"),. 
-000195b0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-000195c0: 2061 7373 6572 745f 636f 6c6c 6563 7465   assert_collecte
-000195d0: 645f 736f 7572 6365 7328 0a20 2020 2020  d_sources(.     
-000195e0: 2020 2020 2020 2073 7263 2c20 6578 7065         src, expe
-000195f0: 6374 6564 2c20 726f 6f74 3d70 6174 682c  cted, root=path,
-00019600: 2069 6e63 6c75 6465 3d72 225c 2e70 7924   include=r"\.py$
-00019610: 222c 2065 7863 6c75 6465 3d72 225e 2f62  ", exclude=r"^/b
-00019620: 2f65 7863 6c75 6465 2f61 5c2e 7079 2422  /exclude/a\.py$"
-00019630: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00019640: 6465 6620 7465 7374 5f65 7874 656e 645f  def test_extend_
-00019650: 6578 636c 7564 6528 7365 6c66 2920 2d3e  exclude(self) ->
-00019660: 204e 6f6e 653a 0a20 2020 2020 2020 2070   None:.        p
-00019670: 6174 6820 3d20 4441 5441 5f44 4952 202f  ath = DATA_DIR /
-00019680: 2022 696e 636c 7564 655f 6578 636c 7564   "include_exclud
-00019690: 655f 7465 7374 7322 0a20 2020 2020 2020  e_tests".       
-000196a0: 2073 7263 203d 205b 7061 7468 5d0a 2020   src = [path].  
-000196b0: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
-000196c0: 205b 0a20 2020 2020 2020 2020 2020 2050   [.            P
-000196d0: 6174 6828 7061 7468 202f 2022 622f 6578  ath(path / "b/ex
-000196e0: 636c 7564 652f 612e 7079 2229 2c0a 2020  clude/a.py"),.  
-000196f0: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
-00019700: 6174 6820 2f20 2262 2f64 6f6e 745f 6578  ath / "b/dont_ex
-00019710: 636c 7564 652f 612e 7079 2229 2c0a 2020  clude/a.py"),.  
-00019720: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-00019730: 6173 7365 7274 5f63 6f6c 6c65 6374 6564  assert_collected
-00019740: 5f73 6f75 7263 6573 280a 2020 2020 2020  _sources(.      
-00019750: 2020 2020 2020 7372 632c 2065 7870 6563        src, expec
-00019760: 7465 642c 2065 7863 6c75 6465 3d72 225c  ted, exclude=r"\
-00019770: 2e70 7969 2422 2c20 6578 7465 6e64 5f65  .pyi$", extend_e
-00019780: 7863 6c75 6465 3d72 225c 2e64 6566 696e  xclude=r"\.defin
-00019790: 6974 656c 795f 6578 636c 7564 6522 0a20  itely_exclude". 
-000197a0: 2020 2020 2020 2029 0a0a 2020 2020 4070         )..    @p
-000197b0: 7974 6573 742e 6d61 726b 2e69 6e63 6f6d  ytest.mark.incom
-000197c0: 7061 7469 626c 655f 7769 7468 5f6d 7970  patible_with_myp
-000197d0: 7963 0a20 2020 2064 6566 2074 6573 745f  yc.    def test_
-000197e0: 7379 6d6c 696e 6b73 2873 656c 6629 202d  symlinks(self) -
-000197f0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00019800: 726f 6f74 203d 2054 4849 535f 4449 522e  root = THIS_DIR.
-00019810: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
-00019820: 2020 696e 636c 7564 6520 3d20 7265 2e63    include = re.c
-00019830: 6f6d 7069 6c65 2862 6c61 636b 2e44 4546  ompile(black.DEF
-00019840: 4155 4c54 5f49 4e43 4c55 4445 5329 0a20  AULT_INCLUDES). 
-00019850: 2020 2020 2020 2065 7863 6c75 6465 203d         exclude =
-00019860: 2072 652e 636f 6d70 696c 6528 626c 6163   re.compile(blac
-00019870: 6b2e 4445 4641 554c 545f 4558 434c 5544  k.DEFAULT_EXCLUD
-00019880: 4553 290a 2020 2020 2020 2020 7265 706f  ES).        repo
-00019890: 7274 203d 2062 6c61 636b 2e52 6570 6f72  rt = black.Repor
-000198a0: 7428 290a 2020 2020 2020 2020 6769 7469  t().        giti
-000198b0: 676e 6f72 6520 3d20 5061 7468 5370 6563  gnore = PathSpec
-000198c0: 2e66 726f 6d5f 6c69 6e65 7328 2267 6974  .from_lines("git
-000198d0: 7769 6c64 6d61 7463 6822 2c20 5b5d 290a  wildmatch", []).
-000198e0: 0a20 2020 2020 2020 2072 6567 756c 6172  .        regular
-000198f0: 203d 204d 6167 6963 4d6f 636b 2829 0a20   = MagicMock(). 
-00019900: 2020 2020 2020 2072 6567 756c 6172 2e72         regular.r
-00019910: 656c 6174 6976 655f 746f 2e72 6574 7572  elative_to.retur
-00019920: 6e5f 7661 6c75 6520 3d20 5061 7468 2822  n_value = Path("
-00019930: 7265 6775 6c61 722e 7079 2229 0a20 2020  regular.py").   
-00019940: 2020 2020 2072 6567 756c 6172 2e72 6573       regular.res
-00019950: 6f6c 7665 2e72 6574 7572 6e5f 7661 6c75  olve.return_valu
-00019960: 6520 3d20 726f 6f74 202f 2022 7265 6775  e = root / "regu
-00019970: 6c61 722e 7079 220a 2020 2020 2020 2020  lar.py".        
-00019980: 7265 6775 6c61 722e 6973 5f64 6972 2e72  regular.is_dir.r
-00019990: 6574 7572 6e5f 7661 6c75 6520 3d20 4661  eturn_value = Fa
-000199a0: 6c73 650a 2020 2020 2020 2020 7265 6775  lse.        regu
-000199b0: 6c61 722e 6973 5f66 696c 652e 7265 7475  lar.is_file.retu
-000199c0: 726e 5f76 616c 7565 203d 2054 7275 650a  rn_value = True.
-000199d0: 0a20 2020 2020 2020 206f 7574 7369 6465  .        outside
-000199e0: 5f72 6f6f 745f 7379 6d6c 696e 6b20 3d20  _root_symlink = 
-000199f0: 4d61 6769 634d 6f63 6b28 290a 2020 2020  MagicMock().    
-00019a00: 2020 2020 6f75 7473 6964 655f 726f 6f74      outside_root
-00019a10: 5f73 796d 6c69 6e6b 2e72 656c 6174 6976  _symlink.relativ
-00019a20: 655f 746f 2e72 6574 7572 6e5f 7661 6c75  e_to.return_valu
-00019a30: 6520 3d20 5061 7468 2822 7379 6d6c 696e  e = Path("symlin
-00019a40: 6b2e 7079 2229 0a20 2020 2020 2020 206f  k.py").        o
-00019a50: 7574 7369 6465 5f72 6f6f 745f 7379 6d6c  utside_root_syml
-00019a60: 696e 6b2e 7265 736f 6c76 652e 7265 7475  ink.resolve.retu
-00019a70: 726e 5f76 616c 7565 203d 2050 6174 6828  rn_value = Path(
-00019a80: 222f 6e6f 7768 6572 6522 290a 2020 2020  "/nowhere").    
-00019a90: 2020 2020 6f75 7473 6964 655f 726f 6f74      outside_root
-00019aa0: 5f73 796d 6c69 6e6b 2e69 735f 6469 722e  _symlink.is_dir.
-00019ab0: 7265 7475 726e 5f76 616c 7565 203d 2046  return_value = F
-00019ac0: 616c 7365 0a20 2020 2020 2020 206f 7574  alse.        out
-00019ad0: 7369 6465 5f72 6f6f 745f 7379 6d6c 696e  side_root_symlin
-00019ae0: 6b2e 6973 5f66 696c 652e 7265 7475 726e  k.is_file.return
-00019af0: 5f76 616c 7565 203d 2054 7275 650a 0a20  _value = True.. 
-00019b00: 2020 2020 2020 2069 676e 6f72 6564 5f73         ignored_s
-00019b10: 796d 6c69 6e6b 203d 204d 6167 6963 4d6f  ymlink = MagicMo
-00019b20: 636b 2829 0a20 2020 2020 2020 2069 676e  ck().        ign
-00019b30: 6f72 6564 5f73 796d 6c69 6e6b 2e72 656c  ored_symlink.rel
-00019b40: 6174 6976 655f 746f 2e72 6574 7572 6e5f  ative_to.return_
-00019b50: 7661 6c75 6520 3d20 5061 7468 2822 2e6d  value = Path(".m
-00019b60: 7970 795f 6361 6368 6522 2920 2f20 2273  ypy_cache") / "s
-00019b70: 796d 6c69 6e6b 2e70 7922 0a20 2020 2020  ymlink.py".     
-00019b80: 2020 2069 676e 6f72 6564 5f73 796d 6c69     ignored_symli
-00019b90: 6e6b 2e69 735f 6469 722e 7265 7475 726e  nk.is_dir.return
-00019ba0: 5f76 616c 7565 203d 2046 616c 7365 0a20  _value = False. 
-00019bb0: 2020 2020 2020 2069 676e 6f72 6564 5f73         ignored_s
-00019bc0: 796d 6c69 6e6b 2e69 735f 6669 6c65 2e72  ymlink.is_file.r
-00019bd0: 6574 7572 6e5f 7661 6c75 6520 3d20 5472  eturn_value = Tr
-00019be0: 7565 0a0a 2020 2020 2020 2020 2320 4120  ue..        # A 
-00019bf0: 7379 6d6c 696e 6b20 7468 6174 2068 6173  symlink that has
-00019c00: 2061 6e20 6578 636c 7564 6564 206e 616d   an excluded nam
-00019c10: 652c 2062 7574 2070 6f69 6e74 7320 746f  e, but points to
-00019c20: 2061 6e20 696e 636c 7564 6564 206e 616d   an included nam
-00019c30: 650a 2020 2020 2020 2020 7379 6d6c 696e  e.        symlin
-00019c40: 6b5f 6578 636c 7564 6564 5f6e 616d 6520  k_excluded_name 
-00019c50: 3d20 4d61 6769 634d 6f63 6b28 290a 2020  = MagicMock().  
-00019c60: 2020 2020 2020 7379 6d6c 696e 6b5f 6578        symlink_ex
-00019c70: 636c 7564 6564 5f6e 616d 652e 7265 6c61  cluded_name.rela
-00019c80: 7469 7665 5f74 6f2e 7265 7475 726e 5f76  tive_to.return_v
-00019c90: 616c 7565 203d 2050 6174 6828 2265 7863  alue = Path("exc
-00019ca0: 6c75 6465 645f 6e61 6d65 2229 0a20 2020  luded_name").   
-00019cb0: 2020 2020 2073 796d 6c69 6e6b 5f65 7863       symlink_exc
-00019cc0: 6c75 6465 645f 6e61 6d65 2e72 6573 6f6c  luded_name.resol
-00019cd0: 7665 2e72 6574 7572 6e5f 7661 6c75 6520  ve.return_value 
-00019ce0: 3d20 726f 6f74 202f 2022 696e 636c 7564  = root / "includ
-00019cf0: 6564 5f6e 616d 652e 7079 220a 2020 2020  ed_name.py".    
-00019d00: 2020 2020 7379 6d6c 696e 6b5f 6578 636c      symlink_excl
-00019d10: 7564 6564 5f6e 616d 652e 6973 5f64 6972  uded_name.is_dir
-00019d20: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
-00019d30: 4661 6c73 650a 2020 2020 2020 2020 7379  False.        sy
-00019d40: 6d6c 696e 6b5f 6578 636c 7564 6564 5f6e  mlink_excluded_n
-00019d50: 616d 652e 6973 5f66 696c 652e 7265 7475  ame.is_file.retu
-00019d60: 726e 5f76 616c 7565 203d 2054 7275 650a  rn_value = True.
-00019d70: 0a20 2020 2020 2020 2023 2041 2073 796d  .        # A sym
-00019d80: 6c69 6e6b 2074 6861 7420 6861 7320 616e  link that has an
-00019d90: 2069 6e63 6c75 6465 6420 6e61 6d65 2c20   included name, 
-00019da0: 6275 7420 706f 696e 7473 2074 6f20 616e  but points to an
-00019db0: 2065 7863 6c75 6465 6420 6e61 6d65 0a20   excluded name. 
-00019dc0: 2020 2020 2020 2073 796d 6c69 6e6b 5f69         symlink_i
-00019dd0: 6e63 6c75 6465 645f 6e61 6d65 203d 204d  ncluded_name = M
-00019de0: 6167 6963 4d6f 636b 2829 0a20 2020 2020  agicMock().     
-00019df0: 2020 2073 796d 6c69 6e6b 5f69 6e63 6c75     symlink_inclu
-00019e00: 6465 645f 6e61 6d65 2e72 656c 6174 6976  ded_name.relativ
-00019e10: 655f 746f 2e72 6574 7572 6e5f 7661 6c75  e_to.return_valu
-00019e20: 6520 3d20 5061 7468 2822 696e 636c 7564  e = Path("includ
-00019e30: 6564 5f6e 616d 652e 7079 2229 0a20 2020  ed_name.py").   
-00019e40: 2020 2020 2073 796d 6c69 6e6b 5f69 6e63       symlink_inc
-00019e50: 6c75 6465 645f 6e61 6d65 2e72 6573 6f6c  luded_name.resol
-00019e60: 7665 2e72 6574 7572 6e5f 7661 6c75 6520  ve.return_value 
-00019e70: 3d20 726f 6f74 202f 2022 6578 636c 7564  = root / "exclud
-00019e80: 6564 5f6e 616d 6522 0a20 2020 2020 2020  ed_name".       
-00019e90: 2073 796d 6c69 6e6b 5f69 6e63 6c75 6465   symlink_include
-00019ea0: 645f 6e61 6d65 2e69 735f 6469 722e 7265  d_name.is_dir.re
-00019eb0: 7475 726e 5f76 616c 7565 203d 2046 616c  turn_value = Fal
-00019ec0: 7365 0a20 2020 2020 2020 2073 796d 6c69  se.        symli
-00019ed0: 6e6b 5f69 6e63 6c75 6465 645f 6e61 6d65  nk_included_name
-00019ee0: 2e69 735f 6669 6c65 2e72 6574 7572 6e5f  .is_file.return_
-00019ef0: 7661 6c75 6520 3d20 5472 7565 0a0a 2020  value = True..  
-00019f00: 2020 2020 2020 7061 7468 203d 204d 6167        path = Mag
-00019f10: 6963 4d6f 636b 2829 0a20 2020 2020 2020  icMock().       
-00019f20: 2070 6174 682e 6974 6572 6469 722e 7265   path.iterdir.re
-00019f30: 7475 726e 5f76 616c 7565 203d 205b 0a20  turn_value = [. 
-00019f40: 2020 2020 2020 2020 2020 2072 6567 756c             regul
-00019f50: 6172 2c0a 2020 2020 2020 2020 2020 2020  ar,.            
-00019f60: 6f75 7473 6964 655f 726f 6f74 5f73 796d  outside_root_sym
-00019f70: 6c69 6e6b 2c0a 2020 2020 2020 2020 2020  link,.          
-00019f80: 2020 6967 6e6f 7265 645f 7379 6d6c 696e    ignored_symlin
-00019f90: 6b2c 0a20 2020 2020 2020 2020 2020 2073  k,.            s
-00019fa0: 796d 6c69 6e6b 5f65 7863 6c75 6465 645f  ymlink_excluded_
-00019fb0: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00019fc0: 2020 7379 6d6c 696e 6b5f 696e 636c 7564    symlink_includ
-00019fd0: 6564 5f6e 616d 652c 0a20 2020 2020 2020  ed_name,.       
-00019fe0: 205d 0a0a 2020 2020 2020 2020 6669 6c65   ]..        file
-00019ff0: 7320 3d20 6c69 7374 280a 2020 2020 2020  s = list(.      
-0001a000: 2020 2020 2020 626c 6163 6b2e 6765 6e5f        black.gen_
-0001a010: 7079 7468 6f6e 5f66 696c 6573 280a 2020  python_files(.  
-0001a020: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0001a030: 7468 2e69 7465 7264 6972 2829 2c0a 2020  th.iterdir(),.  
-0001a040: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-0001a050: 6f74 2c0a 2020 2020 2020 2020 2020 2020  ot,.            
-0001a060: 2020 2020 696e 636c 7564 652c 0a20 2020      include,.   
-0001a070: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-0001a080: 6c75 6465 2c0a 2020 2020 2020 2020 2020  lude,.          
-0001a090: 2020 2020 2020 4e6f 6e65 2c0a 2020 2020        None,.    
-0001a0a0: 2020 2020 2020 2020 2020 2020 4e6f 6e65              None
-0001a0b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001a0c0: 2020 7265 706f 7274 2c0a 2020 2020 2020    report,.      
-0001a0d0: 2020 2020 2020 2020 2020 7b70 6174 683a            {path:
-0001a0e0: 2067 6974 6967 6e6f 7265 7d2c 0a20 2020   gitignore},.   
-0001a0f0: 2020 2020 2020 2020 2020 2020 2076 6572               ver
-0001a100: 626f 7365 3d46 616c 7365 2c0a 2020 2020  bose=False,.    
-0001a110: 2020 2020 2020 2020 2020 2020 7175 6965              quie
-0001a120: 743d 4661 6c73 652c 0a20 2020 2020 2020  t=False,.       
-0001a130: 2020 2020 2029 0a20 2020 2020 2020 2029       ).        )
-0001a140: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-0001a150: 6669 6c65 7320 3d3d 205b 7265 6775 6c61  files == [regula
-0001a160: 722c 2073 796d 6c69 6e6b 5f69 6e63 6c75  r, symlink_inclu
-0001a170: 6465 645f 6e61 6d65 5d0a 0a20 2020 2020  ded_name]..     
-0001a180: 2020 2070 6174 682e 6974 6572 6469 722e     path.iterdir.
-0001a190: 6173 7365 7274 5f63 616c 6c65 645f 6f6e  assert_called_on
-0001a1a0: 6365 2829 0a20 2020 2020 2020 206f 7574  ce().        out
-0001a1b0: 7369 6465 5f72 6f6f 745f 7379 6d6c 696e  side_root_symlin
-0001a1c0: 6b2e 7265 736f 6c76 652e 6173 7365 7274  k.resolve.assert
-0001a1d0: 5f63 616c 6c65 645f 6f6e 6365 2829 0a20  _called_once(). 
-0001a1e0: 2020 2020 2020 2069 676e 6f72 6564 5f73         ignored_s
-0001a1f0: 796d 6c69 6e6b 2e72 6573 6f6c 7665 2e61  ymlink.resolve.a
-0001a200: 7373 6572 745f 6e6f 745f 6361 6c6c 6564  ssert_not_called
-0001a210: 2829 0a0a 2020 2020 6465 6620 7465 7374  ()..    def test
-0001a220: 5f67 6574 5f73 6f75 7263 6573 5f73 796d  _get_sources_sym
-0001a230: 6c69 6e6b 5f61 6e64 5f66 6f72 6365 5f65  link_and_force_e
-0001a240: 7863 6c75 6465 2873 656c 6629 202d 3e20  xclude(self) -> 
-0001a250: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
-0001a260: 7468 2054 656d 706f 7261 7279 4469 7265  th TemporaryDire
-0001a270: 6374 6f72 7928 2920 6173 2074 656d 7064  ctory() as tempd
-0001a280: 6972 3a0a 2020 2020 2020 2020 2020 2020  ir:.            
-0001a290: 746d 7020 3d20 5061 7468 2874 656d 7064  tmp = Path(tempd
-0001a2a0: 6972 292e 7265 736f 6c76 6528 290a 2020  ir).resolve().  
-0001a2b0: 2020 2020 2020 2020 2020 6163 7475 616c            actual
-0001a2c0: 203d 2074 6d70 202f 2022 6163 7475 616c   = tmp / "actual
-0001a2d0: 220a 2020 2020 2020 2020 2020 2020 6163  ".            ac
-0001a2e0: 7475 616c 2e6d 6b64 6972 2829 0a20 2020  tual.mkdir().   
-0001a2f0: 2020 2020 2020 2020 2073 796d 6c69 6e6b           symlink
-0001a300: 203d 2074 6d70 202f 2022 7379 6d6c 696e   = tmp / "symlin
-0001a310: 6b22 0a20 2020 2020 2020 2020 2020 2073  k".            s
-0001a320: 796d 6c69 6e6b 2e73 796d 6c69 6e6b 5f74  ymlink.symlink_t
-0001a330: 6f28 6163 7475 616c 290a 0a20 2020 2020  o(actual)..     
-0001a340: 2020 2020 2020 2061 6374 7561 6c5f 7072         actual_pr
-0001a350: 6f6a 203d 2061 6374 7561 6c20 2f20 2270  oj = actual / "p
-0001a360: 726f 6a65 6374 220a 2020 2020 2020 2020  roject".        
-0001a370: 2020 2020 6163 7475 616c 5f70 726f 6a2e      actual_proj.
-0001a380: 6d6b 6469 7228 290a 2020 2020 2020 2020  mkdir().        
-0001a390: 2020 2020 2861 6374 7561 6c5f 7072 6f6a      (actual_proj
-0001a3a0: 202f 2022 6d6f 6475 6c65 2e70 7922 292e   / "module.py").
-0001a3b0: 7772 6974 655f 7465 7874 2822 7072 696e  write_text("prin
-0001a3c0: 7428 2768 656c 6c6f 2729 222c 2065 6e63  t('hello')", enc
-0001a3d0: 6f64 696e 673d 2275 7466 2d38 2229 0a0a  oding="utf-8")..
-0001a3e0: 2020 2020 2020 2020 2020 2020 7379 6d6c              syml
-0001a3f0: 696e 6b5f 7072 6f6a 203d 2073 796d 6c69  ink_proj = symli
-0001a400: 6e6b 202f 2022 7072 6f6a 6563 7422 0a0a  nk / "project"..
-0001a410: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0001a420: 2063 6861 6e67 655f 6469 7265 6374 6f72   change_director
-0001a430: 7928 7379 6d6c 696e 6b5f 7072 6f6a 293a  y(symlink_proj):
-0001a440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a450: 2061 7373 6572 745f 636f 6c6c 6563 7465   assert_collecte
-0001a460: 645f 736f 7572 6365 7328 0a20 2020 2020  d_sources(.     
-0001a470: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001a480: 7263 3d5b 226d 6f64 756c 652e 7079 225d  rc=["module.py"]
-0001a490: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001a4a0: 2020 2020 2020 726f 6f74 3d73 796d 6c69        root=symli
-0001a4b0: 6e6b 5f70 726f 6a2e 7265 736f 6c76 6528  nk_proj.resolve(
-0001a4c0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0001a4d0: 2020 2020 2020 2065 7870 6563 7465 643d         expected=
-0001a4e0: 5b22 6d6f 6475 6c65 2e70 7922 5d2c 0a20  ["module.py"],. 
-0001a4f0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001a500: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a510: 2020 6162 736f 6c75 7465 5f6d 6f64 756c    absolute_modul
-0001a520: 6520 3d20 7379 6d6c 696e 6b5f 7072 6f6a  e = symlink_proj
-0001a530: 202f 2022 6d6f 6475 6c65 2e70 7922 0a20   / "module.py". 
-0001a540: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0001a550: 7373 6572 745f 636f 6c6c 6563 7465 645f  ssert_collected_
-0001a560: 736f 7572 6365 7328 0a20 2020 2020 2020  sources(.       
-0001a570: 2020 2020 2020 2020 2020 2020 2073 7263               src
-0001a580: 3d5b 6162 736f 6c75 7465 5f6d 6f64 756c  =[absolute_modul
-0001a590: 655d 2c0a 2020 2020 2020 2020 2020 2020  e],.            
-0001a5a0: 2020 2020 2020 2020 726f 6f74 3d73 796d          root=sym
-0001a5b0: 6c69 6e6b 5f70 726f 6a2e 7265 736f 6c76  link_proj.resolv
-0001a5c0: 6528 292c 0a20 2020 2020 2020 2020 2020  e(),.           
-0001a5d0: 2020 2020 2020 2020 2065 7870 6563 7465           expecte
-0001a5e0: 643d 5b61 6273 6f6c 7574 655f 6d6f 6475  d=[absolute_modu
-0001a5f0: 6c65 5d2c 0a20 2020 2020 2020 2020 2020  le],.           
-0001a600: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0001a610: 2020 2020 2020 2020 2320 6120 6665 7720          # a few 
-0001a620: 7472 6963 6b79 2074 6573 7473 2066 6f72  tricky tests for
-0001a630: 2066 6f72 6365 5f65 7863 6c75 6465 0a20   force_exclude. 
-0001a640: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001a650: 6c61 745f 7379 6d6c 696e 6b20 3d20 7379  lat_symlink = sy
-0001a660: 6d6c 696e 6b5f 7072 6f6a 202f 2022 7379  mlink_proj / "sy
-0001a670: 6d6c 696e 6b5f 6d6f 6475 6c65 2e70 7922  mlink_module.py"
-0001a680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a690: 2066 6c61 745f 7379 6d6c 696e 6b2e 7379   flat_symlink.sy
-0001a6a0: 6d6c 696e 6b5f 746f 2861 6374 7561 6c5f  mlink_to(actual_
-0001a6b0: 7072 6f6a 202f 2022 6d6f 6475 6c65 2e70  proj / "module.p
-0001a6c0: 7922 290a 2020 2020 2020 2020 2020 2020  y").            
-0001a6d0: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
-0001a6e0: 6374 6564 5f73 6f75 7263 6573 280a 2020  cted_sources(.  
-0001a6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a700: 2020 7372 633d 5b66 6c61 745f 7379 6d6c    src=[flat_syml
-0001a710: 696e 6b5d 2c0a 2020 2020 2020 2020 2020  ink],.          
-0001a720: 2020 2020 2020 2020 2020 726f 6f74 3d73            root=s
-0001a730: 796d 6c69 6e6b 5f70 726f 6a2e 7265 736f  ymlink_proj.reso
-0001a740: 6c76 6528 292c 0a20 2020 2020 2020 2020  lve(),.         
-0001a750: 2020 2020 2020 2020 2020 2066 6f72 6365             force
-0001a760: 5f65 7863 6c75 6465 3d72 222f 7379 6d6c  _exclude=r"/syml
-0001a770: 696e 6b5f 6d6f 6475 6c65 2e70 7922 2c0a  ink_module.py",.
-0001a780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a790: 2020 2020 6578 7065 6374 6564 3d5b 5d2c      expected=[],
-0001a7a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a7b0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-0001a7c0: 2020 2020 7461 7267 6574 203d 2061 6374      target = act
-0001a7d0: 7561 6c5f 7072 6f6a 202f 2022 7461 7267  ual_proj / "targ
-0001a7e0: 6574 220a 2020 2020 2020 2020 2020 2020  et".            
-0001a7f0: 2020 2020 7461 7267 6574 2e6d 6b64 6972      target.mkdir
-0001a800: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0001a810: 2020 2028 7461 7267 6574 202f 2022 616e     (target / "an
-0001a820: 6f74 6865 722e 7079 2229 2e77 7269 7465  other.py").write
-0001a830: 5f74 6578 7428 2270 7269 6e74 2827 6865  _text("print('he
-0001a840: 6c6c 6f27 2922 2c20 656e 636f 6469 6e67  llo')", encoding
-0001a850: 3d22 7574 662d 3822 290a 2020 2020 2020  ="utf-8").      
-0001a860: 2020 2020 2020 2020 2020 2873 796d 6c69            (symli
+000049c0: 220a 0a20 2020 2020 2020 2077 6974 6820  "..        with 
+000049d0: 6368 616e 6765 5f64 6972 6563 746f 7279  change_directory
+000049e0: 2877 6f72 6b69 6e67 5f64 6972 6563 746f  (working_directo
+000049f0: 7279 293a 0a20 2020 2020 2020 2020 2020  ry):.           
+00004a00: 2023 204e 6f74 6520 7468 6174 2074 6865   # Note that the
+00004a10: 2072 6f6f 7420 666f 6c64 6572 2028 7072   root folder (pr
+00004a20: 6f6a 6563 745f 726f 6f74 2920 6973 6e27  oject_root) isn'
+00004a30: 7420 7468 6520 666f 6c64 6572 0a20 2020  t the folder.   
+00004a40: 2020 2020 2020 2020 2023 206e 616d 6564           # named
+00004a50: 2022 726f 6f74 2220 2861 6b61 2077 6f72   "root" (aka wor
+00004a60: 6b69 6e67 5f64 6972 6563 746f 7279 290a  king_directory).
+00004a70: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+00004a80: 7274 203d 204d 6167 6963 4d6f 636b 2876  rt = MagicMock(v
+00004a90: 6572 626f 7365 3d54 7275 6529 0a20 2020  erbose=True).   
+00004aa0: 2020 2020 2020 2020 2062 6c61 636b 2e67           black.g
+00004ab0: 6574 5f73 6f75 7263 6573 280a 2020 2020  et_sources(.    
+00004ac0: 2020 2020 2020 2020 2020 2020 726f 6f74              root
+00004ad0: 3d70 726f 6a65 6374 5f72 6f6f 742c 0a20  =project_root,. 
+00004ae0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00004af0: 7263 3d28 222e 2f63 6869 6c64 222c 292c  rc=("./child",),
+00004b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004b10: 2071 7569 6574 3d46 616c 7365 2c0a 2020   quiet=False,.  
+00004b20: 2020 2020 2020 2020 2020 2020 2020 7665                ve
+00004b30: 7262 6f73 653d 5472 7565 2c0a 2020 2020  rbose=True,.    
+00004b40: 2020 2020 2020 2020 2020 2020 696e 636c              incl
+00004b50: 7564 653d 4445 4641 554c 545f 494e 434c  ude=DEFAULT_INCL
+00004b60: 5544 452c 0a20 2020 2020 2020 2020 2020  UDE,.           
+00004b70: 2020 2020 2065 7863 6c75 6465 3d4e 6f6e       exclude=Non
+00004b80: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00004b90: 2020 2072 6570 6f72 743d 7265 706f 7274     report=report
+00004ba0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00004bb0: 2020 6578 7465 6e64 5f65 7863 6c75 6465    extend_exclude
+00004bc0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
+00004bd0: 2020 2020 2020 2066 6f72 6365 5f65 7863         force_exc
+00004be0: 6c75 6465 3d4e 6f6e 652c 0a20 2020 2020  lude=None,.     
+00004bf0: 2020 2020 2020 2020 2020 2073 7464 696e             stdin
+00004c00: 5f66 696c 656e 616d 653d 4e6f 6e65 2c0a  _filename=None,.
+00004c10: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00004c20: 2020 2020 2020 6173 7365 7274 206e 6f74        assert not
+00004c30: 2061 6e79 280a 2020 2020 2020 2020 2020   any(.          
+00004c40: 2020 6d6f 636b 5f61 7267 735b 315d 2e73    mock_args[1].s
+00004c50: 7461 7274 7377 6974 6828 2269 7320 6120  tartswith("is a 
+00004c60: 7379 6d62 6f6c 6963 206c 696e 6b20 7468  symbolic link th
+00004c70: 6174 2070 6f69 6e74 7320 6f75 7473 6964  at points outsid
+00004c80: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
+00004c90: 666f 7220 5f2c 206d 6f63 6b5f 6172 6773  for _, mock_args
+00004ca0: 2c20 5f20 696e 2072 6570 6f72 742e 7061  , _ in report.pa
+00004cb0: 7468 5f69 676e 6f72 6564 2e6d 6f63 6b5f  th_ignored.mock_
+00004cc0: 6361 6c6c 730a 2020 2020 2020 2020 292c  calls.        ),
+00004cd0: 2022 4120 7379 6d62 6f6c 6963 206c 696e   "A symbolic lin
+00004ce0: 6b20 7761 7320 7265 706f 7274 6564 2e22  k was reported."
+00004cf0: 0a20 2020 2020 2020 2072 6570 6f72 742e  .        report.
+00004d00: 7061 7468 5f69 676e 6f72 6564 2e61 7373  path_ignored.ass
+00004d10: 6572 745f 6361 6c6c 6564 5f6f 6e63 655f  ert_called_once_
+00004d20: 7769 7468 280a 2020 2020 2020 2020 2020  with(.          
+00004d30: 2020 5061 7468 2877 6f72 6b69 6e67 5f64    Path(working_d
+00004d40: 6972 6563 746f 7279 2c20 2263 6869 6c64  irectory, "child
+00004d50: 222c 2022 622e 7079 2229 2c0a 2020 2020  ", "b.py"),.    
+00004d60: 2020 2020 2020 2020 226d 6174 6368 6573          "matches
+00004d70: 2061 202e 6769 7469 676e 6f72 6520 6669   a .gitignore fi
+00004d80: 6c65 2063 6f6e 7465 6e74 222c 0a20 2020  le content",.   
+00004d90: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00004da0: 7465 7374 5f72 6570 6f72 745f 7665 7262  test_report_verb
+00004db0: 6f73 6528 7365 6c66 2920 2d3e 204e 6f6e  ose(self) -> Non
+00004dc0: 653a 0a20 2020 2020 2020 2072 6570 6f72  e:.        repor
+00004dd0: 7420 3d20 5265 706f 7274 2876 6572 626f  t = Report(verbo
+00004de0: 7365 3d54 7275 6529 0a20 2020 2020 2020  se=True).       
+00004df0: 206f 7574 5f6c 696e 6573 203d 205b 5d0a   out_lines = [].
+00004e00: 2020 2020 2020 2020 6572 725f 6c69 6e65          err_line
+00004e10: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
+00004e20: 6465 6620 6f75 7428 6d73 673a 2073 7472  def out(msg: str
+00004e30: 2c20 2a2a 6b77 6172 6773 3a20 416e 7929  , **kwargs: Any)
+00004e40: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00004e50: 2020 2020 2020 6f75 745f 6c69 6e65 732e        out_lines.
+00004e60: 6170 7065 6e64 286d 7367 290a 0a20 2020  append(msg)..   
+00004e70: 2020 2020 2064 6566 2065 7272 286d 7367       def err(msg
+00004e80: 3a20 7374 722c 202a 2a6b 7761 7267 733a  : str, **kwargs:
+00004e90: 2041 6e79 2920 2d3e 204e 6f6e 653a 0a20   Any) -> None:. 
+00004ea0: 2020 2020 2020 2020 2020 2065 7272 5f6c             err_l
+00004eb0: 696e 6573 2e61 7070 656e 6428 6d73 6729  ines.append(msg)
+00004ec0: 0a0a 2020 2020 2020 2020 7769 7468 2070  ..        with p
+00004ed0: 6174 6368 2822 626c 6163 6b2e 6f75 7470  atch("black.outp
+00004ee0: 7574 2e5f 6f75 7422 2c20 6f75 7429 2c20  ut._out", out), 
+00004ef0: 7061 7463 6828 2262 6c61 636b 2e6f 7574  patch("black.out
+00004f00: 7075 742e 5f65 7272 222c 2065 7272 293a  put._err", err):
+00004f10: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+00004f20: 6f72 742e 646f 6e65 2850 6174 6828 2266  ort.done(Path("f
+00004f30: 3122 292c 2062 6c61 636b 2e43 6861 6e67  1"), black.Chang
+00004f40: 6564 2e4e 4f29 0a20 2020 2020 2020 2020  ed.NO).         
+00004f50: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00004f60: 7561 6c28 6c65 6e28 6f75 745f 6c69 6e65  ual(len(out_line
+00004f70: 7329 2c20 3129 0a20 2020 2020 2020 2020  s), 1).         
+00004f80: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00004f90: 7561 6c28 6c65 6e28 6572 725f 6c69 6e65  ual(len(err_line
+00004fa0: 7329 2c20 3029 0a20 2020 2020 2020 2020  s), 0).         
+00004fb0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00004fc0: 7561 6c28 6f75 745f 6c69 6e65 735b 2d31  ual(out_lines[-1
+00004fd0: 5d2c 2022 6631 2061 6c72 6561 6479 2077  ], "f1 already w
+00004fe0: 656c 6c20 666f 726d 6174 7465 642c 2067  ell formatted, g
+00004ff0: 6f6f 6420 6a6f 622e 2229 0a20 2020 2020  ood job.").     
+00005000: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00005010: 7274 4571 7561 6c28 756e 7374 796c 6528  rtEqual(unstyle(
+00005020: 7374 7228 7265 706f 7274 2929 2c20 2231  str(report)), "1
+00005030: 2066 696c 6520 6c65 6674 2075 6e63 6861   file left uncha
+00005040: 6e67 6564 2e22 290a 2020 2020 2020 2020  nged.").        
+00005050: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005060: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
+00005070: 726e 5f63 6f64 652c 2030 290a 2020 2020  rn_code, 0).    
+00005080: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
+00005090: 6f6e 6528 5061 7468 2822 6632 2229 2c20  one(Path("f2"), 
+000050a0: 626c 6163 6b2e 4368 616e 6765 642e 5945  black.Changed.YE
+000050b0: 5329 0a20 2020 2020 2020 2020 2020 2073  S).            s
+000050c0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000050d0: 6c65 6e28 6f75 745f 6c69 6e65 7329 2c20  len(out_lines), 
+000050e0: 3229 0a20 2020 2020 2020 2020 2020 2073  2).            s
+000050f0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00005100: 6c65 6e28 6572 725f 6c69 6e65 7329 2c20  len(err_lines), 
+00005110: 3029 0a20 2020 2020 2020 2020 2020 2073  0).            s
+00005120: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00005130: 6f75 745f 6c69 6e65 735b 2d31 5d2c 2022  out_lines[-1], "
+00005140: 7265 666f 726d 6174 7465 6420 6632 2229  reformatted f2")
+00005150: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005160: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+00005170: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00005180: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
+00005190: 7429 292c 2022 3120 6669 6c65 2072 6566  t)), "1 file ref
+000051a0: 6f72 6d61 7474 6564 2c20 3120 6669 6c65  ormatted, 1 file
+000051b0: 206c 6566 7420 756e 6368 616e 6765 642e   left unchanged.
+000051c0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+000051d0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+000051e0: 7274 2e64 6f6e 6528 5061 7468 2822 6633  rt.done(Path("f3
+000051f0: 2229 2c20 626c 6163 6b2e 4368 616e 6765  "), black.Change
+00005200: 642e 4341 4348 4544 290a 2020 2020 2020  d.CACHED).      
+00005210: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00005220: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
+00005230: 696e 6573 292c 2033 290a 2020 2020 2020  ines), 3).      
+00005240: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00005250: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
+00005260: 696e 6573 292c 2030 290a 2020 2020 2020  ines), 0).      
+00005270: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00005280: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
+00005290: 2020 2020 2020 2020 6f75 745f 6c69 6e65          out_line
+000052a0: 735b 2d31 5d2c 2022 6633 2077 6173 6e27  s[-1], "f3 wasn'
+000052b0: 7420 6d6f 6469 6669 6564 206f 6e20 6469  t modified on di
+000052c0: 736b 2073 696e 6365 206c 6173 7420 7275  sk since last ru
+000052d0: 6e2e 220a 2020 2020 2020 2020 2020 2020  n.".            
+000052e0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000052f0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
+00005300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005310: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
+00005320: 7274 2929 2c20 2231 2066 696c 6520 7265  rt)), "1 file re
+00005330: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
+00005340: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
+00005350: 642e 220a 2020 2020 2020 2020 2020 2020  d.".            
+00005360: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00005370: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+00005380: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
+00005390: 652c 2030 290a 2020 2020 2020 2020 2020  e, 0).          
+000053a0: 2020 7265 706f 7274 2e63 6865 636b 203d    report.check =
+000053b0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+000053c0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000053d0: 616c 2872 6570 6f72 742e 7265 7475 726e  al(report.return
+000053e0: 5f63 6f64 652c 2031 290a 2020 2020 2020  _code, 1).      
+000053f0: 2020 2020 2020 7265 706f 7274 2e63 6865        report.che
+00005400: 636b 203d 2046 616c 7365 0a20 2020 2020  ck = False.     
+00005410: 2020 2020 2020 2072 6570 6f72 742e 6661         report.fa
+00005420: 696c 6564 2850 6174 6828 2265 3122 292c  iled(Path("e1"),
+00005430: 2022 626f 6f6d 2229 0a20 2020 2020 2020   "boom").       
+00005440: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00005450: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
+00005460: 6e65 7329 2c20 3329 0a20 2020 2020 2020  nes), 3).       
+00005470: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00005480: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
+00005490: 6e65 7329 2c20 3129 0a20 2020 2020 2020  nes), 1).       
+000054a0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000054b0: 4571 7561 6c28 6572 725f 6c69 6e65 735b  Equal(err_lines[
+000054c0: 2d31 5d2c 2022 6572 726f 723a 2063 616e  -1], "error: can
+000054d0: 6e6f 7420 666f 726d 6174 2065 313a 2062  not format e1: b
+000054e0: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
+000054f0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00005500: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+00005510: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
+00005520: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
+00005530: 2020 2020 2020 2020 2020 2231 2066 696c            "1 fil
+00005540: 6520 7265 666f 726d 6174 7465 642c 2032  e reformatted, 2
+00005550: 2066 696c 6573 206c 6566 7420 756e 6368   files left unch
+00005560: 616e 6765 642c 2031 2066 696c 6520 6661  anged, 1 file fa
+00005570: 696c 6564 2074 6f22 0a20 2020 2020 2020  iled to".       
+00005580: 2020 2020 2020 2020 2022 2072 6566 6f72           " refor
+00005590: 6d61 742e 222c 0a20 2020 2020 2020 2020  mat.",.         
+000055a0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000055b0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000055c0: 6c28 7265 706f 7274 2e72 6574 7572 6e5f  l(report.return_
+000055d0: 636f 6465 2c20 3132 3329 0a20 2020 2020  code, 123).     
+000055e0: 2020 2020 2020 2072 6570 6f72 742e 646f         report.do
+000055f0: 6e65 2850 6174 6828 2266 3322 292c 2062  ne(Path("f3"), b
+00005600: 6c61 636b 2e43 6861 6e67 6564 2e59 4553  lack.Changed.YES
+00005610: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00005620: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00005630: 656e 286f 7574 5f6c 696e 6573 292c 2034  en(out_lines), 4
+00005640: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00005650: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00005660: 656e 2865 7272 5f6c 696e 6573 292c 2031  en(err_lines), 1
+00005670: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00005680: 6c66 2e61 7373 6572 7445 7175 616c 286f  lf.assertEqual(o
+00005690: 7574 5f6c 696e 6573 5b2d 315d 2c20 2272  ut_lines[-1], "r
+000056a0: 6566 6f72 6d61 7474 6564 2066 3322 290a  eformatted f3").
+000056b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000056c0: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+000056d0: 2020 2020 2020 2020 2020 2020 2020 756e                un
+000056e0: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
+000056f0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+00005700: 2020 2020 2232 2066 696c 6573 2072 6566      "2 files ref
+00005710: 6f72 6d61 7474 6564 2c20 3220 6669 6c65  ormatted, 2 file
+00005720: 7320 6c65 6674 2075 6e63 6861 6e67 6564  s left unchanged
+00005730: 2c20 3120 6669 6c65 2066 6169 6c65 6420  , 1 file failed 
+00005740: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
+00005750: 2020 2020 2220 7265 666f 726d 6174 2e22      " reformat."
+00005760: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00005770: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005780: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
+00005790: 6f72 742e 7265 7475 726e 5f63 6f64 652c  ort.return_code,
+000057a0: 2031 3233 290a 2020 2020 2020 2020 2020   123).          
+000057b0: 2020 7265 706f 7274 2e66 6169 6c65 6428    report.failed(
+000057c0: 5061 7468 2822 6532 2229 2c20 2262 6f6f  Path("e2"), "boo
+000057d0: 6d22 290a 2020 2020 2020 2020 2020 2020  m").            
+000057e0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000057f0: 286c 656e 286f 7574 5f6c 696e 6573 292c  (len(out_lines),
+00005800: 2034 290a 2020 2020 2020 2020 2020 2020   4).            
+00005810: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00005820: 286c 656e 2865 7272 5f6c 696e 6573 292c  (len(err_lines),
+00005830: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
+00005840: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00005850: 2865 7272 5f6c 696e 6573 5b2d 315d 2c20  (err_lines[-1], 
+00005860: 2265 7272 6f72 3a20 6361 6e6e 6f74 2066  "error: cannot f
+00005870: 6f72 6d61 7420 6532 3a20 626f 6f6d 2229  ormat e2: boom")
+00005880: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005890: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+000058a0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+000058b0: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
+000058c0: 7429 292c 0a20 2020 2020 2020 2020 2020  t)),.           
+000058d0: 2020 2020 2022 3220 6669 6c65 7320 7265       "2 files re
+000058e0: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
+000058f0: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
+00005900: 642c 2032 2066 696c 6573 2066 6169 6c65  d, 2 files faile
+00005910: 6420 746f 220a 2020 2020 2020 2020 2020  d to".          
+00005920: 2020 2020 2020 2220 7265 666f 726d 6174        " reformat
+00005930: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
+00005940: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00005950: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+00005960: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
+00005970: 652c 2031 3233 290a 2020 2020 2020 2020  e, 123).        
+00005980: 2020 2020 7265 706f 7274 2e70 6174 685f      report.path_
+00005990: 6967 6e6f 7265 6428 5061 7468 2822 7761  ignored(Path("wa
+000059a0: 7422 292c 2022 6e6f 206d 6174 6368 2229  t"), "no match")
+000059b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000059c0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+000059d0: 6e28 6f75 745f 6c69 6e65 7329 2c20 3529  n(out_lines), 5)
+000059e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000059f0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+00005a00: 6e28 6572 725f 6c69 6e65 7329 2c20 3229  n(err_lines), 2)
+00005a10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005a20: 662e 6173 7365 7274 4571 7561 6c28 6f75  f.assertEqual(ou
+00005a30: 745f 6c69 6e65 735b 2d31 5d2c 2022 7761  t_lines[-1], "wa
+00005a40: 7420 6967 6e6f 7265 643a 206e 6f20 6d61  t ignored: no ma
+00005a50: 7463 6822 290a 2020 2020 2020 2020 2020  tch").          
+00005a60: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00005a70: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+00005a80: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
+00005a90: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
+00005aa0: 2020 2020 2020 2020 2020 2232 2066 696c            "2 fil
+00005ab0: 6573 2072 6566 6f72 6d61 7474 6564 2c20  es reformatted, 
+00005ac0: 3220 6669 6c65 7320 6c65 6674 2075 6e63  2 files left unc
+00005ad0: 6861 6e67 6564 2c20 3220 6669 6c65 7320  hanged, 2 files 
+00005ae0: 6661 696c 6564 2074 6f22 0a20 2020 2020  failed to".     
+00005af0: 2020 2020 2020 2020 2020 2022 2072 6566             " ref
+00005b00: 6f72 6d61 742e 222c 0a20 2020 2020 2020  ormat.",.       
+00005b10: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00005b20: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00005b30: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
+00005b40: 6e5f 636f 6465 2c20 3132 3329 0a20 2020  n_code, 123).   
+00005b50: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
+00005b60: 646f 6e65 2850 6174 6828 2266 3422 292c  done(Path("f4"),
+00005b70: 2062 6c61 636b 2e43 6861 6e67 6564 2e4e   black.Changed.N
+00005b80: 4f29 0a20 2020 2020 2020 2020 2020 2073  O).            s
+00005b90: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00005ba0: 6c65 6e28 6f75 745f 6c69 6e65 7329 2c20  len(out_lines), 
+00005bb0: 3629 0a20 2020 2020 2020 2020 2020 2073  6).            s
+00005bc0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00005bd0: 6c65 6e28 6572 725f 6c69 6e65 7329 2c20  len(err_lines), 
+00005be0: 3229 0a20 2020 2020 2020 2020 2020 2073  2).            s
+00005bf0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00005c00: 6f75 745f 6c69 6e65 735b 2d31 5d2c 2022  out_lines[-1], "
+00005c10: 6634 2061 6c72 6561 6479 2077 656c 6c20  f4 already well 
+00005c20: 666f 726d 6174 7465 642c 2067 6f6f 6420  formatted, good 
+00005c30: 6a6f 622e 2229 0a20 2020 2020 2020 2020  job.").         
+00005c40: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00005c50: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+00005c60: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
+00005c70: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
+00005c80: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
+00005c90: 6c65 7320 7265 666f 726d 6174 7465 642c  les reformatted,
+00005ca0: 2033 2066 696c 6573 206c 6566 7420 756e   3 files left un
+00005cb0: 6368 616e 6765 642c 2032 2066 696c 6573  changed, 2 files
+00005cc0: 2066 6169 6c65 6420 746f 220a 2020 2020   failed to".    
+00005cd0: 2020 2020 2020 2020 2020 2020 2220 7265              " re
+00005ce0: 666f 726d 6174 2e22 2c0a 2020 2020 2020  format.",.      
+00005cf0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00005d00: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005d10: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
+00005d20: 726e 5f63 6f64 652c 2031 3233 290a 2020  rn_code, 123).  
+00005d30: 2020 2020 2020 2020 2020 7265 706f 7274            report
+00005d40: 2e63 6865 636b 203d 2054 7275 650a 2020  .check = True.  
+00005d50: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00005d60: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00005d70: 2020 2020 2020 2020 2020 2020 756e 7374              unst
+00005d80: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
+00005d90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00005da0: 2020 2232 2066 696c 6573 2077 6f75 6c64    "2 files would
+00005db0: 2062 6520 7265 666f 726d 6174 7465 642c   be reformatted,
+00005dc0: 2033 2066 696c 6573 2077 6f75 6c64 2062   3 files would b
+00005dd0: 6520 6c65 6674 2075 6e63 6861 6e67 6564  e left unchanged
+00005de0: 2c20 3222 0a20 2020 2020 2020 2020 2020  , 2".           
+00005df0: 2020 2020 2022 2066 696c 6573 2077 6f75       " files wou
+00005e00: 6c64 2066 6169 6c20 746f 2072 6566 6f72  ld fail to refor
+00005e10: 6d61 742e 222c 0a20 2020 2020 2020 2020  mat.",.         
+00005e20: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00005e30: 2072 6570 6f72 742e 6368 6563 6b20 3d20   report.check = 
+00005e40: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00005e50: 2020 7265 706f 7274 2e64 6966 6620 3d20    report.diff = 
+00005e60: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00005e70: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00005e80: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+00005e90: 2020 2075 6e73 7479 6c65 2873 7472 2872     unstyle(str(r
+00005ea0: 6570 6f72 7429 292c 0a20 2020 2020 2020  eport)),.       
+00005eb0: 2020 2020 2020 2020 2022 3220 6669 6c65           "2 file
+00005ec0: 7320 776f 756c 6420 6265 2072 6566 6f72  s would be refor
+00005ed0: 6d61 7474 6564 2c20 3320 6669 6c65 7320  matted, 3 files 
+00005ee0: 776f 756c 6420 6265 206c 6566 7420 756e  would be left un
+00005ef0: 6368 616e 6765 642c 2032 220a 2020 2020  changed, 2".    
+00005f00: 2020 2020 2020 2020 2020 2020 2220 6669              " fi
+00005f10: 6c65 7320 776f 756c 6420 6661 696c 2074  les would fail t
+00005f20: 6f20 7265 666f 726d 6174 2e22 2c0a 2020  o reformat.",.  
+00005f30: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00005f40: 2064 6566 2074 6573 745f 7265 706f 7274   def test_report
+00005f50: 5f71 7569 6574 2873 656c 6629 202d 3e20  _quiet(self) -> 
+00005f60: 4e6f 6e65 3a0a 2020 2020 2020 2020 7265  None:.        re
+00005f70: 706f 7274 203d 2052 6570 6f72 7428 7175  port = Report(qu
+00005f80: 6965 743d 5472 7565 290a 2020 2020 2020  iet=True).      
+00005f90: 2020 6f75 745f 6c69 6e65 7320 3d20 5b5d    out_lines = []
+00005fa0: 0a20 2020 2020 2020 2065 7272 5f6c 696e  .        err_lin
+00005fb0: 6573 203d 205b 5d0a 0a20 2020 2020 2020  es = []..       
+00005fc0: 2064 6566 206f 7574 286d 7367 3a20 7374   def out(msg: st
+00005fd0: 722c 202a 2a6b 7761 7267 733a 2041 6e79  r, **kwargs: Any
+00005fe0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00005ff0: 2020 2020 2020 206f 7574 5f6c 696e 6573         out_lines
+00006000: 2e61 7070 656e 6428 6d73 6729 0a0a 2020  .append(msg)..  
+00006010: 2020 2020 2020 6465 6620 6572 7228 6d73        def err(ms
+00006020: 673a 2073 7472 2c20 2a2a 6b77 6172 6773  g: str, **kwargs
+00006030: 3a20 416e 7929 202d 3e20 4e6f 6e65 3a0a  : Any) -> None:.
+00006040: 2020 2020 2020 2020 2020 2020 6572 725f              err_
+00006050: 6c69 6e65 732e 6170 7065 6e64 286d 7367  lines.append(msg
+00006060: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
+00006070: 7061 7463 6828 2262 6c61 636b 2e6f 7574  patch("black.out
+00006080: 7075 742e 5f6f 7574 222c 206f 7574 292c  put._out", out),
+00006090: 2070 6174 6368 2822 626c 6163 6b2e 6f75   patch("black.ou
+000060a0: 7470 7574 2e5f 6572 7222 2c20 6572 7229  tput._err", err)
+000060b0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000060c0: 706f 7274 2e64 6f6e 6528 5061 7468 2822  port.done(Path("
+000060d0: 6631 2229 2c20 626c 6163 6b2e 4368 616e  f1"), black.Chan
+000060e0: 6765 642e 4e4f 290a 2020 2020 2020 2020  ged.NO).        
+000060f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00006100: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
+00006110: 6573 292c 2030 290a 2020 2020 2020 2020  es), 0).        
+00006120: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00006130: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
+00006140: 6573 292c 2030 290a 2020 2020 2020 2020  es), 0).        
+00006150: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00006160: 7175 616c 2875 6e73 7479 6c65 2873 7472  qual(unstyle(str
+00006170: 2872 6570 6f72 7429 292c 2022 3120 6669  (report)), "1 fi
+00006180: 6c65 206c 6566 7420 756e 6368 616e 6765  le left unchange
+00006190: 642e 2229 0a20 2020 2020 2020 2020 2020  d.").           
+000061a0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000061b0: 6c28 7265 706f 7274 2e72 6574 7572 6e5f  l(report.return_
+000061c0: 636f 6465 2c20 3029 0a20 2020 2020 2020  code, 0).       
+000061d0: 2020 2020 2072 6570 6f72 742e 646f 6e65       report.done
+000061e0: 2850 6174 6828 2266 3222 292c 2062 6c61  (Path("f2"), bla
+000061f0: 636b 2e43 6861 6e67 6564 2e59 4553 290a  ck.Changed.YES).
+00006200: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006210: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+00006220: 286f 7574 5f6c 696e 6573 292c 2030 290a  (out_lines), 0).
+00006230: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006240: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+00006250: 2865 7272 5f6c 696e 6573 292c 2030 290a  (err_lines), 0).
+00006260: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006270: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+00006280: 2020 2020 2020 2020 2020 2020 2020 756e                un
+00006290: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
+000062a0: 2929 2c20 2231 2066 696c 6520 7265 666f  )), "1 file refo
+000062b0: 726d 6174 7465 642c 2031 2066 696c 6520  rmatted, 1 file 
+000062c0: 6c65 6674 2075 6e63 6861 6e67 6564 2e22  left unchanged."
+000062d0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000062e0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
+000062f0: 742e 646f 6e65 2850 6174 6828 2266 3322  t.done(Path("f3"
+00006300: 292c 2062 6c61 636b 2e43 6861 6e67 6564  ), black.Changed
+00006310: 2e43 4143 4845 4429 0a20 2020 2020 2020  .CACHED).       
+00006320: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006330: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
+00006340: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
+00006350: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006360: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
+00006370: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
+00006380: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006390: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
+000063a0: 2020 2020 2020 2075 6e73 7479 6c65 2873         unstyle(s
+000063b0: 7472 2872 6570 6f72 7429 292c 2022 3120  tr(report)), "1 
+000063c0: 6669 6c65 2072 6566 6f72 6d61 7474 6564  file reformatted
+000063d0: 2c20 3220 6669 6c65 7320 6c65 6674 2075  , 2 files left u
+000063e0: 6e63 6861 6e67 6564 2e22 0a20 2020 2020  nchanged.".     
+000063f0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00006400: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006410: 4571 7561 6c28 7265 706f 7274 2e72 6574  Equal(report.ret
+00006420: 7572 6e5f 636f 6465 2c20 3029 0a20 2020  urn_code, 0).   
+00006430: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
+00006440: 6368 6563 6b20 3d20 5472 7565 0a20 2020  check = True.   
+00006450: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00006460: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
+00006470: 2e72 6574 7572 6e5f 636f 6465 2c20 3129  .return_code, 1)
+00006480: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+00006490: 6f72 742e 6368 6563 6b20 3d20 4661 6c73  ort.check = Fals
+000064a0: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
+000064b0: 706f 7274 2e66 6169 6c65 6428 5061 7468  port.failed(Path
+000064c0: 2822 6531 2229 2c20 2262 6f6f 6d22 290a  ("e1"), "boom").
+000064d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000064e0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+000064f0: 286f 7574 5f6c 696e 6573 292c 2030 290a  (out_lines), 0).
+00006500: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006510: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+00006520: 2865 7272 5f6c 696e 6573 292c 2031 290a  (err_lines), 1).
+00006530: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006540: 2e61 7373 6572 7445 7175 616c 2865 7272  .assertEqual(err
+00006550: 5f6c 696e 6573 5b2d 315d 2c20 2265 7272  _lines[-1], "err
+00006560: 6f72 3a20 6361 6e6e 6f74 2066 6f72 6d61  or: cannot forma
+00006570: 7420 6531 3a20 626f 6f6d 2229 0a20 2020  t e1: boom").   
+00006580: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00006590: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
+000065a0: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
+000065b0: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
+000065c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000065d0: 2022 3120 6669 6c65 2072 6566 6f72 6d61   "1 file reforma
+000065e0: 7474 6564 2c20 3220 6669 6c65 7320 6c65  tted, 2 files le
+000065f0: 6674 2075 6e63 6861 6e67 6564 2c20 3120  ft unchanged, 1 
+00006600: 6669 6c65 2066 6169 6c65 6420 746f 220a  file failed to".
+00006610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006620: 2220 7265 666f 726d 6174 2e22 2c0a 2020  " reformat.",.  
+00006630: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00006640: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00006650: 6572 7445 7175 616c 2872 6570 6f72 742e  ertEqual(report.
+00006660: 7265 7475 726e 5f63 6f64 652c 2031 3233  return_code, 123
+00006670: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00006680: 706f 7274 2e64 6f6e 6528 5061 7468 2822  port.done(Path("
+00006690: 6633 2229 2c20 626c 6163 6b2e 4368 616e  f3"), black.Chan
+000066a0: 6765 642e 5945 5329 0a20 2020 2020 2020  ged.YES).       
+000066b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000066c0: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
+000066d0: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
+000066e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000066f0: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
+00006700: 6e65 7329 2c20 3129 0a20 2020 2020 2020  nes), 1).       
+00006710: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006720: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
+00006730: 2020 2020 2020 2075 6e73 7479 6c65 2873         unstyle(s
+00006740: 7472 2872 6570 6f72 7429 292c 0a20 2020  tr(report)),.   
+00006750: 2020 2020 2020 2020 2020 2020 2022 3220               "2 
+00006760: 6669 6c65 7320 7265 666f 726d 6174 7465  files reformatte
+00006770: 642c 2032 2066 696c 6573 206c 6566 7420  d, 2 files left 
+00006780: 756e 6368 616e 6765 642c 2031 2066 696c  unchanged, 1 fil
+00006790: 6520 6661 696c 6564 2074 6f22 0a20 2020  e failed to".   
+000067a0: 2020 2020 2020 2020 2020 2020 2022 2072               " r
+000067b0: 6566 6f72 6d61 742e 222c 0a20 2020 2020  eformat.",.     
+000067c0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000067d0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000067e0: 4571 7561 6c28 7265 706f 7274 2e72 6574  Equal(report.ret
+000067f0: 7572 6e5f 636f 6465 2c20 3132 3329 0a20  urn_code, 123). 
+00006800: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
+00006810: 742e 6661 696c 6564 2850 6174 6828 2265  t.failed(Path("e
+00006820: 3222 292c 2022 626f 6f6d 2229 0a20 2020  2"), "boom").   
+00006830: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00006840: 7365 7274 4571 7561 6c28 6c65 6e28 6f75  sertEqual(len(ou
+00006850: 745f 6c69 6e65 7329 2c20 3029 0a20 2020  t_lines), 0).   
+00006860: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00006870: 7365 7274 4571 7561 6c28 6c65 6e28 6572  sertEqual(len(er
+00006880: 725f 6c69 6e65 7329 2c20 3229 0a20 2020  r_lines), 2).   
+00006890: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+000068a0: 7365 7274 4571 7561 6c28 6572 725f 6c69  sertEqual(err_li
+000068b0: 6e65 735b 2d31 5d2c 2022 6572 726f 723a  nes[-1], "error:
+000068c0: 2063 616e 6e6f 7420 666f 726d 6174 2065   cannot format e
+000068d0: 323a 2062 6f6f 6d22 290a 2020 2020 2020  2: boom").      
+000068e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000068f0: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
+00006900: 2020 2020 2020 2020 756e 7374 796c 6528          unstyle(
+00006910: 7374 7228 7265 706f 7274 2929 2c0a 2020  str(report)),.  
+00006920: 2020 2020 2020 2020 2020 2020 2020 2232                "2
+00006930: 2066 696c 6573 2072 6566 6f72 6d61 7474   files reformatt
+00006940: 6564 2c20 3220 6669 6c65 7320 6c65 6674  ed, 2 files left
+00006950: 2075 6e63 6861 6e67 6564 2c20 3220 6669   unchanged, 2 fi
+00006960: 6c65 7320 6661 696c 6564 2074 6f22 0a20  les failed to". 
+00006970: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00006980: 2072 6566 6f72 6d61 742e 222c 0a20 2020   reformat.",.   
+00006990: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000069a0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000069b0: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
+000069c0: 6574 7572 6e5f 636f 6465 2c20 3132 3329  eturn_code, 123)
+000069d0: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+000069e0: 6f72 742e 7061 7468 5f69 676e 6f72 6564  ort.path_ignored
+000069f0: 2850 6174 6828 2277 6174 2229 2c20 226e  (Path("wat"), "n
+00006a00: 6f20 6d61 7463 6822 290a 2020 2020 2020  o match").      
+00006a10: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00006a20: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
+00006a30: 696e 6573 292c 2030 290a 2020 2020 2020  ines), 0).      
+00006a40: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00006a50: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
+00006a60: 696e 6573 292c 2032 290a 2020 2020 2020  ines), 2).      
+00006a70: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00006a80: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
+00006a90: 2020 2020 2020 2020 756e 7374 796c 6528          unstyle(
+00006aa0: 7374 7228 7265 706f 7274 2929 2c0a 2020  str(report)),.  
+00006ab0: 2020 2020 2020 2020 2020 2020 2020 2232                "2
+00006ac0: 2066 696c 6573 2072 6566 6f72 6d61 7474   files reformatt
+00006ad0: 6564 2c20 3220 6669 6c65 7320 6c65 6674  ed, 2 files left
+00006ae0: 2075 6e63 6861 6e67 6564 2c20 3220 6669   unchanged, 2 fi
+00006af0: 6c65 7320 6661 696c 6564 2074 6f22 0a20  les failed to". 
+00006b00: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00006b10: 2072 6566 6f72 6d61 742e 222c 0a20 2020   reformat.",.   
+00006b20: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00006b30: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00006b40: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
+00006b50: 6574 7572 6e5f 636f 6465 2c20 3132 3329  eturn_code, 123)
+00006b60: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+00006b70: 6f72 742e 646f 6e65 2850 6174 6828 2266  ort.done(Path("f
+00006b80: 3422 292c 2062 6c61 636b 2e43 6861 6e67  4"), black.Chang
+00006b90: 6564 2e4e 4f29 0a20 2020 2020 2020 2020  ed.NO).         
+00006ba0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00006bb0: 7561 6c28 6c65 6e28 6f75 745f 6c69 6e65  ual(len(out_line
+00006bc0: 7329 2c20 3029 0a20 2020 2020 2020 2020  s), 0).         
+00006bd0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00006be0: 7561 6c28 6c65 6e28 6572 725f 6c69 6e65  ual(len(err_line
+00006bf0: 7329 2c20 3229 0a20 2020 2020 2020 2020  s), 2).         
+00006c00: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00006c10: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+00006c20: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
+00006c30: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
+00006c40: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
+00006c50: 6c65 7320 7265 666f 726d 6174 7465 642c  les reformatted,
+00006c60: 2033 2066 696c 6573 206c 6566 7420 756e   3 files left un
+00006c70: 6368 616e 6765 642c 2032 2066 696c 6573  changed, 2 files
+00006c80: 2066 6169 6c65 6420 746f 220a 2020 2020   failed to".    
+00006c90: 2020 2020 2020 2020 2020 2020 2220 7265              " re
+00006ca0: 666f 726d 6174 2e22 2c0a 2020 2020 2020  format.",.      
+00006cb0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00006cc0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00006cd0: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
+00006ce0: 726e 5f63 6f64 652c 2031 3233 290a 2020  rn_code, 123).  
+00006cf0: 2020 2020 2020 2020 2020 7265 706f 7274            report
+00006d00: 2e63 6865 636b 203d 2054 7275 650a 2020  .check = True.  
+00006d10: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006d20: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00006d30: 2020 2020 2020 2020 2020 2020 756e 7374              unst
+00006d40: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
+00006d50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006d60: 2020 2232 2066 696c 6573 2077 6f75 6c64    "2 files would
+00006d70: 2062 6520 7265 666f 726d 6174 7465 642c   be reformatted,
+00006d80: 2033 2066 696c 6573 2077 6f75 6c64 2062   3 files would b
+00006d90: 6520 6c65 6674 2075 6e63 6861 6e67 6564  e left unchanged
+00006da0: 2c20 3222 0a20 2020 2020 2020 2020 2020  , 2".           
+00006db0: 2020 2020 2022 2066 696c 6573 2077 6f75       " files wou
+00006dc0: 6c64 2066 6169 6c20 746f 2072 6566 6f72  ld fail to refor
+00006dd0: 6d61 742e 222c 0a20 2020 2020 2020 2020  mat.",.         
+00006de0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00006df0: 2072 6570 6f72 742e 6368 6563 6b20 3d20   report.check = 
+00006e00: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00006e10: 2020 7265 706f 7274 2e64 6966 6620 3d20    report.diff = 
+00006e20: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00006e30: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00006e40: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+00006e50: 2020 2075 6e73 7479 6c65 2873 7472 2872     unstyle(str(r
+00006e60: 6570 6f72 7429 292c 0a20 2020 2020 2020  eport)),.       
+00006e70: 2020 2020 2020 2020 2022 3220 6669 6c65           "2 file
+00006e80: 7320 776f 756c 6420 6265 2072 6566 6f72  s would be refor
+00006e90: 6d61 7474 6564 2c20 3320 6669 6c65 7320  matted, 3 files 
+00006ea0: 776f 756c 6420 6265 206c 6566 7420 756e  would be left un
+00006eb0: 6368 616e 6765 642c 2032 220a 2020 2020  changed, 2".    
+00006ec0: 2020 2020 2020 2020 2020 2020 2220 6669              " fi
+00006ed0: 6c65 7320 776f 756c 6420 6661 696c 2074  les would fail t
+00006ee0: 6f20 7265 666f 726d 6174 2e22 2c0a 2020  o reformat.",.  
+00006ef0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00006f00: 2064 6566 2074 6573 745f 7265 706f 7274   def test_report
+00006f10: 5f6e 6f72 6d61 6c28 7365 6c66 2920 2d3e  _normal(self) ->
+00006f20: 204e 6f6e 653a 0a20 2020 2020 2020 2072   None:.        r
+00006f30: 6570 6f72 7420 3d20 626c 6163 6b2e 5265  eport = black.Re
+00006f40: 706f 7274 2829 0a20 2020 2020 2020 206f  port().        o
+00006f50: 7574 5f6c 696e 6573 203d 205b 5d0a 2020  ut_lines = [].  
+00006f60: 2020 2020 2020 6572 725f 6c69 6e65 7320        err_lines 
+00006f70: 3d20 5b5d 0a0a 2020 2020 2020 2020 6465  = []..        de
+00006f80: 6620 6f75 7428 6d73 673a 2073 7472 2c20  f out(msg: str, 
+00006f90: 2a2a 6b77 6172 6773 3a20 416e 7929 202d  **kwargs: Any) -
+00006fa0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00006fb0: 2020 2020 6f75 745f 6c69 6e65 732e 6170      out_lines.ap
+00006fc0: 7065 6e64 286d 7367 290a 0a20 2020 2020  pend(msg)..     
+00006fd0: 2020 2064 6566 2065 7272 286d 7367 3a20     def err(msg: 
+00006fe0: 7374 722c 202a 2a6b 7761 7267 733a 2041  str, **kwargs: A
+00006ff0: 6e79 2920 2d3e 204e 6f6e 653a 0a20 2020  ny) -> None:.   
+00007000: 2020 2020 2020 2020 2065 7272 5f6c 696e           err_lin
+00007010: 6573 2e61 7070 656e 6428 6d73 6729 0a0a  es.append(msg)..
+00007020: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
+00007030: 6368 2822 626c 6163 6b2e 6f75 7470 7574  ch("black.output
+00007040: 2e5f 6f75 7422 2c20 6f75 7429 2c20 7061  ._out", out), pa
+00007050: 7463 6828 2262 6c61 636b 2e6f 7574 7075  tch("black.outpu
+00007060: 742e 5f65 7272 222c 2065 7272 293a 0a20  t._err", err):. 
+00007070: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
+00007080: 742e 646f 6e65 2850 6174 6828 2266 3122  t.done(Path("f1"
+00007090: 292c 2062 6c61 636b 2e43 6861 6e67 6564  ), black.Changed
+000070a0: 2e4e 4f29 0a20 2020 2020 2020 2020 2020  .NO).           
+000070b0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000070c0: 6c28 6c65 6e28 6f75 745f 6c69 6e65 7329  l(len(out_lines)
+000070d0: 2c20 3029 0a20 2020 2020 2020 2020 2020  , 0).           
+000070e0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000070f0: 6c28 6c65 6e28 6572 725f 6c69 6e65 7329  l(len(err_lines)
+00007100: 2c20 3029 0a20 2020 2020 2020 2020 2020  , 0).           
+00007110: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00007120: 6c28 756e 7374 796c 6528 7374 7228 7265  l(unstyle(str(re
+00007130: 706f 7274 2929 2c20 2231 2066 696c 6520  port)), "1 file 
+00007140: 6c65 6674 2075 6e63 6861 6e67 6564 2e22  left unchanged."
+00007150: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00007160: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+00007170: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
+00007180: 652c 2030 290a 2020 2020 2020 2020 2020  e, 0).          
+00007190: 2020 7265 706f 7274 2e64 6f6e 6528 5061    report.done(Pa
+000071a0: 7468 2822 6632 2229 2c20 626c 6163 6b2e  th("f2"), black.
+000071b0: 4368 616e 6765 642e 5945 5329 0a20 2020  Changed.YES).   
+000071c0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+000071d0: 7365 7274 4571 7561 6c28 6c65 6e28 6f75  sertEqual(len(ou
+000071e0: 745f 6c69 6e65 7329 2c20 3129 0a20 2020  t_lines), 1).   
+000071f0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00007200: 7365 7274 4571 7561 6c28 6c65 6e28 6572  sertEqual(len(er
+00007210: 725f 6c69 6e65 7329 2c20 3029 0a20 2020  r_lines), 0).   
+00007220: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00007230: 7365 7274 4571 7561 6c28 6f75 745f 6c69  sertEqual(out_li
+00007240: 6e65 735b 2d31 5d2c 2022 7265 666f 726d  nes[-1], "reform
+00007250: 6174 7465 6420 6632 2229 0a20 2020 2020  atted f2").     
+00007260: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00007270: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+00007280: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
+00007290: 2873 7472 2872 6570 6f72 7429 292c 2022  (str(report)), "
+000072a0: 3120 6669 6c65 2072 6566 6f72 6d61 7474  1 file reformatt
+000072b0: 6564 2c20 3120 6669 6c65 206c 6566 7420  ed, 1 file left 
+000072c0: 756e 6368 616e 6765 642e 220a 2020 2020  unchanged.".    
+000072d0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000072e0: 2020 2020 2020 7265 706f 7274 2e64 6f6e        report.don
+000072f0: 6528 5061 7468 2822 6633 2229 2c20 626c  e(Path("f3"), bl
+00007300: 6163 6b2e 4368 616e 6765 642e 4341 4348  ack.Changed.CACH
+00007310: 4544 290a 2020 2020 2020 2020 2020 2020  ED).            
+00007320: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00007330: 286c 656e 286f 7574 5f6c 696e 6573 292c  (len(out_lines),
+00007340: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
+00007350: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00007360: 286c 656e 2865 7272 5f6c 696e 6573 292c  (len(err_lines),
+00007370: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
+00007380: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00007390: 286f 7574 5f6c 696e 6573 5b2d 315d 2c20  (out_lines[-1], 
+000073a0: 2272 6566 6f72 6d61 7474 6564 2066 3222  "reformatted f2"
+000073b0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000073c0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
+000073d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000073e0: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
+000073f0: 7274 2929 2c20 2231 2066 696c 6520 7265  rt)), "1 file re
+00007400: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
+00007410: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
+00007420: 642e 220a 2020 2020 2020 2020 2020 2020  d.".            
+00007430: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00007440: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+00007450: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
+00007460: 652c 2030 290a 2020 2020 2020 2020 2020  e, 0).          
+00007470: 2020 7265 706f 7274 2e63 6865 636b 203d    report.check =
+00007480: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+00007490: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000074a0: 616c 2872 6570 6f72 742e 7265 7475 726e  al(report.return
+000074b0: 5f63 6f64 652c 2031 290a 2020 2020 2020  _code, 1).      
+000074c0: 2020 2020 2020 7265 706f 7274 2e63 6865        report.che
+000074d0: 636b 203d 2046 616c 7365 0a20 2020 2020  ck = False.     
+000074e0: 2020 2020 2020 2072 6570 6f72 742e 6661         report.fa
+000074f0: 696c 6564 2850 6174 6828 2265 3122 292c  iled(Path("e1"),
+00007500: 2022 626f 6f6d 2229 0a20 2020 2020 2020   "boom").       
+00007510: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00007520: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
+00007530: 6e65 7329 2c20 3129 0a20 2020 2020 2020  nes), 1).       
+00007540: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00007550: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
+00007560: 6e65 7329 2c20 3129 0a20 2020 2020 2020  nes), 1).       
+00007570: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00007580: 4571 7561 6c28 6572 725f 6c69 6e65 735b  Equal(err_lines[
+00007590: 2d31 5d2c 2022 6572 726f 723a 2063 616e  -1], "error: can
+000075a0: 6e6f 7420 666f 726d 6174 2065 313a 2062  not format e1: b
+000075b0: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
+000075c0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000075d0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+000075e0: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
+000075f0: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
+00007600: 2020 2020 2020 2020 2020 2231 2066 696c            "1 fil
+00007610: 6520 7265 666f 726d 6174 7465 642c 2032  e reformatted, 2
+00007620: 2066 696c 6573 206c 6566 7420 756e 6368   files left unch
+00007630: 616e 6765 642c 2031 2066 696c 6520 6661  anged, 1 file fa
+00007640: 696c 6564 2074 6f22 0a20 2020 2020 2020  iled to".       
+00007650: 2020 2020 2020 2020 2022 2072 6566 6f72           " refor
+00007660: 6d61 742e 222c 0a20 2020 2020 2020 2020  mat.",.         
+00007670: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00007680: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00007690: 6c28 7265 706f 7274 2e72 6574 7572 6e5f  l(report.return_
+000076a0: 636f 6465 2c20 3132 3329 0a20 2020 2020  code, 123).     
+000076b0: 2020 2020 2020 2072 6570 6f72 742e 646f         report.do
+000076c0: 6e65 2850 6174 6828 2266 3322 292c 2062  ne(Path("f3"), b
+000076d0: 6c61 636b 2e43 6861 6e67 6564 2e59 4553  lack.Changed.YES
+000076e0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000076f0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00007700: 656e 286f 7574 5f6c 696e 6573 292c 2032  en(out_lines), 2
+00007710: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00007720: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00007730: 656e 2865 7272 5f6c 696e 6573 292c 2031  en(err_lines), 1
+00007740: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00007750: 6c66 2e61 7373 6572 7445 7175 616c 286f  lf.assertEqual(o
+00007760: 7574 5f6c 696e 6573 5b2d 315d 2c20 2272  ut_lines[-1], "r
+00007770: 6566 6f72 6d61 7474 6564 2066 3322 290a  eformatted f3").
+00007780: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007790: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+000077a0: 2020 2020 2020 2020 2020 2020 2020 756e                un
+000077b0: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
+000077c0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+000077d0: 2020 2020 2232 2066 696c 6573 2072 6566      "2 files ref
+000077e0: 6f72 6d61 7474 6564 2c20 3220 6669 6c65  ormatted, 2 file
+000077f0: 7320 6c65 6674 2075 6e63 6861 6e67 6564  s left unchanged
+00007800: 2c20 3120 6669 6c65 2066 6169 6c65 6420  , 1 file failed 
+00007810: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
+00007820: 2020 2020 2220 7265 666f 726d 6174 2e22      " reformat."
+00007830: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00007840: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007850: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
+00007860: 6f72 742e 7265 7475 726e 5f63 6f64 652c  ort.return_code,
+00007870: 2031 3233 290a 2020 2020 2020 2020 2020   123).          
+00007880: 2020 7265 706f 7274 2e66 6169 6c65 6428    report.failed(
+00007890: 5061 7468 2822 6532 2229 2c20 2262 6f6f  Path("e2"), "boo
+000078a0: 6d22 290a 2020 2020 2020 2020 2020 2020  m").            
+000078b0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000078c0: 286c 656e 286f 7574 5f6c 696e 6573 292c  (len(out_lines),
+000078d0: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
+000078e0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000078f0: 286c 656e 2865 7272 5f6c 696e 6573 292c  (len(err_lines),
+00007900: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
+00007910: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00007920: 2865 7272 5f6c 696e 6573 5b2d 315d 2c20  (err_lines[-1], 
+00007930: 2265 7272 6f72 3a20 6361 6e6e 6f74 2066  "error: cannot f
+00007940: 6f72 6d61 7420 6532 3a20 626f 6f6d 2229  ormat e2: boom")
+00007950: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007960: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+00007970: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00007980: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
+00007990: 7429 292c 0a20 2020 2020 2020 2020 2020  t)),.           
+000079a0: 2020 2020 2022 3220 6669 6c65 7320 7265       "2 files re
+000079b0: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
+000079c0: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
+000079d0: 642c 2032 2066 696c 6573 2066 6169 6c65  d, 2 files faile
+000079e0: 6420 746f 220a 2020 2020 2020 2020 2020  d to".          
+000079f0: 2020 2020 2020 2220 7265 666f 726d 6174        " reformat
+00007a00: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
+00007a10: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00007a20: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+00007a30: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
+00007a40: 652c 2031 3233 290a 2020 2020 2020 2020  e, 123).        
+00007a50: 2020 2020 7265 706f 7274 2e70 6174 685f      report.path_
+00007a60: 6967 6e6f 7265 6428 5061 7468 2822 7761  ignored(Path("wa
+00007a70: 7422 292c 2022 6e6f 206d 6174 6368 2229  t"), "no match")
+00007a80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007a90: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+00007aa0: 6e28 6f75 745f 6c69 6e65 7329 2c20 3229  n(out_lines), 2)
+00007ab0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007ac0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+00007ad0: 6e28 6572 725f 6c69 6e65 7329 2c20 3229  n(err_lines), 2)
+00007ae0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007af0: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+00007b00: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00007b10: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
+00007b20: 7429 292c 0a20 2020 2020 2020 2020 2020  t)),.           
+00007b30: 2020 2020 2022 3220 6669 6c65 7320 7265       "2 files re
+00007b40: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
+00007b50: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
+00007b60: 642c 2032 2066 696c 6573 2066 6169 6c65  d, 2 files faile
+00007b70: 6420 746f 220a 2020 2020 2020 2020 2020  d to".          
+00007b80: 2020 2020 2020 2220 7265 666f 726d 6174        " reformat
+00007b90: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
+00007ba0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00007bb0: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+00007bc0: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
+00007bd0: 652c 2031 3233 290a 2020 2020 2020 2020  e, 123).        
+00007be0: 2020 2020 7265 706f 7274 2e64 6f6e 6528      report.done(
+00007bf0: 5061 7468 2822 6634 2229 2c20 626c 6163  Path("f4"), blac
+00007c00: 6b2e 4368 616e 6765 642e 4e4f 290a 2020  k.Changed.NO).  
+00007c10: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00007c20: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
+00007c30: 7574 5f6c 696e 6573 292c 2032 290a 2020  ut_lines), 2).  
+00007c40: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00007c50: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
+00007c60: 7272 5f6c 696e 6573 292c 2032 290a 2020  rr_lines), 2).  
+00007c70: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00007c80: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00007c90: 2020 2020 2020 2020 2020 2020 756e 7374              unst
+00007ca0: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
+00007cb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00007cc0: 2020 2232 2066 696c 6573 2072 6566 6f72    "2 files refor
+00007cd0: 6d61 7474 6564 2c20 3320 6669 6c65 7320  matted, 3 files 
+00007ce0: 6c65 6674 2075 6e63 6861 6e67 6564 2c20  left unchanged, 
+00007cf0: 3220 6669 6c65 7320 6661 696c 6564 2074  2 files failed t
+00007d00: 6f22 0a20 2020 2020 2020 2020 2020 2020  o".             
+00007d10: 2020 2022 2072 6566 6f72 6d61 742e 222c     " reformat.",
+00007d20: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00007d30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007d40: 6173 7365 7274 4571 7561 6c28 7265 706f  assertEqual(repo
+00007d50: 7274 2e72 6574 7572 6e5f 636f 6465 2c20  rt.return_code, 
+00007d60: 3132 3329 0a20 2020 2020 2020 2020 2020  123).           
+00007d70: 2072 6570 6f72 742e 6368 6563 6b20 3d20   report.check = 
+00007d80: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00007d90: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00007da0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+00007db0: 2020 2075 6e73 7479 6c65 2873 7472 2872     unstyle(str(r
+00007dc0: 6570 6f72 7429 292c 0a20 2020 2020 2020  eport)),.       
+00007dd0: 2020 2020 2020 2020 2022 3220 6669 6c65           "2 file
+00007de0: 7320 776f 756c 6420 6265 2072 6566 6f72  s would be refor
+00007df0: 6d61 7474 6564 2c20 3320 6669 6c65 7320  matted, 3 files 
+00007e00: 776f 756c 6420 6265 206c 6566 7420 756e  would be left un
+00007e10: 6368 616e 6765 642c 2032 220a 2020 2020  changed, 2".    
+00007e20: 2020 2020 2020 2020 2020 2020 2220 6669              " fi
+00007e30: 6c65 7320 776f 756c 6420 6661 696c 2074  les would fail t
+00007e40: 6f20 7265 666f 726d 6174 2e22 2c0a 2020  o reformat.",.  
+00007e50: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00007e60: 2020 2020 2020 2020 7265 706f 7274 2e63          report.c
+00007e70: 6865 636b 203d 2046 616c 7365 0a20 2020  heck = False.   
+00007e80: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
+00007e90: 6469 6666 203d 2054 7275 650a 2020 2020  diff = True.    
+00007ea0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00007eb0: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
+00007ec0: 2020 2020 2020 2020 2020 756e 7374 796c            unstyl
+00007ed0: 6528 7374 7228 7265 706f 7274 2929 2c0a  e(str(report)),.
+00007ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ef0: 2232 2066 696c 6573 2077 6f75 6c64 2062  "2 files would b
+00007f00: 6520 7265 666f 726d 6174 7465 642c 2033  e reformatted, 3
+00007f10: 2066 696c 6573 2077 6f75 6c64 2062 6520   files would be 
+00007f20: 6c65 6674 2075 6e63 6861 6e67 6564 2c20  left unchanged, 
+00007f30: 3222 0a20 2020 2020 2020 2020 2020 2020  2".             
+00007f40: 2020 2022 2066 696c 6573 2077 6f75 6c64     " files would
+00007f50: 2066 6169 6c20 746f 2072 6566 6f72 6d61   fail to reforma
+00007f60: 742e 222c 0a20 2020 2020 2020 2020 2020  t.",.           
+00007f70: 2029 0a0a 2020 2020 6465 6620 7465 7374   )..    def test
+00007f80: 5f6c 6962 3274 6f33 5f70 6172 7365 2873  _lib2to3_parse(s
+00007f90: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00007fa0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
+00007fb0: 6173 7365 7274 5261 6973 6573 2862 6c61  assertRaises(bla
+00007fc0: 636b 2e49 6e76 616c 6964 496e 7075 7429  ck.InvalidInput)
+00007fd0: 3a0a 2020 2020 2020 2020 2020 2020 626c  :.            bl
+00007fe0: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
+00007ff0: 6528 2269 6e76 616c 6964 2073 796e 7461  e("invalid synta
+00008000: 7822 290a 0a20 2020 2020 2020 2073 7472  x")..        str
+00008010: 6164 646c 696e 6720 3d20 2278 202b 2079  addling = "x + y
+00008020: 220a 2020 2020 2020 2020 626c 6163 6b2e  ".        black.
+00008030: 6c69 6232 746f 335f 7061 7273 6528 7374  lib2to3_parse(st
+00008040: 7261 6464 6c69 6e67 290a 2020 2020 2020  raddling).      
+00008050: 2020 626c 6163 6b2e 6c69 6232 746f 335f    black.lib2to3_
+00008060: 7061 7273 6528 7374 7261 6464 6c69 6e67  parse(straddling
+00008070: 2c20 7b54 6172 6765 7456 6572 7369 6f6e  , {TargetVersion
+00008080: 2e50 5933 367d 290a 0a20 2020 2020 2020  .PY36})..       
+00008090: 2070 7932 5f6f 6e6c 7920 3d20 2270 7269   py2_only = "pri
+000080a0: 6e74 2078 220a 2020 2020 2020 2020 7769  nt x".        wi
+000080b0: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+000080c0: 6973 6573 2862 6c61 636b 2e49 6e76 616c  ises(black.Inval
+000080d0: 6964 496e 7075 7429 3a0a 2020 2020 2020  idInput):.      
+000080e0: 2020 2020 2020 626c 6163 6b2e 6c69 6232        black.lib2
+000080f0: 746f 335f 7061 7273 6528 7079 325f 6f6e  to3_parse(py2_on
+00008100: 6c79 2c20 7b54 6172 6765 7456 6572 7369  ly, {TargetVersi
+00008110: 6f6e 2e50 5933 367d 290a 0a20 2020 2020  on.PY36})..     
+00008120: 2020 2070 7933 5f6f 6e6c 7920 3d20 2265     py3_only = "e
+00008130: 7865 6328 782c 2065 6e64 3d79 2922 0a20  xec(x, end=y)". 
+00008140: 2020 2020 2020 2062 6c61 636b 2e6c 6962         black.lib
+00008150: 3274 6f33 5f70 6172 7365 2870 7933 5f6f  2to3_parse(py3_o
+00008160: 6e6c 7929 0a20 2020 2020 2020 2062 6c61  nly).        bla
+00008170: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
+00008180: 2870 7933 5f6f 6e6c 792c 207b 5461 7267  (py3_only, {Targ
+00008190: 6574 5665 7273 696f 6e2e 5059 3336 7d29  etVersion.PY36})
+000081a0: 0a0a 2020 2020 6465 6620 7465 7374 5f67  ..    def test_g
+000081b0: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
+000081c0: 5f64 6563 6f72 6174 6f72 2873 656c 6629  _decorator(self)
+000081d0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+000081e0: 2020 2320 5465 7374 2074 6865 2066 6561    # Test the fea
+000081f0: 7475 7265 2064 6574 6563 7469 6f6e 206f  ture detection o
+00008200: 6620 6e65 7720 6465 636f 7261 746f 7220  f new decorator 
+00008210: 7379 6e74 6178 0a20 2020 2020 2020 2023  syntax.        #
+00008220: 2073 696e 6365 2074 6869 7320 6d61 6b65   since this make
+00008230: 7320 736f 6d65 2074 6573 7420 6361 7365  s some test case
+00008240: 7320 6f66 2074 6573 745f 6765 745f 6665  s of test_get_fe
+00008250: 6174 7572 6573 5f75 7365 6428 290a 2020  atures_used().  
+00008260: 2020 2020 2020 2320 6661 696c 7320 6966        # fails if
+00008270: 2069 7420 6661 696c 732c 2074 6869 7320   it fails, this 
+00008280: 6973 2074 6573 7465 6420 6669 7273 7420  is tested first 
+00008290: 736f 2074 6861 7420 6120 7573 6566 756c  so that a useful
+000082a0: 2063 6173 650a 2020 2020 2020 2020 2320   case.        # 
+000082b0: 6973 2069 6465 6e74 6966 6965 640a 2020  is identified.  
+000082c0: 2020 2020 2020 7369 6d70 6c65 732c 2072        simples, r
+000082d0: 656c 6178 6564 203d 2072 6561 645f 6461  elaxed = read_da
+000082e0: 7461 2822 6d69 7363 656c 6c61 6e65 6f75  ta("miscellaneou
+000082f0: 7322 2c20 2264 6563 6f72 6174 6f72 7322  s", "decorators"
+00008300: 290a 2020 2020 2020 2020 2320 736b 6970  ).        # skip
+00008310: 2065 7870 6c61 6e61 7469 6f6e 2063 6f6d   explanation com
+00008320: 6d65 6e74 7320 6174 2074 6865 2074 6f70  ments at the top
+00008330: 206f 6620 7468 6520 6669 6c65 0a20 2020   of the file.   
+00008340: 2020 2020 2066 6f72 2073 696d 706c 655f       for simple_
+00008350: 7465 7374 2069 6e20 7369 6d70 6c65 732e  test in simples.
+00008360: 7370 6c69 7428 2223 2322 295b 313a 5d3a  split("##")[1:]:
+00008370: 0a20 2020 2020 2020 2020 2020 206e 6f64  .            nod
+00008380: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
+00008390: 335f 7061 7273 6528 7369 6d70 6c65 5f74  3_parse(simple_t
+000083a0: 6573 7429 0a20 2020 2020 2020 2020 2020  est).           
+000083b0: 2064 6563 6f72 6174 6f72 203d 2073 7472   decorator = str
+000083c0: 286e 6f64 652e 6368 696c 6472 656e 5b30  (node.children[0
+000083d0: 5d2e 6368 696c 6472 656e 5b30 5d29 2e73  ].children[0]).s
+000083e0: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
+000083f0: 2020 2073 656c 662e 6173 7365 7274 4e6f     self.assertNo
+00008400: 7449 6e28 0a20 2020 2020 2020 2020 2020  tIn(.           
+00008410: 2020 2020 2046 6561 7475 7265 2e52 454c       Feature.REL
+00008420: 4158 4544 5f44 4543 4f52 4154 4f52 532c  AXED_DECORATORS,
+00008430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008440: 2062 6c61 636b 2e67 6574 5f66 6561 7475   black.get_featu
+00008450: 7265 735f 7573 6564 286e 6f64 6529 2c0a  res_used(node),.
+00008460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008470: 6d73 673d 280a 2020 2020 2020 2020 2020  msg=(.          
+00008480: 2020 2020 2020 2020 2020 6622 6465 636f            f"deco
+00008490: 7261 746f 7220 277b 6465 636f 7261 746f  rator '{decorato
+000084a0: 727d 2720 666f 6c6c 6f77 7320 7079 7468  r}' follows pyth
+000084b0: 6f6e 3c3d 332e 3820 7379 6e74 6178 220a  on<=3.8 syntax".
+000084c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000084d0: 2020 2020 2262 7574 2069 7320 6465 7465      "but is dete
+000084e0: 6374 6564 2061 7320 332e 392b 220a 2020  cted as 3.9+".  
+000084f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008500: 2020 2320 6622 5468 6520 6675 6c6c 206e    # f"The full n
+00008510: 6f64 6520 6973 5c6e 7b6e 6f64 6521 727d  ode is\n{node!r}
+00008520: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00008530: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+00008540: 2029 0a20 2020 2020 2020 2023 2073 6b69   ).        # ski
+00008550: 7020 7468 6520 2723 206f 7574 7075 7427  p the '# output'
+00008560: 2063 6f6d 6d65 6e74 2061 7420 7468 6520   comment at the 
+00008570: 746f 7020 6f66 2074 6865 206f 7574 7075  top of the outpu
+00008580: 7420 7061 7274 0a20 2020 2020 2020 2066  t part.        f
+00008590: 6f72 2072 656c 6178 6564 5f74 6573 7420  or relaxed_test 
+000085a0: 696e 2072 656c 6178 6564 2e73 706c 6974  in relaxed.split
+000085b0: 2822 2323 2229 5b31 3a5d 3a0a 2020 2020  ("##")[1:]:.    
+000085c0: 2020 2020 2020 2020 6e6f 6465 203d 2062          node = b
+000085d0: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
+000085e0: 7365 2872 656c 6178 6564 5f74 6573 7429  se(relaxed_test)
+000085f0: 0a20 2020 2020 2020 2020 2020 2064 6563  .            dec
+00008600: 6f72 6174 6f72 203d 2073 7472 286e 6f64  orator = str(nod
+00008610: 652e 6368 696c 6472 656e 5b30 5d2e 6368  e.children[0].ch
+00008620: 696c 6472 656e 5b30 5d29 2e73 7472 6970  ildren[0]).strip
+00008630: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
+00008640: 656c 662e 6173 7365 7274 496e 280a 2020  elf.assertIn(.  
+00008650: 2020 2020 2020 2020 2020 2020 2020 4665                Fe
+00008660: 6174 7572 652e 5245 4c41 5845 445f 4445  ature.RELAXED_DE
+00008670: 434f 5241 544f 5253 2c0a 2020 2020 2020  CORATORS,.      
+00008680: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
+00008690: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
+000086a0: 6428 6e6f 6465 292c 0a20 2020 2020 2020  d(node),.       
+000086b0: 2020 2020 2020 2020 206d 7367 3d28 0a20           msg=(. 
+000086c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000086d0: 2020 2066 2264 6563 6f72 6174 6f72 2027     f"decorator '
+000086e0: 7b64 6563 6f72 6174 6f72 7d27 2075 7365  {decorator}' use
+000086f0: 7320 7079 7468 6f6e 332e 392b 2073 796e  s python3.9+ syn
+00008700: 7461 7822 0a20 2020 2020 2020 2020 2020  tax".           
+00008710: 2020 2020 2020 2020 2022 6275 7420 6973           "but is
+00008720: 2064 6574 6563 7465 6420 6173 2070 7974   detected as pyt
+00008730: 686f 6e3c 3d33 2e38 220a 2020 2020 2020  hon<=3.8".      
+00008740: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00008750: 6622 5468 6520 6675 6c6c 206e 6f64 6520  f"The full node 
+00008760: 6973 5c6e 7b6e 6f64 6521 727d 220a 2020  is\n{node!r}".  
+00008770: 2020 2020 2020 2020 2020 2020 2020 292c                ),
+00008780: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00008790: 2020 2020 6465 6620 7465 7374 5f67 6574      def test_get
+000087a0: 5f66 6561 7475 7265 735f 7573 6564 2873  _features_used(s
+000087b0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+000087c0: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
+000087d0: 5f66 6561 7475 7265 735f 7573 6564 2822  _features_used("
+000087e0: 6465 6620 6628 2a2c 2061 7267 293a 202e  def f(*, arg): .
+000087f0: 2e2e 5c6e 222c 2073 6574 2829 290a 2020  ..\n", set()).  
+00008800: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
+00008810: 5f66 6561 7475 7265 735f 7573 6564 280a  _features_used(.
+00008820: 2020 2020 2020 2020 2020 2020 2264 6566              "def
+00008830: 2066 282a 2c20 6172 672c 293a 202e 2e2e   f(*, arg,): ...
+00008840: 5c6e 222c 207b 4665 6174 7572 652e 5452  \n", {Feature.TR
+00008850: 4149 4c49 4e47 5f43 4f4d 4d41 5f49 4e5f  AILING_COMMA_IN_
+00008860: 4445 467d 0a20 2020 2020 2020 2029 0a20  DEF}.        ). 
+00008870: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
+00008880: 6b5f 6665 6174 7572 6573 5f75 7365 6428  k_features_used(
+00008890: 2266 282a 6172 672c 295c 6e22 2c20 7b46  "f(*arg,)\n", {F
+000088a0: 6561 7475 7265 2e54 5241 494c 494e 475f  eature.TRAILING_
+000088b0: 434f 4d4d 415f 494e 5f43 414c 4c7d 290a  COMMA_IN_CALL}).
+000088c0: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
+000088d0: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
+000088e0: 2822 6465 6620 6628 2a2c 2061 7267 293a  ("def f(*, arg):
+000088f0: 2066 2773 7472 696e 6727 5c6e 222c 207b   f'string'\n", {
+00008900: 4665 6174 7572 652e 465f 5354 5249 4e47  Feature.F_STRING
+00008910: 537d 290a 2020 2020 2020 2020 7365 6c66  S}).        self
+00008920: 2e63 6865 636b 5f66 6561 7475 7265 735f  .check_features_
+00008930: 7573 6564 2822 3132 335f 3435 365c 6e22  used("123_456\n"
+00008940: 2c20 7b46 6561 7475 7265 2e4e 554d 4552  , {Feature.NUMER
+00008950: 4943 5f55 4e44 4552 5343 4f52 4553 7d29  IC_UNDERSCORES})
+00008960: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
+00008970: 6563 6b5f 6665 6174 7572 6573 5f75 7365  eck_features_use
+00008980: 6428 2231 3233 3435 365c 6e22 2c20 7365  d("123456\n", se
+00008990: 7428 2929 0a0a 2020 2020 2020 2020 736f  t())..        so
+000089a0: 7572 6365 2c20 6578 7065 6374 6564 203d  urce, expected =
+000089b0: 2072 6561 645f 6461 7461 2822 6361 7365   read_data("case
+000089c0: 7322 2c20 2266 756e 6374 696f 6e22 290a  s", "function").
+000089d0: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+000089e0: 5f66 6561 7475 7265 7320 3d20 7b0a 2020  _features = {.  
+000089f0: 2020 2020 2020 2020 2020 4665 6174 7572            Featur
+00008a00: 652e 5452 4149 4c49 4e47 5f43 4f4d 4d41  e.TRAILING_COMMA
+00008a10: 5f49 4e5f 4341 4c4c 2c0a 2020 2020 2020  _IN_CALL,.      
+00008a20: 2020 2020 2020 4665 6174 7572 652e 5452        Feature.TR
+00008a30: 4149 4c49 4e47 5f43 4f4d 4d41 5f49 4e5f  AILING_COMMA_IN_
+00008a40: 4445 462c 0a20 2020 2020 2020 2020 2020  DEF,.           
+00008a50: 2046 6561 7475 7265 2e46 5f53 5452 494e   Feature.F_STRIN
+00008a60: 4753 2c0a 2020 2020 2020 2020 7d0a 2020  GS,.        }.  
+00008a70: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
+00008a80: 5f66 6561 7475 7265 735f 7573 6564 2873  _features_used(s
+00008a90: 6f75 7263 652c 2065 7870 6563 7465 645f  ource, expected_
+00008aa0: 6665 6174 7572 6573 290a 2020 2020 2020  features).      
+00008ab0: 2020 7365 6c66 2e63 6865 636b 5f66 6561    self.check_fea
+00008ac0: 7475 7265 735f 7573 6564 2865 7870 6563  tures_used(expec
+00008ad0: 7465 642c 2065 7870 6563 7465 645f 6665  ted, expected_fe
+00008ae0: 6174 7572 6573 290a 0a20 2020 2020 2020  atures)..       
+00008af0: 2073 6f75 7263 652c 2065 7870 6563 7465   source, expecte
+00008b00: 6420 3d20 7265 6164 5f64 6174 6128 2263  d = read_data("c
+00008b10: 6173 6573 222c 2022 6578 7072 6573 7369  ases", "expressi
+00008b20: 6f6e 2229 0a20 2020 2020 2020 2073 656c  on").        sel
+00008b30: 662e 6368 6563 6b5f 6665 6174 7572 6573  f.check_features
+00008b40: 5f75 7365 6428 736f 7572 6365 2c20 7365  _used(source, se
+00008b50: 7428 2929 0a20 2020 2020 2020 2073 656c  t()).        sel
+00008b60: 662e 6368 6563 6b5f 6665 6174 7572 6573  f.check_features
+00008b70: 5f75 7365 6428 6578 7065 6374 6564 2c20  _used(expected, 
+00008b80: 7365 7428 2929 0a0a 2020 2020 2020 2020  set())..        
+00008b90: 7365 6c66 2e63 6865 636b 5f66 6561 7475  self.check_featu
+00008ba0: 7265 735f 7573 6564 2822 6c61 6d62 6461  res_used("lambda
+00008bb0: 2061 2c20 2f2c 2062 3a20 2e2e 2e5c 6e22   a, /, b: ...\n"
+00008bc0: 2c20 7b46 6561 7475 7265 2e50 4f53 5f4f  , {Feature.POS_O
+00008bd0: 4e4c 595f 4152 4755 4d45 4e54 537d 290a  NLY_ARGUMENTS}).
+00008be0: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
+00008bf0: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
+00008c00: 2822 6465 6620 666e 2861 2c20 2f2c 2062  ("def fn(a, /, b
+00008c10: 293a 202e 2e2e 222c 207b 4665 6174 7572  ): ...", {Featur
+00008c20: 652e 504f 535f 4f4e 4c59 5f41 5247 554d  e.POS_ONLY_ARGUM
+00008c30: 454e 5453 7d29 0a0a 2020 2020 2020 2020  ENTS})..        
+00008c40: 7365 6c66 2e63 6865 636b 5f66 6561 7475  self.check_featu
+00008c50: 7265 735f 7573 6564 2822 6465 6620 666e  res_used("def fn
+00008c60: 2829 3a20 7969 656c 6420 612c 2062 222c  (): yield a, b",
+00008c70: 2073 6574 2829 290a 2020 2020 2020 2020   set()).        
+00008c80: 7365 6c66 2e63 6865 636b 5f66 6561 7475  self.check_featu
+00008c90: 7265 735f 7573 6564 2822 6465 6620 666e  res_used("def fn
+00008ca0: 2829 3a20 7265 7475 726e 2061 2c20 6222  (): return a, b"
+00008cb0: 2c20 7365 7428 2929 0a20 2020 2020 2020  , set()).       
+00008cc0: 2073 656c 662e 6368 6563 6b5f 6665 6174   self.check_feat
+00008cd0: 7572 6573 5f75 7365 6428 2264 6566 2066  ures_used("def f
+00008ce0: 6e28 293a 2079 6965 6c64 202a 622c 2063  n(): yield *b, c
+00008cf0: 222c 207b 4665 6174 7572 652e 554e 5041  ", {Feature.UNPA
+00008d00: 434b 494e 475f 4f4e 5f46 4c4f 577d 290a  CKING_ON_FLOW}).
+00008d10: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
+00008d20: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
+00008d30: 280a 2020 2020 2020 2020 2020 2020 2264  (.            "d
+00008d40: 6566 2066 6e28 293a 2072 6574 7572 6e20  ef fn(): return 
+00008d50: 612c 202a 622c 2063 222c 207b 4665 6174  a, *b, c", {Feat
+00008d60: 7572 652e 554e 5041 434b 494e 475f 4f4e  ure.UNPACKING_ON
+00008d70: 5f46 4c4f 577d 0a20 2020 2020 2020 2029  _FLOW}.        )
+00008d80: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
+00008d90: 6563 6b5f 6665 6174 7572 6573 5f75 7365  eck_features_use
+00008da0: 6428 2278 203d 2061 2c20 2a62 2c20 6322  d("x = a, *b, c"
+00008db0: 2c20 7365 7428 2929 0a0a 2020 2020 2020  , set())..      
+00008dc0: 2020 7365 6c66 2e63 6865 636b 5f66 6561    self.check_fea
+00008dd0: 7475 7265 735f 7573 6564 2822 783a 2041  tures_used("x: A
+00008de0: 6e79 203d 2072 6567 756c 6172 222c 2073  ny = regular", s
+00008df0: 6574 2829 290a 2020 2020 2020 2020 7365  et()).        se
+00008e00: 6c66 2e63 6865 636b 5f66 6561 7475 7265  lf.check_feature
+00008e10: 735f 7573 6564 2822 783a 2041 6e79 203d  s_used("x: Any =
+00008e20: 2028 7265 6775 6c61 722c 2072 6567 756c   (regular, regul
+00008e30: 6172 2922 2c20 7365 7428 2929 0a20 2020  ar)", set()).   
+00008e40: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
+00008e50: 6665 6174 7572 6573 5f75 7365 6428 2278  features_used("x
+00008e60: 3a20 416e 7920 3d20 436f 6d70 6c65 7828  : Any = Complex(
+00008e70: 5479 7065 2831 2929 5b73 6f6d 6574 6869  Type(1))[somethi
+00008e80: 6e67 5d22 2c20 7365 7428 2929 0a20 2020  ng]", set()).   
+00008e90: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
+00008ea0: 6665 6174 7572 6573 5f75 7365 6428 0a20  features_used(. 
+00008eb0: 2020 2020 2020 2020 2020 2022 783a 2054             "x: T
+00008ec0: 7570 6c65 5b69 6e74 2c20 2e2e 2e5d 203d  uple[int, ...] =
+00008ed0: 2061 2c20 622c 2063 222c 207b 4665 6174   a, b, c", {Feat
+00008ee0: 7572 652e 414e 4e5f 4153 5349 474e 5f45  ure.ANN_ASSIGN_E
+00008ef0: 5854 454e 4445 445f 5248 537d 0a20 2020  XTENDED_RHS}.   
+00008f00: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00008f10: 7365 6c66 2e63 6865 636b 5f66 6561 7475  self.check_featu
+00008f20: 7265 735f 7573 6564 2822 7472 793a 2070  res_used("try: p
+00008f30: 6173 735c 6e65 7863 6570 7420 536f 6d65  ass\nexcept Some
+00008f40: 7468 696e 673a 2070 6173 7322 2c20 7365  thing: pass", se
+00008f50: 7428 2929 0a20 2020 2020 2020 2073 656c  t()).        sel
+00008f60: 662e 6368 6563 6b5f 6665 6174 7572 6573  f.check_features
+00008f70: 5f75 7365 6428 2274 7279 3a20 7061 7373  _used("try: pass
+00008f80: 5c6e 6578 6365 7074 2028 2a53 6f6d 6574  \nexcept (*Somet
+00008f90: 6869 6e67 2c29 3a20 7061 7373 222c 2073  hing,): pass", s
+00008fa0: 6574 2829 290a 2020 2020 2020 2020 7365  et()).        se
+00008fb0: 6c66 2e63 6865 636b 5f66 6561 7475 7265  lf.check_feature
+00008fc0: 735f 7573 6564 280a 2020 2020 2020 2020  s_used(.        
+00008fd0: 2020 2020 2274 7279 3a20 7061 7373 5c6e      "try: pass\n
+00008fe0: 6578 6365 7074 202a 4772 6f75 703a 2070  except *Group: p
+00008ff0: 6173 7322 2c20 7b46 6561 7475 7265 2e45  ass", {Feature.E
+00009000: 5843 4550 545f 5354 4152 7d0a 2020 2020  XCEPT_STAR}.    
+00009010: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
+00009020: 656c 662e 6368 6563 6b5f 6665 6174 7572  elf.check_featur
+00009030: 6573 5f75 7365 6428 2261 5b2a 625d 222c  es_used("a[*b]",
+00009040: 207b 4665 6174 7572 652e 5641 5249 4144   {Feature.VARIAD
+00009050: 4943 5f47 454e 4552 4943 537d 290a 2020  IC_GENERICS}).  
+00009060: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
+00009070: 5f66 6561 7475 7265 735f 7573 6564 2822  _features_used("
+00009080: 615b 782c 202a 7928 292c 207a 5d20 3d20  a[x, *y(), z] = 
+00009090: 7422 2c20 7b46 6561 7475 7265 2e56 4152  t", {Feature.VAR
+000090a0: 4941 4449 435f 4745 4e45 5249 4353 7d29  IADIC_GENERICS})
+000090b0: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
+000090c0: 6563 6b5f 6665 6174 7572 6573 5f75 7365  eck_features_use
+000090d0: 6428 2264 6566 2066 6e28 2a61 7267 733a  d("def fn(*args:
+000090e0: 202a 5429 3a20 7061 7373 222c 207b 4665   *T): pass", {Fe
+000090f0: 6174 7572 652e 5641 5249 4144 4943 5f47  ature.VARIADIC_G
+00009100: 454e 4552 4943 537d 290a 0a20 2020 2020  ENERICS})..     
+00009110: 2020 2073 656c 662e 6368 6563 6b5f 6665     self.check_fe
+00009120: 6174 7572 6573 5f75 7365 6428 2277 6974  atures_used("wit
+00009130: 6820 613a 2070 6173 7322 2c20 7365 7428  h a: pass", set(
+00009140: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+00009150: 6368 6563 6b5f 6665 6174 7572 6573 5f75  check_features_u
+00009160: 7365 6428 2277 6974 6820 612c 2062 3a20  sed("with a, b: 
+00009170: 7061 7373 222c 2073 6574 2829 290a 2020  pass", set()).  
+00009180: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
+00009190: 5f66 6561 7475 7265 735f 7573 6564 2822  _features_used("
+000091a0: 7769 7468 2061 2061 7320 623a 2070 6173  with a as b: pas
+000091b0: 7322 2c20 7365 7428 2929 0a20 2020 2020  s", set()).     
+000091c0: 2020 2073 656c 662e 6368 6563 6b5f 6665     self.check_fe
+000091d0: 6174 7572 6573 5f75 7365 6428 2277 6974  atures_used("wit
+000091e0: 6820 6120 6173 2062 2c20 6320 6173 2064  h a as b, c as d
+000091f0: 3a20 7061 7373 222c 2073 6574 2829 290a  : pass", set()).
+00009200: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
+00009210: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
+00009220: 2822 7769 7468 2028 6129 3a20 7061 7373  ("with (a): pass
+00009230: 222c 2073 6574 2829 290a 2020 2020 2020  ", set()).      
+00009240: 2020 7365 6c66 2e63 6865 636b 5f66 6561    self.check_fea
+00009250: 7475 7265 735f 7573 6564 2822 7769 7468  tures_used("with
+00009260: 2028 612c 2062 293a 2070 6173 7322 2c20   (a, b): pass", 
+00009270: 7365 7428 2929 0a20 2020 2020 2020 2073  set()).        s
+00009280: 656c 662e 6368 6563 6b5f 6665 6174 7572  elf.check_featur
+00009290: 6573 5f75 7365 6428 2277 6974 6820 2861  es_used("with (a
+000092a0: 2c20 6229 2061 7320 2863 2c20 6429 3a20  , b) as (c, d): 
+000092b0: 7061 7373 222c 2073 6574 2829 290a 2020  pass", set()).  
+000092c0: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
+000092d0: 5f66 6561 7475 7265 735f 7573 6564 280a  _features_used(.
+000092e0: 2020 2020 2020 2020 2020 2020 2277 6974              "wit
+000092f0: 6820 2861 2061 7320 6229 3a20 7061 7373  h (a as b): pass
+00009300: 222c 207b 4665 6174 7572 652e 5041 5245  ", {Feature.PARE
+00009310: 4e54 4845 5349 5a45 445f 434f 4e54 4558  NTHESIZED_CONTEX
+00009320: 545f 4d41 4e41 4745 5253 7d0a 2020 2020  T_MANAGERS}.    
+00009330: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
+00009340: 6c66 2e63 6865 636b 5f66 6561 7475 7265  lf.check_feature
+00009350: 735f 7573 6564 280a 2020 2020 2020 2020  s_used(.        
+00009360: 2020 2020 2277 6974 6820 2828 6120 6173      "with ((a as
+00009370: 2062 2929 3a20 7061 7373 222c 207b 4665   b)): pass", {Fe
+00009380: 6174 7572 652e 5041 5245 4e54 4845 5349  ature.PARENTHESI
+00009390: 5a45 445f 434f 4e54 4558 545f 4d41 4e41  ZED_CONTEXT_MANA
+000093a0: 4745 5253 7d0a 2020 2020 2020 2020 290a  GERS}.        ).
+000093b0: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
+000093c0: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
+000093d0: 280a 2020 2020 2020 2020 2020 2020 2277  (.            "w
+000093e0: 6974 6820 2861 2c20 6220 6173 2063 293a  ith (a, b as c):
+000093f0: 2070 6173 7322 2c20 7b46 6561 7475 7265   pass", {Feature
+00009400: 2e50 4152 454e 5448 4553 495a 4544 5f43  .PARENTHESIZED_C
+00009410: 4f4e 5445 5854 5f4d 414e 4147 4552 537d  ONTEXT_MANAGERS}
+00009420: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00009430: 2020 2073 656c 662e 6368 6563 6b5f 6665     self.check_fe
+00009440: 6174 7572 6573 5f75 7365 6428 0a20 2020  atures_used(.   
+00009450: 2020 2020 2020 2020 2022 7769 7468 2028           "with (
+00009460: 612c 2028 6220 6173 2063 2929 3a20 7061  a, (b as c)): pa
+00009470: 7373 222c 207b 4665 6174 7572 652e 5041  ss", {Feature.PA
+00009480: 5245 4e54 4845 5349 5a45 445f 434f 4e54  RENTHESIZED_CONT
+00009490: 4558 545f 4d41 4e41 4745 5253 7d0a 2020  EXT_MANAGERS}.  
+000094a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000094b0: 7365 6c66 2e63 6865 636b 5f66 6561 7475  self.check_featu
+000094c0: 7265 735f 7573 6564 280a 2020 2020 2020  res_used(.      
+000094d0: 2020 2020 2020 2277 6974 6820 2828 612c        "with ((a,
+000094e0: 2028 2862 2061 7320 6329 2929 293a 2070   ((b as c)))): p
+000094f0: 6173 7322 2c20 7b46 6561 7475 7265 2e50  ass", {Feature.P
+00009500: 4152 454e 5448 4553 495a 4544 5f43 4f4e  ARENTHESIZED_CON
+00009510: 5445 5854 5f4d 414e 4147 4552 537d 0a20  TEXT_MANAGERS}. 
+00009520: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00009530: 6620 6368 6563 6b5f 6665 6174 7572 6573  f check_features
+00009540: 5f75 7365 6428 7365 6c66 2c20 736f 7572  _used(self, sour
+00009550: 6365 3a20 7374 722c 2065 7870 6563 7465  ce: str, expecte
+00009560: 643a 2053 6574 5b46 6561 7475 7265 5d29  d: Set[Feature])
+00009570: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00009580: 2020 6e6f 6465 203d 2062 6c61 636b 2e6c    node = black.l
+00009590: 6962 3274 6f33 5f70 6172 7365 2873 6f75  ib2to3_parse(sou
+000095a0: 7263 6529 0a20 2020 2020 2020 2061 6374  rce).        act
+000095b0: 7561 6c20 3d20 626c 6163 6b2e 6765 745f  ual = black.get_
+000095c0: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
+000095d0: 6465 290a 2020 2020 2020 2020 6d73 6720  de).        msg 
+000095e0: 3d20 6622 4578 7065 6374 6564 207b 6578  = f"Expected {ex
+000095f0: 7065 6374 6564 7d20 6275 7420 676f 7420  pected} but got 
+00009600: 7b61 6374 7561 6c7d 2066 6f72 207b 736f  {actual} for {so
+00009610: 7572 6365 2172 7d22 0a20 2020 2020 2020  urce!r}".       
+00009620: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00009630: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00009640: 616c 2861 6374 7561 6c2c 2065 7870 6563  al(actual, expec
+00009650: 7465 642c 206d 7367 3d6d 7367 290a 2020  ted, msg=msg).  
+00009660: 2020 2020 2020 6578 6365 7074 2041 7373        except Ass
+00009670: 6572 7469 6f6e 4572 726f 723a 0a20 2020  ertionError:.   
+00009680: 2020 2020 2020 2020 2044 6562 7567 5669           DebugVi
+00009690: 7369 746f 722e 7368 6f77 286e 6f64 6529  sitor.show(node)
+000096a0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+000096b0: 7365 0a0a 2020 2020 6465 6620 7465 7374  se..    def test
+000096c0: 5f67 6574 5f66 6561 7475 7265 735f 7573  _get_features_us
+000096d0: 6564 5f66 6f72 5f66 7574 7572 655f 666c  ed_for_future_fl
+000096e0: 6167 7328 7365 6c66 2920 2d3e 204e 6f6e  ags(self) -> Non
+000096f0: 653a 0a20 2020 2020 2020 2066 6f72 2073  e:.        for s
+00009700: 7263 2c20 6665 6174 7572 6573 2069 6e20  rc, features in 
+00009710: 5b0a 2020 2020 2020 2020 2020 2020 2822  [.            ("
+00009720: 6672 6f6d 205f 5f66 7574 7572 655f 5f20  from __future__ 
+00009730: 696d 706f 7274 2061 6e6e 6f74 6174 696f  import annotatio
+00009740: 6e73 222c 207b 4665 6174 7572 652e 4655  ns", {Feature.FU
+00009750: 5455 5245 5f41 4e4e 4f54 4154 494f 4e53  TURE_ANNOTATIONS
+00009760: 7d29 2c0a 2020 2020 2020 2020 2020 2020  }),.            
+00009770: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00009780: 2020 2266 726f 6d20 5f5f 6675 7475 7265    "from __future
+00009790: 5f5f 2069 6d70 6f72 7420 286f 7468 6572  __ import (other
+000097a0: 2c20 616e 6e6f 7461 7469 6f6e 7329 222c  , annotations)",
+000097b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000097c0: 207b 4665 6174 7572 652e 4655 5455 5245   {Feature.FUTURE
+000097d0: 5f41 4e4e 4f54 4154 494f 4e53 7d2c 0a20  _ANNOTATIONS},. 
+000097e0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+000097f0: 2020 2020 2020 2020 2020 2822 6120 3d20            ("a = 
+00009800: 3120 2b20 325c 6e66 726f 6d20 736f 6d65  1 + 2\nfrom some
+00009810: 7468 696e 6720 696d 706f 7274 2061 6e6e  thing import ann
+00009820: 6f74 6174 696f 6e73 222c 2073 6574 2829  otations", set()
+00009830: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
+00009840: 2266 726f 6d20 5f5f 6675 7475 7265 5f5f  "from __future__
+00009850: 2069 6d70 6f72 7420 782c 2079 222c 2073   import x, y", s
+00009860: 6574 2829 292c 0a20 2020 2020 2020 205d  et()),.        ]
+00009870: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
+00009880: 7468 2073 656c 662e 7375 6254 6573 7428  th self.subTest(
+00009890: 7372 633d 7372 632c 2066 6561 7475 7265  src=src, feature
+000098a0: 733d 6665 6174 7572 6573 293a 0a20 2020  s=features):.   
+000098b0: 2020 2020 2020 2020 2020 2020 206e 6f64               nod
+000098c0: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
+000098d0: 335f 7061 7273 6528 7372 6329 0a20 2020  3_parse(src).   
+000098e0: 2020 2020 2020 2020 2020 2020 2066 7574               fut
+000098f0: 7572 655f 696d 706f 7274 7320 3d20 626c  ure_imports = bl
+00009900: 6163 6b2e 6765 745f 6675 7475 7265 5f69  ack.get_future_i
+00009910: 6d70 6f72 7473 286e 6f64 6529 0a20 2020  mports(node).   
+00009920: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00009930: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+00009940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009950: 2020 2062 6c61 636b 2e67 6574 5f66 6561     black.get_fea
+00009960: 7475 7265 735f 7573 6564 286e 6f64 652c  tures_used(node,
+00009970: 2066 7574 7572 655f 696d 706f 7274 733d   future_imports=
+00009980: 6675 7475 7265 5f69 6d70 6f72 7473 292c  future_imports),
+00009990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000099a0: 2020 2020 2066 6561 7475 7265 732c 0a20       features,. 
+000099b0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000099c0: 0a0a 2020 2020 6465 6620 7465 7374 5f67  ..    def test_g
+000099d0: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
+000099e0: 7328 7365 6c66 2920 2d3e 204e 6f6e 653a  s(self) -> None:
+000099f0: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
+00009a00: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
+00009a10: 7273 6528 225c 6e22 290a 2020 2020 2020  rse("\n").      
+00009a20: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00009a30: 616c 2873 6574 2829 2c20 626c 6163 6b2e  al(set(), black.
+00009a40: 6765 745f 6675 7475 7265 5f69 6d70 6f72  get_future_impor
+00009a50: 7473 286e 6f64 6529 290a 2020 2020 2020  ts(node)).      
+00009a60: 2020 6e6f 6465 203d 2062 6c61 636b 2e6c    node = black.l
+00009a70: 6962 3274 6f33 5f70 6172 7365 2822 6672  ib2to3_parse("fr
+00009a80: 6f6d 205f 5f66 7574 7572 655f 5f20 696d  om __future__ im
+00009a90: 706f 7274 2062 6c61 636b 5c6e 2229 0a20  port black\n"). 
+00009aa0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00009ab0: 7274 4571 7561 6c28 7b22 626c 6163 6b22  rtEqual({"black"
+00009ac0: 7d2c 2062 6c61 636b 2e67 6574 5f66 7574  }, black.get_fut
+00009ad0: 7572 655f 696d 706f 7274 7328 6e6f 6465  ure_imports(node
+00009ae0: 2929 0a20 2020 2020 2020 206e 6f64 6520  )).        node 
+00009af0: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
+00009b00: 7061 7273 6528 2266 726f 6d20 5f5f 6675  parse("from __fu
+00009b10: 7475 7265 5f5f 2069 6d70 6f72 7420 6d75  ture__ import mu
+00009b20: 6c74 6970 6c65 2c20 696d 706f 7274 735c  ltiple, imports\
+00009b30: 6e22 290a 2020 2020 2020 2020 7365 6c66  n").        self
+00009b40: 2e61 7373 6572 7445 7175 616c 287b 226d  .assertEqual({"m
+00009b50: 756c 7469 706c 6522 2c20 2269 6d70 6f72  ultiple", "impor
+00009b60: 7473 227d 2c20 626c 6163 6b2e 6765 745f  ts"}, black.get_
+00009b70: 6675 7475 7265 5f69 6d70 6f72 7473 286e  future_imports(n
+00009b80: 6f64 6529 290a 2020 2020 2020 2020 6e6f  ode)).        no
+00009b90: 6465 203d 2062 6c61 636b 2e6c 6962 3274  de = black.lib2t
+00009ba0: 6f33 5f70 6172 7365 2822 6672 6f6d 205f  o3_parse("from _
+00009bb0: 5f66 7574 7572 655f 5f20 696d 706f 7274  _future__ import
+00009bc0: 2028 7061 7265 6e74 6865 7369 7a65 642c   (parenthesized,
+00009bd0: 2069 6d70 6f72 7473 295c 6e22 290a 2020   imports)\n").  
+00009be0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00009bf0: 7445 7175 616c 287b 2270 6172 656e 7468  tEqual({"parenth
+00009c00: 6573 697a 6564 222c 2022 696d 706f 7274  esized", "import
+00009c10: 7322 7d2c 2062 6c61 636b 2e67 6574 5f66  s"}, black.get_f
+00009c20: 7574 7572 655f 696d 706f 7274 7328 6e6f  uture_imports(no
+00009c30: 6465 2929 0a20 2020 2020 2020 206e 6f64  de)).        nod
+00009c40: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
+00009c50: 335f 7061 7273 6528 0a20 2020 2020 2020  3_parse(.       
+00009c60: 2020 2020 2022 6672 6f6d 205f 5f66 7574       "from __fut
+00009c70: 7572 655f 5f20 696d 706f 7274 206d 756c  ure__ import mul
+00009c80: 7469 706c 655c 6e66 726f 6d20 5f5f 6675  tiple\nfrom __fu
+00009c90: 7475 7265 5f5f 2069 6d70 6f72 7420 696d  ture__ import im
+00009ca0: 706f 7274 735c 6e22 0a20 2020 2020 2020  ports\n".       
+00009cb0: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
+00009cc0: 6173 7365 7274 4571 7561 6c28 7b22 6d75  assertEqual({"mu
+00009cd0: 6c74 6970 6c65 222c 2022 696d 706f 7274  ltiple", "import
+00009ce0: 7322 7d2c 2062 6c61 636b 2e67 6574 5f66  s"}, black.get_f
+00009cf0: 7574 7572 655f 696d 706f 7274 7328 6e6f  uture_imports(no
+00009d00: 6465 2929 0a20 2020 2020 2020 206e 6f64  de)).        nod
+00009d10: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
+00009d20: 335f 7061 7273 6528 2223 2063 6f6d 6d65  3_parse("# comme
+00009d30: 6e74 5c6e 6672 6f6d 205f 5f66 7574 7572  nt\nfrom __futur
+00009d40: 655f 5f20 696d 706f 7274 2062 6c61 636b  e__ import black
+00009d50: 5c6e 2229 0a20 2020 2020 2020 2073 656c  \n").        sel
+00009d60: 662e 6173 7365 7274 4571 7561 6c28 7b22  f.assertEqual({"
+00009d70: 626c 6163 6b22 7d2c 2062 6c61 636b 2e67  black"}, black.g
+00009d80: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
+00009d90: 7328 6e6f 6465 2929 0a20 2020 2020 2020  s(node)).       
+00009da0: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
+00009db0: 6232 746f 335f 7061 7273 6528 2722 2222  b2to3_parse('"""
+00009dc0: 646f 6373 7472 696e 6722 2222 5c6e 6672  docstring"""\nfr
+00009dd0: 6f6d 205f 5f66 7574 7572 655f 5f20 696d  om __future__ im
+00009de0: 706f 7274 2062 6c61 636b 5c6e 2729 0a20  port black\n'). 
+00009df0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00009e00: 7274 4571 7561 6c28 7b22 626c 6163 6b22  rtEqual({"black"
+00009e10: 7d2c 2062 6c61 636b 2e67 6574 5f66 7574  }, black.get_fut
+00009e20: 7572 655f 696d 706f 7274 7328 6e6f 6465  ure_imports(node
+00009e30: 2929 0a20 2020 2020 2020 206e 6f64 6520  )).        node 
+00009e40: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
+00009e50: 7061 7273 6528 2273 6f6d 6528 6f74 6865  parse("some(othe
+00009e60: 722c 2063 6f64 6529 5c6e 6672 6f6d 205f  r, code)\nfrom _
+00009e70: 5f66 7574 7572 655f 5f20 696d 706f 7274  _future__ import
+00009e80: 2062 6c61 636b 5c6e 2229 0a20 2020 2020   black\n").     
+00009e90: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00009ea0: 7561 6c28 7365 7428 292c 2062 6c61 636b  ual(set(), black
+00009eb0: 2e67 6574 5f66 7574 7572 655f 696d 706f  .get_future_impo
+00009ec0: 7274 7328 6e6f 6465 2929 0a20 2020 2020  rts(node)).     
+00009ed0: 2020 206e 6f64 6520 3d20 626c 6163 6b2e     node = black.
+00009ee0: 6c69 6232 746f 335f 7061 7273 6528 2266  lib2to3_parse("f
+00009ef0: 726f 6d20 736f 6d65 2e6d 6f64 756c 6520  rom some.module 
+00009f00: 696d 706f 7274 2062 6c61 636b 5c6e 2229  import black\n")
+00009f10: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00009f20: 7365 7274 4571 7561 6c28 7365 7428 292c  sertEqual(set(),
+00009f30: 2062 6c61 636b 2e67 6574 5f66 7574 7572   black.get_futur
+00009f40: 655f 696d 706f 7274 7328 6e6f 6465 2929  e_imports(node))
+00009f50: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
+00009f60: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
+00009f70: 7273 6528 0a20 2020 2020 2020 2020 2020  rse(.           
+00009f80: 2022 6672 6f6d 205f 5f66 7574 7572 655f   "from __future_
+00009f90: 5f20 696d 706f 7274 2075 6e69 636f 6465  _ import unicode
+00009fa0: 5f6c 6974 6572 616c 7320 6173 205f 756e  _literals as _un
+00009fb0: 6963 6f64 655f 6c69 7465 7261 6c73 220a  icode_literals".
+00009fc0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00009fd0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00009fe0: 616c 287b 2275 6e69 636f 6465 5f6c 6974  al({"unicode_lit
+00009ff0: 6572 616c 7322 7d2c 2062 6c61 636b 2e67  erals"}, black.g
+0000a000: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
+0000a010: 7328 6e6f 6465 2929 0a20 2020 2020 2020  s(node)).       
+0000a020: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
+0000a030: 6232 746f 335f 7061 7273 6528 0a20 2020  b2to3_parse(.   
+0000a040: 2020 2020 2020 2020 2022 6672 6f6d 205f           "from _
+0000a050: 5f66 7574 7572 655f 5f20 696d 706f 7274  _future__ import
+0000a060: 2075 6e69 636f 6465 5f6c 6974 6572 616c   unicode_literal
+0000a070: 7320 6173 205f 6c6f 6c2c 2070 7269 6e74  s as _lol, print
+0000a080: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
+0000a090: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000a0a0: 7175 616c 287b 2275 6e69 636f 6465 5f6c  qual({"unicode_l
+0000a0b0: 6974 6572 616c 7322 2c20 2270 7269 6e74  iterals", "print
+0000a0c0: 227d 2c20 626c 6163 6b2e 6765 745f 6675  "}, black.get_fu
+0000a0d0: 7475 7265 5f69 6d70 6f72 7473 286e 6f64  ture_imports(nod
+0000a0e0: 6529 290a 0a20 2020 2040 7079 7465 7374  e))..    @pytest
+0000a0f0: 2e6d 6172 6b2e 696e 636f 6d70 6174 6962  .mark.incompatib
+0000a100: 6c65 5f77 6974 685f 6d79 7079 630a 2020  le_with_mypyc.  
+0000a110: 2020 6465 6620 7465 7374 5f64 6562 7567    def test_debug
+0000a120: 5f76 6973 6974 6f72 2873 656c 6629 202d  _visitor(self) -
+0000a130: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000a140: 736f 7572 6365 2c20 5f20 3d20 7265 6164  source, _ = read
+0000a150: 5f64 6174 6128 226d 6973 6365 6c6c 616e  _data("miscellan
+0000a160: 656f 7573 222c 2022 6465 6275 675f 7669  eous", "debug_vi
+0000a170: 7369 746f 7222 290a 2020 2020 2020 2020  sitor").        
+0000a180: 6578 7065 6374 6564 2c20 5f20 3d20 7265  expected, _ = re
+0000a190: 6164 5f64 6174 6128 226d 6973 6365 6c6c  ad_data("miscell
+0000a1a0: 616e 656f 7573 222c 2022 6465 6275 675f  aneous", "debug_
+0000a1b0: 7669 7369 746f 722e 6f75 7422 290a 2020  visitor.out").  
+0000a1c0: 2020 2020 2020 6f75 745f 6c69 6e65 7320        out_lines 
+0000a1d0: 3d20 5b5d 0a20 2020 2020 2020 2065 7272  = [].        err
+0000a1e0: 5f6c 696e 6573 203d 205b 5d0a 0a20 2020  _lines = []..   
+0000a1f0: 2020 2020 2064 6566 206f 7574 286d 7367       def out(msg
+0000a200: 3a20 7374 722c 202a 2a6b 7761 7267 733a  : str, **kwargs:
+0000a210: 2041 6e79 2920 2d3e 204e 6f6e 653a 0a20   Any) -> None:. 
+0000a220: 2020 2020 2020 2020 2020 206f 7574 5f6c             out_l
+0000a230: 696e 6573 2e61 7070 656e 6428 6d73 6729  ines.append(msg)
+0000a240: 0a0a 2020 2020 2020 2020 6465 6620 6572  ..        def er
+0000a250: 7228 6d73 673a 2073 7472 2c20 2a2a 6b77  r(msg: str, **kw
+0000a260: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
+0000a270: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000a280: 6572 725f 6c69 6e65 732e 6170 7065 6e64  err_lines.append
+0000a290: 286d 7367 290a 0a20 2020 2020 2020 2077  (msg)..        w
+0000a2a0: 6974 6820 7061 7463 6828 2262 6c61 636b  ith patch("black
+0000a2b0: 2e64 6562 7567 2e6f 7574 222c 206f 7574  .debug.out", out
+0000a2c0: 293a 0a20 2020 2020 2020 2020 2020 2044  ):.            D
+0000a2d0: 6562 7567 5669 7369 746f 722e 7368 6f77  ebugVisitor.show
+0000a2e0: 2873 6f75 7263 6529 0a20 2020 2020 2020  (source).       
+0000a2f0: 2061 6374 7561 6c20 3d20 225c 6e22 2e6a   actual = "\n".j
+0000a300: 6f69 6e28 6f75 745f 6c69 6e65 7329 202b  oin(out_lines) +
+0000a310: 2022 5c6e 220a 2020 2020 2020 2020 6c6f   "\n".        lo
+0000a320: 675f 6e61 6d65 203d 2022 220a 2020 2020  g_name = "".    
+0000a330: 2020 2020 6966 2065 7870 6563 7465 6420      if expected 
+0000a340: 213d 2061 6374 7561 6c3a 0a20 2020 2020  != actual:.     
+0000a350: 2020 2020 2020 206c 6f67 5f6e 616d 6520         log_name 
+0000a360: 3d20 626c 6163 6b2e 6475 6d70 5f74 6f5f  = black.dump_to_
+0000a370: 6669 6c65 282a 6f75 745f 6c69 6e65 7329  file(*out_lines)
+0000a380: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000a390: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
+0000a3a0: 2020 2020 2020 2065 7870 6563 7465 642c         expected,
+0000a3b0: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
+0000a3c0: 7561 6c2c 0a20 2020 2020 2020 2020 2020  ual,.           
+0000a3d0: 2066 2241 5354 2070 7269 6e74 206f 7574   f"AST print out
+0000a3e0: 2069 7320 6469 6666 6572 656e 742e 2041   is different. A
+0000a3f0: 6374 7561 6c20 7665 7273 696f 6e20 6475  ctual version du
+0000a400: 6d70 6564 2074 6f20 7b6c 6f67 5f6e 616d  mped to {log_nam
+0000a410: 657d 222c 0a20 2020 2020 2020 2029 0a0a  e}",.        )..
+0000a420: 2020 2020 6465 6620 7465 7374 5f66 6f72      def test_for
+0000a430: 6d61 745f 6669 6c65 5f63 6f6e 7465 6e74  mat_file_content
+0000a440: 7328 7365 6c66 2920 2d3e 204e 6f6e 653a  s(self) -> None:
+0000a450: 0a20 2020 2020 2020 206d 6f64 6520 3d20  .        mode = 
+0000a460: 4445 4641 554c 545f 4d4f 4445 0a20 2020  DEFAULT_MODE.   
+0000a470: 2020 2020 2065 6d70 7479 203d 2022 220a       empty = "".
+0000a480: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+0000a490: 662e 6173 7365 7274 5261 6973 6573 2862  f.assertRaises(b
+0000a4a0: 6c61 636b 2e4e 6f74 6869 6e67 4368 616e  lack.NothingChan
+0000a4b0: 6765 6429 3a0a 2020 2020 2020 2020 2020  ged):.          
+0000a4c0: 2020 626c 6163 6b2e 666f 726d 6174 5f66    black.format_f
+0000a4d0: 696c 655f 636f 6e74 656e 7473 2865 6d70  ile_contents(emp
+0000a4e0: 7479 2c20 6d6f 6465 3d6d 6f64 652c 2066  ty, mode=mode, f
+0000a4f0: 6173 743d 4661 6c73 6529 0a20 2020 2020  ast=False).     
+0000a500: 2020 206a 7573 745f 6e6c 203d 2022 5c6e     just_nl = "\n
+0000a510: 220a 2020 2020 2020 2020 7769 7468 2073  ".        with s
+0000a520: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
+0000a530: 2862 6c61 636b 2e4e 6f74 6869 6e67 4368  (black.NothingCh
+0000a540: 616e 6765 6429 3a0a 2020 2020 2020 2020  anged):.        
+0000a550: 2020 2020 626c 6163 6b2e 666f 726d 6174      black.format
+0000a560: 5f66 696c 655f 636f 6e74 656e 7473 286a  _file_contents(j
+0000a570: 7573 745f 6e6c 2c20 6d6f 6465 3d6d 6f64  ust_nl, mode=mod
+0000a580: 652c 2066 6173 743d 4661 6c73 6529 0a20  e, fast=False). 
+0000a590: 2020 2020 2020 2073 616d 6520 3d20 226a         same = "j
+0000a5a0: 203d 205b 312c 2032 2c20 335d 5c6e 220a   = [1, 2, 3]\n".
+0000a5b0: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+0000a5c0: 662e 6173 7365 7274 5261 6973 6573 2862  f.assertRaises(b
+0000a5d0: 6c61 636b 2e4e 6f74 6869 6e67 4368 616e  lack.NothingChan
+0000a5e0: 6765 6429 3a0a 2020 2020 2020 2020 2020  ged):.          
+0000a5f0: 2020 626c 6163 6b2e 666f 726d 6174 5f66    black.format_f
+0000a600: 696c 655f 636f 6e74 656e 7473 2873 616d  ile_contents(sam
+0000a610: 652c 206d 6f64 653d 6d6f 6465 2c20 6661  e, mode=mode, fa
+0000a620: 7374 3d46 616c 7365 290a 2020 2020 2020  st=False).      
+0000a630: 2020 6469 6666 6572 656e 7420 3d20 226a    different = "j
+0000a640: 203d 205b 312c 322c 335d 220a 2020 2020   = [1,2,3]".    
+0000a650: 2020 2020 6578 7065 6374 6564 203d 2073      expected = s
+0000a660: 616d 650a 2020 2020 2020 2020 6163 7475  ame.        actu
+0000a670: 616c 203d 2062 6c61 636b 2e66 6f72 6d61  al = black.forma
+0000a680: 745f 6669 6c65 5f63 6f6e 7465 6e74 7328  t_file_contents(
+0000a690: 6469 6666 6572 656e 742c 206d 6f64 653d  different, mode=
+0000a6a0: 6d6f 6465 2c20 6661 7374 3d46 616c 7365  mode, fast=False
+0000a6b0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000a6c0: 7373 6572 7445 7175 616c 2865 7870 6563  ssertEqual(expec
+0000a6d0: 7465 642c 2061 6374 7561 6c29 0a20 2020  ted, actual).   
+0000a6e0: 2020 2020 2069 6e76 616c 6964 203d 2022       invalid = "
+0000a6f0: 7265 7475 726e 2069 6620 796f 7520 6361  return if you ca
+0000a700: 6e22 0a20 2020 2020 2020 2077 6974 6820  n".        with 
+0000a710: 7365 6c66 2e61 7373 6572 7452 6169 7365  self.assertRaise
+0000a720: 7328 626c 6163 6b2e 496e 7661 6c69 6449  s(black.InvalidI
+0000a730: 6e70 7574 2920 6173 2065 3a0a 2020 2020  nput) as e:.    
+0000a740: 2020 2020 2020 2020 626c 6163 6b2e 666f          black.fo
+0000a750: 726d 6174 5f66 696c 655f 636f 6e74 656e  rmat_file_conten
+0000a760: 7473 2869 6e76 616c 6964 2c20 6d6f 6465  ts(invalid, mode
+0000a770: 3d6d 6f64 652c 2066 6173 743d 4661 6c73  =mode, fast=Fals
+0000a780: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
+0000a790: 6173 7365 7274 4571 7561 6c28 7374 7228  assertEqual(str(
+0000a7a0: 652e 6578 6365 7074 696f 6e29 2c20 2243  e.exception), "C
+0000a7b0: 616e 6e6f 7420 7061 7273 653a 2031 3a37  annot parse: 1:7
+0000a7c0: 3a20 7265 7475 726e 2069 6620 796f 7520  : return if you 
+0000a7d0: 6361 6e22 290a 0a20 2020 2020 2020 206a  can")..        j
+0000a7e0: 7573 745f 6372 6c66 203d 2022 5c72 5c6e  ust_crlf = "\r\n
+0000a7f0: 220a 2020 2020 2020 2020 7769 7468 2073  ".        with s
+0000a800: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
+0000a810: 2862 6c61 636b 2e4e 6f74 6869 6e67 4368  (black.NothingCh
+0000a820: 616e 6765 6429 3a0a 2020 2020 2020 2020  anged):.        
+0000a830: 2020 2020 626c 6163 6b2e 666f 726d 6174      black.format
+0000a840: 5f66 696c 655f 636f 6e74 656e 7473 286a  _file_contents(j
+0000a850: 7573 745f 6372 6c66 2c20 6d6f 6465 3d6d  ust_crlf, mode=m
+0000a860: 6f64 652c 2066 6173 743d 4661 6c73 6529  ode, fast=False)
+0000a870: 0a20 2020 2020 2020 206a 7573 745f 7768  .        just_wh
+0000a880: 6974 6573 7061 6365 5f6e 6c20 3d20 225c  itespace_nl = "\
+0000a890: 6e5c 745c 6e20 5c6e 5c74 205c 6e20 5c74  n\t\n \n\t \n \t
+0000a8a0: 5c6e 5c6e 220a 2020 2020 2020 2020 6163  \n\n".        ac
+0000a8b0: 7475 616c 203d 2062 6c61 636b 2e66 6f72  tual = black.for
+0000a8c0: 6d61 745f 6669 6c65 5f63 6f6e 7465 6e74  mat_file_content
+0000a8d0: 7328 6a75 7374 5f77 6869 7465 7370 6163  s(just_whitespac
+0000a8e0: 655f 6e6c 2c20 6d6f 6465 3d6d 6f64 652c  e_nl, mode=mode,
+0000a8f0: 2066 6173 743d 4661 6c73 6529 0a20 2020   fast=False).   
+0000a900: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000a910: 4571 7561 6c28 225c 6e22 2c20 6163 7475  Equal("\n", actu
+0000a920: 616c 290a 2020 2020 2020 2020 6a75 7374  al).        just
+0000a930: 5f77 6869 7465 7370 6163 655f 6372 6c66  _whitespace_crlf
+0000a940: 203d 2022 5c72 5c6e 5c74 5c72 5c6e 205c   = "\r\n\t\r\n \
+0000a950: 725c 6e5c 7420 5c72 5c6e 205c 745c 725c  r\n\t \r\n \t\r\
+0000a960: 6e5c 725c 6e22 0a20 2020 2020 2020 2061  n\r\n".        a
+0000a970: 6374 7561 6c20 3d20 626c 6163 6b2e 666f  ctual = black.fo
+0000a980: 726d 6174 5f66 696c 655f 636f 6e74 656e  rmat_file_conten
+0000a990: 7473 286a 7573 745f 7768 6974 6573 7061  ts(just_whitespa
+0000a9a0: 6365 5f63 726c 662c 206d 6f64 653d 6d6f  ce_crlf, mode=mo
+0000a9b0: 6465 2c20 6661 7374 3d46 616c 7365 290a  de, fast=False).
+0000a9c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000a9d0: 6572 7445 7175 616c 2822 5c72 5c6e 222c  ertEqual("\r\n",
+0000a9e0: 2061 6374 7561 6c29 0a0a 2020 2020 6465   actual)..    de
+0000a9f0: 6620 7465 7374 5f65 6e64 6d61 726b 6572  f test_endmarker
+0000aa00: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0000aa10: 2020 2020 2020 2020 6e20 3d20 626c 6163          n = blac
+0000aa20: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
+0000aa30: 225c 6e22 290a 2020 2020 2020 2020 7365  "\n").        se
+0000aa40: 6c66 2e61 7373 6572 7445 7175 616c 286e  lf.assertEqual(n
+0000aa50: 2e74 7970 652c 2062 6c61 636b 2e73 796d  .type, black.sym
+0000aa60: 732e 6669 6c65 5f69 6e70 7574 290a 2020  s.file_input).  
+0000aa70: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000aa80: 7445 7175 616c 286c 656e 286e 2e63 6869  tEqual(len(n.chi
+0000aa90: 6c64 7265 6e29 2c20 3129 0a20 2020 2020  ldren), 1).     
+0000aaa0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000aab0: 7561 6c28 6e2e 6368 696c 6472 656e 5b30  ual(n.children[0
+0000aac0: 5d2e 7479 7065 2c20 626c 6163 6b2e 746f  ].type, black.to
+0000aad0: 6b65 6e2e 454e 444d 4152 4b45 5229 0a0a  ken.ENDMARKER)..
+0000aae0: 2020 2020 4070 6174 6368 2822 7465 7374      @patch("test
+0000aaf0: 732e 636f 6e66 7465 7374 2e50 5249 4e54  s.conftest.PRINT
+0000ab00: 5f46 554c 4c5f 5452 4545 222c 2054 7275  _FULL_TREE", Tru
+0000ab10: 6529 0a20 2020 2040 7061 7463 6828 2274  e).    @patch("t
+0000ab20: 6573 7473 2e63 6f6e 6674 6573 742e 5052  ests.conftest.PR
+0000ab30: 494e 545f 5452 4545 5f44 4946 4622 2c20  INT_TREE_DIFF", 
+0000ab40: 4661 6c73 6529 0a20 2020 2040 7079 7465  False).    @pyte
+0000ab50: 7374 2e6d 6172 6b2e 696e 636f 6d70 6174  st.mark.incompat
+0000ab60: 6962 6c65 5f77 6974 685f 6d79 7079 630a  ible_with_mypyc.
+0000ab70: 2020 2020 6465 6620 7465 7374 5f61 7373      def test_ass
+0000ab80: 6572 7446 6f72 6d61 7445 7175 616c 5f70  ertFormatEqual_p
+0000ab90: 7269 6e74 5f66 756c 6c5f 7472 6565 2873  rint_full_tree(s
+0000aba0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+0000abb0: 2020 2020 2020 6f75 745f 6c69 6e65 7320        out_lines 
+0000abc0: 3d20 5b5d 0a20 2020 2020 2020 2065 7272  = [].        err
+0000abd0: 5f6c 696e 6573 203d 205b 5d0a 0a20 2020  _lines = []..   
+0000abe0: 2020 2020 2064 6566 206f 7574 286d 7367       def out(msg
+0000abf0: 3a20 7374 722c 202a 2a6b 7761 7267 733a  : str, **kwargs:
+0000ac00: 2041 6e79 2920 2d3e 204e 6f6e 653a 0a20   Any) -> None:. 
+0000ac10: 2020 2020 2020 2020 2020 206f 7574 5f6c             out_l
+0000ac20: 696e 6573 2e61 7070 656e 6428 6d73 6729  ines.append(msg)
+0000ac30: 0a0a 2020 2020 2020 2020 6465 6620 6572  ..        def er
+0000ac40: 7228 6d73 673a 2073 7472 2c20 2a2a 6b77  r(msg: str, **kw
+0000ac50: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
+0000ac60: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000ac70: 6572 725f 6c69 6e65 732e 6170 7065 6e64  err_lines.append
+0000ac80: 286d 7367 290a 0a20 2020 2020 2020 2077  (msg)..        w
+0000ac90: 6974 6820 7061 7463 6828 2262 6c61 636b  ith patch("black
+0000aca0: 2e6f 7574 7075 742e 5f6f 7574 222c 206f  .output._out", o
+0000acb0: 7574 292c 2070 6174 6368 2822 626c 6163  ut), patch("blac
+0000acc0: 6b2e 6f75 7470 7574 2e5f 6572 7222 2c20  k.output._err", 
+0000acd0: 6572 7229 3a0a 2020 2020 2020 2020 2020  err):.          
+0000ace0: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
+0000acf0: 7274 5261 6973 6573 2841 7373 6572 7469  rtRaises(Asserti
+0000ad00: 6f6e 4572 726f 7229 3a0a 2020 2020 2020  onError):.      
+0000ad10: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0000ad20: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
+0000ad30: 2822 6a20 3d20 5b31 2c20 322c 2033 5d22  ("j = [1, 2, 3]"
+0000ad40: 2c20 226a 203d 205b 312c 2032 2c20 332c  , "j = [1, 2, 3,
+0000ad50: 5d22 290a 0a20 2020 2020 2020 206f 7574  ]")..        out
+0000ad60: 5f73 7472 203d 2022 222e 6a6f 696e 286f  _str = "".join(o
+0000ad70: 7574 5f6c 696e 6573 290a 2020 2020 2020  ut_lines).      
+0000ad80: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
+0000ad90: 2245 7870 6563 7465 6420 7472 6565 3a22  "Expected tree:"
+0000ada0: 2c20 6f75 745f 7374 7229 0a20 2020 2020  , out_str).     
+0000adb0: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+0000adc0: 2822 4163 7475 616c 2074 7265 653a 222c  ("Actual tree:",
+0000add0: 206f 7574 5f73 7472 290a 2020 2020 2020   out_str).      
+0000ade0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000adf0: 616c 2822 222e 6a6f 696e 2865 7272 5f6c  al("".join(err_l
+0000ae00: 696e 6573 292c 2022 2229 0a0a 2020 2020  ines), "")..    
+0000ae10: 4070 6174 6368 2822 7465 7374 732e 636f  @patch("tests.co
+0000ae20: 6e66 7465 7374 2e50 5249 4e54 5f46 554c  nftest.PRINT_FUL
+0000ae30: 4c5f 5452 4545 222c 2046 616c 7365 290a  L_TREE", False).
+0000ae40: 2020 2020 4070 6174 6368 2822 7465 7374      @patch("test
+0000ae50: 732e 636f 6e66 7465 7374 2e50 5249 4e54  s.conftest.PRINT
+0000ae60: 5f54 5245 455f 4449 4646 222c 2054 7275  _TREE_DIFF", Tru
+0000ae70: 6529 0a20 2020 2040 7079 7465 7374 2e6d  e).    @pytest.m
+0000ae80: 6172 6b2e 696e 636f 6d70 6174 6962 6c65  ark.incompatible
+0000ae90: 5f77 6974 685f 6d79 7079 630a 2020 2020  _with_mypyc.    
+0000aea0: 6465 6620 7465 7374 5f61 7373 6572 7446  def test_assertF
+0000aeb0: 6f72 6d61 7445 7175 616c 5f70 7269 6e74  ormatEqual_print
+0000aec0: 5f74 7265 655f 6469 6666 2873 656c 6629  _tree_diff(self)
+0000aed0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000aee0: 2020 6f75 745f 6c69 6e65 7320 3d20 5b5d    out_lines = []
+0000aef0: 0a20 2020 2020 2020 2065 7272 5f6c 696e  .        err_lin
+0000af00: 6573 203d 205b 5d0a 0a20 2020 2020 2020  es = []..       
+0000af10: 2064 6566 206f 7574 286d 7367 3a20 7374   def out(msg: st
+0000af20: 722c 202a 2a6b 7761 7267 733a 2041 6e79  r, **kwargs: Any
+0000af30: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000af40: 2020 2020 2020 206f 7574 5f6c 696e 6573         out_lines
+0000af50: 2e61 7070 656e 6428 6d73 6729 0a0a 2020  .append(msg)..  
+0000af60: 2020 2020 2020 6465 6620 6572 7228 6d73        def err(ms
+0000af70: 673a 2073 7472 2c20 2a2a 6b77 6172 6773  g: str, **kwargs
+0000af80: 3a20 416e 7929 202d 3e20 4e6f 6e65 3a0a  : Any) -> None:.
+0000af90: 2020 2020 2020 2020 2020 2020 6572 725f              err_
+0000afa0: 6c69 6e65 732e 6170 7065 6e64 286d 7367  lines.append(msg
+0000afb0: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
+0000afc0: 7061 7463 6828 2262 6c61 636b 2e6f 7574  patch("black.out
+0000afd0: 7075 742e 5f6f 7574 222c 206f 7574 292c  put._out", out),
+0000afe0: 2070 6174 6368 2822 626c 6163 6b2e 6f75   patch("black.ou
+0000aff0: 7470 7574 2e5f 6572 7222 2c20 6572 7229  tput._err", err)
+0000b000: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
+0000b010: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+0000b020: 6973 6573 2841 7373 6572 7469 6f6e 4572  ises(AssertionEr
+0000b030: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
+0000b040: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000b050: 7446 6f72 6d61 7445 7175 616c 2822 6a20  tFormatEqual("j 
+0000b060: 3d20 5b31 2c20 322c 2033 5d5c 6e22 2c20  = [1, 2, 3]\n", 
+0000b070: 226a 203d 205b 312c 2032 2c20 332c 5d5c  "j = [1, 2, 3,]\
+0000b080: 6e22 290a 0a20 2020 2020 2020 206f 7574  n")..        out
+0000b090: 5f73 7472 203d 2022 222e 6a6f 696e 286f  _str = "".join(o
+0000b0a0: 7574 5f6c 696e 6573 290a 2020 2020 2020  ut_lines).      
+0000b0b0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
+0000b0c0: 2254 7265 6520 4469 6666 3a22 2c20 6f75  "Tree Diff:", ou
+0000b0d0: 745f 7374 7229 0a20 2020 2020 2020 2073  t_str).        s
+0000b0e0: 656c 662e 6173 7365 7274 496e 2822 2b20  elf.assertIn("+ 
+0000b0f0: 2020 2020 2020 2020 2043 4f4d 4d41 222c           COMMA",
+0000b100: 206f 7574 5f73 7472 290a 2020 2020 2020   out_str).      
+0000b110: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
+0000b120: 222b 2027 2c27 222c 206f 7574 5f73 7472  "+ ','", out_str
+0000b130: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000b140: 7373 6572 7445 7175 616c 2822 222e 6a6f  ssertEqual("".jo
+0000b150: 696e 2865 7272 5f6c 696e 6573 292c 2022  in(err_lines), "
+0000b160: 2229 0a0a 2020 2020 4065 7665 6e74 5f6c  ")..    @event_l
+0000b170: 6f6f 7028 290a 2020 2020 4070 6174 6368  oop().    @patch
+0000b180: 2822 636f 6e63 7572 7265 6e74 2e66 7574  ("concurrent.fut
+0000b190: 7572 6573 2e50 726f 6365 7373 506f 6f6c  ures.ProcessPool
+0000b1a0: 4578 6563 7574 6f72 222c 204d 6167 6963  Executor", Magic
+0000b1b0: 4d6f 636b 2873 6964 655f 6566 6665 6374  Mock(side_effect
+0000b1c0: 3d4f 5345 7272 6f72 2929 0a20 2020 2064  =OSError)).    d
+0000b1d0: 6566 2074 6573 745f 776f 726b 735f 696e  ef test_works_in
+0000b1e0: 5f6d 6f6e 6f5f 7072 6f63 6573 735f 6f6e  _mono_process_on
+0000b1f0: 6c79 5f65 6e76 6972 6f6e 6d65 6e74 2873  ly_environment(s
+0000b200: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+0000b210: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
+0000b220: 5f64 6972 2829 2061 7320 776f 726b 7370  _dir() as worksp
+0000b230: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
+0000b240: 2066 6f72 2066 2069 6e20 5b0a 2020 2020   for f in [.    
+0000b250: 2020 2020 2020 2020 2020 2020 2877 6f72              (wor
+0000b260: 6b73 7061 6365 202f 2022 6f6e 652e 7079  kspace / "one.py
+0000b270: 2229 2e72 6573 6f6c 7665 2829 2c0a 2020  ").resolve(),.  
+0000b280: 2020 2020 2020 2020 2020 2020 2020 2877                (w
+0000b290: 6f72 6b73 7061 6365 202f 2022 7477 6f2e  orkspace / "two.
+0000b2a0: 7079 2229 2e72 6573 6f6c 7665 2829 2c0a  py").resolve(),.
+0000b2b0: 2020 2020 2020 2020 2020 2020 5d3a 0a20              ]:. 
+0000b2c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000b2d0: 2e77 7269 7465 5f74 6578 7428 2770 7269  .write_text('pri
+0000b2e0: 6e74 2822 6865 6c6c 6f22 295c 6e27 2c20  nt("hello")\n', 
+0000b2f0: 656e 636f 6469 6e67 3d22 7574 662d 3822  encoding="utf-8"
+0000b300: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0000b310: 6c66 2e69 6e76 6f6b 6542 6c61 636b 285b  lf.invokeBlack([
+0000b320: 7374 7228 776f 726b 7370 6163 6529 5d29  str(workspace)])
+0000b330: 0a0a 2020 2020 4065 7665 6e74 5f6c 6f6f  ..    @event_loo
+0000b340: 7028 290a 2020 2020 6465 6620 7465 7374  p().    def test
+0000b350: 5f63 6865 636b 5f64 6966 665f 7573 655f  _check_diff_use_
+0000b360: 746f 6765 7468 6572 2873 656c 6629 202d  together(self) -
+0000b370: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000b380: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
+0000b390: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0000b3a0: 4669 6c65 7320 7768 6963 6820 7769 6c6c  Files which will
+0000b3b0: 2062 6520 7265 666f 726d 6174 7465 642e   be reformatted.
+0000b3c0: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
+0000b3d0: 3120 3d20 6765 745f 6361 7365 5f70 6174  1 = get_case_pat
+0000b3e0: 6828 226d 6973 6365 6c6c 616e 656f 7573  h("miscellaneous
+0000b3f0: 222c 2022 7374 7269 6e67 5f71 756f 7465  ", "string_quote
+0000b400: 7322 290a 2020 2020 2020 2020 2020 2020  s").            
+0000b410: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
+0000b420: 285b 7374 7228 7372 6331 292c 2022 2d2d  ([str(src1), "--
+0000b430: 6469 6666 222c 2022 2d2d 6368 6563 6b22  diff", "--check"
+0000b440: 5d2c 2065 7869 745f 636f 6465 3d31 290a  ], exit_code=1).
+0000b450: 2020 2020 2020 2020 2020 2020 2320 4669              # Fi
+0000b460: 6c65 7320 7768 6963 6820 7769 6c6c 206e  les which will n
+0000b470: 6f74 2062 6520 7265 666f 726d 6174 7465  ot be reformatte
+0000b480: 642e 0a20 2020 2020 2020 2020 2020 2073  d..            s
+0000b490: 7263 3220 3d20 6765 745f 6361 7365 5f70  rc2 = get_case_p
+0000b4a0: 6174 6828 2263 6173 6573 222c 2022 636f  ath("cases", "co
+0000b4b0: 6d70 6f73 6974 696f 6e22 290a 2020 2020  mposition").    
+0000b4c0: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
+0000b4d0: 6f6b 6542 6c61 636b 285b 7374 7228 7372  okeBlack([str(sr
+0000b4e0: 6332 292c 2022 2d2d 6469 6666 222c 2022  c2), "--diff", "
+0000b4f0: 2d2d 6368 6563 6b22 5d29 0a20 2020 2020  --check"]).     
+0000b500: 2020 2020 2020 2023 204d 756c 7469 2066         # Multi f
+0000b510: 696c 6520 636f 6d6d 616e 642e 0a20 2020  ile command..   
+0000b520: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
+0000b530: 766f 6b65 426c 6163 6b28 5b73 7472 2873  vokeBlack([str(s
+0000b540: 7263 3129 2c20 7374 7228 7372 6332 292c  rc1), str(src2),
+0000b550: 2022 2d2d 6469 6666 222c 2022 2d2d 6368   "--diff", "--ch
+0000b560: 6563 6b22 5d2c 2065 7869 745f 636f 6465  eck"], exit_code
+0000b570: 3d31 290a 0a20 2020 2064 6566 2074 6573  =1)..    def tes
+0000b580: 745f 6e6f 5f73 7263 5f66 6169 6c73 2873  t_no_src_fails(s
+0000b590: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+0000b5a0: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
+0000b5b0: 5f64 6972 2829 3a0a 2020 2020 2020 2020  _dir():.        
+0000b5c0: 2020 2020 7365 6c66 2e69 6e76 6f6b 6542      self.invokeB
+0000b5d0: 6c61 636b 285b 5d2c 2065 7869 745f 636f  lack([], exit_co
+0000b5e0: 6465 3d31 290a 0a20 2020 2064 6566 2074  de=1)..    def t
+0000b5f0: 6573 745f 7372 635f 616e 645f 636f 6465  est_src_and_code
+0000b600: 5f66 6169 6c73 2873 656c 6629 202d 3e20  _fails(self) -> 
+0000b610: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
+0000b620: 7468 2063 6163 6865 5f64 6972 2829 3a0a  th cache_dir():.
+0000b630: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000b640: 2e69 6e76 6f6b 6542 6c61 636b 285b 222e  .invokeBlack([".
+0000b650: 222c 2022 2d63 222c 2022 3022 5d2c 2065  ", "-c", "0"], e
+0000b660: 7869 745f 636f 6465 3d31 290a 0a20 2020  xit_code=1)..   
+0000b670: 2064 6566 2074 6573 745f 6272 6f6b 656e   def test_broken
+0000b680: 5f73 796d 6c69 6e6b 2873 656c 6629 202d  _symlink(self) -
+0000b690: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000b6a0: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
+0000b6b0: 2061 7320 776f 726b 7370 6163 653a 0a20   as workspace:. 
+0000b6c0: 2020 2020 2020 2020 2020 2073 796d 6c69             symli
+0000b6d0: 6e6b 203d 2077 6f72 6b73 7061 6365 202f  nk = workspace /
+0000b6e0: 2022 6272 6f6b 656e 5f6c 696e 6b2e 7079   "broken_link.py
+0000b6f0: 220a 2020 2020 2020 2020 2020 2020 7472  ".            tr
+0000b700: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0000b710: 2020 2073 796d 6c69 6e6b 2e73 796d 6c69     symlink.symli
+0000b720: 6e6b 5f74 6f28 226e 6f6e 6578 6973 7465  nk_to("nonexiste
+0000b730: 6e74 2e70 7922 290a 2020 2020 2020 2020  nt.py").        
+0000b740: 2020 2020 6578 6365 7074 2028 4f53 4572      except (OSEr
+0000b750: 726f 722c 204e 6f74 496d 706c 656d 656e  ror, NotImplemen
+0000b760: 7465 6445 7272 6f72 2920 6173 2065 3a0a  tedError) as e:.
+0000b770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b780: 7365 6c66 2e73 6b69 7054 6573 7428 6622  self.skipTest(f"
+0000b790: 4361 6e27 7420 6372 6561 7465 2073 796d  Can't create sym
+0000b7a0: 6c69 6e6b 733a 207b 657d 2229 0a20 2020  links: {e}").   
+0000b7b0: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
+0000b7c0: 766f 6b65 426c 6163 6b28 5b73 7472 2877  vokeBlack([str(w
+0000b7d0: 6f72 6b73 7061 6365 2e72 6573 6f6c 7665  orkspace.resolve
+0000b7e0: 2829 295d 290a 0a20 2020 2064 6566 2074  ())])..    def t
+0000b7f0: 6573 745f 7369 6e67 6c65 5f66 696c 655f  est_single_file_
+0000b800: 666f 7263 655f 7079 6928 7365 6c66 2920  force_pyi(self) 
+0000b810: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000b820: 2070 7969 5f6d 6f64 6520 3d20 7265 706c   pyi_mode = repl
+0000b830: 6163 6528 4445 4641 554c 545f 4d4f 4445  ace(DEFAULT_MODE
+0000b840: 2c20 6973 5f70 7969 3d54 7275 6529 0a20  , is_pyi=True). 
+0000b850: 2020 2020 2020 2063 6f6e 7465 6e74 732c         contents,
+0000b860: 2065 7870 6563 7465 6420 3d20 7265 6164   expected = read
+0000b870: 5f64 6174 6128 226d 6973 6365 6c6c 616e  _data("miscellan
+0000b880: 656f 7573 222c 2022 666f 7263 655f 7079  eous", "force_py
+0000b890: 6922 290a 2020 2020 2020 2020 7769 7468  i").        with
+0000b8a0: 2063 6163 6865 5f64 6972 2829 2061 7320   cache_dir() as 
+0000b8b0: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
+0000b8c0: 2020 2020 2020 2070 6174 6820 3d20 2877         path = (w
+0000b8d0: 6f72 6b73 7061 6365 202f 2022 6669 6c65  orkspace / "file
+0000b8e0: 2e70 7922 292e 7265 736f 6c76 6528 290a  .py").resolve().
+0000b8f0: 2020 2020 2020 2020 2020 2020 7061 7468              path
+0000b900: 2e77 7269 7465 5f74 6578 7428 636f 6e74  .write_text(cont
+0000b910: 656e 7473 2c20 656e 636f 6469 6e67 3d22  ents, encoding="
+0000b920: 7574 662d 3822 290a 2020 2020 2020 2020  utf-8").        
+0000b930: 2020 2020 7365 6c66 2e69 6e76 6f6b 6542      self.invokeB
+0000b940: 6c61 636b 285b 7374 7228 7061 7468 292c  lack([str(path),
+0000b950: 2022 2d2d 7079 6922 5d29 0a20 2020 2020   "--pyi"]).     
+0000b960: 2020 2020 2020 2061 6374 7561 6c20 3d20         actual = 
+0000b970: 7061 7468 2e72 6561 645f 7465 7874 2865  path.read_text(e
+0000b980: 6e63 6f64 696e 673d 2275 7466 2d38 2229  ncoding="utf-8")
+0000b990: 0a20 2020 2020 2020 2020 2020 2023 2076  .            # v
+0000b9a0: 6572 6966 7920 6361 6368 6520 7769 7468  erify cache with
+0000b9b0: 202d 2d70 7969 2069 7320 7365 7061 7261   --pyi is separa
+0000b9c0: 7465 0a20 2020 2020 2020 2020 2020 2070  te.            p
+0000b9d0: 7969 5f63 6163 6865 203d 2062 6c61 636b  yi_cache = black
+0000b9e0: 2e43 6163 6865 2e72 6561 6428 7079 695f  .Cache.read(pyi_
+0000b9f0: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
+0000ba00: 2020 6173 7365 7274 206e 6f74 2070 7969    assert not pyi
+0000ba10: 5f63 6163 6865 2e69 735f 6368 616e 6765  _cache.is_change
+0000ba20: 6428 7061 7468 290a 2020 2020 2020 2020  d(path).        
+0000ba30: 2020 2020 6e6f 726d 616c 5f63 6163 6865      normal_cache
+0000ba40: 203d 2062 6c61 636b 2e43 6163 6865 2e72   = black.Cache.r
+0000ba50: 6561 6428 4445 4641 554c 545f 4d4f 4445  ead(DEFAULT_MODE
+0000ba60: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+0000ba70: 7365 7274 206e 6f72 6d61 6c5f 6361 6368  sert normal_cach
+0000ba80: 652e 6973 5f63 6861 6e67 6564 2870 6174  e.is_changed(pat
+0000ba90: 6829 0a20 2020 2020 2020 2073 656c 662e  h).        self.
+0000baa0: 6173 7365 7274 466f 726d 6174 4571 7561  assertFormatEqua
+0000bab0: 6c28 6578 7065 6374 6564 2c20 6163 7475  l(expected, actu
+0000bac0: 616c 290a 2020 2020 2020 2020 626c 6163  al).        blac
+0000bad0: 6b2e 6173 7365 7274 5f65 7175 6976 616c  k.assert_equival
+0000bae0: 656e 7428 636f 6e74 656e 7473 2c20 6163  ent(contents, ac
+0000baf0: 7475 616c 290a 2020 2020 2020 2020 626c  tual).        bl
+0000bb00: 6163 6b2e 6173 7365 7274 5f73 7461 626c  ack.assert_stabl
+0000bb10: 6528 636f 6e74 656e 7473 2c20 6163 7475  e(contents, actu
+0000bb20: 616c 2c20 7079 695f 6d6f 6465 290a 0a20  al, pyi_mode).. 
+0000bb30: 2020 2040 6576 656e 745f 6c6f 6f70 2829     @event_loop()
+0000bb40: 0a20 2020 2064 6566 2074 6573 745f 6d75  .    def test_mu
+0000bb50: 6c74 695f 6669 6c65 5f66 6f72 6365 5f70  lti_file_force_p
+0000bb60: 7969 2873 656c 6629 202d 3e20 4e6f 6e65  yi(self) -> None
+0000bb70: 3a0a 2020 2020 2020 2020 7265 675f 6d6f  :.        reg_mo
+0000bb80: 6465 203d 2044 4546 4155 4c54 5f4d 4f44  de = DEFAULT_MOD
+0000bb90: 450a 2020 2020 2020 2020 7079 695f 6d6f  E.        pyi_mo
+0000bba0: 6465 203d 2072 6570 6c61 6365 2844 4546  de = replace(DEF
+0000bbb0: 4155 4c54 5f4d 4f44 452c 2069 735f 7079  AULT_MODE, is_py
+0000bbc0: 693d 5472 7565 290a 2020 2020 2020 2020  i=True).        
+0000bbd0: 636f 6e74 656e 7473 2c20 6578 7065 6374  contents, expect
+0000bbe0: 6564 203d 2072 6561 645f 6461 7461 2822  ed = read_data("
+0000bbf0: 6d69 7363 656c 6c61 6e65 6f75 7322 2c20  miscellaneous", 
+0000bc00: 2266 6f72 6365 5f70 7969 2229 0a20 2020  "force_pyi").   
+0000bc10: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
+0000bc20: 6469 7228 2920 6173 2077 6f72 6b73 7061  dir() as workspa
+0000bc30: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+0000bc40: 7061 7468 7320 3d20 5b0a 2020 2020 2020  paths = [.      
+0000bc50: 2020 2020 2020 2020 2020 2877 6f72 6b73            (works
+0000bc60: 7061 6365 202f 2022 6669 6c65 312e 7079  pace / "file1.py
+0000bc70: 2229 2e72 6573 6f6c 7665 2829 2c0a 2020  ").resolve(),.  
+0000bc80: 2020 2020 2020 2020 2020 2020 2020 2877                (w
+0000bc90: 6f72 6b73 7061 6365 202f 2022 6669 6c65  orkspace / "file
+0000bca0: 322e 7079 2229 2e72 6573 6f6c 7665 2829  2.py").resolve()
+0000bcb0: 2c0a 2020 2020 2020 2020 2020 2020 5d0a  ,.            ].
+0000bcc0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000bcd0: 7061 7468 2069 6e20 7061 7468 733a 0a20  path in paths:. 
+0000bce0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000bcf0: 6174 682e 7772 6974 655f 7465 7874 2863  ath.write_text(c
+0000bd00: 6f6e 7465 6e74 732c 2065 6e63 6f64 696e  ontents, encodin
+0000bd10: 673d 2275 7466 2d38 2229 0a20 2020 2020  g="utf-8").     
+0000bd20: 2020 2020 2020 2073 656c 662e 696e 766f         self.invo
+0000bd30: 6b65 426c 6163 6b28 5b73 7472 2870 2920  keBlack([str(p) 
+0000bd40: 666f 7220 7020 696e 2070 6174 6873 5d20  for p in paths] 
+0000bd50: 2b20 5b22 2d2d 7079 6922 5d29 0a20 2020  + ["--pyi"]).   
+0000bd60: 2020 2020 2020 2020 2066 6f72 2070 6174           for pat
+0000bd70: 6820 696e 2070 6174 6873 3a0a 2020 2020  h in paths:.    
+0000bd80: 2020 2020 2020 2020 2020 2020 6163 7475              actu
+0000bd90: 616c 203d 2070 6174 682e 7265 6164 5f74  al = path.read_t
+0000bda0: 6578 7428 656e 636f 6469 6e67 3d22 7574  ext(encoding="ut
+0000bdb0: 662d 3822 290a 2020 2020 2020 2020 2020  f-8").          
+0000bdc0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000bdd0: 7445 7175 616c 2861 6374 7561 6c2c 2065  tEqual(actual, e
+0000bde0: 7870 6563 7465 6429 0a20 2020 2020 2020  xpected).       
+0000bdf0: 2020 2020 2023 2076 6572 6966 7920 6361       # verify ca
+0000be00: 6368 6520 7769 7468 202d 2d70 7969 2069  che with --pyi i
+0000be10: 7320 7365 7061 7261 7465 0a20 2020 2020  s separate.     
+0000be20: 2020 2020 2020 2070 7969 5f63 6163 6865         pyi_cache
+0000be30: 203d 2062 6c61 636b 2e43 6163 6865 2e72   = black.Cache.r
+0000be40: 6561 6428 7079 695f 6d6f 6465 290a 2020  ead(pyi_mode).  
+0000be50: 2020 2020 2020 2020 2020 6e6f 726d 616c            normal
+0000be60: 5f63 6163 6865 203d 2062 6c61 636b 2e43  _cache = black.C
+0000be70: 6163 6865 2e72 6561 6428 7265 675f 6d6f  ache.read(reg_mo
+0000be80: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
+0000be90: 666f 7220 7061 7468 2069 6e20 7061 7468  for path in path
+0000bea0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0000beb0: 2020 2061 7373 6572 7420 6e6f 7420 7079     assert not py
+0000bec0: 695f 6361 6368 652e 6973 5f63 6861 6e67  i_cache.is_chang
+0000bed0: 6564 2870 6174 6829 0a20 2020 2020 2020  ed(path).       
+0000bee0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+0000bef0: 6e6f 726d 616c 5f63 6163 6865 2e69 735f  normal_cache.is_
+0000bf00: 6368 616e 6765 6428 7061 7468 290a 0a20  changed(path).. 
+0000bf10: 2020 2064 6566 2074 6573 745f 7069 7065     def test_pipe
+0000bf20: 5f66 6f72 6365 5f70 7969 2873 656c 6629  _force_pyi(self)
+0000bf30: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000bf40: 2020 736f 7572 6365 2c20 6578 7065 6374    source, expect
+0000bf50: 6564 203d 2072 6561 645f 6461 7461 2822  ed = read_data("
+0000bf60: 6d69 7363 656c 6c61 6e65 6f75 7322 2c20  miscellaneous", 
+0000bf70: 2266 6f72 6365 5f70 7969 2229 0a20 2020  "force_pyi").   
+0000bf80: 2020 2020 2072 6573 756c 7420 3d20 436c       result = Cl
+0000bf90: 6952 756e 6e65 7228 292e 696e 766f 6b65  iRunner().invoke
+0000bfa0: 280a 2020 2020 2020 2020 2020 2020 626c  (.            bl
+0000bfb0: 6163 6b2e 6d61 696e 2c20 5b22 2d22 2c20  ack.main, ["-", 
+0000bfc0: 222d 7122 2c20 222d 2d70 7969 225d 2c20  "-q", "--pyi"], 
+0000bfd0: 696e 7075 743d 4279 7465 7349 4f28 736f  input=BytesIO(so
+0000bfe0: 7572 6365 2e65 6e63 6f64 6528 2275 7466  urce.encode("utf
+0000bff0: 2d38 2229 290a 2020 2020 2020 2020 290a  -8")).        ).
+0000c000: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000c010: 6572 7445 7175 616c 2872 6573 756c 742e  ertEqual(result.
+0000c020: 6578 6974 5f63 6f64 652c 2030 290a 2020  exit_code, 0).  
+0000c030: 2020 2020 2020 6163 7475 616c 203d 2072        actual = r
+0000c040: 6573 756c 742e 6f75 7470 7574 0a20 2020  esult.output.   
+0000c050: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000c060: 466f 726d 6174 4571 7561 6c28 6163 7475  FormatEqual(actu
+0000c070: 616c 2c20 6578 7065 6374 6564 290a 0a20  al, expected).. 
+0000c080: 2020 2064 6566 2074 6573 745f 7369 6e67     def test_sing
+0000c090: 6c65 5f66 696c 655f 666f 7263 655f 7079  le_file_force_py
+0000c0a0: 3336 2873 656c 6629 202d 3e20 4e6f 6e65  36(self) -> None
+0000c0b0: 3a0a 2020 2020 2020 2020 7265 675f 6d6f  :.        reg_mo
+0000c0c0: 6465 203d 2044 4546 4155 4c54 5f4d 4f44  de = DEFAULT_MOD
+0000c0d0: 450a 2020 2020 2020 2020 7079 3336 5f6d  E.        py36_m
+0000c0e0: 6f64 6520 3d20 7265 706c 6163 6528 4445  ode = replace(DE
+0000c0f0: 4641 554c 545f 4d4f 4445 2c20 7461 7267  FAULT_MODE, targ
+0000c100: 6574 5f76 6572 7369 6f6e 733d 5059 3336  et_versions=PY36
+0000c110: 5f56 4552 5349 4f4e 5329 0a20 2020 2020  _VERSIONS).     
+0000c120: 2020 2073 6f75 7263 652c 2065 7870 6563     source, expec
+0000c130: 7465 6420 3d20 7265 6164 5f64 6174 6128  ted = read_data(
+0000c140: 226d 6973 6365 6c6c 616e 656f 7573 222c  "miscellaneous",
+0000c150: 2022 666f 7263 655f 7079 3336 2229 0a20   "force_py36"). 
+0000c160: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
+0000c170: 655f 6469 7228 2920 6173 2077 6f72 6b73  e_dir() as works
+0000c180: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
+0000c190: 2020 7061 7468 203d 2028 776f 726b 7370    path = (worksp
+0000c1a0: 6163 6520 2f20 2266 696c 652e 7079 2229  ace / "file.py")
+0000c1b0: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
+0000c1c0: 2020 2020 2020 2070 6174 682e 7772 6974         path.writ
+0000c1d0: 655f 7465 7874 2873 6f75 7263 652c 2065  e_text(source, e
+0000c1e0: 6e63 6f64 696e 673d 2275 7466 2d38 2229  ncoding="utf-8")
+0000c1f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000c200: 662e 696e 766f 6b65 426c 6163 6b28 5b73  f.invokeBlack([s
+0000c210: 7472 2870 6174 6829 2c20 2a50 5933 365f  tr(path), *PY36_
+0000c220: 4152 4753 5d29 0a20 2020 2020 2020 2020  ARGS]).         
+0000c230: 2020 2061 6374 7561 6c20 3d20 7061 7468     actual = path
+0000c240: 2e72 6561 645f 7465 7874 2865 6e63 6f64  .read_text(encod
+0000c250: 696e 673d 2275 7466 2d38 2229 0a20 2020  ing="utf-8").   
+0000c260: 2020 2020 2020 2020 2023 2076 6572 6966           # verif
+0000c270: 7920 6361 6368 6520 7769 7468 202d 2d74  y cache with --t
+0000c280: 6172 6765 742d 7665 7273 696f 6e20 6973  arget-version is
+0000c290: 2073 6570 6172 6174 650a 2020 2020 2020   separate.      
+0000c2a0: 2020 2020 2020 7079 3336 5f63 6163 6865        py36_cache
+0000c2b0: 203d 2062 6c61 636b 2e43 6163 6865 2e72   = black.Cache.r
+0000c2c0: 6561 6428 7079 3336 5f6d 6f64 6529 0a20  ead(py36_mode). 
+0000c2d0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+0000c2e0: 7420 6e6f 7420 7079 3336 5f63 6163 6865  t not py36_cache
+0000c2f0: 2e69 735f 6368 616e 6765 6428 7061 7468  .is_changed(path
+0000c300: 290a 2020 2020 2020 2020 2020 2020 6e6f  ).            no
+0000c310: 726d 616c 5f63 6163 6865 203d 2062 6c61  rmal_cache = bla
+0000c320: 636b 2e43 6163 6865 2e72 6561 6428 7265  ck.Cache.read(re
+0000c330: 675f 6d6f 6465 290a 2020 2020 2020 2020  g_mode).        
+0000c340: 2020 2020 6173 7365 7274 206e 6f72 6d61      assert norma
+0000c350: 6c5f 6361 6368 652e 6973 5f63 6861 6e67  l_cache.is_chang
+0000c360: 6564 2870 6174 6829 0a20 2020 2020 2020  ed(path).       
+0000c370: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000c380: 6c28 6163 7475 616c 2c20 6578 7065 6374  l(actual, expect
+0000c390: 6564 290a 0a20 2020 2040 6576 656e 745f  ed)..    @event_
+0000c3a0: 6c6f 6f70 2829 0a20 2020 2064 6566 2074  loop().    def t
+0000c3b0: 6573 745f 6d75 6c74 695f 6669 6c65 5f66  est_multi_file_f
+0000c3c0: 6f72 6365 5f70 7933 3628 7365 6c66 2920  orce_py36(self) 
+0000c3d0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000c3e0: 2072 6567 5f6d 6f64 6520 3d20 4445 4641   reg_mode = DEFA
+0000c3f0: 554c 545f 4d4f 4445 0a20 2020 2020 2020  ULT_MODE.       
+0000c400: 2070 7933 365f 6d6f 6465 203d 2072 6570   py36_mode = rep
+0000c410: 6c61 6365 2844 4546 4155 4c54 5f4d 4f44  lace(DEFAULT_MOD
+0000c420: 452c 2074 6172 6765 745f 7665 7273 696f  E, target_versio
+0000c430: 6e73 3d50 5933 365f 5645 5253 494f 4e53  ns=PY36_VERSIONS
+0000c440: 290a 2020 2020 2020 2020 736f 7572 6365  ).        source
+0000c450: 2c20 6578 7065 6374 6564 203d 2072 6561  , expected = rea
+0000c460: 645f 6461 7461 2822 6d69 7363 656c 6c61  d_data("miscella
+0000c470: 6e65 6f75 7322 2c20 2266 6f72 6365 5f70  neous", "force_p
+0000c480: 7933 3622 290a 2020 2020 2020 2020 7769  y36").        wi
+0000c490: 7468 2063 6163 6865 5f64 6972 2829 2061  th cache_dir() a
+0000c4a0: 7320 776f 726b 7370 6163 653a 0a20 2020  s workspace:.   
+0000c4b0: 2020 2020 2020 2020 2070 6174 6873 203d           paths =
+0000c4c0: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+0000c4d0: 2020 2028 776f 726b 7370 6163 6520 2f20     (workspace / 
+0000c4e0: 2266 696c 6531 2e70 7922 292e 7265 736f  "file1.py").reso
+0000c4f0: 6c76 6528 292c 0a20 2020 2020 2020 2020  lve(),.         
+0000c500: 2020 2020 2020 2028 776f 726b 7370 6163         (workspac
+0000c510: 6520 2f20 2266 696c 6532 2e70 7922 292e  e / "file2.py").
+0000c520: 7265 736f 6c76 6528 292c 0a20 2020 2020  resolve(),.     
+0000c530: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+0000c540: 2020 2020 2066 6f72 2070 6174 6820 696e       for path in
+0000c550: 2070 6174 6873 3a0a 2020 2020 2020 2020   paths:.        
+0000c560: 2020 2020 2020 2020 7061 7468 2e77 7269          path.wri
+0000c570: 7465 5f74 6578 7428 736f 7572 6365 2c20  te_text(source, 
+0000c580: 656e 636f 6469 6e67 3d22 7574 662d 3822  encoding="utf-8"
+0000c590: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0000c5a0: 6c66 2e69 6e76 6f6b 6542 6c61 636b 285b  lf.invokeBlack([
+0000c5b0: 7374 7228 7029 2066 6f72 2070 2069 6e20  str(p) for p in 
+0000c5c0: 7061 7468 735d 202b 2050 5933 365f 4152  paths] + PY36_AR
+0000c5d0: 4753 290a 2020 2020 2020 2020 2020 2020  GS).            
+0000c5e0: 666f 7220 7061 7468 2069 6e20 7061 7468  for path in path
+0000c5f0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0000c600: 2020 2061 6374 7561 6c20 3d20 7061 7468     actual = path
+0000c610: 2e72 6561 645f 7465 7874 2865 6e63 6f64  .read_text(encod
+0000c620: 696e 673d 2275 7466 2d38 2229 0a20 2020  ing="utf-8").   
+0000c630: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000c640: 662e 6173 7365 7274 4571 7561 6c28 6163  f.assertEqual(ac
+0000c650: 7475 616c 2c20 6578 7065 6374 6564 290a  tual, expected).
+0000c660: 2020 2020 2020 2020 2020 2020 2320 7665              # ve
+0000c670: 7269 6679 2063 6163 6865 2077 6974 6820  rify cache with 
+0000c680: 2d2d 7461 7267 6574 2d76 6572 7369 6f6e  --target-version
+0000c690: 2069 7320 7365 7061 7261 7465 0a20 2020   is separate.   
+0000c6a0: 2020 2020 2020 2020 2070 7969 5f63 6163           pyi_cac
+0000c6b0: 6865 203d 2062 6c61 636b 2e43 6163 6865  he = black.Cache
+0000c6c0: 2e72 6561 6428 7079 3336 5f6d 6f64 6529  .read(py36_mode)
+0000c6d0: 0a20 2020 2020 2020 2020 2020 206e 6f72  .            nor
+0000c6e0: 6d61 6c5f 6361 6368 6520 3d20 626c 6163  mal_cache = blac
+0000c6f0: 6b2e 4361 6368 652e 7265 6164 2872 6567  k.Cache.read(reg
+0000c700: 5f6d 6f64 6529 0a20 2020 2020 2020 2020  _mode).         
+0000c710: 2020 2066 6f72 2070 6174 6820 696e 2070     for path in p
+0000c720: 6174 6873 3a0a 2020 2020 2020 2020 2020  aths:.          
+0000c730: 2020 2020 2020 6173 7365 7274 206e 6f74        assert not
+0000c740: 2070 7969 5f63 6163 6865 2e69 735f 6368   pyi_cache.is_ch
+0000c750: 616e 6765 6428 7061 7468 290a 2020 2020  anged(path).    
+0000c760: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+0000c770: 7274 206e 6f72 6d61 6c5f 6361 6368 652e  rt normal_cache.
+0000c780: 6973 5f63 6861 6e67 6564 2870 6174 6829  is_changed(path)
+0000c790: 0a0a 2020 2020 6465 6620 7465 7374 5f70  ..    def test_p
+0000c7a0: 6970 655f 666f 7263 655f 7079 3336 2873  ipe_force_py36(s
+0000c7b0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+0000c7c0: 2020 2020 2020 736f 7572 6365 2c20 6578        source, ex
+0000c7d0: 7065 6374 6564 203d 2072 6561 645f 6461  pected = read_da
+0000c7e0: 7461 2822 6d69 7363 656c 6c61 6e65 6f75  ta("miscellaneou
+0000c7f0: 7322 2c20 2266 6f72 6365 5f70 7933 3622  s", "force_py36"
+0000c800: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
+0000c810: 203d 2043 6c69 5275 6e6e 6572 2829 2e69   = CliRunner().i
+0000c820: 6e76 6f6b 6528 0a20 2020 2020 2020 2020  nvoke(.         
+0000c830: 2020 2062 6c61 636b 2e6d 6169 6e2c 0a20     black.main,. 
+0000c840: 2020 2020 2020 2020 2020 205b 222d 222c             ["-",
+0000c850: 2022 2d71 222c 2022 2d2d 7461 7267 6574   "-q", "--target
+0000c860: 2d76 6572 7369 6f6e 3d70 7933 3622 5d2c  -version=py36"],
+0000c870: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
+0000c880: 7574 3d42 7974 6573 494f 2873 6f75 7263  ut=BytesIO(sourc
+0000c890: 652e 656e 636f 6465 2822 7574 662d 3822  e.encode("utf-8"
+0000c8a0: 2929 2c0a 2020 2020 2020 2020 290a 2020  )),.        ).  
+0000c8b0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000c8c0: 7445 7175 616c 2872 6573 756c 742e 6578  tEqual(result.ex
+0000c8d0: 6974 5f63 6f64 652c 2030 290a 2020 2020  it_code, 0).    
+0000c8e0: 2020 2020 6163 7475 616c 203d 2072 6573      actual = res
+0000c8f0: 756c 742e 6f75 7470 7574 0a20 2020 2020  ult.output.     
+0000c900: 2020 2073 656c 662e 6173 7365 7274 466f     self.assertFo
+0000c910: 726d 6174 4571 7561 6c28 6163 7475 616c  rmatEqual(actual
+0000c920: 2c20 6578 7065 6374 6564 290a 0a20 2020  , expected)..   
+0000c930: 2040 7079 7465 7374 2e6d 6172 6b2e 696e   @pytest.mark.in
+0000c940: 636f 6d70 6174 6962 6c65 5f77 6974 685f  compatible_with_
+0000c950: 6d79 7079 630a 2020 2020 6465 6620 7465  mypyc.    def te
+0000c960: 7374 5f72 6566 6f72 6d61 745f 6f6e 655f  st_reformat_one_
+0000c970: 7769 7468 5f73 7464 696e 2873 656c 6629  with_stdin(self)
+0000c980: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000c990: 2020 7769 7468 2070 6174 6368 280a 2020    with patch(.  
+0000c9a0: 2020 2020 2020 2020 2020 2262 6c61 636b            "black
+0000c9b0: 2e66 6f72 6d61 745f 7374 6469 6e5f 746f  .format_stdin_to
+0000c9c0: 5f73 7464 6f75 7422 2c0a 2020 2020 2020  _stdout",.      
+0000c9d0: 2020 2020 2020 7265 7475 726e 5f76 616c        return_val
+0000c9e0: 7565 3d6c 616d 6264 6120 2a61 7267 732c  ue=lambda *args,
+0000c9f0: 202a 2a6b 7761 7267 733a 2062 6c61 636b   **kwargs: black
+0000ca00: 2e43 6861 6e67 6564 2e59 4553 2c0a 2020  .Changed.YES,.  
+0000ca10: 2020 2020 2020 2920 6173 2066 7374 733a        ) as fsts:
+0000ca20: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+0000ca30: 6f72 7420 3d20 4d61 6769 634d 6f63 6b28  ort = MagicMock(
+0000ca40: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
+0000ca50: 7468 203d 2050 6174 6828 222d 2229 0a20  th = Path("-"). 
+0000ca60: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+0000ca70: 2e72 6566 6f72 6d61 745f 6f6e 6528 0a20  .reformat_one(. 
+0000ca80: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000ca90: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
+0000caa0: 2020 2020 2066 6173 743d 5472 7565 2c0a       fast=True,.
+0000cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cac0: 7772 6974 655f 6261 636b 3d62 6c61 636b  write_back=black
+0000cad0: 2e57 7269 7465 4261 636b 2e59 4553 2c0a  .WriteBack.YES,.
+0000cae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000caf0: 6d6f 6465 3d44 4546 4155 4c54 5f4d 4f44  mode=DEFAULT_MOD
+0000cb00: 452c 0a20 2020 2020 2020 2020 2020 2020  E,.             
+0000cb10: 2020 2072 6570 6f72 743d 7265 706f 7274     report=report
+0000cb20: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0000cb30: 2020 2020 2020 2020 2020 2020 6673 7473              fsts
+0000cb40: 2e61 7373 6572 745f 6361 6c6c 6564 5f6f  .assert_called_o
+0000cb50: 6e63 6528 290a 2020 2020 2020 2020 2020  nce().          
+0000cb60: 2020 7265 706f 7274 2e64 6f6e 652e 6173    report.done.as
+0000cb70: 7365 7274 5f63 616c 6c65 645f 7769 7468  sert_called_with
+0000cb80: 2870 6174 682c 2062 6c61 636b 2e43 6861  (path, black.Cha
+0000cb90: 6e67 6564 2e59 4553 290a 0a20 2020 2040  nged.YES)..    @
+0000cba0: 7079 7465 7374 2e6d 6172 6b2e 696e 636f  pytest.mark.inco
+0000cbb0: 6d70 6174 6962 6c65 5f77 6974 685f 6d79  mpatible_with_my
+0000cbc0: 7079 630a 2020 2020 6465 6620 7465 7374  pyc.    def test
+0000cbd0: 5f72 6566 6f72 6d61 745f 6f6e 655f 7769  _reformat_one_wi
+0000cbe0: 7468 5f73 7464 696e 5f66 696c 656e 616d  th_stdin_filenam
+0000cbf0: 6528 7365 6c66 2920 2d3e 204e 6f6e 653a  e(self) -> None:
+0000cc00: 0a20 2020 2020 2020 2077 6974 6820 7061  .        with pa
+0000cc10: 7463 6828 0a20 2020 2020 2020 2020 2020  tch(.           
+0000cc20: 2022 626c 6163 6b2e 666f 726d 6174 5f73   "black.format_s
+0000cc30: 7464 696e 5f74 6f5f 7374 646f 7574 222c  tdin_to_stdout",
+0000cc40: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000cc50: 7572 6e5f 7661 6c75 653d 6c61 6d62 6461  urn_value=lambda
+0000cc60: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
+0000cc70: 3a20 626c 6163 6b2e 4368 616e 6765 642e  : black.Changed.
+0000cc80: 5945 532c 0a20 2020 2020 2020 2029 2061  YES,.        ) a
+0000cc90: 7320 6673 7473 3a0a 2020 2020 2020 2020  s fsts:.        
+0000cca0: 2020 2020 7265 706f 7274 203d 204d 6167      report = Mag
+0000ccb0: 6963 4d6f 636b 2829 0a20 2020 2020 2020  icMock().       
+0000ccc0: 2020 2020 2070 203d 2022 666f 6f2e 7079       p = "foo.py
+0000ccd0: 220a 2020 2020 2020 2020 2020 2020 7061  ".            pa
+0000cce0: 7468 203d 2050 6174 6828 6622 5f5f 424c  th = Path(f"__BL
+0000ccf0: 4143 4b5f 5354 4449 4e5f 4649 4c45 4e41  ACK_STDIN_FILENA
+0000cd00: 4d45 5f5f 7b70 7d22 290a 2020 2020 2020  ME__{p}").      
+0000cd10: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
+0000cd20: 2050 6174 6828 7029 0a20 2020 2020 2020   Path(p).       
+0000cd30: 2020 2020 2062 6c61 636b 2e72 6566 6f72       black.refor
+0000cd40: 6d61 745f 6f6e 6528 0a20 2020 2020 2020  mat_one(.       
+0000cd50: 2020 2020 2020 2020 2070 6174 682c 0a20           path,. 
+0000cd60: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000cd70: 6173 743d 5472 7565 2c0a 2020 2020 2020  ast=True,.      
+0000cd80: 2020 2020 2020 2020 2020 7772 6974 655f            write_
+0000cd90: 6261 636b 3d62 6c61 636b 2e57 7269 7465  back=black.Write
+0000cda0: 4261 636b 2e59 4553 2c0a 2020 2020 2020  Back.YES,.      
+0000cdb0: 2020 2020 2020 2020 2020 6d6f 6465 3d44            mode=D
+0000cdc0: 4546 4155 4c54 5f4d 4f44 452c 0a20 2020  EFAULT_MODE,.   
+0000cdd0: 2020 2020 2020 2020 2020 2020 2072 6570               rep
+0000cde0: 6f72 743d 7265 706f 7274 2c0a 2020 2020  ort=report,.    
+0000cdf0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000ce00: 2020 2020 2020 6673 7473 2e61 7373 6572        fsts.asser
+0000ce10: 745f 6361 6c6c 6564 5f6f 6e63 655f 7769  t_called_once_wi
+0000ce20: 7468 280a 2020 2020 2020 2020 2020 2020  th(.            
+0000ce30: 2020 2020 6661 7374 3d54 7275 652c 2077      fast=True, w
+0000ce40: 7269 7465 5f62 6163 6b3d 626c 6163 6b2e  rite_back=black.
+0000ce50: 5772 6974 6542 6163 6b2e 5945 532c 206d  WriteBack.YES, m
+0000ce60: 6f64 653d 4445 4641 554c 545f 4d4f 4445  ode=DEFAULT_MODE
+0000ce70: 2c20 6c69 6e65 733d 2829 0a20 2020 2020  , lines=().     
+0000ce80: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000ce90: 2020 2020 2023 205f 5f42 4c41 434b 5f53       # __BLACK_S
+0000cea0: 5444 494e 5f46 494c 454e 414d 455f 5f20  TDIN_FILENAME__ 
+0000ceb0: 7368 6f75 6c64 2068 6176 6520 6265 656e  should have been
+0000cec0: 2073 7472 6970 7065 640a 2020 2020 2020   stripped.      
+0000ced0: 2020 2020 2020 7265 706f 7274 2e64 6f6e        report.don
+0000cee0: 652e 6173 7365 7274 5f63 616c 6c65 645f  e.assert_called_
+0000cef0: 7769 7468 2865 7870 6563 7465 642c 2062  with(expected, b
+0000cf00: 6c61 636b 2e43 6861 6e67 6564 2e59 4553  lack.Changed.YES
+0000cf10: 290a 0a20 2020 2040 7079 7465 7374 2e6d  )..    @pytest.m
+0000cf20: 6172 6b2e 696e 636f 6d70 6174 6962 6c65  ark.incompatible
+0000cf30: 5f77 6974 685f 6d79 7079 630a 2020 2020  _with_mypyc.    
+0000cf40: 6465 6620 7465 7374 5f72 6566 6f72 6d61  def test_reforma
+0000cf50: 745f 6f6e 655f 7769 7468 5f73 7464 696e  t_one_with_stdin
+0000cf60: 5f66 696c 656e 616d 655f 7079 6928 7365  _filename_pyi(se
+0000cf70: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000cf80: 2020 2020 2077 6974 6820 7061 7463 6828       with patch(
+0000cf90: 0a20 2020 2020 2020 2020 2020 2022 626c  .            "bl
+0000cfa0: 6163 6b2e 666f 726d 6174 5f73 7464 696e  ack.format_stdin
+0000cfb0: 5f74 6f5f 7374 646f 7574 222c 0a20 2020  _to_stdout",.   
+0000cfc0: 2020 2020 2020 2020 2072 6574 7572 6e5f           return_
+0000cfd0: 7661 6c75 653d 6c61 6d62 6461 202a 6172  value=lambda *ar
+0000cfe0: 6773 2c20 2a2a 6b77 6172 6773 3a20 626c  gs, **kwargs: bl
+0000cff0: 6163 6b2e 4368 616e 6765 642e 5945 532c  ack.Changed.YES,
+0000d000: 0a20 2020 2020 2020 2029 2061 7320 6673  .        ) as fs
+0000d010: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+0000d020: 7265 706f 7274 203d 204d 6167 6963 4d6f  report = MagicMo
+0000d030: 636b 2829 0a20 2020 2020 2020 2020 2020  ck().           
+0000d040: 2070 203d 2022 666f 6f2e 7079 6922 0a20   p = "foo.pyi". 
+0000d050: 2020 2020 2020 2020 2020 2070 6174 6820             path 
+0000d060: 3d20 5061 7468 2866 225f 5f42 4c41 434b  = Path(f"__BLACK
+0000d070: 5f53 5444 494e 5f46 494c 454e 414d 455f  _STDIN_FILENAME_
+0000d080: 5f7b 707d 2229 0a20 2020 2020 2020 2020  _{p}").         
+0000d090: 2020 2065 7870 6563 7465 6420 3d20 5061     expected = Pa
+0000d0a0: 7468 2870 290a 2020 2020 2020 2020 2020  th(p).          
+0000d0b0: 2020 626c 6163 6b2e 7265 666f 726d 6174    black.reformat
+0000d0c0: 5f6f 6e65 280a 2020 2020 2020 2020 2020  _one(.          
+0000d0d0: 2020 2020 2020 7061 7468 2c0a 2020 2020        path,.    
+0000d0e0: 2020 2020 2020 2020 2020 2020 6661 7374              fast
+0000d0f0: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
+0000d100: 2020 2020 2020 2077 7269 7465 5f62 6163         write_bac
+0000d110: 6b3d 626c 6163 6b2e 5772 6974 6542 6163  k=black.WriteBac
+0000d120: 6b2e 5945 532c 0a20 2020 2020 2020 2020  k.YES,.         
+0000d130: 2020 2020 2020 206d 6f64 653d 4445 4641         mode=DEFA
+0000d140: 554c 545f 4d4f 4445 2c0a 2020 2020 2020  ULT_MODE,.      
+0000d150: 2020 2020 2020 2020 2020 7265 706f 7274            report
+0000d160: 3d72 6570 6f72 742c 0a20 2020 2020 2020  =report,.       
+0000d170: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000d180: 2020 2066 7374 732e 6173 7365 7274 5f63     fsts.assert_c
+0000d190: 616c 6c65 645f 6f6e 6365 5f77 6974 6828  alled_once_with(
+0000d1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d1b0: 2066 6173 743d 5472 7565 2c0a 2020 2020   fast=True,.    
+0000d1c0: 2020 2020 2020 2020 2020 2020 7772 6974              writ
+0000d1d0: 655f 6261 636b 3d62 6c61 636b 2e57 7269  e_back=black.Wri
+0000d1e0: 7465 4261 636b 2e59 4553 2c0a 2020 2020  teBack.YES,.    
+0000d1f0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+0000d200: 3d72 6570 6c61 6365 2844 4546 4155 4c54  =replace(DEFAULT
+0000d210: 5f4d 4f44 452c 2069 735f 7079 693d 5472  _MODE, is_pyi=Tr
+0000d220: 7565 292c 0a20 2020 2020 2020 2020 2020  ue),.           
+0000d230: 2020 2020 206c 696e 6573 3d28 292c 0a20       lines=(),. 
+0000d240: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000d250: 2020 2020 2020 2020 2023 205f 5f42 4c41           # __BLA
+0000d260: 434b 5f53 5444 494e 5f46 494c 454e 414d  CK_STDIN_FILENAM
+0000d270: 455f 5f20 7368 6f75 6c64 2068 6176 6520  E__ should have 
+0000d280: 6265 656e 2073 7472 6970 7065 640a 2020  been stripped.  
+0000d290: 2020 2020 2020 2020 2020 7265 706f 7274            report
+0000d2a0: 2e64 6f6e 652e 6173 7365 7274 5f63 616c  .done.assert_cal
+0000d2b0: 6c65 645f 7769 7468 2865 7870 6563 7465  led_with(expecte
+0000d2c0: 642c 2062 6c61 636b 2e43 6861 6e67 6564  d, black.Changed
+0000d2d0: 2e59 4553 290a 0a20 2020 2040 7079 7465  .YES)..    @pyte
+0000d2e0: 7374 2e6d 6172 6b2e 696e 636f 6d70 6174  st.mark.incompat
+0000d2f0: 6962 6c65 5f77 6974 685f 6d79 7079 630a  ible_with_mypyc.
+0000d300: 2020 2020 6465 6620 7465 7374 5f72 6566      def test_ref
+0000d310: 6f72 6d61 745f 6f6e 655f 7769 7468 5f73  ormat_one_with_s
+0000d320: 7464 696e 5f66 696c 656e 616d 655f 6970  tdin_filename_ip
+0000d330: 796e 6228 7365 6c66 2920 2d3e 204e 6f6e  ynb(self) -> Non
+0000d340: 653a 0a20 2020 2020 2020 2077 6974 6820  e:.        with 
+0000d350: 7061 7463 6828 0a20 2020 2020 2020 2020  patch(.         
+0000d360: 2020 2022 626c 6163 6b2e 666f 726d 6174     "black.format
+0000d370: 5f73 7464 696e 5f74 6f5f 7374 646f 7574  _stdin_to_stdout
+0000d380: 222c 0a20 2020 2020 2020 2020 2020 2072  ",.            r
+0000d390: 6574 7572 6e5f 7661 6c75 653d 6c61 6d62  eturn_value=lamb
+0000d3a0: 6461 202a 6172 6773 2c20 2a2a 6b77 6172  da *args, **kwar
+0000d3b0: 6773 3a20 626c 6163 6b2e 4368 616e 6765  gs: black.Change
+0000d3c0: 642e 5945 532c 0a20 2020 2020 2020 2029  d.YES,.        )
+0000d3d0: 2061 7320 6673 7473 3a0a 2020 2020 2020   as fsts:.      
+0000d3e0: 2020 2020 2020 7265 706f 7274 203d 204d        report = M
+0000d3f0: 6167 6963 4d6f 636b 2829 0a20 2020 2020  agicMock().     
+0000d400: 2020 2020 2020 2070 203d 2022 666f 6f2e         p = "foo.
+0000d410: 6970 796e 6222 0a20 2020 2020 2020 2020  ipynb".         
+0000d420: 2020 2070 6174 6820 3d20 5061 7468 2866     path = Path(f
+0000d430: 225f 5f42 4c41 434b 5f53 5444 494e 5f46  "__BLACK_STDIN_F
+0000d440: 494c 454e 414d 455f 5f7b 707d 2229 0a20  ILENAME__{p}"). 
+0000d450: 2020 2020 2020 2020 2020 2065 7870 6563             expec
+0000d460: 7465 6420 3d20 5061 7468 2870 290a 2020  ted = Path(p).  
+0000d470: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
+0000d480: 7265 666f 726d 6174 5f6f 6e65 280a 2020  reformat_one(.  
+0000d490: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0000d4a0: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+0000d4b0: 2020 2020 6661 7374 3d54 7275 652c 0a20      fast=True,. 
+0000d4c0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000d4d0: 7269 7465 5f62 6163 6b3d 626c 6163 6b2e  rite_back=black.
+0000d4e0: 5772 6974 6542 6163 6b2e 5945 532c 0a20  WriteBack.YES,. 
+0000d4f0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000d500: 6f64 653d 4445 4641 554c 545f 4d4f 4445  ode=DEFAULT_MODE
+0000d510: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d520: 2020 7265 706f 7274 3d72 6570 6f72 742c    report=report,
+0000d530: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000d540: 2020 2020 2020 2020 2020 2066 7374 732e             fsts.
+0000d550: 6173 7365 7274 5f63 616c 6c65 645f 6f6e  assert_called_on
+0000d560: 6365 5f77 6974 6828 0a20 2020 2020 2020  ce_with(.       
+0000d570: 2020 2020 2020 2020 2066 6173 743d 5472           fast=Tr
+0000d580: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+0000d590: 2020 2020 7772 6974 655f 6261 636b 3d62      write_back=b
+0000d5a0: 6c61 636b 2e57 7269 7465 4261 636b 2e59  lack.WriteBack.Y
+0000d5b0: 4553 2c0a 2020 2020 2020 2020 2020 2020  ES,.            
+0000d5c0: 2020 2020 6d6f 6465 3d72 6570 6c61 6365      mode=replace
+0000d5d0: 2844 4546 4155 4c54 5f4d 4f44 452c 2069  (DEFAULT_MODE, i
+0000d5e0: 735f 6970 796e 623d 5472 7565 292c 0a20  s_ipynb=True),. 
+0000d5f0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0000d600: 696e 6573 3d28 292c 0a20 2020 2020 2020  ines=(),.       
+0000d610: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000d620: 2020 2023 205f 5f42 4c41 434b 5f53 5444     # __BLACK_STD
+0000d630: 494e 5f46 494c 454e 414d 455f 5f20 7368  IN_FILENAME__ sh
+0000d640: 6f75 6c64 2068 6176 6520 6265 656e 2073  ould have been s
+0000d650: 7472 6970 7065 640a 2020 2020 2020 2020  tripped.        
+0000d660: 2020 2020 7265 706f 7274 2e64 6f6e 652e      report.done.
+0000d670: 6173 7365 7274 5f63 616c 6c65 645f 7769  assert_called_wi
+0000d680: 7468 2865 7870 6563 7465 642c 2062 6c61  th(expected, bla
+0000d690: 636b 2e43 6861 6e67 6564 2e59 4553 290a  ck.Changed.YES).
+0000d6a0: 0a20 2020 2040 7079 7465 7374 2e6d 6172  .    @pytest.mar
+0000d6b0: 6b2e 696e 636f 6d70 6174 6962 6c65 5f77  k.incompatible_w
+0000d6c0: 6974 685f 6d79 7079 630a 2020 2020 6465  ith_mypyc.    de
+0000d6d0: 6620 7465 7374 5f72 6566 6f72 6d61 745f  f test_reformat_
+0000d6e0: 6f6e 655f 7769 7468 5f73 7464 696e 5f61  one_with_stdin_a
+0000d6f0: 6e64 5f65 7869 7374 696e 675f 7061 7468  nd_existing_path
+0000d700: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0000d710: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
+0000d720: 6368 280a 2020 2020 2020 2020 2020 2020  ch(.            
+0000d730: 2262 6c61 636b 2e66 6f72 6d61 745f 7374  "black.format_st
+0000d740: 6469 6e5f 746f 5f73 7464 6f75 7422 2c0a  din_to_stdout",.
+0000d750: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000d760: 726e 5f76 616c 7565 3d6c 616d 6264 6120  rn_value=lambda 
+0000d770: 2a61 7267 732c 202a 2a6b 7761 7267 733a  *args, **kwargs:
+0000d780: 2062 6c61 636b 2e43 6861 6e67 6564 2e59   black.Changed.Y
+0000d790: 4553 2c0a 2020 2020 2020 2020 2920 6173  ES,.        ) as
+0000d7a0: 2066 7374 733a 0a20 2020 2020 2020 2020   fsts:.         
+0000d7b0: 2020 2072 6570 6f72 7420 3d20 4d61 6769     report = Magi
+0000d7c0: 634d 6f63 6b28 290a 2020 2020 2020 2020  cMock().        
+0000d7d0: 2020 2020 2320 4576 656e 2077 6974 6820      # Even with 
+0000d7e0: 616e 2065 7869 7374 696e 6720 6669 6c65  an existing file
+0000d7f0: 2c20 7369 6e63 6520 7765 2061 7265 2066  , since we are f
+0000d800: 6f72 6369 6e67 2073 7464 696e 2c20 626c  orcing stdin, bl
+0000d810: 6163 6b0a 2020 2020 2020 2020 2020 2020  ack.            
+0000d820: 2320 7368 6f75 6c64 206f 7574 7075 7420  # should output 
+0000d830: 746f 2073 7464 6f75 7420 616e 6420 6e6f  to stdout and no
+0000d840: 7420 6d6f 6469 6679 2074 6865 2066 696c  t modify the fil
+0000d850: 6520 696e 706c 6163 650a 2020 2020 2020  e inplace.      
+0000d860: 2020 2020 2020 7020 3d20 5448 4953 5f44        p = THIS_D
+0000d870: 4952 202f 2022 6461 7461 2220 2f20 2263  IR / "data" / "c
+0000d880: 6173 6573 2220 2f20 2263 6f6c 6c65 6374  ases" / "collect
+0000d890: 696f 6e73 2e70 7922 0a20 2020 2020 2020  ions.py".       
+0000d8a0: 2020 2020 2023 204d 616b 6520 7375 7265       # Make sure
+0000d8b0: 2069 735f 6669 6c65 2061 6374 7561 6c6c   is_file actuall
+0000d8c0: 7920 7265 7475 726e 7320 5472 7565 0a20  y returns True. 
+0000d8d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000d8e0: 6173 7365 7274 5472 7565 2870 2e69 735f  assertTrue(p.is_
+0000d8f0: 6669 6c65 2829 290a 2020 2020 2020 2020  file()).        
+0000d900: 2020 2020 7061 7468 203d 2050 6174 6828      path = Path(
+0000d910: 6622 5f5f 424c 4143 4b5f 5354 4449 4e5f  f"__BLACK_STDIN_
+0000d920: 4649 4c45 4e41 4d45 5f5f 7b70 7d22 290a  FILENAME__{p}").
+0000d930: 2020 2020 2020 2020 2020 2020 6578 7065              expe
+0000d940: 6374 6564 203d 2050 6174 6828 7029 0a20  cted = Path(p). 
+0000d950: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+0000d960: 2e72 6566 6f72 6d61 745f 6f6e 6528 0a20  .reformat_one(. 
+0000d970: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000d980: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
+0000d990: 2020 2020 2066 6173 743d 5472 7565 2c0a       fast=True,.
+0000d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d9b0: 7772 6974 655f 6261 636b 3d62 6c61 636b  write_back=black
+0000d9c0: 2e57 7269 7465 4261 636b 2e59 4553 2c0a  .WriteBack.YES,.
+0000d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d9e0: 6d6f 6465 3d44 4546 4155 4c54 5f4d 4f44  mode=DEFAULT_MOD
+0000d9f0: 452c 0a20 2020 2020 2020 2020 2020 2020  E,.             
+0000da00: 2020 2072 6570 6f72 743d 7265 706f 7274     report=report
+0000da10: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0000da20: 2020 2020 2020 2020 2020 2020 6673 7473              fsts
+0000da30: 2e61 7373 6572 745f 6361 6c6c 6564 5f6f  .assert_called_o
+0000da40: 6e63 6528 290a 2020 2020 2020 2020 2020  nce().          
+0000da50: 2020 2320 5f5f 424c 4143 4b5f 5354 4449    # __BLACK_STDI
+0000da60: 4e5f 4649 4c45 4e41 4d45 5f5f 2073 686f  N_FILENAME__ sho
+0000da70: 756c 6420 6861 7665 2062 6565 6e20 7374  uld have been st
+0000da80: 7269 7070 6564 0a20 2020 2020 2020 2020  ripped.         
+0000da90: 2020 2072 6570 6f72 742e 646f 6e65 2e61     report.done.a
+0000daa0: 7373 6572 745f 6361 6c6c 6564 5f77 6974  ssert_called_wit
+0000dab0: 6828 6578 7065 6374 6564 2c20 626c 6163  h(expected, blac
+0000dac0: 6b2e 4368 616e 6765 642e 5945 5329 0a0a  k.Changed.YES)..
+0000dad0: 2020 2020 6465 6620 7465 7374 5f72 6566      def test_ref
+0000dae0: 6f72 6d61 745f 6f6e 655f 7769 7468 5f73  ormat_one_with_s
+0000daf0: 7464 696e 5f65 6d70 7479 2873 656c 6629  tdin_empty(self)
+0000db00: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000db10: 2020 6361 7365 7320 3d20 5b0a 2020 2020    cases = [.    
+0000db20: 2020 2020 2020 2020 2822 222c 2022 2229          ("", "")
+0000db30: 2c0a 2020 2020 2020 2020 2020 2020 2822  ,.            ("
+0000db40: 5c6e 222c 2022 5c6e 2229 2c0a 2020 2020  \n", "\n"),.    
+0000db50: 2020 2020 2020 2020 2822 5c72 5c6e 222c          ("\r\n",
+0000db60: 2022 5c72 5c6e 2229 2c0a 2020 2020 2020   "\r\n"),.      
+0000db70: 2020 2020 2020 2822 205c 7422 2c20 2222        (" \t", ""
+0000db80: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
+0000db90: 2220 5c74 5c6e 5c74 2022 2c20 225c 6e22  " \t\n\t ", "\n"
+0000dba0: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
+0000dbb0: 2220 5c74 5c72 5c6e 5c74 2022 2c20 225c  " \t\r\n\t ", "\
+0000dbc0: 725c 6e22 292c 0a20 2020 2020 2020 205d  r\n"),.        ]
+0000dbd0: 0a0a 2020 2020 2020 2020 6465 6620 5f6e  ..        def _n
+0000dbe0: 6577 5f77 7261 7070 6572 280a 2020 2020  ew_wrapper(.    
+0000dbf0: 2020 2020 2020 2020 6f75 7470 7574 3a20          output: 
+0000dc00: 696f 2e53 7472 696e 6749 4f2c 2069 6f5f  io.StringIO, io_
+0000dc10: 5465 7874 494f 5772 6170 7065 723a 2054  TextIOWrapper: T
+0000dc20: 7970 655b 696f 2e54 6578 7449 4f57 7261  ype[io.TextIOWra
+0000dc30: 7070 6572 5d0a 2020 2020 2020 2020 2920  pper].        ) 
+0000dc40: 2d3e 2043 616c 6c61 626c 655b 5b41 6e79  -> Callable[[Any
+0000dc50: 2c20 416e 795d 2c20 696f 2e54 6578 7449  , Any], io.TextI
+0000dc60: 4f57 7261 7070 6572 5d3a 0a20 2020 2020  OWrapper]:.     
+0000dc70: 2020 2020 2020 2064 6566 2067 6574 5f6f         def get_o
+0000dc80: 7574 7075 7428 2a61 7267 733a 2041 6e79  utput(*args: Any
+0000dc90: 2c20 2a2a 6b77 6172 6773 3a20 416e 7929  , **kwargs: Any)
+0000dca0: 202d 3e20 696f 2e54 6578 7449 4f57 7261   -> io.TextIOWra
+0000dcb0: 7070 6572 3a0a 2020 2020 2020 2020 2020  pper:.          
+0000dcc0: 2020 2020 2020 6966 2061 7267 7320 3d3d        if args ==
+0000dcd0: 2028 7379 732e 7374 646f 7574 2e62 7566   (sys.stdout.buf
+0000dce0: 6665 722c 293a 0a20 2020 2020 2020 2020  fer,):.         
+0000dcf0: 2020 2020 2020 2020 2020 2023 2049 7427             # It'
+0000dd00: 7320 6066 6f72 6d61 745f 7374 6469 6e5f  s `format_stdin_
+0000dd10: 746f 5f73 7464 6f75 7428 2960 2063 616c  to_stdout()` cal
+0000dd20: 6c69 6e67 2060 696f 2e54 6578 7449 4f57  ling `io.TextIOW
+0000dd30: 7261 7070 6572 2829 602c 0a20 2020 2020  rapper()`,.     
+0000dd40: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000dd50: 2072 6574 7572 6e20 6f75 7220 6d6f 636b   return our mock
+0000dd60: 206f 626a 6563 742e 0a20 2020 2020 2020   object..       
+0000dd70: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000dd80: 7572 6e20 6f75 7470 7574 0a20 2020 2020  urn output.     
+0000dd90: 2020 2020 2020 2020 2020 2023 2049 7427             # It'
+0000dda0: 7320 736f 6d65 7468 696e 6720 656c 7365  s something else
+0000ddb0: 2028 692e 652e 2060 6465 636f 6465 5f62   (i.e. `decode_b
+0000ddc0: 7974 6573 2829 6029 2063 616c 6c69 6e67  ytes()`) calling
+0000ddd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dde0: 2023 2060 696f 2e54 6578 7449 4f57 7261   # `io.TextIOWra
+0000ddf0: 7070 6572 2829 602c 2070 6173 7320 7468  pper()`, pass th
+0000de00: 726f 7567 6820 746f 2074 6865 206f 7269  rough to the ori
+0000de10: 6769 6e61 6c20 696d 706c 656d 656e 7461  ginal implementa
+0000de20: 7469 6f6e 2e0a 2020 2020 2020 2020 2020  tion..          
+0000de30: 2020 2020 2020 2320 5365 6520 6469 7363        # See disc
+0000de40: 7573 7369 6f6e 2069 6e20 6874 7470 733a  ussion in https:
+0000de50: 2f2f 6769 7468 7562 2e63 6f6d 2f70 7366  //github.com/psf
+0000de60: 2f62 6c61 636b 2f70 756c 6c2f 3234 3839  /black/pull/2489
+0000de70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000de80: 2072 6574 7572 6e20 696f 5f54 6578 7449   return io_TextI
+0000de90: 4f57 7261 7070 6572 282a 6172 6773 2c20  OWrapper(*args, 
+0000dea0: 2a2a 6b77 6172 6773 290a 0a20 2020 2020  **kwargs)..     
+0000deb0: 2020 2020 2020 2072 6574 7572 6e20 6765         return ge
+0000dec0: 745f 6f75 7470 7574 0a0a 2020 2020 2020  t_output..      
+0000ded0: 2020 666f 7220 636f 6e74 656e 742c 2065    for content, e
+0000dee0: 7870 6563 7465 6420 696e 2063 6173 6573  xpected in cases
+0000def0: 3a0a 2020 2020 2020 2020 2020 2020 6f75  :.            ou
+0000df00: 7470 7574 203d 2069 6f2e 5374 7269 6e67  tput = io.String
+0000df10: 494f 2829 0a20 2020 2020 2020 2020 2020  IO().           
+0000df20: 2069 6f5f 5465 7874 494f 5772 6170 7065   io_TextIOWrappe
+0000df30: 7220 3d20 696f 2e54 6578 7449 4f57 7261  r = io.TextIOWra
+0000df40: 7070 6572 0a0a 2020 2020 2020 2020 2020  pper..          
+0000df50: 2020 7769 7468 2070 6174 6368 2822 696f    with patch("io
+0000df60: 2e54 6578 7449 4f57 7261 7070 6572 222c  .TextIOWrapper",
+0000df70: 205f 6e65 775f 7772 6170 7065 7228 6f75   _new_wrapper(ou
+0000df80: 7470 7574 2c20 696f 5f54 6578 7449 4f57  tput, io_TextIOW
+0000df90: 7261 7070 6572 2929 3a0a 2020 2020 2020  rapper)):.      
+0000dfa0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+0000dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfc0: 2020 2062 6c61 636b 2e66 6f72 6d61 745f     black.format_
+0000dfd0: 7374 6469 6e5f 746f 5f73 7464 6f75 7428  stdin_to_stdout(
+0000dfe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dff0: 2020 2020 2020 2020 2066 6173 743d 5472           fast=Tr
+0000e000: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+0000e010: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0000e020: 656e 743d 636f 6e74 656e 742c 0a20 2020  ent=content,.   
+0000e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e040: 2020 2020 2077 7269 7465 5f62 6163 6b3d       write_back=
+0000e050: 626c 6163 6b2e 5772 6974 6542 6163 6b2e  black.WriteBack.
+0000e060: 5945 532c 0a20 2020 2020 2020 2020 2020  YES,.           
+0000e070: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0000e080: 653d 4445 4641 554c 545f 4d4f 4445 2c0a  e=DEFAULT_MODE,.
+0000e090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0a0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000e0b0: 2020 2020 2020 6578 6365 7074 2069 6f2e        except io.
+0000e0c0: 556e 7375 7070 6f72 7465 644f 7065 7261  UnsupportedOpera
+0000e0d0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+0000e0e0: 2020 2020 2020 2020 2020 7061 7373 2020            pass  
+0000e0f0: 2320 5374 7269 6e67 494f 2064 6f65 7320  # StringIO does 
+0000e100: 6e6f 7420 7375 7070 6f72 7420 6465 7461  not support deta
+0000e110: 6368 0a20 2020 2020 2020 2020 2020 2020  ch.             
+0000e120: 2020 2061 7373 6572 7420 6f75 7470 7574     assert output
+0000e130: 2e67 6574 7661 6c75 6528 2920 3d3d 2065  .getvalue() == e
+0000e140: 7870 6563 7465 640a 0a20 2020 2064 6566  xpected..    def
+0000e150: 2074 6573 745f 636c 695f 756e 7374 6162   test_cli_unstab
+0000e160: 6c65 2873 656c 6629 202d 3e20 4e6f 6e65  le(self) -> None
+0000e170: 3a0a 2020 2020 2020 2020 7365 6c66 2e69  :.        self.i
+0000e180: 6e76 6f6b 6542 6c61 636b 285b 222d 2d75  nvokeBlack(["--u
+0000e190: 6e73 7461 626c 6522 2c20 222d 6322 2c20  nstable", "-c", 
+0000e1a0: 2230 225d 2c20 6578 6974 5f63 6f64 653d  "0"], exit_code=
+0000e1b0: 3029 0a20 2020 2020 2020 2073 656c 662e  0).        self.
+0000e1c0: 696e 766f 6b65 426c 6163 6b28 5b22 2d2d  invokeBlack(["--
+0000e1d0: 7072 6576 6965 7722 2c20 222d 6322 2c20  preview", "-c", 
+0000e1e0: 2230 225d 2c20 6578 6974 5f63 6f64 653d  "0"], exit_code=
+0000e1f0: 3029 0a20 2020 2020 2020 2023 204d 7573  0).        # Mus
+0000e200: 7420 616c 736f 2070 6173 7320 2d2d 7072  t also pass --pr
+0000e210: 6576 6965 770a 2020 2020 2020 2020 7365  eview.        se
+0000e220: 6c66 2e69 6e76 6f6b 6542 6c61 636b 280a  lf.invokeBlack(.
+0000e230: 2020 2020 2020 2020 2020 2020 5b22 2d2d              ["--
+0000e240: 656e 6162 6c65 2d75 6e73 7461 626c 652d  enable-unstable-
+0000e250: 6665 6174 7572 6522 2c20 2273 7472 696e  feature", "strin
+0000e260: 675f 7072 6f63 6573 7369 6e67 222c 2022  g_processing", "
+0000e270: 2d63 222c 2022 3022 5d2c 2065 7869 745f  -c", "0"], exit_
+0000e280: 636f 6465 3d31 0a20 2020 2020 2020 2029  code=1.        )
+0000e290: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
+0000e2a0: 766f 6b65 426c 6163 6b28 0a20 2020 2020  vokeBlack(.     
+0000e2b0: 2020 2020 2020 205b 222d 2d70 7265 7669         ["--previ
+0000e2c0: 6577 222c 2022 2d2d 656e 6162 6c65 2d75  ew", "--enable-u
+0000e2d0: 6e73 7461 626c 652d 6665 6174 7572 6522  nstable-feature"
+0000e2e0: 2c20 2273 7472 696e 675f 7072 6f63 6573  , "string_proces
+0000e2f0: 7369 6e67 222c 2022 2d63 222c 2022 3022  sing", "-c", "0"
+0000e300: 5d2c 0a20 2020 2020 2020 2020 2020 2065  ],.            e
+0000e310: 7869 745f 636f 6465 3d30 2c0a 2020 2020  xit_code=0,.    
+0000e320: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
+0000e330: 6c66 2e69 6e76 6f6b 6542 6c61 636b 280a  lf.invokeBlack(.
+0000e340: 2020 2020 2020 2020 2020 2020 5b22 2d2d              ["--
+0000e350: 756e 7374 6162 6c65 222c 2022 2d2d 656e  unstable", "--en
+0000e360: 6162 6c65 2d75 6e73 7461 626c 652d 6665  able-unstable-fe
+0000e370: 6174 7572 6522 2c20 2273 7472 696e 675f  ature", "string_
+0000e380: 7072 6f63 6573 7369 6e67 222c 2022 2d63  processing", "-c
+0000e390: 222c 2022 3022 5d2c 0a20 2020 2020 2020  ", "0"],.       
+0000e3a0: 2020 2020 2065 7869 745f 636f 6465 3d30       exit_code=0
+0000e3b0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+0000e3c0: 2064 6566 2074 6573 745f 696e 7661 6c69   def test_invali
+0000e3d0: 645f 636c 695f 7265 6765 7828 7365 6c66  d_cli_regex(self
+0000e3e0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000e3f0: 2020 2066 6f72 206f 7074 696f 6e20 696e     for option in
+0000e400: 205b 222d 2d69 6e63 6c75 6465 222c 2022   ["--include", "
+0000e410: 2d2d 6578 636c 7564 6522 2c20 222d 2d65  --exclude", "--e
+0000e420: 7874 656e 642d 6578 636c 7564 6522 2c20  xtend-exclude", 
+0000e430: 222d 2d66 6f72 6365 2d65 7863 6c75 6465  "--force-exclude
+0000e440: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
+0000e450: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
+0000e460: 285b 222d 222c 206f 7074 696f 6e2c 2022  (["-", option, "
+0000e470: 2a2a 2829 2821 212a 2922 5d2c 2065 7869  **()(!!*)"], exi
+0000e480: 745f 636f 6465 3d32 290a 0a20 2020 2064  t_code=2)..    d
+0000e490: 6566 2074 6573 745f 7265 7175 6972 6564  ef test_required
+0000e4a0: 5f76 6572 7369 6f6e 5f6d 6174 6368 6573  _version_matches
+0000e4b0: 5f76 6572 7369 6f6e 2873 656c 6629 202d  _version(self) -
+0000e4c0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000e4d0: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
+0000e4e0: 280a 2020 2020 2020 2020 2020 2020 5b22  (.            ["
+0000e4f0: 2d2d 7265 7175 6972 6564 2d76 6572 7369  --required-versi
+0000e500: 6f6e 222c 2062 6c61 636b 2e5f 5f76 6572  on", black.__ver
+0000e510: 7369 6f6e 5f5f 2c20 222d 6322 2c20 2230  sion__, "-c", "0
+0000e520: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+0000e530: 6578 6974 5f63 6f64 653d 302c 0a20 2020  exit_code=0,.   
+0000e540: 2020 2020 2020 2020 2069 676e 6f72 655f           ignore_
+0000e550: 636f 6e66 6967 3d54 7275 652c 0a20 2020  config=True,.   
+0000e560: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+0000e570: 7465 7374 5f72 6571 7569 7265 645f 7665  test_required_ve
+0000e580: 7273 696f 6e5f 6d61 7463 6865 735f 7061  rsion_matches_pa
+0000e590: 7274 6961 6c5f 7665 7273 696f 6e28 7365  rtial_version(se
+0000e5a0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000e5b0: 2020 2020 2073 656c 662e 696e 766f 6b65       self.invoke
+0000e5c0: 426c 6163 6b28 0a20 2020 2020 2020 2020  Black(.         
+0000e5d0: 2020 205b 222d 2d72 6571 7569 7265 642d     ["--required-
+0000e5e0: 7665 7273 696f 6e22 2c20 626c 6163 6b2e  version", black.
+0000e5f0: 5f5f 7665 7273 696f 6e5f 5f2e 7370 6c69  __version__.spli
+0000e600: 7428 222e 2229 5b30 5d2c 2022 2d63 222c  t(".")[0], "-c",
+0000e610: 2022 3022 5d2c 0a20 2020 2020 2020 2020   "0"],.         
+0000e620: 2020 2065 7869 745f 636f 6465 3d30 2c0a     exit_code=0,.
+0000e630: 2020 2020 2020 2020 2020 2020 6967 6e6f              igno
+0000e640: 7265 5f63 6f6e 6669 673d 5472 7565 2c0a  re_config=True,.
+0000e650: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+0000e660: 6566 2074 6573 745f 7265 7175 6972 6564  ef test_required
+0000e670: 5f76 6572 7369 6f6e 5f64 6f65 735f 6e6f  _version_does_no
+0000e680: 745f 6d61 7463 685f 6f6e 5f6d 696e 6f72  t_match_on_minor
+0000e690: 5f76 6572 7369 6f6e 2873 656c 6629 202d  _version(self) -
+0000e6a0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000e6b0: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
+0000e6c0: 280a 2020 2020 2020 2020 2020 2020 5b22  (.            ["
+0000e6d0: 2d2d 7265 7175 6972 6564 2d76 6572 7369  --required-versi
+0000e6e0: 6f6e 222c 2062 6c61 636b 2e5f 5f76 6572  on", black.__ver
+0000e6f0: 7369 6f6e 5f5f 2e73 706c 6974 2822 2e22  sion__.split("."
+0000e700: 295b 305d 202b 2022 2e39 3939 222c 2022  )[0] + ".999", "
+0000e710: 2d63 222c 2022 3022 5d2c 0a20 2020 2020  -c", "0"],.     
+0000e720: 2020 2020 2020 2065 7869 745f 636f 6465         exit_code
+0000e730: 3d31 2c0a 2020 2020 2020 2020 2020 2020  =1,.            
+0000e740: 6967 6e6f 7265 5f63 6f6e 6669 673d 5472  ignore_config=Tr
+0000e750: 7565 2c0a 2020 2020 2020 2020 290a 0a20  ue,.        ).. 
+0000e760: 2020 2064 6566 2074 6573 745f 7265 7175     def test_requ
+0000e770: 6972 6564 5f76 6572 7369 6f6e 5f64 6f65  ired_version_doe
+0000e780: 735f 6e6f 745f 6d61 7463 685f 7665 7273  s_not_match_vers
+0000e790: 696f 6e28 7365 6c66 2920 2d3e 204e 6f6e  ion(self) -> Non
+0000e7a0: 653a 0a20 2020 2020 2020 2072 6573 756c  e:.        resul
+0000e7b0: 7420 3d20 426c 6163 6b52 756e 6e65 7228  t = BlackRunner(
+0000e7c0: 292e 696e 766f 6b65 280a 2020 2020 2020  ).invoke(.      
+0000e7d0: 2020 2020 2020 626c 6163 6b2e 6d61 696e        black.main
+0000e7e0: 2c0a 2020 2020 2020 2020 2020 2020 5b22  ,.            ["
+0000e7f0: 2d2d 7265 7175 6972 6564 2d76 6572 7369  --required-versi
+0000e800: 6f6e 222c 2022 3230 2e39 3962 222c 2022  on", "20.99b", "
+0000e810: 2d63 222c 2022 3022 5d2c 0a20 2020 2020  -c", "0"],.     
+0000e820: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
+0000e830: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+0000e840: 7375 6c74 2e65 7869 745f 636f 6465 2c20  sult.exit_code, 
+0000e850: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
+0000e860: 6173 7365 7274 496e 2822 7265 7175 6972  assertIn("requir
+0000e870: 6564 2076 6572 7369 6f6e 222c 2072 6573  ed version", res
+0000e880: 756c 742e 7374 6465 7272 290a 0a20 2020  ult.stderr)..   
+0000e890: 2064 6566 2074 6573 745f 7072 6573 6572   def test_preser
+0000e8a0: 7665 735f 6c69 6e65 5f65 6e64 696e 6773  ves_line_endings
+0000e8b0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0000e8c0: 2020 2020 2020 2020 7769 7468 2054 656d          with Tem
+0000e8d0: 706f 7261 7279 4469 7265 6374 6f72 7928  poraryDirectory(
+0000e8e0: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
+0000e8f0: 2020 2020 2020 2020 2020 2020 7465 7374              test
+0000e900: 5f66 696c 6520 3d20 5061 7468 2877 6f72  _file = Path(wor
+0000e910: 6b73 7061 6365 2920 2f20 2274 6573 742e  kspace) / "test.
+0000e920: 7079 220a 2020 2020 2020 2020 2020 2020  py".            
+0000e930: 666f 7220 6e6c 2069 6e20 5b22 5c6e 222c  for nl in ["\n",
+0000e940: 2022 5c72 5c6e 225d 3a0a 2020 2020 2020   "\r\n"]:.      
+0000e950: 2020 2020 2020 2020 2020 636f 6e74 656e            conten
+0000e960: 7473 203d 206e 6c2e 6a6f 696e 285b 2264  ts = nl.join(["d
+0000e970: 6566 2066 2820 2029 3a22 2c20 2220 2020  ef f(  ):", "   
+0000e980: 2070 6173 7322 5d29 0a20 2020 2020 2020   pass"]).       
+0000e990: 2020 2020 2020 2020 2074 6573 745f 6669           test_fi
+0000e9a0: 6c65 2e77 7269 7465 5f62 7974 6573 2863  le.write_bytes(c
+0000e9b0: 6f6e 7465 6e74 732e 656e 636f 6465 2829  ontents.encode()
+0000e9c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000e9d0: 2020 6666 2874 6573 745f 6669 6c65 2c20    ff(test_file, 
+0000e9e0: 7772 6974 655f 6261 636b 3d62 6c61 636b  write_back=black
+0000e9f0: 2e57 7269 7465 4261 636b 2e59 4553 290a  .WriteBack.YES).
+0000ea00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea10: 7570 6461 7465 645f 636f 6e74 656e 7473  updated_contents
+0000ea20: 3a20 6279 7465 7320 3d20 7465 7374 5f66  : bytes = test_f
+0000ea30: 696c 652e 7265 6164 5f62 7974 6573 2829  ile.read_bytes()
+0000ea40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ea50: 2073 656c 662e 6173 7365 7274 496e 286e   self.assertIn(n
+0000ea60: 6c2e 656e 636f 6465 2829 2c20 7570 6461  l.encode(), upda
+0000ea70: 7465 645f 636f 6e74 656e 7473 290a 2020  ted_contents).  
+0000ea80: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000ea90: 206e 6c20 3d3d 2022 5c6e 223a 0a20 2020   nl == "\n":.   
+0000eaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eab0: 2073 656c 662e 6173 7365 7274 4e6f 7449   self.assertNotI
+0000eac0: 6e28 6222 5c72 5c6e 222c 2075 7064 6174  n(b"\r\n", updat
+0000ead0: 6564 5f63 6f6e 7465 6e74 7329 0a0a 2020  ed_contents)..  
+0000eae0: 2020 6465 6620 7465 7374 5f70 7265 7365    def test_prese
+0000eaf0: 7276 6573 5f6c 696e 655f 656e 6469 6e67  rves_line_ending
+0000eb00: 735f 7669 615f 7374 6469 6e28 7365 6c66  s_via_stdin(self
+0000eb10: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000eb20: 2020 2066 6f72 206e 6c20 696e 205b 225c     for nl in ["\
+0000eb30: 6e22 2c20 225c 725c 6e22 5d3a 0a20 2020  n", "\r\n"]:.   
+0000eb40: 2020 2020 2020 2020 2063 6f6e 7465 6e74           content
+0000eb50: 7320 3d20 6e6c 2e6a 6f69 6e28 5b22 6465  s = nl.join(["de
+0000eb60: 6620 6628 2020 293a 222c 2022 2020 2020  f f(  ):", "    
+0000eb70: 7061 7373 225d 290a 2020 2020 2020 2020  pass"]).        
+0000eb80: 2020 2020 7275 6e6e 6572 203d 2042 6c61      runner = Bla
+0000eb90: 636b 5275 6e6e 6572 2829 0a20 2020 2020  ckRunner().     
+0000eba0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+0000ebb0: 7275 6e6e 6572 2e69 6e76 6f6b 6528 0a20  runner.invoke(. 
+0000ebc0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0000ebd0: 6c61 636b 2e6d 6169 6e2c 205b 222d 222c  lack.main, ["-",
+0000ebe0: 2022 2d2d 6661 7374 225d 2c20 696e 7075   "--fast"], inpu
+0000ebf0: 743d 4279 7465 7349 4f28 636f 6e74 656e  t=BytesIO(conten
+0000ec00: 7473 2e65 6e63 6f64 6528 2275 7466 2d38  ts.encode("utf-8
+0000ec10: 2229 290a 2020 2020 2020 2020 2020 2020  ")).            
+0000ec20: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0000ec30: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+0000ec40: 6573 756c 742e 6578 6974 5f63 6f64 652c  esult.exit_code,
+0000ec50: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
+0000ec60: 6f75 7470 7574 203d 2072 6573 756c 742e  output = result.
+0000ec70: 7374 646f 7574 5f62 7974 6573 0a20 2020  stdout_bytes.   
+0000ec80: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+0000ec90: 7365 7274 496e 286e 6c2e 656e 636f 6465  sertIn(nl.encode
+0000eca0: 2822 7574 662d 3822 292c 206f 7574 7075  ("utf-8"), outpu
+0000ecb0: 7429 0a20 2020 2020 2020 2020 2020 2069  t).            i
+0000ecc0: 6620 6e6c 203d 3d20 225c 6e22 3a0a 2020  f nl == "\n":.  
+0000ecd0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000ece0: 6c66 2e61 7373 6572 744e 6f74 496e 2862  lf.assertNotIn(b
+0000ecf0: 225c 725c 6e22 2c20 6f75 7470 7574 290a  "\r\n", output).
+0000ed00: 0a20 2020 2064 6566 2074 6573 745f 6e6f  .    def test_no
+0000ed10: 726d 616c 697a 655f 6c69 6e65 5f65 6e64  rmalize_line_end
+0000ed20: 696e 6773 2873 656c 6629 202d 3e20 4e6f  ings(self) -> No
+0000ed30: 6e65 3a0a 2020 2020 2020 2020 7769 7468  ne:.        with
+0000ed40: 2054 656d 706f 7261 7279 4469 7265 6374   TemporaryDirect
+0000ed50: 6f72 7928 2920 6173 2077 6f72 6b73 7061  ory() as workspa
+0000ed60: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+0000ed70: 7465 7374 5f66 696c 6520 3d20 5061 7468  test_file = Path
+0000ed80: 2877 6f72 6b73 7061 6365 2920 2f20 2274  (workspace) / "t
+0000ed90: 6573 742e 7079 220a 2020 2020 2020 2020  est.py".        
+0000eda0: 2020 2020 666f 7220 6461 7461 2c20 6578      for data, ex
+0000edb0: 7065 6374 6564 2069 6e20 280a 2020 2020  pected in (.    
+0000edc0: 2020 2020 2020 2020 2020 2020 2862 2263              (b"c
+0000edd0: 5c72 5c6e 635c 6e20 222c 2062 2263 5c72  \r\nc\n ", b"c\r
+0000ede0: 5c6e 635c 725c 6e22 292c 0a20 2020 2020  \nc\r\n"),.     
+0000edf0: 2020 2020 2020 2020 2020 2028 6222 6c5c             (b"l\
+0000ee00: 6e6c 5c72 5c6e 2022 2c20 6222 6c5c 6e6c  nl\r\n ", b"l\nl
+0000ee10: 5c6e 2229 2c0a 2020 2020 2020 2020 2020  \n"),.          
+0000ee20: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+0000ee30: 2020 2020 2074 6573 745f 6669 6c65 2e77       test_file.w
+0000ee40: 7269 7465 5f62 7974 6573 2864 6174 6129  rite_bytes(data)
+0000ee50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ee60: 2066 6628 7465 7374 5f66 696c 652c 2077   ff(test_file, w
+0000ee70: 7269 7465 5f62 6163 6b3d 626c 6163 6b2e  rite_back=black.
+0000ee80: 5772 6974 6542 6163 6b2e 5945 5329 0a20  WriteBack.YES). 
+0000ee90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000eea0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000eeb0: 7465 7374 5f66 696c 652e 7265 6164 5f62  test_file.read_b
+0000eec0: 7974 6573 2829 2c20 6578 7065 6374 6564  ytes(), expected
+0000eed0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+0000eee0: 726f 6f74 5f6c 6f67 6765 725f 6e6f 745f  root_logger_not_
+0000eef0: 7573 6564 5f64 6972 6563 746c 7928 7365  used_directly(se
+0000ef00: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000ef10: 2020 2020 2064 6566 2066 6169 6c28 2a61       def fail(*a
+0000ef20: 7267 733a 2041 6e79 2c20 2a2a 6b77 6172  rgs: Any, **kwar
+0000ef30: 6773 3a20 416e 7929 202d 3e20 4e6f 6e65  gs: Any) -> None
+0000ef40: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000ef50: 6c66 2e66 6169 6c28 2252 6563 6f72 6420  lf.fail("Record 
+0000ef60: 6372 6561 7465 6420 7769 7468 2072 6f6f  created with roo
+0000ef70: 7420 6c6f 6767 6572 2229 0a0a 2020 2020  t logger")..    
+0000ef80: 2020 2020 7769 7468 2070 6174 6368 2e6d      with patch.m
+0000ef90: 756c 7469 706c 6528 0a20 2020 2020 2020  ultiple(.       
+0000efa0: 2020 2020 206c 6f67 6769 6e67 2e72 6f6f       logging.roo
+0000efb0: 742c 0a20 2020 2020 2020 2020 2020 2064  t,.            d
+0000efc0: 6562 7567 3d66 6169 6c2c 0a20 2020 2020  ebug=fail,.     
+0000efd0: 2020 2020 2020 2069 6e66 6f3d 6661 696c         info=fail
+0000efe0: 2c0a 2020 2020 2020 2020 2020 2020 7761  ,.            wa
+0000eff0: 726e 696e 673d 6661 696c 2c0a 2020 2020  rning=fail,.    
+0000f000: 2020 2020 2020 2020 6572 726f 723d 6661          error=fa
+0000f010: 696c 2c0a 2020 2020 2020 2020 2020 2020  il,.            
+0000f020: 6372 6974 6963 616c 3d66 6169 6c2c 0a20  critical=fail,. 
+0000f030: 2020 2020 2020 2020 2020 206c 6f67 3d66             log=f
+0000f040: 6169 6c2c 0a20 2020 2020 2020 2029 3a0a  ail,.        ):.
+0000f050: 2020 2020 2020 2020 2020 2020 6666 2854              ff(T
+0000f060: 4849 535f 4449 5220 2f20 2275 7469 6c2e  HIS_DIR / "util.
+0000f070: 7079 2229 0a0a 2020 2020 6465 6620 7465  py")..    def te
+0000f080: 7374 5f69 6e76 616c 6964 5f63 6f6e 6669  st_invalid_confi
+0000f090: 675f 7265 7475 726e 5f63 6f64 6528 7365  g_return_code(se
+0000f0a0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000f0b0: 2020 2020 2074 6d70 5f66 696c 6520 3d20       tmp_file = 
+0000f0c0: 5061 7468 2862 6c61 636b 2e64 756d 705f  Path(black.dump_
+0000f0d0: 746f 5f66 696c 6528 2929 0a20 2020 2020  to_file()).     
+0000f0e0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000f0f0: 2020 2020 746d 705f 636f 6e66 6967 203d      tmp_config =
+0000f100: 2050 6174 6828 626c 6163 6b2e 6475 6d70   Path(black.dump
+0000f110: 5f74 6f5f 6669 6c65 2829 290a 2020 2020  _to_file()).    
+0000f120: 2020 2020 2020 2020 746d 705f 636f 6e66          tmp_conf
+0000f130: 6967 2e75 6e6c 696e 6b28 290a 2020 2020  ig.unlink().    
+0000f140: 2020 2020 2020 2020 6172 6773 203d 205b          args = [
+0000f150: 222d 2d63 6f6e 6669 6722 2c20 7374 7228  "--config", str(
+0000f160: 746d 705f 636f 6e66 6967 292c 2073 7472  tmp_config), str
+0000f170: 2874 6d70 5f66 696c 6529 5d0a 2020 2020  (tmp_file)].    
+0000f180: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
+0000f190: 6f6b 6542 6c61 636b 2861 7267 732c 2065  okeBlack(args, e
+0000f1a0: 7869 745f 636f 6465 3d32 2c20 6967 6e6f  xit_code=2, igno
+0000f1b0: 7265 5f63 6f6e 6669 673d 4661 6c73 6529  re_config=False)
+0000f1c0: 0a20 2020 2020 2020 2066 696e 616c 6c79  .        finally
+0000f1d0: 3a0a 2020 2020 2020 2020 2020 2020 746d  :.            tm
+0000f1e0: 705f 6669 6c65 2e75 6e6c 696e 6b28 290a  p_file.unlink().
+0000f1f0: 0a20 2020 2064 6566 2074 6573 745f 7061  .    def test_pa
+0000f200: 7273 655f 7079 7072 6f6a 6563 745f 746f  rse_pyproject_to
+0000f210: 6d6c 2873 656c 6629 202d 3e20 4e6f 6e65  ml(self) -> None
+0000f220: 3a0a 2020 2020 2020 2020 7465 7374 5f74  :.        test_t
+0000f230: 6f6d 6c5f 6669 6c65 203d 2054 4849 535f  oml_file = THIS_
+0000f240: 4449 5220 2f20 2274 6573 742e 746f 6d6c  DIR / "test.toml
+0000f250: 220a 2020 2020 2020 2020 636f 6e66 6967  ".        config
+0000f260: 203d 2062 6c61 636b 2e70 6172 7365 5f70   = black.parse_p
+0000f270: 7970 726f 6a65 6374 5f74 6f6d 6c28 7374  yproject_toml(st
+0000f280: 7228 7465 7374 5f74 6f6d 6c5f 6669 6c65  r(test_toml_file
+0000f290: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+0000f2a0: 6173 7365 7274 4571 7561 6c28 636f 6e66  assertEqual(conf
+0000f2b0: 6967 5b22 7665 7262 6f73 6522 5d2c 2031  ig["verbose"], 1
+0000f2c0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000f2d0: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
+0000f2e0: 675b 2263 6865 636b 225d 2c20 226e 6f22  g["check"], "no"
+0000f2f0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000f300: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
+0000f310: 675b 2264 6966 6622 5d2c 2022 7922 290a  g["diff"], "y").
+0000f320: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000f330: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
+0000f340: 2263 6f6c 6f72 225d 2c20 5472 7565 290a  "color"], True).
+0000f350: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000f360: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
+0000f370: 226c 696e 655f 6c65 6e67 7468 225d 2c20  "line_length"], 
+0000f380: 3739 290a 2020 2020 2020 2020 7365 6c66  79).        self
+0000f390: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
+0000f3a0: 6669 675b 2274 6172 6765 745f 7665 7273  fig["target_vers
+0000f3b0: 696f 6e22 5d2c 205b 2270 7933 3622 2c20  ion"], ["py36", 
+0000f3c0: 2270 7933 3722 2c20 2270 7933 3822 5d29  "py37", "py38"])
+0000f3d0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000f3e0: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
+0000f3f0: 5b22 7079 7468 6f6e 5f63 656c 6c5f 6d61  ["python_cell_ma
+0000f400: 6769 6373 225d 2c20 5b22 6375 7374 6f6d  gics"], ["custom
+0000f410: 3122 2c20 2263 7573 746f 6d32 225d 290a  1", "custom2"]).
+0000f420: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000f430: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
+0000f440: 2265 7863 6c75 6465 225d 2c20 7222 5c2e  "exclude"], r"\.
+0000f450: 7079 693f 2422 290a 2020 2020 2020 2020  pyi?$").        
+0000f460: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000f470: 2863 6f6e 6669 675b 2269 6e63 6c75 6465  (config["include
+0000f480: 225d 2c20 7222 5c2e 7079 3f24 2229 0a0a  "], r"\.py?$")..
+0000f490: 2020 2020 6465 6620 7465 7374 5f73 7065      def test_spe
+0000f4a0: 6c6c 6368 6563 6b5f 7079 7072 6f6a 6563  llcheck_pyprojec
+0000f4b0: 745f 746f 6d6c 2873 656c 6629 202d 3e20  t_toml(self) -> 
+0000f4c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7465  None:.        te
+0000f4d0: 7374 5f74 6f6d 6c5f 6669 6c65 203d 2054  st_toml_file = T
+0000f4e0: 4849 535f 4449 5220 2f20 2264 6174 6122  HIS_DIR / "data"
+0000f4f0: 202f 2022 696e 636f 7272 6563 745f 7370   / "incorrect_sp
+0000f500: 656c 6c69 6e67 2e74 6f6d 6c22 0a20 2020  elling.toml".   
+0000f510: 2020 2020 2072 6573 756c 7420 3d20 426c       result = Bl
+0000f520: 6163 6b52 756e 6e65 7228 292e 696e 766f  ackRunner().invo
+0000f530: 6b65 280a 2020 2020 2020 2020 2020 2020  ke(.            
+0000f540: 626c 6163 6b2e 6d61 696e 2c0a 2020 2020  black.main,.    
+0000f550: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
+0000f560: 2020 2020 2020 2020 2020 222d 2d63 6f64            "--cod
+0000f570: 653d 7072 696e 7428 2768 656c 6c6f 2077  e=print('hello w
+0000f580: 6f72 6c64 2729 222c 0a20 2020 2020 2020  orld')",.       
+0000f590: 2020 2020 2020 2020 2022 2d2d 7665 7262           "--verb
+0000f5a0: 6f73 6522 2c0a 2020 2020 2020 2020 2020  ose",.          
+0000f5b0: 2020 2020 2020 6622 2d2d 636f 6e66 6967        f"--config
+0000f5c0: 3d7b 7374 7228 7465 7374 5f74 6f6d 6c5f  ={str(test_toml_
+0000f5d0: 6669 6c65 297d 222c 0a20 2020 2020 2020  file)}",.       
+0000f5e0: 2020 2020 205d 2c0a 2020 2020 2020 2020       ],.        
+0000f5f0: 290a 0a20 2020 2020 2020 2061 7373 6572  )..        asser
+0000f600: 7420 280a 2020 2020 2020 2020 2020 2020  t (.            
+0000f610: 7222 496e 7661 6c69 6420 636f 6e66 6967  r"Invalid config
+0000f620: 206b 6579 7320 6465 7465 6374 6564 3a20   keys detected: 
+0000f630: 2769 6e65 5f6c 656e 6774 6827 2c20 2774  'ine_length', 't
+0000f640: 6172 6765 745f 6572 7369 6f6e 2720 2869  arget_ersion' (i
+0000f650: 6e22 0a20 2020 2020 2020 2020 2020 2072  n".            r
+0000f660: 6622 207b 7465 7374 5f74 6f6d 6c5f 6669  f" {test_toml_fi
+0000f670: 6c65 7d29 2220 696e 2072 6573 756c 742e  le})" in result.
+0000f680: 7374 6465 7272 0a20 2020 2020 2020 2029  stderr.        )
+0000f690: 0a0a 2020 2020 6465 6620 7465 7374 5f70  ..    def test_p
+0000f6a0: 6172 7365 5f70 7970 726f 6a65 6374 5f74  arse_pyproject_t
+0000f6b0: 6f6d 6c5f 7072 6f6a 6563 745f 6d65 7461  oml_project_meta
+0000f6c0: 6461 7461 2873 656c 6629 202d 3e20 4e6f  data(self) -> No
+0000f6d0: 6e65 3a0a 2020 2020 2020 2020 666f 7220  ne:.        for 
+0000f6e0: 7465 7374 5f74 6f6d 6c2c 2065 7870 6563  test_toml, expec
+0000f6f0: 7465 6420 696e 205b 0a20 2020 2020 2020  ted in [.       
+0000f700: 2020 2020 2028 226f 6e6c 795f 626c 6163       ("only_blac
+0000f710: 6b5f 7079 7072 6f6a 6563 742e 746f 6d6c  k_pyproject.toml
+0000f720: 222c 205b 2270 7933 3130 225d 292c 0a20  ", ["py310"]),. 
+0000f730: 2020 2020 2020 2020 2020 2028 226f 6e6c             ("onl
+0000f740: 795f 6d65 7461 6461 7461 5f70 7970 726f  y_metadata_pypro
+0000f750: 6a65 6374 2e74 6f6d 6c22 2c20 5b22 7079  ject.toml", ["py
+0000f760: 3337 222c 2022 7079 3338 222c 2022 7079  37", "py38", "py
+0000f770: 3339 222c 2022 7079 3331 3022 5d29 2c0a  39", "py310"]),.
+0000f780: 2020 2020 2020 2020 2020 2020 2822 6e65              ("ne
+0000f790: 6974 6865 725f 7079 7072 6f6a 6563 742e  ither_pyproject.
+0000f7a0: 746f 6d6c 222c 204e 6f6e 6529 2c0a 2020  toml", None),.  
+0000f7b0: 2020 2020 2020 2020 2020 2822 626f 7468            ("both
+0000f7c0: 5f70 7970 726f 6a65 6374 2e74 6f6d 6c22  _pyproject.toml"
+0000f7d0: 2c20 5b22 7079 3331 3022 5d29 2c0a 2020  , ["py310"]),.  
+0000f7e0: 2020 2020 2020 5d3a 0a20 2020 2020 2020        ]:.       
+0000f7f0: 2020 2020 2074 6573 745f 746f 6d6c 5f66       test_toml_f
+0000f800: 696c 6520 3d20 5448 4953 5f44 4952 202f  ile = THIS_DIR /
+0000f810: 2022 6461 7461 2220 2f20 2270 726f 6a65   "data" / "proje
+0000f820: 6374 5f6d 6574 6164 6174 6122 202f 2074  ct_metadata" / t
+0000f830: 6573 745f 746f 6d6c 0a20 2020 2020 2020  est_toml.       
+0000f840: 2020 2020 2063 6f6e 6669 6720 3d20 626c       config = bl
+0000f850: 6163 6b2e 7061 7273 655f 7079 7072 6f6a  ack.parse_pyproj
+0000f860: 6563 745f 746f 6d6c 2873 7472 2874 6573  ect_toml(str(tes
+0000f870: 745f 746f 6d6c 5f66 696c 6529 290a 2020  t_toml_file)).  
+0000f880: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0000f890: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
+0000f8a0: 672e 6765 7428 2274 6172 6765 745f 7665  g.get("target_ve
+0000f8b0: 7273 696f 6e22 292c 2065 7870 6563 7465  rsion"), expecte
+0000f8c0: 6429 0a0a 2020 2020 6465 6620 7465 7374  d)..    def test
+0000f8d0: 5f69 6e66 6572 5f74 6172 6765 745f 7665  _infer_target_ve
+0000f8e0: 7273 696f 6e28 7365 6c66 2920 2d3e 204e  rsion(self) -> N
+0000f8f0: 6f6e 653a 0a20 2020 2020 2020 2066 6f72  one:.        for
+0000f900: 2076 6572 7369 6f6e 2c20 6578 7065 6374   version, expect
+0000f910: 6564 2069 6e20 5b0a 2020 2020 2020 2020  ed in [.        
+0000f920: 2020 2020 2822 332e 3622 2c20 5b54 6172      ("3.6", [Tar
+0000f930: 6765 7456 6572 7369 6f6e 2e50 5933 365d  getVersion.PY36]
+0000f940: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
+0000f950: 2233 2e31 312e 3072 6331 222c 205b 5461  "3.11.0rc1", [Ta
+0000f960: 7267 6574 5665 7273 696f 6e2e 5059 3331  rgetVersion.PY31
+0000f970: 315d 292c 0a20 2020 2020 2020 2020 2020  1]),.           
+0000f980: 2028 223e 3d33 2e31 3022 2c20 5b54 6172   (">=3.10", [Tar
+0000f990: 6765 7456 6572 7369 6f6e 2e50 5933 3130  getVersion.PY310
+0000f9a0: 2c20 5461 7267 6574 5665 7273 696f 6e2e  , TargetVersion.
+0000f9b0: 5059 3331 312c 2054 6172 6765 7456 6572  PY311, TargetVer
+0000f9c0: 7369 6f6e 2e50 5933 3132 5d29 2c0a 2020  sion.PY312]),.  
+0000f9d0: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
+0000f9e0: 2020 2020 2020 2020 2020 2020 223e 3d33              ">=3
+0000f9f0: 2e31 302e 3622 2c0a 2020 2020 2020 2020  .10.6",.        
+0000fa00: 2020 2020 2020 2020 5b54 6172 6765 7456          [TargetV
+0000fa10: 6572 7369 6f6e 2e50 5933 3130 2c20 5461  ersion.PY310, Ta
+0000fa20: 7267 6574 5665 7273 696f 6e2e 5059 3331  rgetVersion.PY31
+0000fa30: 312c 2054 6172 6765 7456 6572 7369 6f6e  1, TargetVersion
+0000fa40: 2e50 5933 3132 5d2c 0a20 2020 2020 2020  .PY312],.       
+0000fa50: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+0000fa60: 2020 2020 2822 3c33 2e36 222c 205b 5461      ("<3.6", [Ta
+0000fa70: 7267 6574 5665 7273 696f 6e2e 5059 3333  rgetVersion.PY33
+0000fa80: 2c20 5461 7267 6574 5665 7273 696f 6e2e  , TargetVersion.
+0000fa90: 5059 3334 2c20 5461 7267 6574 5665 7273  PY34, TargetVers
+0000faa0: 696f 6e2e 5059 3335 5d29 2c0a 2020 2020  ion.PY35]),.    
+0000fab0: 2020 2020 2020 2020 2822 3e33 2e37 2c3c          (">3.7,<
+0000fac0: 332e 3130 222c 205b 5461 7267 6574 5665  3.10", [TargetVe
+0000fad0: 7273 696f 6e2e 5059 3338 2c20 5461 7267  rsion.PY38, Targ
+0000fae0: 6574 5665 7273 696f 6e2e 5059 3339 5d29  etVersion.PY39])
+0000faf0: 2c0a 2020 2020 2020 2020 2020 2020 280a  ,.            (.
+0000fb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb10: 223e 332e 372c 213d 332e 382c 213d 332e  ">3.7,!=3.8,!=3.
+0000fb20: 3922 2c0a 2020 2020 2020 2020 2020 2020  9",.            
+0000fb30: 2020 2020 5b54 6172 6765 7456 6572 7369      [TargetVersi
+0000fb40: 6f6e 2e50 5933 3130 2c20 5461 7267 6574  on.PY310, Target
+0000fb50: 5665 7273 696f 6e2e 5059 3331 312c 2054  Version.PY311, T
+0000fb60: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
+0000fb70: 3132 5d2c 0a20 2020 2020 2020 2020 2020  12],.           
+0000fb80: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
+0000fb90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000fba0: 2020 223e 2033 2e39 2e34 2c20 213d 2033    "> 3.9.4, != 3
+0000fbb0: 2e31 302e 3322 2c0a 2020 2020 2020 2020  .10.3",.        
+0000fbc0: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
+0000fbd0: 2020 2020 2020 2020 2020 2020 2020 5461                Ta
+0000fbe0: 7267 6574 5665 7273 696f 6e2e 5059 3339  rgetVersion.PY39
+0000fbf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000fc00: 2020 2020 2020 5461 7267 6574 5665 7273        TargetVers
+0000fc10: 696f 6e2e 5059 3331 302c 0a20 2020 2020  ion.PY310,.     
+0000fc20: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+0000fc30: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
+0000fc40: 3131 2c0a 2020 2020 2020 2020 2020 2020  11,.            
+0000fc50: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+0000fc60: 7273 696f 6e2e 5059 3331 322c 0a20 2020  rsion.PY312,.   
+0000fc70: 2020 2020 2020 2020 2020 2020 205d 2c0a               ],.
+0000fc80: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+0000fc90: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
+0000fca0: 2020 2020 2020 2020 2020 2020 2022 213d               "!=
+0000fcb0: 332e 332c 213d 332e 3422 2c0a 2020 2020  3.3,!=3.4",.    
+0000fcc0: 2020 2020 2020 2020 2020 2020 5b0a 2020              [.  
+0000fcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fce0: 2020 5461 7267 6574 5665 7273 696f 6e2e    TargetVersion.
+0000fcf0: 5059 3335 2c0a 2020 2020 2020 2020 2020  PY35,.          
+0000fd00: 2020 2020 2020 2020 2020 5461 7267 6574            Target
+0000fd10: 5665 7273 696f 6e2e 5059 3336 2c0a 2020  Version.PY36,.  
+0000fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd30: 2020 5461 7267 6574 5665 7273 696f 6e2e    TargetVersion.
+0000fd40: 5059 3337 2c0a 2020 2020 2020 2020 2020  PY37,.          
+0000fd50: 2020 2020 2020 2020 2020 5461 7267 6574            Target
+0000fd60: 5665 7273 696f 6e2e 5059 3338 2c0a 2020  Version.PY38,.  
+0000fd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd80: 2020 5461 7267 6574 5665 7273 696f 6e2e    TargetVersion.
+0000fd90: 5059 3339 2c0a 2020 2020 2020 2020 2020  PY39,.          
+0000fda0: 2020 2020 2020 2020 2020 5461 7267 6574            Target
+0000fdb0: 5665 7273 696f 6e2e 5059 3331 302c 0a20  Version.PY310,. 
+0000fdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fdd0: 2020 2054 6172 6765 7456 6572 7369 6f6e     TargetVersion
+0000fde0: 2e50 5933 3131 2c0a 2020 2020 2020 2020  .PY311,.        
+0000fdf0: 2020 2020 2020 2020 2020 2020 5461 7267              Targ
+0000fe00: 6574 5665 7273 696f 6e2e 5059 3331 322c  etVersion.PY312,
+0000fe10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fe20: 205d 2c0a 2020 2020 2020 2020 2020 2020   ],.            
+0000fe30: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
+0000fe40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fe50: 2022 3d3d 332e 2a22 2c0a 2020 2020 2020   "==3.*",.      
+0000fe60: 2020 2020 2020 2020 2020 5b0a 2020 2020            [.    
+0000fe70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe80: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+0000fe90: 3333 2c0a 2020 2020 2020 2020 2020 2020  33,.            
+0000fea0: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+0000feb0: 7273 696f 6e2e 5059 3334 2c0a 2020 2020  rsion.PY34,.    
+0000fec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fed0: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+0000fee0: 3335 2c0a 2020 2020 2020 2020 2020 2020  35,.            
+0000fef0: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+0000ff00: 7273 696f 6e2e 5059 3336 2c0a 2020 2020  rsion.PY36,.    
+0000ff10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff20: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+0000ff30: 3337 2c0a 2020 2020 2020 2020 2020 2020  37,.            
+0000ff40: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+0000ff50: 7273 696f 6e2e 5059 3338 2c0a 2020 2020  rsion.PY38,.    
+0000ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff70: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+0000ff80: 3339 2c0a 2020 2020 2020 2020 2020 2020  39,.            
+0000ff90: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+0000ffa0: 7273 696f 6e2e 5059 3331 302c 0a20 2020  rsion.PY310,.   
+0000ffb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffc0: 2054 6172 6765 7456 6572 7369 6f6e 2e50   TargetVersion.P
+0000ffd0: 5933 3131 2c0a 2020 2020 2020 2020 2020  Y311,.          
+0000ffe0: 2020 2020 2020 2020 2020 5461 7267 6574            Target
+0000fff0: 5665 7273 696f 6e2e 5059 3331 322c 0a20  Version.PY312,. 
+00010000: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+00010010: 2c0a 2020 2020 2020 2020 2020 2020 292c  ,.            ),
+00010020: 0a20 2020 2020 2020 2020 2020 2028 223d  .            ("=
+00010030: 3d33 2e38 2e2a 222c 205b 5461 7267 6574  =3.8.*", [Target
+00010040: 5665 7273 696f 6e2e 5059 3338 5d29 2c0a  Version.PY38]),.
+00010050: 2020 2020 2020 2020 2020 2020 284e 6f6e              (Non
+00010060: 652c 204e 6f6e 6529 2c0a 2020 2020 2020  e, None),.      
+00010070: 2020 2020 2020 2822 222c 204e 6f6e 6529        ("", None)
+00010080: 2c0a 2020 2020 2020 2020 2020 2020 2822  ,.            ("
+00010090: 696e 7661 6c69 6422 2c20 4e6f 6e65 292c  invalid", None),
+000100a0: 0a20 2020 2020 2020 2020 2020 2028 223d  .            ("=
+000100b0: 3d69 6e76 616c 6964 222c 204e 6f6e 6529  =invalid", None)
+000100c0: 2c0a 2020 2020 2020 2020 2020 2020 2822  ,.            ("
+000100d0: 3e33 2e39 2c21 3d69 6e76 616c 6964 222c  >3.9,!=invalid",
+000100e0: 204e 6f6e 6529 2c0a 2020 2020 2020 2020   None),.        
+000100f0: 2020 2020 2822 3322 2c20 4e6f 6e65 292c      ("3", None),
+00010100: 0a20 2020 2020 2020 2020 2020 2028 2233  .            ("3
+00010110: 2e32 222c 204e 6f6e 6529 2c0a 2020 2020  .2", None),.    
+00010120: 2020 2020 2020 2020 2822 322e 372e 3138          ("2.7.18
+00010130: 222c 204e 6f6e 6529 2c0a 2020 2020 2020  ", None),.      
+00010140: 2020 2020 2020 2822 3d3d 322e 3722 2c20        ("==2.7", 
+00010150: 4e6f 6e65 292c 0a20 2020 2020 2020 2020  None),.         
+00010160: 2020 2028 223e 332e 3130 2c3c 332e 3131     (">3.10,<3.11
+00010170: 222c 204e 6f6e 6529 2c0a 2020 2020 2020  ", None),.      
+00010180: 2020 5d3a 0a20 2020 2020 2020 2020 2020    ]:.           
+00010190: 2074 6573 745f 746f 6d6c 203d 207b 2270   test_toml = {"p
+000101a0: 726f 6a65 6374 223a 207b 2272 6571 7569  roject": {"requi
+000101b0: 7265 732d 7079 7468 6f6e 223a 2076 6572  res-python": ver
+000101c0: 7369 6f6e 7d7d 0a20 2020 2020 2020 2020  sion}}.         
+000101d0: 2020 2072 6573 756c 7420 3d20 626c 6163     result = blac
+000101e0: 6b2e 6669 6c65 732e 696e 6665 725f 7461  k.files.infer_ta
+000101f0: 7267 6574 5f76 6572 7369 6f6e 2874 6573  rget_version(tes
+00010200: 745f 746f 6d6c 290a 2020 2020 2020 2020  t_toml).        
+00010210: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00010220: 7175 616c 2872 6573 756c 742c 2065 7870  qual(result, exp
+00010230: 6563 7465 6429 0a0a 2020 2020 6465 6620  ected)..    def 
+00010240: 7465 7374 5f72 6561 645f 7079 7072 6f6a  test_read_pyproj
+00010250: 6563 745f 746f 6d6c 2873 656c 6629 202d  ect_toml(self) -
+00010260: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00010270: 7465 7374 5f74 6f6d 6c5f 6669 6c65 203d  test_toml_file =
+00010280: 2054 4849 535f 4449 5220 2f20 2274 6573   THIS_DIR / "tes
+00010290: 742e 746f 6d6c 220a 2020 2020 2020 2020  t.toml".        
+000102a0: 6661 6b65 5f63 7478 203d 2046 616b 6543  fake_ctx = FakeC
+000102b0: 6f6e 7465 7874 2829 0a20 2020 2020 2020  ontext().       
+000102c0: 2062 6c61 636b 2e72 6561 645f 7079 7072   black.read_pypr
+000102d0: 6f6a 6563 745f 746f 6d6c 2866 616b 655f  oject_toml(fake_
+000102e0: 6374 782c 2046 616b 6550 6172 616d 6574  ctx, FakeParamet
+000102f0: 6572 2829 2c20 7374 7228 7465 7374 5f74  er(), str(test_t
+00010300: 6f6d 6c5f 6669 6c65 2929 0a20 2020 2020  oml_file)).     
+00010310: 2020 2063 6f6e 6669 6720 3d20 6661 6b65     config = fake
+00010320: 5f63 7478 2e64 6566 6175 6c74 5f6d 6170  _ctx.default_map
+00010330: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00010340: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
+00010350: 5b22 7665 7262 6f73 6522 5d2c 2022 3122  ["verbose"], "1"
+00010360: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00010370: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
+00010380: 675b 2263 6865 636b 225d 2c20 226e 6f22  g["check"], "no"
+00010390: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+000103a0: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
+000103b0: 675b 2264 6966 6622 5d2c 2022 7922 290a  g["diff"], "y").
+000103c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000103d0: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
+000103e0: 2263 6f6c 6f72 225d 2c20 2254 7275 6522  "color"], "True"
+000103f0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00010400: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
+00010410: 675b 226c 696e 655f 6c65 6e67 7468 225d  g["line_length"]
+00010420: 2c20 2237 3922 290a 2020 2020 2020 2020  , "79").        
+00010430: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00010440: 2863 6f6e 6669 675b 2274 6172 6765 745f  (config["target_
+00010450: 7665 7273 696f 6e22 5d2c 205b 2270 7933  version"], ["py3
+00010460: 3622 2c20 2270 7933 3722 2c20 2270 7933  6", "py37", "py3
+00010470: 3822 5d29 0a20 2020 2020 2020 2073 656c  8"]).        sel
+00010480: 662e 6173 7365 7274 4571 7561 6c28 636f  f.assertEqual(co
+00010490: 6e66 6967 5b22 6578 636c 7564 6522 5d2c  nfig["exclude"],
+000104a0: 2072 225c 2e70 7969 3f24 2229 0a20 2020   r"\.pyi?$").   
+000104b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000104c0: 4571 7561 6c28 636f 6e66 6967 5b22 696e  Equal(config["in
+000104d0: 636c 7564 6522 5d2c 2072 225c 2e70 793f  clude"], r"\.py?
+000104e0: 2422 290a 0a20 2020 2064 6566 2074 6573  $")..    def tes
+000104f0: 745f 7265 6164 5f70 7970 726f 6a65 6374  t_read_pyproject
+00010500: 5f74 6f6d 6c5f 6672 6f6d 5f73 7464 696e  _toml_from_stdin
+00010510: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00010520: 2020 2020 2020 2020 7769 7468 2054 656d          with Tem
+00010530: 706f 7261 7279 4469 7265 6374 6f72 7928  poraryDirectory(
+00010540: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
+00010550: 2020 2020 2020 2020 2020 2020 726f 6f74              root
+00010560: 203d 2050 6174 6828 776f 726b 7370 6163   = Path(workspac
+00010570: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
+00010580: 7372 635f 6469 7220 3d20 726f 6f74 202f  src_dir = root /
+00010590: 2022 7372 6322 0a20 2020 2020 2020 2020   "src".         
+000105a0: 2020 2073 7263 5f64 6972 2e6d 6b64 6972     src_dir.mkdir
+000105b0: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+000105c0: 7372 635f 7079 7072 6f6a 6563 7420 3d20  src_pyproject = 
+000105d0: 7372 635f 6469 7220 2f20 2270 7970 726f  src_dir / "pypro
+000105e0: 6a65 6374 2e74 6f6d 6c22 0a20 2020 2020  ject.toml".     
+000105f0: 2020 2020 2020 2073 7263 5f70 7970 726f         src_pypro
+00010600: 6a65 6374 2e74 6f75 6368 2829 0a0a 2020  ject.touch()..  
+00010610: 2020 2020 2020 2020 2020 7465 7374 5f74            test_t
+00010620: 6f6d 6c5f 636f 6e74 656e 7420 3d20 2854  oml_content = (T
+00010630: 4849 535f 4449 5220 2f20 2274 6573 742e  HIS_DIR / "test.
+00010640: 746f 6d6c 2229 2e72 6561 645f 7465 7874  toml").read_text
+00010650: 2865 6e63 6f64 696e 673d 2275 7466 2d38  (encoding="utf-8
+00010660: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+00010670: 7263 5f70 7970 726f 6a65 6374 2e77 7269  rc_pyproject.wri
+00010680: 7465 5f74 6578 7428 7465 7374 5f74 6f6d  te_text(test_tom
+00010690: 6c5f 636f 6e74 656e 742c 2065 6e63 6f64  l_content, encod
+000106a0: 696e 673d 2275 7466 2d38 2229 0a0a 2020  ing="utf-8")..  
+000106b0: 2020 2020 2020 2020 2020 7372 635f 7079            src_py
+000106c0: 7468 6f6e 203d 2073 7263 5f64 6972 202f  thon = src_dir /
+000106d0: 2022 666f 6f2e 7079 220a 2020 2020 2020   "foo.py".      
+000106e0: 2020 2020 2020 7372 635f 7079 7468 6f6e        src_python
+000106f0: 2e74 6f75 6368 2829 0a0a 2020 2020 2020  .touch()..      
+00010700: 2020 2020 2020 6661 6b65 5f63 7478 203d        fake_ctx =
+00010710: 2046 616b 6543 6f6e 7465 7874 2829 0a20   FakeContext(). 
+00010720: 2020 2020 2020 2020 2020 2066 616b 655f             fake_
+00010730: 6374 782e 7061 7261 6d73 5b22 7372 6322  ctx.params["src"
+00010740: 5d20 3d20 2822 2d22 2c29 0a20 2020 2020  ] = ("-",).     
+00010750: 2020 2020 2020 2066 616b 655f 6374 782e         fake_ctx.
+00010760: 7061 7261 6d73 5b22 7374 6469 6e5f 6669  params["stdin_fi
+00010770: 6c65 6e61 6d65 225d 203d 2073 7472 2873  lename"] = str(s
+00010780: 7263 5f70 7974 686f 6e29 0a0a 2020 2020  rc_python)..    
+00010790: 2020 2020 2020 2020 7769 7468 2063 6861          with cha
+000107a0: 6e67 655f 6469 7265 6374 6f72 7928 726f  nge_directory(ro
+000107b0: 6f74 293a 0a20 2020 2020 2020 2020 2020  ot):.           
+000107c0: 2020 2020 2062 6c61 636b 2e72 6561 645f       black.read_
+000107d0: 7079 7072 6f6a 6563 745f 746f 6d6c 2866  pyproject_toml(f
+000107e0: 616b 655f 6374 782c 2046 616b 6550 6172  ake_ctx, FakePar
+000107f0: 616d 6574 6572 2829 2c20 4e6f 6e65 290a  ameter(), None).
+00010800: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00010810: 6669 6720 3d20 6661 6b65 5f63 7478 2e64  fig = fake_ctx.d
+00010820: 6566 6175 6c74 5f6d 6170 0a20 2020 2020  efault_map.     
+00010830: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00010840: 7274 4571 7561 6c28 636f 6e66 6967 5b22  rtEqual(config["
+00010850: 7665 7262 6f73 6522 5d2c 2022 3122 290a  verbose"], "1").
+00010860: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00010870: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
+00010880: 6669 675b 2263 6865 636b 225d 2c20 226e  fig["check"], "n
+00010890: 6f22 290a 2020 2020 2020 2020 2020 2020  o").            
+000108a0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000108b0: 2863 6f6e 6669 675b 2264 6966 6622 5d2c  (config["diff"],
+000108c0: 2022 7922 290a 2020 2020 2020 2020 2020   "y").          
+000108d0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000108e0: 616c 2863 6f6e 6669 675b 2263 6f6c 6f72  al(config["color
+000108f0: 225d 2c20 2254 7275 6522 290a 2020 2020  "], "True").    
+00010900: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00010910: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
+00010920: 226c 696e 655f 6c65 6e67 7468 225d 2c20  "line_length"], 
+00010930: 2237 3922 290a 2020 2020 2020 2020 2020  "79").          
+00010940: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00010950: 616c 2863 6f6e 6669 675b 2274 6172 6765  al(config["targe
+00010960: 745f 7665 7273 696f 6e22 5d2c 205b 2270  t_version"], ["p
+00010970: 7933 3622 2c20 2270 7933 3722 2c20 2270  y36", "py37", "p
+00010980: 7933 3822 5d29 0a20 2020 2020 2020 2020  y38"]).         
+00010990: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000109a0: 7561 6c28 636f 6e66 6967 5b22 6578 636c  ual(config["excl
+000109b0: 7564 6522 5d2c 2072 225c 2e70 7969 3f24  ude"], r"\.pyi?$
+000109c0: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+000109d0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000109e0: 636f 6e66 6967 5b22 696e 636c 7564 6522  config["include"
+000109f0: 5d2c 2072 225c 2e70 793f 2422 290a 0a20  ], r"\.py?$").. 
+00010a00: 2020 2040 7079 7465 7374 2e6d 6172 6b2e     @pytest.mark.
+00010a10: 696e 636f 6d70 6174 6962 6c65 5f77 6974  incompatible_wit
+00010a20: 685f 6d79 7079 630a 2020 2020 6465 6620  h_mypyc.    def 
+00010a30: 7465 7374 5f66 696e 645f 7072 6f6a 6563  test_find_projec
+00010a40: 745f 726f 6f74 2873 656c 6629 202d 3e20  t_root(self) -> 
+00010a50: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
+00010a60: 7468 2054 656d 706f 7261 7279 4469 7265  th TemporaryDire
+00010a70: 6374 6f72 7928 2920 6173 2077 6f72 6b73  ctory() as works
+00010a80: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
+00010a90: 2020 726f 6f74 203d 2050 6174 6828 776f    root = Path(wo
+00010aa0: 726b 7370 6163 6529 0a20 2020 2020 2020  rkspace).       
+00010ab0: 2020 2020 2074 6573 745f 6469 7220 3d20       test_dir = 
+00010ac0: 726f 6f74 202f 2022 7465 7374 220a 2020  root / "test".  
+00010ad0: 2020 2020 2020 2020 2020 7465 7374 5f64            test_d
+00010ae0: 6972 2e6d 6b64 6972 2829 0a0a 2020 2020  ir.mkdir()..    
+00010af0: 2020 2020 2020 2020 7372 635f 6469 7220          src_dir 
+00010b00: 3d20 726f 6f74 202f 2022 7372 6322 0a20  = root / "src". 
+00010b10: 2020 2020 2020 2020 2020 2073 7263 5f64             src_d
+00010b20: 6972 2e6d 6b64 6972 2829 0a0a 2020 2020  ir.mkdir()..    
+00010b30: 2020 2020 2020 2020 726f 6f74 5f70 7970          root_pyp
+00010b40: 726f 6a65 6374 203d 2072 6f6f 7420 2f20  roject = root / 
+00010b50: 2270 7970 726f 6a65 6374 2e74 6f6d 6c22  "pyproject.toml"
+00010b60: 0a20 2020 2020 2020 2020 2020 2072 6f6f  .            roo
+00010b70: 745f 7079 7072 6f6a 6563 742e 7772 6974  t_pyproject.writ
+00010b80: 655f 7465 7874 2822 5b74 6f6f 6c2e 626c  e_text("[tool.bl
+00010b90: 6163 6b5d 222c 2065 6e63 6f64 696e 673d  ack]", encoding=
+00010ba0: 2275 7466 2d38 2229 0a20 2020 2020 2020  "utf-8").       
+00010bb0: 2020 2020 2073 7263 5f70 7970 726f 6a65       src_pyproje
+00010bc0: 6374 203d 2073 7263 5f64 6972 202f 2022  ct = src_dir / "
+00010bd0: 7079 7072 6f6a 6563 742e 746f 6d6c 220a  pyproject.toml".
+00010be0: 2020 2020 2020 2020 2020 2020 7372 635f              src_
+00010bf0: 7079 7072 6f6a 6563 742e 7772 6974 655f  pyproject.write_
+00010c00: 7465 7874 2822 5b74 6f6f 6c2e 626c 6163  text("[tool.blac
+00010c10: 6b5d 222c 2065 6e63 6f64 696e 673d 2275  k]", encoding="u
+00010c20: 7466 2d38 2229 0a20 2020 2020 2020 2020  tf-8").         
+00010c30: 2020 2073 7263 5f70 7974 686f 6e20 3d20     src_python = 
+00010c40: 7372 635f 6469 7220 2f20 2266 6f6f 2e70  src_dir / "foo.p
+00010c50: 7922 0a20 2020 2020 2020 2020 2020 2073  y".            s
+00010c60: 7263 5f70 7974 686f 6e2e 746f 7563 6828  rc_python.touch(
+00010c70: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00010c80: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00010c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010ca0: 2062 6c61 636b 2e66 696e 645f 7072 6f6a   black.find_proj
+00010cb0: 6563 745f 726f 6f74 2828 7372 635f 6469  ect_root((src_di
+00010cc0: 722c 2074 6573 745f 6469 7229 292c 0a20  r, test_dir)),. 
+00010cd0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00010ce0: 726f 6f74 2e72 6573 6f6c 7665 2829 2c20  root.resolve(), 
+00010cf0: 2270 7970 726f 6a65 6374 2e74 6f6d 6c22  "pyproject.toml"
+00010d00: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
+00010d10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00010d20: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+00010d30: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00010d40: 6c61 636b 2e66 696e 645f 7072 6f6a 6563  lack.find_projec
+00010d50: 745f 726f 6f74 2828 7372 635f 6469 722c  t_root((src_dir,
+00010d60: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+00010d70: 2020 2020 2873 7263 5f64 6972 2e72 6573      (src_dir.res
+00010d80: 6f6c 7665 2829 2c20 2270 7970 726f 6a65  olve(), "pyproje
+00010d90: 6374 2e74 6f6d 6c22 292c 0a20 2020 2020  ct.toml"),.     
+00010da0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00010db0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00010dc0: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
+00010dd0: 2020 2020 2020 2062 6c61 636b 2e66 696e         black.fin
+00010de0: 645f 7072 6f6a 6563 745f 726f 6f74 2828  d_project_root((
+00010df0: 7372 635f 7079 7468 6f6e 2c29 292c 0a20  src_python,)),. 
+00010e00: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00010e10: 7372 635f 6469 722e 7265 736f 6c76 6528  src_dir.resolve(
+00010e20: 292c 2022 7079 7072 6f6a 6563 742e 746f  ), "pyproject.to
+00010e30: 6d6c 2229 2c0a 2020 2020 2020 2020 2020  ml"),.          
+00010e40: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+00010e50: 2077 6974 6820 6368 616e 6765 5f64 6972   with change_dir
+00010e60: 6563 746f 7279 2874 6573 745f 6469 7229  ectory(test_dir)
+00010e70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010e80: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00010e90: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+00010ea0: 2020 2020 2020 2020 626c 6163 6b2e 6669          black.fi
+00010eb0: 6e64 5f70 726f 6a65 6374 5f72 6f6f 7428  nd_project_root(
+00010ec0: 2822 2d22 2c29 2c20 7374 6469 6e5f 6669  ("-",), stdin_fi
+00010ed0: 6c65 6e61 6d65 3d22 2e2e 2f73 7263 2f61  lename="../src/a
+00010ee0: 2e70 7922 292c 0a20 2020 2020 2020 2020  .py"),.         
+00010ef0: 2020 2020 2020 2020 2020 2028 7372 635f             (src_
+00010f00: 6469 722e 7265 736f 6c76 6528 292c 2022  dir.resolve(), "
+00010f10: 7079 7072 6f6a 6563 742e 746f 6d6c 2229  pyproject.toml")
+00010f20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010f30: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+00010f40: 2073 7263 5f73 7562 203d 2073 7263 5f64   src_sub = src_d
+00010f50: 6972 202f 2022 7375 6222 0a20 2020 2020  ir / "sub".     
+00010f60: 2020 2020 2020 2073 7263 5f73 7562 2e6d         src_sub.m
+00010f70: 6b64 6972 2829 0a0a 2020 2020 2020 2020  kdir()..        
+00010f80: 2020 2020 7372 635f 7375 625f 7079 7072      src_sub_pypr
+00010f90: 6f6a 6563 7420 3d20 7372 635f 7375 6220  oject = src_sub 
+00010fa0: 2f20 2270 7970 726f 6a65 6374 2e74 6f6d  / "pyproject.tom
+00010fb0: 6c22 0a20 2020 2020 2020 2020 2020 2073  l".            s
+00010fc0: 7263 5f73 7562 5f70 7970 726f 6a65 6374  rc_sub_pyproject
+00010fd0: 2e74 6f75 6368 2829 2020 2320 656d 7074  .touch()  # empt
+00010fe0: 790a 0a20 2020 2020 2020 2020 2020 2073  y..            s
+00010ff0: 7263 5f73 7562 5f70 7974 686f 6e20 3d20  rc_sub_python = 
+00011000: 7372 635f 7375 6220 2f20 2262 6172 2e70  src_sub / "bar.p
+00011010: 7922 0a0a 2020 2020 2020 2020 2020 2020  y"..            
+00011020: 2320 7765 2073 6b69 7020 7372 635f 7375  # we skip src_su
+00011030: 625f 7079 7072 6f6a 6563 7420 7369 6e63  b_pyproject sinc
+00011040: 6520 6974 2069 7320 6d69 7373 696e 6720  e it is missing 
+00011050: 7468 6520 5b74 6f6f 6c2e 626c 6163 6b5d  the [tool.black]
+00011060: 2073 6563 7469 6f6e 0a20 2020 2020 2020   section.       
+00011070: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00011080: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
+00011090: 2020 2020 2020 2062 6c61 636b 2e66 696e         black.fin
+000110a0: 645f 7072 6f6a 6563 745f 726f 6f74 2828  d_project_root((
+000110b0: 7372 635f 7375 625f 7079 7468 6f6e 2c29  src_sub_python,)
+000110c0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+000110d0: 2020 2028 7372 635f 6469 722e 7265 736f     (src_dir.reso
+000110e0: 6c76 6528 292c 2022 7079 7072 6f6a 6563  lve(), "pyprojec
+000110f0: 742e 746f 6d6c 2229 2c0a 2020 2020 2020  t.toml"),.      
+00011100: 2020 2020 2020 290a 0a20 2020 2040 7061        )..    @pa
+00011110: 7463 6828 0a20 2020 2020 2020 2022 626c  tch(.        "bl
+00011120: 6163 6b2e 6669 6c65 732e 6669 6e64 5f75  ack.files.find_u
+00011130: 7365 725f 7079 7072 6f6a 6563 745f 746f  ser_pyproject_to
+00011140: 6d6c 222c 0a20 2020 2029 0a20 2020 2064  ml",.    ).    d
+00011150: 6566 2074 6573 745f 6669 6e64 5f70 7970  ef test_find_pyp
+00011160: 726f 6a65 6374 5f74 6f6d 6c28 7365 6c66  roject_toml(self
+00011170: 2c20 6669 6e64 5f75 7365 725f 7079 7072  , find_user_pypr
+00011180: 6f6a 6563 745f 746f 6d6c 3a20 4d61 6769  oject_toml: Magi
+00011190: 634d 6f63 6b29 202d 3e20 4e6f 6e65 3a0a  cMock) -> None:.
+000111a0: 2020 2020 2020 2020 6669 6e64 5f75 7365          find_use
+000111b0: 725f 7079 7072 6f6a 6563 745f 746f 6d6c  r_pyproject_toml
+000111c0: 2e73 6964 655f 6566 6665 6374 203d 2052  .side_effect = R
+000111d0: 756e 7469 6d65 4572 726f 7228 290a 0a20  untimeError().. 
+000111e0: 2020 2020 2020 2077 6974 6820 7265 6469         with redi
+000111f0: 7265 6374 5f73 7464 6572 7228 696f 2e53  rect_stderr(io.S
+00011200: 7472 696e 6749 4f28 2929 2061 7320 7374  tringIO()) as st
+00011210: 6465 7272 3a0a 2020 2020 2020 2020 2020  derr:.          
+00011220: 2020 7265 7375 6c74 203d 2062 6c61 636b    result = black
+00011230: 2e66 696c 6573 2e66 696e 645f 7079 7072  .files.find_pypr
+00011240: 6f6a 6563 745f 746f 6d6c 280a 2020 2020  oject_toml(.    
+00011250: 2020 2020 2020 2020 2020 2020 7061 7468              path
+00011260: 5f73 6561 7263 685f 7374 6172 743d 2873  _search_start=(s
+00011270: 7472 2850 6174 682e 6377 6428 292e 726f  tr(Path.cwd().ro
+00011280: 6f74 292c 290a 2020 2020 2020 2020 2020  ot),).          
+00011290: 2020 290a 0a20 2020 2020 2020 2061 7373    )..        ass
+000112a0: 6572 7420 7265 7375 6c74 2069 7320 4e6f  ert result is No
+000112b0: 6e65 0a20 2020 2020 2020 2065 7272 203d  ne.        err =
+000112c0: 2073 7464 6572 722e 6765 7476 616c 7565   stderr.getvalue
+000112d0: 2829 0a20 2020 2020 2020 2061 7373 6572  ().        asser
+000112e0: 7420 2249 676e 6f72 696e 6720 7573 6572  t "Ignoring user
+000112f0: 2063 6f6e 6669 6775 7261 7469 6f6e 2220   configuration" 
+00011300: 696e 2065 7272 0a0a 2020 2020 4070 6174  in err..    @pat
+00011310: 6368 280a 2020 2020 2020 2020 2262 6c61  ch(.        "bla
+00011320: 636b 2e66 696c 6573 2e66 696e 645f 7573  ck.files.find_us
+00011330: 6572 5f70 7970 726f 6a65 6374 5f74 6f6d  er_pyproject_tom
+00011340: 6c22 2c0a 2020 2020 2020 2020 626c 6163  l",.        blac
+00011350: 6b2e 6669 6c65 732e 6669 6e64 5f75 7365  k.files.find_use
+00011360: 725f 7079 7072 6f6a 6563 745f 746f 6d6c  r_pyproject_toml
+00011370: 2e5f 5f77 7261 7070 6564 5f5f 2c0a 2020  .__wrapped__,.  
+00011380: 2020 290a 2020 2020 6465 6620 7465 7374    ).    def test
+00011390: 5f66 696e 645f 7573 6572 5f70 7970 726f  _find_user_pypro
+000113a0: 6a65 6374 5f74 6f6d 6c5f 6c69 6e75 7828  ject_toml_linux(
+000113b0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+000113c0: 2020 2020 2020 2069 6620 7379 7374 656d         if system
+000113d0: 2829 203d 3d20 2257 696e 646f 7773 223a  () == "Windows":
+000113e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000113f0: 7572 6e0a 0a20 2020 2020 2020 2023 2054  urn..        # T
+00011400: 6573 7420 6966 2058 4447 5f43 4f4e 4649  est if XDG_CONFI
+00011410: 475f 484f 4d45 2069 7320 6368 6563 6b65  G_HOME is checke
+00011420: 640a 2020 2020 2020 2020 7769 7468 2054  d.        with T
+00011430: 656d 706f 7261 7279 4469 7265 6374 6f72  emporaryDirector
+00011440: 7928 2920 6173 2077 6f72 6b73 7061 6365  y() as workspace
+00011450: 3a0a 2020 2020 2020 2020 2020 2020 746d  :.            tm
+00011460: 705f 7573 6572 5f63 6f6e 6669 6720 3d20  p_user_config = 
+00011470: 5061 7468 2877 6f72 6b73 7061 6365 2920  Path(workspace) 
+00011480: 2f20 2262 6c61 636b 220a 2020 2020 2020  / "black".      
+00011490: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
+000114a0: 2e64 6963 7428 226f 732e 656e 7669 726f  .dict("os.enviro
+000114b0: 6e22 2c20 7b22 5844 475f 434f 4e46 4947  n", {"XDG_CONFIG
+000114c0: 5f48 4f4d 4522 3a20 776f 726b 7370 6163  _HOME": workspac
+000114d0: 657d 293a 0a20 2020 2020 2020 2020 2020  e}):.           
+000114e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000114f0: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
+00011500: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+00011510: 2e66 696c 6573 2e66 696e 645f 7573 6572  .files.find_user
+00011520: 5f70 7970 726f 6a65 6374 5f74 6f6d 6c28  _pyproject_toml(
+00011530: 292c 2074 6d70 5f75 7365 725f 636f 6e66  ), tmp_user_conf
+00011540: 6967 2e72 6573 6f6c 7665 2829 0a20 2020  ig.resolve().   
+00011550: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+00011560: 2020 2020 2020 2020 2320 5465 7374 2066          # Test f
+00011570: 616c 6c62 6163 6b20 666f 7220 5844 475f  allback for XDG_
+00011580: 434f 4e46 4947 5f48 4f4d 450a 2020 2020  CONFIG_HOME.    
+00011590: 2020 2020 7769 7468 2070 6174 6368 2e64      with patch.d
+000115a0: 6963 7428 226f 732e 656e 7669 726f 6e22  ict("os.environ"
+000115b0: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
+000115c0: 732e 656e 7669 726f 6e2e 706f 7028 2258  s.environ.pop("X
+000115d0: 4447 5f43 4f4e 4649 475f 484f 4d45 222c  DG_CONFIG_HOME",
+000115e0: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
+000115f0: 2020 2066 616c 6c62 6163 6b5f 7573 6572     fallback_user
+00011600: 5f63 6f6e 6669 6720 3d20 5061 7468 2822  _config = Path("
+00011610: 7e2f 2e63 6f6e 6669 6722 292e 6578 7061  ~/.config").expa
+00011620: 6e64 7573 6572 2829 202f 2022 626c 6163  nduser() / "blac
+00011630: 6b22 0a20 2020 2020 2020 2020 2020 2073  k".            s
+00011640: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00011650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011660: 2062 6c61 636b 2e66 696c 6573 2e66 696e   black.files.fin
+00011670: 645f 7573 6572 5f70 7970 726f 6a65 6374  d_user_pyproject
+00011680: 5f74 6f6d 6c28 292c 2066 616c 6c62 6163  _toml(), fallbac
+00011690: 6b5f 7573 6572 5f63 6f6e 6669 672e 7265  k_user_config.re
+000116a0: 736f 6c76 6528 290a 2020 2020 2020 2020  solve().        
+000116b0: 2020 2020 290a 0a20 2020 2064 6566 2074      )..    def t
+000116c0: 6573 745f 6669 6e64 5f75 7365 725f 7079  est_find_user_py
+000116d0: 7072 6f6a 6563 745f 746f 6d6c 5f77 696e  project_toml_win
+000116e0: 646f 7773 2873 656c 6629 202d 3e20 4e6f  dows(self) -> No
+000116f0: 6e65 3a0a 2020 2020 2020 2020 6966 2073  ne:.        if s
+00011700: 7973 7465 6d28 2920 213d 2022 5769 6e64  ystem() != "Wind
+00011710: 6f77 7322 3a0a 2020 2020 2020 2020 2020  ows":.          
+00011720: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+00011730: 2020 7573 6572 5f63 6f6e 6669 675f 7061    user_config_pa
+00011740: 7468 203d 2050 6174 682e 686f 6d65 2829  th = Path.home()
+00011750: 202f 2022 2e62 6c61 636b 220a 2020 2020   / ".black".    
+00011760: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00011770: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
+00011780: 2020 626c 6163 6b2e 6669 6c65 732e 6669    black.files.fi
+00011790: 6e64 5f75 7365 725f 7079 7072 6f6a 6563  nd_user_pyprojec
+000117a0: 745f 746f 6d6c 2829 2c20 7573 6572 5f63  t_toml(), user_c
+000117b0: 6f6e 6669 675f 7061 7468 2e72 6573 6f6c  onfig_path.resol
+000117c0: 7665 2829 0a20 2020 2020 2020 2029 0a0a  ve().        )..
+000117d0: 2020 2020 6465 6620 7465 7374 5f62 706f      def test_bpo
+000117e0: 5f33 3336 3630 5f77 6f72 6b61 726f 756e  _33660_workaroun
+000117f0: 6428 7365 6c66 2920 2d3e 204e 6f6e 653a  d(self) -> None:
+00011800: 0a20 2020 2020 2020 2069 6620 7379 7374  .        if syst
+00011810: 656d 2829 203d 3d20 2257 696e 646f 7773  em() == "Windows
+00011820: 223a 0a20 2020 2020 2020 2020 2020 2072  ":.            r
+00011830: 6574 7572 6e0a 0a20 2020 2020 2020 2023  eturn..        #
+00011840: 2068 7474 7073 3a2f 2f62 7567 732e 7079   https://bugs.py
+00011850: 7468 6f6e 2e6f 7267 2f69 7373 7565 3333  thon.org/issue33
+00011860: 3636 300a 2020 2020 2020 2020 2320 4361  660.        # Ca
+00011870: 6e20 6265 2072 656d 6f76 6564 2077 6865  n be removed whe
+00011880: 6e20 7765 2064 726f 7020 7375 7070 6f72  n we drop suppor
+00011890: 7420 666f 7220 5079 7468 6f6e 2033 2e38  t for Python 3.8
+000118a0: 2e35 0a20 2020 2020 2020 2072 6f6f 7420  .5.        root 
+000118b0: 3d20 5061 7468 2822 2f22 290a 2020 2020  = Path("/").    
+000118c0: 2020 2020 7769 7468 2063 6861 6e67 655f      with change_
+000118d0: 6469 7265 6374 6f72 7928 726f 6f74 293a  directory(root):
+000118e0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+000118f0: 6820 3d20 5061 7468 2822 776f 726b 7370  h = Path("worksp
+00011900: 6163 6522 2920 2f20 2270 726f 6a65 6374  ace") / "project
+00011910: 220a 2020 2020 2020 2020 2020 2020 7265  ".            re
+00011920: 706f 7274 203d 2062 6c61 636b 2e52 6570  port = black.Rep
+00011930: 6f72 7428 7665 7262 6f73 653d 5472 7565  ort(verbose=True
+00011940: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00011950: 736f 6c76 6573 5f6f 7574 7369 6465 203d  solves_outside =
+00011960: 2062 6c61 636b 2e72 6573 6f6c 7665 735f   black.resolves_
+00011970: 6f75 7473 6964 655f 726f 6f74 5f6f 725f  outside_root_or_
+00011980: 6361 6e6e 6f74 5f73 7461 7428 0a20 2020  cannot_stat(.   
+00011990: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+000119a0: 682c 2072 6f6f 742c 2072 6570 6f72 740a  h, root, report.
+000119b0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000119c0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000119d0: 7373 6572 7449 7328 7265 736f 6c76 6573  ssertIs(resolves
+000119e0: 5f6f 7574 7369 6465 2c20 4661 6c73 6529  _outside, False)
+000119f0: 0a0a 2020 2020 6465 6620 7465 7374 5f6e  ..    def test_n
+00011a00: 6f72 6d61 6c69 7a65 5f70 6174 685f 6967  ormalize_path_ig
+00011a10: 6e6f 7265 5f77 696e 646f 7773 5f6a 756e  nore_windows_jun
+00011a20: 6374 696f 6e73 5f6f 7574 7369 6465 5f6f  ctions_outside_o
+00011a30: 665f 726f 6f74 2873 656c 6629 202d 3e20  f_root(self) -> 
+00011a40: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
+00011a50: 2073 7973 7465 6d28 2920 213d 2022 5769   system() != "Wi
+00011a60: 6e64 6f77 7322 3a0a 2020 2020 2020 2020  ndows":.        
+00011a70: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+00011a80: 2020 2020 7769 7468 2054 656d 706f 7261      with Tempora
+00011a90: 7279 4469 7265 6374 6f72 7928 2920 6173  ryDirectory() as
+00011aa0: 2077 6f72 6b73 7061 6365 3a0a 2020 2020   workspace:.    
+00011ab0: 2020 2020 2020 2020 726f 6f74 203d 2050          root = P
+00011ac0: 6174 6828 776f 726b 7370 6163 6529 0a20  ath(workspace). 
+00011ad0: 2020 2020 2020 2020 2020 206a 756e 6374             junct
+00011ae0: 696f 6e5f 6469 7220 3d20 726f 6f74 202f  ion_dir = root /
+00011af0: 2022 6a75 6e63 7469 6f6e 220a 2020 2020   "junction".    
+00011b00: 2020 2020 2020 2020 6a75 6e63 7469 6f6e          junction
+00011b10: 5f74 6172 6765 745f 6f75 7473 6964 655f  _target_outside_
+00011b20: 6f66 5f72 6f6f 7420 3d20 726f 6f74 202f  of_root = root /
+00011b30: 2022 2e2e 220a 2020 2020 2020 2020 2020   "..".          
+00011b40: 2020 6f73 2e73 7973 7465 6d28 6622 6d6b    os.system(f"mk
+00011b50: 6c69 6e6b 202f 4a20 7b6a 756e 6374 696f  link /J {junctio
+00011b60: 6e5f 6469 727d 207b 6a75 6e63 7469 6f6e  n_dir} {junction
+00011b70: 5f74 6172 6765 745f 6f75 7473 6964 655f  _target_outside_
+00011b80: 6f66 5f72 6f6f 747d 2229 0a0a 2020 2020  of_root}")..    
+00011b90: 2020 2020 2020 2020 7265 706f 7274 203d          report =
+00011ba0: 2062 6c61 636b 2e52 6570 6f72 7428 7665   black.Report(ve
+00011bb0: 7262 6f73 653d 5472 7565 290a 2020 2020  rbose=True).    
+00011bc0: 2020 2020 2020 2020 7265 736f 6c76 6573          resolves
+00011bd0: 5f6f 7574 7369 6465 203d 2062 6c61 636b  _outside = black
+00011be0: 2e72 6573 6f6c 7665 735f 6f75 7473 6964  .resolves_outsid
+00011bf0: 655f 726f 6f74 5f6f 725f 6361 6e6e 6f74  e_root_or_cannot
+00011c00: 5f73 7461 7428 0a20 2020 2020 2020 2020  _stat(.         
+00011c10: 2020 2020 2020 206a 756e 6374 696f 6e5f         junction_
+00011c20: 6469 722c 2072 6f6f 742c 2072 6570 6f72  dir, root, repor
+00011c30: 740a 2020 2020 2020 2020 2020 2020 290a  t.            ).
+00011c40: 2020 2020 2020 2020 2020 2020 2320 4d61              # Ma
+00011c50: 6e75 616c 6c79 2064 656c 6574 6520 666f  nually delete fo
+00011c60: 7220 5079 7468 6f6e 203c 2033 2e38 0a20  r Python < 3.8. 
+00011c70: 2020 2020 2020 2020 2020 206f 732e 7379             os.sy
+00011c80: 7374 656d 2866 2272 6d64 6972 207b 6a75  stem(f"rmdir {ju
+00011c90: 6e63 7469 6f6e 5f64 6972 7d22 290a 0a20  nction_dir}").. 
+00011ca0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00011cb0: 6173 7365 7274 4973 2872 6573 6f6c 7665  assertIs(resolve
+00011cc0: 735f 6f75 7473 6964 652c 2054 7275 6529  s_outside, True)
+00011cd0: 0a0a 2020 2020 6465 6620 7465 7374 5f6e  ..    def test_n
+00011ce0: 6577 6c69 6e65 5f63 6f6d 6d65 6e74 5f69  ewline_comment_i
+00011cf0: 6e74 6572 6163 7469 6f6e 2873 656c 6629  nteraction(self)
+00011d00: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00011d10: 2020 736f 7572 6365 203d 2022 636c 6173    source = "clas
+00011d20: 7320 413a 5c5c 5c72 5c6e 2320 7479 7065  s A:\\\r\n# type
+00011d30: 3a20 6967 6e6f 7265 5c6e 2070 6173 735c  : ignore\n pass\
+00011d40: 6e22 0a20 2020 2020 2020 206f 7574 7075  n".        outpu
+00011d50: 7420 3d20 626c 6163 6b2e 666f 726d 6174  t = black.format
+00011d60: 5f73 7472 2873 6f75 7263 652c 206d 6f64  _str(source, mod
+00011d70: 653d 4445 4641 554c 545f 4d4f 4445 290a  e=DEFAULT_MODE).
+00011d80: 2020 2020 2020 2020 626c 6163 6b2e 6173          black.as
+00011d90: 7365 7274 5f73 7461 626c 6528 736f 7572  sert_stable(sour
+00011da0: 6365 2c20 6f75 7470 7574 2c20 6d6f 6465  ce, output, mode
+00011db0: 3d44 4546 4155 4c54 5f4d 4f44 4529 0a0a  =DEFAULT_MODE)..
+00011dc0: 2020 2020 6465 6620 7465 7374 5f62 706f      def test_bpo
+00011dd0: 5f32 3134 325f 776f 726b 6172 6f75 6e64  _2142_workaround
+00011de0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00011df0: 2020 2020 2020 2020 2320 6874 7470 733a          # https:
+00011e00: 2f2f 6275 6773 2e70 7974 686f 6e2e 6f72  //bugs.python.or
+00011e10: 672f 6973 7375 6532 3134 320a 0a20 2020  g/issue2142..   
+00011e20: 2020 2020 2073 6f75 7263 652c 205f 203d       source, _ =
+00011e30: 2072 6561 645f 6461 7461 2822 6d69 7363   read_data("misc
+00011e40: 656c 6c61 6e65 6f75 7322 2c20 226d 6973  ellaneous", "mis
+00011e50: 7369 6e67 5f66 696e 616c 5f6e 6577 6c69  sing_final_newli
+00011e60: 6e65 2229 0a20 2020 2020 2020 2023 2072  ne").        # r
+00011e70: 6561 645f 6461 7461 2061 6464 7320 6120  ead_data adds a 
+00011e80: 7472 6169 6c69 6e67 206e 6577 6c69 6e65  trailing newline
+00011e90: 0a20 2020 2020 2020 2073 6f75 7263 6520  .        source 
+00011ea0: 3d20 736f 7572 6365 2e72 7374 7269 7028  = source.rstrip(
+00011eb0: 290a 2020 2020 2020 2020 6578 7065 6374  ).        expect
+00011ec0: 6564 2c20 5f20 3d20 7265 6164 5f64 6174  ed, _ = read_dat
+00011ed0: 6128 226d 6973 6365 6c6c 616e 656f 7573  a("miscellaneous
+00011ee0: 222c 2022 6d69 7373 696e 675f 6669 6e61  ", "missing_fina
+00011ef0: 6c5f 6e65 776c 696e 652e 6469 6666 2229  l_newline.diff")
+00011f00: 0a20 2020 2020 2020 2074 6d70 5f66 696c  .        tmp_fil
+00011f10: 6520 3d20 5061 7468 2862 6c61 636b 2e64  e = Path(black.d
+00011f20: 756d 705f 746f 5f66 696c 6528 736f 7572  ump_to_file(sour
+00011f30: 6365 2c20 656e 7375 7265 5f66 696e 616c  ce, ensure_final
+00011f40: 5f6e 6577 6c69 6e65 3d46 616c 7365 2929  _newline=False))
+00011f50: 0a20 2020 2020 2020 2064 6966 665f 6865  .        diff_he
+00011f60: 6164 6572 203d 2072 652e 636f 6d70 696c  ader = re.compil
+00011f70: 6528 0a20 2020 2020 2020 2020 2020 2072  e(.            r
+00011f80: 6622 7b72 652e 6573 6361 7065 2873 7472  f"{re.escape(str
+00011f90: 2874 6d70 5f66 696c 6529 297d 5c74 5c64  (tmp_file))}\t\d
+00011fa0: 5c64 5c64 5c64 2d5c 645c 642d 5c64 5c64  \d\d\d-\d\d-\d\d
+00011fb0: 2022 0a20 2020 2020 2020 2020 2020 2072   ".            r
+00011fc0: 225c 645c 643a 5c64 5c64 3a5c 645c 645c  "\d\d:\d\d:\d\d\
+00011fd0: 2e5c 645c 645c 645c 645c 645c 645c 2b5c  .\d\d\d\d\d\d\+\
+00011fe0: 645c 643a 5c64 5c64 220a 2020 2020 2020  d\d:\d\d".      
+00011ff0: 2020 290a 2020 2020 2020 2020 7472 793a    ).        try:
+00012000: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00012010: 756c 7420 3d20 426c 6163 6b52 756e 6e65  ult = BlackRunne
+00012020: 7228 292e 696e 766f 6b65 2862 6c61 636b  r().invoke(black
+00012030: 2e6d 6169 6e2c 205b 222d 2d64 6966 6622  .main, ["--diff"
+00012040: 2c20 7374 7228 746d 705f 6669 6c65 295d  , str(tmp_file)]
+00012050: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00012060: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+00012070: 6573 756c 742e 6578 6974 5f63 6f64 652c  esult.exit_code,
+00012080: 2030 290a 2020 2020 2020 2020 6669 6e61   0).        fina
+00012090: 6c6c 793a 0a20 2020 2020 2020 2020 2020  lly:.           
+000120a0: 206f 732e 756e 6c69 6e6b 2874 6d70 5f66   os.unlink(tmp_f
+000120b0: 696c 6529 0a20 2020 2020 2020 2061 6374  ile).        act
+000120c0: 7561 6c20 3d20 7265 7375 6c74 2e6f 7574  ual = result.out
+000120d0: 7075 740a 2020 2020 2020 2020 6163 7475  put.        actu
+000120e0: 616c 203d 2064 6966 665f 6865 6164 6572  al = diff_header
+000120f0: 2e73 7562 2844 4554 4552 4d49 4e49 5354  .sub(DETERMINIST
+00012100: 4943 5f48 4541 4445 522c 2061 6374 7561  IC_HEADER, actua
+00012110: 6c29 0a20 2020 2020 2020 2073 656c 662e  l).        self.
+00012120: 6173 7365 7274 4571 7561 6c28 6163 7475  assertEqual(actu
+00012130: 616c 2c20 6578 7065 6374 6564 290a 0a20  al, expected).. 
+00012140: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+00012150: 0a20 2020 2064 6566 2063 6f6d 7061 7265  .    def compare
+00012160: 5f72 6573 756c 7473 280a 2020 2020 2020  _results(.      
+00012170: 2020 7265 7375 6c74 3a20 636c 6963 6b2e    result: click.
+00012180: 7465 7374 696e 672e 5265 7375 6c74 2c20  testing.Result, 
+00012190: 6578 7065 6374 6564 5f76 616c 7565 3a20  expected_value: 
+000121a0: 7374 722c 2065 7870 6563 7465 645f 6578  str, expected_ex
+000121b0: 6974 5f63 6f64 653a 2069 6e74 0a20 2020  it_code: int.   
+000121c0: 2029 202d 3e20 4e6f 6e65 3a0a 2020 2020   ) -> None:.    
+000121d0: 2020 2020 2222 2248 656c 7065 7220 6d65      """Helper me
+000121e0: 7468 6f64 2074 6f20 7465 7374 2074 6865  thod to test the
+000121f0: 2076 616c 7565 2061 6e64 2065 7869 7420   value and exit 
+00012200: 636f 6465 206f 6620 6120 636c 6963 6b20  code of a click 
+00012210: 5265 7375 6c74 2e22 2222 0a20 2020 2020  Result.""".     
+00012220: 2020 2061 7373 6572 7420 280a 2020 2020     assert (.    
+00012230: 2020 2020 2020 2020 7265 7375 6c74 2e6f          result.o
+00012240: 7574 7075 7420 3d3d 2065 7870 6563 7465  utput == expecte
+00012250: 645f 7661 6c75 650a 2020 2020 2020 2020  d_value.        
+00012260: 292c 2022 5468 6520 6f75 7470 7574 2064  ), "The output d
+00012270: 6964 206e 6f74 206d 6174 6368 2074 6865  id not match the
+00012280: 2065 7870 6563 7465 6420 7661 6c75 652e   expected value.
+00012290: 220a 2020 2020 2020 2020 6173 7365 7274  ".        assert
+000122a0: 2072 6573 756c 742e 6578 6974 5f63 6f64   result.exit_cod
+000122b0: 6520 3d3d 2065 7870 6563 7465 645f 6578  e == expected_ex
+000122c0: 6974 5f63 6f64 652c 2022 5468 6520 6578  it_code, "The ex
+000122d0: 6974 2063 6f64 6520 6973 2069 6e63 6f72  it code is incor
+000122e0: 7265 6374 2e22 0a0a 2020 2020 6465 6620  rect."..    def 
+000122f0: 7465 7374 5f63 6f64 655f 6f70 7469 6f6e  test_code_option
+00012300: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00012310: 2020 2020 2020 2020 2222 2254 6573 7420          """Test 
+00012320: 7468 6520 636f 6465 206f 7074 696f 6e20  the code option 
+00012330: 7769 7468 206e 6f20 6368 616e 6765 732e  with no changes.
+00012340: 2222 220a 2020 2020 2020 2020 636f 6465  """.        code
+00012350: 203d 2027 7072 696e 7428 2248 656c 6c6f   = 'print("Hello
+00012360: 2077 6f72 6c64 2229 5c6e 270a 2020 2020   world")\n'.    
+00012370: 2020 2020 6172 6773 203d 205b 222d 2d63      args = ["--c
+00012380: 6f64 6522 2c20 636f 6465 5d0a 2020 2020  ode", code].    
+00012390: 2020 2020 7265 7375 6c74 203d 2043 6c69      result = Cli
+000123a0: 5275 6e6e 6572 2829 2e69 6e76 6f6b 6528  Runner().invoke(
+000123b0: 626c 6163 6b2e 6d61 696e 2c20 6172 6773  black.main, args
+000123c0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000123d0: 636f 6d70 6172 655f 7265 7375 6c74 7328  compare_results(
+000123e0: 7265 7375 6c74 2c20 636f 6465 2c20 3029  result, code, 0)
+000123f0: 0a0a 2020 2020 6465 6620 7465 7374 5f63  ..    def test_c
+00012400: 6f64 655f 6f70 7469 6f6e 5f63 6861 6e67  ode_option_chang
+00012410: 6564 2873 656c 6629 202d 3e20 4e6f 6e65  ed(self) -> None
+00012420: 3a0a 2020 2020 2020 2020 2222 2254 6573  :.        """Tes
+00012430: 7420 7468 6520 636f 6465 206f 7074 696f  t the code optio
+00012440: 6e20 7768 656e 2063 6861 6e67 6573 2061  n when changes a
+00012450: 7265 2072 6571 7569 7265 642e 2222 220a  re required.""".
+00012460: 2020 2020 2020 2020 636f 6465 203d 2022          code = "
+00012470: 7072 696e 7428 2768 656c 6c6f 2077 6f72  print('hello wor
+00012480: 6c64 2729 220a 2020 2020 2020 2020 666f  ld')".        fo
+00012490: 726d 6174 7465 6420 3d20 626c 6163 6b2e  rmatted = black.
+000124a0: 666f 726d 6174 5f73 7472 2863 6f64 652c  format_str(code,
+000124b0: 206d 6f64 653d 4445 4641 554c 545f 4d4f   mode=DEFAULT_MO
+000124c0: 4445 290a 0a20 2020 2020 2020 2061 7267  DE)..        arg
+000124d0: 7320 3d20 5b22 2d2d 636f 6465 222c 2063  s = ["--code", c
+000124e0: 6f64 655d 0a20 2020 2020 2020 2072 6573  ode].        res
+000124f0: 756c 7420 3d20 436c 6952 756e 6e65 7228  ult = CliRunner(
+00012500: 292e 696e 766f 6b65 2862 6c61 636b 2e6d  ).invoke(black.m
+00012510: 6169 6e2c 2061 7267 7329 0a0a 2020 2020  ain, args)..    
+00012520: 2020 2020 7365 6c66 2e63 6f6d 7061 7265      self.compare
+00012530: 5f72 6573 756c 7473 2872 6573 756c 742c  _results(result,
+00012540: 2066 6f72 6d61 7474 6564 2c20 3029 0a0a   formatted, 0)..
+00012550: 2020 2020 6465 6620 7465 7374 5f63 6f64      def test_cod
+00012560: 655f 6f70 7469 6f6e 5f63 6865 636b 2873  e_option_check(s
+00012570: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00012580: 2020 2020 2020 2222 2254 6573 7420 7468        """Test th
+00012590: 6520 636f 6465 206f 7074 696f 6e20 7768  e code option wh
+000125a0: 656e 2063 6865 636b 2069 7320 7061 7373  en check is pass
+000125b0: 6564 2e22 2222 0a20 2020 2020 2020 2061  ed.""".        a
+000125c0: 7267 7320 3d20 5b22 2d2d 6368 6563 6b22  rgs = ["--check"
+000125d0: 2c20 222d 2d63 6f64 6522 2c20 2770 7269  , "--code", 'pri
+000125e0: 6e74 2822 4865 6c6c 6f20 776f 726c 6422  nt("Hello world"
+000125f0: 295c 6e27 5d0a 2020 2020 2020 2020 7265  )\n'].        re
+00012600: 7375 6c74 203d 2043 6c69 5275 6e6e 6572  sult = CliRunner
+00012610: 2829 2e69 6e76 6f6b 6528 626c 6163 6b2e  ().invoke(black.
+00012620: 6d61 696e 2c20 6172 6773 290a 2020 2020  main, args).    
+00012630: 2020 2020 7365 6c66 2e63 6f6d 7061 7265      self.compare
+00012640: 5f72 6573 756c 7473 2872 6573 756c 742c  _results(result,
+00012650: 2022 222c 2030 290a 0a20 2020 2064 6566   "", 0)..    def
+00012660: 2074 6573 745f 636f 6465 5f6f 7074 696f   test_code_optio
+00012670: 6e5f 6368 6563 6b5f 6368 616e 6765 6428  n_check_changed(
+00012680: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00012690: 2020 2020 2020 2022 2222 5465 7374 2074         """Test t
+000126a0: 6865 2063 6f64 6520 6f70 7469 6f6e 2077  he code option w
+000126b0: 6865 6e20 6368 616e 6765 7320 6172 6520  hen changes are 
+000126c0: 7265 7175 6972 6564 2c20 616e 6420 6368  required, and ch
+000126d0: 6563 6b20 6973 2070 6173 7365 642e 2222  eck is passed.""
+000126e0: 220a 2020 2020 2020 2020 6172 6773 203d  ".        args =
+000126f0: 205b 222d 2d63 6865 636b 222c 2022 2d2d   ["--check", "--
+00012700: 636f 6465 222c 2022 7072 696e 7428 2768  code", "print('h
+00012710: 656c 6c6f 2077 6f72 6c64 2729 225d 0a20  ello world')"]. 
+00012720: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00012730: 436c 6952 756e 6e65 7228 292e 696e 766f  CliRunner().invo
+00012740: 6b65 2862 6c61 636b 2e6d 6169 6e2c 2061  ke(black.main, a
+00012750: 7267 7329 0a20 2020 2020 2020 2073 656c  rgs).        sel
+00012760: 662e 636f 6d70 6172 655f 7265 7375 6c74  f.compare_result
+00012770: 7328 7265 7375 6c74 2c20 2222 2c20 3129  s(result, "", 1)
+00012780: 0a0a 2020 2020 6465 6620 7465 7374 5f63  ..    def test_c
+00012790: 6f64 655f 6f70 7469 6f6e 5f64 6966 6628  ode_option_diff(
+000127a0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+000127b0: 2020 2020 2020 2022 2222 5465 7374 2074         """Test t
+000127c0: 6865 2063 6f64 6520 6f70 7469 6f6e 2077  he code option w
+000127d0: 6865 6e20 6469 6666 2069 7320 7061 7373  hen diff is pass
+000127e0: 6564 2e22 2222 0a20 2020 2020 2020 2063  ed.""".        c
+000127f0: 6f64 6520 3d20 2270 7269 6e74 2827 6865  ode = "print('he
+00012800: 6c6c 6f20 776f 726c 6427 2922 0a20 2020  llo world')".   
+00012810: 2020 2020 2066 6f72 6d61 7474 6564 203d       formatted =
+00012820: 2062 6c61 636b 2e66 6f72 6d61 745f 7374   black.format_st
+00012830: 7228 636f 6465 2c20 6d6f 6465 3d44 4546  r(code, mode=DEF
+00012840: 4155 4c54 5f4d 4f44 4529 0a20 2020 2020  AULT_MODE).     
+00012850: 2020 2072 6573 756c 745f 6469 6666 203d     result_diff =
+00012860: 2064 6966 6628 636f 6465 2c20 666f 726d   diff(code, form
+00012870: 6174 7465 642c 2022 5354 4449 4e22 2c20  atted, "STDIN", 
+00012880: 2253 5444 4f55 5422 290a 0a20 2020 2020  "STDOUT")..     
+00012890: 2020 2061 7267 7320 3d20 5b22 2d2d 6469     args = ["--di
+000128a0: 6666 222c 2022 2d2d 636f 6465 222c 2063  ff", "--code", c
+000128b0: 6f64 655d 0a20 2020 2020 2020 2072 6573  ode].        res
+000128c0: 756c 7420 3d20 436c 6952 756e 6e65 7228  ult = CliRunner(
+000128d0: 292e 696e 766f 6b65 2862 6c61 636b 2e6d  ).invoke(black.m
+000128e0: 6169 6e2c 2061 7267 7329 0a0a 2020 2020  ain, args)..    
+000128f0: 2020 2020 2320 5265 6d6f 7665 2074 696d      # Remove tim
+00012900: 6520 6672 6f6d 2064 6966 660a 2020 2020  e from diff.    
+00012910: 2020 2020 6f75 7470 7574 203d 2044 4946      output = DIF
+00012920: 465f 5449 4d45 2e73 7562 2822 222c 2072  F_TIME.sub("", r
+00012930: 6573 756c 742e 6f75 7470 7574 290a 0a20  esult.output).. 
+00012940: 2020 2020 2020 2061 7373 6572 7420 6f75         assert ou
+00012950: 7470 7574 203d 3d20 7265 7375 6c74 5f64  tput == result_d
+00012960: 6966 662c 2022 5468 6520 6f75 7470 7574  iff, "The output
+00012970: 2064 6964 206e 6f74 206d 6174 6368 2074   did not match t
+00012980: 6865 2065 7870 6563 7465 6420 7661 6c75  he expected valu
+00012990: 652e 220a 2020 2020 2020 2020 6173 7365  e.".        asse
+000129a0: 7274 2072 6573 756c 742e 6578 6974 5f63  rt result.exit_c
+000129b0: 6f64 6520 3d3d 2030 2c20 2254 6865 2065  ode == 0, "The e
+000129c0: 7869 7420 636f 6465 2069 7320 696e 636f  xit code is inco
+000129d0: 7272 6563 742e 220a 0a20 2020 2064 6566  rrect."..    def
+000129e0: 2074 6573 745f 636f 6465 5f6f 7074 696f   test_code_optio
+000129f0: 6e5f 636f 6c6f 725f 6469 6666 2873 656c  n_color_diff(sel
+00012a00: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00012a10: 2020 2020 2222 2254 6573 7420 7468 6520      """Test the 
+00012a20: 636f 6465 206f 7074 696f 6e20 7768 656e  code option when
+00012a30: 2063 6f6c 6f72 2061 6e64 2064 6966 6620   color and diff 
+00012a40: 6172 6520 7061 7373 6564 2e22 2222 0a20  are passed.""". 
+00012a50: 2020 2020 2020 2063 6f64 6520 3d20 2270         code = "p
+00012a60: 7269 6e74 2827 6865 6c6c 6f20 776f 726c  rint('hello worl
+00012a70: 6427 2922 0a20 2020 2020 2020 2066 6f72  d')".        for
+00012a80: 6d61 7474 6564 203d 2062 6c61 636b 2e66  matted = black.f
+00012a90: 6f72 6d61 745f 7374 7228 636f 6465 2c20  ormat_str(code, 
+00012aa0: 6d6f 6465 3d44 4546 4155 4c54 5f4d 4f44  mode=DEFAULT_MOD
+00012ab0: 4529 0a0a 2020 2020 2020 2020 7265 7375  E)..        resu
+00012ac0: 6c74 5f64 6966 6620 3d20 6469 6666 2863  lt_diff = diff(c
+00012ad0: 6f64 652c 2066 6f72 6d61 7474 6564 2c20  ode, formatted, 
+00012ae0: 2253 5444 494e 222c 2022 5354 444f 5554  "STDIN", "STDOUT
+00012af0: 2229 0a20 2020 2020 2020 2072 6573 756c  ").        resul
+00012b00: 745f 6469 6666 203d 2063 6f6c 6f72 5f64  t_diff = color_d
+00012b10: 6966 6628 7265 7375 6c74 5f64 6966 6629  iff(result_diff)
+00012b20: 0a0a 2020 2020 2020 2020 6172 6773 203d  ..        args =
+00012b30: 205b 222d 2d64 6966 6622 2c20 222d 2d63   ["--diff", "--c
+00012b40: 6f6c 6f72 222c 2022 2d2d 636f 6465 222c  olor", "--code",
+00012b50: 2063 6f64 655d 0a20 2020 2020 2020 2072   code].        r
+00012b60: 6573 756c 7420 3d20 436c 6952 756e 6e65  esult = CliRunne
+00012b70: 7228 292e 696e 766f 6b65 2862 6c61 636b  r().invoke(black
+00012b80: 2e6d 6169 6e2c 2061 7267 7329 0a0a 2020  .main, args)..  
+00012b90: 2020 2020 2020 2320 5265 6d6f 7665 2074        # Remove t
+00012ba0: 696d 6520 6672 6f6d 2064 6966 660a 2020  ime from diff.  
+00012bb0: 2020 2020 2020 6f75 7470 7574 203d 2044        output = D
+00012bc0: 4946 465f 5449 4d45 2e73 7562 2822 222c  IFF_TIME.sub("",
+00012bd0: 2072 6573 756c 742e 6f75 7470 7574 290a   result.output).
+00012be0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00012bf0: 6f75 7470 7574 203d 3d20 7265 7375 6c74  output == result
+00012c00: 5f64 6966 662c 2022 5468 6520 6f75 7470  _diff, "The outp
+00012c10: 7574 2064 6964 206e 6f74 206d 6174 6368  ut did not match
+00012c20: 2074 6865 2065 7870 6563 7465 6420 7661   the expected va
+00012c30: 6c75 652e 220a 2020 2020 2020 2020 6173  lue.".        as
+00012c40: 7365 7274 2072 6573 756c 742e 6578 6974  sert result.exit
+00012c50: 5f63 6f64 6520 3d3d 2030 2c20 2254 6865  _code == 0, "The
+00012c60: 2065 7869 7420 636f 6465 2069 7320 696e   exit code is in
+00012c70: 636f 7272 6563 742e 220a 0a20 2020 2040  correct."..    @
+00012c80: 7079 7465 7374 2e6d 6172 6b2e 696e 636f  pytest.mark.inco
+00012c90: 6d70 6174 6962 6c65 5f77 6974 685f 6d79  mpatible_with_my
+00012ca0: 7079 630a 2020 2020 6465 6620 7465 7374  pyc.    def test
+00012cb0: 5f63 6f64 655f 6f70 7469 6f6e 5f73 6166  _code_option_saf
+00012cc0: 6528 7365 6c66 2920 2d3e 204e 6f6e 653a  e(self) -> None:
+00012cd0: 0a20 2020 2020 2020 2022 2222 5465 7374  .        """Test
+00012ce0: 2074 6861 7420 7468 6520 636f 6465 206f   that the code o
+00012cf0: 7074 696f 6e20 7468 726f 7773 2061 6e20  ption throws an 
+00012d00: 6572 726f 7220 7768 656e 2074 6865 2073  error when the s
+00012d10: 616e 6974 7920 6368 6563 6b73 2066 6169  anity checks fai
+00012d20: 6c2e 2222 220a 2020 2020 2020 2020 2320  l.""".        # 
+00012d30: 5061 7463 6820 626c 6163 6b2e 6173 7365  Patch black.asse
+00012d40: 7274 5f65 7175 6976 616c 656e 7420 746f  rt_equivalent to
+00012d50: 2065 6e73 7572 6520 7468 6520 7361 6e69   ensure the sani
+00012d60: 7479 2063 6865 636b 7320 6661 696c 0a20  ty checks fail. 
+00012d70: 2020 2020 2020 2077 6974 6820 7061 7463         with patc
+00012d80: 682e 6f62 6a65 6374 2862 6c61 636b 2c20  h.object(black, 
+00012d90: 2261 7373 6572 745f 6571 7569 7661 6c65  "assert_equivale
+00012da0: 6e74 222c 2073 6964 655f 6566 6665 6374  nt", side_effect
+00012db0: 3d41 7373 6572 7469 6f6e 4572 726f 7229  =AssertionError)
+00012dc0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+00012dd0: 6465 203d 2027 7072 696e 7428 2248 656c  de = 'print("Hel
+00012de0: 6c6f 2077 6f72 6c64 2229 270a 2020 2020  lo world")'.    
+00012df0: 2020 2020 2020 2020 6572 726f 725f 6d73          error_ms
+00012e00: 6720 3d20 6622 7b63 6f64 657d 5c6e 6572  g = f"{code}\ner
+00012e10: 726f 723a 2063 616e 6e6f 7420 666f 726d  ror: cannot form
+00012e20: 6174 203c 7374 7269 6e67 3e3a 205c 6e22  at <string>: \n"
+00012e30: 0a0a 2020 2020 2020 2020 2020 2020 6172  ..            ar
+00012e40: 6773 203d 205b 222d 2d73 6166 6522 2c20  gs = ["--safe", 
+00012e50: 222d 2d63 6f64 6522 2c20 636f 6465 5d0a  "--code", code].
+00012e60: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00012e70: 6c74 203d 2043 6c69 5275 6e6e 6572 2829  lt = CliRunner()
+00012e80: 2e69 6e76 6f6b 6528 626c 6163 6b2e 6d61  .invoke(black.ma
+00012e90: 696e 2c20 6172 6773 290a 0a20 2020 2020  in, args)..     
+00012ea0: 2020 2020 2020 2073 656c 662e 636f 6d70         self.comp
+00012eb0: 6172 655f 7265 7375 6c74 7328 7265 7375  are_results(resu
+00012ec0: 6c74 2c20 6572 726f 725f 6d73 672c 2031  lt, error_msg, 1
+00012ed0: 3233 290a 0a20 2020 2064 6566 2074 6573  23)..    def tes
+00012ee0: 745f 636f 6465 5f6f 7074 696f 6e5f 6661  t_code_option_fa
+00012ef0: 7374 2873 656c 6629 202d 3e20 4e6f 6e65  st(self) -> None
+00012f00: 3a0a 2020 2020 2020 2020 2222 2254 6573  :.        """Tes
+00012f10: 7420 7468 6174 2074 6865 2063 6f64 6520  t that the code 
+00012f20: 6f70 7469 6f6e 2069 676e 6f72 6573 2065  option ignores e
+00012f30: 7272 6f72 7320 7768 656e 2074 6865 2073  rrors when the s
+00012f40: 616e 6974 7920 6368 6563 6b73 2066 6169  anity checks fai
+00012f50: 6c2e 2222 220a 2020 2020 2020 2020 2320  l.""".        # 
+00012f60: 5061 7463 6820 626c 6163 6b2e 6173 7365  Patch black.asse
+00012f70: 7274 5f65 7175 6976 616c 656e 7420 746f  rt_equivalent to
+00012f80: 2065 6e73 7572 6520 7468 6520 7361 6e69   ensure the sani
+00012f90: 7479 2063 6865 636b 7320 6661 696c 0a20  ty checks fail. 
+00012fa0: 2020 2020 2020 2077 6974 6820 7061 7463         with patc
+00012fb0: 682e 6f62 6a65 6374 2862 6c61 636b 2c20  h.object(black, 
+00012fc0: 2261 7373 6572 745f 6571 7569 7661 6c65  "assert_equivale
+00012fd0: 6e74 222c 2073 6964 655f 6566 6665 6374  nt", side_effect
+00012fe0: 3d41 7373 6572 7469 6f6e 4572 726f 7229  =AssertionError)
+00012ff0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+00013000: 6465 203d 2027 7072 696e 7428 2248 656c  de = 'print("Hel
+00013010: 6c6f 2077 6f72 6c64 2229 270a 2020 2020  lo world")'.    
+00013020: 2020 2020 2020 2020 666f 726d 6174 7465          formatte
+00013030: 6420 3d20 626c 6163 6b2e 666f 726d 6174  d = black.format
+00013040: 5f73 7472 2863 6f64 652c 206d 6f64 653d  _str(code, mode=
+00013050: 4445 4641 554c 545f 4d4f 4445 290a 0a20  DEFAULT_MODE).. 
+00013060: 2020 2020 2020 2020 2020 2061 7267 7320             args 
+00013070: 3d20 5b22 2d2d 6661 7374 222c 2022 2d2d  = ["--fast", "--
+00013080: 636f 6465 222c 2063 6f64 655d 0a20 2020  code", code].   
+00013090: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+000130a0: 3d20 436c 6952 756e 6e65 7228 292e 696e  = CliRunner().in
+000130b0: 766f 6b65 2862 6c61 636b 2e6d 6169 6e2c  voke(black.main,
+000130c0: 2061 7267 7329 0a0a 2020 2020 2020 2020   args)..        
+000130d0: 2020 2020 7365 6c66 2e63 6f6d 7061 7265      self.compare
+000130e0: 5f72 6573 756c 7473 2872 6573 756c 742c  _results(result,
+000130f0: 2066 6f72 6d61 7474 6564 2c20 3029 0a0a   formatted, 0)..
+00013100: 2020 2020 4070 7974 6573 742e 6d61 726b      @pytest.mark
+00013110: 2e69 6e63 6f6d 7061 7469 626c 655f 7769  .incompatible_wi
+00013120: 7468 5f6d 7970 7963 0a20 2020 2064 6566  th_mypyc.    def
+00013130: 2074 6573 745f 636f 6465 5f6f 7074 696f   test_code_optio
+00013140: 6e5f 636f 6e66 6967 2873 656c 6629 202d  n_config(self) -
+00013150: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00013160: 2222 220a 2020 2020 2020 2020 5465 7374  """.        Test
+00013170: 2074 6861 7420 7468 6520 636f 6465 206f   that the code o
+00013180: 7074 696f 6e20 6669 6e64 7320 7468 6520  ption finds the 
+00013190: 7079 7072 6f6a 6563 742e 746f 6d6c 2069  pyproject.toml i
+000131a0: 6e20 7468 6520 6375 7272 656e 7420 6469  n the current di
+000131b0: 7265 6374 6f72 792e 0a20 2020 2020 2020  rectory..       
+000131c0: 2022 2222 0a20 2020 2020 2020 2077 6974   """.        wit
+000131d0: 6820 7061 7463 682e 6f62 6a65 6374 2862  h patch.object(b
+000131e0: 6c61 636b 2c20 2270 6172 7365 5f70 7970  lack, "parse_pyp
+000131f0: 726f 6a65 6374 5f74 6f6d 6c22 2c20 7265  roject_toml", re
+00013200: 7475 726e 5f76 616c 7565 3d7b 7d29 2061  turn_value={}) a
+00013210: 7320 7061 7273 653a 0a20 2020 2020 2020  s parse:.       
+00013220: 2020 2020 2061 7267 7320 3d20 5b22 2d2d       args = ["--
+00013230: 636f 6465 222c 2022 7072 696e 7422 5d0a  code", "print"].
+00013240: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
+00013250: 6973 2069 7320 7468 6520 6f6e 6c79 2064  is is the only d
+00013260: 6972 6563 746f 7279 206b 6e6f 776e 2074  irectory known t
+00013270: 6f20 636f 6e74 6169 6e20 6120 7079 7072  o contain a pypr
+00013280: 6f6a 6563 742e 746f 6d6c 0a20 2020 2020  oject.toml.     
+00013290: 2020 2020 2020 2077 6974 6820 6368 616e         with chan
+000132a0: 6765 5f64 6972 6563 746f 7279 2850 524f  ge_directory(PRO
+000132b0: 4a45 4354 5f52 4f4f 5429 3a0a 2020 2020  JECT_ROOT):.    
+000132c0: 2020 2020 2020 2020 2020 2020 436c 6952              CliR
+000132d0: 756e 6e65 7228 292e 696e 766f 6b65 2862  unner().invoke(b
+000132e0: 6c61 636b 2e6d 6169 6e2c 2061 7267 7329  lack.main, args)
+000132f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013300: 2070 7970 726f 6a65 6374 5f70 6174 6820   pyproject_path 
+00013310: 3d20 5061 7468 2850 6174 682e 6377 6428  = Path(Path.cwd(
+00013320: 292c 2022 7079 7072 6f6a 6563 742e 746f  ), "pyproject.to
+00013330: 6d6c 2229 2e72 6573 6f6c 7665 2829 0a0a  ml").resolve()..
+00013340: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+00013350: 7274 2028 0a20 2020 2020 2020 2020 2020  rt (.           
+00013360: 2020 2020 206c 656e 2870 6172 7365 2e6d       len(parse.m
+00013370: 6f63 6b5f 6361 6c6c 7329 203e 3d20 310a  ock_calls) >= 1.
+00013380: 2020 2020 2020 2020 2020 2020 292c 2022              ), "
+00013390: 4578 7065 6374 6564 2063 6f6e 6669 6720  Expected config 
+000133a0: 7061 7273 6520 746f 2062 6520 6361 6c6c  parse to be call
+000133b0: 6564 2077 6974 6820 7468 6520 6375 7272  ed with the curr
+000133c0: 656e 7420 6469 7265 6374 6f72 792e 220a  ent directory.".
+000133d0: 0a20 2020 2020 2020 2020 2020 205f 2c20  .            _, 
+000133e0: 6361 6c6c 5f61 7267 732c 205f 203d 2070  call_args, _ = p
+000133f0: 6172 7365 2e6d 6f63 6b5f 6361 6c6c 735b  arse.mock_calls[
+00013400: 305d 0a20 2020 2020 2020 2020 2020 2061  0].            a
+00013410: 7373 6572 7420 280a 2020 2020 2020 2020  ssert (.        
+00013420: 2020 2020 2020 2020 6361 6c6c 5f61 7267          call_arg
+00013430: 735b 305d 2e6c 6f77 6572 2829 203d 3d20  s[0].lower() == 
+00013440: 7374 7228 7079 7072 6f6a 6563 745f 7061  str(pyproject_pa
+00013450: 7468 292e 6c6f 7765 7228 290a 2020 2020  th).lower().    
+00013460: 2020 2020 2020 2020 292c 2022 496e 636f          ), "Inco
+00013470: 7272 6563 7420 636f 6e66 6967 206c 6f61  rrect config loa
+00013480: 6465 642e 220a 0a20 2020 2040 7079 7465  ded."..    @pyte
+00013490: 7374 2e6d 6172 6b2e 696e 636f 6d70 6174  st.mark.incompat
+000134a0: 6962 6c65 5f77 6974 685f 6d79 7079 630a  ible_with_mypyc.
+000134b0: 2020 2020 6465 6620 7465 7374 5f63 6f64      def test_cod
+000134c0: 655f 6f70 7469 6f6e 5f70 6172 656e 745f  e_option_parent_
+000134d0: 636f 6e66 6967 2873 656c 6629 202d 3e20  config(self) -> 
+000134e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+000134f0: 220a 2020 2020 2020 2020 5465 7374 2074  ".        Test t
+00013500: 6861 7420 7468 6520 636f 6465 206f 7074  hat the code opt
+00013510: 696f 6e20 6669 6e64 7320 7468 6520 7079  ion finds the py
+00013520: 7072 6f6a 6563 742e 746f 6d6c 2069 6e20  project.toml in 
+00013530: 7468 6520 7061 7265 6e74 2064 6972 6563  the parent direc
+00013540: 746f 7279 2e0a 2020 2020 2020 2020 2222  tory..        ""
+00013550: 220a 2020 2020 2020 2020 7769 7468 2070  ".        with p
+00013560: 6174 6368 2e6f 626a 6563 7428 626c 6163  atch.object(blac
+00013570: 6b2c 2022 7061 7273 655f 7079 7072 6f6a  k, "parse_pyproj
+00013580: 6563 745f 746f 6d6c 222c 2072 6574 7572  ect_toml", retur
+00013590: 6e5f 7661 6c75 653d 7b7d 2920 6173 2070  n_value={}) as p
+000135a0: 6172 7365 3a0a 2020 2020 2020 2020 2020  arse:.          
+000135b0: 2020 7769 7468 2063 6861 6e67 655f 6469    with change_di
+000135c0: 7265 6374 6f72 7928 5448 4953 5f44 4952  rectory(THIS_DIR
+000135d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000135e0: 2020 2061 7267 7320 3d20 5b22 2d2d 636f     args = ["--co
+000135f0: 6465 222c 2022 7072 696e 7422 5d0a 2020  de", "print"].  
+00013600: 2020 2020 2020 2020 2020 2020 2020 436c                Cl
+00013610: 6952 756e 6e65 7228 292e 696e 766f 6b65  iRunner().invoke
+00013620: 2862 6c61 636b 2e6d 6169 6e2c 2061 7267  (black.main, arg
+00013630: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
+00013640: 2020 2020 7079 7072 6f6a 6563 745f 7061      pyproject_pa
+00013650: 7468 203d 2050 6174 6828 5061 7468 2829  th = Path(Path()
+00013660: 2e63 7764 2829 2e70 6172 656e 742c 2022  .cwd().parent, "
+00013670: 7079 7072 6f6a 6563 742e 746f 6d6c 2229  pyproject.toml")
+00013680: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
+00013690: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+000136a0: 7420 280a 2020 2020 2020 2020 2020 2020  t (.            
+000136b0: 2020 2020 2020 2020 6c65 6e28 7061 7273          len(pars
+000136c0: 652e 6d6f 636b 5f63 616c 6c73 2920 3e3d  e.mock_calls) >=
+000136d0: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+000136e0: 2020 2029 2c20 2245 7870 6563 7465 6420     ), "Expected 
+000136f0: 636f 6e66 6967 2070 6172 7365 2074 6f20  config parse to 
+00013700: 6265 2063 616c 6c65 6420 7769 7468 2074  be called with t
+00013710: 6865 2063 7572 7265 6e74 2064 6972 6563  he current direc
+00013720: 746f 7279 2e22 0a0a 2020 2020 2020 2020  tory."..        
+00013730: 2020 2020 2020 2020 5f2c 2063 616c 6c5f          _, call_
+00013740: 6172 6773 2c20 5f20 3d20 7061 7273 652e  args, _ = parse.
+00013750: 6d6f 636b 5f63 616c 6c73 5b30 5d0a 2020  mock_calls[0].  
+00013760: 2020 2020 2020 2020 2020 2020 2020 6173                as
+00013770: 7365 7274 2028 0a20 2020 2020 2020 2020  sert (.         
+00013780: 2020 2020 2020 2020 2020 2063 616c 6c5f             call_
+00013790: 6172 6773 5b30 5d2e 6c6f 7765 7228 2920  args[0].lower() 
+000137a0: 3d3d 2073 7472 2870 7970 726f 6a65 6374  == str(pyproject
+000137b0: 5f70 6174 6829 2e6c 6f77 6572 2829 0a20  _path).lower(). 
+000137c0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000137d0: 2c20 2249 6e63 6f72 7265 6374 2063 6f6e  , "Incorrect con
+000137e0: 6669 6720 6c6f 6164 6564 2e22 0a0a 2020  fig loaded."..  
+000137f0: 2020 6465 6620 7465 7374 5f66 6f72 5f68    def test_for_h
+00013800: 616e 646c 6564 5f75 6e65 7870 6563 7465  andled_unexpecte
+00013810: 645f 656f 665f 6572 726f 7228 7365 6c66  d_eof_error(self
+00013820: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00013830: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
+00013840: 6573 7420 7468 6174 2061 6e20 756e 6578  est that an unex
+00013850: 7065 6374 6564 2045 4f46 2053 796e 7461  pected EOF Synta
+00013860: 7845 7272 6f72 2069 7320 6e69 6365 6c79  xError is nicely
+00013870: 2070 7265 7365 6e74 6564 2e0a 2020 2020   presented..    
+00013880: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00013890: 7769 7468 2070 7974 6573 742e 7261 6973  with pytest.rais
+000138a0: 6573 2862 6c61 636b 2e70 6172 7369 6e67  es(black.parsing
+000138b0: 2e49 6e76 616c 6964 496e 7075 7429 2061  .InvalidInput) a
+000138c0: 7320 6578 635f 696e 666f 3a0a 2020 2020  s exc_info:.    
+000138d0: 2020 2020 2020 2020 626c 6163 6b2e 6c69          black.li
+000138e0: 6232 746f 335f 7061 7273 6528 2270 7269  b2to3_parse("pri
+000138f0: 6e74 2822 2c20 7b7d 290a 0a20 2020 2020  nt(", {})..     
+00013900: 2020 2065 7863 5f69 6e66 6f2e 6d61 7463     exc_info.matc
+00013910: 6828 2243 616e 6e6f 7420 7061 7273 653a  h("Cannot parse:
+00013920: 2032 3a30 3a20 454f 4620 696e 206d 756c   2:0: EOF in mul
+00013930: 7469 2d6c 696e 6520 7374 6174 656d 656e  ti-line statemen
+00013940: 7422 290a 0a20 2020 2064 6566 2074 6573  t")..    def tes
+00013950: 745f 6c69 6e65 5f72 616e 6765 735f 7769  t_line_ranges_wi
+00013960: 7468 5f63 6f64 655f 6f70 7469 6f6e 2873  th_code_option(s
+00013970: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00013980: 2020 2020 2020 636f 6465 203d 2074 6578        code = tex
+00013990: 7477 7261 702e 6465 6465 6e74 2822 2222  twrap.dedent("""
+000139a0: 5c0a 2020 2020 2020 2020 2020 2020 6966  \.            if
+000139b0: 2020 6120 203d 3d20 2062 3a0a 2020 2020    a  ==  b:.    
+000139c0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000139d0: 7420 2028 2022 4f4b 2220 290a 2020 2020  t  ( "OK" ).    
+000139e0: 2020 2020 2020 2020 2222 2229 0a20 2020          """).   
+000139f0: 2020 2020 2061 7267 7320 3d20 5b22 2d2d       args = ["--
+00013a00: 6c69 6e65 2d72 616e 6765 733d 312d 3122  line-ranges=1-1"
+00013a10: 2c20 222d 2d63 6f64 6522 2c20 636f 6465  , "--code", code
+00013a20: 5d0a 2020 2020 2020 2020 7265 7375 6c74  ].        result
+00013a30: 203d 2043 6c69 5275 6e6e 6572 2829 2e69   = CliRunner().i
+00013a40: 6e76 6f6b 6528 626c 6163 6b2e 6d61 696e  nvoke(black.main
+00013a50: 2c20 6172 6773 290a 0a20 2020 2020 2020  , args)..       
+00013a60: 2065 7870 6563 7465 6420 3d20 7465 7874   expected = text
+00013a70: 7772 6170 2e64 6564 656e 7428 2222 225c  wrap.dedent("""\
+00013a80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00013a90: 6120 3d3d 2062 3a0a 2020 2020 2020 2020  a == b:.        
+00013aa0: 2020 2020 2020 2020 7072 696e 7420 2028          print  (
+00013ab0: 2022 4f4b 2220 290a 2020 2020 2020 2020   "OK" ).        
+00013ac0: 2020 2020 2222 2229 0a20 2020 2020 2020      """).       
+00013ad0: 2073 656c 662e 636f 6d70 6172 655f 7265   self.compare_re
+00013ae0: 7375 6c74 7328 7265 7375 6c74 2c20 6578  sults(result, ex
+00013af0: 7065 6374 6564 2c20 6578 7065 6374 6564  pected, expected
+00013b00: 5f65 7869 745f 636f 6465 3d30 290a 0a20  _exit_code=0).. 
+00013b10: 2020 2064 6566 2074 6573 745f 6c69 6e65     def test_line
+00013b20: 5f72 616e 6765 735f 7769 7468 5f73 7464  _ranges_with_std
+00013b30: 696e 2873 656c 6629 202d 3e20 4e6f 6e65  in(self) -> None
+00013b40: 3a0a 2020 2020 2020 2020 636f 6465 203d  :.        code =
+00013b50: 2074 6578 7477 7261 702e 6465 6465 6e74   textwrap.dedent
+00013b60: 2822 2222 5c0a 2020 2020 2020 2020 2020  ("""\.          
+00013b70: 2020 6966 2020 6120 203d 3d20 2062 3a0a    if  a  ==  b:.
+00013b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b90: 7072 696e 7420 2028 2022 4f4b 2220 290a  print  ( "OK" ).
+00013ba0: 2020 2020 2020 2020 2020 2020 2222 2229              """)
+00013bb0: 0a20 2020 2020 2020 2072 756e 6e65 7220  .        runner 
+00013bc0: 3d20 426c 6163 6b52 756e 6e65 7228 290a  = BlackRunner().
+00013bd0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00013be0: 2072 756e 6e65 722e 696e 766f 6b65 280a   runner.invoke(.
+00013bf0: 2020 2020 2020 2020 2020 2020 626c 6163              blac
+00013c00: 6b2e 6d61 696e 2c20 5b22 2d2d 6c69 6e65  k.main, ["--line
+00013c10: 2d72 616e 6765 733d 312d 3122 2c20 222d  -ranges=1-1", "-
+00013c20: 225d 2c20 696e 7075 743d 4279 7465 7349  "], input=BytesI
+00013c30: 4f28 636f 6465 2e65 6e63 6f64 6528 2275  O(code.encode("u
+00013c40: 7466 2d38 2229 290a 2020 2020 2020 2020  tf-8")).        
+00013c50: 290a 0a20 2020 2020 2020 2065 7870 6563  )..        expec
+00013c60: 7465 6420 3d20 7465 7874 7772 6170 2e64  ted = textwrap.d
+00013c70: 6564 656e 7428 2222 225c 0a20 2020 2020  edent("""\.     
+00013c80: 2020 2020 2020 2069 6620 6120 3d3d 2062         if a == b
+00013c90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013ca0: 2020 7072 696e 7420 2028 2022 4f4b 2220    print  ( "OK" 
+00013cb0: 290a 2020 2020 2020 2020 2020 2020 2222  ).            ""
+00013cc0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+00013cd0: 636f 6d70 6172 655f 7265 7375 6c74 7328  compare_results(
+00013ce0: 7265 7375 6c74 2c20 6578 7065 6374 6564  result, expected
+00013cf0: 2c20 6578 7065 6374 6564 5f65 7869 745f  , expected_exit_
+00013d00: 636f 6465 3d30 290a 0a20 2020 2064 6566  code=0)..    def
+00013d10: 2074 6573 745f 6c69 6e65 5f72 616e 6765   test_line_range
+00013d20: 735f 7769 7468 5f73 6f75 7263 6528 7365  s_with_source(se
+00013d30: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00013d40: 2020 2020 2077 6974 6820 5465 6d70 6f72       with Tempor
+00013d50: 6172 7944 6972 6563 746f 7279 2829 2061  aryDirectory() a
+00013d60: 7320 776f 726b 7370 6163 653a 0a20 2020  s workspace:.   
+00013d70: 2020 2020 2020 2020 2074 6573 745f 6669           test_fi
+00013d80: 6c65 203d 2050 6174 6828 776f 726b 7370  le = Path(worksp
+00013d90: 6163 6529 202f 2022 7465 7374 2e70 7922  ace) / "test.py"
+00013da0: 0a20 2020 2020 2020 2020 2020 2074 6573  .            tes
+00013db0: 745f 6669 6c65 2e77 7269 7465 5f74 6578  t_file.write_tex
+00013dc0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00013dd0: 2020 2074 6578 7477 7261 702e 6465 6465     textwrap.dede
+00013de0: 6e74 2822 2222 5c0a 2020 2020 2020 2020  nt("""\.        
+00013df0: 2020 2020 6966 2020 6120 203d 3d20 2062      if  a  ==  b
+00013e00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013e10: 2020 7072 696e 7420 2028 2022 4f4b 2220    print  ( "OK" 
+00013e20: 290a 2020 2020 2020 2020 2020 2020 2222  ).            ""
+00013e30: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
+00013e40: 2020 2020 656e 636f 6469 6e67 3d22 7574      encoding="ut
+00013e50: 662d 3822 2c0a 2020 2020 2020 2020 2020  f-8",.          
+00013e60: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00013e70: 6172 6773 203d 205b 222d 2d6c 696e 652d  args = ["--line-
+00013e80: 7261 6e67 6573 3d31 2d31 222c 2073 7472  ranges=1-1", str
+00013e90: 2874 6573 745f 6669 6c65 295d 0a20 2020  (test_file)].   
+00013ea0: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+00013eb0: 3d20 436c 6952 756e 6e65 7228 292e 696e  = CliRunner().in
+00013ec0: 766f 6b65 2862 6c61 636b 2e6d 6169 6e2c  voke(black.main,
+00013ed0: 2061 7267 7329 0a20 2020 2020 2020 2020   args).         
+00013ee0: 2020 2061 7373 6572 7420 6e6f 7420 7265     assert not re
+00013ef0: 7375 6c74 2e65 7869 745f 636f 6465 0a0a  sult.exit_code..
+00013f00: 2020 2020 2020 2020 2020 2020 666f 726d              form
+00013f10: 6174 7465 6420 3d20 7465 7374 5f66 696c  atted = test_fil
+00013f20: 652e 7265 6164 5f74 6578 7428 656e 636f  e.read_text(enco
+00013f30: 6469 6e67 3d22 7574 662d 3822 290a 2020  ding="utf-8").  
+00013f40: 2020 2020 2020 2020 2020 6578 7065 6374            expect
+00013f50: 6564 203d 2074 6578 7477 7261 702e 6465  ed = textwrap.de
+00013f60: 6465 6e74 2822 2222 5c0a 2020 2020 2020  dent("""\.      
+00013f70: 2020 2020 2020 6966 2061 203d 3d20 623a        if a == b:
+00013f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013f90: 2070 7269 6e74 2020 2820 224f 4b22 2029   print  ( "OK" )
+00013fa0: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
+00013fb0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+00013fc0: 7365 7274 2065 7870 6563 7465 6420 3d3d  sert expected ==
+00013fd0: 2066 6f72 6d61 7474 6564 0a0a 2020 2020   formatted..    
+00013fe0: 6465 6620 7465 7374 5f6c 696e 655f 7261  def test_line_ra
+00013ff0: 6e67 6573 5f77 6974 685f 6d75 6c74 6970  nges_with_multip
+00014000: 6c65 5f73 6f75 7263 6573 2873 656c 6629  le_sources(self)
+00014010: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00014020: 2020 7769 7468 2054 656d 706f 7261 7279    with Temporary
+00014030: 4469 7265 6374 6f72 7928 2920 6173 2077  Directory() as w
+00014040: 6f72 6b73 7061 6365 3a0a 2020 2020 2020  orkspace:.      
+00014050: 2020 2020 2020 7465 7374 315f 6669 6c65        test1_file
+00014060: 203d 2050 6174 6828 776f 726b 7370 6163   = Path(workspac
+00014070: 6529 202f 2022 7465 7374 312e 7079 220a  e) / "test1.py".
+00014080: 2020 2020 2020 2020 2020 2020 7465 7374              test
+00014090: 315f 6669 6c65 2e77 7269 7465 5f74 6578  1_file.write_tex
+000140a0: 7428 2222 2c20 656e 636f 6469 6e67 3d22  t("", encoding="
+000140b0: 7574 662d 3822 290a 2020 2020 2020 2020  utf-8").        
+000140c0: 2020 2020 7465 7374 325f 6669 6c65 203d      test2_file =
+000140d0: 2050 6174 6828 776f 726b 7370 6163 6529   Path(workspace)
+000140e0: 202f 2022 7465 7374 322e 7079 220a 2020   / "test2.py".  
+000140f0: 2020 2020 2020 2020 2020 7465 7374 325f            test2_
+00014100: 6669 6c65 2e77 7269 7465 5f74 6578 7428  file.write_text(
+00014110: 2222 2c20 656e 636f 6469 6e67 3d22 7574  "", encoding="ut
+00014120: 662d 3822 290a 2020 2020 2020 2020 2020  f-8").          
+00014130: 2020 6172 6773 203d 205b 222d 2d6c 696e    args = ["--lin
+00014140: 652d 7261 6e67 6573 3d31 2d31 222c 2073  e-ranges=1-1", s
+00014150: 7472 2874 6573 7431 5f66 696c 6529 2c20  tr(test1_file), 
+00014160: 7374 7228 7465 7374 325f 6669 6c65 295d  str(test2_file)]
+00014170: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00014180: 756c 7420 3d20 436c 6952 756e 6e65 7228  ult = CliRunner(
+00014190: 292e 696e 766f 6b65 2862 6c61 636b 2e6d  ).invoke(black.m
+000141a0: 6169 6e2c 2061 7267 7329 0a20 2020 2020  ain, args).     
+000141b0: 2020 2020 2020 2061 7373 6572 7420 7265         assert re
+000141c0: 7375 6c74 2e65 7869 745f 636f 6465 203d  sult.exit_code =
+000141d0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+000141e0: 6173 7365 7274 2022 4361 6e6e 6f74 2075  assert "Cannot u
+000141f0: 7365 202d 2d6c 696e 652d 7261 6e67 6573  se --line-ranges
+00014200: 2074 6f20 666f 726d 6174 206d 756c 7469   to format multi
+00014210: 706c 6520 6669 6c65 7322 2069 6e20 7265  ple files" in re
+00014220: 7375 6c74 2e6f 7574 7075 740a 0a20 2020  sult.output..   
+00014230: 2064 6566 2074 6573 745f 6c69 6e65 5f72   def test_line_r
+00014240: 616e 6765 735f 7769 7468 5f69 7079 6e62  anges_with_ipynb
+00014250: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00014260: 2020 2020 2020 2020 7769 7468 2054 656d          with Tem
+00014270: 706f 7261 7279 4469 7265 6374 6f72 7928  poraryDirectory(
+00014280: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
+00014290: 2020 2020 2020 2020 2020 2020 7465 7374              test
+000142a0: 5f66 696c 6520 3d20 5061 7468 2877 6f72  _file = Path(wor
+000142b0: 6b73 7061 6365 2920 2f20 2274 6573 742e  kspace) / "test.
+000142c0: 6970 796e 6222 0a20 2020 2020 2020 2020  ipynb".         
+000142d0: 2020 2074 6573 745f 6669 6c65 2e77 7269     test_file.wri
+000142e0: 7465 5f74 6578 7428 227b 7d22 2c20 656e  te_text("{}", en
+000142f0: 636f 6469 6e67 3d22 7574 662d 3822 290a  coding="utf-8").
+00014300: 2020 2020 2020 2020 2020 2020 6172 6773              args
+00014310: 203d 205b 222d 2d6c 696e 652d 7261 6e67   = ["--line-rang
+00014320: 6573 3d31 2d31 222c 2022 2d2d 6970 796e  es=1-1", "--ipyn
+00014330: 6222 2c20 7374 7228 7465 7374 5f66 696c  b", str(test_fil
+00014340: 6529 5d0a 2020 2020 2020 2020 2020 2020  e)].            
+00014350: 7265 7375 6c74 203d 2043 6c69 5275 6e6e  result = CliRunn
+00014360: 6572 2829 2e69 6e76 6f6b 6528 626c 6163  er().invoke(blac
+00014370: 6b2e 6d61 696e 2c20 6172 6773 290a 2020  k.main, args).  
+00014380: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00014390: 2022 4361 6e6e 6f74 2075 7365 202d 2d6c   "Cannot use --l
+000143a0: 696e 652d 7261 6e67 6573 2077 6974 6820  ine-ranges with 
+000143b0: 6970 796e 6220 6669 6c65 7322 2069 6e20  ipynb files" in 
+000143c0: 7265 7375 6c74 2e6f 7574 7075 740a 2020  result.output.  
+000143d0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+000143e0: 2072 6573 756c 742e 6578 6974 5f63 6f64   result.exit_cod
+000143f0: 6520 3d3d 2031 0a0a 2020 2020 6465 6620  e == 1..    def 
+00014400: 7465 7374 5f6c 696e 655f 7261 6e67 6573  test_line_ranges
+00014410: 5f69 6e5f 7079 7072 6f6a 6563 745f 746f  _in_pyproject_to
+00014420: 6d6c 2873 656c 6629 202d 3e20 4e6f 6e65  ml(self) -> None
+00014430: 3a0a 2020 2020 2020 2020 636f 6e66 6967  :.        config
+00014440: 203d 2054 4849 535f 4449 5220 2f20 2264   = THIS_DIR / "d
+00014450: 6174 6122 202f 2022 696e 7661 6c69 645f  ata" / "invalid_
+00014460: 6c69 6e65 5f72 616e 6765 732e 746f 6d6c  line_ranges.toml
+00014470: 220a 2020 2020 2020 2020 7265 7375 6c74  ".        result
+00014480: 203d 2042 6c61 636b 5275 6e6e 6572 2829   = BlackRunner()
+00014490: 2e69 6e76 6f6b 6528 0a20 2020 2020 2020  .invoke(.       
+000144a0: 2020 2020 2062 6c61 636b 2e6d 6169 6e2c       black.main,
+000144b0: 205b 222d 2d63 6f64 6522 2c20 2270 7269   ["--code", "pri
+000144c0: 6e74 2829 222c 2022 2d2d 636f 6e66 6967  nt()", "--config
+000144d0: 222c 2073 7472 2863 6f6e 6669 6729 5d0a  ", str(config)].
+000144e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000144f0: 2020 6173 7365 7274 2072 6573 756c 742e    assert result.
+00014500: 6578 6974 5f63 6f64 6520 3d3d 2032 0a20  exit_code == 2. 
+00014510: 2020 2020 2020 2061 7373 6572 7420 7265         assert re
+00014520: 7375 6c74 2e73 7464 6572 725f 6279 7465  sult.stderr_byte
+00014530: 7320 6973 206e 6f74 204e 6f6e 650a 2020  s is not None.  
+00014540: 2020 2020 2020 6173 7365 7274 2028 0a20        assert (. 
+00014550: 2020 2020 2020 2020 2020 2062 2243 616e             b"Can
+00014560: 6e6f 7420 7573 6520 6c69 6e65 2d72 616e  not use line-ran
+00014570: 6765 7320 696e 2074 6865 2070 7970 726f  ges in the pypro
+00014580: 6a65 6374 2e74 6f6d 6c20 6669 6c65 2e22  ject.toml file."
+00014590: 2069 6e20 7265 7375 6c74 2e73 7464 6572   in result.stder
+000145a0: 725f 6279 7465 730a 2020 2020 2020 2020  r_bytes.        
+000145b0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+000145c0: 6c69 6e65 735f 7769 7468 5f6c 6561 6469  lines_with_leadi
+000145d0: 6e67 5f74 6162 735f 6578 7061 6e64 6564  ng_tabs_expanded
+000145e0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+000145f0: 2020 2020 2020 2020 2320 5365 6520 4356          # See CV
+00014600: 452d 3230 3234 2d32 3135 3033 2e20 4d6f  E-2024-21503. Mo
+00014610: 7374 6c79 2074 6573 7420 7468 6174 2074  stly test that t
+00014620: 6869 7320 636f 6d70 6c65 7465 7320 696e  his completes in
+00014630: 2061 2072 6561 736f 6e61 626c 650a 2020   a reasonable.  
+00014640: 2020 2020 2020 2320 7469 6d65 2e0a 2020        # time..  
+00014650: 2020 2020 2020 7061 796c 6f61 6420 3d20        payload = 
+00014660: 225c 7422 202a 2031 305f 3030 300a 2020  "\t" * 10_000.  
+00014670: 2020 2020 2020 6173 7365 7274 206c 696e        assert lin
+00014680: 6573 5f77 6974 685f 6c65 6164 696e 675f  es_with_leading_
+00014690: 7461 6273 5f65 7870 616e 6465 6428 7061  tabs_expanded(pa
+000146a0: 796c 6f61 6429 203d 3d20 5b70 6179 6c6f  yload) == [paylo
+000146b0: 6164 5d0a 0a20 2020 2020 2020 2074 6162  ad]..        tab
+000146c0: 203d 2022 2022 202a 2038 0a20 2020 2020   = " " * 8.     
+000146d0: 2020 2061 7373 6572 7420 6c69 6e65 735f     assert lines_
+000146e0: 7769 7468 5f6c 6561 6469 6e67 5f74 6162  with_leading_tab
+000146f0: 735f 6578 7061 6e64 6564 2822 5c74 7822  s_expanded("\tx"
+00014700: 2920 3d3d 205b 6622 7b74 6162 7d78 225d  ) == [f"{tab}x"]
+00014710: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00014720: 6c69 6e65 735f 7769 7468 5f6c 6561 6469  lines_with_leadi
+00014730: 6e67 5f74 6162 735f 6578 7061 6e64 6564  ng_tabs_expanded
+00014740: 2822 5c74 5c74 7822 2920 3d3d 205b 6622  ("\t\tx") == [f"
+00014750: 7b74 6162 7d7b 7461 627d 7822 5d0a 2020  {tab}{tab}x"].  
+00014760: 2020 2020 2020 6173 7365 7274 206c 696e        assert lin
+00014770: 6573 5f77 6974 685f 6c65 6164 696e 675f  es_with_leading_
+00014780: 7461 6273 5f65 7870 616e 6465 6428 225c  tabs_expanded("\
+00014790: 7478 5c6e 2020 7922 2920 3d3d 205b 6622  tx\n  y") == [f"
+000147a0: 7b74 6162 7d78 222c 2022 2020 7922 5d0a  {tab}x", "  y"].
+000147b0: 0a0a 636c 6173 7320 5465 7374 4361 6368  ..class TestCach
+000147c0: 696e 673a 0a20 2020 2064 6566 2074 6573  ing:.    def tes
+000147d0: 745f 6765 745f 6361 6368 655f 6469 7228  t_get_cache_dir(
+000147e0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+000147f0: 2020 2020 2020 2074 6d70 5f70 6174 683a         tmp_path:
+00014800: 2050 6174 682c 0a20 2020 2020 2020 206d   Path,.        m
+00014810: 6f6e 6b65 7970 6174 6368 3a20 7079 7465  onkeypatch: pyte
+00014820: 7374 2e4d 6f6e 6b65 7950 6174 6368 2c0a  st.MonkeyPatch,.
+00014830: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
+00014840: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+00014850: 6d75 6c74 6970 6c65 2063 6163 6865 2064  multiple cache d
+00014860: 6972 6563 746f 7269 6573 0a20 2020 2020  irectories.     
+00014870: 2020 2077 6f72 6b73 7061 6365 3120 3d20     workspace1 = 
+00014880: 746d 705f 7061 7468 202f 2022 7773 3122  tmp_path / "ws1"
+00014890: 0a20 2020 2020 2020 2077 6f72 6b73 7061  .        workspa
+000148a0: 6365 312e 6d6b 6469 7228 290a 2020 2020  ce1.mkdir().    
+000148b0: 2020 2020 776f 726b 7370 6163 6532 203d      workspace2 =
+000148c0: 2074 6d70 5f70 6174 6820 2f20 2277 7332   tmp_path / "ws2
+000148d0: 220a 2020 2020 2020 2020 776f 726b 7370  ".        worksp
+000148e0: 6163 6532 2e6d 6b64 6972 2829 0a0a 2020  ace2.mkdir()..  
+000148f0: 2020 2020 2020 2320 466f 7263 6520 7573        # Force us
+00014900: 6572 5f63 6163 6865 5f64 6972 2074 6f20  er_cache_dir to 
+00014910: 7573 6520 7468 6520 7465 6d70 6f72 6172  use the temporar
+00014920: 7920 6469 7265 6374 6f72 7920 666f 7220  y directory for 
+00014930: 6561 7369 6572 2061 7373 6572 7469 6f6e  easier assertion
+00014940: 730a 2020 2020 2020 2020 7061 7463 685f  s.        patch_
+00014950: 7573 6572 5f63 6163 6865 5f64 6972 203d  user_cache_dir =
+00014960: 2070 6174 6368 280a 2020 2020 2020 2020   patch(.        
+00014970: 2020 2020 7461 7267 6574 3d22 626c 6163      target="blac
+00014980: 6b2e 6361 6368 652e 7573 6572 5f63 6163  k.cache.user_cac
+00014990: 6865 5f64 6972 222c 0a20 2020 2020 2020  he_dir",.       
+000149a0: 2020 2020 2061 7574 6f73 7065 633d 5472       autospec=Tr
+000149b0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+000149c0: 7265 7475 726e 5f76 616c 7565 3d73 7472  return_value=str
+000149d0: 2877 6f72 6b73 7061 6365 3129 2c0a 2020  (workspace1),.  
+000149e0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+000149f0: 2023 2049 6620 424c 4143 4b5f 4341 4348   # If BLACK_CACH
+00014a00: 455f 4449 5220 6973 206e 6f74 2073 6574  E_DIR is not set
+00014a10: 2c20 7573 6520 7573 6572 5f63 6163 6865  , use user_cache
+00014a20: 5f64 6972 0a20 2020 2020 2020 206d 6f6e  _dir.        mon
+00014a30: 6b65 7970 6174 6368 2e64 656c 656e 7628  keypatch.delenv(
+00014a40: 2242 4c41 434b 5f43 4143 4845 5f44 4952  "BLACK_CACHE_DIR
+00014a50: 222c 2072 6169 7369 6e67 3d46 616c 7365  ", raising=False
+00014a60: 290a 2020 2020 2020 2020 7769 7468 2070  ).        with p
+00014a70: 6174 6368 5f75 7365 725f 6361 6368 655f  atch_user_cache_
+00014a80: 6469 723a 0a20 2020 2020 2020 2020 2020  dir:.           
+00014a90: 2061 7373 6572 7420 6765 745f 6361 6368   assert get_cach
+00014aa0: 655f 6469 7228 292e 7061 7265 6e74 203d  e_dir().parent =
+00014ab0: 3d20 776f 726b 7370 6163 6531 0a0a 2020  = workspace1..  
+00014ac0: 2020 2020 2020 2320 4966 2069 7420 6973        # If it is
+00014ad0: 2073 6574 2c20 7573 6520 7468 6520 7061   set, use the pa
+00014ae0: 7468 2070 726f 7669 6465 6420 696e 2074  th provided in t
+00014af0: 6865 2065 6e76 2076 6172 2e0a 2020 2020  he env var..    
+00014b00: 2020 2020 6d6f 6e6b 6579 7061 7463 682e      monkeypatch.
+00014b10: 7365 7465 6e76 2822 424c 4143 4b5f 4341  setenv("BLACK_CA
+00014b20: 4348 455f 4449 5222 2c20 7374 7228 776f  CHE_DIR", str(wo
+00014b30: 726b 7370 6163 6532 2929 0a20 2020 2020  rkspace2)).     
+00014b40: 2020 2061 7373 6572 7420 6765 745f 6361     assert get_ca
+00014b50: 6368 655f 6469 7228 292e 7061 7265 6e74  che_dir().parent
+00014b60: 203d 3d20 776f 726b 7370 6163 6532 0a0a   == workspace2..
+00014b70: 2020 2020 6465 6620 7465 7374 5f63 6163      def test_cac
+00014b80: 6865 5f66 696c 655f 6c65 6e67 7468 2873  he_file_length(s
+00014b90: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00014ba0: 2020 2020 2020 6361 7365 7320 3d20 5b0a        cases = [.
+00014bb0: 2020 2020 2020 2020 2020 2020 4445 4641              DEFA
+00014bc0: 554c 545f 4d4f 4445 2c0a 2020 2020 2020  ULT_MODE,.      
+00014bd0: 2020 2020 2020 2320 616c 6c20 6f66 2074        # all of t
+00014be0: 6865 2074 6172 6765 7420 7665 7273 696f  he target versio
+00014bf0: 6e73 0a20 2020 2020 2020 2020 2020 204d  ns.            M
+00014c00: 6f64 6528 7461 7267 6574 5f76 6572 7369  ode(target_versi
+00014c10: 6f6e 733d 7365 7428 5461 7267 6574 5665  ons=set(TargetVe
+00014c20: 7273 696f 6e29 292c 0a20 2020 2020 2020  rsion)),.       
+00014c30: 2020 2020 2023 2061 6c6c 206f 6620 7468       # all of th
+00014c40: 6520 6665 6174 7572 6573 0a20 2020 2020  e features.     
+00014c50: 2020 2020 2020 204d 6f64 6528 656e 6162         Mode(enab
+00014c60: 6c65 645f 6665 6174 7572 6573 3d73 6574  led_features=set
+00014c70: 2850 7265 7669 6577 2929 2c0a 2020 2020  (Preview)),.    
+00014c80: 2020 2020 2020 2020 2320 616c 6c20 6f66          # all of
+00014c90: 2074 6865 206d 6167 6963 730a 2020 2020   the magics.    
+00014ca0: 2020 2020 2020 2020 4d6f 6465 2870 7974          Mode(pyt
+00014cb0: 686f 6e5f 6365 6c6c 5f6d 6167 6963 733d  hon_cell_magics=
+00014cc0: 7b66 226d 6167 6963 7b69 7d22 2066 6f72  {f"magic{i}" for
+00014cd0: 2069 2069 6e20 7261 6e67 6528 3530 3029   i in range(500)
+00014ce0: 7d29 2c0a 2020 2020 2020 2020 2020 2020  }),.            
+00014cf0: 2320 616c 6c20 6f66 2074 6865 2074 6869  # all of the thi
+00014d00: 6e67 730a 2020 2020 2020 2020 2020 2020  ngs.            
+00014d10: 4d6f 6465 280a 2020 2020 2020 2020 2020  Mode(.          
+00014d20: 2020 2020 2020 7461 7267 6574 5f76 6572        target_ver
+00014d30: 7369 6f6e 733d 7365 7428 5461 7267 6574  sions=set(Target
+00014d40: 5665 7273 696f 6e29 2c0a 2020 2020 2020  Version),.      
+00014d50: 2020 2020 2020 2020 2020 656e 6162 6c65            enable
+00014d60: 645f 6665 6174 7572 6573 3d73 6574 2850  d_features=set(P
+00014d70: 7265 7669 6577 292c 0a20 2020 2020 2020  review),.       
+00014d80: 2020 2020 2020 2020 2070 7974 686f 6e5f           python_
+00014d90: 6365 6c6c 5f6d 6167 6963 733d 7b66 226d  cell_magics={f"m
+00014da0: 6167 6963 7b69 7d22 2066 6f72 2069 2069  agic{i}" for i i
+00014db0: 6e20 7261 6e67 6528 3530 3029 7d2c 0a20  n range(500)},. 
+00014dc0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+00014dd0: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+00014de0: 666f 7220 6361 7365 2069 6e20 6361 7365  for case in case
+00014df0: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
+00014e00: 6163 6865 5f66 696c 6520 3d20 6765 745f  ache_file = get_
+00014e10: 6361 6368 655f 6669 6c65 2863 6173 6529  cache_file(case)
+00014e20: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+00014e30: 6f6d 6520 636f 6d6d 6f6e 2066 696c 6520  ome common file 
+00014e40: 7379 7374 656d 7320 656e 666f 7263 6520  systems enforce 
+00014e50: 6120 6d61 7869 6d75 6d20 7061 7468 206c  a maximum path l
+00014e60: 656e 6774 680a 2020 2020 2020 2020 2020  ength.          
+00014e70: 2020 2320 6f66 2031 3433 2028 6973 7375    # of 143 (issu
+00014e80: 6520 2334 3137 3429 2e20 5765 2063 616e  e #4174). We can
+00014e90: 2774 2064 6f20 616e 7974 6869 6e67 2069  't do anything i
+00014ea0: 6620 7468 6520 6469 7265 6374 6f72 790a  f the directory.
+00014eb0: 2020 2020 2020 2020 2020 2020 2320 7061              # pa
+00014ec0: 7468 2069 7320 746f 6f20 6c6f 6e67 2c20  th is too long, 
+00014ed0: 6275 7420 656e 7375 7265 2074 6865 206e  but ensure the n
+00014ee0: 616d 6520 6f66 2074 6865 2063 6163 6865  ame of the cache
+00014ef0: 2066 696c 6520 6974 7365 6c66 0a20 2020   file itself.   
+00014f00: 2020 2020 2020 2020 2023 2064 6f65 736e           # doesn
+00014f10: 2774 2067 6574 2074 6f6f 2063 7261 7a79  't get too crazy
+00014f20: 2e0a 2020 2020 2020 2020 2020 2020 6173  ..            as
+00014f30: 7365 7274 206c 656e 2863 6163 6865 5f66  sert len(cache_f
+00014f40: 696c 652e 6e61 6d65 2920 3c3d 2039 360a  ile.name) <= 96.
+00014f50: 0a20 2020 2064 6566 2074 6573 745f 6361  .    def test_ca
+00014f60: 6368 655f 6272 6f6b 656e 5f66 696c 6528  che_broken_file(
+00014f70: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00014f80: 2020 2020 2020 206d 6f64 6520 3d20 4445         mode = DE
+00014f90: 4641 554c 545f 4d4f 4445 0a20 2020 2020  FAULT_MODE.     
+00014fa0: 2020 2077 6974 6820 6361 6368 655f 6469     with cache_di
+00014fb0: 7228 2920 6173 2077 6f72 6b73 7061 6365  r() as workspace
+00014fc0: 3a0a 2020 2020 2020 2020 2020 2020 6361  :.            ca
+00014fd0: 6368 655f 6669 6c65 203d 2067 6574 5f63  che_file = get_c
+00014fe0: 6163 6865 5f66 696c 6528 6d6f 6465 290a  ache_file(mode).
+00014ff0: 2020 2020 2020 2020 2020 2020 6361 6368              cach
+00015000: 655f 6669 6c65 2e77 7269 7465 5f74 6578  e_file.write_tex
+00015010: 7428 2274 6869 7320 6973 206e 6f74 2061  t("this is not a
+00015020: 2070 6963 6b6c 6522 2c20 656e 636f 6469   pickle", encodi
+00015030: 6e67 3d22 7574 662d 3822 290a 2020 2020  ng="utf-8").    
+00015040: 2020 2020 2020 2020 6173 7365 7274 2062          assert b
+00015050: 6c61 636b 2e43 6163 6865 2e72 6561 6428  lack.Cache.read(
+00015060: 6d6f 6465 292e 6669 6c65 5f64 6174 6120  mode).file_data 
+00015070: 3d3d 207b 7d0a 2020 2020 2020 2020 2020  == {}.          
+00015080: 2020 7372 6320 3d20 2877 6f72 6b73 7061    src = (workspa
+00015090: 6365 202f 2022 7465 7374 2e70 7922 292e  ce / "test.py").
+000150a0: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
+000150b0: 2020 2020 2020 7372 632e 7772 6974 655f        src.write_
+000150c0: 7465 7874 2822 7072 696e 7428 2768 656c  text("print('hel
+000150d0: 6c6f 2729 222c 2065 6e63 6f64 696e 673d  lo')", encoding=
+000150e0: 2275 7466 2d38 2229 0a20 2020 2020 2020  "utf-8").       
+000150f0: 2020 2020 2069 6e76 6f6b 6542 6c61 636b       invokeBlack
+00015100: 285b 7374 7228 7372 6329 5d29 0a20 2020  ([str(src)]).   
+00015110: 2020 2020 2020 2020 2063 6163 6865 203d           cache =
+00015120: 2062 6c61 636b 2e43 6163 6865 2e72 6561   black.Cache.rea
+00015130: 6428 6d6f 6465 290a 2020 2020 2020 2020  d(mode).        
+00015140: 2020 2020 6173 7365 7274 206e 6f74 2063      assert not c
+00015150: 6163 6865 2e69 735f 6368 616e 6765 6428  ache.is_changed(
+00015160: 7372 6329 0a0a 2020 2020 6465 6620 7465  src)..    def te
+00015170: 7374 5f63 6163 6865 5f73 696e 676c 655f  st_cache_single_
+00015180: 6669 6c65 5f61 6c72 6561 6479 5f63 6163  file_already_cac
+00015190: 6865 6428 7365 6c66 2920 2d3e 204e 6f6e  hed(self) -> Non
+000151a0: 653a 0a20 2020 2020 2020 206d 6f64 6520  e:.        mode 
+000151b0: 3d20 4445 4641 554c 545f 4d4f 4445 0a20  = DEFAULT_MODE. 
+000151c0: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
+000151d0: 655f 6469 7228 2920 6173 2077 6f72 6b73  e_dir() as works
+000151e0: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
+000151f0: 2020 7372 6320 3d20 2877 6f72 6b73 7061    src = (workspa
+00015200: 6365 202f 2022 7465 7374 2e70 7922 292e  ce / "test.py").
+00015210: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
+00015220: 2020 2020 2020 7372 632e 7772 6974 655f        src.write_
+00015230: 7465 7874 2822 7072 696e 7428 2768 656c  text("print('hel
+00015240: 6c6f 2729 222c 2065 6e63 6f64 696e 673d  lo')", encoding=
+00015250: 2275 7466 2d38 2229 0a20 2020 2020 2020  "utf-8").       
+00015260: 2020 2020 2063 6163 6865 203d 2062 6c61       cache = bla
+00015270: 636b 2e43 6163 6865 2e72 6561 6428 6d6f  ck.Cache.read(mo
+00015280: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
+00015290: 6361 6368 652e 7772 6974 6528 5b73 7263  cache.write([src
+000152a0: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
+000152b0: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
+000152c0: 7372 6329 5d29 0a20 2020 2020 2020 2020  src)]).         
+000152d0: 2020 2061 7373 6572 7420 7372 632e 7265     assert src.re
+000152e0: 6164 5f74 6578 7428 656e 636f 6469 6e67  ad_text(encoding
+000152f0: 3d22 7574 662d 3822 2920 3d3d 2022 7072  ="utf-8") == "pr
+00015300: 696e 7428 2768 656c 6c6f 2729 220a 0a20  int('hello')".. 
+00015310: 2020 2040 6576 656e 745f 6c6f 6f70 2829     @event_loop()
+00015320: 0a20 2020 2064 6566 2074 6573 745f 6361  .    def test_ca
+00015330: 6368 655f 6d75 6c74 6970 6c65 5f66 696c  che_multiple_fil
+00015340: 6573 2873 656c 6629 202d 3e20 4e6f 6e65  es(self) -> None
+00015350: 3a0a 2020 2020 2020 2020 6d6f 6465 203d  :.        mode =
+00015360: 2044 4546 4155 4c54 5f4d 4f44 450a 2020   DEFAULT_MODE.  
+00015370: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
+00015380: 5f64 6972 2829 2061 7320 776f 726b 7370  _dir() as worksp
+00015390: 6163 652c 2070 6174 6368 280a 2020 2020  ace, patch(.    
+000153a0: 2020 2020 2020 2020 2263 6f6e 6375 7272          "concurr
+000153b0: 656e 742e 6675 7475 7265 732e 5072 6f63  ent.futures.Proc
+000153c0: 6573 7350 6f6f 6c45 7865 6375 746f 7222  essPoolExecutor"
+000153d0: 2c20 6e65 773d 5468 7265 6164 506f 6f6c  , new=ThreadPool
+000153e0: 4578 6563 7574 6f72 0a20 2020 2020 2020  Executor.       
+000153f0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+00015400: 6f6e 6520 3d20 2877 6f72 6b73 7061 6365  one = (workspace
+00015410: 202f 2022 6f6e 652e 7079 2229 2e72 6573   / "one.py").res
+00015420: 6f6c 7665 2829 0a20 2020 2020 2020 2020  olve().         
+00015430: 2020 206f 6e65 2e77 7269 7465 5f74 6578     one.write_tex
+00015440: 7428 2270 7269 6e74 2827 6865 6c6c 6f27  t("print('hello'
+00015450: 2922 2c20 656e 636f 6469 6e67 3d22 7574  )", encoding="ut
+00015460: 662d 3822 290a 2020 2020 2020 2020 2020  f-8").          
+00015470: 2020 7477 6f20 3d20 2877 6f72 6b73 7061    two = (workspa
+00015480: 6365 202f 2022 7477 6f2e 7079 2229 2e72  ce / "two.py").r
+00015490: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
+000154a0: 2020 2020 2074 776f 2e77 7269 7465 5f74       two.write_t
+000154b0: 6578 7428 2270 7269 6e74 2827 6865 6c6c  ext("print('hell
+000154c0: 6f27 2922 2c20 656e 636f 6469 6e67 3d22  o')", encoding="
+000154d0: 7574 662d 3822 290a 2020 2020 2020 2020  utf-8").        
+000154e0: 2020 2020 6361 6368 6520 3d20 626c 6163      cache = blac
+000154f0: 6b2e 4361 6368 652e 7265 6164 286d 6f64  k.Cache.read(mod
+00015500: 6529 0a20 2020 2020 2020 2020 2020 2063  e).            c
+00015510: 6163 6865 2e77 7269 7465 285b 6f6e 655d  ache.write([one]
+00015520: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
+00015530: 766f 6b65 426c 6163 6b28 5b73 7472 2877  vokeBlack([str(w
+00015540: 6f72 6b73 7061 6365 295d 290a 2020 2020  orkspace)]).    
+00015550: 2020 2020 2020 2020 6173 7365 7274 206f          assert o
+00015560: 6e65 2e72 6561 645f 7465 7874 2865 6e63  ne.read_text(enc
+00015570: 6f64 696e 673d 2275 7466 2d38 2229 203d  oding="utf-8") =
+00015580: 3d20 2270 7269 6e74 2827 6865 6c6c 6f27  = "print('hello'
+00015590: 2922 0a20 2020 2020 2020 2020 2020 2061  )".            a
+000155a0: 7373 6572 7420 7477 6f2e 7265 6164 5f74  ssert two.read_t
+000155b0: 6578 7428 656e 636f 6469 6e67 3d22 7574  ext(encoding="ut
+000155c0: 662d 3822 2920 3d3d 2027 7072 696e 7428  f-8") == 'print(
+000155d0: 2268 656c 6c6f 2229 5c6e 270a 2020 2020  "hello")\n'.    
+000155e0: 2020 2020 2020 2020 6361 6368 6520 3d20          cache = 
+000155f0: 626c 6163 6b2e 4361 6368 652e 7265 6164  black.Cache.read
+00015600: 286d 6f64 6529 0a20 2020 2020 2020 2020  (mode).         
+00015610: 2020 2061 7373 6572 7420 6e6f 7420 6361     assert not ca
+00015620: 6368 652e 6973 5f63 6861 6e67 6564 286f  che.is_changed(o
+00015630: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
+00015640: 6173 7365 7274 206e 6f74 2063 6163 6865  assert not cache
+00015650: 2e69 735f 6368 616e 6765 6428 7477 6f29  .is_changed(two)
+00015660: 0a0a 2020 2020 4070 7974 6573 742e 6d61  ..    @pytest.ma
+00015670: 726b 2e69 6e63 6f6d 7061 7469 626c 655f  rk.incompatible_
+00015680: 7769 7468 5f6d 7970 7963 0a20 2020 2040  with_mypyc.    @
+00015690: 7079 7465 7374 2e6d 6172 6b2e 7061 7261  pytest.mark.para
+000156a0: 6d65 7472 697a 6528 2263 6f6c 6f72 222c  metrize("color",
+000156b0: 205b 4661 6c73 652c 2054 7275 655d 2c20   [False, True], 
+000156c0: 6964 733d 5b22 6e6f 2d63 6f6c 6f72 222c  ids=["no-color",
+000156d0: 2022 7769 7468 2d63 6f6c 6f72 225d 290a   "with-color"]).
+000156e0: 2020 2020 6465 6620 7465 7374 5f6e 6f5f      def test_no_
+000156f0: 6361 6368 655f 7768 656e 5f77 7269 7465  cache_when_write
+00015700: 6261 636b 5f64 6966 6628 7365 6c66 2c20  back_diff(self, 
+00015710: 636f 6c6f 723a 2062 6f6f 6c29 202d 3e20  color: bool) -> 
+00015720: 4e6f 6e65 3a0a 2020 2020 2020 2020 6d6f  None:.        mo
+00015730: 6465 203d 2044 4546 4155 4c54 5f4d 4f44  de = DEFAULT_MOD
+00015740: 450a 2020 2020 2020 2020 7769 7468 2063  E.        with c
+00015750: 6163 6865 5f64 6972 2829 2061 7320 776f  ache_dir() as wo
+00015760: 726b 7370 6163 653a 0a20 2020 2020 2020  rkspace:.       
+00015770: 2020 2020 2073 7263 203d 2028 776f 726b       src = (work
+00015780: 7370 6163 6520 2f20 2274 6573 742e 7079  space / "test.py
+00015790: 2229 2e72 6573 6f6c 7665 2829 0a20 2020  ").resolve().   
+000157a0: 2020 2020 2020 2020 2073 7263 2e77 7269           src.wri
+000157b0: 7465 5f74 6578 7428 2270 7269 6e74 2827  te_text("print('
+000157c0: 6865 6c6c 6f27 2922 2c20 656e 636f 6469  hello')", encodi
+000157d0: 6e67 3d22 7574 662d 3822 290a 2020 2020  ng="utf-8").    
+000157e0: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
+000157f0: 6368 2e6f 626a 6563 7428 626c 6163 6b2e  ch.object(black.
+00015800: 4361 6368 652c 2022 7265 6164 2229 2061  Cache, "read") a
+00015810: 7320 7265 6164 5f63 6163 6865 2c20 7061  s read_cache, pa
+00015820: 7463 682e 6f62 6a65 6374 280a 2020 2020  tch.object(.    
+00015830: 2020 2020 2020 2020 2020 2020 626c 6163              blac
+00015840: 6b2e 4361 6368 652c 2022 7772 6974 6522  k.Cache, "write"
+00015850: 0a20 2020 2020 2020 2020 2020 2029 2061  .            ) a
+00015860: 7320 7772 6974 655f 6361 6368 653a 0a20  s write_cache:. 
+00015870: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00015880: 6d64 203d 205b 7374 7228 7372 6329 2c20  md = [str(src), 
+00015890: 222d 2d64 6966 6622 5d0a 2020 2020 2020  "--diff"].      
+000158a0: 2020 2020 2020 2020 2020 6966 2063 6f6c            if col
+000158b0: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+000158c0: 2020 2020 2020 2020 636d 642e 6170 7065          cmd.appe
+000158d0: 6e64 2822 2d2d 636f 6c6f 7222 290a 2020  nd("--color").  
+000158e0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+000158f0: 766f 6b65 426c 6163 6b28 636d 6429 0a20  vokeBlack(cmd). 
+00015900: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00015910: 6163 6865 5f66 696c 6520 3d20 6765 745f  ache_file = get_
+00015920: 6361 6368 655f 6669 6c65 286d 6f64 6529  cache_file(mode)
+00015930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015940: 2061 7373 6572 7420 6361 6368 655f 6669   assert cache_fi
+00015950: 6c65 2e65 7869 7374 7328 2920 6973 2046  le.exists() is F
+00015960: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00015970: 2020 2020 2072 6561 645f 6361 6368 652e       read_cache.
+00015980: 6173 7365 7274 5f63 616c 6c65 645f 6f6e  assert_called_on
+00015990: 6365 2829 0a20 2020 2020 2020 2020 2020  ce().           
+000159a0: 2020 2020 2077 7269 7465 5f63 6163 6865       write_cache
+000159b0: 2e61 7373 6572 745f 6e6f 745f 6361 6c6c  .assert_not_call
+000159c0: 6564 2829 0a0a 2020 2020 4070 7974 6573  ed()..    @pytes
+000159d0: 742e 6d61 726b 2e70 6172 616d 6574 7269  t.mark.parametri
+000159e0: 7a65 2822 636f 6c6f 7222 2c20 5b46 616c  ze("color", [Fal
+000159f0: 7365 2c20 5472 7565 5d2c 2069 6473 3d5b  se, True], ids=[
+00015a00: 226e 6f2d 636f 6c6f 7222 2c20 2277 6974  "no-color", "wit
+00015a10: 682d 636f 6c6f 7222 5d29 0a20 2020 2040  h-color"]).    @
+00015a20: 6576 656e 745f 6c6f 6f70 2829 0a20 2020  event_loop().   
+00015a30: 2064 6566 2074 6573 745f 6f75 7470 7574   def test_output
+00015a40: 5f6c 6f63 6b69 6e67 5f77 6865 6e5f 7772  _locking_when_wr
+00015a50: 6974 6562 6163 6b5f 6469 6666 2873 656c  iteback_diff(sel
+00015a60: 662c 2063 6f6c 6f72 3a20 626f 6f6c 2920  f, color: bool) 
+00015a70: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00015a80: 2077 6974 6820 6361 6368 655f 6469 7228   with cache_dir(
+00015a90: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
+00015aa0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00015ab0: 7461 6720 696e 2072 616e 6765 2830 2c20  tag in range(0, 
+00015ac0: 3429 3a0a 2020 2020 2020 2020 2020 2020  4):.            
+00015ad0: 2020 2020 7372 6320 3d20 2877 6f72 6b73      src = (works
+00015ae0: 7061 6365 202f 2066 2274 6573 747b 7461  pace / f"test{ta
+00015af0: 677d 2e70 7922 292e 7265 736f 6c76 6528  g}.py").resolve(
+00015b00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015b10: 2020 7372 632e 7772 6974 655f 7465 7874    src.write_text
+00015b20: 2822 7072 696e 7428 2768 656c 6c6f 2729  ("print('hello')
+00015b30: 222c 2065 6e63 6f64 696e 673d 2275 7466  ", encoding="utf
+00015b40: 2d38 2229 0a20 2020 2020 2020 2020 2020  -8").           
+00015b50: 2077 6974 6820 7061 7463 6828 0a20 2020   with patch(.   
+00015b60: 2020 2020 2020 2020 2020 2020 2022 626c               "bl
+00015b70: 6163 6b2e 636f 6e63 7572 7265 6e63 792e  ack.concurrency.
+00015b80: 4d61 6e61 6765 7222 2c20 7772 6170 733d  Manager", wraps=
+00015b90: 6d75 6c74 6970 726f 6365 7373 696e 672e  multiprocessing.
+00015ba0: 4d61 6e61 6765 720a 2020 2020 2020 2020  Manager.        
+00015bb0: 2020 2020 2920 6173 206d 6772 3a0a 2020      ) as mgr:.  
+00015bc0: 2020 2020 2020 2020 2020 2020 2020 636d                cm
+00015bd0: 6420 3d20 5b22 2d2d 6469 6666 222c 2073  d = ["--diff", s
+00015be0: 7472 2877 6f72 6b73 7061 6365 295d 0a20  tr(workspace)]. 
+00015bf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00015c00: 6620 636f 6c6f 723a 0a20 2020 2020 2020  f color:.       
+00015c10: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
+00015c20: 2e61 7070 656e 6428 222d 2d63 6f6c 6f72  .append("--color
+00015c30: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00015c40: 2020 2069 6e76 6f6b 6542 6c61 636b 2863     invokeBlack(c
+00015c50: 6d64 2c20 6578 6974 5f63 6f64 653d 3029  md, exit_code=0)
+00015c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015c70: 2023 2074 6869 7320 6973 6e27 7420 7175   # this isn't qu
+00015c80: 6974 6520 646f 696e 6720 7768 6174 2077  ite doing what w
+00015c90: 6520 7761 6e74 2c20 6275 7420 6966 2069  e want, but if i
+00015ca0: 7420 5f69 736e 2774 5f0a 2020 2020 2020  t _isn't_.      
+00015cb0: 2020 2020 2020 2020 2020 2320 6361 6c6c            # call
+00015cc0: 6564 2074 6865 6e20 7765 2063 616e 6e6f  ed then we canno
+00015cd0: 7420 6265 2075 7369 6e67 2074 6865 206c  t be using the l
+00015ce0: 6f63 6b20 6974 2070 726f 7669 6465 730a  ock it provides.
+00015cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d00: 6d67 722e 6173 7365 7274 5f63 616c 6c65  mgr.assert_calle
+00015d10: 6428 290a 0a20 2020 2064 6566 2074 6573  d()..    def tes
+00015d20: 745f 6e6f 5f63 6163 6865 5f77 6865 6e5f  t_no_cache_when_
+00015d30: 7374 6469 6e28 7365 6c66 2920 2d3e 204e  stdin(self) -> N
+00015d40: 6f6e 653a 0a20 2020 2020 2020 206d 6f64  one:.        mod
+00015d50: 6520 3d20 4445 4641 554c 545f 4d4f 4445  e = DEFAULT_MODE
+00015d60: 0a20 2020 2020 2020 2077 6974 6820 6361  .        with ca
+00015d70: 6368 655f 6469 7228 293a 0a20 2020 2020  che_dir():.     
+00015d80: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00015d90: 436c 6952 756e 6e65 7228 292e 696e 766f  CliRunner().invo
+00015da0: 6b65 280a 2020 2020 2020 2020 2020 2020  ke(.            
+00015db0: 2020 2020 626c 6163 6b2e 6d61 696e 2c20      black.main, 
+00015dc0: 5b22 2d22 5d2c 2069 6e70 7574 3d42 7974  ["-"], input=Byt
+00015dd0: 6573 494f 2862 2270 7269 6e74 2827 6865  esIO(b"print('he
+00015de0: 6c6c 6f27 2922 290a 2020 2020 2020 2020  llo')").        
+00015df0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00015e00: 2020 6173 7365 7274 206e 6f74 2072 6573    assert not res
+00015e10: 756c 742e 6578 6974 5f63 6f64 650a 2020  ult.exit_code.  
+00015e20: 2020 2020 2020 2020 2020 6361 6368 655f            cache_
+00015e30: 6669 6c65 203d 2067 6574 5f63 6163 6865  file = get_cache
+00015e40: 5f66 696c 6528 6d6f 6465 290a 2020 2020  _file(mode).    
+00015e50: 2020 2020 2020 2020 6173 7365 7274 206e          assert n
+00015e60: 6f74 2063 6163 6865 5f66 696c 652e 6578  ot cache_file.ex
+00015e70: 6973 7473 2829 0a0a 2020 2020 6465 6620  ists()..    def 
+00015e80: 7465 7374 5f72 6561 645f 6361 6368 655f  test_read_cache_
+00015e90: 6e6f 5f63 6163 6865 6669 6c65 2873 656c  no_cachefile(sel
+00015ea0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00015eb0: 2020 2020 6d6f 6465 203d 2044 4546 4155      mode = DEFAU
+00015ec0: 4c54 5f4d 4f44 450a 2020 2020 2020 2020  LT_MODE.        
+00015ed0: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
+00015ee0: 3a0a 2020 2020 2020 2020 2020 2020 6173  :.            as
+00015ef0: 7365 7274 2062 6c61 636b 2e43 6163 6865  sert black.Cache
+00015f00: 2e72 6561 6428 6d6f 6465 292e 6669 6c65  .read(mode).file
+00015f10: 5f64 6174 6120 3d3d 207b 7d0a 0a20 2020  _data == {}..   
+00015f20: 2064 6566 2074 6573 745f 7772 6974 655f   def test_write_
+00015f30: 6361 6368 655f 7265 6164 5f63 6163 6865  cache_read_cache
+00015f40: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00015f50: 2020 2020 2020 2020 6d6f 6465 203d 2044          mode = D
+00015f60: 4546 4155 4c54 5f4d 4f44 450a 2020 2020  EFAULT_MODE.    
+00015f70: 2020 2020 7769 7468 2063 6163 6865 5f64      with cache_d
+00015f80: 6972 2829 2061 7320 776f 726b 7370 6163  ir() as workspac
+00015f90: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00015fa0: 7263 203d 2028 776f 726b 7370 6163 6520  rc = (workspace 
+00015fb0: 2f20 2274 6573 742e 7079 2229 2e72 6573  / "test.py").res
+00015fc0: 6f6c 7665 2829 0a20 2020 2020 2020 2020  olve().         
+00015fd0: 2020 2073 7263 2e74 6f75 6368 2829 0a20     src.touch(). 
+00015fe0: 2020 2020 2020 2020 2020 2077 7269 7465             write
+00015ff0: 5f63 6163 6865 203d 2062 6c61 636b 2e43  _cache = black.C
+00016000: 6163 6865 2e72 6561 6428 6d6f 6465 290a  ache.read(mode).
+00016010: 2020 2020 2020 2020 2020 2020 7772 6974              writ
+00016020: 655f 6361 6368 652e 7772 6974 6528 5b73  e_cache.write([s
+00016030: 7263 5d29 0a20 2020 2020 2020 2020 2020  rc]).           
+00016040: 2072 6561 645f 6361 6368 6520 3d20 626c   read_cache = bl
+00016050: 6163 6b2e 4361 6368 652e 7265 6164 286d  ack.Cache.read(m
+00016060: 6f64 6529 0a20 2020 2020 2020 2020 2020  ode).           
+00016070: 2061 7373 6572 7420 6e6f 7420 7265 6164   assert not read
+00016080: 5f63 6163 6865 2e69 735f 6368 616e 6765  _cache.is_change
+00016090: 6428 7372 6329 0a0a 2020 2020 4070 7974  d(src)..    @pyt
+000160a0: 6573 742e 6d61 726b 2e69 6e63 6f6d 7061  est.mark.incompa
+000160b0: 7469 626c 655f 7769 7468 5f6d 7970 7963  tible_with_mypyc
+000160c0: 0a20 2020 2064 6566 2074 6573 745f 6669  .    def test_fi
+000160d0: 6c74 6572 5f63 6163 6865 6428 7365 6c66  lter_cached(self
+000160e0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+000160f0: 2020 2077 6974 6820 5465 6d70 6f72 6172     with Temporar
+00016100: 7944 6972 6563 746f 7279 2829 2061 7320  yDirectory() as 
+00016110: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
+00016120: 2020 2020 2020 2070 6174 6820 3d20 5061         path = Pa
+00016130: 7468 2877 6f72 6b73 7061 6365 290a 2020  th(workspace).  
+00016140: 2020 2020 2020 2020 2020 756e 6361 6368            uncach
+00016150: 6564 203d 2028 7061 7468 202f 2022 756e  ed = (path / "un
+00016160: 6361 6368 6564 2229 2e72 6573 6f6c 7665  cached").resolve
+00016170: 2829 0a20 2020 2020 2020 2020 2020 2063  ().            c
+00016180: 6163 6865 6420 3d20 2870 6174 6820 2f20  ached = (path / 
+00016190: 2263 6163 6865 6422 292e 7265 736f 6c76  "cached").resolv
+000161a0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+000161b0: 6361 6368 6564 5f62 7574 5f63 6861 6e67  cached_but_chang
+000161c0: 6564 203d 2028 7061 7468 202f 2022 6368  ed = (path / "ch
+000161d0: 616e 6765 6422 292e 7265 736f 6c76 6528  anged").resolve(
+000161e0: 290a 2020 2020 2020 2020 2020 2020 756e  ).            un
+000161f0: 6361 6368 6564 2e74 6f75 6368 2829 0a20  cached.touch(). 
+00016200: 2020 2020 2020 2020 2020 2063 6163 6865             cache
+00016210: 642e 746f 7563 6828 290a 2020 2020 2020  d.touch().      
+00016220: 2020 2020 2020 6361 6368 6564 5f62 7574        cached_but
+00016230: 5f63 6861 6e67 6564 2e74 6f75 6368 2829  _changed.touch()
+00016240: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
+00016250: 6865 203d 2062 6c61 636b 2e43 6163 6865  he = black.Cache
+00016260: 2e72 6561 6428 4445 4641 554c 545f 4d4f  .read(DEFAULT_MO
+00016270: 4445 290a 0a20 2020 2020 2020 2020 2020  DE)..           
+00016280: 206f 7269 675f 6675 6e63 203d 2062 6c61   orig_func = bla
+00016290: 636b 2e43 6163 6865 2e67 6574 5f66 696c  ck.Cache.get_fil
+000162a0: 655f 6461 7461 0a0a 2020 2020 2020 2020  e_data..        
+000162b0: 2020 2020 6465 6620 7772 6170 7065 645f      def wrapped_
+000162c0: 6675 6e63 2870 6174 683a 2050 6174 6829  func(path: Path)
+000162d0: 202d 3e20 4669 6c65 4461 7461 3a0a 2020   -> FileData:.  
+000162e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000162f0: 2070 6174 6820 3d3d 2063 6163 6865 643a   path == cached:
+00016300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016310: 2020 2020 2072 6574 7572 6e20 6f72 6967       return orig
+00016320: 5f66 756e 6328 7061 7468 290a 2020 2020  _func(path).    
+00016330: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+00016340: 6174 6820 3d3d 2063 6163 6865 645f 6275  ath == cached_bu
+00016350: 745f 6368 616e 6765 643a 0a20 2020 2020  t_changed:.     
+00016360: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00016370: 6574 7572 6e20 4669 6c65 4461 7461 2830  eturn FileData(0
+00016380: 2e30 2c20 302c 2022 2229 0a20 2020 2020  .0, 0, "").     
+00016390: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000163a0: 2041 7373 6572 7469 6f6e 4572 726f 720a   AssertionError.
+000163b0: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+000163c0: 6820 7061 7463 682e 6f62 6a65 6374 2862  h patch.object(b
+000163d0: 6c61 636b 2e43 6163 6865 2c20 2267 6574  lack.Cache, "get
+000163e0: 5f66 696c 655f 6461 7461 222c 2073 6964  _file_data", sid
+000163f0: 655f 6566 6665 6374 3d77 7261 7070 6564  e_effect=wrapped
+00016400: 5f66 756e 6329 3a0a 2020 2020 2020 2020  _func):.        
+00016410: 2020 2020 2020 2020 6361 6368 652e 7772          cache.wr
+00016420: 6974 6528 5b63 6163 6865 642c 2063 6163  ite([cached, cac
+00016430: 6865 645f 6275 745f 6368 616e 6765 645d  hed_but_changed]
+00016440: 290a 2020 2020 2020 2020 2020 2020 746f  ).            to
+00016450: 646f 2c20 646f 6e65 203d 2063 6163 6865  do, done = cache
+00016460: 2e66 696c 7465 7265 645f 6361 6368 6564  .filtered_cached
+00016470: 287b 756e 6361 6368 6564 2c20 6361 6368  ({uncached, cach
+00016480: 6564 2c20 6361 6368 6564 5f62 7574 5f63  ed, cached_but_c
+00016490: 6861 6e67 6564 7d29 0a20 2020 2020 2020  hanged}).       
+000164a0: 2020 2020 2061 7373 6572 7420 746f 646f       assert todo
+000164b0: 203d 3d20 7b75 6e63 6163 6865 642c 2063   == {uncached, c
+000164c0: 6163 6865 645f 6275 745f 6368 616e 6765  ached_but_change
+000164d0: 647d 0a20 2020 2020 2020 2020 2020 2061  d}.            a
+000164e0: 7373 6572 7420 646f 6e65 203d 3d20 7b63  ssert done == {c
+000164f0: 6163 6865 647d 0a0a 2020 2020 6465 6620  ached}..    def 
+00016500: 7465 7374 5f66 696c 7465 725f 6361 6368  test_filter_cach
+00016510: 6564 5f68 6173 6828 7365 6c66 2920 2d3e  ed_hash(self) ->
+00016520: 204e 6f6e 653a 0a20 2020 2020 2020 2077   None:.        w
+00016530: 6974 6820 5465 6d70 6f72 6172 7944 6972  ith TemporaryDir
+00016540: 6563 746f 7279 2829 2061 7320 776f 726b  ectory() as work
+00016550: 7370 6163 653a 0a20 2020 2020 2020 2020  space:.         
+00016560: 2020 2070 6174 6820 3d20 5061 7468 2877     path = Path(w
+00016570: 6f72 6b73 7061 6365 290a 2020 2020 2020  orkspace).      
+00016580: 2020 2020 2020 7372 6320 3d20 2870 6174        src = (pat
+00016590: 6820 2f20 2274 6573 742e 7079 2229 2e72  h / "test.py").r
+000165a0: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
+000165b0: 2020 2020 2073 7263 2e77 7269 7465 5f74       src.write_t
+000165c0: 6578 7428 2270 7269 6e74 2827 6865 6c6c  ext("print('hell
+000165d0: 6f27 2922 2c20 656e 636f 6469 6e67 3d22  o')", encoding="
+000165e0: 7574 662d 3822 290a 2020 2020 2020 2020  utf-8").        
+000165f0: 2020 2020 7374 203d 2073 7263 2e73 7461      st = src.sta
+00016600: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+00016610: 6361 6368 6520 3d20 626c 6163 6b2e 4361  cache = black.Ca
+00016620: 6368 652e 7265 6164 2844 4546 4155 4c54  che.read(DEFAULT
+00016630: 5f4d 4f44 4529 0a20 2020 2020 2020 2020  _MODE).         
+00016640: 2020 2063 6163 6865 2e77 7269 7465 285b     cache.write([
+00016650: 7372 635d 290a 2020 2020 2020 2020 2020  src]).          
+00016660: 2020 6361 6368 6564 5f66 696c 655f 6461    cached_file_da
+00016670: 7461 203d 2063 6163 6865 2e66 696c 655f  ta = cache.file_
+00016680: 6461 7461 5b73 7472 2873 7263 295d 0a0a  data[str(src)]..
+00016690: 2020 2020 2020 2020 2020 2020 746f 646f              todo
+000166a0: 2c20 646f 6e65 203d 2063 6163 6865 2e66  , done = cache.f
+000166b0: 696c 7465 7265 645f 6361 6368 6564 285b  iltered_cached([
+000166c0: 7372 635d 290a 2020 2020 2020 2020 2020  src]).          
+000166d0: 2020 6173 7365 7274 2074 6f64 6f20 3d3d    assert todo ==
+000166e0: 2073 6574 2829 0a20 2020 2020 2020 2020   set().         
+000166f0: 2020 2061 7373 6572 7420 646f 6e65 203d     assert done =
+00016700: 3d20 7b73 7263 7d0a 2020 2020 2020 2020  = {src}.        
+00016710: 2020 2020 6173 7365 7274 2063 6163 6865      assert cache
+00016720: 645f 6669 6c65 5f64 6174 612e 7374 5f6d  d_file_data.st_m
+00016730: 7469 6d65 203d 3d20 7374 2e73 745f 6d74  time == st.st_mt
+00016740: 696d 650a 0a20 2020 2020 2020 2020 2020  ime..           
+00016750: 2023 204d 6f64 6966 7920 7374 5f6d 7469   # Modify st_mti
+00016760: 6d65 0a20 2020 2020 2020 2020 2020 2063  me.            c
+00016770: 6163 6865 645f 6669 6c65 5f64 6174 6120  ached_file_data 
+00016780: 3d20 6361 6368 652e 6669 6c65 5f64 6174  = cache.file_dat
+00016790: 615b 7374 7228 7372 6329 5d20 3d20 4669  a[str(src)] = Fi
+000167a0: 6c65 4461 7461 280a 2020 2020 2020 2020  leData(.        
+000167b0: 2020 2020 2020 2020 6361 6368 6564 5f66          cached_f
+000167c0: 696c 655f 6461 7461 2e73 745f 6d74 696d  ile_data.st_mtim
+000167d0: 6520 2d20 312c 0a20 2020 2020 2020 2020  e - 1,.         
+000167e0: 2020 2020 2020 2063 6163 6865 645f 6669         cached_fi
+000167f0: 6c65 5f64 6174 612e 7374 5f73 697a 652c  le_data.st_size,
+00016800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016810: 2063 6163 6865 645f 6669 6c65 5f64 6174   cached_file_dat
+00016820: 612e 6861 7368 2c0a 2020 2020 2020 2020  a.hash,.        
+00016830: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00016840: 2020 746f 646f 2c20 646f 6e65 203d 2063    todo, done = c
+00016850: 6163 6865 2e66 696c 7465 7265 645f 6361  ache.filtered_ca
+00016860: 6368 6564 285b 7372 635d 290a 2020 2020  ched([src]).    
+00016870: 2020 2020 2020 2020 6173 7365 7274 2074          assert t
+00016880: 6f64 6f20 3d3d 2073 6574 2829 0a20 2020  odo == set().   
+00016890: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+000168a0: 646f 6e65 203d 3d20 7b73 7263 7d0a 2020  done == {src}.  
+000168b0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+000168c0: 2063 6163 6865 645f 6669 6c65 5f64 6174   cached_file_dat
+000168d0: 612e 7374 5f6d 7469 6d65 203c 2073 742e  a.st_mtime < st.
+000168e0: 7374 5f6d 7469 6d65 0a20 2020 2020 2020  st_mtime.       
+000168f0: 2020 2020 2061 7373 6572 7420 6361 6368       assert cach
+00016900: 6564 5f66 696c 655f 6461 7461 2e73 745f  ed_file_data.st_
+00016910: 7369 7a65 203d 3d20 7374 2e73 745f 7369  size == st.st_si
+00016920: 7a65 0a20 2020 2020 2020 2020 2020 2061  ze.            a
+00016930: 7373 6572 7420 6361 6368 6564 5f66 696c  ssert cached_fil
+00016940: 655f 6461 7461 2e68 6173 6820 3d3d 2062  e_data.hash == b
+00016950: 6c61 636b 2e43 6163 6865 2e68 6173 685f  lack.Cache.hash_
+00016960: 6469 6765 7374 2873 7263 290a 0a20 2020  digest(src)..   
+00016970: 2020 2020 2020 2020 2023 204d 6f64 6966           # Modif
+00016980: 7920 636f 6e74 656e 7473 0a20 2020 2020  y contents.     
+00016990: 2020 2020 2020 2073 7263 2e77 7269 7465         src.write
+000169a0: 5f74 6578 7428 2270 7269 6e74 2827 6865  _text("print('he
+000169b0: 6c6c 6f20 776f 726c 6427 2922 2c20 656e  llo world')", en
+000169c0: 636f 6469 6e67 3d22 7574 662d 3822 290a  coding="utf-8").
+000169d0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+000169e0: 7374 203d 2073 7263 2e73 7461 7428 290a  st = src.stat().
+000169f0: 2020 2020 2020 2020 2020 2020 746f 646f              todo
+00016a00: 2c20 646f 6e65 203d 2063 6163 6865 2e66  , done = cache.f
+00016a10: 696c 7465 7265 645f 6361 6368 6564 285b  iltered_cached([
+00016a20: 7372 635d 290a 2020 2020 2020 2020 2020  src]).          
+00016a30: 2020 6173 7365 7274 2074 6f64 6f20 3d3d    assert todo ==
+00016a40: 207b 7372 637d 0a20 2020 2020 2020 2020   {src}.         
+00016a50: 2020 2061 7373 6572 7420 646f 6e65 203d     assert done =
+00016a60: 3d20 7365 7428 290a 2020 2020 2020 2020  = set().        
+00016a70: 2020 2020 6173 7365 7274 2063 6163 6865      assert cache
+00016a80: 645f 6669 6c65 5f64 6174 612e 7374 5f6d  d_file_data.st_m
+00016a90: 7469 6d65 203c 206e 6577 5f73 742e 7374  time < new_st.st
+00016aa0: 5f6d 7469 6d65 0a20 2020 2020 2020 2020  _mtime.         
+00016ab0: 2020 2061 7373 6572 7420 6361 6368 6564     assert cached
+00016ac0: 5f66 696c 655f 6461 7461 2e73 745f 7369  _file_data.st_si
+00016ad0: 7a65 2021 3d20 6e65 775f 7374 2e73 745f  ze != new_st.st_
+00016ae0: 7369 7a65 0a20 2020 2020 2020 2020 2020  size.           
+00016af0: 2061 7373 6572 7420 6361 6368 6564 5f66   assert cached_f
+00016b00: 696c 655f 6461 7461 2e68 6173 6820 213d  ile_data.hash !=
+00016b10: 2062 6c61 636b 2e43 6163 6865 2e68 6173   black.Cache.has
+00016b20: 685f 6469 6765 7374 2873 7263 290a 0a20  h_digest(src).. 
+00016b30: 2020 2064 6566 2074 6573 745f 7772 6974     def test_writ
+00016b40: 655f 6361 6368 655f 6372 6561 7465 735f  e_cache_creates_
+00016b50: 6469 7265 6374 6f72 795f 6966 5f6e 6565  directory_if_nee
+00016b60: 6465 6428 7365 6c66 2920 2d3e 204e 6f6e  ded(self) -> Non
+00016b70: 653a 0a20 2020 2020 2020 206d 6f64 6520  e:.        mode 
+00016b80: 3d20 4445 4641 554c 545f 4d4f 4445 0a20  = DEFAULT_MODE. 
+00016b90: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
+00016ba0: 655f 6469 7228 6578 6973 7473 3d46 616c  e_dir(exists=Fal
+00016bb0: 7365 2920 6173 2077 6f72 6b73 7061 6365  se) as workspace
+00016bc0: 3a0a 2020 2020 2020 2020 2020 2020 6173  :.            as
+00016bd0: 7365 7274 206e 6f74 2077 6f72 6b73 7061  sert not workspa
+00016be0: 6365 2e65 7869 7374 7328 290a 2020 2020  ce.exists().    
+00016bf0: 2020 2020 2020 2020 6361 6368 6520 3d20          cache = 
+00016c00: 626c 6163 6b2e 4361 6368 652e 7265 6164  black.Cache.read
+00016c10: 286d 6f64 6529 0a20 2020 2020 2020 2020  (mode).         
+00016c20: 2020 2063 6163 6865 2e77 7269 7465 285b     cache.write([
+00016c30: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
+00016c40: 7373 6572 7420 776f 726b 7370 6163 652e  ssert workspace.
+00016c50: 6578 6973 7473 2829 0a0a 2020 2020 4065  exists()..    @e
+00016c60: 7665 6e74 5f6c 6f6f 7028 290a 2020 2020  vent_loop().    
+00016c70: 6465 6620 7465 7374 5f66 6169 6c65 645f  def test_failed_
+00016c80: 666f 726d 6174 7469 6e67 5f64 6f65 735f  formatting_does_
+00016c90: 6e6f 745f 6765 745f 6361 6368 6564 2873  not_get_cached(s
+00016ca0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00016cb0: 2020 2020 2020 6d6f 6465 203d 2044 4546        mode = DEF
+00016cc0: 4155 4c54 5f4d 4f44 450a 2020 2020 2020  AULT_MODE.      
+00016cd0: 2020 7769 7468 2063 6163 6865 5f64 6972    with cache_dir
+00016ce0: 2829 2061 7320 776f 726b 7370 6163 652c  () as workspace,
+00016cf0: 2070 6174 6368 280a 2020 2020 2020 2020   patch(.        
+00016d00: 2020 2020 2263 6f6e 6375 7272 656e 742e      "concurrent.
+00016d10: 6675 7475 7265 732e 5072 6f63 6573 7350  futures.ProcessP
+00016d20: 6f6f 6c45 7865 6375 746f 7222 2c20 6e65  oolExecutor", ne
+00016d30: 773d 5468 7265 6164 506f 6f6c 4578 6563  w=ThreadPoolExec
+00016d40: 7574 6f72 0a20 2020 2020 2020 2029 3a0a  utor.        ):.
+00016d50: 2020 2020 2020 2020 2020 2020 6661 696c              fail
+00016d60: 696e 6720 3d20 2877 6f72 6b73 7061 6365  ing = (workspace
+00016d70: 202f 2022 6661 696c 696e 672e 7079 2229   / "failing.py")
+00016d80: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
+00016d90: 2020 2020 2020 2066 6169 6c69 6e67 2e77         failing.w
+00016da0: 7269 7465 5f74 6578 7428 226e 6f74 2061  rite_text("not a
+00016db0: 6374 7561 6c6c 7920 7079 7468 6f6e 222c  ctually python",
+00016dc0: 2065 6e63 6f64 696e 673d 2275 7466 2d38   encoding="utf-8
+00016dd0: 2229 0a20 2020 2020 2020 2020 2020 2063  ").            c
+00016de0: 6c65 616e 203d 2028 776f 726b 7370 6163  lean = (workspac
+00016df0: 6520 2f20 2263 6c65 616e 2e70 7922 292e  e / "clean.py").
+00016e00: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
+00016e10: 2020 2020 2020 636c 6561 6e2e 7772 6974        clean.writ
+00016e20: 655f 7465 7874 2827 7072 696e 7428 2268  e_text('print("h
+00016e30: 656c 6c6f 2229 5c6e 272c 2065 6e63 6f64  ello")\n', encod
+00016e40: 696e 673d 2275 7466 2d38 2229 0a20 2020  ing="utf-8").   
+00016e50: 2020 2020 2020 2020 2069 6e76 6f6b 6542           invokeB
+00016e60: 6c61 636b 285b 7374 7228 776f 726b 7370  lack([str(worksp
+00016e70: 6163 6529 5d2c 2065 7869 745f 636f 6465  ace)], exit_code
+00016e80: 3d31 3233 290a 2020 2020 2020 2020 2020  =123).          
+00016e90: 2020 6361 6368 6520 3d20 626c 6163 6b2e    cache = black.
+00016ea0: 4361 6368 652e 7265 6164 286d 6f64 6529  Cache.read(mode)
+00016eb0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+00016ec0: 6572 7420 6361 6368 652e 6973 5f63 6861  ert cache.is_cha
+00016ed0: 6e67 6564 2866 6169 6c69 6e67 290a 2020  nged(failing).  
+00016ee0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00016ef0: 206e 6f74 2063 6163 6865 2e69 735f 6368   not cache.is_ch
+00016f00: 616e 6765 6428 636c 6561 6e29 0a0a 2020  anged(clean)..  
+00016f10: 2020 6465 6620 7465 7374 5f77 7269 7465    def test_write
+00016f20: 5f63 6163 6865 5f77 7269 7465 5f66 6169  _cache_write_fai
+00016f30: 6c28 7365 6c66 2920 2d3e 204e 6f6e 653a  l(self) -> None:
+00016f40: 0a20 2020 2020 2020 206d 6f64 6520 3d20  .        mode = 
+00016f50: 4445 4641 554c 545f 4d4f 4445 0a20 2020  DEFAULT_MODE.   
+00016f60: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
+00016f70: 6469 7228 293a 0a20 2020 2020 2020 2020  dir():.         
+00016f80: 2020 2063 6163 6865 203d 2062 6c61 636b     cache = black
+00016f90: 2e43 6163 6865 2e72 6561 6428 6d6f 6465  .Cache.read(mode
+00016fa0: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
+00016fb0: 7468 2070 6174 6368 2e6f 626a 6563 7428  th patch.object(
+00016fc0: 5061 7468 2c20 226f 7065 6e22 2920 6173  Path, "open") as
+00016fd0: 206d 6f63 6b3a 0a20 2020 2020 2020 2020   mock:.         
+00016fe0: 2020 2020 2020 206d 6f63 6b2e 7369 6465         mock.side
+00016ff0: 5f65 6666 6563 7420 3d20 4f53 4572 726f  _effect = OSErro
+00017000: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+00017010: 2020 6361 6368 652e 7772 6974 6528 5b5d    cache.write([]
+00017020: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00017030: 7265 6164 5f63 6163 6865 5f6c 696e 655f  read_cache_line_
+00017040: 6c65 6e67 7468 7328 7365 6c66 2920 2d3e  lengths(self) ->
+00017050: 204e 6f6e 653a 0a20 2020 2020 2020 206d   None:.        m
+00017060: 6f64 6520 3d20 4445 4641 554c 545f 4d4f  ode = DEFAULT_MO
+00017070: 4445 0a20 2020 2020 2020 2073 686f 7274  DE.        short
+00017080: 5f6d 6f64 6520 3d20 7265 706c 6163 6528  _mode = replace(
+00017090: 4445 4641 554c 545f 4d4f 4445 2c20 6c69  DEFAULT_MODE, li
+000170a0: 6e65 5f6c 656e 6774 683d 3129 0a20 2020  ne_length=1).   
+000170b0: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
+000170c0: 6469 7228 2920 6173 2077 6f72 6b73 7061  dir() as workspa
+000170d0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+000170e0: 7061 7468 203d 2028 776f 726b 7370 6163  path = (workspac
+000170f0: 6520 2f20 2266 696c 652e 7079 2229 2e72  e / "file.py").r
+00017100: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
+00017110: 2020 2020 2070 6174 682e 746f 7563 6828       path.touch(
+00017120: 290a 2020 2020 2020 2020 2020 2020 6361  ).            ca
+00017130: 6368 6520 3d20 626c 6163 6b2e 4361 6368  che = black.Cach
+00017140: 652e 7265 6164 286d 6f64 6529 0a20 2020  e.read(mode).   
+00017150: 2020 2020 2020 2020 2063 6163 6865 2e77           cache.w
+00017160: 7269 7465 285b 7061 7468 5d29 0a20 2020  rite([path]).   
+00017170: 2020 2020 2020 2020 206f 6e65 203d 2062           one = b
+00017180: 6c61 636b 2e43 6163 6865 2e72 6561 6428  lack.Cache.read(
+00017190: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
+000171a0: 2020 6173 7365 7274 206e 6f74 206f 6e65    assert not one
+000171b0: 2e69 735f 6368 616e 6765 6428 7061 7468  .is_changed(path
+000171c0: 290a 2020 2020 2020 2020 2020 2020 7477  ).            tw
+000171d0: 6f20 3d20 626c 6163 6b2e 4361 6368 652e  o = black.Cache.
+000171e0: 7265 6164 2873 686f 7274 5f6d 6f64 6529  read(short_mode)
+000171f0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+00017200: 6572 7420 7477 6f2e 6973 5f63 6861 6e67  ert two.is_chang
+00017210: 6564 2870 6174 6829 0a0a 0a64 6566 2061  ed(path)...def a
+00017220: 7373 6572 745f 636f 6c6c 6563 7465 645f  ssert_collected_
+00017230: 736f 7572 6365 7328 0a20 2020 2073 7263  sources(.    src
+00017240: 3a20 5365 7175 656e 6365 5b55 6e69 6f6e  : Sequence[Union
+00017250: 5b73 7472 2c20 5061 7468 5d5d 2c0a 2020  [str, Path]],.  
+00017260: 2020 6578 7065 6374 6564 3a20 5365 7175    expected: Sequ
+00017270: 656e 6365 5b55 6e69 6f6e 5b73 7472 2c20  ence[Union[str, 
+00017280: 5061 7468 5d5d 2c0a 2020 2020 2a2c 0a20  Path]],.    *,. 
+00017290: 2020 2072 6f6f 743a 204f 7074 696f 6e61     root: Optiona
+000172a0: 6c5b 5061 7468 5d20 3d20 4e6f 6e65 2c0a  l[Path] = None,.
+000172b0: 2020 2020 6578 636c 7564 653a 204f 7074      exclude: Opt
+000172c0: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+000172d0: 652c 0a20 2020 2069 6e63 6c75 6465 3a20  e,.    include: 
+000172e0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+000172f0: 4e6f 6e65 2c0a 2020 2020 6578 7465 6e64  None,.    extend
+00017300: 5f65 7863 6c75 6465 3a20 4f70 7469 6f6e  _exclude: Option
+00017310: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
+00017320: 2020 2020 666f 7263 655f 6578 636c 7564      force_exclud
+00017330: 653a 204f 7074 696f 6e61 6c5b 7374 725d  e: Optional[str]
+00017340: 203d 204e 6f6e 652c 0a20 2020 2073 7464   = None,.    std
+00017350: 696e 5f66 696c 656e 616d 653a 204f 7074  in_filename: Opt
+00017360: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+00017370: 652c 0a29 202d 3e20 4e6f 6e65 3a0a 2020  e,.) -> None:.  
+00017380: 2020 6773 5f73 7263 203d 2074 7570 6c65    gs_src = tuple
+00017390: 2873 7472 2850 6174 6828 7329 2920 666f  (str(Path(s)) fo
+000173a0: 7220 7320 696e 2073 7263 290a 2020 2020  r s in src).    
+000173b0: 6773 5f65 7870 6563 7465 6420 3d20 5b50  gs_expected = [P
+000173c0: 6174 6828 7329 2066 6f72 2073 2069 6e20  ath(s) for s in 
+000173d0: 6578 7065 6374 6564 5d0a 2020 2020 6773  expected].    gs
+000173e0: 5f65 7863 6c75 6465 203d 204e 6f6e 6520  _exclude = None 
+000173f0: 6966 2065 7863 6c75 6465 2069 7320 4e6f  if exclude is No
+00017400: 6e65 2065 6c73 6520 636f 6d70 696c 655f  ne else compile_
+00017410: 7061 7474 6572 6e28 6578 636c 7564 6529  pattern(exclude)
+00017420: 0a20 2020 2067 735f 696e 636c 7564 6520  .    gs_include 
+00017430: 3d20 4445 4641 554c 545f 494e 434c 5544  = DEFAULT_INCLUD
+00017440: 4520 6966 2069 6e63 6c75 6465 2069 7320  E if include is 
+00017450: 4e6f 6e65 2065 6c73 6520 636f 6d70 696c  None else compil
+00017460: 655f 7061 7474 6572 6e28 696e 636c 7564  e_pattern(includ
+00017470: 6529 0a20 2020 2067 735f 6578 7465 6e64  e).    gs_extend
+00017480: 5f65 7863 6c75 6465 203d 2028 0a20 2020  _exclude = (.   
+00017490: 2020 2020 204e 6f6e 6520 6966 2065 7874       None if ext
+000174a0: 656e 645f 6578 636c 7564 6520 6973 204e  end_exclude is N
+000174b0: 6f6e 6520 656c 7365 2063 6f6d 7069 6c65  one else compile
+000174c0: 5f70 6174 7465 726e 2865 7874 656e 645f  _pattern(extend_
+000174d0: 6578 636c 7564 6529 0a20 2020 2029 0a20  exclude).    ). 
+000174e0: 2020 2067 735f 666f 7263 655f 6578 636c     gs_force_excl
+000174f0: 7564 6520 3d20 4e6f 6e65 2069 6620 666f  ude = None if fo
+00017500: 7263 655f 6578 636c 7564 6520 6973 204e  rce_exclude is N
+00017510: 6f6e 6520 656c 7365 2063 6f6d 7069 6c65  one else compile
+00017520: 5f70 6174 7465 726e 2866 6f72 6365 5f65  _pattern(force_e
+00017530: 7863 6c75 6465 290a 2020 2020 636f 6c6c  xclude).    coll
+00017540: 6563 7465 6420 3d20 626c 6163 6b2e 6765  ected = black.ge
+00017550: 745f 736f 7572 6365 7328 0a20 2020 2020  t_sources(.     
+00017560: 2020 2072 6f6f 743d 726f 6f74 206f 7220     root=root or 
+00017570: 5448 4953 5f44 4952 2c0a 2020 2020 2020  THIS_DIR,.      
+00017580: 2020 7372 633d 6773 5f73 7263 2c0a 2020    src=gs_src,.  
+00017590: 2020 2020 2020 7175 6965 743d 4661 6c73        quiet=Fals
+000175a0: 652c 0a20 2020 2020 2020 2076 6572 626f  e,.        verbo
+000175b0: 7365 3d46 616c 7365 2c0a 2020 2020 2020  se=False,.      
+000175c0: 2020 696e 636c 7564 653d 6773 5f69 6e63    include=gs_inc
+000175d0: 6c75 6465 2c0a 2020 2020 2020 2020 6578  lude,.        ex
+000175e0: 636c 7564 653d 6773 5f65 7863 6c75 6465  clude=gs_exclude
+000175f0: 2c0a 2020 2020 2020 2020 6578 7465 6e64  ,.        extend
+00017600: 5f65 7863 6c75 6465 3d67 735f 6578 7465  _exclude=gs_exte
+00017610: 6e64 5f65 7863 6c75 6465 2c0a 2020 2020  nd_exclude,.    
+00017620: 2020 2020 666f 7263 655f 6578 636c 7564      force_exclud
+00017630: 653d 6773 5f66 6f72 6365 5f65 7863 6c75  e=gs_force_exclu
+00017640: 6465 2c0a 2020 2020 2020 2020 7265 706f  de,.        repo
+00017650: 7274 3d62 6c61 636b 2e52 6570 6f72 7428  rt=black.Report(
+00017660: 292c 0a20 2020 2020 2020 2073 7464 696e  ),.        stdin
+00017670: 5f66 696c 656e 616d 653d 7374 6469 6e5f  _filename=stdin_
+00017680: 6669 6c65 6e61 6d65 2c0a 2020 2020 290a  filename,.    ).
+00017690: 2020 2020 6173 7365 7274 2073 6f72 7465      assert sorte
+000176a0: 6428 636f 6c6c 6563 7465 6429 203d 3d20  d(collected) == 
+000176b0: 736f 7274 6564 2867 735f 6578 7065 6374  sorted(gs_expect
+000176c0: 6564 290a 0a0a 636c 6173 7320 5465 7374  ed)...class Test
+000176d0: 4669 6c65 436f 6c6c 6563 7469 6f6e 3a0a  FileCollection:.
+000176e0: 2020 2020 6465 6620 7465 7374 5f69 6e63      def test_inc
+000176f0: 6c75 6465 5f65 7863 6c75 6465 2873 656c  lude_exclude(sel
+00017700: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00017710: 2020 2020 7061 7468 203d 2054 4849 535f      path = THIS_
+00017720: 4449 5220 2f20 2264 6174 6122 202f 2022  DIR / "data" / "
+00017730: 696e 636c 7564 655f 6578 636c 7564 655f  include_exclude_
+00017740: 7465 7374 7322 0a20 2020 2020 2020 2073  tests".        s
+00017750: 7263 203d 205b 7061 7468 5d0a 2020 2020  rc = [path].    
+00017760: 2020 2020 6578 7065 6374 6564 203d 205b      expected = [
+00017770: 0a20 2020 2020 2020 2020 2020 2050 6174  .            Pat
+00017780: 6828 7061 7468 202f 2022 622f 646f 6e74  h(path / "b/dont
+00017790: 5f65 7863 6c75 6465 2f61 2e70 7922 292c  _exclude/a.py"),
+000177a0: 0a20 2020 2020 2020 2020 2020 2050 6174  .            Pat
+000177b0: 6828 7061 7468 202f 2022 622f 646f 6e74  h(path / "b/dont
+000177c0: 5f65 7863 6c75 6465 2f61 2e70 7969 2229  _exclude/a.pyi")
+000177d0: 2c0a 2020 2020 2020 2020 5d0a 2020 2020  ,.        ].    
+000177e0: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
+000177f0: 6374 6564 5f73 6f75 7263 6573 280a 2020  cted_sources(.  
+00017800: 2020 2020 2020 2020 2020 7372 632c 0a20            src,. 
+00017810: 2020 2020 2020 2020 2020 2065 7870 6563             expec
+00017820: 7465 642c 0a20 2020 2020 2020 2020 2020  ted,.           
+00017830: 2069 6e63 6c75 6465 3d72 225c 2e70 7969   include=r"\.pyi
+00017840: 3f24 222c 0a20 2020 2020 2020 2020 2020  ?$",.           
+00017850: 2065 7863 6c75 6465 3d72 222f 6578 636c   exclude=r"/excl
+00017860: 7564 652f 7c2f 5c2e 6465 6669 6e69 7465  ude/|/\.definite
+00017870: 6c79 5f65 7863 6c75 6465 2f22 2c0a 2020  ly_exclude/",.  
+00017880: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00017890: 2074 6573 745f 6769 7469 676e 6f72 655f   test_gitignore_
+000178a0: 7573 6564 5f61 735f 6465 6661 756c 7428  used_as_default(
+000178b0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+000178c0: 2020 2020 2020 2062 6173 6520 3d20 5061         base = Pa
+000178d0: 7468 2844 4154 415f 4449 5220 2f20 2269  th(DATA_DIR / "i
+000178e0: 6e63 6c75 6465 5f65 7863 6c75 6465 5f74  nclude_exclude_t
+000178f0: 6573 7473 2229 0a20 2020 2020 2020 2065  ests").        e
+00017900: 7870 6563 7465 6420 3d20 5b0a 2020 2020  xpected = [.    
+00017910: 2020 2020 2020 2020 6261 7365 202f 2022          base / "
+00017920: 622f 2e64 6566 696e 6974 656c 795f 6578  b/.definitely_ex
+00017930: 636c 7564 652f 612e 7079 222c 0a20 2020  clude/a.py",.   
+00017940: 2020 2020 2020 2020 2062 6173 6520 2f20           base / 
+00017950: 2262 2f2e 6465 6669 6e69 7465 6c79 5f65  "b/.definitely_e
+00017960: 7863 6c75 6465 2f61 2e70 7969 222c 0a20  xclude/a.pyi",. 
+00017970: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+00017980: 2073 7263 203d 205b 6261 7365 202f 2022   src = [base / "
+00017990: 622f 225d 0a20 2020 2020 2020 2061 7373  b/"].        ass
+000179a0: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
+000179b0: 7572 6365 7328 7372 632c 2065 7870 6563  urces(src, expec
+000179c0: 7465 642c 2072 6f6f 743d 6261 7365 2c20  ted, root=base, 
+000179d0: 6578 7465 6e64 5f65 7863 6c75 6465 3d72  extend_exclude=r
+000179e0: 222f 6578 636c 7564 652f 2229 0a0a 2020  "/exclude/")..  
+000179f0: 2020 6465 6620 7465 7374 5f67 6974 6967    def test_gitig
+00017a00: 6e6f 7265 5f75 7365 645f 6f6e 5f6d 756c  nore_used_on_mul
+00017a10: 7469 706c 655f 736f 7572 6365 7328 7365  tiple_sources(se
+00017a20: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00017a30: 2020 2020 2072 6f6f 7420 3d20 5061 7468       root = Path
+00017a40: 2844 4154 415f 4449 5220 2f20 2267 6974  (DATA_DIR / "git
+00017a50: 6967 6e6f 7265 5f75 7365 645f 6f6e 5f6d  ignore_used_on_m
+00017a60: 756c 7469 706c 655f 736f 7572 6365 7322  ultiple_sources"
+00017a70: 290a 2020 2020 2020 2020 6578 7065 6374  ).        expect
+00017a80: 6564 203d 205b 0a20 2020 2020 2020 2020  ed = [.         
+00017a90: 2020 2072 6f6f 7420 2f20 2264 6972 3122     root / "dir1"
+00017aa0: 202f 2022 622e 7079 222c 0a20 2020 2020   / "b.py",.     
+00017ab0: 2020 2020 2020 2072 6f6f 7420 2f20 2264         root / "d
+00017ac0: 6972 3222 202f 2022 622e 7079 222c 0a20  ir2" / "b.py",. 
+00017ad0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+00017ae0: 2073 7263 203d 205b 726f 6f74 202f 2022   src = [root / "
+00017af0: 6469 7231 222c 2072 6f6f 7420 2f20 2264  dir1", root / "d
+00017b00: 6972 3222 5d0a 2020 2020 2020 2020 6173  ir2"].        as
+00017b10: 7365 7274 5f63 6f6c 6c65 6374 6564 5f73  sert_collected_s
+00017b20: 6f75 7263 6573 2873 7263 2c20 6578 7065  ources(src, expe
+00017b30: 6374 6564 2c20 726f 6f74 3d72 6f6f 7429  cted, root=root)
+00017b40: 0a0a 2020 2020 4070 6174 6368 2822 626c  ..    @patch("bl
+00017b50: 6163 6b2e 6669 6e64 5f70 726f 6a65 6374  ack.find_project
+00017b60: 5f72 6f6f 7422 2c20 6c61 6d62 6461 202a  _root", lambda *
+00017b70: 6172 6773 3a20 2854 4849 535f 4449 522e  args: (THIS_DIR.
+00017b80: 7265 736f 6c76 6528 292c 204e 6f6e 6529  resolve(), None)
+00017b90: 290a 2020 2020 6465 6620 7465 7374 5f65  ).    def test_e
+00017ba0: 7863 6c75 6465 5f66 6f72 5f69 7373 7565  xclude_for_issue
+00017bb0: 5f31 3537 3228 7365 6c66 2920 2d3e 204e  _1572(self) -> N
+00017bc0: 6f6e 653a 0a20 2020 2020 2020 2023 2045  one:.        # E
+00017bd0: 7863 6c75 6465 2073 686f 756c 646e 2774  xclude shouldn't
+00017be0: 2074 6f75 6368 2066 696c 6573 2074 6861   touch files tha
+00017bf0: 7420 7765 7265 2065 7870 6c69 6369 746c  t were explicitl
+00017c00: 7920 6769 7665 6e20 746f 2042 6c61 636b  y given to Black
+00017c10: 2074 6872 6f75 6768 2074 6865 0a20 2020   through the.   
+00017c20: 2020 2020 2023 2043 4c49 2e20 4578 636c       # CLI. Excl
+00017c30: 7564 6520 6973 2073 7570 706f 7365 6420  ude is supposed 
+00017c40: 746f 206f 6e6c 7920 6170 706c 7920 746f  to only apply to
+00017c50: 2074 6865 2072 6563 7572 7369 7665 2064   the recursive d
+00017c60: 6973 636f 7665 7279 206f 6620 6669 6c65  iscovery of file
+00017c70: 732e 0a20 2020 2020 2020 2023 2068 7474  s..        # htt
+00017c80: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+00017c90: 7073 662f 626c 6163 6b2f 6973 7375 6573  psf/black/issues
+00017ca0: 2f31 3537 320a 2020 2020 2020 2020 7061  /1572.        pa
+00017cb0: 7468 203d 2044 4154 415f 4449 5220 2f20  th = DATA_DIR / 
+00017cc0: 2269 6e63 6c75 6465 5f65 7863 6c75 6465  "include_exclude
+00017cd0: 5f74 6573 7473 220a 2020 2020 2020 2020  _tests".        
+00017ce0: 7372 6320 3d20 5b70 6174 6820 2f20 2262  src = [path / "b
+00017cf0: 2f65 7863 6c75 6465 2f61 2e70 7922 5d0a  /exclude/a.py"].
+00017d00: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+00017d10: 203d 205b 7061 7468 202f 2022 622f 6578   = [path / "b/ex
+00017d20: 636c 7564 652f 612e 7079 225d 0a20 2020  clude/a.py"].   
+00017d30: 2020 2020 2061 7373 6572 745f 636f 6c6c       assert_coll
+00017d40: 6563 7465 645f 736f 7572 6365 7328 7372  ected_sources(sr
+00017d50: 632c 2065 7870 6563 7465 642c 2069 6e63  c, expected, inc
+00017d60: 6c75 6465 3d22 222c 2065 7863 6c75 6465  lude="", exclude
+00017d70: 3d72 222f 6578 636c 7564 652f 7c61 5c2e  =r"/exclude/|a\.
+00017d80: 7079 2229 0a0a 2020 2020 6465 6620 7465  py")..    def te
+00017d90: 7374 5f67 6974 6967 6e6f 7265 5f65 7863  st_gitignore_exc
+00017da0: 6c75 6465 2873 656c 6629 202d 3e20 4e6f  lude(self) -> No
+00017db0: 6e65 3a0a 2020 2020 2020 2020 7061 7468  ne:.        path
+00017dc0: 203d 2054 4849 535f 4449 5220 2f20 2264   = THIS_DIR / "d
+00017dd0: 6174 6122 202f 2022 696e 636c 7564 655f  ata" / "include_
+00017de0: 6578 636c 7564 655f 7465 7374 7322 0a20  exclude_tests". 
+00017df0: 2020 2020 2020 2069 6e63 6c75 6465 203d         include =
+00017e00: 2072 652e 636f 6d70 696c 6528 7222 5c2e   re.compile(r"\.
+00017e10: 7079 693f 2422 290a 2020 2020 2020 2020  pyi?$").        
+00017e20: 6578 636c 7564 6520 3d20 7265 2e63 6f6d  exclude = re.com
+00017e30: 7069 6c65 2872 2222 290a 2020 2020 2020  pile(r"").      
+00017e40: 2020 7265 706f 7274 203d 2062 6c61 636b    report = black
+00017e50: 2e52 6570 6f72 7428 290a 2020 2020 2020  .Report().      
+00017e60: 2020 6769 7469 676e 6f72 6520 3d20 5061    gitignore = Pa
+00017e70: 7468 5370 6563 2e66 726f 6d5f 6c69 6e65  thSpec.from_line
+00017e80: 7328 0a20 2020 2020 2020 2020 2020 2022  s(.            "
+00017e90: 6769 7477 696c 646d 6174 6368 222c 205b  gitwildmatch", [
+00017ea0: 2265 7863 6c75 6465 2f22 2c20 222e 6465  "exclude/", ".de
+00017eb0: 6669 6e69 7465 6c79 5f65 7863 6c75 6465  finitely_exclude
+00017ec0: 225d 0a20 2020 2020 2020 2029 0a20 2020  "].        ).   
+00017ed0: 2020 2020 2073 6f75 7263 6573 3a20 4c69       sources: Li
+00017ee0: 7374 5b50 6174 685d 203d 205b 5d0a 2020  st[Path] = [].  
+00017ef0: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
+00017f00: 205b 0a20 2020 2020 2020 2020 2020 2050   [.            P
+00017f10: 6174 6828 7061 7468 202f 2022 622f 646f  ath(path / "b/do
+00017f20: 6e74 5f65 7863 6c75 6465 2f61 2e70 7922  nt_exclude/a.py"
+00017f30: 292c 0a20 2020 2020 2020 2020 2020 2050  ),.            P
+00017f40: 6174 6828 7061 7468 202f 2022 622f 646f  ath(path / "b/do
+00017f50: 6e74 5f65 7863 6c75 6465 2f61 2e70 7969  nt_exclude/a.pyi
+00017f60: 2229 2c0a 2020 2020 2020 2020 5d0a 2020  "),.        ].  
+00017f70: 2020 2020 2020 7468 6973 5f61 6273 203d        this_abs =
+00017f80: 2054 4849 535f 4449 522e 7265 736f 6c76   THIS_DIR.resolv
+00017f90: 6528 290a 2020 2020 2020 2020 736f 7572  e().        sour
+00017fa0: 6365 732e 6578 7465 6e64 280a 2020 2020  ces.extend(.    
+00017fb0: 2020 2020 2020 2020 626c 6163 6b2e 6765          black.ge
+00017fc0: 6e5f 7079 7468 6f6e 5f66 696c 6573 280a  n_python_files(.
+00017fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017fe0: 7061 7468 2e69 7465 7264 6972 2829 2c0a  path.iterdir(),.
+00017ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018000: 7468 6973 5f61 6273 2c0a 2020 2020 2020  this_abs,.      
+00018010: 2020 2020 2020 2020 2020 696e 636c 7564            includ
+00018020: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00018030: 2020 2065 7863 6c75 6465 2c0a 2020 2020     exclude,.    
+00018040: 2020 2020 2020 2020 2020 2020 4e6f 6e65              None
+00018050: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00018060: 2020 4e6f 6e65 2c0a 2020 2020 2020 2020    None,.        
+00018070: 2020 2020 2020 2020 7265 706f 7274 2c0a          report,.
+00018080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018090: 7b70 6174 683a 2067 6974 6967 6e6f 7265  {path: gitignore
+000180a0: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+000180b0: 2020 2076 6572 626f 7365 3d46 616c 7365     verbose=False
+000180c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000180d0: 2020 7175 6965 743d 4661 6c73 652c 0a20    quiet=False,. 
+000180e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000180f0: 2020 2020 2029 0a20 2020 2020 2020 2061       ).        a
+00018100: 7373 6572 7420 736f 7274 6564 2865 7870  ssert sorted(exp
+00018110: 6563 7465 6429 203d 3d20 736f 7274 6564  ected) == sorted
+00018120: 2873 6f75 7263 6573 290a 0a20 2020 2064  (sources)..    d
+00018130: 6566 2074 6573 745f 6e65 7374 6564 5f67  ef test_nested_g
+00018140: 6974 6967 6e6f 7265 2873 656c 6629 202d  itignore(self) -
+00018150: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00018160: 7061 7468 203d 2050 6174 6828 5448 4953  path = Path(THIS
+00018170: 5f44 4952 202f 2022 6461 7461 2220 2f20  _DIR / "data" / 
+00018180: 226e 6573 7465 645f 6769 7469 676e 6f72  "nested_gitignor
+00018190: 655f 7465 7374 7322 290a 2020 2020 2020  e_tests").      
+000181a0: 2020 696e 636c 7564 6520 3d20 7265 2e63    include = re.c
+000181b0: 6f6d 7069 6c65 2872 225c 2e70 7969 3f24  ompile(r"\.pyi?$
+000181c0: 2229 0a20 2020 2020 2020 2065 7863 6c75  ").        exclu
+000181d0: 6465 203d 2072 652e 636f 6d70 696c 6528  de = re.compile(
+000181e0: 7222 2229 0a20 2020 2020 2020 2072 6f6f  r"").        roo
+000181f0: 745f 6769 7469 676e 6f72 6520 3d20 626c  t_gitignore = bl
+00018200: 6163 6b2e 6669 6c65 732e 6765 745f 6769  ack.files.get_gi
+00018210: 7469 676e 6f72 6528 7061 7468 290a 2020  tignore(path).  
+00018220: 2020 2020 2020 7265 706f 7274 203d 2062        report = b
+00018230: 6c61 636b 2e52 6570 6f72 7428 290a 2020  lack.Report().  
+00018240: 2020 2020 2020 6578 7065 6374 6564 3a20        expected: 
+00018250: 4c69 7374 5b50 6174 685d 203d 205b 0a20  List[Path] = [. 
+00018260: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
+00018270: 7061 7468 202f 2022 782e 7079 2229 2c0a  path / "x.py"),.
+00018280: 2020 2020 2020 2020 2020 2020 5061 7468              Path
+00018290: 2870 6174 6820 2f20 2272 6f6f 742f 622e  (path / "root/b.
+000182a0: 7079 2229 2c0a 2020 2020 2020 2020 2020  py"),.          
+000182b0: 2020 5061 7468 2870 6174 6820 2f20 2272    Path(path / "r
+000182c0: 6f6f 742f 632e 7079 2229 2c0a 2020 2020  oot/c.py"),.    
+000182d0: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
+000182e0: 6820 2f20 2272 6f6f 742f 6368 696c 642f  h / "root/child/
+000182f0: 632e 7079 2229 2c0a 2020 2020 2020 2020  c.py"),.        
+00018300: 5d0a 2020 2020 2020 2020 7468 6973 5f61  ].        this_a
+00018310: 6273 203d 2054 4849 535f 4449 522e 7265  bs = THIS_DIR.re
+00018320: 736f 6c76 6528 290a 2020 2020 2020 2020  solve().        
+00018330: 736f 7572 6365 7320 3d20 6c69 7374 280a  sources = list(.
+00018340: 2020 2020 2020 2020 2020 2020 626c 6163              blac
+00018350: 6b2e 6765 6e5f 7079 7468 6f6e 5f66 696c  k.gen_python_fil
+00018360: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+00018370: 2020 2020 7061 7468 2e69 7465 7264 6972      path.iterdir
+00018380: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
+00018390: 2020 2020 7468 6973 5f61 6273 2c0a 2020      this_abs,.  
+000183a0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+000183b0: 636c 7564 652c 0a20 2020 2020 2020 2020  clude,.         
+000183c0: 2020 2020 2020 2065 7863 6c75 6465 2c0a         exclude,.
+000183d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000183e0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+000183f0: 2020 2020 2020 4e6f 6e65 2c0a 2020 2020        None,.    
+00018400: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+00018410: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
+00018420: 2020 2020 7b70 6174 683a 2072 6f6f 745f      {path: root_
+00018430: 6769 7469 676e 6f72 657d 2c0a 2020 2020  gitignore},.    
+00018440: 2020 2020 2020 2020 2020 2020 7665 7262              verb
+00018450: 6f73 653d 4661 6c73 652c 0a20 2020 2020  ose=False,.     
+00018460: 2020 2020 2020 2020 2020 2071 7569 6574             quiet
+00018470: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+00018480: 2020 2020 290a 2020 2020 2020 2020 290a      ).        ).
+00018490: 2020 2020 2020 2020 6173 7365 7274 2073          assert s
+000184a0: 6f72 7465 6428 6578 7065 6374 6564 2920  orted(expected) 
+000184b0: 3d3d 2073 6f72 7465 6428 736f 7572 6365  == sorted(source
+000184c0: 7329 0a0a 2020 2020 6465 6620 7465 7374  s)..    def test
+000184d0: 5f6e 6573 7465 645f 6769 7469 676e 6f72  _nested_gitignor
+000184e0: 655f 6469 7265 6374 6c79 5f69 6e5f 736f  e_directly_in_so
+000184f0: 7572 6365 5f64 6972 6563 746f 7279 2873  urce_directory(s
+00018500: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00018510: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
+00018520: 6769 7468 7562 2e63 6f6d 2f70 7366 2f62  github.com/psf/b
+00018530: 6c61 636b 2f69 7373 7565 732f 3235 3938  lack/issues/2598
+00018540: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+00018550: 5061 7468 2844 4154 415f 4449 5220 2f20  Path(DATA_DIR / 
+00018560: 226e 6573 7465 645f 6769 7469 676e 6f72  "nested_gitignor
+00018570: 655f 7465 7374 7322 290a 2020 2020 2020  e_tests").      
+00018580: 2020 7372 6320 3d20 5061 7468 2870 6174    src = Path(pat
+00018590: 6820 2f20 2272 6f6f 7422 202f 2022 6368  h / "root" / "ch
+000185a0: 696c 6422 290a 2020 2020 2020 2020 6578  ild").        ex
+000185b0: 7065 6374 6564 203d 205b 7372 6320 2f20  pected = [src / 
+000185c0: 2261 2e70 7922 2c20 7372 6320 2f20 2263  "a.py", src / "c
+000185d0: 2e70 7922 5d0a 2020 2020 2020 2020 6173  .py"].        as
+000185e0: 7365 7274 5f63 6f6c 6c65 6374 6564 5f73  sert_collected_s
+000185f0: 6f75 7263 6573 285b 7372 635d 2c20 6578  ources([src], ex
+00018600: 7065 6374 6564 290a 0a20 2020 2064 6566  pected)..    def
+00018610: 2074 6573 745f 696e 7661 6c69 645f 6769   test_invalid_gi
+00018620: 7469 676e 6f72 6528 7365 6c66 2920 2d3e  tignore(self) ->
+00018630: 204e 6f6e 653a 0a20 2020 2020 2020 2070   None:.        p
+00018640: 6174 6820 3d20 5448 4953 5f44 4952 202f  ath = THIS_DIR /
+00018650: 2022 6461 7461 2220 2f20 2269 6e76 616c   "data" / "inval
+00018660: 6964 5f67 6974 6967 6e6f 7265 5f74 6573  id_gitignore_tes
+00018670: 7473 220a 2020 2020 2020 2020 656d 7074  ts".        empt
+00018680: 795f 636f 6e66 6967 203d 2070 6174 6820  y_config = path 
+00018690: 2f20 2270 7970 726f 6a65 6374 2e74 6f6d  / "pyproject.tom
+000186a0: 6c22 0a20 2020 2020 2020 2072 6573 756c  l".        resul
+000186b0: 7420 3d20 426c 6163 6b52 756e 6e65 7228  t = BlackRunner(
+000186c0: 292e 696e 766f 6b65 280a 2020 2020 2020  ).invoke(.      
+000186d0: 2020 2020 2020 626c 6163 6b2e 6d61 696e        black.main
+000186e0: 2c20 5b22 2d2d 7665 7262 6f73 6522 2c20  , ["--verbose", 
+000186f0: 222d 2d63 6f6e 6669 6722 2c20 7374 7228  "--config", str(
+00018700: 656d 7074 795f 636f 6e66 6967 292c 2073  empty_config), s
+00018710: 7472 2870 6174 6829 5d0a 2020 2020 2020  tr(path)].      
+00018720: 2020 290a 2020 2020 2020 2020 6173 7365    ).        asse
+00018730: 7274 2072 6573 756c 742e 6578 6974 5f63  rt result.exit_c
+00018740: 6f64 6520 3d3d 2031 0a20 2020 2020 2020  ode == 1.       
+00018750: 2061 7373 6572 7420 7265 7375 6c74 2e73   assert result.s
+00018760: 7464 6572 725f 6279 7465 7320 6973 206e  tderr_bytes is n
+00018770: 6f74 204e 6f6e 650a 0a20 2020 2020 2020  ot None..       
+00018780: 2067 6974 6967 6e6f 7265 203d 2070 6174   gitignore = pat
+00018790: 6820 2f20 222e 6769 7469 676e 6f72 6522  h / ".gitignore"
+000187a0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+000187b0: 7265 2e73 6561 7263 6828 0a20 2020 2020  re.search(.     
+000187c0: 2020 2020 2020 2066 2243 6f75 6c64 206e         f"Could n
+000187d0: 6f74 2070 6172 7365 207b 6769 7469 676e  ot parse {gitign
+000187e0: 6f72 657d 222e 7265 706c 6163 6528 225c  ore}".replace("\
+000187f0: 5c22 2c20 225c 5c5c 5c22 292c 0a20 2020  \", "\\\\"),.   
+00018800: 2020 2020 2020 2020 2072 6573 756c 742e           result.
+00018810: 7374 6465 7272 5f62 7974 6573 2e64 6563  stderr_bytes.dec
+00018820: 6f64 6528 292c 0a20 2020 2020 2020 2020  ode(),.         
+00018830: 2020 2072 652e 4947 4e4f 5245 4341 5345     re.IGNORECASE
+00018840: 2069 6620 6973 696e 7374 616e 6365 2867   if isinstance(g
+00018850: 6974 6967 6e6f 7265 2c20 5769 6e64 6f77  itignore, Window
+00018860: 7350 6174 6829 2065 6c73 6520 302c 0a20  sPath) else 0,. 
+00018870: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00018880: 6620 7465 7374 5f69 6e76 616c 6964 5f6e  f test_invalid_n
+00018890: 6573 7465 645f 6769 7469 676e 6f72 6528  ested_gitignore(
+000188a0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+000188b0: 2020 2020 2020 2070 6174 6820 3d20 5448         path = TH
+000188c0: 4953 5f44 4952 202f 2022 6461 7461 2220  IS_DIR / "data" 
+000188d0: 2f20 2269 6e76 616c 6964 5f6e 6573 7465  / "invalid_neste
+000188e0: 645f 6769 7469 676e 6f72 655f 7465 7374  d_gitignore_test
+000188f0: 7322 0a20 2020 2020 2020 2065 6d70 7479  s".        empty
+00018900: 5f63 6f6e 6669 6720 3d20 7061 7468 202f  _config = path /
+00018910: 2022 7079 7072 6f6a 6563 742e 746f 6d6c   "pyproject.toml
+00018920: 220a 2020 2020 2020 2020 7265 7375 6c74  ".        result
+00018930: 203d 2042 6c61 636b 5275 6e6e 6572 2829   = BlackRunner()
+00018940: 2e69 6e76 6f6b 6528 0a20 2020 2020 2020  .invoke(.       
+00018950: 2020 2020 2062 6c61 636b 2e6d 6169 6e2c       black.main,
+00018960: 205b 222d 2d76 6572 626f 7365 222c 2022   ["--verbose", "
+00018970: 2d2d 636f 6e66 6967 222c 2073 7472 2865  --config", str(e
+00018980: 6d70 7479 5f63 6f6e 6669 6729 2c20 7374  mpty_config), st
+00018990: 7228 7061 7468 295d 0a20 2020 2020 2020  r(path)].       
+000189a0: 2029 0a20 2020 2020 2020 2061 7373 6572   ).        asser
+000189b0: 7420 7265 7375 6c74 2e65 7869 745f 636f  t result.exit_co
+000189c0: 6465 203d 3d20 310a 2020 2020 2020 2020  de == 1.        
+000189d0: 6173 7365 7274 2072 6573 756c 742e 7374  assert result.st
+000189e0: 6465 7272 5f62 7974 6573 2069 7320 6e6f  derr_bytes is no
+000189f0: 7420 4e6f 6e65 0a0a 2020 2020 2020 2020  t None..        
+00018a00: 6769 7469 676e 6f72 6520 3d20 7061 7468  gitignore = path
+00018a10: 202f 2022 6122 202f 2022 2e67 6974 6967   / "a" / ".gitig
+00018a20: 6e6f 7265 220a 2020 2020 2020 2020 6173  nore".        as
+00018a30: 7365 7274 2072 652e 7365 6172 6368 280a  sert re.search(.
+00018a40: 2020 2020 2020 2020 2020 2020 6622 436f              f"Co
+00018a50: 756c 6420 6e6f 7420 7061 7273 6520 7b67  uld not parse {g
+00018a60: 6974 6967 6e6f 7265 7d22 2e72 6570 6c61  itignore}".repla
+00018a70: 6365 2822 5c5c 222c 2022 5c5c 5c5c 2229  ce("\\", "\\\\")
+00018a80: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
+00018a90: 7375 6c74 2e73 7464 6572 725f 6279 7465  sult.stderr_byte
+00018aa0: 732e 6465 636f 6465 2829 2c0a 2020 2020  s.decode(),.    
+00018ab0: 2020 2020 2020 2020 7265 2e49 474e 4f52          re.IGNOR
+00018ac0: 4543 4153 4520 6966 2069 7369 6e73 7461  ECASE if isinsta
+00018ad0: 6e63 6528 6769 7469 676e 6f72 652c 2057  nce(gitignore, W
+00018ae0: 696e 646f 7773 5061 7468 2920 656c 7365  indowsPath) else
+00018af0: 2030 2c0a 2020 2020 2020 2020 290a 0a20   0,.        ).. 
+00018b00: 2020 2064 6566 2074 6573 745f 6769 7469     def test_giti
+00018b10: 676e 6f72 655f 7468 6174 5f69 676e 6f72  gnore_that_ignor
+00018b20: 6573 5f73 7562 666f 6c64 6572 7328 7365  es_subfolders(se
+00018b30: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00018b40: 2020 2020 2023 2049 6620 6769 7469 676e       # If gitign
+00018b50: 6f72 6520 7769 7468 202a 2f2a 2069 7320  ore with */* is 
+00018b60: 696e 2072 6f6f 740a 2020 2020 2020 2020  in root.        
+00018b70: 726f 6f74 203d 2050 6174 6828 4441 5441  root = Path(DATA
+00018b80: 5f44 4952 202f 2022 6967 6e6f 7265 5f73  _DIR / "ignore_s
+00018b90: 7562 666f 6c64 6572 735f 6769 7469 676e  ubfolders_gitign
+00018ba0: 6f72 655f 7465 7374 7322 202f 2022 7375  ore_tests" / "su
+00018bb0: 6264 6972 2229 0a20 2020 2020 2020 2065  bdir").        e
+00018bc0: 7870 6563 7465 6420 3d20 5b72 6f6f 7420  xpected = [root 
+00018bd0: 2f20 2262 2e70 7922 5d0a 2020 2020 2020  / "b.py"].      
+00018be0: 2020 6173 7365 7274 5f63 6f6c 6c65 6374    assert_collect
+00018bf0: 6564 5f73 6f75 7263 6573 285b 726f 6f74  ed_sources([root
+00018c00: 5d2c 2065 7870 6563 7465 642c 2072 6f6f  ], expected, roo
+00018c10: 743d 726f 6f74 290a 0a20 2020 2020 2020  t=root)..       
+00018c20: 2023 2049 6620 2e67 6974 6967 6e6f 7265   # If .gitignore
+00018c30: 2077 6974 6820 2a2f 2a20 6973 206e 6573   with */* is nes
+00018c40: 7465 640a 2020 2020 2020 2020 726f 6f74  ted.        root
+00018c50: 203d 2050 6174 6828 4441 5441 5f44 4952   = Path(DATA_DIR
+00018c60: 202f 2022 6967 6e6f 7265 5f73 7562 666f   / "ignore_subfo
+00018c70: 6c64 6572 735f 6769 7469 676e 6f72 655f  lders_gitignore_
+00018c80: 7465 7374 7322 290a 2020 2020 2020 2020  tests").        
+00018c90: 6578 7065 6374 6564 203d 205b 0a20 2020  expected = [.   
+00018ca0: 2020 2020 2020 2020 2072 6f6f 7420 2f20           root / 
+00018cb0: 2261 2e70 7922 2c0a 2020 2020 2020 2020  "a.py",.        
+00018cc0: 2020 2020 726f 6f74 202f 2022 7375 6264      root / "subd
+00018cd0: 6972 2220 2f20 2262 2e70 7922 2c0a 2020  ir" / "b.py",.  
+00018ce0: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+00018cf0: 6173 7365 7274 5f63 6f6c 6c65 6374 6564  assert_collected
+00018d00: 5f73 6f75 7263 6573 285b 726f 6f74 5d2c  _sources([root],
+00018d10: 2065 7870 6563 7465 642c 2072 6f6f 743d   expected, root=
+00018d20: 726f 6f74 290a 0a20 2020 2020 2020 2023  root)..        #
+00018d30: 2049 6620 636f 6d6d 616e 6420 6973 2065   If command is e
+00018d40: 7865 6375 7465 6420 6672 6f6d 206f 7574  xecuted from out
+00018d50: 6572 2064 6972 0a20 2020 2020 2020 2072  er dir.        r
+00018d60: 6f6f 7420 3d20 5061 7468 2844 4154 415f  oot = Path(DATA_
+00018d70: 4449 5220 2f20 2269 676e 6f72 655f 7375  DIR / "ignore_su
+00018d80: 6266 6f6c 6465 7273 5f67 6974 6967 6e6f  bfolders_gitigno
+00018d90: 7265 5f74 6573 7473 2229 0a20 2020 2020  re_tests").     
+00018da0: 2020 2074 6172 6765 7420 3d20 726f 6f74     target = root
+00018db0: 202f 2022 7375 6264 6972 220a 2020 2020   / "subdir".    
+00018dc0: 2020 2020 6578 7065 6374 6564 203d 205b      expected = [
+00018dd0: 7461 7267 6574 202f 2022 622e 7079 225d  target / "b.py"]
+00018de0: 0a20 2020 2020 2020 2061 7373 6572 745f  .        assert_
+00018df0: 636f 6c6c 6563 7465 645f 736f 7572 6365  collected_source
+00018e00: 7328 5b74 6172 6765 745d 2c20 6578 7065  s([target], expe
+00018e10: 6374 6564 2c20 726f 6f74 3d72 6f6f 7429  cted, root=root)
+00018e20: 0a0a 2020 2020 6465 6620 7465 7374 5f65  ..    def test_e
+00018e30: 6d70 7479 5f69 6e63 6c75 6465 2873 656c  mpty_include(sel
+00018e40: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00018e50: 2020 2020 7061 7468 203d 2044 4154 415f      path = DATA_
+00018e60: 4449 5220 2f20 2269 6e63 6c75 6465 5f65  DIR / "include_e
+00018e70: 7863 6c75 6465 5f74 6573 7473 220a 2020  xclude_tests".  
+00018e80: 2020 2020 2020 7372 6320 3d20 5b70 6174        src = [pat
+00018e90: 685d 0a20 2020 2020 2020 2065 7870 6563  h].        expec
+00018ea0: 7465 6420 3d20 5b0a 2020 2020 2020 2020  ted = [.        
+00018eb0: 2020 2020 5061 7468 2870 6174 6820 2f20      Path(path / 
+00018ec0: 2262 2f65 7863 6c75 6465 2f61 2e70 6965  "b/exclude/a.pie
+00018ed0: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
+00018ee0: 5061 7468 2870 6174 6820 2f20 2262 2f65  Path(path / "b/e
+00018ef0: 7863 6c75 6465 2f61 2e70 7922 292c 0a20  xclude/a.py"),. 
+00018f00: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
+00018f10: 7061 7468 202f 2022 622f 6578 636c 7564  path / "b/exclud
+00018f20: 652f 612e 7079 6922 292c 0a20 2020 2020  e/a.pyi"),.     
+00018f30: 2020 2020 2020 2050 6174 6828 7061 7468         Path(path
+00018f40: 202f 2022 622f 646f 6e74 5f65 7863 6c75   / "b/dont_exclu
+00018f50: 6465 2f61 2e70 6965 2229 2c0a 2020 2020  de/a.pie"),.    
+00018f60: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
+00018f70: 6820 2f20 2262 2f64 6f6e 745f 6578 636c  h / "b/dont_excl
+00018f80: 7564 652f 612e 7079 2229 2c0a 2020 2020  ude/a.py"),.    
+00018f90: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
+00018fa0: 6820 2f20 2262 2f64 6f6e 745f 6578 636c  h / "b/dont_excl
+00018fb0: 7564 652f 612e 7079 6922 292c 0a20 2020  ude/a.pyi"),.   
+00018fc0: 2020 2020 2020 2020 2050 6174 6828 7061           Path(pa
+00018fd0: 7468 202f 2022 622f 2e64 6566 696e 6974  th / "b/.definit
+00018fe0: 656c 795f 6578 636c 7564 652f 612e 7069  ely_exclude/a.pi
+00018ff0: 6522 292c 0a20 2020 2020 2020 2020 2020  e"),.           
+00019000: 2050 6174 6828 7061 7468 202f 2022 622f   Path(path / "b/
+00019010: 2e64 6566 696e 6974 656c 795f 6578 636c  .definitely_excl
+00019020: 7564 652f 612e 7079 2229 2c0a 2020 2020  ude/a.py"),.    
+00019030: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
+00019040: 6820 2f20 2262 2f2e 6465 6669 6e69 7465  h / "b/.definite
+00019050: 6c79 5f65 7863 6c75 6465 2f61 2e70 7969  ly_exclude/a.pyi
+00019060: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
+00019070: 5061 7468 2870 6174 6820 2f20 222e 6769  Path(path / ".gi
+00019080: 7469 676e 6f72 6522 292c 0a20 2020 2020  tignore"),.     
+00019090: 2020 2020 2020 2050 6174 6828 7061 7468         Path(path
+000190a0: 202f 2022 7079 7072 6f6a 6563 742e 746f   / "pyproject.to
+000190b0: 6d6c 2229 2c0a 2020 2020 2020 2020 5d0a  ml"),.        ].
+000190c0: 2020 2020 2020 2020 2320 5365 7474 696e          # Settin
+000190d0: 6720 6578 636c 7564 6520 6578 706c 6963  g exclude explic
+000190e0: 6974 6c79 2074 6f20 616e 2065 6d70 7479  itly to an empty
+000190f0: 2073 7472 696e 6720 746f 2062 6c6f 636b   string to block
+00019100: 202e 6769 7469 676e 6f72 6520 7573 6167   .gitignore usag
+00019110: 652e 0a20 2020 2020 2020 2061 7373 6572  e..        asser
+00019120: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
+00019130: 6365 7328 7372 632c 2065 7870 6563 7465  ces(src, expecte
+00019140: 642c 2069 6e63 6c75 6465 3d22 222c 2065  d, include="", e
+00019150: 7863 6c75 6465 3d22 2229 0a0a 2020 2020  xclude="")..    
+00019160: 6465 6620 7465 7374 5f69 6e63 6c75 6465  def test_include
+00019170: 5f61 6273 6f6c 7574 655f 7061 7468 2873  _absolute_path(s
+00019180: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00019190: 2020 2020 2020 7061 7468 203d 2044 4154        path = DAT
+000191a0: 415f 4449 5220 2f20 2269 6e63 6c75 6465  A_DIR / "include
+000191b0: 5f65 7863 6c75 6465 5f74 6573 7473 220a  _exclude_tests".
+000191c0: 2020 2020 2020 2020 7372 6320 3d20 5b70          src = [p
+000191d0: 6174 685d 0a20 2020 2020 2020 2065 7870  ath].        exp
+000191e0: 6563 7465 6420 3d20 5b0a 2020 2020 2020  ected = [.      
+000191f0: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
+00019200: 2f20 2262 2f64 6f6e 745f 6578 636c 7564  / "b/dont_exclud
+00019210: 652f 612e 7069 6522 292c 0a20 2020 2020  e/a.pie"),.     
+00019220: 2020 205d 0a20 2020 2020 2020 2061 7373     ].        ass
+00019230: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
+00019240: 7572 6365 7328 0a20 2020 2020 2020 2020  urces(.         
+00019250: 2020 2073 7263 2c20 6578 7065 6374 6564     src, expected
+00019260: 2c20 726f 6f74 3d70 6174 682c 2069 6e63  , root=path, inc
+00019270: 6c75 6465 3d72 225e 2f62 2f64 6f6e 745f  lude=r"^/b/dont_
+00019280: 6578 636c 7564 652f 615c 2e70 6965 2422  exclude/a\.pie$"
+00019290: 2c20 6578 636c 7564 653d 2222 0a20 2020  , exclude="".   
+000192a0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+000192b0: 7465 7374 5f65 7863 6c75 6465 5f61 6273  test_exclude_abs
+000192c0: 6f6c 7574 655f 7061 7468 2873 656c 6629  olute_path(self)
+000192d0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+000192e0: 2020 7061 7468 203d 2044 4154 415f 4449    path = DATA_DI
+000192f0: 5220 2f20 2269 6e63 6c75 6465 5f65 7863  R / "include_exc
+00019300: 6c75 6465 5f74 6573 7473 220a 2020 2020  lude_tests".    
+00019310: 2020 2020 7372 6320 3d20 5b70 6174 685d      src = [path]
+00019320: 0a20 2020 2020 2020 2065 7870 6563 7465  .        expecte
+00019330: 6420 3d20 5b0a 2020 2020 2020 2020 2020  d = [.          
+00019340: 2020 5061 7468 2870 6174 6820 2f20 2262    Path(path / "b
+00019350: 2f64 6f6e 745f 6578 636c 7564 652f 612e  /dont_exclude/a.
+00019360: 7079 2229 2c0a 2020 2020 2020 2020 2020  py"),.          
+00019370: 2020 5061 7468 2870 6174 6820 2f20 2262    Path(path / "b
+00019380: 2f2e 6465 6669 6e69 7465 6c79 5f65 7863  /.definitely_exc
+00019390: 6c75 6465 2f61 2e70 7922 292c 0a20 2020  lude/a.py"),.   
+000193a0: 2020 2020 205d 0a20 2020 2020 2020 2061       ].        a
+000193b0: 7373 6572 745f 636f 6c6c 6563 7465 645f  ssert_collected_
+000193c0: 736f 7572 6365 7328 0a20 2020 2020 2020  sources(.       
+000193d0: 2020 2020 2073 7263 2c20 6578 7065 6374       src, expect
+000193e0: 6564 2c20 726f 6f74 3d70 6174 682c 2069  ed, root=path, i
+000193f0: 6e63 6c75 6465 3d72 225c 2e70 7924 222c  nclude=r"\.py$",
+00019400: 2065 7863 6c75 6465 3d72 225e 2f62 2f65   exclude=r"^/b/e
+00019410: 7863 6c75 6465 2f61 5c2e 7079 2422 0a20  xclude/a\.py$". 
+00019420: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00019430: 6620 7465 7374 5f65 7874 656e 645f 6578  f test_extend_ex
+00019440: 636c 7564 6528 7365 6c66 2920 2d3e 204e  clude(self) -> N
+00019450: 6f6e 653a 0a20 2020 2020 2020 2070 6174  one:.        pat
+00019460: 6820 3d20 4441 5441 5f44 4952 202f 2022  h = DATA_DIR / "
+00019470: 696e 636c 7564 655f 6578 636c 7564 655f  include_exclude_
+00019480: 7465 7374 7322 0a20 2020 2020 2020 2073  tests".        s
+00019490: 7263 203d 205b 7061 7468 5d0a 2020 2020  rc = [path].    
+000194a0: 2020 2020 6578 7065 6374 6564 203d 205b      expected = [
+000194b0: 0a20 2020 2020 2020 2020 2020 2050 6174  .            Pat
+000194c0: 6828 7061 7468 202f 2022 622f 6578 636c  h(path / "b/excl
+000194d0: 7564 652f 612e 7079 2229 2c0a 2020 2020  ude/a.py"),.    
+000194e0: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
+000194f0: 6820 2f20 2262 2f64 6f6e 745f 6578 636c  h / "b/dont_excl
+00019500: 7564 652f 612e 7079 2229 2c0a 2020 2020  ude/a.py"),.    
+00019510: 2020 2020 5d0a 2020 2020 2020 2020 6173      ].        as
+00019520: 7365 7274 5f63 6f6c 6c65 6374 6564 5f73  sert_collected_s
+00019530: 6f75 7263 6573 280a 2020 2020 2020 2020  ources(.        
+00019540: 2020 2020 7372 632c 2065 7870 6563 7465      src, expecte
+00019550: 642c 2065 7863 6c75 6465 3d72 225c 2e70  d, exclude=r"\.p
+00019560: 7969 2422 2c20 6578 7465 6e64 5f65 7863  yi$", extend_exc
+00019570: 6c75 6465 3d72 225c 2e64 6566 696e 6974  lude=r"\.definit
+00019580: 656c 795f 6578 636c 7564 6522 0a20 2020  ely_exclude".   
+00019590: 2020 2020 2029 0a0a 2020 2020 4070 7974       )..    @pyt
+000195a0: 6573 742e 6d61 726b 2e69 6e63 6f6d 7061  est.mark.incompa
+000195b0: 7469 626c 655f 7769 7468 5f6d 7970 7963  tible_with_mypyc
+000195c0: 0a20 2020 2064 6566 2074 6573 745f 7379  .    def test_sy
+000195d0: 6d6c 696e 6b73 2873 656c 6629 202d 3e20  mlinks(self) -> 
+000195e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 726f  None:.        ro
+000195f0: 6f74 203d 2054 4849 535f 4449 522e 7265  ot = THIS_DIR.re
+00019600: 736f 6c76 6528 290a 2020 2020 2020 2020  solve().        
+00019610: 696e 636c 7564 6520 3d20 7265 2e63 6f6d  include = re.com
+00019620: 7069 6c65 2862 6c61 636b 2e44 4546 4155  pile(black.DEFAU
+00019630: 4c54 5f49 4e43 4c55 4445 5329 0a20 2020  LT_INCLUDES).   
+00019640: 2020 2020 2065 7863 6c75 6465 203d 2072       exclude = r
+00019650: 652e 636f 6d70 696c 6528 626c 6163 6b2e  e.compile(black.
+00019660: 4445 4641 554c 545f 4558 434c 5544 4553  DEFAULT_EXCLUDES
+00019670: 290a 2020 2020 2020 2020 7265 706f 7274  ).        report
+00019680: 203d 2062 6c61 636b 2e52 6570 6f72 7428   = black.Report(
+00019690: 290a 2020 2020 2020 2020 6769 7469 676e  ).        gitign
+000196a0: 6f72 6520 3d20 5061 7468 5370 6563 2e66  ore = PathSpec.f
+000196b0: 726f 6d5f 6c69 6e65 7328 2267 6974 7769  rom_lines("gitwi
+000196c0: 6c64 6d61 7463 6822 2c20 5b5d 290a 0a20  ldmatch", []).. 
+000196d0: 2020 2020 2020 2072 6567 756c 6172 203d         regular =
+000196e0: 204d 6167 6963 4d6f 636b 2829 0a20 2020   MagicMock().   
+000196f0: 2020 2020 2072 6567 756c 6172 2e72 656c       regular.rel
+00019700: 6174 6976 655f 746f 2e72 6574 7572 6e5f  ative_to.return_
+00019710: 7661 6c75 6520 3d20 5061 7468 2822 7265  value = Path("re
+00019720: 6775 6c61 722e 7079 2229 0a20 2020 2020  gular.py").     
+00019730: 2020 2072 6567 756c 6172 2e72 6573 6f6c     regular.resol
+00019740: 7665 2e72 6574 7572 6e5f 7661 6c75 6520  ve.return_value 
+00019750: 3d20 726f 6f74 202f 2022 7265 6775 6c61  = root / "regula
+00019760: 722e 7079 220a 2020 2020 2020 2020 7265  r.py".        re
+00019770: 6775 6c61 722e 6973 5f64 6972 2e72 6574  gular.is_dir.ret
+00019780: 7572 6e5f 7661 6c75 6520 3d20 4661 6c73  urn_value = Fals
+00019790: 650a 2020 2020 2020 2020 7265 6775 6c61  e.        regula
+000197a0: 722e 6973 5f66 696c 652e 7265 7475 726e  r.is_file.return
+000197b0: 5f76 616c 7565 203d 2054 7275 650a 0a20  _value = True.. 
+000197c0: 2020 2020 2020 206f 7574 7369 6465 5f72         outside_r
+000197d0: 6f6f 745f 7379 6d6c 696e 6b20 3d20 4d61  oot_symlink = Ma
+000197e0: 6769 634d 6f63 6b28 290a 2020 2020 2020  gicMock().      
+000197f0: 2020 6f75 7473 6964 655f 726f 6f74 5f73    outside_root_s
+00019800: 796d 6c69 6e6b 2e72 656c 6174 6976 655f  ymlink.relative_
+00019810: 746f 2e72 6574 7572 6e5f 7661 6c75 6520  to.return_value 
+00019820: 3d20 5061 7468 2822 7379 6d6c 696e 6b2e  = Path("symlink.
+00019830: 7079 2229 0a20 2020 2020 2020 206f 7574  py").        out
+00019840: 7369 6465 5f72 6f6f 745f 7379 6d6c 696e  side_root_symlin
+00019850: 6b2e 7265 736f 6c76 652e 7265 7475 726e  k.resolve.return
+00019860: 5f76 616c 7565 203d 2050 6174 6828 222f  _value = Path("/
+00019870: 6e6f 7768 6572 6522 290a 2020 2020 2020  nowhere").      
+00019880: 2020 6f75 7473 6964 655f 726f 6f74 5f73    outside_root_s
+00019890: 796d 6c69 6e6b 2e69 735f 6469 722e 7265  ymlink.is_dir.re
+000198a0: 7475 726e 5f76 616c 7565 203d 2046 616c  turn_value = Fal
+000198b0: 7365 0a20 2020 2020 2020 206f 7574 7369  se.        outsi
+000198c0: 6465 5f72 6f6f 745f 7379 6d6c 696e 6b2e  de_root_symlink.
+000198d0: 6973 5f66 696c 652e 7265 7475 726e 5f76  is_file.return_v
+000198e0: 616c 7565 203d 2054 7275 650a 0a20 2020  alue = True..   
+000198f0: 2020 2020 2069 676e 6f72 6564 5f73 796d       ignored_sym
+00019900: 6c69 6e6b 203d 204d 6167 6963 4d6f 636b  link = MagicMock
+00019910: 2829 0a20 2020 2020 2020 2069 676e 6f72  ().        ignor
+00019920: 6564 5f73 796d 6c69 6e6b 2e72 656c 6174  ed_symlink.relat
+00019930: 6976 655f 746f 2e72 6574 7572 6e5f 7661  ive_to.return_va
+00019940: 6c75 6520 3d20 5061 7468 2822 2e6d 7970  lue = Path(".myp
+00019950: 795f 6361 6368 6522 2920 2f20 2273 796d  y_cache") / "sym
+00019960: 6c69 6e6b 2e70 7922 0a20 2020 2020 2020  link.py".       
+00019970: 2069 676e 6f72 6564 5f73 796d 6c69 6e6b   ignored_symlink
+00019980: 2e69 735f 6469 722e 7265 7475 726e 5f76  .is_dir.return_v
+00019990: 616c 7565 203d 2046 616c 7365 0a20 2020  alue = False.   
+000199a0: 2020 2020 2069 676e 6f72 6564 5f73 796d       ignored_sym
+000199b0: 6c69 6e6b 2e69 735f 6669 6c65 2e72 6574  link.is_file.ret
+000199c0: 7572 6e5f 7661 6c75 6520 3d20 5472 7565  urn_value = True
+000199d0: 0a0a 2020 2020 2020 2020 2320 4120 7379  ..        # A sy
+000199e0: 6d6c 696e 6b20 7468 6174 2068 6173 2061  mlink that has a
+000199f0: 6e20 6578 636c 7564 6564 206e 616d 652c  n excluded name,
+00019a00: 2062 7574 2070 6f69 6e74 7320 746f 2061   but points to a
+00019a10: 6e20 696e 636c 7564 6564 206e 616d 650a  n included name.
+00019a20: 2020 2020 2020 2020 7379 6d6c 696e 6b5f          symlink_
+00019a30: 6578 636c 7564 6564 5f6e 616d 6520 3d20  excluded_name = 
+00019a40: 4d61 6769 634d 6f63 6b28 290a 2020 2020  MagicMock().    
+00019a50: 2020 2020 7379 6d6c 696e 6b5f 6578 636c      symlink_excl
+00019a60: 7564 6564 5f6e 616d 652e 7265 6c61 7469  uded_name.relati
+00019a70: 7665 5f74 6f2e 7265 7475 726e 5f76 616c  ve_to.return_val
+00019a80: 7565 203d 2050 6174 6828 2265 7863 6c75  ue = Path("exclu
+00019a90: 6465 645f 6e61 6d65 2229 0a20 2020 2020  ded_name").     
+00019aa0: 2020 2073 796d 6c69 6e6b 5f65 7863 6c75     symlink_exclu
+00019ab0: 6465 645f 6e61 6d65 2e72 6573 6f6c 7665  ded_name.resolve
+00019ac0: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
+00019ad0: 726f 6f74 202f 2022 696e 636c 7564 6564  root / "included
+00019ae0: 5f6e 616d 652e 7079 220a 2020 2020 2020  _name.py".      
+00019af0: 2020 7379 6d6c 696e 6b5f 6578 636c 7564    symlink_exclud
+00019b00: 6564 5f6e 616d 652e 6973 5f64 6972 2e72  ed_name.is_dir.r
+00019b10: 6574 7572 6e5f 7661 6c75 6520 3d20 4661  eturn_value = Fa
+00019b20: 6c73 650a 2020 2020 2020 2020 7379 6d6c  lse.        syml
+00019b30: 696e 6b5f 6578 636c 7564 6564 5f6e 616d  ink_excluded_nam
+00019b40: 652e 6973 5f66 696c 652e 7265 7475 726e  e.is_file.return
+00019b50: 5f76 616c 7565 203d 2054 7275 650a 0a20  _value = True.. 
+00019b60: 2020 2020 2020 2023 2041 2073 796d 6c69         # A symli
+00019b70: 6e6b 2074 6861 7420 6861 7320 616e 2069  nk that has an i
+00019b80: 6e63 6c75 6465 6420 6e61 6d65 2c20 6275  ncluded name, bu
+00019b90: 7420 706f 696e 7473 2074 6f20 616e 2065  t points to an e
+00019ba0: 7863 6c75 6465 6420 6e61 6d65 0a20 2020  xcluded name.   
+00019bb0: 2020 2020 2073 796d 6c69 6e6b 5f69 6e63       symlink_inc
+00019bc0: 6c75 6465 645f 6e61 6d65 203d 204d 6167  luded_name = Mag
+00019bd0: 6963 4d6f 636b 2829 0a20 2020 2020 2020  icMock().       
+00019be0: 2073 796d 6c69 6e6b 5f69 6e63 6c75 6465   symlink_include
+00019bf0: 645f 6e61 6d65 2e72 656c 6174 6976 655f  d_name.relative_
+00019c00: 746f 2e72 6574 7572 6e5f 7661 6c75 6520  to.return_value 
+00019c10: 3d20 5061 7468 2822 696e 636c 7564 6564  = Path("included
+00019c20: 5f6e 616d 652e 7079 2229 0a20 2020 2020  _name.py").     
+00019c30: 2020 2073 796d 6c69 6e6b 5f69 6e63 6c75     symlink_inclu
+00019c40: 6465 645f 6e61 6d65 2e72 6573 6f6c 7665  ded_name.resolve
+00019c50: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
+00019c60: 726f 6f74 202f 2022 6578 636c 7564 6564  root / "excluded
+00019c70: 5f6e 616d 6522 0a20 2020 2020 2020 2073  _name".        s
+00019c80: 796d 6c69 6e6b 5f69 6e63 6c75 6465 645f  ymlink_included_
+00019c90: 6e61 6d65 2e69 735f 6469 722e 7265 7475  name.is_dir.retu
+00019ca0: 726e 5f76 616c 7565 203d 2046 616c 7365  rn_value = False
+00019cb0: 0a20 2020 2020 2020 2073 796d 6c69 6e6b  .        symlink
+00019cc0: 5f69 6e63 6c75 6465 645f 6e61 6d65 2e69  _included_name.i
+00019cd0: 735f 6669 6c65 2e72 6574 7572 6e5f 7661  s_file.return_va
+00019ce0: 6c75 6520 3d20 5472 7565 0a0a 2020 2020  lue = True..    
+00019cf0: 2020 2020 7061 7468 203d 204d 6167 6963      path = Magic
+00019d00: 4d6f 636b 2829 0a20 2020 2020 2020 2070  Mock().        p
+00019d10: 6174 682e 6974 6572 6469 722e 7265 7475  ath.iterdir.retu
+00019d20: 726e 5f76 616c 7565 203d 205b 0a20 2020  rn_value = [.   
+00019d30: 2020 2020 2020 2020 2072 6567 756c 6172           regular
+00019d40: 2c0a 2020 2020 2020 2020 2020 2020 6f75  ,.            ou
+00019d50: 7473 6964 655f 726f 6f74 5f73 796d 6c69  tside_root_symli
+00019d60: 6e6b 2c0a 2020 2020 2020 2020 2020 2020  nk,.            
+00019d70: 6967 6e6f 7265 645f 7379 6d6c 696e 6b2c  ignored_symlink,
+00019d80: 0a20 2020 2020 2020 2020 2020 2073 796d  .            sym
+00019d90: 6c69 6e6b 5f65 7863 6c75 6465 645f 6e61  link_excluded_na
+00019da0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00019db0: 7379 6d6c 696e 6b5f 696e 636c 7564 6564  symlink_included
+00019dc0: 5f6e 616d 652c 0a20 2020 2020 2020 205d  _name,.        ]
+00019dd0: 0a0a 2020 2020 2020 2020 6669 6c65 7320  ..        files 
+00019de0: 3d20 6c69 7374 280a 2020 2020 2020 2020  = list(.        
+00019df0: 2020 2020 626c 6163 6b2e 6765 6e5f 7079      black.gen_py
+00019e00: 7468 6f6e 5f66 696c 6573 280a 2020 2020  thon_files(.    
+00019e10: 2020 2020 2020 2020 2020 2020 7061 7468              path
+00019e20: 2e69 7465 7264 6972 2829 2c0a 2020 2020  .iterdir(),.    
+00019e30: 2020 2020 2020 2020 2020 2020 726f 6f74              root
+00019e40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00019e50: 2020 696e 636c 7564 652c 0a20 2020 2020    include,.     
+00019e60: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
+00019e70: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
+00019e80: 2020 2020 4e6f 6e65 2c0a 2020 2020 2020      None,.      
+00019e90: 2020 2020 2020 2020 2020 4e6f 6e65 2c0a            None,.
+00019ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019eb0: 7265 706f 7274 2c0a 2020 2020 2020 2020  report,.        
+00019ec0: 2020 2020 2020 2020 7b70 6174 683a 2067          {path: g
+00019ed0: 6974 6967 6e6f 7265 7d2c 0a20 2020 2020  itignore},.     
+00019ee0: 2020 2020 2020 2020 2020 2076 6572 626f             verbo
+00019ef0: 7365 3d46 616c 7365 2c0a 2020 2020 2020  se=False,.      
+00019f00: 2020 2020 2020 2020 2020 7175 6965 743d            quiet=
+00019f10: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
+00019f20: 2020 2029 0a20 2020 2020 2020 2029 0a20     ).        ). 
+00019f30: 2020 2020 2020 2061 7373 6572 7420 6669         assert fi
+00019f40: 6c65 7320 3d3d 205b 7265 6775 6c61 722c  les == [regular,
+00019f50: 2073 796d 6c69 6e6b 5f69 6e63 6c75 6465   symlink_include
+00019f60: 645f 6e61 6d65 5d0a 0a20 2020 2020 2020  d_name]..       
+00019f70: 2070 6174 682e 6974 6572 6469 722e 6173   path.iterdir.as
+00019f80: 7365 7274 5f63 616c 6c65 645f 6f6e 6365  sert_called_once
+00019f90: 2829 0a20 2020 2020 2020 206f 7574 7369  ().        outsi
+00019fa0: 6465 5f72 6f6f 745f 7379 6d6c 696e 6b2e  de_root_symlink.
+00019fb0: 7265 736f 6c76 652e 6173 7365 7274 5f63  resolve.assert_c
+00019fc0: 616c 6c65 645f 6f6e 6365 2829 0a20 2020  alled_once().   
+00019fd0: 2020 2020 2069 676e 6f72 6564 5f73 796d       ignored_sym
+00019fe0: 6c69 6e6b 2e72 6573 6f6c 7665 2e61 7373  link.resolve.ass
+00019ff0: 6572 745f 6e6f 745f 6361 6c6c 6564 2829  ert_not_called()
+0001a000: 0a0a 2020 2020 6465 6620 7465 7374 5f67  ..    def test_g
+0001a010: 6574 5f73 6f75 7263 6573 5f73 796d 6c69  et_sources_symli
+0001a020: 6e6b 5f61 6e64 5f66 6f72 6365 5f65 7863  nk_and_force_exc
+0001a030: 6c75 6465 2873 656c 6629 202d 3e20 4e6f  lude(self) -> No
+0001a040: 6e65 3a0a 2020 2020 2020 2020 7769 7468  ne:.        with
+0001a050: 2054 656d 706f 7261 7279 4469 7265 6374   TemporaryDirect
+0001a060: 6f72 7928 2920 6173 2074 656d 7064 6972  ory() as tempdir
+0001a070: 3a0a 2020 2020 2020 2020 2020 2020 746d  :.            tm
+0001a080: 7020 3d20 5061 7468 2874 656d 7064 6972  p = Path(tempdir
+0001a090: 292e 7265 736f 6c76 6528 290a 2020 2020  ).resolve().    
+0001a0a0: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
+0001a0b0: 2074 6d70 202f 2022 6163 7475 616c 220a   tmp / "actual".
+0001a0c0: 2020 2020 2020 2020 2020 2020 6163 7475              actu
+0001a0d0: 616c 2e6d 6b64 6972 2829 0a20 2020 2020  al.mkdir().     
+0001a0e0: 2020 2020 2020 2073 796d 6c69 6e6b 203d         symlink =
+0001a0f0: 2074 6d70 202f 2022 7379 6d6c 696e 6b22   tmp / "symlink"
+0001a100: 0a20 2020 2020 2020 2020 2020 2073 796d  .            sym
+0001a110: 6c69 6e6b 2e73 796d 6c69 6e6b 5f74 6f28  link.symlink_to(
+0001a120: 6163 7475 616c 290a 0a20 2020 2020 2020  actual)..       
+0001a130: 2020 2020 2061 6374 7561 6c5f 7072 6f6a       actual_proj
+0001a140: 203d 2061 6374 7561 6c20 2f20 2270 726f   = actual / "pro
+0001a150: 6a65 6374 220a 2020 2020 2020 2020 2020  ject".          
+0001a160: 2020 6163 7475 616c 5f70 726f 6a2e 6d6b    actual_proj.mk
+0001a170: 6469 7228 290a 2020 2020 2020 2020 2020  dir().          
+0001a180: 2020 2861 6374 7561 6c5f 7072 6f6a 202f    (actual_proj /
+0001a190: 2022 6d6f 6475 6c65 2e70 7922 292e 7772   "module.py").wr
+0001a1a0: 6974 655f 7465 7874 2822 7072 696e 7428  ite_text("print(
+0001a1b0: 2768 656c 6c6f 2729 222c 2065 6e63 6f64  'hello')", encod
+0001a1c0: 696e 673d 2275 7466 2d38 2229 0a0a 2020  ing="utf-8")..  
+0001a1d0: 2020 2020 2020 2020 2020 7379 6d6c 696e            symlin
+0001a1e0: 6b5f 7072 6f6a 203d 2073 796d 6c69 6e6b  k_proj = symlink
+0001a1f0: 202f 2022 7072 6f6a 6563 7422 0a0a 2020   / "project"..  
+0001a200: 2020 2020 2020 2020 2020 7769 7468 2063            with c
+0001a210: 6861 6e67 655f 6469 7265 6374 6f72 7928  hange_directory(
+0001a220: 7379 6d6c 696e 6b5f 7072 6f6a 293a 0a20  symlink_proj):. 
+0001a230: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0001a240: 7373 6572 745f 636f 6c6c 6563 7465 645f  ssert_collected_
+0001a250: 736f 7572 6365 7328 0a20 2020 2020 2020  sources(.       
+0001a260: 2020 2020 2020 2020 2020 2020 2073 7263               src
+0001a270: 3d5b 226d 6f64 756c 652e 7079 225d 2c0a  =["module.py"],.
+0001a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a290: 2020 2020 726f 6f74 3d73 796d 6c69 6e6b      root=symlink
+0001a2a0: 5f70 726f 6a2e 7265 736f 6c76 6528 292c  _proj.resolve(),
+0001a2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a2c0: 2020 2020 2065 7870 6563 7465 643d 5b22       expected=["
+0001a2d0: 6d6f 6475 6c65 2e70 7922 5d2c 0a20 2020  module.py"],.   
+0001a2e0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+0001a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a300: 6162 736f 6c75 7465 5f6d 6f64 756c 6520  absolute_module 
+0001a310: 3d20 7379 6d6c 696e 6b5f 7072 6f6a 202f  = symlink_proj /
+0001a320: 2022 6d6f 6475 6c65 2e70 7922 0a20 2020   "module.py".   
+0001a330: 2020 2020 2020 2020 2020 2020 2061 7373               ass
+0001a340: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
+0001a350: 7572 6365 7328 0a20 2020 2020 2020 2020  urces(.         
+0001a360: 2020 2020 2020 2020 2020 2073 7263 3d5b             src=[
+0001a370: 6162 736f 6c75 7465 5f6d 6f64 756c 655d  absolute_module]
+0001a380: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001a390: 2020 2020 2020 726f 6f74 3d73 796d 6c69        root=symli
+0001a3a0: 6e6b 5f70 726f 6a2e 7265 736f 6c76 6528  nk_proj.resolve(
+0001a3b0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0001a3c0: 2020 2020 2020 2065 7870 6563 7465 643d         expected=
+0001a3d0: 5b61 6273 6f6c 7574 655f 6d6f 6475 6c65  [absolute_module
+0001a3e0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0001a3f0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+0001a400: 2020 2020 2020 2320 6120 6665 7720 7472        # a few tr
+0001a410: 6963 6b79 2074 6573 7473 2066 6f72 2066  icky tests for f
+0001a420: 6f72 6365 5f65 7863 6c75 6465 0a20 2020  orce_exclude.   
+0001a430: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
+0001a440: 745f 7379 6d6c 696e 6b20 3d20 7379 6d6c  t_symlink = syml
+0001a450: 696e 6b5f 7072 6f6a 202f 2022 7379 6d6c  ink_proj / "syml
+0001a460: 696e 6b5f 6d6f 6475 6c65 2e70 7922 0a20  ink_module.py". 
+0001a470: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001a480: 6c61 745f 7379 6d6c 696e 6b2e 7379 6d6c  lat_symlink.syml
+0001a490: 696e 6b5f 746f 2861 6374 7561 6c5f 7072  ink_to(actual_pr
+0001a4a0: 6f6a 202f 2022 6d6f 6475 6c65 2e70 7922  oj / "module.py"
+0001a4b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001a4c0: 2020 6173 7365 7274 5f63 6f6c 6c65 6374    assert_collect
+0001a4d0: 6564 5f73 6f75 7263 6573 280a 2020 2020  ed_sources(.    
+0001a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a4f0: 7372 633d 5b66 6c61 745f 7379 6d6c 696e  src=[flat_symlin
+0001a500: 6b5d 2c0a 2020 2020 2020 2020 2020 2020  k],.            
+0001a510: 2020 2020 2020 2020 726f 6f74 3d73 796d          root=sym
+0001a520: 6c69 6e6b 5f70 726f 6a2e 7265 736f 6c76  link_proj.resolv
+0001a530: 6528 292c 0a20 2020 2020 2020 2020 2020  e(),.           
+0001a540: 2020 2020 2020 2020 2066 6f72 6365 5f65           force_e
+0001a550: 7863 6c75 6465 3d72 222f 7379 6d6c 696e  xclude=r"/symlin
+0001a560: 6b5f 6d6f 6475 6c65 2e70 7922 2c0a 2020  k_module.py",.  
+0001a570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a580: 2020 6578 7065 6374 6564 3d5b 5d2c 0a20    expected=[],. 
+0001a590: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0001a5a0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001a5b0: 2020 7461 7267 6574 203d 2061 6374 7561    target = actua
+0001a5c0: 6c5f 7072 6f6a 202f 2022 7461 7267 6574  l_proj / "target
+0001a5d0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0001a5e0: 2020 7461 7267 6574 2e6d 6b64 6972 2829    target.mkdir()
+0001a5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a600: 2028 7461 7267 6574 202f 2022 616e 6f74   (target / "anot
+0001a610: 6865 722e 7079 2229 2e77 7269 7465 5f74  her.py").write_t
+0001a620: 6578 7428 2270 7269 6e74 2827 6865 6c6c  ext("print('hell
+0001a630: 6f27 2922 2c20 656e 636f 6469 6e67 3d22  o')", encoding="
+0001a640: 7574 662d 3822 290a 2020 2020 2020 2020  utf-8").        
+0001a650: 2020 2020 2020 2020 2873 796d 6c69 6e6b          (symlink
+0001a660: 5f70 726f 6a20 2f20 226e 6573 7465 6422  _proj / "nested"
+0001a670: 292e 7379 6d6c 696e 6b5f 746f 2874 6172  ).symlink_to(tar
+0001a680: 6765 7429 0a0a 2020 2020 2020 2020 2020  get)..          
+0001a690: 2020 2020 2020 6173 7365 7274 5f63 6f6c        assert_col
+0001a6a0: 6c65 6374 6564 5f73 6f75 7263 6573 280a  lected_sources(.
+0001a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a6c0: 2020 2020 7372 633d 5b73 796d 6c69 6e6b      src=[symlink
+0001a6d0: 5f70 726f 6a20 2f20 226e 6573 7465 6422  _proj / "nested"
+0001a6e0: 202f 2022 616e 6f74 6865 722e 7079 225d   / "another.py"]
+0001a6f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001a700: 2020 2020 2020 726f 6f74 3d73 796d 6c69        root=symli
+0001a710: 6e6b 5f70 726f 6a2e 7265 736f 6c76 6528  nk_proj.resolve(
+0001a720: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0001a730: 2020 2020 2020 2066 6f72 6365 5f65 7863         force_exc
+0001a740: 6c75 6465 3d72 226e 6573 7465 6422 2c0a  lude=r"nested",.
+0001a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a760: 2020 2020 6578 7065 6374 6564 3d5b 5d2c      expected=[],
+0001a770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a780: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0001a790: 2020 2061 7373 6572 745f 636f 6c6c 6563     assert_collec
+0001a7a0: 7465 645f 736f 7572 6365 7328 0a20 2020  ted_sources(.   
+0001a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7c0: 2073 7263 3d5b 7379 6d6c 696e 6b5f 7072   src=[symlink_pr
+0001a7d0: 6f6a 202f 2022 6e65 7374 6564 2220 2f20  oj / "nested" / 
+0001a7e0: 2261 6e6f 7468 6572 2e70 7922 5d2c 0a20  "another.py"],. 
+0001a7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a800: 2020 2072 6f6f 743d 7379 6d6c 696e 6b5f     root=symlink_
+0001a810: 7072 6f6a 2e72 6573 6f6c 7665 2829 2c0a  proj.resolve(),.
+0001a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a830: 2020 2020 666f 7263 655f 6578 636c 7564      force_exclud
+0001a840: 653d 7222 7461 7267 6574 222c 0a20 2020  e=r"target",.   
+0001a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a860: 2065 7870 6563 7465 643d 5b73 796d 6c69   expected=[symli
 0001a870: 6e6b 5f70 726f 6a20 2f20 226e 6573 7465  nk_proj / "neste
-0001a880: 6422 292e 7379 6d6c 696e 6b5f 746f 2874  d").symlink_to(t
-0001a890: 6172 6765 7429 0a0a 2020 2020 2020 2020  arget)..        
-0001a8a0: 2020 2020 2020 2020 6173 7365 7274 5f63          assert_c
-0001a8b0: 6f6c 6c65 6374 6564 5f73 6f75 7263 6573  ollected_sources
-0001a8c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001a8d0: 2020 2020 2020 7372 633d 5b73 796d 6c69        src=[symli
-0001a8e0: 6e6b 5f70 726f 6a20 2f20 226e 6573 7465  nk_proj / "neste
-0001a8f0: 6422 202f 2022 616e 6f74 6865 722e 7079  d" / "another.py
-0001a900: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-0001a910: 2020 2020 2020 2020 726f 6f74 3d73 796d          root=sym
-0001a920: 6c69 6e6b 5f70 726f 6a2e 7265 736f 6c76  link_proj.resolv
-0001a930: 6528 292c 0a20 2020 2020 2020 2020 2020  e(),.           
-0001a940: 2020 2020 2020 2020 2066 6f72 6365 5f65           force_e
-0001a950: 7863 6c75 6465 3d72 226e 6573 7465 6422  xclude=r"nested"
-0001a960: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001a970: 2020 2020 2020 6578 7065 6374 6564 3d5b        expected=[
-0001a980: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0001a990: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0001a9a0: 2020 2020 2061 7373 6572 745f 636f 6c6c       assert_coll
-0001a9b0: 6563 7465 645f 736f 7572 6365 7328 0a20  ected_sources(. 
-0001a9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9d0: 2020 2073 7263 3d5b 7379 6d6c 696e 6b5f     src=[symlink_
-0001a9e0: 7072 6f6a 202f 2022 6e65 7374 6564 2220  proj / "nested" 
-0001a9f0: 2f20 2261 6e6f 7468 6572 2e70 7922 5d2c  / "another.py"],
-0001aa00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001aa10: 2020 2020 2072 6f6f 743d 7379 6d6c 696e       root=symlin
-0001aa20: 6b5f 7072 6f6a 2e72 6573 6f6c 7665 2829  k_proj.resolve()
-0001aa30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001aa40: 2020 2020 2020 666f 7263 655f 6578 636c        force_excl
-0001aa50: 7564 653d 7222 7461 7267 6574 222c 0a20  ude=r"target",. 
-0001aa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa70: 2020 2065 7870 6563 7465 643d 5b73 796d     expected=[sym
-0001aa80: 6c69 6e6b 5f70 726f 6a20 2f20 226e 6573  link_proj / "nes
-0001aa90: 7465 6422 202f 2022 616e 6f74 6865 722e  ted" / "another.
-0001aaa0: 7079 225d 2c0a 2020 2020 2020 2020 2020  py"],.          
-0001aab0: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-0001aac0: 2074 6573 745f 6765 745f 736f 7572 6365   test_get_source
-0001aad0: 735f 7769 7468 5f73 7464 696e 5f73 796d  s_with_stdin_sym
-0001aae0: 6c69 6e6b 5f6f 7574 7369 6465 5f72 6f6f  link_outside_roo
-0001aaf0: 7428 0a20 2020 2020 2020 2073 656c 662c  t(.        self,
-0001ab00: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0a  .    ) -> None:.
-0001ab10: 2020 2020 2020 2020 7061 7468 203d 2054          path = T
-0001ab20: 4849 535f 4449 5220 2f20 2264 6174 6122  HIS_DIR / "data"
-0001ab30: 202f 2022 696e 636c 7564 655f 6578 636c   / "include_excl
-0001ab40: 7564 655f 7465 7374 7322 0a20 2020 2020  ude_tests".     
-0001ab50: 2020 2073 7464 696e 5f66 696c 656e 616d     stdin_filenam
-0001ab60: 6520 3d20 7374 7228 7061 7468 202f 2022  e = str(path / "
-0001ab70: 622f 6578 636c 7564 652f 612e 7079 2229  b/exclude/a.py")
-0001ab80: 0a20 2020 2020 2020 206f 7574 7369 6465  .        outside
-0001ab90: 5f72 6f6f 745f 7379 6d6c 696e 6b20 3d20  _root_symlink = 
-0001aba0: 5061 7468 2822 2f74 6172 6765 745f 6469  Path("/target_di
-0001abb0: 7265 6374 6f72 792f 612e 7079 2229 0a20  rectory/a.py"). 
-0001abc0: 2020 2020 2020 2072 6f6f 7420 3d20 5061         root = Pa
-0001abd0: 7468 2822 7461 7267 6574 5f64 6972 2f22  th("target_dir/"
-0001abe0: 292e 7265 736f 6c76 6528 292e 6162 736f  ).resolve().abso
-0001abf0: 6c75 7465 2829 0a20 2020 2020 2020 2077  lute().        w
-0001ac00: 6974 6820 7061 7463 6828 2270 6174 686c  ith patch("pathl
-0001ac10: 6962 2e50 6174 682e 7265 736f 6c76 6522  ib.Path.resolve"
-0001ac20: 2c20 7265 7475 726e 5f76 616c 7565 3d6f  , return_value=o
-0001ac30: 7574 7369 6465 5f72 6f6f 745f 7379 6d6c  utside_root_syml
-0001ac40: 696e 6b29 3a0a 2020 2020 2020 2020 2020  ink):.          
-0001ac50: 2020 6173 7365 7274 5f63 6f6c 6c65 6374    assert_collect
-0001ac60: 6564 5f73 6f75 7263 6573 280a 2020 2020  ed_sources(.    
-0001ac70: 2020 2020 2020 2020 2020 2020 726f 6f74              root
-0001ac80: 3d72 6f6f 742c 0a20 2020 2020 2020 2020  =root,.         
-0001ac90: 2020 2020 2020 2073 7263 3d5b 222d 225d         src=["-"]
-0001aca0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001acb0: 2020 6578 7065 6374 6564 3d5b 5d2c 0a20    expected=[],. 
-0001acc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001acd0: 7464 696e 5f66 696c 656e 616d 653d 7374  tdin_filename=st
-0001ace0: 6469 6e5f 6669 6c65 6e61 6d65 2c0a 2020  din_filename,.  
-0001acf0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0001ad00: 2064 6566 2074 6573 745f 6765 745f 736f   def test_get_so
-0001ad10: 7572 6365 735f 7769 7468 5f73 7464 696e  urces_with_stdin
-0001ad20: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0001ad30: 2020 2020 2020 2020 7372 6320 3d20 5b22          src = ["
-0001ad40: 2d22 5d0a 2020 2020 2020 2020 6578 7065  -"].        expe
-0001ad50: 6374 6564 203d 205b 222d 225d 0a20 2020  cted = ["-"].   
-0001ad60: 2020 2020 2061 7373 6572 745f 636f 6c6c       assert_coll
-0001ad70: 6563 7465 645f 736f 7572 6365 7328 0a20  ected_sources(. 
-0001ad80: 2020 2020 2020 2020 2020 2073 7263 2c0a             src,.
-0001ad90: 2020 2020 2020 2020 2020 2020 726f 6f74              root
-0001ada0: 3d54 4849 535f 4449 522e 7265 736f 6c76  =THIS_DIR.resolv
-0001adb0: 6528 292c 0a20 2020 2020 2020 2020 2020  e(),.           
-0001adc0: 2065 7870 6563 7465 643d 6578 7065 6374   expected=expect
-0001add0: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
-0001ade0: 696e 636c 7564 653d 2222 2c0a 2020 2020  include="",.    
-0001adf0: 2020 2020 2020 2020 6578 636c 7564 653d          exclude=
-0001ae00: 7222 2f65 7863 6c75 6465 2f7c 615c 2e70  r"/exclude/|a\.p
-0001ae10: 7922 2c0a 2020 2020 2020 2020 290a 0a20  y",.        ).. 
-0001ae20: 2020 2064 6566 2074 6573 745f 6765 745f     def test_get_
-0001ae30: 736f 7572 6365 735f 7769 7468 5f73 7464  sources_with_std
-0001ae40: 696e 5f66 696c 656e 616d 6528 7365 6c66  in_filename(self
-0001ae50: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0001ae60: 2020 2073 7263 203d 205b 222d 225d 0a20     src = ["-"]. 
-0001ae70: 2020 2020 2020 2073 7464 696e 5f66 696c         stdin_fil
-0001ae80: 656e 616d 6520 3d20 7374 7228 5448 4953  ename = str(THIS
-0001ae90: 5f44 4952 202f 2022 6461 7461 2f63 6f6c  _DIR / "data/col
-0001aea0: 6c65 6374 696f 6e73 2e70 7922 290a 2020  lections.py").  
-0001aeb0: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
-0001aec0: 205b 6622 5f5f 424c 4143 4b5f 5354 4449   [f"__BLACK_STDI
-0001aed0: 4e5f 4649 4c45 4e41 4d45 5f5f 7b73 7464  N_FILENAME__{std
-0001aee0: 696e 5f66 696c 656e 616d 657d 225d 0a20  in_filename}"]. 
-0001aef0: 2020 2020 2020 2061 7373 6572 745f 636f         assert_co
-0001af00: 6c6c 6563 7465 645f 736f 7572 6365 7328  llected_sources(
-0001af10: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
-0001af20: 2c0a 2020 2020 2020 2020 2020 2020 726f  ,.            ro
-0001af30: 6f74 3d54 4849 535f 4449 522e 7265 736f  ot=THIS_DIR.reso
-0001af40: 6c76 6528 292c 0a20 2020 2020 2020 2020  lve(),.         
-0001af50: 2020 2065 7870 6563 7465 643d 6578 7065     expected=expe
-0001af60: 6374 6564 2c0a 2020 2020 2020 2020 2020  cted,.          
-0001af70: 2020 6578 636c 7564 653d 7222 2f65 7863    exclude=r"/exc
-0001af80: 6c75 6465 2f61 5c2e 7079 222c 0a20 2020  lude/a\.py",.   
-0001af90: 2020 2020 2020 2020 2073 7464 696e 5f66           stdin_f
-0001afa0: 696c 656e 616d 653d 7374 6469 6e5f 6669  ilename=stdin_fi
-0001afb0: 6c65 6e61 6d65 2c0a 2020 2020 2020 2020  lename,.        
-0001afc0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-0001afd0: 6765 745f 736f 7572 6365 735f 7769 7468  get_sources_with
-0001afe0: 5f73 7464 696e 5f66 696c 656e 616d 655f  _stdin_filename_
-0001aff0: 616e 645f 6578 636c 7564 6528 7365 6c66  and_exclude(self
-0001b000: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0001b010: 2020 2023 2045 7863 6c75 6465 2073 686f     # Exclude sho
-0001b020: 756c 646e 2774 2065 7863 6c75 6465 2073  uldn't exclude s
-0001b030: 7464 696e 5f66 696c 656e 616d 6520 7369  tdin_filename si
-0001b040: 6e63 6520 6974 2069 7320 6d69 6d69 636b  nce it is mimick
-0001b050: 696e 6720 7468 650a 2020 2020 2020 2020  ing the.        
-0001b060: 2320 6669 6c65 2062 6569 6e67 2070 6173  # file being pas
-0001b070: 7365 6420 6469 7265 6374 6c79 2e20 5468  sed directly. Th
-0001b080: 6973 2069 7320 7468 6520 7361 6d65 2061  is is the same a
-0001b090: 730a 2020 2020 2020 2020 2320 7465 7374  s.        # test
-0001b0a0: 5f65 7863 6c75 6465 5f66 6f72 5f69 7373  _exclude_for_iss
-0001b0b0: 7565 5f31 3537 320a 2020 2020 2020 2020  ue_1572.        
-0001b0c0: 7061 7468 203d 2044 4154 415f 4449 5220  path = DATA_DIR 
-0001b0d0: 2f20 2269 6e63 6c75 6465 5f65 7863 6c75  / "include_exclu
-0001b0e0: 6465 5f74 6573 7473 220a 2020 2020 2020  de_tests".      
-0001b0f0: 2020 7372 6320 3d20 5b22 2d22 5d0a 2020    src = ["-"].  
-0001b100: 2020 2020 2020 7374 6469 6e5f 6669 6c65        stdin_file
-0001b110: 6e61 6d65 203d 2073 7472 2870 6174 6820  name = str(path 
-0001b120: 2f20 2262 2f65 7863 6c75 6465 2f61 2e70  / "b/exclude/a.p
-0001b130: 7922 290a 2020 2020 2020 2020 6578 7065  y").        expe
-0001b140: 6374 6564 203d 205b 6622 5f5f 424c 4143  cted = [f"__BLAC
-0001b150: 4b5f 5354 4449 4e5f 4649 4c45 4e41 4d45  K_STDIN_FILENAME
-0001b160: 5f5f 7b73 7464 696e 5f66 696c 656e 616d  __{stdin_filenam
-0001b170: 657d 225d 0a20 2020 2020 2020 2061 7373  e}"].        ass
-0001b180: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
-0001b190: 7572 6365 7328 0a20 2020 2020 2020 2020  urces(.         
-0001b1a0: 2020 2073 7263 2c0a 2020 2020 2020 2020     src,.        
-0001b1b0: 2020 2020 726f 6f74 3d54 4849 535f 4449      root=THIS_DI
-0001b1c0: 522e 7265 736f 6c76 6528 292c 0a20 2020  R.resolve(),.   
-0001b1d0: 2020 2020 2020 2020 2065 7870 6563 7465           expecte
-0001b1e0: 643d 6578 7065 6374 6564 2c0a 2020 2020  d=expected,.    
-0001b1f0: 2020 2020 2020 2020 6578 636c 7564 653d          exclude=
-0001b200: 7222 2f65 7863 6c75 6465 2f7c 615c 2e70  r"/exclude/|a\.p
-0001b210: 7922 2c0a 2020 2020 2020 2020 2020 2020  y",.            
-0001b220: 7374 6469 6e5f 6669 6c65 6e61 6d65 3d73  stdin_filename=s
-0001b230: 7464 696e 5f66 696c 656e 616d 652c 0a20  tdin_filename,. 
-0001b240: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0001b250: 6620 7465 7374 5f67 6574 5f73 6f75 7263  f test_get_sourc
-0001b260: 6573 5f77 6974 685f 7374 6469 6e5f 6669  es_with_stdin_fi
-0001b270: 6c65 6e61 6d65 5f61 6e64 5f65 7874 656e  lename_and_exten
-0001b280: 645f 6578 636c 7564 6528 7365 6c66 2920  d_exclude(self) 
-0001b290: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0001b2a0: 2023 2045 7874 656e 6420 6578 636c 7564   # Extend exclud
-0001b2b0: 6520 7368 6f75 6c64 6e27 7420 6578 636c  e shouldn't excl
-0001b2c0: 7564 6520 7374 6469 6e5f 6669 6c65 6e61  ude stdin_filena
-0001b2d0: 6d65 2073 696e 6365 2069 7420 6973 206d  me since it is m
-0001b2e0: 696d 6963 6b69 6e67 2074 6865 0a20 2020  imicking the.   
-0001b2f0: 2020 2020 2023 2066 696c 6520 6265 696e       # file bein
-0001b300: 6720 7061 7373 6564 2064 6972 6563 746c  g passed directl
-0001b310: 792e 2054 6869 7320 6973 2074 6865 2073  y. This is the s
-0001b320: 616d 6520 6173 0a20 2020 2020 2020 2023  ame as.        #
-0001b330: 2074 6573 745f 6578 636c 7564 655f 666f   test_exclude_fo
-0001b340: 725f 6973 7375 655f 3135 3732 0a20 2020  r_issue_1572.   
-0001b350: 2020 2020 2073 7263 203d 205b 222d 225d       src = ["-"]
-0001b360: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-0001b370: 5448 4953 5f44 4952 202f 2022 6461 7461  THIS_DIR / "data
-0001b380: 2220 2f20 2269 6e63 6c75 6465 5f65 7863  " / "include_exc
-0001b390: 6c75 6465 5f74 6573 7473 220a 2020 2020  lude_tests".    
-0001b3a0: 2020 2020 7374 6469 6e5f 6669 6c65 6e61      stdin_filena
-0001b3b0: 6d65 203d 2073 7472 2870 6174 6820 2f20  me = str(path / 
-0001b3c0: 2262 2f65 7863 6c75 6465 2f61 2e70 7922  "b/exclude/a.py"
-0001b3d0: 290a 2020 2020 2020 2020 6578 7065 6374  ).        expect
-0001b3e0: 6564 203d 205b 6622 5f5f 424c 4143 4b5f  ed = [f"__BLACK_
-0001b3f0: 5354 4449 4e5f 4649 4c45 4e41 4d45 5f5f  STDIN_FILENAME__
-0001b400: 7b73 7464 696e 5f66 696c 656e 616d 657d  {stdin_filename}
-0001b410: 225d 0a20 2020 2020 2020 2061 7373 6572  "].        asser
-0001b420: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
-0001b430: 6365 7328 0a20 2020 2020 2020 2020 2020  ces(.           
-0001b440: 2073 7263 2c0a 2020 2020 2020 2020 2020   src,.          
-0001b450: 2020 726f 6f74 3d54 4849 535f 4449 522e    root=THIS_DIR.
-0001b460: 7265 736f 6c76 6528 292c 0a20 2020 2020  resolve(),.     
-0001b470: 2020 2020 2020 2065 7870 6563 7465 643d         expected=
-0001b480: 6578 7065 6374 6564 2c0a 2020 2020 2020  expected,.      
-0001b490: 2020 2020 2020 6578 7465 6e64 5f65 7863        extend_exc
-0001b4a0: 6c75 6465 3d72 222f 6578 636c 7564 652f  lude=r"/exclude/
-0001b4b0: 7c61 5c2e 7079 222c 0a20 2020 2020 2020  |a\.py",.       
-0001b4c0: 2020 2020 2073 7464 696e 5f66 696c 656e       stdin_filen
-0001b4d0: 616d 653d 7374 6469 6e5f 6669 6c65 6e61  ame=stdin_filena
-0001b4e0: 6d65 2c0a 2020 2020 2020 2020 290a 0a20  me,.        ).. 
-0001b4f0: 2020 2064 6566 2074 6573 745f 6765 745f     def test_get_
-0001b500: 736f 7572 6365 735f 7769 7468 5f73 7464  sources_with_std
-0001b510: 696e 5f66 696c 656e 616d 655f 616e 645f  in_filename_and_
-0001b520: 666f 7263 655f 6578 636c 7564 6528 7365  force_exclude(se
-0001b530: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-0001b540: 2020 2020 2023 2046 6f72 6365 2065 7863       # Force exc
-0001b550: 6c75 6465 2073 686f 756c 6420 6578 636c  lude should excl
-0001b560: 7564 6520 7468 6520 6669 6c65 2077 6865  ude the file whe
-0001b570: 6e20 7061 7373 696e 6720 6974 2074 6872  n passing it thr
-0001b580: 6f75 6768 0a20 2020 2020 2020 2023 2073  ough.        # s
-0001b590: 7464 696e 5f66 696c 656e 616d 650a 2020  tdin_filename.  
-0001b5a0: 2020 2020 2020 7061 7468 203d 2054 4849        path = THI
-0001b5b0: 535f 4449 5220 2f20 2264 6174 6122 202f  S_DIR / "data" /
-0001b5c0: 2022 696e 636c 7564 655f 6578 636c 7564   "include_exclud
-0001b5d0: 655f 7465 7374 7322 0a20 2020 2020 2020  e_tests".       
-0001b5e0: 2073 7464 696e 5f66 696c 656e 616d 6520   stdin_filename 
-0001b5f0: 3d20 7374 7228 7061 7468 202f 2022 622f  = str(path / "b/
-0001b600: 6578 636c 7564 652f 612e 7079 2229 0a20  exclude/a.py"). 
-0001b610: 2020 2020 2020 2061 7373 6572 745f 636f         assert_co
-0001b620: 6c6c 6563 7465 645f 736f 7572 6365 7328  llected_sources(
-0001b630: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
-0001b640: 3d5b 222d 225d 2c0a 2020 2020 2020 2020  =["-"],.        
-0001b650: 2020 2020 726f 6f74 3d54 4849 535f 4449      root=THIS_DI
-0001b660: 522e 7265 736f 6c76 6528 292c 0a20 2020  R.resolve(),.   
-0001b670: 2020 2020 2020 2020 2065 7870 6563 7465           expecte
-0001b680: 643d 5b5d 2c0a 2020 2020 2020 2020 2020  d=[],.          
-0001b690: 2020 666f 7263 655f 6578 636c 7564 653d    force_exclude=
-0001b6a0: 7222 2f65 7863 6c75 6465 2f7c 615c 2e70  r"/exclude/|a\.p
-0001b6b0: 7922 2c0a 2020 2020 2020 2020 2020 2020  y",.            
-0001b6c0: 7374 6469 6e5f 6669 6c65 6e61 6d65 3d73  stdin_filename=s
-0001b6d0: 7464 696e 5f66 696c 656e 616d 652c 0a20  tdin_filename,. 
-0001b6e0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0001b6f0: 6620 7465 7374 5f67 6574 5f73 6f75 7263  f test_get_sourc
-0001b700: 6573 5f77 6974 685f 7374 6469 6e5f 6669  es_with_stdin_fi
-0001b710: 6c65 6e61 6d65 5f61 6e64 5f66 6f72 6365  lename_and_force
-0001b720: 5f65 7863 6c75 6465 5f61 6e64 5f73 796d  _exclude_and_sym
-0001b730: 6c69 6e6b 280a 2020 2020 2020 2020 7365  link(.        se
-0001b740: 6c66 2c0a 2020 2020 2920 2d3e 204e 6f6e  lf,.    ) -> Non
-0001b750: 653a 0a20 2020 2020 2020 2023 2046 6f72  e:.        # For
-0001b760: 6365 2065 7863 6c75 6465 2073 686f 756c  ce exclude shoul
-0001b770: 6420 6578 636c 7564 6520 6120 7379 6d6c  d exclude a syml
-0001b780: 696e 6b20 6261 7365 6420 6f6e 2074 6865  ink based on the
-0001b790: 2073 796d 6c69 6e6b 2c20 6e6f 7420 6974   symlink, not it
-0001b7a0: 7320 7461 7267 6574 0a20 2020 2020 2020  s target.       
-0001b7b0: 2077 6974 6820 5465 6d70 6f72 6172 7944   with TemporaryD
-0001b7c0: 6972 6563 746f 7279 2829 2061 7320 7465  irectory() as te
-0001b7d0: 6d70 6469 723a 0a20 2020 2020 2020 2020  mpdir:.         
-0001b7e0: 2020 2074 6d70 203d 2050 6174 6828 7465     tmp = Path(te
-0001b7f0: 6d70 6469 7229 2e72 6573 6f6c 7665 2829  mpdir).resolve()
-0001b800: 0a20 2020 2020 2020 2020 2020 2028 746d  .            (tm
-0001b810: 7020 2f20 2265 7863 6c75 6465 2229 2e6d  p / "exclude").m
-0001b820: 6b64 6972 2829 0a20 2020 2020 2020 2020  kdir().         
-0001b830: 2020 2028 746d 7020 2f20 2265 7863 6c75     (tmp / "exclu
-0001b840: 6465 2220 2f20 2261 2e70 7922 292e 7772  de" / "a.py").wr
-0001b850: 6974 655f 7465 7874 2822 7072 696e 7428  ite_text("print(
-0001b860: 2768 656c 6c6f 2729 222c 2065 6e63 6f64  'hello')", encod
-0001b870: 696e 673d 2275 7466 2d38 2229 0a20 2020  ing="utf-8").   
-0001b880: 2020 2020 2020 2020 2028 746d 7020 2f20           (tmp / 
-0001b890: 2273 796d 6c69 6e6b 2e70 7922 292e 7379  "symlink.py").sy
-0001b8a0: 6d6c 696e 6b5f 746f 2874 6d70 202f 2022  mlink_to(tmp / "
-0001b8b0: 6578 636c 7564 6522 202f 2022 612e 7079  exclude" / "a.py
-0001b8c0: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
-0001b8d0: 7374 6469 6e5f 6669 6c65 6e61 6d65 203d  stdin_filename =
-0001b8e0: 2073 7472 2874 6d70 202f 2022 7379 6d6c   str(tmp / "syml
-0001b8f0: 696e 6b2e 7079 2229 0a20 2020 2020 2020  ink.py").       
-0001b900: 2020 2020 2065 7870 6563 7465 6420 3d20       expected = 
-0001b910: 5b66 225f 5f42 4c41 434b 5f53 5444 494e  [f"__BLACK_STDIN
-0001b920: 5f46 494c 454e 414d 455f 5f7b 7374 6469  _FILENAME__{stdi
-0001b930: 6e5f 6669 6c65 6e61 6d65 7d22 5d0a 2020  n_filename}"].  
-0001b940: 2020 2020 2020 2020 2020 7769 7468 2063            with c
-0001b950: 6861 6e67 655f 6469 7265 6374 6f72 7928  hange_directory(
-0001b960: 746d 7029 3a0a 2020 2020 2020 2020 2020  tmp):.          
-0001b970: 2020 2020 2020 6173 7365 7274 5f63 6f6c        assert_col
-0001b980: 6c65 6374 6564 5f73 6f75 7263 6573 280a  lected_sources(.
-0001b990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9a0: 2020 2020 7372 633d 5b22 2d22 5d2c 0a20      src=["-"],. 
-0001b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9c0: 2020 2072 6f6f 743d 746d 702c 0a20 2020     root=tmp,.   
-0001b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9e0: 2065 7870 6563 7465 643d 6578 7065 6374   expected=expect
-0001b9f0: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
-0001ba00: 2020 2020 2020 2020 666f 7263 655f 6578          force_ex
-0001ba10: 636c 7564 653d 7222 6578 636c 7564 652f  clude=r"exclude/
-0001ba20: 615c 2e70 7922 2c0a 2020 2020 2020 2020  a\.py",.        
-0001ba30: 2020 2020 2020 2020 2020 2020 7374 6469              stdi
-0001ba40: 6e5f 6669 6c65 6e61 6d65 3d73 7464 696e  n_filename=stdin
-0001ba50: 5f66 696c 656e 616d 652c 0a20 2020 2020  _filename,.     
-0001ba60: 2020 2020 2020 2020 2020 2029 0a0a 0a63             )...c
-0001ba70: 6c61 7373 2054 6573 7444 6546 6163 746f  lass TestDeFacto
-0001ba80: 4150 493a 0a20 2020 2022 2222 5465 7374  API:.    """Test
-0001ba90: 2074 6861 7420 6365 7274 6169 6e20 7379   that certain sy
-0001baa0: 6d62 6f6c 7320 7468 6174 2061 7265 2063  mbols that are c
-0001bab0: 6f6d 6d6f 6e6c 7920 7573 6564 2065 7874  ommonly used ext
-0001bac0: 6572 6e61 6c6c 7920 6b65 6570 2077 6f72  ernally keep wor
-0001bad0: 6b69 6e67 2e0a 0a20 2020 2057 6520 646f  king...    We do
-0001bae0: 6e27 7420 2879 6574 2920 666f 726d 616c  n't (yet) formal
-0001baf0: 6c79 2065 7870 6f73 6520 616e 2041 5049  ly expose an API
-0001bb00: 2028 7365 6520 6973 7375 6520 2337 3739   (see issue #779
-0001bb10: 292c 2062 7574 2077 6520 7368 6f75 6c64  ), but we should
-0001bb20: 2065 6e64 6561 766f 7220 746f 0a20 2020   endeavor to.   
-0001bb30: 206b 6565 7020 6365 7274 6169 6e20 6675   keep certain fu
-0001bb40: 6e63 7469 6f6e 7320 7468 6174 2065 7874  nctions that ext
-0001bb50: 6572 6e61 6c20 7573 6572 7320 636f 6d6d  ernal users comm
-0001bb60: 6f6e 6c79 2072 656c 7920 6f6e 2077 6f72  only rely on wor
-0001bb70: 6b69 6e67 2e0a 0a20 2020 2022 2222 0a0a  king...    """..
-0001bb80: 2020 2020 6465 6620 7465 7374 5f66 6f72      def test_for
-0001bb90: 6d61 745f 7374 7228 7365 6c66 2920 2d3e  mat_str(self) ->
-0001bba0: 204e 6f6e 653a 0a20 2020 2020 2020 2023   None:.        #
-0001bbb0: 2066 6f72 6d61 745f 7374 7220 616e 6420   format_str and 
-0001bbc0: 4d6f 6465 2073 686f 756c 6420 6b65 6570  Mode should keep
-0001bbd0: 2077 6f72 6b69 6e67 0a20 2020 2020 2020   working.       
-0001bbe0: 2061 7373 6572 7420 280a 2020 2020 2020   assert (.      
-0001bbf0: 2020 2020 2020 626c 6163 6b2e 666f 726d        black.form
-0001bc00: 6174 5f73 7472 2822 7072 696e 7428 2768  at_str("print('h
-0001bc10: 656c 6c6f 2729 222c 206d 6f64 653d 626c  ello')", mode=bl
-0001bc20: 6163 6b2e 4d6f 6465 2829 2920 3d3d 2027  ack.Mode()) == '
-0001bc30: 7072 696e 7428 2268 656c 6c6f 2229 5c6e  print("hello")\n
-0001bc40: 270a 2020 2020 2020 2020 290a 0a20 2020  '.        )..   
-0001bc50: 2020 2020 2023 2079 6f75 2063 616e 2070       # you can p
-0001bc60: 6173 7320 6c69 6e65 206c 656e 6774 680a  ass line length.
-0001bc70: 2020 2020 2020 2020 6173 7365 7274 2028          assert (
-0001bc80: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
-0001bc90: 636b 2e66 6f72 6d61 745f 7374 7228 2270  ck.format_str("p
-0001bca0: 7269 6e74 2827 6865 6c6c 6f27 2922 2c20  rint('hello')", 
-0001bcb0: 6d6f 6465 3d62 6c61 636b 2e4d 6f64 6528  mode=black.Mode(
-0001bcc0: 6c69 6e65 5f6c 656e 6774 683d 3432 2929  line_length=42))
-0001bcd0: 0a20 2020 2020 2020 2020 2020 203d 3d20  .            == 
-0001bce0: 2770 7269 6e74 2822 6865 6c6c 6f22 295c  'print("hello")\
-0001bcf0: 6e27 0a20 2020 2020 2020 2029 0a0a 2020  n'.        )..  
-0001bd00: 2020 2020 2020 2320 696e 7661 6c69 6420        # invalid 
-0001bd10: 696e 7075 7420 7261 6973 6573 2049 6e76  input raises Inv
-0001bd20: 616c 6964 496e 7075 740a 2020 2020 2020  alidInput.      
-0001bd30: 2020 7769 7468 2070 7974 6573 742e 7261    with pytest.ra
-0001bd40: 6973 6573 2862 6c61 636b 2e49 6e76 616c  ises(black.Inval
-0001bd50: 6964 496e 7075 7429 3a0a 2020 2020 2020  idInput):.      
-0001bd60: 2020 2020 2020 626c 6163 6b2e 666f 726d        black.form
-0001bd70: 6174 5f73 7472 2822 7379 6e74 6178 2065  at_str("syntax e
-0001bd80: 7272 6f72 222c 206d 6f64 653d 626c 6163  rror", mode=blac
-0001bd90: 6b2e 4d6f 6465 2829 290a 0a20 2020 2064  k.Mode())..    d
-0001bda0: 6566 2074 6573 745f 666f 726d 6174 5f66  ef test_format_f
-0001bdb0: 696c 655f 636f 6e74 656e 7473 2873 656c  ile_contents(sel
-0001bdc0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0001bdd0: 2020 2020 2320 596f 7520 7072 6f62 6162      # You probab
-0001bde0: 6c79 2073 686f 756c 6420 6265 2075 7369  ly should be usi
-0001bdf0: 6e67 2066 6f72 6d61 745f 7374 7228 2920  ng format_str() 
-0001be00: 696e 7374 6561 642c 2062 7574 206c 6574  instead, but let
-0001be10: 2773 206b 6565 700a 2020 2020 2020 2020  's keep.        
-0001be20: 2320 7468 6973 206f 6e65 2061 726f 756e  # this one aroun
-0001be30: 6420 7369 6e63 6520 7065 6f70 6c65 2064  d since people d
-0001be40: 6f20 7573 6520 6974 0a20 2020 2020 2020  o use it.       
-0001be50: 2061 7373 6572 7420 280a 2020 2020 2020   assert (.      
-0001be60: 2020 2020 2020 626c 6163 6b2e 666f 726d        black.form
-0001be70: 6174 5f66 696c 655f 636f 6e74 656e 7473  at_file_contents
-0001be80: 2822 783d 3122 2c20 6661 7374 3d54 7275  ("x=1", fast=Tru
-0001be90: 652c 206d 6f64 653d 626c 6163 6b2e 4d6f  e, mode=black.Mo
-0001bea0: 6465 2829 2920 3d3d 2022 7820 3d20 315c  de()) == "x = 1\
-0001beb0: 6e22 0a20 2020 2020 2020 2029 0a0a 2020  n".        )..  
-0001bec0: 2020 2020 2020 7769 7468 2070 7974 6573        with pytes
-0001bed0: 742e 7261 6973 6573 2862 6c61 636b 2e4e  t.raises(black.N
-0001bee0: 6f74 6869 6e67 4368 616e 6765 6429 3a0a  othingChanged):.
-0001bef0: 2020 2020 2020 2020 2020 2020 626c 6163              blac
-0001bf00: 6b2e 666f 726d 6174 5f66 696c 655f 636f  k.format_file_co
-0001bf10: 6e74 656e 7473 2822 7820 3d20 315c 6e22  ntents("x = 1\n"
-0001bf20: 2c20 6661 7374 3d54 7275 652c 206d 6f64  , fast=True, mod
-0001bf30: 653d 626c 6163 6b2e 4d6f 6465 2829 290a  e=black.Mode()).
-0001bf40: 0a0a 636c 6173 7320 5465 7374 4153 5453  ..class TestASTS
-0001bf50: 6166 6574 7928 426c 6163 6b42 6173 6554  afety(BlackBaseT
-0001bf60: 6573 7443 6173 6529 3a0a 2020 2020 6465  estCase):.    de
-0001bf70: 6620 6368 6563 6b5f 6173 745f 6571 7569  f check_ast_equi
-0001bf80: 7661 6c65 6e63 6528 0a20 2020 2020 2020  valence(.       
-0001bf90: 2073 656c 662c 2073 6f75 7263 653a 2073   self, source: s
-0001bfa0: 7472 2c20 6465 7374 3a20 7374 722c 202a  tr, dest: str, *
-0001bfb0: 2c20 7368 6f75 6c64 5f66 6169 6c3a 2062  , should_fail: b
-0001bfc0: 6f6f 6c20 3d20 4661 6c73 650a 2020 2020  ool = False.    
-0001bfd0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0001bfe0: 2020 2023 2049 6620 7765 2067 6574 2061     # If we get a
-0001bff0: 2066 6169 6c75 7265 2c20 6d61 6b65 2073   failure, make s
-0001c000: 7572 6520 6974 2773 206e 6f74 2062 6563  ure it's not bec
-0001c010: 6175 7365 2074 6865 2063 6f64 6520 6974  ause the code it
-0001c020: 7365 6c66 0a20 2020 2020 2020 2023 2069  self.        # i
-0001c030: 7320 696e 7661 6c69 642c 2073 696e 6365  s invalid, since
-0001c040: 2074 6861 7420 7769 6c6c 2061 6c73 6f20   that will also 
-0001c050: 6361 7573 6520 6173 7365 7274 5f65 7175  cause assert_equ
-0001c060: 6976 616c 656e 7428 2920 746f 2074 6872  ivalent() to thr
-0001c070: 6f77 0a20 2020 2020 2020 2023 2041 5354  ow.        # AST
-0001c080: 5361 6665 7479 4572 726f 722e 0a20 2020  SafetyError..   
-0001c090: 2020 2020 2073 6f75 7263 6520 3d20 7465       source = te
-0001c0a0: 7874 7772 6170 2e64 6564 656e 7428 736f  xtwrap.dedent(so
-0001c0b0: 7572 6365 290a 2020 2020 2020 2020 6465  urce).        de
-0001c0c0: 7374 203d 2074 6578 7477 7261 702e 6465  st = textwrap.de
-0001c0d0: 6465 6e74 2864 6573 7429 0a20 2020 2020  dent(dest).     
-0001c0e0: 2020 2062 6c61 636b 2e70 6172 7365 5f61     black.parse_a
-0001c0f0: 7374 2873 6f75 7263 6529 0a20 2020 2020  st(source).     
-0001c100: 2020 2062 6c61 636b 2e70 6172 7365 5f61     black.parse_a
-0001c110: 7374 2864 6573 7429 0a20 2020 2020 2020  st(dest).       
-0001c120: 2069 6620 7368 6f75 6c64 5f66 6169 6c3a   if should_fail:
-0001c130: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-0001c140: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
-0001c150: 7365 7328 4153 5453 6166 6574 7945 7272  ses(ASTSafetyErr
-0001c160: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-0001c170: 2020 2020 2062 6c61 636b 2e61 7373 6572       black.asser
-0001c180: 745f 6571 7569 7661 6c65 6e74 2873 6f75  t_equivalent(sou
-0001c190: 7263 652c 2064 6573 7429 0a20 2020 2020  rce, dest).     
-0001c1a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001c1b0: 2020 2020 2062 6c61 636b 2e61 7373 6572       black.asser
-0001c1c0: 745f 6571 7569 7661 6c65 6e74 2873 6f75  t_equivalent(sou
-0001c1d0: 7263 652c 2064 6573 7429 0a0a 2020 2020  rce, dest)..    
-0001c1e0: 6465 6620 7465 7374 5f61 7373 6572 745f  def test_assert_
-0001c1f0: 6571 7569 7661 6c65 6e74 5f62 6173 6963  equivalent_basic
-0001c200: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0001c210: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-0001c220: 636b 5f61 7374 5f65 7175 6976 616c 656e  ck_ast_equivalen
-0001c230: 6365 2822 7b7d 222c 2022 4e6f 6e65 222c  ce("{}", "None",
-0001c240: 2073 686f 756c 645f 6661 696c 3d54 7275   should_fail=Tru
-0001c250: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
-0001c260: 6368 6563 6b5f 6173 745f 6571 7569 7661  check_ast_equiva
-0001c270: 6c65 6e63 6528 2231 2b32 222c 2022 3120  lence("1+2", "1 
-0001c280: 2020 202b 2020 2032 2229 0a20 2020 2020     +   2").     
-0001c290: 2020 2073 656c 662e 6368 6563 6b5f 6173     self.check_as
-0001c2a0: 745f 6571 7569 7661 6c65 6e63 6528 2268  t_equivalence("h
-0001c2b0: 6920 2320 636f 6d6d 656e 7422 2c20 2268  i # comment", "h
-0001c2c0: 6922 290a 0a20 2020 2064 6566 2074 6573  i")..    def tes
-0001c2d0: 745f 6173 7365 7274 5f65 7175 6976 616c  t_assert_equival
-0001c2e0: 656e 745f 6465 6c28 7365 6c66 2920 2d3e  ent_del(self) ->
-0001c2f0: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+0001a880: 6422 202f 2022 616e 6f74 6865 722e 7079  d" / "another.py
+0001a890: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+0001a8a0: 2020 2020 290a 0a20 2020 2064 6566 2074      )..    def t
+0001a8b0: 6573 745f 6765 745f 736f 7572 6365 735f  est_get_sources_
+0001a8c0: 7769 7468 5f73 7464 696e 5f73 796d 6c69  with_stdin_symli
+0001a8d0: 6e6b 5f6f 7574 7369 6465 5f72 6f6f 7428  nk_outside_root(
+0001a8e0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+0001a8f0: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
+0001a900: 2020 2020 2020 7769 7468 2054 656d 706f        with Tempo
+0001a910: 7261 7279 4469 7265 6374 6f72 7928 2920  raryDirectory() 
+0001a920: 6173 2074 656d 7064 6972 3a0a 2020 2020  as tempdir:.    
+0001a930: 2020 2020 2020 2020 746d 7020 3d20 5061          tmp = Pa
+0001a940: 7468 2874 656d 7064 6972 292e 7265 736f  th(tempdir).reso
+0001a950: 6c76 6528 290a 0a20 2020 2020 2020 2020  lve()..         
+0001a960: 2020 2072 6f6f 7420 3d20 746d 7020 2f20     root = tmp / 
+0001a970: 2272 6f6f 7422 0a20 2020 2020 2020 2020  "root".         
+0001a980: 2020 2072 6f6f 742e 6d6b 6469 7228 290a     root.mkdir().
+0001a990: 2020 2020 2020 2020 2020 2020 2872 6f6f              (roo
+0001a9a0: 7420 2f20 2270 7970 726f 6a65 6374 2e74  t / "pyproject.t
+0001a9b0: 6f6d 6c22 292e 7772 6974 655f 7465 7874  oml").write_text
+0001a9c0: 2822 5b74 6f6f 6c2e 626c 6163 6b5d 222c  ("[tool.black]",
+0001a9d0: 2065 6e63 6f64 696e 673d 2275 7466 2d38   encoding="utf-8
+0001a9e0: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+0001a9f0: 7461 7267 6574 203d 2074 6d70 202f 2022  target = tmp / "
+0001aa00: 6f75 7473 6964 655f 726f 6f74 2220 2f20  outside_root" / 
+0001aa10: 2261 2e70 7922 0a20 2020 2020 2020 2020  "a.py".         
+0001aa20: 2020 2074 6172 6765 742e 7061 7265 6e74     target.parent
+0001aa30: 2e6d 6b64 6972 2829 0a20 2020 2020 2020  .mkdir().       
+0001aa40: 2020 2020 2074 6172 6765 742e 7772 6974       target.writ
+0001aa50: 655f 7465 7874 2822 7072 696e 7428 2768  e_text("print('h
+0001aa60: 656c 6c6f 2729 222c 2065 6e63 6f64 696e  ello')", encodin
+0001aa70: 673d 2275 7466 2d38 2229 0a20 2020 2020  g="utf-8").     
+0001aa80: 2020 2020 2020 2028 726f 6f74 202f 2022         (root / "
+0001aa90: 612e 7079 2229 2e73 796d 6c69 6e6b 5f74  a.py").symlink_t
+0001aaa0: 6f28 7461 7267 6574 290a 0a20 2020 2020  o(target)..     
+0001aab0: 2020 2020 2020 2073 7464 696e 5f66 696c         stdin_fil
+0001aac0: 656e 616d 6520 3d20 7374 7228 726f 6f74  ename = str(root
+0001aad0: 202f 2022 612e 7079 2229 0a20 2020 2020   / "a.py").     
+0001aae0: 2020 2020 2020 2061 7373 6572 745f 636f         assert_co
+0001aaf0: 6c6c 6563 7465 645f 736f 7572 6365 7328  llected_sources(
+0001ab00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ab10: 2072 6f6f 743d 726f 6f74 2c0a 2020 2020   root=root,.    
+0001ab20: 2020 2020 2020 2020 2020 2020 7372 633d              src=
+0001ab30: 5b22 2d22 5d2c 0a20 2020 2020 2020 2020  ["-"],.         
+0001ab40: 2020 2020 2020 2065 7870 6563 7465 643d         expected=
+0001ab50: 5b5d 2c0a 2020 2020 2020 2020 2020 2020  [],.            
+0001ab60: 2020 2020 7374 6469 6e5f 6669 6c65 6e61      stdin_filena
+0001ab70: 6d65 3d73 7464 696e 5f66 696c 656e 616d  me=stdin_filenam
+0001ab80: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
+0001ab90: 0a0a 2020 2020 6465 6620 7465 7374 5f67  ..    def test_g
+0001aba0: 6574 5f73 6f75 7263 6573 5f77 6974 685f  et_sources_with_
+0001abb0: 7374 6469 6e28 7365 6c66 2920 2d3e 204e  stdin(self) -> N
+0001abc0: 6f6e 653a 0a20 2020 2020 2020 2073 7263  one:.        src
+0001abd0: 203d 205b 222d 225d 0a20 2020 2020 2020   = ["-"].       
+0001abe0: 2065 7870 6563 7465 6420 3d20 5b22 2d22   expected = ["-"
+0001abf0: 5d0a 2020 2020 2020 2020 6173 7365 7274  ].        assert
+0001ac00: 5f63 6f6c 6c65 6374 6564 5f73 6f75 7263  _collected_sourc
+0001ac10: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+0001ac20: 7372 632c 0a20 2020 2020 2020 2020 2020  src,.           
+0001ac30: 2072 6f6f 743d 5448 4953 5f44 4952 2e72   root=THIS_DIR.r
+0001ac40: 6573 6f6c 7665 2829 2c0a 2020 2020 2020  esolve(),.      
+0001ac50: 2020 2020 2020 6578 7065 6374 6564 3d65        expected=e
+0001ac60: 7870 6563 7465 642c 0a20 2020 2020 2020  xpected,.       
+0001ac70: 2020 2020 2069 6e63 6c75 6465 3d22 222c       include="",
+0001ac80: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+0001ac90: 6c75 6465 3d72 222f 6578 636c 7564 652f  lude=r"/exclude/
+0001aca0: 7c61 5c2e 7079 222c 0a20 2020 2020 2020  |a\.py",.       
+0001acb0: 2029 0a0a 2020 2020 6465 6620 7465 7374   )..    def test
+0001acc0: 5f67 6574 5f73 6f75 7263 6573 5f77 6974  _get_sources_wit
+0001acd0: 685f 7374 6469 6e5f 6669 6c65 6e61 6d65  h_stdin_filename
+0001ace0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0001acf0: 2020 2020 2020 2020 7372 6320 3d20 5b22          src = ["
+0001ad00: 2d22 5d0a 2020 2020 2020 2020 7374 6469  -"].        stdi
+0001ad10: 6e5f 6669 6c65 6e61 6d65 203d 2073 7472  n_filename = str
+0001ad20: 2854 4849 535f 4449 5220 2f20 2264 6174  (THIS_DIR / "dat
+0001ad30: 612f 636f 6c6c 6563 7469 6f6e 732e 7079  a/collections.py
+0001ad40: 2229 0a20 2020 2020 2020 2065 7870 6563  ").        expec
+0001ad50: 7465 6420 3d20 5b66 225f 5f42 4c41 434b  ted = [f"__BLACK
+0001ad60: 5f53 5444 494e 5f46 494c 454e 414d 455f  _STDIN_FILENAME_
+0001ad70: 5f7b 7374 6469 6e5f 6669 6c65 6e61 6d65  _{stdin_filename
+0001ad80: 7d22 5d0a 2020 2020 2020 2020 6173 7365  }"].        asse
+0001ad90: 7274 5f63 6f6c 6c65 6374 6564 5f73 6f75  rt_collected_sou
+0001ada0: 7263 6573 280a 2020 2020 2020 2020 2020  rces(.          
+0001adb0: 2020 7372 632c 0a20 2020 2020 2020 2020    src,.         
+0001adc0: 2020 2072 6f6f 743d 5448 4953 5f44 4952     root=THIS_DIR
+0001add0: 2e72 6573 6f6c 7665 2829 2c0a 2020 2020  .resolve(),.    
+0001ade0: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+0001adf0: 3d65 7870 6563 7465 642c 0a20 2020 2020  =expected,.     
+0001ae00: 2020 2020 2020 2065 7863 6c75 6465 3d72         exclude=r
+0001ae10: 222f 6578 636c 7564 652f 615c 2e70 7922  "/exclude/a\.py"
+0001ae20: 2c0a 2020 2020 2020 2020 2020 2020 7374  ,.            st
+0001ae30: 6469 6e5f 6669 6c65 6e61 6d65 3d73 7464  din_filename=std
+0001ae40: 696e 5f66 696c 656e 616d 652c 0a20 2020  in_filename,.   
+0001ae50: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+0001ae60: 7465 7374 5f67 6574 5f73 6f75 7263 6573  test_get_sources
+0001ae70: 5f77 6974 685f 7374 6469 6e5f 6669 6c65  _with_stdin_file
+0001ae80: 6e61 6d65 5f61 6e64 5f65 7863 6c75 6465  name_and_exclude
+0001ae90: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0001aea0: 2020 2020 2020 2020 2320 4578 636c 7564          # Exclud
+0001aeb0: 6520 7368 6f75 6c64 6e27 7420 6578 636c  e shouldn't excl
+0001aec0: 7564 6520 7374 6469 6e5f 6669 6c65 6e61  ude stdin_filena
+0001aed0: 6d65 2073 696e 6365 2069 7420 6973 206d  me since it is m
+0001aee0: 696d 6963 6b69 6e67 2074 6865 0a20 2020  imicking the.   
+0001aef0: 2020 2020 2023 2066 696c 6520 6265 696e       # file bein
+0001af00: 6720 7061 7373 6564 2064 6972 6563 746c  g passed directl
+0001af10: 792e 2054 6869 7320 6973 2074 6865 2073  y. This is the s
+0001af20: 616d 6520 6173 0a20 2020 2020 2020 2023  ame as.        #
+0001af30: 2074 6573 745f 6578 636c 7564 655f 666f   test_exclude_fo
+0001af40: 725f 6973 7375 655f 3135 3732 0a20 2020  r_issue_1572.   
+0001af50: 2020 2020 2070 6174 6820 3d20 4441 5441       path = DATA
+0001af60: 5f44 4952 202f 2022 696e 636c 7564 655f  _DIR / "include_
+0001af70: 6578 636c 7564 655f 7465 7374 7322 0a20  exclude_tests". 
+0001af80: 2020 2020 2020 2073 7263 203d 205b 222d         src = ["-
+0001af90: 225d 0a20 2020 2020 2020 2073 7464 696e  "].        stdin
+0001afa0: 5f66 696c 656e 616d 6520 3d20 7374 7228  _filename = str(
+0001afb0: 7061 7468 202f 2022 622f 6578 636c 7564  path / "b/exclud
+0001afc0: 652f 612e 7079 2229 0a20 2020 2020 2020  e/a.py").       
+0001afd0: 2065 7870 6563 7465 6420 3d20 5b66 225f   expected = [f"_
+0001afe0: 5f42 4c41 434b 5f53 5444 494e 5f46 494c  _BLACK_STDIN_FIL
+0001aff0: 454e 414d 455f 5f7b 7374 6469 6e5f 6669  ENAME__{stdin_fi
+0001b000: 6c65 6e61 6d65 7d22 5d0a 2020 2020 2020  lename}"].      
+0001b010: 2020 6173 7365 7274 5f63 6f6c 6c65 6374    assert_collect
+0001b020: 6564 5f73 6f75 7263 6573 280a 2020 2020  ed_sources(.    
+0001b030: 2020 2020 2020 2020 7372 632c 0a20 2020          src,.   
+0001b040: 2020 2020 2020 2020 2072 6f6f 743d 5448           root=TH
+0001b050: 4953 5f44 4952 2e72 6573 6f6c 7665 2829  IS_DIR.resolve()
+0001b060: 2c0a 2020 2020 2020 2020 2020 2020 6578  ,.            ex
+0001b070: 7065 6374 6564 3d65 7870 6563 7465 642c  pected=expected,
+0001b080: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+0001b090: 6c75 6465 3d72 222f 6578 636c 7564 652f  lude=r"/exclude/
+0001b0a0: 7c61 5c2e 7079 222c 0a20 2020 2020 2020  |a\.py",.       
+0001b0b0: 2020 2020 2073 7464 696e 5f66 696c 656e       stdin_filen
+0001b0c0: 616d 653d 7374 6469 6e5f 6669 6c65 6e61  ame=stdin_filena
+0001b0d0: 6d65 2c0a 2020 2020 2020 2020 290a 0a20  me,.        ).. 
+0001b0e0: 2020 2064 6566 2074 6573 745f 6765 745f     def test_get_
+0001b0f0: 736f 7572 6365 735f 7769 7468 5f73 7464  sources_with_std
+0001b100: 696e 5f66 696c 656e 616d 655f 616e 645f  in_filename_and_
+0001b110: 6578 7465 6e64 5f65 7863 6c75 6465 2873  extend_exclude(s
+0001b120: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+0001b130: 2020 2020 2020 2320 4578 7465 6e64 2065        # Extend e
+0001b140: 7863 6c75 6465 2073 686f 756c 646e 2774  xclude shouldn't
+0001b150: 2065 7863 6c75 6465 2073 7464 696e 5f66   exclude stdin_f
+0001b160: 696c 656e 616d 6520 7369 6e63 6520 6974  ilename since it
+0001b170: 2069 7320 6d69 6d69 636b 696e 6720 7468   is mimicking th
+0001b180: 650a 2020 2020 2020 2020 2320 6669 6c65  e.        # file
+0001b190: 2062 6569 6e67 2070 6173 7365 6420 6469   being passed di
+0001b1a0: 7265 6374 6c79 2e20 5468 6973 2069 7320  rectly. This is 
+0001b1b0: 7468 6520 7361 6d65 2061 730a 2020 2020  the same as.    
+0001b1c0: 2020 2020 2320 7465 7374 5f65 7863 6c75      # test_exclu
+0001b1d0: 6465 5f66 6f72 5f69 7373 7565 5f31 3537  de_for_issue_157
+0001b1e0: 320a 2020 2020 2020 2020 7372 6320 3d20  2.        src = 
+0001b1f0: 5b22 2d22 5d0a 2020 2020 2020 2020 7061  ["-"].        pa
+0001b200: 7468 203d 2054 4849 535f 4449 5220 2f20  th = THIS_DIR / 
+0001b210: 2264 6174 6122 202f 2022 696e 636c 7564  "data" / "includ
+0001b220: 655f 6578 636c 7564 655f 7465 7374 7322  e_exclude_tests"
+0001b230: 0a20 2020 2020 2020 2073 7464 696e 5f66  .        stdin_f
+0001b240: 696c 656e 616d 6520 3d20 7374 7228 7061  ilename = str(pa
+0001b250: 7468 202f 2022 622f 6578 636c 7564 652f  th / "b/exclude/
+0001b260: 612e 7079 2229 0a20 2020 2020 2020 2065  a.py").        e
+0001b270: 7870 6563 7465 6420 3d20 5b66 225f 5f42  xpected = [f"__B
+0001b280: 4c41 434b 5f53 5444 494e 5f46 494c 454e  LACK_STDIN_FILEN
+0001b290: 414d 455f 5f7b 7374 6469 6e5f 6669 6c65  AME__{stdin_file
+0001b2a0: 6e61 6d65 7d22 5d0a 2020 2020 2020 2020  name}"].        
+0001b2b0: 6173 7365 7274 5f63 6f6c 6c65 6374 6564  assert_collected
+0001b2c0: 5f73 6f75 7263 6573 280a 2020 2020 2020  _sources(.      
+0001b2d0: 2020 2020 2020 7372 632c 0a20 2020 2020        src,.     
+0001b2e0: 2020 2020 2020 2072 6f6f 743d 5448 4953         root=THIS
+0001b2f0: 5f44 4952 2e72 6573 6f6c 7665 2829 2c0a  _DIR.resolve(),.
+0001b300: 2020 2020 2020 2020 2020 2020 6578 7065              expe
+0001b310: 6374 6564 3d65 7870 6563 7465 642c 0a20  cted=expected,. 
+0001b320: 2020 2020 2020 2020 2020 2065 7874 656e             exten
+0001b330: 645f 6578 636c 7564 653d 7222 2f65 7863  d_exclude=r"/exc
+0001b340: 6c75 6465 2f7c 615c 2e70 7922 2c0a 2020  lude/|a\.py",.  
+0001b350: 2020 2020 2020 2020 2020 7374 6469 6e5f            stdin_
+0001b360: 6669 6c65 6e61 6d65 3d73 7464 696e 5f66  filename=stdin_f
+0001b370: 696c 656e 616d 652c 0a20 2020 2020 2020  ilename,.       
+0001b380: 2029 0a0a 2020 2020 6465 6620 7465 7374   )..    def test
+0001b390: 5f67 6574 5f73 6f75 7263 6573 5f77 6974  _get_sources_wit
+0001b3a0: 685f 7374 6469 6e5f 6669 6c65 6e61 6d65  h_stdin_filename
+0001b3b0: 5f61 6e64 5f66 6f72 6365 5f65 7863 6c75  _and_force_exclu
+0001b3c0: 6465 2873 656c 6629 202d 3e20 4e6f 6e65  de(self) -> None
+0001b3d0: 3a0a 2020 2020 2020 2020 2320 466f 7263  :.        # Forc
+0001b3e0: 6520 6578 636c 7564 6520 7368 6f75 6c64  e exclude should
+0001b3f0: 2065 7863 6c75 6465 2074 6865 2066 696c   exclude the fil
+0001b400: 6520 7768 656e 2070 6173 7369 6e67 2069  e when passing i
+0001b410: 7420 7468 726f 7567 680a 2020 2020 2020  t through.      
+0001b420: 2020 2320 7374 6469 6e5f 6669 6c65 6e61    # stdin_filena
+0001b430: 6d65 0a20 2020 2020 2020 2070 6174 6820  me.        path 
+0001b440: 3d20 5448 4953 5f44 4952 202f 2022 6461  = THIS_DIR / "da
+0001b450: 7461 2220 2f20 2269 6e63 6c75 6465 5f65  ta" / "include_e
+0001b460: 7863 6c75 6465 5f74 6573 7473 220a 2020  xclude_tests".  
+0001b470: 2020 2020 2020 7374 6469 6e5f 6669 6c65        stdin_file
+0001b480: 6e61 6d65 203d 2073 7472 2870 6174 6820  name = str(path 
+0001b490: 2f20 2262 2f65 7863 6c75 6465 2f61 2e70  / "b/exclude/a.p
+0001b4a0: 7922 290a 2020 2020 2020 2020 6173 7365  y").        asse
+0001b4b0: 7274 5f63 6f6c 6c65 6374 6564 5f73 6f75  rt_collected_sou
+0001b4c0: 7263 6573 280a 2020 2020 2020 2020 2020  rces(.          
+0001b4d0: 2020 7372 633d 5b22 2d22 5d2c 0a20 2020    src=["-"],.   
+0001b4e0: 2020 2020 2020 2020 2072 6f6f 743d 5448           root=TH
+0001b4f0: 4953 5f44 4952 2e72 6573 6f6c 7665 2829  IS_DIR.resolve()
+0001b500: 2c0a 2020 2020 2020 2020 2020 2020 6578  ,.            ex
+0001b510: 7065 6374 6564 3d5b 5d2c 0a20 2020 2020  pected=[],.     
+0001b520: 2020 2020 2020 2066 6f72 6365 5f65 7863         force_exc
+0001b530: 6c75 6465 3d72 222f 6578 636c 7564 652f  lude=r"/exclude/
+0001b540: 7c61 5c2e 7079 222c 0a20 2020 2020 2020  |a\.py",.       
+0001b550: 2020 2020 2073 7464 696e 5f66 696c 656e       stdin_filen
+0001b560: 616d 653d 7374 6469 6e5f 6669 6c65 6e61  ame=stdin_filena
+0001b570: 6d65 2c0a 2020 2020 2020 2020 290a 0a20  me,.        ).. 
+0001b580: 2020 2064 6566 2074 6573 745f 6765 745f     def test_get_
+0001b590: 736f 7572 6365 735f 7769 7468 5f73 7464  sources_with_std
+0001b5a0: 696e 5f66 696c 656e 616d 655f 616e 645f  in_filename_and_
+0001b5b0: 666f 7263 655f 6578 636c 7564 655f 616e  force_exclude_an
+0001b5c0: 645f 7379 6d6c 696e 6b28 0a20 2020 2020  d_symlink(.     
+0001b5d0: 2020 2073 656c 662c 0a20 2020 2029 202d     self,.    ) -
+0001b5e0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0001b5f0: 2320 466f 7263 6520 6578 636c 7564 6520  # Force exclude 
+0001b600: 7368 6f75 6c64 2065 7863 6c75 6465 2061  should exclude a
+0001b610: 2073 796d 6c69 6e6b 2062 6173 6564 206f   symlink based o
+0001b620: 6e20 7468 6520 7379 6d6c 696e 6b2c 206e  n the symlink, n
+0001b630: 6f74 2069 7473 2074 6172 6765 740a 2020  ot its target.  
+0001b640: 2020 2020 2020 7769 7468 2054 656d 706f        with Tempo
+0001b650: 7261 7279 4469 7265 6374 6f72 7928 2920  raryDirectory() 
+0001b660: 6173 2074 656d 7064 6972 3a0a 2020 2020  as tempdir:.    
+0001b670: 2020 2020 2020 2020 746d 7020 3d20 5061          tmp = Pa
+0001b680: 7468 2874 656d 7064 6972 292e 7265 736f  th(tempdir).reso
+0001b690: 6c76 6528 290a 2020 2020 2020 2020 2020  lve().          
+0001b6a0: 2020 2874 6d70 202f 2022 6578 636c 7564    (tmp / "exclud
+0001b6b0: 6522 292e 6d6b 6469 7228 290a 2020 2020  e").mkdir().    
+0001b6c0: 2020 2020 2020 2020 2874 6d70 202f 2022          (tmp / "
+0001b6d0: 6578 636c 7564 6522 202f 2022 612e 7079  exclude" / "a.py
+0001b6e0: 2229 2e77 7269 7465 5f74 6578 7428 2270  ").write_text("p
+0001b6f0: 7269 6e74 2827 6865 6c6c 6f27 2922 2c20  rint('hello')", 
+0001b700: 656e 636f 6469 6e67 3d22 7574 662d 3822  encoding="utf-8"
+0001b710: 290a 2020 2020 2020 2020 2020 2020 2874  ).            (t
+0001b720: 6d70 202f 2022 7379 6d6c 696e 6b2e 7079  mp / "symlink.py
+0001b730: 2229 2e73 796d 6c69 6e6b 5f74 6f28 746d  ").symlink_to(tm
+0001b740: 7020 2f20 2265 7863 6c75 6465 2220 2f20  p / "exclude" / 
+0001b750: 2261 2e70 7922 290a 0a20 2020 2020 2020  "a.py")..       
+0001b760: 2020 2020 2073 7464 696e 5f66 696c 656e       stdin_filen
+0001b770: 616d 6520 3d20 7374 7228 746d 7020 2f20  ame = str(tmp / 
+0001b780: 2273 796d 6c69 6e6b 2e70 7922 290a 2020  "symlink.py").  
+0001b790: 2020 2020 2020 2020 2020 6578 7065 6374            expect
+0001b7a0: 6564 203d 205b 6622 5f5f 424c 4143 4b5f  ed = [f"__BLACK_
+0001b7b0: 5354 4449 4e5f 4649 4c45 4e41 4d45 5f5f  STDIN_FILENAME__
+0001b7c0: 7b73 7464 696e 5f66 696c 656e 616d 657d  {stdin_filename}
+0001b7d0: 225d 0a20 2020 2020 2020 2020 2020 2077  "].            w
+0001b7e0: 6974 6820 6368 616e 6765 5f64 6972 6563  ith change_direc
+0001b7f0: 746f 7279 2874 6d70 293a 0a20 2020 2020  tory(tmp):.     
+0001b800: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+0001b810: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
+0001b820: 6365 7328 0a20 2020 2020 2020 2020 2020  ces(.           
+0001b830: 2020 2020 2020 2020 2073 7263 3d5b 222d           src=["-
+0001b840: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+0001b850: 2020 2020 2020 2020 726f 6f74 3d74 6d70          root=tmp
+0001b860: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001b870: 2020 2020 2020 6578 7065 6374 6564 3d65        expected=e
+0001b880: 7870 6563 7465 642c 0a20 2020 2020 2020  xpected,.       
+0001b890: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001b8a0: 6365 5f65 7863 6c75 6465 3d72 2265 7863  ce_exclude=r"exc
+0001b8b0: 6c75 6465 2f61 5c2e 7079 222c 0a20 2020  lude/a\.py",.   
+0001b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8d0: 2073 7464 696e 5f66 696c 656e 616d 653d   stdin_filename=
+0001b8e0: 7374 6469 6e5f 6669 6c65 6e61 6d65 2c0a  stdin_filename,.
+0001b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b900: 290a 0a0a 636c 6173 7320 5465 7374 4465  )...class TestDe
+0001b910: 4661 6374 6f41 5049 3a0a 2020 2020 2222  FactoAPI:.    ""
+0001b920: 2254 6573 7420 7468 6174 2063 6572 7461  "Test that certa
+0001b930: 696e 2073 796d 626f 6c73 2074 6861 7420  in symbols that 
+0001b940: 6172 6520 636f 6d6d 6f6e 6c79 2075 7365  are commonly use
+0001b950: 6420 6578 7465 726e 616c 6c79 206b 6565  d externally kee
+0001b960: 7020 776f 726b 696e 672e 0a0a 2020 2020  p working...    
+0001b970: 5765 2064 6f6e 2774 2028 7965 7429 2066  We don't (yet) f
+0001b980: 6f72 6d61 6c6c 7920 6578 706f 7365 2061  ormally expose a
+0001b990: 6e20 4150 4920 2873 6565 2069 7373 7565  n API (see issue
+0001b9a0: 2023 3737 3929 2c20 6275 7420 7765 2073   #779), but we s
+0001b9b0: 686f 756c 6420 656e 6465 6176 6f72 2074  hould endeavor t
+0001b9c0: 6f0a 2020 2020 6b65 6570 2063 6572 7461  o.    keep certa
+0001b9d0: 696e 2066 756e 6374 696f 6e73 2074 6861  in functions tha
+0001b9e0: 7420 6578 7465 726e 616c 2075 7365 7273  t external users
+0001b9f0: 2063 6f6d 6d6f 6e6c 7920 7265 6c79 206f   commonly rely o
+0001ba00: 6e20 776f 726b 696e 672e 0a0a 2020 2020  n working...    
+0001ba10: 2222 220a 0a20 2020 2064 6566 2074 6573  """..    def tes
+0001ba20: 745f 666f 726d 6174 5f73 7472 2873 656c  t_format_str(sel
+0001ba30: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0001ba40: 2020 2020 2320 666f 726d 6174 5f73 7472      # format_str
+0001ba50: 2061 6e64 204d 6f64 6520 7368 6f75 6c64   and Mode should
+0001ba60: 206b 6565 7020 776f 726b 696e 670a 2020   keep working.  
+0001ba70: 2020 2020 2020 6173 7365 7274 2028 0a20        assert (. 
+0001ba80: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+0001ba90: 2e66 6f72 6d61 745f 7374 7228 2270 7269  .format_str("pri
+0001baa0: 6e74 2827 6865 6c6c 6f27 2922 2c20 6d6f  nt('hello')", mo
+0001bab0: 6465 3d62 6c61 636b 2e4d 6f64 6528 2929  de=black.Mode())
+0001bac0: 203d 3d20 2770 7269 6e74 2822 6865 6c6c   == 'print("hell
+0001bad0: 6f22 295c 6e27 0a20 2020 2020 2020 2029  o")\n'.        )
+0001bae0: 0a0a 2020 2020 2020 2020 2320 796f 7520  ..        # you 
+0001baf0: 6361 6e20 7061 7373 206c 696e 6520 6c65  can pass line le
+0001bb00: 6e67 7468 0a20 2020 2020 2020 2061 7373  ngth.        ass
+0001bb10: 6572 7420 280a 2020 2020 2020 2020 2020  ert (.          
+0001bb20: 2020 626c 6163 6b2e 666f 726d 6174 5f73    black.format_s
+0001bb30: 7472 2822 7072 696e 7428 2768 656c 6c6f  tr("print('hello
+0001bb40: 2729 222c 206d 6f64 653d 626c 6163 6b2e  ')", mode=black.
+0001bb50: 4d6f 6465 286c 696e 655f 6c65 6e67 7468  Mode(line_length
+0001bb60: 3d34 3229 290a 2020 2020 2020 2020 2020  =42)).          
+0001bb70: 2020 3d3d 2027 7072 696e 7428 2268 656c    == 'print("hel
+0001bb80: 6c6f 2229 5c6e 270a 2020 2020 2020 2020  lo")\n'.        
+0001bb90: 290a 0a20 2020 2020 2020 2023 2069 6e76  )..        # inv
+0001bba0: 616c 6964 2069 6e70 7574 2072 6169 7365  alid input raise
+0001bbb0: 7320 496e 7661 6c69 6449 6e70 7574 0a20  s InvalidInput. 
+0001bbc0: 2020 2020 2020 2077 6974 6820 7079 7465         with pyte
+0001bbd0: 7374 2e72 6169 7365 7328 626c 6163 6b2e  st.raises(black.
+0001bbe0: 496e 7661 6c69 6449 6e70 7574 293a 0a20  InvalidInput):. 
+0001bbf0: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+0001bc00: 2e66 6f72 6d61 745f 7374 7228 2273 796e  .format_str("syn
+0001bc10: 7461 7820 6572 726f 7222 2c20 6d6f 6465  tax error", mode
+0001bc20: 3d62 6c61 636b 2e4d 6f64 6528 2929 0a0a  =black.Mode())..
+0001bc30: 2020 2020 6465 6620 7465 7374 5f66 6f72      def test_for
+0001bc40: 6d61 745f 6669 6c65 5f63 6f6e 7465 6e74  mat_file_content
+0001bc50: 7328 7365 6c66 2920 2d3e 204e 6f6e 653a  s(self) -> None:
+0001bc60: 0a20 2020 2020 2020 2023 2059 6f75 2070  .        # You p
+0001bc70: 726f 6261 626c 7920 7368 6f75 6c64 2062  robably should b
+0001bc80: 6520 7573 696e 6720 666f 726d 6174 5f73  e using format_s
+0001bc90: 7472 2829 2069 6e73 7465 6164 2c20 6275  tr() instead, bu
+0001bca0: 7420 6c65 7427 7320 6b65 6570 0a20 2020  t let's keep.   
+0001bcb0: 2020 2020 2023 2074 6869 7320 6f6e 6520       # this one 
+0001bcc0: 6172 6f75 6e64 2073 696e 6365 2070 656f  around since peo
+0001bcd0: 706c 6520 646f 2075 7365 2069 740a 2020  ple do use it.  
+0001bce0: 2020 2020 2020 6173 7365 7274 2028 0a20        assert (. 
+0001bcf0: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+0001bd00: 2e66 6f72 6d61 745f 6669 6c65 5f63 6f6e  .format_file_con
+0001bd10: 7465 6e74 7328 2278 3d31 222c 2066 6173  tents("x=1", fas
+0001bd20: 743d 5472 7565 2c20 6d6f 6465 3d62 6c61  t=True, mode=bla
+0001bd30: 636b 2e4d 6f64 6528 2929 203d 3d20 2278  ck.Mode()) == "x
+0001bd40: 203d 2031 5c6e 220a 2020 2020 2020 2020   = 1\n".        
+0001bd50: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
+0001bd60: 7079 7465 7374 2e72 6169 7365 7328 626c  pytest.raises(bl
+0001bd70: 6163 6b2e 4e6f 7468 696e 6743 6861 6e67  ack.NothingChang
+0001bd80: 6564 293a 0a20 2020 2020 2020 2020 2020  ed):.           
+0001bd90: 2062 6c61 636b 2e66 6f72 6d61 745f 6669   black.format_fi
+0001bda0: 6c65 5f63 6f6e 7465 6e74 7328 2278 203d  le_contents("x =
+0001bdb0: 2031 5c6e 222c 2066 6173 743d 5472 7565   1\n", fast=True
+0001bdc0: 2c20 6d6f 6465 3d62 6c61 636b 2e4d 6f64  , mode=black.Mod
+0001bdd0: 6528 2929 0a0a 0a63 6c61 7373 2054 6573  e())...class Tes
+0001bde0: 7441 5354 5361 6665 7479 2842 6c61 636b  tASTSafety(Black
+0001bdf0: 4261 7365 5465 7374 4361 7365 293a 0a20  BaseTestCase):. 
+0001be00: 2020 2064 6566 2063 6865 636b 5f61 7374     def check_ast
+0001be10: 5f65 7175 6976 616c 656e 6365 280a 2020  _equivalence(.  
+0001be20: 2020 2020 2020 7365 6c66 2c20 736f 7572        self, sour
+0001be30: 6365 3a20 7374 722c 2064 6573 743a 2073  ce: str, dest: s
+0001be40: 7472 2c20 2a2c 2073 686f 756c 645f 6661  tr, *, should_fa
+0001be50: 696c 3a20 626f 6f6c 203d 2046 616c 7365  il: bool = False
+0001be60: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0a  .    ) -> None:.
+0001be70: 2020 2020 2020 2020 2320 4966 2077 6520          # If we 
+0001be80: 6765 7420 6120 6661 696c 7572 652c 206d  get a failure, m
+0001be90: 616b 6520 7375 7265 2069 7427 7320 6e6f  ake sure it's no
+0001bea0: 7420 6265 6361 7573 6520 7468 6520 636f  t because the co
+0001beb0: 6465 2069 7473 656c 660a 2020 2020 2020  de itself.      
+0001bec0: 2020 2320 6973 2069 6e76 616c 6964 2c20    # is invalid, 
+0001bed0: 7369 6e63 6520 7468 6174 2077 696c 6c20  since that will 
+0001bee0: 616c 736f 2063 6175 7365 2061 7373 6572  also cause asser
+0001bef0: 745f 6571 7569 7661 6c65 6e74 2829 2074  t_equivalent() t
+0001bf00: 6f20 7468 726f 770a 2020 2020 2020 2020  o throw.        
+0001bf10: 2320 4153 5453 6166 6574 7945 7272 6f72  # ASTSafetyError
+0001bf20: 2e0a 2020 2020 2020 2020 736f 7572 6365  ..        source
+0001bf30: 203d 2074 6578 7477 7261 702e 6465 6465   = textwrap.dede
+0001bf40: 6e74 2873 6f75 7263 6529 0a20 2020 2020  nt(source).     
+0001bf50: 2020 2064 6573 7420 3d20 7465 7874 7772     dest = textwr
+0001bf60: 6170 2e64 6564 656e 7428 6465 7374 290a  ap.dedent(dest).
+0001bf70: 2020 2020 2020 2020 626c 6163 6b2e 7061          black.pa
+0001bf80: 7273 655f 6173 7428 736f 7572 6365 290a  rse_ast(source).
+0001bf90: 2020 2020 2020 2020 626c 6163 6b2e 7061          black.pa
+0001bfa0: 7273 655f 6173 7428 6465 7374 290a 2020  rse_ast(dest).  
+0001bfb0: 2020 2020 2020 6966 2073 686f 756c 645f        if should_
+0001bfc0: 6661 696c 3a0a 2020 2020 2020 2020 2020  fail:.          
+0001bfd0: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
+0001bfe0: 7274 5261 6973 6573 2841 5354 5361 6665  rtRaises(ASTSafe
+0001bff0: 7479 4572 726f 7229 3a0a 2020 2020 2020  tyError):.      
+0001c000: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
+0001c010: 6173 7365 7274 5f65 7175 6976 616c 656e  assert_equivalen
+0001c020: 7428 736f 7572 6365 2c20 6465 7374 290a  t(source, dest).
+0001c030: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0001c040: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
+0001c050: 6173 7365 7274 5f65 7175 6976 616c 656e  assert_equivalen
+0001c060: 7428 736f 7572 6365 2c20 6465 7374 290a  t(source, dest).
+0001c070: 0a20 2020 2064 6566 2074 6573 745f 6173  .    def test_as
+0001c080: 7365 7274 5f65 7175 6976 616c 656e 745f  sert_equivalent_
+0001c090: 6261 7369 6328 7365 6c66 2920 2d3e 204e  basic(self) -> N
+0001c0a0: 6f6e 653a 0a20 2020 2020 2020 2073 656c  one:.        sel
+0001c0b0: 662e 6368 6563 6b5f 6173 745f 6571 7569  f.check_ast_equi
+0001c0c0: 7661 6c65 6e63 6528 227b 7d22 2c20 224e  valence("{}", "N
+0001c0d0: 6f6e 6522 2c20 7368 6f75 6c64 5f66 6169  one", should_fai
+0001c0e0: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
+0001c0f0: 7365 6c66 2e63 6865 636b 5f61 7374 5f65  self.check_ast_e
+0001c100: 7175 6976 616c 656e 6365 2822 312b 3222  quivalence("1+2"
+0001c110: 2c20 2231 2020 2020 2b20 2020 3222 290a  , "1    +   2").
+0001c120: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
+0001c130: 636b 5f61 7374 5f65 7175 6976 616c 656e  ck_ast_equivalen
+0001c140: 6365 2822 6869 2023 2063 6f6d 6d65 6e74  ce("hi # comment
+0001c150: 222c 2022 6869 2229 0a0a 2020 2020 6465  ", "hi")..    de
+0001c160: 6620 7465 7374 5f61 7373 6572 745f 6571  f test_assert_eq
+0001c170: 7569 7661 6c65 6e74 5f64 656c 2873 656c  uivalent_del(sel
+0001c180: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0001c190: 2020 2020 7365 6c66 2e63 6865 636b 5f61      self.check_a
+0001c1a0: 7374 5f65 7175 6976 616c 656e 6365 2822  st_equivalence("
+0001c1b0: 6465 6c20 2861 2c20 6229 222c 2022 6465  del (a, b)", "de
+0001c1c0: 6c20 612c 2062 2229 0a0a 2020 2020 6465  l a, b")..    de
+0001c1d0: 6620 7465 7374 5f61 7373 6572 745f 6571  f test_assert_eq
+0001c1e0: 7569 7661 6c65 6e74 5f73 7472 696e 6773  uivalent_strings
+0001c1f0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0001c200: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
+0001c210: 636b 5f61 7374 5f65 7175 6976 616c 656e  ck_ast_equivalen
+0001c220: 6365 2827 7820 3d20 2278 2227 2c20 2778  ce('x = "x"', 'x
+0001c230: 203d 2022 2078 2022 272c 2073 686f 756c   = " x "', shoul
+0001c240: 645f 6661 696c 3d54 7275 6529 0a20 2020  d_fail=True).   
+0001c250: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
+0001c260: 6173 745f 6571 7569 7661 6c65 6e63 6528  ast_equivalence(
+0001c270: 0a20 2020 2020 2020 2020 2020 2027 2727  .            '''
+0001c280: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
+0001c290: 646f 6373 7472 696e 6720 2022 2222 0a20  docstring  """. 
+0001c2a0: 2020 2020 2020 2020 2020 2027 2727 2c0a             ''',.
+0001c2b0: 2020 2020 2020 2020 2020 2020 2727 270a              '''.
+0001c2c0: 2020 2020 2020 2020 2020 2020 2222 2264              """d
+0001c2d0: 6f63 7374 7269 6e67 2222 220a 2020 2020  ocstring""".    
+0001c2e0: 2020 2020 2020 2020 2727 272c 0a20 2020          ''',.   
+0001c2f0: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
 0001c300: 656c 662e 6368 6563 6b5f 6173 745f 6571  elf.check_ast_eq
-0001c310: 7569 7661 6c65 6e63 6528 2264 656c 2028  uivalence("del (
-0001c320: 612c 2062 2922 2c20 2264 656c 2061 2c20  a, b)", "del a, 
-0001c330: 6222 290a 0a20 2020 2064 6566 2074 6573  b")..    def tes
-0001c340: 745f 6173 7365 7274 5f65 7175 6976 616c  t_assert_equival
-0001c350: 656e 745f 7374 7269 6e67 7328 7365 6c66  ent_strings(self
-0001c360: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0001c370: 2020 2073 656c 662e 6368 6563 6b5f 6173     self.check_as
-0001c380: 745f 6571 7569 7661 6c65 6e63 6528 2778  t_equivalence('x
-0001c390: 203d 2022 7822 272c 2027 7820 3d20 2220   = "x"', 'x = " 
-0001c3a0: 7820 2227 2c20 7368 6f75 6c64 5f66 6169  x "', should_fai
-0001c3b0: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
-0001c3c0: 7365 6c66 2e63 6865 636b 5f61 7374 5f65  self.check_ast_e
-0001c3d0: 7175 6976 616c 656e 6365 280a 2020 2020  quivalence(.    
-0001c3e0: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
-0001c3f0: 2020 2020 2020 2020 2222 2264 6f63 7374          """docst
-0001c400: 7269 6e67 2020 2222 220a 2020 2020 2020  ring  """.      
-0001c410: 2020 2020 2020 2727 272c 0a20 2020 2020        ''',.     
-0001c420: 2020 2020 2020 2027 2727 0a20 2020 2020         '''.     
-0001c430: 2020 2020 2020 2022 2222 646f 6373 7472         """docstr
-0001c440: 696e 6722 2222 0a20 2020 2020 2020 2020  ing""".         
-0001c450: 2020 2027 2727 2c0a 2020 2020 2020 2020     ''',.        
-0001c460: 290a 2020 2020 2020 2020 7365 6c66 2e63  ).        self.c
-0001c470: 6865 636b 5f61 7374 5f65 7175 6976 616c  heck_ast_equival
-0001c480: 656e 6365 280a 2020 2020 2020 2020 2020  ence(.          
-0001c490: 2020 2727 270a 2020 2020 2020 2020 2020    '''.          
-0001c4a0: 2020 2222 2264 6f63 7374 7269 6e67 2020    """docstring  
-0001c4b0: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-0001c4c0: 2727 272c 0a20 2020 2020 2020 2020 2020  ''',.           
-0001c4d0: 2027 2727 0a20 2020 2020 2020 2020 2020   '''.           
-0001c4e0: 2022 2222 6464 6f63 7374 7269 6e67 2222   """ddocstring""
-0001c4f0: 220a 2020 2020 2020 2020 2020 2020 2727  ".            ''
-0001c500: 272c 0a20 2020 2020 2020 2020 2020 2073  ',.            s
-0001c510: 686f 756c 645f 6661 696c 3d54 7275 652c  hould_fail=True,
-0001c520: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-0001c530: 2020 2073 656c 662e 6368 6563 6b5f 6173     self.check_as
-0001c540: 745f 6571 7569 7661 6c65 6e63 6528 0a20  t_equivalence(. 
-0001c550: 2020 2020 2020 2020 2020 2027 2727 0a20             '''. 
-0001c560: 2020 2020 2020 2020 2020 2063 6c61 7373             class
-0001c570: 2041 3a0a 2020 2020 2020 2020 2020 2020   A:.            
-0001c580: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-0001c590: 2020 2020 2020 2020 2064 6f63 7374 7269           docstri
-0001c5a0: 6e67 0a0a 0a20 2020 2020 2020 2020 2020  ng...           
-0001c5b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001c5c0: 2020 2020 2027 2727 2c0a 2020 2020 2020       ''',.      
-0001c5d0: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
-0001c5e0: 2020 2020 2020 636c 6173 7320 413a 0a20        class A:. 
-0001c5f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001c600: 2222 646f 6373 7472 696e 6722 2222 0a20  ""docstring""". 
-0001c610: 2020 2020 2020 2020 2020 2027 2727 2c0a             ''',.
-0001c620: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001c630: 2020 7365 6c66 2e63 6865 636b 5f61 7374    self.check_ast
-0001c640: 5f65 7175 6976 616c 656e 6365 280a 2020  _equivalence(.  
-0001c650: 2020 2020 2020 2020 2020 2222 220a 2020            """.  
-0001c660: 2020 2020 2020 2020 2020 6465 6620 6628            def f(
-0001c670: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001c680: 2020 2022 2064 6f63 7374 7269 6e67 2020     " docstring  
-0001c690: 220a 2020 2020 2020 2020 2020 2020 2222  ".            ""
-0001c6a0: 222c 0a20 2020 2020 2020 2020 2020 2027  ",.            '
-0001c6b0: 2727 0a20 2020 2020 2020 2020 2020 2064  ''.            d
-0001c6c0: 6566 2066 2829 3a0a 2020 2020 2020 2020  ef f():.        
-0001c6d0: 2020 2020 2020 2020 2222 2264 6f63 7374          """docst
-0001c6e0: 7269 6e67 2222 220a 2020 2020 2020 2020  ring""".        
-0001c6f0: 2020 2020 2727 272c 0a20 2020 2020 2020      ''',.       
-0001c700: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
-0001c710: 6368 6563 6b5f 6173 745f 6571 7569 7661  check_ast_equiva
-0001c720: 6c65 6e63 6528 0a20 2020 2020 2020 2020  lence(.         
-0001c730: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
-0001c740: 2020 2061 7379 6e63 2064 6566 2066 2829     async def f()
-0001c750: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c760: 2020 2220 2020 646f 6373 7472 696e 6720    "   docstring 
-0001c770: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-0001c780: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
-0001c790: 2727 270a 2020 2020 2020 2020 2020 2020  '''.            
-0001c7a0: 6173 796e 6320 6465 6620 6628 293a 0a20  async def f():. 
-0001c7b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001c7c0: 2222 646f 6373 7472 696e 6722 2222 0a20  ""docstring""". 
-0001c7d0: 2020 2020 2020 2020 2020 2027 2727 2c0a             ''',.
-0001c7e0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-0001c7f0: 6566 2074 6573 745f 6173 7365 7274 5f65  ef test_assert_e
-0001c800: 7175 6976 616c 656e 745f 6673 7472 696e  quivalent_fstrin
-0001c810: 6728 7365 6c66 2920 2d3e 204e 6f6e 653a  g(self) -> None:
-0001c820: 0a20 2020 2020 2020 206d 616a 6f72 2c20  .        major, 
-0001c830: 6d69 6e6f 7220 3d20 7379 732e 7665 7273  minor = sys.vers
-0001c840: 696f 6e5f 696e 666f 5b3a 325d 0a20 2020  ion_info[:2].   
-0001c850: 2020 2020 2069 6620 6d61 6a6f 7220 3c20       if major < 
-0001c860: 3320 6f72 2028 6d61 6a6f 7220 3d3d 2033  3 or (major == 3
-0001c870: 2061 6e64 206d 696e 6f72 203c 2031 3229   and minor < 12)
-0001c880: 3a0a 2020 2020 2020 2020 2020 2020 7079  :.            py
-0001c890: 7465 7374 2e73 6b69 7028 2272 656c 6965  test.skip("relie
-0001c8a0: 7320 6f6e 2033 2e31 322b 2073 796e 7461  s on 3.12+ synta
-0001c8b0: 7822 290a 2020 2020 2020 2020 2320 6874  x").        # ht
-0001c8c0: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
-0001c8d0: 2f70 7366 2f62 6c61 636b 2f69 7373 7565  /psf/black/issue
-0001c8e0: 732f 3432 3638 0a20 2020 2020 2020 2073  s/4268.        s
-0001c8f0: 656c 662e 6368 6563 6b5f 6173 745f 6571  elf.check_ast_eq
-0001c900: 7569 7661 6c65 6e63 6528 0a20 2020 2020  uivalence(.     
-0001c910: 2020 2020 2020 2022 2222 7072 696e 7428         """print(
-0001c920: 6622 7b22 7c22 2e6a 6f69 6e28 5b61 2c62  f"{"|".join([a,b
-0001c930: 2c63 5d29 7d22 2922 2222 2c0a 2020 2020  ,c])}")""",.    
-0001c940: 2020 2020 2020 2020 2222 2270 7269 6e74          """print
-0001c950: 2866 227b 2220 7c20 222e 6a6f 696e 285b  (f"{" | ".join([
-0001c960: 612c 622c 635d 297d 2229 2222 222c 0a20  a,b,c])}")""",. 
-0001c970: 2020 2020 2020 2020 2020 2073 686f 756c             shoul
-0001c980: 645f 6661 696c 3d54 7275 652c 0a20 2020  d_fail=True,.   
-0001c990: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-0001c9a0: 656c 662e 6368 6563 6b5f 6173 745f 6571  elf.check_ast_eq
-0001c9b0: 7569 7661 6c65 6e63 6528 0a20 2020 2020  uivalence(.     
-0001c9c0: 2020 2020 2020 2022 2222 7072 696e 7428         """print(
-0001c9d0: 6622 7b22 7c22 2e6a 6f69 6e28 5b27 6127  f"{"|".join(['a'
-0001c9e0: 2c27 6227 2c27 6327 5d29 7d22 2922 2222  ,'b','c'])}")"""
-0001c9f0: 2c0a 2020 2020 2020 2020 2020 2020 2222  ,.            ""
-0001ca00: 2270 7269 6e74 2866 227b 2220 7c20 222e  "print(f"{" | ".
-0001ca10: 6a6f 696e 285b 2761 272c 2762 272c 2763  join(['a','b','c
-0001ca20: 275d 297d 2229 2222 222c 0a20 2020 2020  '])}")""",.     
-0001ca30: 2020 2020 2020 2073 686f 756c 645f 6661         should_fa
-0001ca40: 696c 3d54 7275 652c 0a20 2020 2020 2020  il=True,.       
-0001ca50: 2029 0a0a 2020 2020 6465 6620 7465 7374   )..    def test
-0001ca60: 5f65 7175 6976 616c 656e 6379 5f61 7374  _equivalency_ast
-0001ca70: 5f70 6172 7365 5f66 6169 6c75 7265 5f69  _parse_failure_i
-0001ca80: 6e63 6c75 6465 735f 6572 726f 7228 7365  ncludes_error(se
-0001ca90: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-0001caa0: 2020 2020 2077 6974 6820 7079 7465 7374       with pytest
-0001cab0: 2e72 6169 7365 7328 4153 5453 6166 6574  .raises(ASTSafet
-0001cac0: 7945 7272 6f72 2920 6173 2065 7272 3a0a  yError) as err:.
-0001cad0: 2020 2020 2020 2020 2020 2020 626c 6163              blac
-0001cae0: 6b2e 6173 7365 7274 5f65 7175 6976 616c  k.assert_equival
-0001caf0: 656e 7428 2261 c2ab c2bb 6120 203d 2031  ent("a....a  = 1
-0001cb00: 222c 2022 61c2 abc2 bb61 2020 3d20 3122  ", "a....a  = 1"
-0001cb10: 290a 0a20 2020 2020 2020 2065 7272 2e6d  )..        err.m
-0001cb20: 6174 6368 2822 2d2d 7361 6665 2229 0a20  atch("--safe"). 
-0001cb30: 2020 2020 2020 2023 2055 6e66 6f72 7475         # Unfortu
-0001cb40: 6e61 7465 6c79 2074 6865 2053 796e 7461  nately the Synta
-0001cb50: 7845 7272 6f72 206d 6573 7361 6765 2068  xError message h
-0001cb60: 6173 2063 6861 6e67 6564 2069 6e20 6e65  as changed in ne
-0001cb70: 7765 7220 7665 7273 696f 6e73 2073 6f20  wer versions so 
-0001cb80: 7765 0a20 2020 2020 2020 2023 2063 616e  we.        # can
-0001cb90: 2774 206d 6174 6368 2069 7420 6469 7265  't match it dire
-0001cba0: 6374 6c79 2e0a 2020 2020 2020 2020 6572  ctly..        er
-0001cbb0: 722e 6d61 7463 6828 2269 6e76 616c 6964  r.match("invalid
-0001cbc0: 2063 6861 7261 6374 6572 2229 0a20 2020   character").   
-0001cbd0: 2020 2020 2065 7272 2e6d 6174 6368 2872       err.match(r
-0001cbe0: 225c 283c 756e 6b6e 6f77 6e3e 2c20 6c69  "\(<unknown>, li
-0001cbf0: 6e65 2031 5c29 2229 0a0a 0a74 7279 3a0a  ne 1\)")...try:.
-0001cc00: 2020 2020 7769 7468 206f 7065 6e28 626c      with open(bl
-0001cc10: 6163 6b2e 5f5f 6669 6c65 5f5f 2c20 2272  ack.__file__, "r
-0001cc20: 222c 2065 6e63 6f64 696e 673d 2275 7466  ", encoding="utf
-0001cc30: 2d38 2229 2061 7320 5f62 663a 0a20 2020  -8") as _bf:.   
-0001cc40: 2020 2020 2062 6c61 636b 5f73 6f75 7263       black_sourc
-0001cc50: 655f 6c69 6e65 7320 3d20 5f62 662e 7265  e_lines = _bf.re
-0001cc60: 6164 6c69 6e65 7328 290a 6578 6365 7074  adlines().except
-0001cc70: 2055 6e69 636f 6465 4465 636f 6465 4572   UnicodeDecodeEr
-0001cc80: 726f 723a 0a20 2020 2069 6620 6e6f 7420  ror:.    if not 
-0001cc90: 626c 6163 6b2e 434f 4d50 494c 4544 3a0a  black.COMPILED:.
-0001cca0: 2020 2020 2020 2020 7261 6973 650a 0a0a          raise...
-0001ccb0: 6465 6620 7472 6163 6566 756e 6328 0a20  def tracefunc(. 
-0001ccc0: 2020 2066 7261 6d65 3a20 7479 7065 732e     frame: types.
-0001ccd0: 4672 616d 6554 7970 652c 2065 7665 6e74  FrameType, event
-0001cce0: 3a20 7374 722c 2061 7267 3a20 416e 790a  : str, arg: Any.
-0001ccf0: 2920 2d3e 2043 616c 6c61 626c 655b 5b74  ) -> Callable[[t
-0001cd00: 7970 6573 2e46 7261 6d65 5479 7065 2c20  ypes.FrameType, 
-0001cd10: 7374 722c 2041 6e79 5d2c 2041 6e79 5d3a  str, Any], Any]:
-0001cd20: 0a20 2020 2022 2222 5368 6f77 2066 756e  .    """Show fun
-0001cd30: 6374 696f 6e20 6361 6c6c 7320 6066 726f  ction calls `fro
-0001cd40: 6d20 626c 6163 6b2f 5f5f 696e 6974 5f5f  m black/__init__
-0001cd50: 2e70 7960 2061 7320 7468 6579 2068 6170  .py` as they hap
-0001cd60: 7065 6e2e 0a0a 2020 2020 5265 6769 7374  pen...    Regist
-0001cd70: 6572 2074 6869 7320 7769 7468 2060 7379  er this with `sy
-0001cd80: 732e 7365 7474 7261 6365 2829 6020 696e  s.settrace()` in
-0001cd90: 2061 2074 6573 7420 796f 7527 7265 2064   a test you're d
-0001cda0: 6562 7567 6769 6e67 2e0a 2020 2020 2222  ebugging..    ""
-0001cdb0: 220a 2020 2020 6966 2065 7665 6e74 2021  ".    if event !
-0001cdc0: 3d20 2263 616c 6c22 3a0a 2020 2020 2020  = "call":.      
-0001cdd0: 2020 7265 7475 726e 2074 7261 6365 6675    return tracefu
-0001cde0: 6e63 0a0a 2020 2020 7374 6163 6b20 3d20  nc..    stack = 
-0001cdf0: 6c65 6e28 696e 7370 6563 742e 7374 6163  len(inspect.stac
-0001ce00: 6b28 2929 202d 2031 390a 2020 2020 7374  k()) - 19.    st
-0001ce10: 6163 6b20 2a3d 2032 0a20 2020 2066 696c  ack *= 2.    fil
-0001ce20: 656e 616d 6520 3d20 6672 616d 652e 665f  ename = frame.f_
-0001ce30: 636f 6465 2e63 6f5f 6669 6c65 6e61 6d65  code.co_filename
-0001ce40: 0a20 2020 206c 696e 656e 6f20 3d20 6672  .    lineno = fr
-0001ce50: 616d 652e 665f 6c69 6e65 6e6f 0a20 2020  ame.f_lineno.   
-0001ce60: 2066 756e 635f 7369 675f 6c69 6e65 6e6f   func_sig_lineno
-0001ce70: 203d 206c 696e 656e 6f20 2d20 310a 2020   = lineno - 1.  
-0001ce80: 2020 6675 6e63 6e61 6d65 203d 2062 6c61    funcname = bla
-0001ce90: 636b 5f73 6f75 7263 655f 6c69 6e65 735b  ck_source_lines[
-0001cea0: 6675 6e63 5f73 6967 5f6c 696e 656e 6f5d  func_sig_lineno]
-0001ceb0: 2e73 7472 6970 2829 0a20 2020 2077 6869  .strip().    whi
-0001cec0: 6c65 2066 756e 636e 616d 652e 7374 6172  le funcname.star
-0001ced0: 7473 7769 7468 2822 4022 293a 0a20 2020  tswith("@"):.   
-0001cee0: 2020 2020 2066 756e 635f 7369 675f 6c69       func_sig_li
-0001cef0: 6e65 6e6f 202b 3d20 310a 2020 2020 2020  neno += 1.      
-0001cf00: 2020 6675 6e63 6e61 6d65 203d 2062 6c61    funcname = bla
-0001cf10: 636b 5f73 6f75 7263 655f 6c69 6e65 735b  ck_source_lines[
-0001cf20: 6675 6e63 5f73 6967 5f6c 696e 656e 6f5d  func_sig_lineno]
-0001cf30: 2e73 7472 6970 2829 0a20 2020 2069 6620  .strip().    if 
-0001cf40: 2262 6c61 636b 2f5f 5f69 6e69 745f 5f2e  "black/__init__.
-0001cf50: 7079 2220 696e 2066 696c 656e 616d 653a  py" in filename:
-0001cf60: 0a20 2020 2020 2020 2070 7269 6e74 2866  .        print(f
-0001cf70: 227b 2720 2720 2a20 7374 6163 6b7d 7b6c  "{' ' * stack}{l
-0001cf80: 696e 656e 6f7d 3a7b 6675 6e63 6e61 6d65  ineno}:{funcname
-0001cf90: 7d22 290a 2020 2020 7265 7475 726e 2074  }").    return t
-0001cfa0: 7261 6365 6675 6e63 0a                   racefunc.
+0001c310: 7569 7661 6c65 6e63 6528 0a20 2020 2020  uivalence(.     
+0001c320: 2020 2020 2020 2027 2727 0a20 2020 2020         '''.     
+0001c330: 2020 2020 2020 2022 2222 646f 6373 7472         """docstr
+0001c340: 696e 6720 2022 2222 0a20 2020 2020 2020  ing  """.       
+0001c350: 2020 2020 2027 2727 2c0a 2020 2020 2020       ''',.      
+0001c360: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
+0001c370: 2020 2020 2020 2222 2264 646f 6373 7472        """ddocstr
+0001c380: 696e 6722 2222 0a20 2020 2020 2020 2020  ing""".         
+0001c390: 2020 2027 2727 2c0a 2020 2020 2020 2020     ''',.        
+0001c3a0: 2020 2020 7368 6f75 6c64 5f66 6169 6c3d      should_fail=
+0001c3b0: 5472 7565 2c0a 2020 2020 2020 2020 290a  True,.        ).
+0001c3c0: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
+0001c3d0: 636b 5f61 7374 5f65 7175 6976 616c 656e  ck_ast_equivalen
+0001c3e0: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
+0001c3f0: 2727 270a 2020 2020 2020 2020 2020 2020  '''.            
+0001c400: 636c 6173 7320 413a 0a20 2020 2020 2020  class A:.       
+0001c410: 2020 2020 2020 2020 2022 2222 0a0a 2020           """..  
+0001c420: 2020 2020 2020 2020 2020 2020 2020 646f                do
+0001c430: 6373 7472 696e 670a 0a0a 2020 2020 2020  cstring...      
+0001c440: 2020 2020 2020 2020 2020 2222 220a 2020            """.  
+0001c450: 2020 2020 2020 2020 2020 2727 272c 0a20            ''',. 
+0001c460: 2020 2020 2020 2020 2020 2027 2727 0a20             '''. 
+0001c470: 2020 2020 2020 2020 2020 2063 6c61 7373             class
+0001c480: 2041 3a0a 2020 2020 2020 2020 2020 2020   A:.            
+0001c490: 2020 2020 2222 2264 6f63 7374 7269 6e67      """docstring
+0001c4a0: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+0001c4b0: 2727 272c 0a20 2020 2020 2020 2029 0a20  ''',.        ). 
+0001c4c0: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
+0001c4d0: 6b5f 6173 745f 6571 7569 7661 6c65 6e63  k_ast_equivalenc
+0001c4e0: 6528 0a20 2020 2020 2020 2020 2020 2022  e(.            "
+0001c4f0: 2222 0a20 2020 2020 2020 2020 2020 2064  "".            d
+0001c500: 6566 2066 2829 3a0a 2020 2020 2020 2020  ef f():.        
+0001c510: 2020 2020 2020 2020 2220 646f 6373 7472          " docstr
+0001c520: 696e 6720 2022 0a20 2020 2020 2020 2020  ing  ".         
+0001c530: 2020 2022 2222 2c0a 2020 2020 2020 2020     """,.        
+0001c540: 2020 2020 2727 270a 2020 2020 2020 2020      '''.        
+0001c550: 2020 2020 6465 6620 6628 293a 0a20 2020      def f():.   
+0001c560: 2020 2020 2020 2020 2020 2020 2022 2222               """
+0001c570: 646f 6373 7472 696e 6722 2222 0a20 2020  docstring""".   
+0001c580: 2020 2020 2020 2020 2027 2727 2c0a 2020           ''',.  
+0001c590: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001c5a0: 7365 6c66 2e63 6865 636b 5f61 7374 5f65  self.check_ast_e
+0001c5b0: 7175 6976 616c 656e 6365 280a 2020 2020  quivalence(.    
+0001c5c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001c5d0: 2020 2020 2020 2020 6173 796e 6320 6465          async de
+0001c5e0: 6620 6628 293a 0a20 2020 2020 2020 2020  f f():.         
+0001c5f0: 2020 2020 2020 2022 2020 2064 6f63 7374         "   docst
+0001c600: 7269 6e67 2020 220a 2020 2020 2020 2020  ring  ".        
+0001c610: 2020 2020 2222 222c 0a20 2020 2020 2020      """,.       
+0001c620: 2020 2020 2027 2727 0a20 2020 2020 2020       '''.       
+0001c630: 2020 2020 2061 7379 6e63 2064 6566 2066       async def f
+0001c640: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0001c650: 2020 2020 2222 2264 6f63 7374 7269 6e67      """docstring
+0001c660: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+0001c670: 2727 272c 0a20 2020 2020 2020 2029 0a20  ''',.        ). 
+0001c680: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
+0001c690: 6b5f 6173 745f 6571 7569 7661 6c65 6e63  k_ast_equivalenc
+0001c6a0: 6528 0a20 2020 2020 2020 2020 2020 2022  e(.            "
+0001c6b0: 2222 0a20 2020 2020 2020 2020 2020 2069  "".            i
+0001c6c0: 6620 5f5f 6e61 6d65 5f5f 203d 3d20 225f  f __name__ == "_
+0001c6d0: 5f6d 6169 6e5f 5f22 3a0a 2020 2020 2020  _main__":.      
+0001c6e0: 2020 2020 2020 2020 2020 2220 2064 6f63            "  doc
+0001c6f0: 7374 7269 6e67 2d6c 696b 6520 2022 0a20  string-like  ". 
+0001c700: 2020 2020 2020 2020 2020 2022 2222 2c0a             """,.
+0001c710: 2020 2020 2020 2020 2020 2020 2727 270a              '''.
+0001c720: 2020 2020 2020 2020 2020 2020 6966 205f              if _
+0001c730: 5f6e 616d 655f 5f20 3d3d 2022 5f5f 6d61  _name__ == "__ma
+0001c740: 696e 5f5f 223a 0a20 2020 2020 2020 2020  in__":.         
+0001c750: 2020 2020 2020 2022 2222 646f 6373 7472         """docstr
+0001c760: 696e 672d 6c69 6b65 2222 220a 2020 2020  ing-like""".    
+0001c770: 2020 2020 2020 2020 2727 272c 0a20 2020          ''',.   
+0001c780: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
+0001c790: 656c 662e 6368 6563 6b5f 6173 745f 6571  elf.check_ast_eq
+0001c7a0: 7569 7661 6c65 6e63 6528 7227 6465 6620  uivalence(r'def 
+0001c7b0: 6628 293a 2072 2220 5c6e 2022 272c 2072  f(): r" \n "', r
+0001c7c0: 2764 6566 2066 2829 3a20 225c 5c6e 2227  'def f(): "\\n"'
+0001c7d0: 290a 2020 2020 2020 2020 7365 6c66 2e63  ).        self.c
+0001c7e0: 6865 636b 5f61 7374 5f65 7175 6976 616c  heck_ast_equival
+0001c7f0: 656e 6365 2827 7472 793a 2070 6173 735c  ence('try: pass\
+0001c800: 6e65 7863 6570 743a 2022 2078 2022 272c  nexcept: " x "',
+0001c810: 2027 7472 793a 2070 6173 735c 6e65 7863   'try: pass\nexc
+0001c820: 6570 743a 2022 7822 2729 0a0a 2020 2020  ept: "x"')..    
+0001c830: 2020 2020 7365 6c66 2e63 6865 636b 5f61      self.check_a
+0001c840: 7374 5f65 7175 6976 616c 656e 6365 280a  st_equivalence(.
+0001c850: 2020 2020 2020 2020 2020 2020 2764 6566              'def
+0001c860: 2066 6f6f 2829 3a20 7265 7475 726e 2022   foo(): return "
+0001c870: 2078 2022 272c 2027 6465 6620 666f 6f28   x "', 'def foo(
+0001c880: 293a 2072 6574 7572 6e20 2278 2227 2c20  ): return "x"', 
+0001c890: 7368 6f75 6c64 5f66 6169 6c3d 5472 7565  should_fail=True
+0001c8a0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0001c8b0: 6465 6620 7465 7374 5f61 7373 6572 745f  def test_assert_
+0001c8c0: 6571 7569 7661 6c65 6e74 5f66 7374 7269  equivalent_fstri
+0001c8d0: 6e67 2873 656c 6629 202d 3e20 4e6f 6e65  ng(self) -> None
+0001c8e0: 3a0a 2020 2020 2020 2020 6d61 6a6f 722c  :.        major,
+0001c8f0: 206d 696e 6f72 203d 2073 7973 2e76 6572   minor = sys.ver
+0001c900: 7369 6f6e 5f69 6e66 6f5b 3a32 5d0a 2020  sion_info[:2].  
+0001c910: 2020 2020 2020 6966 206d 616a 6f72 203c        if major <
+0001c920: 2033 206f 7220 286d 616a 6f72 203d 3d20   3 or (major == 
+0001c930: 3320 616e 6420 6d69 6e6f 7220 3c20 3132  3 and minor < 12
+0001c940: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
+0001c950: 7974 6573 742e 736b 6970 2822 7265 6c69  ytest.skip("reli
+0001c960: 6573 206f 6e20 332e 3132 2b20 7379 6e74  es on 3.12+ synt
+0001c970: 6178 2229 0a20 2020 2020 2020 2023 2068  ax").        # h
+0001c980: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+0001c990: 6d2f 7073 662f 626c 6163 6b2f 6973 7375  m/psf/black/issu
+0001c9a0: 6573 2f34 3236 380a 2020 2020 2020 2020  es/4268.        
+0001c9b0: 7365 6c66 2e63 6865 636b 5f61 7374 5f65  self.check_ast_e
+0001c9c0: 7175 6976 616c 656e 6365 280a 2020 2020  quivalence(.    
+0001c9d0: 2020 2020 2020 2020 2222 2270 7269 6e74          """print
+0001c9e0: 2866 227b 227c 222e 6a6f 696e 285b 612c  (f"{"|".join([a,
+0001c9f0: 622c 635d 297d 2229 2222 222c 0a20 2020  b,c])}")""",.   
+0001ca00: 2020 2020 2020 2020 2022 2222 7072 696e           """prin
+0001ca10: 7428 6622 7b22 207c 2022 2e6a 6f69 6e28  t(f"{" | ".join(
+0001ca20: 5b61 2c62 2c63 5d29 7d22 2922 2222 2c0a  [a,b,c])}")""",.
+0001ca30: 2020 2020 2020 2020 2020 2020 7368 6f75              shou
+0001ca40: 6c64 5f66 6169 6c3d 5472 7565 2c0a 2020  ld_fail=True,.  
+0001ca50: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001ca60: 7365 6c66 2e63 6865 636b 5f61 7374 5f65  self.check_ast_e
+0001ca70: 7175 6976 616c 656e 6365 280a 2020 2020  quivalence(.    
+0001ca80: 2020 2020 2020 2020 2222 2270 7269 6e74          """print
+0001ca90: 2866 227b 227c 222e 6a6f 696e 285b 2761  (f"{"|".join(['a
+0001caa0: 272c 2762 272c 2763 275d 297d 2229 2222  ','b','c'])}")""
+0001cab0: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+0001cac0: 2222 7072 696e 7428 6622 7b22 207c 2022  ""print(f"{" | "
+0001cad0: 2e6a 6f69 6e28 5b27 6127 2c27 6227 2c27  .join(['a','b','
+0001cae0: 6327 5d29 7d22 2922 2222 2c0a 2020 2020  c'])}")""",.    
+0001caf0: 2020 2020 2020 2020 7368 6f75 6c64 5f66          should_f
+0001cb00: 6169 6c3d 5472 7565 2c0a 2020 2020 2020  ail=True,.      
+0001cb10: 2020 290a 0a20 2020 2064 6566 2074 6573    )..    def tes
+0001cb20: 745f 6571 7569 7661 6c65 6e63 795f 6173  t_equivalency_as
+0001cb30: 745f 7061 7273 655f 6661 696c 7572 655f  t_parse_failure_
+0001cb40: 696e 636c 7564 6573 5f65 7272 6f72 2873  includes_error(s
+0001cb50: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+0001cb60: 2020 2020 2020 7769 7468 2070 7974 6573        with pytes
+0001cb70: 742e 7261 6973 6573 2841 5354 5361 6665  t.raises(ASTSafe
+0001cb80: 7479 4572 726f 7229 2061 7320 6572 723a  tyError) as err:
+0001cb90: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
+0001cba0: 636b 2e61 7373 6572 745f 6571 7569 7661  ck.assert_equiva
+0001cbb0: 6c65 6e74 2822 61c2 abc2 bb61 2020 3d20  lent("a....a  = 
+0001cbc0: 3122 2c20 2261 c2ab c2bb 6120 203d 2031  1", "a....a  = 1
+0001cbd0: 2229 0a0a 2020 2020 2020 2020 6572 722e  ")..        err.
+0001cbe0: 6d61 7463 6828 222d 2d73 6166 6522 290a  match("--safe").
+0001cbf0: 2020 2020 2020 2020 2320 556e 666f 7274          # Unfort
+0001cc00: 756e 6174 656c 7920 7468 6520 5379 6e74  unately the Synt
+0001cc10: 6178 4572 726f 7220 6d65 7373 6167 6520  axError message 
+0001cc20: 6861 7320 6368 616e 6765 6420 696e 206e  has changed in n
+0001cc30: 6577 6572 2076 6572 7369 6f6e 7320 736f  ewer versions so
+0001cc40: 2077 650a 2020 2020 2020 2020 2320 6361   we.        # ca
+0001cc50: 6e27 7420 6d61 7463 6820 6974 2064 6972  n't match it dir
+0001cc60: 6563 746c 792e 0a20 2020 2020 2020 2065  ectly..        e
+0001cc70: 7272 2e6d 6174 6368 2822 696e 7661 6c69  rr.match("invali
+0001cc80: 6420 6368 6172 6163 7465 7222 290a 2020  d character").  
+0001cc90: 2020 2020 2020 6572 722e 6d61 7463 6828        err.match(
+0001cca0: 7222 5c28 3c75 6e6b 6e6f 776e 3e2c 206c  r"\(<unknown>, l
+0001ccb0: 696e 6520 315c 2922 290a 0a0a 7472 793a  ine 1\)")...try:
+0001ccc0: 0a20 2020 2077 6974 6820 6f70 656e 2862  .    with open(b
+0001ccd0: 6c61 636b 2e5f 5f66 696c 655f 5f2c 2022  lack.__file__, "
+0001cce0: 7222 2c20 656e 636f 6469 6e67 3d22 7574  r", encoding="ut
+0001ccf0: 662d 3822 2920 6173 205f 6266 3a0a 2020  f-8") as _bf:.  
+0001cd00: 2020 2020 2020 626c 6163 6b5f 736f 7572        black_sour
+0001cd10: 6365 5f6c 696e 6573 203d 205f 6266 2e72  ce_lines = _bf.r
+0001cd20: 6561 646c 696e 6573 2829 0a65 7863 6570  eadlines().excep
+0001cd30: 7420 556e 6963 6f64 6544 6563 6f64 6545  t UnicodeDecodeE
+0001cd40: 7272 6f72 3a0a 2020 2020 6966 206e 6f74  rror:.    if not
+0001cd50: 2062 6c61 636b 2e43 4f4d 5049 4c45 443a   black.COMPILED:
+0001cd60: 0a20 2020 2020 2020 2072 6169 7365 0a0a  .        raise..
+0001cd70: 0a64 6566 2074 7261 6365 6675 6e63 280a  .def tracefunc(.
+0001cd80: 2020 2020 6672 616d 653a 2074 7970 6573      frame: types
+0001cd90: 2e46 7261 6d65 5479 7065 2c20 6576 656e  .FrameType, even
+0001cda0: 743a 2073 7472 2c20 6172 673a 2041 6e79  t: str, arg: Any
+0001cdb0: 0a29 202d 3e20 4361 6c6c 6162 6c65 5b5b  .) -> Callable[[
+0001cdc0: 7479 7065 732e 4672 616d 6554 7970 652c  types.FrameType,
+0001cdd0: 2073 7472 2c20 416e 795d 2c20 416e 795d   str, Any], Any]
+0001cde0: 3a0a 2020 2020 2222 2253 686f 7720 6675  :.    """Show fu
+0001cdf0: 6e63 7469 6f6e 2063 616c 6c73 2060 6672  nction calls `fr
+0001ce00: 6f6d 2062 6c61 636b 2f5f 5f69 6e69 745f  om black/__init_
+0001ce10: 5f2e 7079 6020 6173 2074 6865 7920 6861  _.py` as they ha
+0001ce20: 7070 656e 2e0a 0a20 2020 2052 6567 6973  ppen...    Regis
+0001ce30: 7465 7220 7468 6973 2077 6974 6820 6073  ter this with `s
+0001ce40: 7973 2e73 6574 7472 6163 6528 2960 2069  ys.settrace()` i
+0001ce50: 6e20 6120 7465 7374 2079 6f75 2772 6520  n a test you're 
+0001ce60: 6465 6275 6767 696e 672e 0a20 2020 2022  debugging..    "
+0001ce70: 2222 0a20 2020 2069 6620 6576 656e 7420  "".    if event 
+0001ce80: 213d 2022 6361 6c6c 223a 0a20 2020 2020  != "call":.     
+0001ce90: 2020 2072 6574 7572 6e20 7472 6163 6566     return tracef
+0001cea0: 756e 630a 0a20 2020 2073 7461 636b 203d  unc..    stack =
+0001ceb0: 206c 656e 2869 6e73 7065 6374 2e73 7461   len(inspect.sta
+0001cec0: 636b 2829 2920 2d20 3139 0a20 2020 2073  ck()) - 19.    s
+0001ced0: 7461 636b 202a 3d20 320a 2020 2020 6669  tack *= 2.    fi
+0001cee0: 6c65 6e61 6d65 203d 2066 7261 6d65 2e66  lename = frame.f
+0001cef0: 5f63 6f64 652e 636f 5f66 696c 656e 616d  _code.co_filenam
+0001cf00: 650a 2020 2020 6c69 6e65 6e6f 203d 2066  e.    lineno = f
+0001cf10: 7261 6d65 2e66 5f6c 696e 656e 6f0a 2020  rame.f_lineno.  
+0001cf20: 2020 6675 6e63 5f73 6967 5f6c 696e 656e    func_sig_linen
+0001cf30: 6f20 3d20 6c69 6e65 6e6f 202d 2031 0a20  o = lineno - 1. 
+0001cf40: 2020 2066 756e 636e 616d 6520 3d20 626c     funcname = bl
+0001cf50: 6163 6b5f 736f 7572 6365 5f6c 696e 6573  ack_source_lines
+0001cf60: 5b66 756e 635f 7369 675f 6c69 6e65 6e6f  [func_sig_lineno
+0001cf70: 5d2e 7374 7269 7028 290a 2020 2020 7768  ].strip().    wh
+0001cf80: 696c 6520 6675 6e63 6e61 6d65 2e73 7461  ile funcname.sta
+0001cf90: 7274 7377 6974 6828 2240 2229 3a0a 2020  rtswith("@"):.  
+0001cfa0: 2020 2020 2020 6675 6e63 5f73 6967 5f6c        func_sig_l
+0001cfb0: 696e 656e 6f20 2b3d 2031 0a20 2020 2020  ineno += 1.     
+0001cfc0: 2020 2066 756e 636e 616d 6520 3d20 626c     funcname = bl
+0001cfd0: 6163 6b5f 736f 7572 6365 5f6c 696e 6573  ack_source_lines
+0001cfe0: 5b66 756e 635f 7369 675f 6c69 6e65 6e6f  [func_sig_lineno
+0001cff0: 5d2e 7374 7269 7028 290a 2020 2020 6966  ].strip().    if
+0001d000: 2022 626c 6163 6b2f 5f5f 696e 6974 5f5f   "black/__init__
+0001d010: 2e70 7922 2069 6e20 6669 6c65 6e61 6d65  .py" in filename
+0001d020: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+0001d030: 6622 7b27 2027 202a 2073 7461 636b 7d7b  f"{' ' * stack}{
+0001d040: 6c69 6e65 6e6f 7d3a 7b66 756e 636e 616d  lineno}:{funcnam
+0001d050: 657d 2229 0a20 2020 2072 6574 7572 6e20  e}").    return 
+0001d060: 7472 6163 6566 756e 630a                 tracefunc.
```

### Comparing `black-24.3.0/tests/test_blackd.py` & `black-24.4.0/tests/test_blackd.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/test_docs.py` & `black-24.4.0/tests/test_docs.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/test_format.py` & `black-24.4.0/tests/test_format.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/test_ipynb.py` & `black-24.4.0/tests/test_ipynb.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/test_no_ipynb.py` & `black-24.4.0/tests/test_no_ipynb.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/test_ranges.py` & `black-24.4.0/tests/test_ranges.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/test_schema.py` & `black-24.4.0/tests/test_schema.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/test_trans.py` & `black-24.4.0/tests/test_trans.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/util.py` & `black-24.4.0/tests/util.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/allow_empty_first_line.py` & `black-24.4.0/tests/data/cases/allow_empty_first_line.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/attribute_access_on_number_literals.py` & `black-24.4.0/tests/data/cases/attribute_access_on_number_literals.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/class_blank_parentheses.py` & `black-24.4.0/tests/data/cases/class_blank_parentheses.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/class_methods_new_line.py` & `black-24.4.0/tests/data/cases/class_methods_new_line.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/collections.py` & `black-24.4.0/tests/data/cases/collections.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/comments.py` & `black-24.4.0/tests/data/cases/comments.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/comments2.py` & `black-24.4.0/tests/data/cases/comments2.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/comments3.py` & `black-24.4.0/tests/data/cases/comments3.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/comments4.py` & `black-24.4.0/tests/data/cases/comments4.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/comments5.py` & `black-24.4.0/tests/data/cases/comments5.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/comments6.py` & `black-24.4.0/tests/data/cases/comments6.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/comments9.py` & `black-24.4.0/tests/data/cases/comments9.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/comments_in_blocks.py` & `black-24.4.0/tests/data/cases/comments_in_blocks.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/comments_in_double_parens.py` & `black-24.4.0/tests/data/cases/comments_in_double_parens.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/comments_non_breaking_space.py` & `black-24.4.0/tests/data/cases/comments_non_breaking_space.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/composition.py` & `black-24.4.0/tests/data/cases/composition.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/composition_no_trailing_comma.py` & `black-24.4.0/tests/data/cases/composition_no_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/conditional_expression.py` & `black-24.4.0/tests/data/cases/conditional_expression.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/context_managers_38.py` & `black-24.4.0/tests/data/cases/context_managers_38.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/context_managers_39.py` & `black-24.4.0/tests/data/cases/context_managers_39.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/context_managers_autodetect_310.py` & `black-24.4.0/tests/data/cases/context_managers_autodetect_310.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/context_managers_autodetect_311.py` & `black-24.4.0/tests/data/cases/context_managers_autodetect_311.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/context_managers_autodetect_38.py` & `black-24.4.0/tests/data/cases/context_managers_autodetect_38.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/context_managers_autodetect_39.py` & `black-24.4.0/tests/data/cases/context_managers_autodetect_39.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/docstring.py` & `black-24.4.0/tests/data/cases/docstring.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/docstring_no_string_normalization.py` & `black-24.4.0/tests/data/cases/docstring_no_string_normalization.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/docstring_preview.py` & `black-24.4.0/tests/data/cases/docstring_preview.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/dummy_implementations.py` & `black-24.4.0/tests/data/cases/dummy_implementations.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/empty_lines.py` & `black-24.4.0/tests/data/cases/empty_lines.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/expression.diff` & `black-24.4.0/tests/data/cases/expression.diff`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/expression.py` & `black-24.4.0/tests/data/cases/expression.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/fmtonoff.py` & `black-24.4.0/tests/data/cases/fmtonoff.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/fmtonoff2.py` & `black-24.4.0/tests/data/cases/fmtonoff2.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/fmtonoff5.py` & `black-24.4.0/tests/data/cases/fmtonoff5.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/fmtskip2.py` & `black-24.4.0/tests/data/cases/fmtskip2.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/fmtskip8.py` & `black-24.4.0/tests/data/cases/fmtskip8.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/form_feeds.py` & `black-24.4.0/tests/data/cases/form_feeds.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/fstring.py` & `black-24.4.0/tests/data/cases/fstring.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/funcdef_return_type_trailing_comma.py` & `black-24.4.0/tests/data/cases/funcdef_return_type_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/function.py` & `black-24.4.0/tests/data/cases/function.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/function2.py` & `black-24.4.0/tests/data/cases/function2.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/function_trailing_comma.py` & `black-24.4.0/tests/data/cases/function_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/ignore_pyi.py` & `black-24.4.0/tests/data/cases/ignore_pyi.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/import_spacing.py` & `black-24.4.0/tests/data/cases/import_spacing.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/is_simple_lookup_for_doublestar_expression.py` & `black-24.4.0/tests/data/cases/is_simple_lookup_for_doublestar_expression.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/keep_newline_after_match.py` & `black-24.4.0/tests/data/cases/keep_newline_after_match.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/line_ranges_basic.py` & `black-24.4.0/tests/data/cases/line_ranges_basic.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/line_ranges_diff_edge_case.py` & `black-24.4.0/tests/data/cases/line_ranges_diff_edge_case.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/line_ranges_exceeding_end.py` & `black-24.4.0/tests/data/cases/line_ranges_exceeding_end.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/line_ranges_fmt_off.py` & `black-24.4.0/tests/data/cases/line_ranges_fmt_off.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/line_ranges_fmt_off_decorator.py` & `black-24.4.0/tests/data/cases/line_ranges_fmt_off_decorator.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/line_ranges_fmt_off_overlap.py` & `black-24.4.0/tests/data/cases/line_ranges_fmt_off_overlap.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/line_ranges_indentation.py` & `black-24.4.0/tests/data/cases/line_ranges_indentation.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/line_ranges_outside_source.py` & `black-24.4.0/tests/data/cases/line_ranges_outside_source.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/line_ranges_two_passes.py` & `black-24.4.0/tests/data/cases/line_ranges_two_passes.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/line_ranges_unwrapping.py` & `black-24.4.0/tests/data/cases/line_ranges_unwrapping.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/long_strings_flag_disabled.py` & `black-24.4.0/tests/data/cases/long_strings_flag_disabled.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/module_docstring_2.py` & `black-24.4.0/tests/data/cases/module_docstring_2.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/multiline_consecutive_open_parentheses_ignore.py` & `black-24.4.0/tests/data/cases/multiline_consecutive_open_parentheses_ignore.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/nested_stub.py` & `black-24.4.0/tests/data/cases/nested_stub.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/no_blank_line_before_docstring.py` & `black-24.4.0/tests/data/cases/no_blank_line_before_docstring.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/numeric_literals.py` & `black-24.4.0/tests/data/cases/numeric_literals.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/one_element_subscript.py` & `black-24.4.0/tests/data/cases/one_element_subscript.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/parenthesized_context_managers.py` & `black-24.4.0/tests/data/cases/parenthesized_context_managers.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pattern_matching_complex.py` & `black-24.4.0/tests/data/cases/pattern_matching_complex.py`

 * *Files 1% similar despite different names*

```diff
@@ -79,15 +79,15 @@
 match (0, 1, 2):
     case [0, 1, *x, 2]:
         y = 0
 # case black_test_patma_052
 match x:
     case [0]:
         y = 0
-    case [1, 0] if (x := x[:0]):
+    case [1, 0] if x := x[:0]:
         y = 1
     case [1, 0]:
         y = 2
 # case black_test_patma_191
 match w:
     case [x, y, *_]:
         z = 0
```

### Comparing `black-24.3.0/tests/data/cases/pattern_matching_extras.py` & `black-24.4.0/tests/data/cases/pattern_matching_extras.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pattern_matching_generic.py` & `black-24.4.0/tests/data/cases/pattern_matching_generic.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pattern_matching_long.py` & `black-24.4.0/tests/data/cases/pattern_matching_long.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pattern_matching_simple.py` & `black-24.4.0/tests/data/cases/pattern_matching_simple.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pattern_matching_style.py` & `black-24.4.0/tests/data/cases/pattern_matching_style.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pattern_matching_trailing_comma.py` & `black-24.4.0/tests/data/cases/pattern_matching_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pep604_union_types_line_breaks.py` & `black-24.4.0/tests/data/cases/pep604_union_types_line_breaks.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pep_570.py` & `black-24.4.0/tests/data/cases/pep_570.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pep_572.py` & `black-24.4.0/tests/data/cases/pep_572.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pep_572_do_not_remove_parens.py` & `black-24.4.0/tests/data/cases/pep_572_do_not_remove_parens.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pep_572_py310.py` & `black-24.4.0/tests/data/cases/pep_572_py310.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pep_572_remove_parens.py` & `black-24.4.0/tests/data/cases/pep_572_remove_parens.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pep_604.py` & `black-24.4.0/tests/data/cases/pep_604.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pep_646.py` & `black-24.4.0/tests/data/cases/pep_646.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pep_654.py` & `black-24.4.0/tests/data/cases/pep_654.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/pep_654_style.py` & `black-24.4.0/tests/data/cases/pep_654_style.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/power_op_spacing.py` & `black-24.4.0/tests/data/cases/power_op_spacing.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/power_op_spacing_long.py` & `black-24.4.0/tests/data/cases/power_op_spacing_long.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/prefer_rhs_split.py` & `black-24.4.0/tests/data/cases/prefer_rhs_split.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/prefer_rhs_split_reformatted.py` & `black-24.4.0/tests/data/cases/prefer_rhs_split_reformatted.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/preview_cantfit.py` & `black-24.4.0/tests/data/cases/preview_cantfit.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/preview_cantfit_string.py` & `black-24.4.0/tests/data/cases/preview_cantfit_string.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/preview_comments7.py` & `black-24.4.0/tests/data/cases/preview_comments7.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/preview_format_unicode_escape_seq.py` & `black-24.4.0/tests/data/cases/preview_format_unicode_escape_seq.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets.py` & `black-24.4.0/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets_no_ll1.py` & `black-24.4.0/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets_no_ll1.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/preview_long_dict_values.py` & `black-24.4.0/tests/data/cases/preview_long_dict_values.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/preview_long_strings.py` & `black-24.4.0/tests/data/cases/preview_long_strings.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/preview_long_strings__east_asian_width.py` & `black-24.4.0/tests/data/cases/preview_long_strings__east_asian_width.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/preview_long_strings__edge_case.py` & `black-24.4.0/tests/data/cases/preview_long_strings__edge_case.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/preview_long_strings__regression.py` & `black-24.4.0/tests/data/cases/preview_long_strings__regression.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/preview_long_strings__type_annotations.py` & `black-24.4.0/tests/data/cases/preview_long_strings__type_annotations.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/preview_multiline_strings.py` & `black-24.4.0/tests/data/cases/preview_multiline_strings.py`

 * *Files 7% similar despite different names*

```diff
@@ -171,14 +171,21 @@
 
 this_will_also_become_one_line = (  # comment
     "a"
     "b"
     "c"
 )
 
+assert some_var == expected_result, """
+test
+"""
+assert some_var == expected_result, f"""
+expected: {expected_result}
+actual: {some_var}"""
+
 # output
 """cow
 say""",
 call(
     3,
     "dogsay",
     textwrap.dedent("""dove
@@ -381,7 +388,14 @@
 this_will_stay_on_three_lines = (
     "a"  # comment
     "b"
     "c"
 )
 
 this_will_also_become_one_line = "abc"  # comment
+
+assert some_var == expected_result, """
+test
+"""
+assert some_var == expected_result, f"""
+expected: {expected_result}
+actual: {some_var}"""
```

### Comparing `black-24.3.0/tests/data/cases/preview_return_annotation_brackets_string.py` & `black-24.4.0/tests/data/cases/preview_return_annotation_brackets_string.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/python37.py` & `black-24.4.0/tests/data/cases/python37.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/python38.py` & `black-24.4.0/tests/data/cases/python38.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/python39.py` & `black-24.4.0/tests/data/cases/python39.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/remove_await_parens.py` & `black-24.4.0/tests/data/cases/remove_await_parens.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/remove_except_parens.py` & `black-24.4.0/tests/data/cases/remove_except_parens.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/remove_for_brackets.py` & `black-24.4.0/tests/data/cases/remove_for_brackets.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/remove_newline_after_code_block_open.py` & `black-24.4.0/tests/data/cases/remove_newline_after_code_block_open.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/remove_parens.py` & `black-24.4.0/tests/data/cases/remove_parens.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/remove_redundant_parens_in_case_guard.py` & `black-24.4.0/tests/data/cases/remove_redundant_parens_in_case_guard.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/remove_with_brackets.py` & `black-24.4.0/tests/data/cases/remove_with_brackets.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/return_annotation_brackets.py` & `black-24.4.0/tests/data/cases/return_annotation_brackets.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/single_line_format_skip_with_multiple_comments.py` & `black-24.4.0/tests/data/cases/single_line_format_skip_with_multiple_comments.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/skip_magic_trailing_comma.py` & `black-24.4.0/tests/data/cases/skip_magic_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/slices.py` & `black-24.4.0/tests/data/cases/slices.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/split_delimiter_comments.py` & `black-24.4.0/tests/data/cases/split_delimiter_comments.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/string_prefixes.py` & `black-24.4.0/tests/data/cases/string_prefixes.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/stub.py` & `black-24.4.0/tests/data/cases/stub.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/torture.py` & `black-24.4.0/tests/data/cases/torture.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/trailing_comma.py` & `black-24.4.0/tests/data/cases/trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/trailing_comma_optional_parens1.py` & `black-24.4.0/tests/data/cases/trailing_comma_optional_parens1.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/trailing_comma_optional_parens3.py` & `black-24.4.0/tests/data/cases/trailing_comma_optional_parens3.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/trailing_commas_in_leading_parts.py` & `black-24.4.0/tests/data/cases/trailing_commas_in_leading_parts.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/type_params.py` & `black-24.4.0/tests/data/cases/type_params.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/cases/typed_params_trailing_comma.py` & `black-24.4.0/tests/data/cases/typed_params_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/jupyter/notebook_no_trailing_newline.ipynb` & `black-24.4.0/tests/data/jupyter/notebook_no_trailing_newline.ipynb`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/jupyter/notebook_trailing_newline.ipynb` & `black-24.4.0/tests/data/jupyter/notebook_trailing_newline.ipynb`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/jupyter/notebook_without_changes.ipynb` & `black-24.4.0/tests/data/jupyter/notebook_without_changes.ipynb`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/line_ranges_formatted/basic.py` & `black-24.4.0/tests/data/line_ranges_formatted/basic.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/line_ranges_formatted/pattern_matching.py` & `black-24.4.0/tests/data/line_ranges_formatted/pattern_matching.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/miscellaneous/debug_visitor.out` & `black-24.4.0/tests/data/miscellaneous/debug_visitor.out`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/miscellaneous/debug_visitor.py` & `black-24.4.0/tests/data/miscellaneous/debug_visitor.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/miscellaneous/decorators.py` & `black-24.4.0/tests/data/miscellaneous/decorators.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff` & `black-24.4.0/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/miscellaneous/force_py36.py` & `black-24.4.0/tests/data/miscellaneous/force_py36.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/miscellaneous/force_pyi.py` & `black-24.4.0/tests/data/miscellaneous/force_pyi.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/miscellaneous/python2_detection.py` & `black-24.4.0/tests/data/miscellaneous/python2_detection.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/tests/data/miscellaneous/string_quotes.py` & `black-24.4.0/tests/data/miscellaneous/string_quotes.py`

 * *Files identical despite different names*

### Comparing `black-24.3.0/AUTHORS.md` & `black-24.4.0/AUTHORS.md`

 * *Files identical despite different names*

### Comparing `black-24.3.0/LICENSE` & `black-24.4.0/LICENSE`

 * *Files identical despite different names*

### Comparing `black-24.3.0/pyproject.toml` & `black-24.4.0/pyproject.toml`

 * *Files identical despite different names*

### Comparing `black-24.3.0/PKG-INFO` & `black-24.4.0/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
-Metadata-Version: 2.1
+Metadata-Version: 2.3
 Name: black
-Version: 24.3.0
+Version: 24.4.0
 Summary: The uncompromising code formatter.
 Project-URL: Changelog, https://github.com/psf/black/blob/main/CHANGES.md
 Project-URL: Homepage, https://github.com/psf/black
 Author-email: Łukasz Langa <lukasz@langa.pl>
 License: MIT
 License-File: AUTHORS.md
 License-File: LICENSE
@@ -271,14 +271,31 @@
 
 At the same time, humor is encouraged. In fact, basic familiarity with Monty Python's
 Flying Circus is expected. We are not savages.
 
 And if you _really_ need to slap somebody, do it with a fish while dancing.
 # Change Log
 
+## 24.4.0
+
+### Stable style
+
+- Fix unwanted crashes caused by AST equivalency check (#4290)
+
+### Preview style
+
+- `if` guards in `case` blocks are now wrapped in parentheses when the line is too long.
+  (#4269)
+- Stop moving multiline strings to a new line unless inside brackets (#4289)
+
+### Integrations
+
+- Add a new option `use_pyproject` to the GitHub Action `psf/black`. This will read the
+  Black version from `pyproject.toml`. (#4294)
+
 ## 24.3.0
 
 ### Highlights
 
 This release is a milestone: it fixes Black's first CVE security vulnerability. If you
 run Black on untrusted input, or if you habitually put thousands of leading tab
 characters in your docstrings, you are strongly encouraged to upgrade immediately to fix
```

#### html2text {}

```diff
@@ -1,8 +1,8 @@
-Metadata-Version: 2.1 Name: black Version: 24.3.0 Summary: The uncompromising
+Metadata-Version: 2.3 Name: black Version: 24.4.0 Summary: The uncompromising
 code formatter. Project-URL: Changelog, https://github.com/psf/black/blob/main/
 CHANGES.md Project-URL: Homepage, https://github.com/psf/black Author-email:
 Åukasz Langa
 langa.pl> License: MIT License-File: AUTHORS.md License-File: LICENSE Keywords:
 automation,autopep8,formatter,gofmt,pyfmt,rustfmt,yapf Classifier: Development
 Status :: 5 - Production/Stable Classifier: Environment :: Console Classifier:
 Intended Audience :: Developers Classifier: License :: OSI Approved :: MIT
@@ -137,42 +137,48 @@
 [AUTHORS.md](./AUTHORS.md) ## Code of Conduct Everyone participating in the
 _Black_ project, and in particular in the issue tracker, pull requests, and
 social media activity, is expected to treat other people with respect and more
 generally to follow the guidelines articulated in the [Python Community Code of
 Conduct](https://www.python.org/psf/codeofconduct/). At the same time, humor is
 encouraged. In fact, basic familiarity with Monty Python's Flying Circus is
 expected. We are not savages. And if you _really_ need to slap somebody, do it
-with a fish while dancing. # Change Log ## 24.3.0 ### Highlights This release
-is a milestone: it fixes Black's first CVE security vulnerability. If you run
-Black on untrusted input, or if you habitually put thousands of leading tab
-characters in your docstrings, you are strongly encouraged to upgrade
-immediately to fix [CVE-2024-21503](https://cve.mitre.org/cgi-bin/
-cvename.cgi?name=CVE-2024-21503). This release also fixes a bug in Black's AST
-safety check that allowed Black to make incorrect changes to certain f-strings
-that are valid in Python 3.12 and higher. ### Stable style - Don't move
-comments along with delimiters, which could cause crashes (#4248) - Strengthen
-AST safety check to catch more unsafe changes to strings. Previous versions of
-Black would incorrectly format the contents of certain unusual f-strings
-containing nested strings with the same quote type. Now, Black will crash on
-such strings until support for the new f-string syntax is implemented. (#4270)
-- Fix a bug where line-ranges exceeding the last code line would not work as
-expected (#4273) ### Performance - Fix catastrophic performance on docstrings
-that contain large numbers of leading tab characters. This fixes [CVE-2024-
-21503](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-21503). (#4278)
-### Documentation - Note what happens when `--check` is used with `--quiet`
-(#4236) ## 24.2.0 ### Stable style - Fixed a bug where comments where
-mistakenly removed along with redundant parentheses (#4218) ### Preview style -
-Move the `hug_parens_with_braces_and_square_brackets` feature to the unstable
-style due to an outstanding crash and proposed formatting tweaks (#4198) -
-Fixed a bug where base expressions caused inconsistent formatting of \*\* in
-tenary expression (#4154) - Checking for newline before adding one on docstring
-that is almost at the line limit (#4185) - Remove redundant parentheses in
-`case` statement `if` guards (#4214). ### Configuration - Fix issue where
-_Black_ would ignore input files in the presence of symlinks (#4222) - _Black_
-now ignores `pyproject.toml` that is missing a `tool.black` section when
+with a fish while dancing. # Change Log ## 24.4.0 ### Stable style - Fix
+unwanted crashes caused by AST equivalency check (#4290) ### Preview style -
+`if` guards in `case` blocks are now wrapped in parentheses when the line is
+too long. (#4269) - Stop moving multiline strings to a new line unless inside
+brackets (#4289) ### Integrations - Add a new option `use_pyproject` to the
+GitHub Action `psf/black`. This will read the Black version from
+`pyproject.toml`. (#4294) ## 24.3.0 ### Highlights This release is a milestone:
+it fixes Black's first CVE security vulnerability. If you run Black on
+untrusted input, or if you habitually put thousands of leading tab characters
+in your docstrings, you are strongly encouraged to upgrade immediately to fix
+[CVE-2024-21503](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-
+21503). This release also fixes a bug in Black's AST safety check that allowed
+Black to make incorrect changes to certain f-strings that are valid in Python
+3.12 and higher. ### Stable style - Don't move comments along with delimiters,
+which could cause crashes (#4248) - Strengthen AST safety check to catch more
+unsafe changes to strings. Previous versions of Black would incorrectly format
+the contents of certain unusual f-strings containing nested strings with the
+same quote type. Now, Black will crash on such strings until support for the
+new f-string syntax is implemented. (#4270) - Fix a bug where line-ranges
+exceeding the last code line would not work as expected (#4273) ### Performance
+- Fix catastrophic performance on docstrings that contain large numbers of
+leading tab characters. This fixes [CVE-2024-21503](https://cve.mitre.org/cgi-
+bin/cvename.cgi?name=CVE-2024-21503). (#4278) ### Documentation - Note what
+happens when `--check` is used with `--quiet` (#4236) ## 24.2.0 ### Stable
+style - Fixed a bug where comments where mistakenly removed along with
+redundant parentheses (#4218) ### Preview style - Move the
+`hug_parens_with_braces_and_square_brackets` feature to the unstable style due
+to an outstanding crash and proposed formatting tweaks (#4198) - Fixed a bug
+where base expressions caused inconsistent formatting of \*\* in tenary
+expression (#4154) - Checking for newline before adding one on docstring that
+is almost at the line limit (#4185) - Remove redundant parentheses in `case`
+statement `if` guards (#4214). ### Configuration - Fix issue where _Black_
+would ignore input files in the presence of symlinks (#4222) - _Black_ now
+ignores `pyproject.toml` that is missing a `tool.black` section when
 discovering project root and configuration. Since _Black_ continues to use
 version control as an indicator of project root, this is expected to primarily
 change behavior for users in a monorepo setup (desirably). If you wish to
 preserve previous behavior, simply add an empty `[tool.black]` to the
 previously discovered `pyproject.toml` (#4204) ### Output - Black will swallow
 any `SyntaxWarning`s or `DeprecationWarning`s produced by the `ast` module when
 performing equivalence checks (#4189) ### Integrations - Add a JSONSchema and
```

